var Wp=Object.defineProperty;var cd=c=>{throw TypeError(c)};var Jp=(c,r,u)=>r in c?Wp(c,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[r]=u;var y=(c,r,u)=>Jp(c,typeof r!="symbol"?r+"":r,u),Th=(c,r,u)=>r.has(c)||cd("Cannot "+u);var $t=(c,r,u)=>(Th(c,r,"read from private field"),u?u.call(c):r.get(c)),pi=(c,r,u)=>r.has(c)?cd("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(c):r.set(c,u),ts=(c,r,u,g)=>(Th(c,r,"write to private field"),g?g.call(c,u):r.set(c,u),u),ft=(c,r,u)=>(Th(c,r,"access private method"),u);var Dh=(c,r,u,g)=>({set _(w){ts(c,r,w,u)},get _(){return $t(c,r,g)}});(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))g(w);new MutationObserver(w=>{for(const k of w)if(k.type==="childList")for(const N of k.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&g(N)}).observe(document,{childList:!0,subtree:!0});function u(w){const k={};return w.integrity&&(k.integrity=w.integrity),w.referrerPolicy&&(k.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?k.credentials="include":w.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function g(w){if(w.ep)return;w.ep=!0;const k=u(w);fetch(w.href,k)}})();/**
 * @license GoJS
 * GoJS v3.1.3 JavaScript Library for Interactive Diagrams, https://gojs.net
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation, https://nwoods.com.
 * Copyright 1998-2025 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: https://gojs.net/3.1.3/license.html.
 * DO NOT MODIFY THIS FILE.  DO NOT DISTRIBUTE A MODIFIED COPY OF THE CONTENTS OF THIS FILE.
 */(function(){const c=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};c.requestAnimationFrame===void 0&&(c.setImmediate===void 0?c.requestAnimationFrame=M=>c.setTimeout(M,0):c.requestAnimationFrame=c.setImmediate);const Ze=class Ze{static CP(e,t,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&Ze.wc(s),s=Ze.dn(()=>{s=-1,i||e.apply(n,o)},t),i&&!s&&e.apply(n,o)}}static dn(e,t){return c.setTimeout(e,t)}static wc(e){c.clearTimeout(e)}static Ni(e){return c.document.createElement(e)}static o(e){throw new Error(e)}static L(e,t){let i="The object is frozen, so its properties cannot be set: "+e.toString();t!==void 0&&(i+="  to value: "+t),Ze.o(i)}static se(e,t,i,s){}static s(e,t,i,s){}static CU(e,t,i){}static xc(e,t,i){(e===null||typeof e!="object")&&Ze.LL(t)}static S(e,t,i){}static LU(e,t,i){}static si(e,t,i,s){}static J(e,t,i,s){let n=Ze.LL(i);s!==void 0&&(n+="."+s),Ze.o(n+" is not in the range "+t+": "+e)}static Gi(e){}static dr(e,t){}static ne(e){c.console&&c.console.log(e)}static $(e){return e!==null&&typeof e=="object"}static st(e){return typeof e=="function"}static nt(){const e=Ze.LP.pop();return e===void 0?[]:e}static Z(e){e.length=0,Ze.LP.push(e)}static LL(e){return e===null?"*":typeof e=="string"?e:Ze.st(e)?e.name:""}static Hn(e){return Ze.st(e)?e.className?e.className:e.name:Ze.$(e)&&e.constructor?Ze.Hn(e.constructor):typeof e}static $a(e,t){return t==null||t===""?null:Ze.$(e)&&t in e||e[t]?e[t]:null}static toString(e){let t=e;return Ze.$(e)&&(e.text?t=e.text:e.name?t=e.name:e.key!==void 0?t=e.key:e.id!==void 0?t=e.id:e.constructor===Object&&(e.Text?t=e.Text:e.Name?t=e.Name:e.Key!==void 0?t=e.Key:e.Id!==void 0?t=e.Id:e.ID!==void 0&&(t=e.ID))),t===void 0?"undefined":t===null?"null":t.toString()}static jw(e,t){if(e.hasOwnProperty(t))return!0;let i=Object.getPrototypeOf(e);for(;i&&i!==Function;){if(i.hasOwnProperty(t))return!0;const s=i.TU;if(s&&s[t])return!0;i=Object.getPrototypeOf(i)}return!1}static zF(e){const t=[];let i=0;for(i=0;i<256;i++)t[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+t[i]+119)%256,n=t[i],t[i]=t[s],t[s]=n;i=0,s=0;let o="";for(let a=0;a<e.length;a++)i=(i+1)%256,s=(s+t[i])%256,n=t[i],t[i]=t[s],t[s]=n,o+=String.fromCharCode(e.charCodeAt(a)^t[(t[i]+t[s])%256]);return o}static XF(e){const t="0123456789abcdef",i=[];for(let a=0;a<256;a++)i[t.charAt(a>>4)+t.charAt(a&15)]=String.fromCharCode(a);e.length%2&&(e="0"+e);const s=[];let n=0;for(let a=0;a<e.length;a+=2)s[n++]=i[e.substring(a,a+2)];const o=s.join("");return o===""?"0":o}static We(e){return Ze.zF(Ze.XF(e))}};y(Ze,"ur",c.navigator!==void 0&&c.navigator.platform!==void 0&&c.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null),y(Ze,"LP",[]),y(Ze,"AU",Object.freeze([])),y(Ze,"color1","@COLOR1"),y(Ze,"color2","@COLOR2"),y(Ze,"qw","32ab5ff3b26f42dc0ed90f21412913b5");let r=Ze;r.vfo="29e647fdb0";class u{constructor(){y(this,"AP");this.AP=[]}toString(){return this.AP.join("")}add(e){e!==""&&this.AP.push(e)}}class g{}const ya=class ya{constructor(){y(this,"g");y(this,"key");y(this,"value");this.g=[]}[Symbol.iterator](){return this.g.values()}get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(e){return this}filter(){return this}get count(){return 0}Ml(){}toString(){return"EmptyIterator"}};y(ya,"instance",new ya);let w=ya;class k{constructor(e){y(this,"key");y(this,"value");this.key=-1,this.value=e}[Symbol.iterator](){return[this.value].values()}get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(e){return this.key=-1,e(this.value)}all(e){return this.key=-1,e(this.value)}each(e){return this.key=-1,e(this.value),this}map(e){return new k(e(this.value))}filter(e){return e(this.value)?new k(this.value):w.instance}get count(){return 1}Ml(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class N{constructor(e){y(this,"jt");y(this,"Xs");y(this,"Gt");y(this,"Tt");y(this,"key");y(this,"value");this.jt=e,this.Xs=null,e.gr=null,this.Gt=e.rt,this.Tt=-1}[Symbol.iterator](){return this.Xs===null?this.jt.r.values():this.jt.r.filter(this.Xs).values()}get iterator(){return this}get predicate(){return this.Xs}set predicate(e){this.Xs=e}reset(){const e=this.jt;e.gr=null,this.Gt=e.rt,this.Tt=-1}next(){const e=this.jt;if(e.rt!==this.Gt&&this.key<0)return!1;const t=e.r,i=t.length;let s=++this.Tt;const n=this.Xs;if(n!==null)for(;s<i;){const o=t[s];if(n(o))return this.Tt=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=t[s],!0;this.Ml()}return!1}hasNext(){return this.next()}first(){const e=this.jt;this.Gt=e.rt,this.Tt=0;const t=e.r,i=t.length,s=this.Xs;if(s!==null){let n=0;for(;n<i;){const o=t[n];if(s(o))return this.Tt=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=t[0];return this.key=0,this.value=n,n}else return null}any(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let a=0;a<n;a++){const l=s[a];if(!(o!==null&&!o(l))){if(e(l))return!0;t.rt!==i&&r.Gi(t)}}return!1}all(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let a=0;a<n;a++){const l=s[a];if(!(o!==null&&!o(l))){if(!e(l))return!1;t.rt!==i&&r.Gi(t)}}return!0}each(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=t.r,n=s.length,o=this.Xs;for(let a=0;a<n;a++){const l=s[a];o!==null&&!o(l)||(e(l),t.rt!==i&&r.Gi(t))}return this}map(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=[],n=t.r,o=n.length,a=this.Xs;for(let h=0;h<o;h++){const d=n[h];a!==null&&!a(d)||(s.push(e(d)),t.rt!==i&&r.Gi(t))}const l=new E;return l.r=s,l.Yi(),l.iterator}filter(e){const t=this.jt;t.gr=null;const i=t.rt;this.Tt=-1;const s=[],n=t.r,o=n.length,a=this.Xs;for(let h=0;h<o;h++){const d=n[h];a!==null&&!a(d)||(e(d)&&s.push(d),t.rt!==i&&r.Gi(t))}const l=new E;return l.r=s,l.Yi(),l.iterator}get count(){const e=this.Xs;if(e!==null){let t=0;const i=this.jt.r,s=i.length;for(let n=0;n<s;n++)e(i[n])&&t++;return t}else return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.Xs=null,this.jt.gr=this}toString(){return"ListIterator@"+this.Tt+"/"+this.jt.count}}class D{constructor(e){y(this,"jt");y(this,"Gt");y(this,"Tt");y(this,"key");y(this,"value");this.jt=e,e.pr=null,this.Gt=e.rt,this.Tt=e.r.length}[Symbol.iterator](){return this.jt.r.reverse().values()}get iterator(){return this}reset(){const e=this.jt;e.pr=null,this.Gt=e.rt,this.Tt=e.r.length}next(){const e=this.jt;if(e.rt!==this.Gt&&this.key<0)return!1;const t=--this.Tt;return t>=0?(this.key=t,this.value=e.r[t],!0):(this.Ml(),!1)}hasNext(){return this.next()}first(){const e=this.jt;this.Gt=e.rt;const t=e.r,i=t.length-1;if(this.Tt=i,i>=0){const s=t[i];return this.key=i,this.value=s,s}else return null}any(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const a=s[o];if(e(a))return!0;t.rt!==i&&r.Gi(t)}return!1}all(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const a=s[o];if(!e(a))return!1;t.rt!==i&&r.Gi(t)}return!0}each(e){const t=this.jt;t.pr=null;const i=t.rt,s=t.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const a=s[o];e(a),t.rt!==i&&r.Gi(t)}return this}map(e){const t=this.jt;t.pr=null;const i=t.rt,s=[],n=t.r,o=n.length;this.Tt=o;for(let l=o-1;l>=0;l--){const h=n[l];s.push(e(h)),t.rt!==i&&r.Gi(t)}const a=new E;return a.r=s,a.Yi(),a.iterator}filter(e){const t=this.jt;t.pr=null;const i=t.rt,s=[],n=t.r,o=n.length;this.Tt=o;for(let l=o-1;l>=0;l--){const h=n[l];e(h)&&s.push(h),t.rt!==i&&r.Gi(t)}const a=new E;return a.r=s,a.Yi(),a.iterator}get count(){return this.jt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.jt.pr=this}toString(){return"ListIteratorBackwards("+this.Tt+"/"+this.jt.count+")"}}class E{constructor(e){y(this,"f");y(this,"r");y(this,"rt");y(this,"gr");y(this,"pr");F.Je(this),this.f=!1,this.r=[],this.rt=0,this.gr=null,this.pr=null,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.r.values()}Yi(){let e=this.rt;e++,e>999999999&&(e=0),this.rt=e}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"List()#"+F.xs(this)}add(e){return this.f&&r.L(this,e),this.r.push(e),this.Yi(),this}push(e){this.add(e)}addAll(e){if(e===null)return this;this.f&&r.L(this);const t=this.r;if(e.first){const i=e.iterator;for(;i.next();)t.push(i.value)}else for(const i of e)t.push(i);return this.Yi(),this}clear(){this.f&&r.L(this),this.r.length=0,this.Yi()}contains(e){return this.has(e)}has(e){return e===null?!1:this.r.indexOf(e)!==-1}indexOf(e){return e===null?-1:this.r.indexOf(e)}elt(e){const t=this.r;return(e<0||e>=t.length)&&r.J(e,"0 <= i < length",E,"elt:i"),t[e]}get(e){return this.elt(e)}setElt(e,t){const i=this.r;(e<0||e>=i.length)&&r.J(e,"0 <= i < length",E,"setElt:i"),this.f&&r.L(this,e),i[e]=t}set(e,t){this.setElt(e,t)}first(){const e=this.r;return e.length===0?null:e[0]}last(){const e=this.r,t=e.length;return t>0?e[t-1]:null}pop(){this.f&&r.L(this);const e=this.r;if(e.length>0){const t=e.pop();return t===void 0?null:t}return null}any(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++){if(e(t[n]))return!0;this.rt!==i&&r.Gi(this)}return!1}all(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++){if(!e(t[n]))return!1;this.rt!==i&&r.Gi(this)}return!0}each(e){const t=this.r,i=this.rt,s=t.length;for(let n=0;n<s;n++)e(t[n]),this.rt!==i&&r.Gi(this);return this}map(e){const t=new E,i=[],s=this.r,n=this.rt,o=s.length;for(let a=0;a<o;a++)i.push(e(s[a])),this.rt!==n&&r.Gi(this);return t.r=i,t.Yi(),t}filter(e){const t=new E,i=[],s=this.r,n=this.rt,o=s.length;for(let a=0;a<o;a++){const l=s[a];e(l)&&i.push(l),this.rt!==n&&r.Gi(this)}return t.r=i,t.Yi(),t}insertAt(e,t){e<0&&r.J(e,">= 0",E,"insertAt:i"),this.f&&r.L(this,e);const i=this.r;e>=i.length?i.push(t):i.splice(e,0,t),this.Yi()}remove(e){return this.delete(e)}delete(e){if(e===null)return!1;this.f&&r.L(this,e);const t=this.r,i=t.indexOf(e);return i===-1?!1:(i===t.length-1?t.pop():t.splice(i,1),this.Yi(),!0)}removeAt(e){const t=this.r;(e<0||e>=t.length)&&r.J(e,"0 <= i < length",E,"removeAt:i"),this.f&&r.L(this,e),e===t.length-1?t.pop():t.splice(e,1),this.Yi()}removeRange(e,t){const i=this.r,s=i.length;if(e<0)e=0;else if(e>=s)return this;if(t<0)return this;if(t>=s&&(t=s-1),e>t)return this;this.f&&r.L(this);let n=e,o=t+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(t-e+1),this.Yi(),this}copy(){const e=new E,t=this.r;return t.length>0&&(e.r=Array.prototype.slice.call(t)),e}toArray(){const e=this.r,t=this.count,i=new Array(t);for(let s=0;s<t;s++)i[s]=e[s];return i}get AL(){return this.r}toSet(){const e=new F,t=this.r,i=this.count;for(let s=0;s<i;s++)e.add(t[s]);return e}sort(e){return this.f&&r.L(this),this.r.sort(e),this.Yi(),this}sortRange(e,t,i){const s=this.r,n=s.length;t===void 0&&(t=0),i===void 0&&(i=n),this.f&&r.L(this);const o=i-t;if(o<=1)return this;if((t<0||t>=n-1)&&r.J(t,"0 <= from < length",E,"sortRange:from"),o===2){const a=s[t],l=s[t+1];return e(a,l)>0&&(s[t]=l,s[t+1]=a,this.Yi()),this}if(t===0)if(i>=n)s.sort(e);else{const a=s.slice(0,i);a.sort(e);for(let l=0;l<i;l++)s[l]=a[l]}else if(i>=n){const a=s.slice(t);a.sort(e);for(let l=t;l<n;l++)s[l]=a[l-t]}else{const a=s.slice(t,i);a.sort(e);for(let l=t;l<i;l++)s[l]=a[l-t]}return this.Yi(),this}reverse(){return this.f&&r.L(this),this.r.reverse(),this.Yi(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return w.instance;const e=this.gr;return e!==null?(e.reset(),e):new N(this)}get iteratorBackwards(){if(this.r.length<=0)return w.instance;const e=this.pr;return e!==null?(e.reset(),e):new D(this)}}class U{constructor(e){y(this,"Do");y(this,"oe");y(this,"key");y(this,"value");this.Do=e,this.oe=e.g.values()}[Symbol.iterator](){return this.Do.g.values()}get iterator(){return this}reset(){const e=this.Do;this.oe=e.g.values()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.Do.g.size===0?null:(this.oe=this.Do.g.values(),this.oe.next().value)}any(e){return this.Do.any(e)}all(e){return this.Do.all(e)}each(e){return this.Do.each(e),this}map(e){const t=new E;return this.Do.g.forEach(i=>t.add(e(i))),t.iterator}filter(e){const t=new E;return this.Do.g.forEach(i=>{e(i)&&t.add(i)}),t.iterator}get count(){return this.Do.count}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"SetIterator"}}const _s=class _s{constructor(e){y(this,"f");y(this,"g");this.f=!1,this.g=new Set,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Set()#"+_s.xs(this)}add(e){return e===null?this:(this.g.add(e),this)}addAll(e){if(e===null)return this;if(this.f&&r.L(this),e.first){const t=e.iterator;for(;t.next();)this.g.add(t.value)}else for(const t of e)this.g.add(t);return this}has(e){return this.g.has(e)}contains(e){return this.has(e)}containsAll(e){if(e===null)return!0;if(e.first){const t=e.iterator;for(;t.next();)if(!this.has(t.value))return!1}else for(const t of e)if(!this.has(t))return!1;return!0}containsAny(e){if(e===null)return!0;if(e.first){const t=e.iterator;for(;t.next();)if(this.has(t.value))return!0}else for(const t of e)if(this.has(t))return!0;return!1}first(){return this.g.size===0?null:this.g.values().next().value}any(e){for(const t of this.g)if(e(t))return!0;return!1}all(e){for(const t of this.g)if(!e(t))return!1;return!0}each(e){for(const t of this.g)e(t);return this}map(e){const t=new _s;for(const i of this.g)t.add(e(i));return t}filter(e){const t=new _s;for(const i of this.g)e(i)&&t.add(i);return t}delete(e){return this.f&&r.L(this),this.g.delete(e)}remove(e){return this.delete(e)}removeAll(e){if(e===null)return this;if(this.f&&r.L(this),e.first){const t=e.iterator;for(;t.next();)this.delete(t.value)}else for(const t of e)this.delete(t);return this}retainAll(e){if(e===null)return this;if(this.count===0)return this;this.f&&r.L(this);const t=new _s;t.addAll(e);const i=[];if(e.first){const s=e.iterator;for(;s.next();){const n=s.value;t.has(n)||i.push(n)}}else for(const s of e)t.has(s)||i.push(s);return this.removeAll(i),this}clear(){this.f&&r.L(this),this.g.clear()}copy(){const e=new _s;return this.g.forEach(t=>e.add(t)),e}toArray(){return Array.from(this.g)}toList(){const e=new E;return this.g.forEach(t=>e.add(t)),e}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?w.instance:new U(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(e,t){return this.g.forEach(e,t)}static Je(e){e.__gohashid=_s.Ww++}static xs(e){return e.__gohashid}};y(_s,"Ww",1);let F=_s;class j{constructor(e){y(this,"q");y(this,"oe");y(this,"key");y(this,"value");this.q=e,this.oe=e.g.keys()}[Symbol.iterator](){return this.q.g.keys()}get iterator(){return this}reset(){const e=this.q;this.oe=e.g.keys()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.oe=this.q.g.keys(),this.oe.next().value)}any(e){for(const t of this.q.g)if(e(t[0]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.q.g)e(t[0]);return this}map(e){const t=this.q,i=new E;for(const s of t.g)i.add(e(s[0]));return i.iterator}filter(e){const t=this.q,i=new E;for(const s of t.g){const n=s[0];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapKeySetIterator"}}class G extends F{constructor(t){super();y(this,"q");F.Je(this),this.f=!0,this.q=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}k(){return this}ce(){return this}toString(){return"MapKeySet("+this.q.toString()+")"}add(t){r.o("This Set is read-only: "+this.toString())}has(t){return this.q.has(t)}contains(t){return this.has(t)}delete(t){r.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){r.o("This Set is read-only: "+this.toString())}first(){return this.q.g.size===0?null:this.q.g.keys().next().value}any(t){for(const i of this.q.g)if(t(i[0]))return!0;return!1}all(t){for(const i of this.q.g)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.q.g)t(i[0]);return this}map(t){const i=new F;for(const s of this.q.g)i.add(t(s[0]));return i}filter(t){const i=new F;for(const s of this.q.g){const n=s[0];t(n)&&i.add(n)}return i}copy(){return new G(this.q)}toSet(){const t=new F,i=this.q.g;for(const s of i)t.add(s[0]);return t}toArray(){const t=this.q.g,i=new Array(t.size);let s=0;for(const n of t)i[s]=n[0],s++;return i}toList(){const t=new E,i=this.q.g;for(const s of i)t.add(s[0]);return t}get count(){return this.q.size}get size(){return this.q.size}get iterator(){return this.q.size<=0?w.instance:new j(this.q)}}class W{constructor(e){y(this,"q");y(this,"oe");y(this,"key");y(this,"value");this.q=e,this.oe=e.g.values()}[Symbol.iterator](){return this.q.g.values()}get iterator(){return this}reset(){const e=this.q;this.oe=e.g.values()}next(){const e=this.oe.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.oe=this.q.g.values(),this.oe.next().value)}any(e){for(const t of this.q.g)if(e(t[1]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[1]))return!1;return!0}each(e){for(const t of this.q.g)e(t[1]);return this}map(e){const t=this.q,i=new E;for(const s of t.g)i.add(e(s[1]));return i.iterator}filter(e){const t=this.q,i=new E;for(const s of t.g){const n=s[1];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapValueSetIterator"}}class tt{constructor(e,t){y(this,"key");y(this,"value");this.key=e,this.value=t}toString(){return"{"+this.key+":"+this.value+"}"}}class it{constructor(e){y(this,"q");y(this,"oe");y(this,"key");y(this,"value");this.q=e,this.oe=e.g.entries()}[Symbol.iterator](){return this.q.g.entries()}get iterator(){return this}reset(){const e=this.q;this.oe=e.g.entries()}next(){const e=this.oe.next();return e.done?(this.key=null,this.value=null,!1):(this.key=e.value[0],this.value=e.value[1],!0)}hasNext(){return this.next()}first(){if(this.q.g.size===0)return null;this.oe=this.q.g.entries();const e=this.oe.next().value;return this.key=e[0],this.value=e[1],new tt(e[0],e[1])}any(e){return this.q.any(e)}all(e){return this.q.all(e)}each(e){return this.q.each(e),this}map(e){const t=new E;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new tt(n,s):(i.key=n,i.value=s),t.add(e(i))}),t.iterator}filter(e){const t=new E;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new tt(n,s):(i.key=n,i.value=s),e(i)&&(t.add(i),i=null)}),t.iterator}get count(){return this.q.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapIterator"}}class nt{constructor(e){y(this,"f");y(this,"g");F.Je(this),this.f=!1,this.g=new Map,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}k(){return this.f=!0,this}ce(){return this.f=!1,this}toString(){return"Map()#"+F.xs(this)}set(e,t){return this.f&&r.L(this,e),this.g.set(e,t),this}add(e,t){return this.set(e,t)}addAll(e){if(e===null)return this;if(this.f&&r.L(this),e instanceof nt){const t=e.iterator;for(;t.next();)this.g.set(t.key,t.value)}else if(e.first){const t=e.iterator;for(;t.next();){const i=t.value;this.g.set(i.key,i.value)}}else for(const t of e){const i=t;Array.isArray(i)?this.g.set(i[0],i[1]):this.g.set(i.key,i.value)}return this}first(){if(this.g.size===0)return null;const e=this.g.entries().next().value;return e?new tt(e[0],e[1]):null}any(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new tt(i,s):(t.key=i,t.value=s),e(t))return!0;return!1}all(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new tt(i,s):(t.key=i,t.value=s),!e(t))return!1;return!0}each(e){let t=null;for(const[i,s]of this.g)t===null?t=new tt(i,s):(t.key=i,t.value=s),e(t);return this}map(e){const t=new nt;let i=null;for(const[s,n]of this.g)i===null?i=new tt(s,n):(i.key=s,i.value=n),t.set(s,e(i));return t}filter(e){const t=new nt;let i=null;for(const[s,n]of this.g)i===null?i=new tt(s,n):(i.key=s,i.value=n),e(i)&&t.set(s,n);return t}has(e){return this.g.has(e)}contains(e){return this.has(e)}get(e){const t=this.g.get(e);return t===void 0?null:t}getValue(e){return this.get(e)}delete(e){return e===null?!1:(this.f&&r.L(this,e),this.g.delete(e))}remove(e){return this.delete(e)}clear(){this.f&&r.L(this),this.g.clear()}copy(){const e=new nt;return e.g=new Map(this.g),e}toArray(){const e=this.g,t=new Array(e.size);let i=0;for(const s of e)t[i]=new tt(s[0],s[1]),i++;return t}toKeySet(){return new G(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?w.instance:new it(this)}get iteratorKeys(){return this.count<=0?w.instance:new j(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?w.instance:new W(this)}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}}const ii=class ii{constructor(e,t){y(this,"px");y(this,"py");y(this,"f");e===void 0?(this.px=0,this.py=0):typeof e=="number"&&typeof t=="number"?(this.px=e,this.py=t):r.o("Invalid arguments to Point constructor: "+e+", "+t),this.f=!1}h(e){return this.px=e.px,this.py=e.py,this}e(e,t){return this.px=e,this.py=t,this}setTo(e,t){return this.px=e,this.py=t,this}set(e){return this.px=e.px,this.py=e.py,this}copy(){const e=new ii;return e.px=this.px,e.py=this.py,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new ii(s,o)}else return new ii}static stringify(e){return e.x.toString()+" "+e.y.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(e){return e instanceof ii?this.px===e.x&&this.py===e.y:!1}equalTo(e,t){return this.px===e&&this.py===t}equalsApprox(e){return B.u(this.px,e.x)&&B.u(this.py,e.y)}add(e){return this.px+=e.x,this.py+=e.y,this}subtract(e){return this.px-=e.x,this.py-=e.y,this}offset(e,t){return this.px+=e,this.py+=t,this}rotate(e){if(e===0)return this;const t=this.px,i=this.py;if(t===0&&i===0)return this;let s=0,n=0;if(e=B.Ee(e),e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const o=e*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*t-n*i,this.py=n*t+s*i,this}scale(e,t){return this.px*=e,this.py*=t,this}distanceSquaredPoint(e){const t=e.x-this.px,i=e.y-this.py;return t*t+i*i}distanceSquared(e,t){const i=e-this.px,s=t-this.py;return i*i+s*s}normalize(){const e=this.px,t=this.py,i=Math.sqrt(e*e+t*t);return i>0&&(this.px=e/i,this.py=t/i),this}directionPoint(e){return this.TL(e.x-this.px,e.y-this.py)}direction(e,t){return this.TL(e-this.px,t-this.py)}TL(e,t){if(e===0)return t>0?90:t<0?270:0;if(t===0)return e>0?0:180;{if(isNaN(e)||isNaN(t))return 0;let i=Math.atan(Math.abs(t/e))*180/Math.PI;return e<0?t<0?i+=180:i=180-i:t<0&&(i=360-i),i}}static compareWithLineSegment(e,t,i,s,n,o){return B.ku(e,t,i,s,n,o)}compareWithLineSegmentPoint(e,t){return B.ku(e.x,e.y,t.x,t.y,this.x,this.y)}static intersectingLineSegments(e,t,i,s,n,o,a,l){return B.Pu(e,t,i,s,n,o,a,l)}projectOntoLineSegment(e,t,i,s){return B.Nl(e,t,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(e,t){return B.Nl(e.x,e.y,t.x,t.y,this.px,this.py,this),this}snapToGrid(e,t,i,s){return B.tm(this.px,this.py,e,t,i,s,this),this}snapToGridPoint(e,t){return B.tm(this.px,this.py,e.x,e.y,t.width,t.height,this),this}setRectSpot(e,t){return this.px=e.x+t.x*e.width+t.offsetX,this.py=e.y+t.y*e.height+t.offsetY,this}setSpot(e,t,i,s,n){return this.px=e+n.x*i+n.offsetX,this.py=t+n.y*s+n.offsetY,this}v(e){return e.gt(this),this}Ki(e){return e.Ci(this),this}static distanceLineSegmentSquared(e,t,i,s,n,o){let a=n-i,l=o-s;const h=a*a+l*l,d=i-e,f=s-t,m=-d*a-f*l;if(m<=0||m>=h)return a=n-e,l=o-t,Math.min(d*d+f*f,a*a+l*l);{const p=a*f-l*d;return p*p/h}}static distanceSquared(e,t,i,s){const n=i-e,o=s-t;return n*n+o*o}static direction(e,t,i,s){const n=i-e,o=s-t;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let a=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?a+=180:a=180-a:o<0&&(a=360-a),a}}get x(){return this.px}set x(e){this.px=e}get y(){return this.py}set y(e){this.py=e}isReal(){return isFinite(this.x)&&isFinite(this.y)}static l(){const e=ii.$w.pop();return e===void 0?new ii:e}static bs(e){const t=ii.$w.pop();return t===void 0?e.copy():t.h(e)}static z(e,t){const i=ii.$w.pop();return i===void 0?new ii(e,t):(i.x=e,i.y=t,i)}static i(e){ii.$w.push(e)}};y(ii,"gn",new ii(0,0).kt()),y(ii,"DL",new ii(-1/0,-1/0).kt()),y(ii,"vL",new ii(1/0,1/0).kt()),y(ii,"FL",new ii(6,6).kt()),y(ii,"mn",new ii(NaN,NaN).kt()),y(ii,"$w",[]);let L=ii;const Ke=class Ke{constructor(e,t){y(this,"sw");y(this,"sh");y(this,"f");e===void 0?(this.sw=0,this.sh=0):typeof e=="number"&&(e>=0||isNaN(e))&&typeof t=="number"&&(t>=0||isNaN(t))?(this.sw=e,this.sh=t):r.o("Invalid arguments to Size constructor: "+e+", "+t),this.f=!1}h(e){return this.sw=e.sw,this.sh=e.sh,this}e(e,t){return this.sw=e,this.sh=t,this}setTo(e,t){return this.sw=e,this.sh=t,this}set(e){return this.sw=e.sw,this.sh=e.sh,this}copy(){const e=new Ke;return e.sw=this.sw,e.sh=this.sh,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}Jw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new Ke(s,o)}else return new Ke}static stringify(e){return e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(e){return e instanceof Ke?this.sw===e.width&&this.sh===e.height:!1}equalTo(e,t){return this.sw===e&&this.sh===t}equalsApprox(e){return B.u(this.sw,e.width)&&B.u(this.sh,e.height)}inflate(e,t){const i=this.width+e;this.sw=i>=0?i:0;const s=this.height+t;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(e){e<0&&r.J(e,">= 0",Ke,"width"),this.sw=e}get height(){return this.sh}set height(e){e<0&&r.J(e,">= 0",Ke,"height"),this.sh=e}isReal(){return isFinite(this.width)&&isFinite(this.height)}static l(){const e=Ke.IL.pop();return e===void 0?new Ke:e}static i(e){Ke.IL.push(e)}};y(Ke,"bc",new Ke(0,0).kt()),y(Ke,"TP",new Ke(1,1).kt()),y(Ke,"RL",new Ke(6,6).kt()),y(Ke,"Su",new Ke(8,8).kt()),y(Ke,"OL",new Ke(10,10).kt()),y(Ke,"DP",new Ke(1/0,1/0).kt()),y(Ke,"Zw",new Ke(NaN,NaN).kt()),y(Ke,"IL",[]);let _=Ke;const gi=class gi{constructor(e,t,i,s){y(this,"rx");y(this,"ry");y(this,"rw");y(this,"rh");y(this,"f");if(e===void 0)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.rx=e,this.ry=t,this.rw=i,this.rh=s;else if(e instanceof L){const n=e.x,o=e.y;if(t instanceof L){const a=t.x,l=t.y;this.rx=Math.min(n,a),this.ry=Math.min(o,l),this.rw=Math.abs(n-a),this.rh=Math.abs(o-l)}else t instanceof _?(this.rx=n,this.ry=o,this.rw=t.width,this.rh=t.height):r.o("Incorrect second argument supplied to Rect constructor "+t)}else r.o("Invalid arguments to Rect constructor: "+e+", "+t+", "+i+", "+s);this.f=!1}h(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}e(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}jn(e,t){return this.rw=e,this.rh=t,this}setTo(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}set(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}setPoint(e){return this.rx=e.x,this.ry=e.y,this}setSize(e){return this.rw=e.width,this.rh=e.height,this}copy(){const e=new gi;return e.rx=this.rx,e.ry=this.ry,e.rw=this.rw,e.rh=this.rh,e}kt(){return this.f=!0,Object.freeze(this),this}N(){return this.f||Object.isFrozen(this)?this:this.copy().k()}k(){return this.f||(this.f=!0),this}ce(){return this.f&&(Object.isFrozen(this)&&r.o("cannot thaw constant: "+this),this.f=!1),this}Jw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n&&(o=parseFloat(n));let a=0;for(;t[i]==="";)i++;n=t[i++],n&&(a=parseFloat(n));let l=0;for(;t[i]==="";)i++;return n=t[i++],n&&(l=parseFloat(n)),new gi(s,o,a,l)}else return new gi}static stringify(e){return e.x.toString()+" "+e.y.toString()+" "+e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(e){return e instanceof gi?this.rx===e.x&&this.ry===e.y&&this.rw===e.width&&this.rh===e.height:!1}equalTo(e,t,i,s){return this.rx===e&&this.ry===t&&this.rw===i&&this.rh===s}equalsApprox(e){return B.u(this.rx,e.x)&&B.u(this.ry,e.y)&&B.u(this.rw,e.width)&&B.u(this.rh,e.height)}equalsApproxTo(e,t,i,s){return B.u(this.rx,e)&&B.u(this.ry,t)&&B.u(this.rw,i)&&B.u(this.rh,s)}equalsApproxClose(e){return B.X(this.rx,e.x)&&B.X(this.ry,e.y)&&B.X(this.rw,e.width)&&B.X(this.rh,e.height)}containsPoint(e){return this.rx<=e.x&&this.rx+this.rw>=e.x&&this.ry<=e.y&&this.ry+this.rh>=e.y}containsRect(e){return this.rx<=e.x&&e.x+e.width<=this.rx+this.rw&&this.ry<=e.y&&e.y+e.height<=this.ry+this.rh}contains(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.rx<=e&&e+i<=this.rx+this.rw&&this.ry<=t&&t+s<=this.ry+this.rh}offset(e,t){return this.rx+=e,this.ry+=t,this}inflate(e,t){return this.Qw(t,e,t,e)}addMargin(e){return this.Qw(e.top,e.right,e.bottom,e.left)}subtractMargin(e){return this.Qw(-e.top,-e.right,-e.bottom,-e.left)}grow(e,t,i,s){return this.Qw(e,t,i,s)}Qw(e,t,i,s){const n=this.rw;t+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=t+s);const o=this.rh;return e+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=e,this.rh+=e+i),this}intersectRect(e){return this.EL(e.x,e.y,e.width,e.height)}intersect(e,t,i,s){return this.EL(e,t,i,s)}EL(e,t,i,s){const n=Math.max(this.rx,e),o=Math.max(this.ry,t),a=Math.min(this.rx+this.rw,e+i),l=Math.min(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,a-n),this.rh=Math.max(0,l-o),this}intersectsRect(e){return this.intersects(e.x,e.y,e.width,e.height)}intersects(e,t,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=e,isNaN(i)||isNaN(n)||o>i||e>n))return!1;let a=this.rh;const l=this.ry;return!(a!==1/0&&s!==1/0&&(a+=l,s+=t,isNaN(s)||isNaN(a)||l>s||t>a))}UL(e,t){let i=this.rw,s=e.width+t+t;const n=this.rx,o=e.x-t;if(i+=n,s+=o,n>s||o>i)return!1;let a=this.rh,l=e.height+t+t;const h=this.ry,d=e.y-t;return a+=h,l+=d,!(h>l||d>a)}unionPoint(e){return this.re(e.x,e.y,0,0)}unionRect(e){return this.re(e.rx,e.ry,e.rw,e.rh)}union(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.re(e,t,i,s)}re(e,t,i,s){const n=Math.min(this.rx,e),o=Math.min(this.ry,t),a=Math.max(this.rx+this.rw,e+i),l=Math.max(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=a-n,this.rh=l-o,this}setSpot(e,t,i){return this.rx=e-i.offsetX-i.x*this.rw,this.ry=t-i.offsetY-i.y*this.rh,this}nearestSideDirection(e,t){return B._w(this,e,t,!0)}nearestSideDirectionPoint(e){return B._w(this,e.x,e.y,!0)}static contains(e,t,i,s,n,o,a,l){return a===void 0&&(a=0),l===void 0&&(l=0),e<=n&&n+a<=e+i&&t<=o&&o+l<=t+s}static intersects(e,t,i,s,n,o,a,l){let h=i,d=a;const f=e,m=n;if(h+=f,d+=m,f>d||m>h)return!1;let p=s,b=l;const x=t,v=o;return p+=x,b+=v,!(x>b||v>p)}static intersectsLineSegment(e,t,i,s,n,o,a,l){return B.VL(e,t,i,s,n,o,a,l)}get x(){return this.rx}set x(e){this.rx=e}get y(){return this.ry}set y(e){this.ry=e}get width(){return this.rw}set width(e){e<0&&r.J(e,">= 0",gi,"width"),this.rw=e}get height(){return this.rh}set height(e){e<0&&r.J(e,">= 0",gi,"height"),this.rh=e}get left(){return this.rx}set left(e){this.rx=e}get top(){return this.ry}set top(e){this.ry=e}get right(){return this.rx+this.rw}set right(e){this.rx+=e-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(e){this.ry+=e-(this.ry+this.rh)}get position(){return new L(this.rx,this.ry)}set position(e){this.rx=e.x,this.ry=e.y}get size(){return new _(this.rw,this.rh)}set size(e){this.rw=e.width,this.rh=e.height}get center(){return new L(this.rx+this.rw/2,this.ry+this.rh/2)}set center(e){this.rx=e.x-this.rw/2,this.ry=e.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(e){this.rx=e-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(e){this.ry=e-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static l(){const e=gi.tx.pop();return e===void 0?new gi:e}static bs(e){const t=gi.tx.pop();return t===void 0?e.copy():t.h(e)}static z(e,t,i,s){const n=gi.tx.pop();return n===void 0?new gi(e,t,i,s):n.e(e,t,i,s)}static i(e){gi.tx.push(e)}};y(gi,"em",new gi(0,0,0,0).kt()),y(gi,"GF",new gi(NaN,NaN,NaN,NaN).kt()),y(gi,"tx",[]);let Y=gi;const Xi=class Xi{constructor(e,t,i,s){y(this,"mt");y(this,"mr");y(this,"mb");y(this,"ml");e===void 0?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):t===void 0?(t=e,i=e,s=e,this.mt=e,this.mr=t,this.mb=i,this.ml=s):i===void 0?(i=e,s=t,this.mt=e,this.mr=t,this.mb=i,this.ml=s):s!==void 0?(this.mt=e,this.mr=t,this.mb=i,this.ml=s):r.o("Invalid arguments to Margin constructor: "+e+", "+t+", "+i+", "+s)}setTo(e,t,i,s){return this.mt=e,this.mr=t,this.mb=i,this.ml=s,this}set(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}copy(){const e=new Xi;return e.mt=this.mt,e.mr=this.mr,e.mb=this.mb,e.ml=this.ml,e}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=NaN;for(;t[i]==="";)i++;let n=t[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new Xi;let o=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(o=parseFloat(n)),isNaN(o))return new Xi(s);let a=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(a=parseFloat(n)),isNaN(a))return new Xi(s,o);let l=NaN;for(;t[i]==="";)i++;return n=t[i++],n&&(l=parseFloat(n)),isNaN(l)?new Xi(s,o):new Xi(s,o,a,l)}else return new Xi}static stringify(e){return e.top.toString()+" "+e.right.toString()+" "+e.bottom.toString()+" "+e.left.toString()}static stringifyFixed(e){return t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(e){return e instanceof Xi?this.mt===e.top&&this.mr===e.right&&this.mb===e.bottom&&this.ml===e.left:!1}equalTo(e,t,i,s){return this.mt===e&&this.mr===t&&this.mb===i&&this.ml===s}equalsApprox(e){return B.u(this.mt,e.top)&&B.u(this.mr,e.right)&&B.u(this.mb,e.bottom)&&B.u(this.ml,e.left)}get top(){return this.mt}set top(e){this.mt=e}get right(){return this.mr}set right(e){this.mr=e}get bottom(){return this.mb}set bottom(e){this.mb=e}get left(){return this.ml}set left(e){this.ml=e}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}};y(Xi,"im",new Xi(0,0,0,0).kt()),y(Xi,"BL",new Xi(2,2,2,2).kt());let ct=Xi;const ut=class ut{constructor(e,t,i,s){y(this,"sx");y(this,"sy");y(this,"ox");y(this,"oy");e===void 0?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=0),this.sx=e,this.sy=t,this.ox=i,this.oy=s)}setTo(e,t,i,s){return this.sx=e,this.sy=t,this.ox=i,this.oy=s,this}set(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}copy(){const e=new ut;return e.sx=this.sx,e.sy=this.sy,e.ox=this.ox,e.oy=this.oy,e}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(e){}Hi(e){return this.sx=NaN,this.sy=NaN,this.ox=e,this.kt()}DU(e,t){(isNaN(e)||e>1||e<0)&&r.J(e,"0 <= "+t+" <= 1",ut,t)}vU(e,t){(isNaN(e)||e===1/0||e===-1/0)&&r.J(e,"real number, not NaN or Infinity",ut,t)}static parse(e){if(typeof e=="string"){if(e=e.trim(),e==="None")return ut.None;if(e==="TopLeft")return ut.TopLeft;if(e==="Top"||e==="TopCenter"||e==="MiddleTop")return ut.TopCenter;if(e==="TopRight")return ut.TopRight;if(e==="Left"||e==="LeftCenter"||e==="MiddleLeft")return ut.LeftCenter;if(e==="Center")return ut.Center;if(e==="Right"||e==="RightCenter"||e==="MiddleRight")return ut.RightCenter;if(e==="BottomLeft")return ut.BottomLeft;if(e==="Bottom"||e==="BottomCenter"||e==="MiddleBottom")return ut.BottomCenter;if(e==="BottomRight")return ut.BottomRight;if(e==="TopSide")return ut.TopSide;if(e==="LeftSide")return ut.LeftSide;if(e==="RightSide")return ut.RightSide;if(e==="BottomSide")return ut.BottomSide;if(e==="TopBottomSides")return ut.TopBottomSides;if(e==="LeftRightSides")return ut.LeftRightSides;if(e==="TopLeftSides")return ut.TopLeftSides;if(e==="TopRightSides")return ut.TopRightSides;if(e==="BottomLeftSides")return ut.BottomLeftSides;if(e==="BottomRightSides")return ut.BottomRightSides;if(e==="NotTopSide")return ut.NotTopSide;if(e==="NotLeftSide")return ut.NotLeftSide;if(e==="NotRightSide")return ut.NotRightSide;if(e==="NotBottomSide")return ut.NotBottomSide;if(e==="AllSides")return ut.AllSides;if(e==="Default")return ut.Default;const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let a=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(a=parseFloat(n));let l=0;for(;t[i]==="";)i++;return n=t[i++],n!==void 0&&n.length>0&&(l=parseFloat(n)),new ut(s,o,a,l)}else return new ut}static stringify(e){return e.isSpot()?e.x.toString()+" "+e.y.toString()+" "+e.offsetX.toString()+" "+e.offsetY.toString():e.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?this.ox===0&&this.oy===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(ut.None)?"None":this.equals(ut.TopLeft)?"TopLeft":this.equals(ut.TopCenter)?"Top":this.equals(ut.TopRight)?"TopRight":this.equals(ut.LeftCenter)?"Left":this.equals(ut.Center)?"Center":this.equals(ut.RightCenter)?"Right":this.equals(ut.BottomLeft)?"BottomLeft":this.equals(ut.BottomCenter)?"Bottom":this.equals(ut.BottomRight)?"BottomRight":this.equals(ut.TopSide)?"TopSide":this.equals(ut.LeftSide)?"LeftSide":this.equals(ut.RightSide)?"RightSide":this.equals(ut.BottomSide)?"BottomSide":this.equals(ut.TopBottomSides)?"TopBottomSides":this.equals(ut.LeftRightSides)?"LeftRightSides":this.equals(ut.TopLeftSides)?"TopLeftSides":this.equals(ut.TopRightSides)?"TopRightSides":this.equals(ut.BottomLeftSides)?"BottomLeftSides":this.equals(ut.BottomRightSides)?"BottomRightSides":this.equals(ut.NotTopSide)?"NotTopSide":this.equals(ut.NotLeftSide)?"NotLeftSide":this.equals(ut.NotRightSide)?"NotRightSide":this.equals(ut.NotBottomSide)?"NotBottomSide":this.equals(ut.AllSides)?"AllSides":this.equals(ut.Default)?"Default":"None"}equals(e){return e instanceof ut?(this.sx===e.x||isNaN(this.sx)&&isNaN(e.x))&&(this.sy===e.y||isNaN(this.sy)&&isNaN(e.y))&&this.ox===e.offsetX&&this.oy===e.offsetY:!1}opposite(){return new ut(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(e){if(!this.isSide())return!1;if(!e.isSide())if(e.equals(ut.Left))e=ut.LeftSide;else if(e.equals(ut.Right))e=ut.RightSide;else if(e.equals(ut.Top))e=ut.TopSide;else if(e.equals(ut.Bottom))e=ut.BottomSide;else return!1;const t=this.oy,i=e.offsetY;return(t&i)===i}get x(){return this.sx}set x(e){this.sx=e}get y(){return this.sy}set y(e){this.sy=e}get offsetX(){return this.ox}set offsetX(e){this.ox=e}get offsetY(){return this.oy}set offsetY(e){this.oy=e}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}};y(ut,"None",new ut(0,0,0,0).Hi(0)),y(ut,"Default",new ut(0,0,-1,0).Hi(-1)),y(ut,"TopLeft",new ut(0,0,0,0).kt()),y(ut,"TopCenter",new ut(.5,0,0,0).kt()),y(ut,"TopRight",new ut(1,0,0,0).kt()),y(ut,"LeftCenter",new ut(0,.5,0,0).kt()),y(ut,"Center",new ut(.5,.5,0,0).kt()),y(ut,"RightCenter",new ut(1,.5,0,0).kt()),y(ut,"BottomLeft",new ut(0,1,0,0).kt()),y(ut,"BottomCenter",new ut(.5,1,0,0).kt()),y(ut,"BottomRight",new ut(1,1,0,0).kt()),y(ut,"MiddleTop",ut.TopCenter),y(ut,"MiddleLeft",ut.LeftCenter),y(ut,"MiddleRight",ut.RightCenter),y(ut,"MiddleBottom",ut.BottomCenter),y(ut,"Top",ut.TopCenter),y(ut,"Left",ut.LeftCenter),y(ut,"Right",ut.RightCenter),y(ut,"Bottom",ut.BottomCenter),y(ut,"TopSide",new ut(0,0,1,1).Hi(1)),y(ut,"LeftSide",new ut(0,0,1,2).Hi(1)),y(ut,"RightSide",new ut(0,0,1,4).Hi(1)),y(ut,"BottomSide",new ut(0,0,1,8).Hi(1)),y(ut,"TopBottomSides",new ut(0,0,1,9).Hi(1)),y(ut,"LeftRightSides",new ut(0,0,1,6).Hi(1)),y(ut,"TopLeftSides",new ut(0,0,1,3).Hi(1)),y(ut,"TopRightSides",new ut(0,0,1,5).Hi(1)),y(ut,"BottomLeftSides",new ut(0,0,1,10).Hi(1)),y(ut,"BottomRightSides",new ut(0,0,1,12).Hi(1)),y(ut,"NotTopSide",new ut(0,0,1,14).Hi(1)),y(ut,"NotLeftSide",new ut(0,0,1,13).Hi(1)),y(ut,"NotRightSide",new ut(0,0,1,11).Hi(1)),y(ut,"NotBottomSide",new ut(0,0,1,7).Hi(1)),y(ut,"AllSides",new ut(0,0,1,15).Hi(1)),y(ut,"vP",new ut(.156,.156).kt()),y(ut,"FP",new ut(.844,.844).kt());let X=ut;const Sn=class Sn{constructor(){y(this,"m11");y(this,"m12");y(this,"m21");y(this,"m22");y(this,"dx");y(this,"dy");this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(e){return this.m11=e.m11,this.m12=e.m12,this.m21=e.m21,this.m22=e.m22,this.dx=e.dx,this.dy=e.dy,this}setTo(e,t,i,s,n,o){return this.m11=e,this.m12=t,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const e=new Sn;return e.m11=this.m11,e.m12=this.m12,e.m21=this.m21,e.m22=this.m22,e.dx=this.dx,e.dy=this.dy,e}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(e){return this.m11===e.m11&&this.m12===e.m12&&this.m21===e.m21&&this.m22===e.m22&&this.dx===e.dx&&this.dy===e.dy}RP(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ue(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}kc(e){const t=this.m11*e.m11+this.m21*e.m12,i=this.m12*e.m11+this.m22*e.m12,s=this.m11*e.m21+this.m21*e.m22,n=this.m12*e.m21+this.m22*e.m22;return this.dx=this.m11*e.dx+this.m21*e.dy+this.dx,this.dy=this.m12*e.dx+this.m22*e.dy+this.dy,this.m11=t,this.m12=i,this.m21=s,this.m22=n,this}zL(e){const t=1/(e.m11*e.m22-e.m12*e.m21),i=e.m22*t,s=-e.m12*t,n=-e.m21*t,o=e.m11*t,a=t*(e.m21*e.dy-e.m22*e.dx),l=t*(e.m12*e.dx-e.m11*e.dy),h=this.m11*i+this.m21*s,d=this.m12*i+this.m22*s,f=this.m11*n+this.m21*o,m=this.m12*n+this.m22*o;return this.dx=this.m11*a+this.m21*l+this.dx,this.dy=this.m12*a+this.m22*l+this.dy,this.m11=h,this.m12=d,this.m21=f,this.m22=m,this}ex(){const e=1/(this.m11*this.m22-this.m12*this.m21),t=this.m22*e,i=-this.m12*e,s=-this.m21*e,n=this.m11*e,o=e*(this.m21*this.dy-this.m22*this.dx),a=e*(this.m12*this.dx-this.m11*this.dy);return this.m11=t,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=a,this}ks(e,t,i){if(e=B.Ee(e),e===0)return this;this.Gs(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const d=e*Math.PI/180;s=Math.cos(d),n=Math.sin(d)}const o=this.m11*s+this.m21*n,a=this.m12*s+this.m22*n,l=this.m11*-n+this.m21*s,h=this.m12*-n+this.m22*s;return this.m11=o,this.m12=a,this.m21=l,this.m22=h,this.Gs(-t,-i),this}Gs(e,t){return this.dx+=this.m11*e+this.m21*t,this.dy+=this.m12*e+this.m22*t,this}it(e,t){return t===void 0&&(t=e),this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}YF(){if(this.m11===1&&this.m12===0)return 0;let e=Math.atan2(this.m12,this.m11)*180/Math.PI;return e<0&&(e+=360),e}gt(e){const t=e.x,i=e.y;return e.e(t*this.m11+i*this.m21+this.dx,t*this.m12+i*this.m22+this.dy)}Ci(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,a=e.x-this.dx,l=e.y-this.dy;return e.e(a*i+l*n,a*s+l*o)}Mu(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,a=t*(this.m21*this.dy-this.m22*this.dx),l=t*(this.m12*this.dx-this.m11*this.dy),h=e.x*1.25,d=e.y*1.2;return e.e(h*i+d*n+a,h*s+d*o+l)}sm(e){const t=e.x,i=e.y,s=t+e.width,n=i+e.height,o=this.m11,a=this.m12,l=this.m21,h=this.m22,d=this.dx,f=this.dy,m=t*o+i*l+d,p=t*a+i*h+f,b=s*o+i*l+d,x=s*a+i*h+f,v=t*o+n*l+d,S=t*a+n*h+f,P=s*o+n*l+d,T=s*a+n*h+f;let A=m,C=m,O=p,R=p;return A=Math.min(A,b),C=Math.max(C,b),O=Math.min(O,x),R=Math.max(R,x),A=Math.min(A,v),C=Math.max(C,v),O=Math.min(O,S),R=Math.max(R,S),A=Math.min(A,P),C=Math.max(C,P),O=Math.min(O,T),R=Math.max(R,T),e.e(A,O,C-A,R-O),e}static l(){const e=Sn.XL.pop();return e===void 0?new Sn:e}static i(e){Sn.XL.push(e)}};y(Sn,"XL",[]),y(Sn,"OP","54a702f3e53909c447824c6706603faf4c");let lt=Sn;const B={KF:"7da71ca0ad381e90",qn:4*((Math.sqrt(2)-1)/3),GL:[],ix:M=>{if(M<=0)return 0;let e=B.GL;if(e===null){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);B.GL=e}if(M<1){const t=1/M;return t<=2e3?1/e[t|0]:Math.sqrt(M)}else return M<=2e3?e[M|0]:Math.sqrt(M)},u:(M,e)=>{const t=M-e;return t<.5&&t>-.5},X:(M,e)=>{const t=M-e;return t<5e-8&&t>-5e-8},Ve:(M,e,t,i,s,n,o)=>{s<=0&&(s=1e-6);let a=0,l=0,h=0,d=0;if(M<t?(l=M,a=t):(l=t,a=M),e<i?(d=e,h=i):(d=i,h=e),M===t)return d<=o&&o<=h&&M-s<=n&&n<=M+s;if(e===i)return l<=n&&n<=a&&e-s<=o&&o<=e+s;const f=a+s,m=l-s;if(m<=n&&n<=f){const p=h+s,b=d-s;if(b<=o&&o<=p)if(f-m>p-b)if(M-t>s||t-M>s){const x=(i-e)/(t-M)*(n-M)+e;if(x-s<=o&&o<=x+s)return!0}else return!0;else if(e-i>s||i-e>s){const x=(t-M)/(i-e)*(o-e)+M;if(x-s<=n&&n<=x+s)return!0}else return!0}return!1},nx:(M,e,t,i,s,n,o,a,l,h,d,f)=>{if(!B.Ve(M,e,o,a,f,t,i)||!B.Ve(M,e,o,a,f,s,n)){const m=(M+t)/2,p=(e+i)/2,b=(t+s)/2,x=(i+n)/2,v=(s+o)/2,S=(n+a)/2,P=(m+b)/2,T=(p+x)/2,A=(b+v)/2,C=(x+S)/2,O=(P+A)/2,R=(T+C)/2;return B.nx(M,e,m,p,P,T,O,R,l,h,d,f)||B.nx(O,R,A,C,v,S,o,a,l,h,d,f)}else return B.Ve(M,e,o,a,f,h,d)},YL:(M,e,t,i,s,n,o,a,l)=>{const h=(M+t)/2,d=(e+i)/2,f=(t+s)/2,m=(i+n)/2,p=(s+o)/2,b=(n+a)/2,x=(h+f)/2,v=(d+m)/2,S=(f+p)/2,P=(m+b)/2;return l.e((x+S)/2,(v+P)/2),l},HF:(M,e,t,i,s,n,o,a)=>{const l=(M+t)/2,h=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(s+o)/2,p=(n+a)/2,b=(l+d)/2,x=(h+f)/2,v=(d+m)/2,S=(f+p)/2;return L.direction(b,x,v,S)},Nu:(M,e,t,i,s,n,o,a,l,h)=>{if(!B.Ve(M,e,o,a,l,t,i)||!B.Ve(M,e,o,a,l,s,n)){const d=(M+t)/2,f=(e+i)/2,m=(t+s)/2,p=(i+n)/2,b=(s+o)/2,x=(n+a)/2,v=(d+m)/2,S=(f+p)/2,P=(m+b)/2,T=(p+x)/2,A=(v+P)/2,C=(S+T)/2;B.Nu(M,e,d,f,v,S,A,C,l,h),B.Nu(A,C,P,T,b,x,o,a,l,h)}else h.re(M,e,0,0),h.re(o,a,0,0);return h},Wn:(M,e,t,i,s,n,o,a,l,h)=>{if(!B.Ve(M,e,o,a,l,t,i)||!B.Ve(M,e,o,a,l,s,n)){const d=(M+t)/2,f=(e+i)/2,m=(t+s)/2,p=(i+n)/2,b=(s+o)/2,x=(n+a)/2,v=(d+m)/2,S=(f+p)/2,P=(m+b)/2,T=(p+x)/2,A=(v+P)/2,C=(S+T)/2;B.Wn(M,e,d,f,v,S,A,C,l,h),B.Wn(A,C,P,T,b,x,o,a,l,h)}else h.length===0&&(h.push(M),h.push(e)),h.push(o),h.push(a);return h},IP:(M,e,t,i,s,n,o,a,l,h)=>{if(B.Ve(M,e,s,n,h,t,i))return B.Ve(M,e,s,n,h,a,l);{const d=(M+t)/2,f=(e+i)/2,m=(t+s)/2,p=(i+n)/2,b=(d+m)/2,x=(f+p)/2;return B.IP(M,e,d,f,b,x,o,a,l,h)||B.IP(b,x,m,p,s,n,o,a,l,h)}},EP:(M,e,t,i,s,n,o,a)=>{if(B.Ve(M,e,s,n,o,t,i))a.re(M,e,0,0),a.re(s,n,0,0);else{const l=(M+t)/2,h=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(l+d)/2,p=(h+f)/2;B.EP(M,e,l,h,m,p,o,a),B.EP(m,p,d,f,s,n,o,a)}return a},nm:(M,e,t,i,s,n,o,a)=>{if(B.Ve(M,e,s,n,o,t,i))a.length===0&&(a.push(M),a.push(e)),a.push(s),a.push(n);else{const l=(M+t)/2,h=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(l+d)/2,p=(h+f)/2;B.nm(M,e,l,h,m,p,o,a),B.nm(m,p,d,f,s,n,o,a)}return a},om:(M,e,t,i,s,n,o,a,l,h,d,f,m,p)=>{if(!B.Ve(M,e,o,a,m,t,i)||!B.Ve(M,e,o,a,m,s,n)){const b=(M+t)/2,x=(e+i)/2,v=(t+s)/2,S=(i+n)/2,P=(s+o)/2,T=(n+a)/2,A=(b+v)/2,C=(x+S)/2,O=(v+P)/2,R=(S+T)/2,I=(A+O)/2,H=(C+R)/2;let V=1/0,z=!1,K=0,$=0;if(B.om(M,e,b,x,A,C,I,H,l,h,d,f,m,p)){const q=(p.x-l)**2+(p.y-h)**2;q<V&&(V=q,z=!0,K=p.x,$=p.y)}if(B.om(I,H,O,R,P,T,o,a,l,h,d,f,m,p)){const q=(p.x-l)**2+(p.y-h)**2;q<V&&(V=q,z=!0,K=p.x,$=p.y)}return z&&(p.x=K,p.y=$),z}else{if(!B.Pu(M,e,o,a,l,h,d,f))return!1;const b=(M-o)*(h-f)-(e-a)*(l-d);if(b===0)return!1;const x=((M*a-e*o)*(l-d)-(M-o)*(l*f-h*d))/b,v=((M*a-e*o)*(h-f)-(e-a)*(l*f-h*d))/b;return p.e(x,v),!0}},rm:(M,e,t,i,s,n,o,a,l,h,d,f,m)=>{let p=0;if(!B.Ve(M,e,o,a,m,t,i)||!B.Ve(M,e,o,a,m,s,n)){const b=(M+t)/2,x=(e+i)/2,v=(t+s)/2,S=(i+n)/2,P=(s+o)/2,T=(n+a)/2,A=(b+v)/2,C=(x+S)/2,O=(v+P)/2,R=(S+T)/2,I=(A+O)/2,H=(C+R)/2;p+=B.rm(M,e,b,x,A,C,I,H,l,h,d,f,m),p+=B.rm(I,H,O,R,P,T,o,a,l,h,d,f,m)}else{const b=(M-o)*(h-f)-(e-a)*(l-d);if(b===0)return p;const x=((M*a-e*o)*(l-d)-(M-o)*(l*f-h*d))/b,v=((M*a-e*o)*(h-f)-(e-a)*(l*f-h*d))/b;if(x>=d)return p;let S=0,P=0;if((l>d?l-d:d-l)<(h>f?h-f:f-h)){if(e<a?(S=e,P=a):(S=a,P=e),v<S||v>P)return p}else if(M<o?(S=M,P=o):(S=o,P=M),x<S||x>P)return p;b>0?p++:b<0&&p--}return p},Nl:(M,e,t,i,s,n,o)=>{if(B.X(M,t)){let a=0,l=0;e<i?(a=e,l=i):(a=i,l=e);const h=n;return h<a?(o.e(M,a),!1):h>l?(o.e(M,l),!1):(o.e(M,h),!0)}else if(B.X(e,i)){let a=0,l=0;M<t?(a=M,l=t):(a=t,l=M);const h=s;return h<a?(o.e(a,e),!1):h>l?(o.e(l,e),!1):(o.e(h,e),!0)}else{const a=(t-M)**2+(i-e)**2,l=((M-s)*(M-t)+(e-n)*(e-i))/a;if(l<-5e-6)return o.e(M,e),!1;if(l>1.000005)return o.e(t,i),!1;{const h=M+l*(t-M),d=e+l*(i-e);return o.e(h,d),!0}}},vo:(M,e,t,i,s,n,o,a,l)=>{if(B.u(M,t)&&B.u(e,i))return l.e(M,e),!1;if(B.X(s,o)){if(B.X(M,t))return B.Nl(M,e,t,i,s,n,l),!1;{const h=(i-e)/(t-M)*(s-M)+e;return B.Nl(M,e,t,i,s,h,l)}}else{const h=(a-n)/(o-s);if(B.X(M,t)){const d=h*(M-s)+n;let f=0,m=0;return e<i?(f=e,m=i):(f=i,m=e),d<f?(l.e(M,f),!1):d>m?(l.e(M,m),!1):(l.e(M,d),!0)}else{const d=(i-e)/(t-M);if(B.X(h,d))return B.Nl(M,e,t,i,s,n,l),!1;{const f=(d*M-h*s+n-e)/(d-h);if(B.X(d,0)){let m=0,p=0;return M<t?(m=M,p=t):(m=t,p=M),f<m?(l.e(m,e),!1):f>p?(l.e(p,e),!1):(l.e(f,e),!0)}else{const m=d*(f-M)+e;return B.Nl(M,e,t,i,f,m,l)}}}}},Cl:(M,e,t,i,s,n,o,a,l)=>{let h=1e21,d=M,f=e;if(B.vo(M,e,M,i,s,n,o,a,l)){const m=(l.x-s)**2+(l.y-n)**2;m<h&&(h=m,d=l.x,f=l.y)}if(B.vo(t,e,t,i,s,n,o,a,l)){const m=(l.x-s)**2+(l.y-n)**2;m<h&&(h=m,d=l.x,f=l.y)}if(B.vo(M,e,t,e,s,n,o,a,l)){const m=(l.x-s)**2+(l.y-n)**2;m<h&&(h=m,d=l.x,f=l.y)}if(B.vo(M,i,t,i,s,n,o,a,l)){const m=(l.x-s)**2+(l.y-n)**2;m<h&&(h=m,d=l.x,f=l.y)}return l.e(d,f),h<1e21},lx:(M,e,t)=>B.VL(M.x,M.y,M.width,M.height,e.x,e.y,t.x,t.y),VL:(M,e,t,i,s,n,o,a)=>{const l=M,h=M+t,d=e,f=e+i;if(s===o){let m=0,p=0;return n<a?(m=n,p=a):(m=a,p=n),l<=s&&s<=h&&m<=f&&p>=d}if(n===a){let m=0,p=0;return s<o?(m=s,p=o):(m=o,p=s),d<=n&&n<=f&&m<=h&&p>=l}return!!(Y.contains(M,e,t,i,s,n)||Y.contains(M,e,t,i,o,a)||B.Pu(l,d,h,d,s,n,o,a)||B.Pu(h,d,h,f,s,n,o,a)||B.Pu(h,f,l,f,s,n,o,a)||B.Pu(l,f,l,d,s,n,o,a))},Pu:(M,e,t,i,s,n,o,a)=>M===t&&e===i&&s===o&&n===a?M===s&&e===n:B.ku(M,e,t,i,s,n)*B.ku(M,e,t,i,o,a)<=0&&B.ku(s,n,o,a,M,e)*B.ku(s,n,o,a,t,i)<=0,ku:(M,e,t,i,s,n)=>{const o=t-M,a=i-e;let l=s-M,h=n-e,d=l*a-h*o;return d===0&&(d=l*o+h*a,d>0&&(l-=o,h-=a,d=l*o+h*a,d<0&&(d=0))),d},_w(M,e,t,i){i===void 0&&(i=!1);let s=0;const n=M===null?e:(e-M.x)/(M.width>0?M.width:1),o=M===null?t:(t-M.y)/(M.height>0?M.height:1);return n>o?n>1-o||(i||n<1-o?s=270:s=315):i||n<o?n>1-o?s=90:i||n<1-o?s=180:s=135:n<.5?s=225:n>.5&&(s=45),s},Ee:M=>(M>=360?M-=360:M<0&&(M+=360),M),jF:(M,e)=>M>e?Math.min(M-e,Math.abs(M-360-e)):e>M?Math.min(e-M,Math.abs(M-(e-360))):0,KL:(M,e,t,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const a=i>s?-1:1,l=1e-5,h=o*2,d=[],f=o/2;let m=i,p=Math.min(h,Math.abs(s-i));if(p<l){const b=m+a*Math.min(p,f),x=M+t*Math.cos(m),v=e+t*Math.sin(m),S=M+t*Math.cos(b),P=e+t*Math.sin(b),T=(x+S)/2,A=(v+P)/2;return d.push([x,v,T,A,T,A,S,P]),d}for(;p>l;){const b=m+a*Math.min(p,f);d.push(B.qF(t,m,b,M,e)),p-=Math.abs(b-m),m=b}return d},qF:(M,e,t,i,s)=>{const n=(t-e)/2,o=M*Math.cos(n),a=M*Math.sin(n),l=o,h=-a,d=l*l+h*h,f=d+l*o+h*a,m=4/3*(Math.sqrt(2*d*f)-f)/(l*a-h*o),p=l-m*h,b=h+m*l,x=p,v=-b,S=n+e,P=Math.cos(S),T=Math.sin(S);return[i+M*Math.cos(e),s+M*Math.sin(e),i+p*P-b*T,s+p*T+b*P,i+x*P-v*T,s+x*T+v*P,i+M*Math.cos(t),s+M*Math.sin(t)]},tm:(M,e,t,i,s,n,o)=>{const a=s,l=n,h=Math.floor((M-t)/a)*a+t,d=Math.floor((e-i)/l)*l+i;let f=h;h+a-M<a/2&&(f=h+a);let m=d;return d+l-e<l/2&&(m=d+l),o.e(f,m),o},HL:(M,e)=>{let t=Math.max(M,e),i=Math.min(M,e),s=1,n=1;do s=t%i,n=i,t=i,i=s;while(s>0);return n},WF:(M,e,t,i)=>{const s=t<0,n=i<0;let o=0,a=0,l=0;M<e?(a=1,l=0):(a=0,l=1);let h=0,d=0,f=0,m=0;return o=a,h=o===0?M:e,f=o===0?t:i,(o===0?s:n)&&(f=-f),o=l,d=o===0?M:e,m=o===0?t:i,(o===0?s:n)&&(m=-m),B.JF(h,d,f,m,0,0)},JF:(M,e,t,i,s,n)=>{let o=0;if(i>0)if(t>0){const a=M*M,l=e*e,h=M*t,d=e*i;let f=-l+d,m=-l+Math.sqrt(h*h+d*d),p=f;const b=9999999999;for(let S=0;S<b&&(p=.5*(f+m),!(p===f||p===m));++S){const P=h/(p+a),T=d/(p+l),A=P*P+T*T-1;if(A>0)f=p;else if(A<0)m=p;else break}s=a*t/(p+a),n=l*i/(p+l);const x=s-t,v=n-i;o=Math.sqrt(x*x+v*v)}else s=0,n=e,o=Math.abs(i-e);else{const a=M*M-e*e,l=M*t;if(l<a){const h=l/a,d=h*h;s=M*h,n=e*Math.sqrt(Math.abs(1-d));const f=s-t;o=Math.sqrt(f*f+n*n)}else s=M,n=0,o=Math.abs(t-M)}return o},Jn:{},lm:new g,yr:new g,wr:0,am:100};B.za=B.KF;var se=(M=>(M[M.Line=1]="Line",M[M.Rectangle=2]="Rectangle",M[M.Ellipse=3]="Ellipse",M[M.Path=4]="Path",M))(se||{}),Yt=(M=>(M[M.None=0]="None",M[M.Default=1]="Default",M[M.Fill=2]="Fill",M[M.Uniform=6]="Uniform",M))(Yt||{});const ci=class ci{constructor(e,t){y(this,"n");y(this,"hm");y(this,"cm");y(this,"Pc");y(this,"Cu");y(this,"Lu");y(this,"$n");y(this,"Zn");y(this,"Qn");y(this,"W");y(this,"Li");y(this,"Ai");y(this,"ni");y(this,"oi");y(this,"Ys");y(this,"Sc");y(this,"Mc");F.Je(this),this.n=2,e===void 0&&(e=4),this.W=e,this.Li=0,this.Ai=0,this.ni=0,this.oi=0,e===4?this.Ys=new E:this.Ys=ci.hx,this.hm=this.Ys.rt,this.cm=new Y,this.Pc=null,this.Cu=null,this.Lu=NaN,this.$n=X.TopLeft,this.Zn=X.BottomRight,this.Sc=NaN,this.Mc=NaN,this.Qn=2,t&&Object.assign(this,t)}copy(){const e=new ci;if(e.n=this.n&-2,e.W=this.W,e.Li=this.Li,e.Ai=this.Ai,e.ni=this.ni,e.oi=this.oi,this.W===4){const t=this.Ys.r,i=e.Ys;for(let s=0;s<t.length;s++){const n=t[s];i.add(n.copy())}e.Ys=i}else e.Ys=this.Ys;return e.hm=this.hm,e.cm.h(this.cm),e.Pc=this.Pc,e.Cu=this.Cu,e.Lu=this.Lu,e.$n=this.$n.N(),e.Zn=this.Zn.N(),e.Sc=this.Sc,e.Mc=this.Mc,e.Qn=this.Qn,e}get f(){return(this.n&1)!==0}set f(e){e?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(e){e?this.n|=2:this.n&=-3}k(){if(this.f=!0,this.type!==4)return this;const e=this.figures;e.k();for(const t of e)t.k();return this}equalsApprox(e){if(!(e instanceof ci))return!1;if(this.type!==e.type)return this.type===1&&e.type===4?this.jL(e):e.type===1&&this.type===4?e.jL(this):!1;if(this.type===4){const t=this.figures.r,i=e.figures.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],a=i[n];if(!o.equalsApprox(a))return!1}return!0}else return B.u(this.startX,e.startX)&&B.u(this.startY,e.startY)&&B.u(this.endX,e.endX)&&B.u(this.endY,e.endY)}jL(e){if(this.type!==1||e.type!==4)return!1;if(e.figures.count===1){const t=e.figures.elt(0);if(t.segments.count===1&&B.u(this.startX,t.startX)&&B.u(this.startY,t.startY)){const i=t.segments.elt(0);if(i.type===2&&B.u(this.endX,i.endX)&&B.u(this.endY,i.endY))return!0}}return!1}static stringify(e){return e.toString()}static stringifyFixed(e){return t=>t.toString(e)}fe(e){e in se?this.type=e:r.dr(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i;switch(this.type){case 1:return e<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.startX)+" "+t(this.startY)+"L"+t(this.endX)+" "+t(this.endY);case 2:return i=new Y(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+t(i.x)+" "+t(i.y)+"H"+t(i.right)+"V"+t(i.bottom)+"H"+t(i.left)+"z";case 3:if(i=new Y(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0){const a=i.left.toString()+" "+(i.y+i.height/2).toString(),l=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+a+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+l+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+a}else{const a=t(i.left)+" "+t(i.y+i.height/2),l=t(i.right)+" "+t(i.y+i.height/2);return"M"+a+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+l+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+a}case 4:let s="";const n=this.figures.r,o=n.length;for(let a=0;a<o;a++){const l=n[a];a>0&&(s+=" x "),l.isFilled&&(s+="F "),s+=l.toString(e)}return s;default:return se[this.type]}}static fillPath(e){const t=e.split(/[Xx]/),i=t.length;let s="";for(let n=0;n<i;n++){const o=t[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static parse(e,t){t===void 0&&(t=!1);const i=new RegExp("(["+ci.fm+"])(["+ci.fm+"])","gm"),s=new RegExp("(["+ci.fm+"])([^s])","gm"),n=new RegExp("([^s])(["+ci.fm+"])","gm");e=e.replace(/,/gm," "),e=e.replace(i,"$1 $2"),e=e.replace(i,"$1 $2"),e=e.replace(s,"$1 $2"),e=e.replace(n,"$1 $2"),e=e.replace(/([0-9])([+\-])/gm,"$1 $2"),e=e.replace(/[\s\r\t\n]+/gm," "),e=e.replace(/^\s+|\s+$/g,"");const o=e.split(" ");for(let K=0;K<o.length;K++){const $=o[K];if($.match(/(\.[0-9]*)(\.)/gm)!==null){const q=r.nt();let J="",ot=!1;for(let rt=0;rt<$.length;rt++){const st=$[rt];st==="."&&!ot?(ot=!0,J+=st):st==="."?(q.push(J),J="."):J+=st}q.push(J),o.splice(K,1);for(let rt=0;rt<q.length;rt++)o.splice(K+rt,0,q[rt]);K+=q.length-1,r.Z(q)}}let a=-1,l="",h="";const d=new L(0,0),f=new L(0,0),m=new L(0,0);let p=!0;function b(){return a>=A-1||o[a+1].match(V)!==null?!0:(p=!1,!1)}function x(){return a++,o[a]}function v(K){let $=parseFloat(x()),q=parseFloat(x());l===l.toLowerCase()&&($=m.x+$,q=m.y+q),K.e($,q)}function S(){return v(m),m}function P(){return v(f),f}function T(){const K=h.toLowerCase();return K==="c"||K==="s"||K==="q"||K==="t"?new L(2*m.x-f.x,2*m.y-f.y):new L(m.x,m.y)}const A=o.length,C=vo.qL(null);let O=!1,R=!1,I=!1,H=!0;const V=new RegExp("["+ci.fm+"]");for(;!(a>=A-1);){if(h=l,l=x(),l==="")continue;p=!0;let K=!1;switch(l.toUpperCase()){case"X":H=!0,O=!1,R=!1;break;case"M":const $=S();for(C.Ne===null||H===!0?(C.Au($.x,$.y,O,!1,!R,I),H=!1):C.$F($.x,$.y),d.h(m);!b();){const q=S();C.Ks(q.x,q.y)}break;case"L":for(;!b();){const q=S();C.Ks(q.x,q.y)}p&&(K=!0);break;case"H":for(;!b();)m.e((l===l.toLowerCase()?m.x:0)+parseFloat(x()),m.y),C.Ks(m.x,m.y);break;case"V":for(;!b();)m.e(m.x,(l===l.toLowerCase()?m.y:0)+parseFloat(x())),C.Ks(m.x,m.y);p&&(K=!0);break;case"C":for(;!b();){const q=new L;v(q);const J=P(),ot=S();C.xr(q.x,q.y,J.x,J.y,ot.x,ot.y)}p&&(K=!0);break;case"S":for(;!b();){const q=T(),J=P(),ot=S();C.xr(q.x,q.y,J.x,J.y,ot.x,ot.y)}p&&(K=!0);break;case"Q":for(;!b();){const q=P(),J=S();C.Tu(q.x,q.y,J.x,J.y)}p&&(K=!0);break;case"T":for(;!b();){const q=T();f.h(q);const J=S();C.Tu(q.x,q.y,J.x,J.y),f.h(J)}p&&(K=!0);break;case"B":for(;!b();){const q=parseFloat(x()),J=parseFloat(x());let ot=parseFloat(x()),rt=parseFloat(x());const st=parseFloat(x());let ht=st,pt=!1;b()||(ht=parseFloat(x()),b()||(pt=parseFloat(x())!==0)),l===l.toLowerCase()&&(ot+=m.x,rt+=m.y),C.ZF(q,J,ot,rt,st,ht,pt)}p&&(K=!0);break;case"A":for(;!b();){const q=Math.abs(parseFloat(x())),J=Math.abs(parseFloat(x())),ot=parseFloat(x());let rt=!1,st=!1,ht=0,pt=0;const zt=x();zt.length===1?(rt=!!parseFloat(zt),st=!!parseFloat(x()),ht=parseFloat(x()),pt=parseFloat(x())):zt.length===2?(rt=!!parseFloat(zt[0]),st=!!parseFloat(zt[1]),ht=parseFloat(x()),pt=parseFloat(x())):(rt=!!parseFloat(zt[0]),st=!!parseFloat(zt[1]),ht=parseFloat(zt.slice(2)),pt=parseFloat(x())),l===l.toLowerCase()&&(ht=m.x+ht,pt=m.y+pt),m.e(ht,pt),C.QF(q,J,ot,rt,st,ht,pt)}p&&(K=!0);break;case"Z":C._F(),m.h(d);break;case"F":{let q="",J=1;for(;o[a+J];){if(o[a+J]==="0"){I=!0,J++;continue}if(o[a+J].match(/[Uu]/)!==null){J++;continue}if(o[a+J].match(V)===null){J++;continue}q=o[a+J];break}q.match(/[Mm]/)?O=!0:C.tR();break}case"U":{let q="",J=1;for(;o[a+J];){if(o[a+J].match(/[Ff]/)!==null){J++;continue}if(o[a+J].match(V)===null){J++;continue}q=o[a+J];break}q.match(/[Mm]/)?R=!0:C.eR(!1);break}default:if(l==="0"||l==="1")break;r.ne("Unknown geometry command: "+l);break}if(K){r.ne(`Bad geometry command: ${l}, next token: ${x()},
string: ${e}`);break}}const z=C.um;if(vo.WL(C),t){const K=z.figures.iterator;for(;K.next();){const $=K.value;$.isFilled=!0}}return z}static JL(e,t){const i=e.length,s=L.l();for(let n=0;n<i;n++){const o=e[n];s.x=o[0],s.y=o[1],t.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],t.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],t.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],t.gt(s),o[6]=s.x,o[7]=s.y}L.i(s)}UP(){if(this.yt)return!0;if(this.type===4){const e=this.figures;if(this.hm!==e.rt)return!0;const t=this.figures.r,i=t.length;for(let s=0;s<i;s++)if(t[s].UP())return!0}return!1}cx(){if(this.yt=!1,this.Pc=null,this.Cu=null,this.Lu=NaN,this.type===4){const t=this.figures;this.hm=t.rt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].iR()}const e=this.cm;isNaN(this.Sc)||isNaN(this.Mc)?e.e(0,0,0,0):e.e(0,0,this.Sc,this.Mc),this.$L(e,!1),e.re(0,0,0,0)}computeBoundsWithoutOrigin(){const e=new Y;return this.$L(e,!0),e}$L(e,t){switch(this.type){case 1:case 2:case 3:t?e.e(this.Li,this.Ai,0,0):e.re(this.Li,this.Ai,0,0),e.re(this.ni,this.oi,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const a=s[o];t&&o===0?e.e(a.startX,a.startY,0,0):e.re(a.startX,a.startY,0,0);const l=a.segments.r,h=l.length;let d=a.startX,f=a.startY;for(let m=0;m<h;m++){const p=l[m];switch(p.type){case 2:case 1:d=p.endX,f=p.endY,e.re(d,f,0,0);break;case 3:B.Nu(d,f,p.point1X,p.point1Y,p.point2X,p.point2Y,p.endX,p.endY,.5,e),d=p.endX,f=p.endY;break;case 4:B.EP(d,f,p.point1X,p.point1Y,p.endX,p.endY,.5,e),d=p.endX,f=p.endY;break;case 5:case 6:const b=p.type===5?p.Fo(a):p.Za(a,d,f),x=b.length;if(x===0){d=p.type===5?p.centerX:p.endX,f=p.type===5?p.centerY:p.endY,e.re(d,f,0,0);break}let v=null;for(let S=0;S<x;S++)v=b[S],B.Nu(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],.5,e);v!==null&&(d=v[6],f=v[7]);break;default:r.o("Unknown Segment type: "+p.type)}}}break;default:r.o("Unknown Geometry type: "+this.type)}}sR(e,t){const i=this.bounds;let s=e/i.width,n=t/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.f&&r.L(this);const e=this.computeBoundsWithoutOrigin();return this.offset(-e.x,-e.y),new L(-e.x,-e.y)}offset(e,t){return this.f&&r.L(this),this.v(1,0,0,1,e,t),this}scale(e,t){return this.f&&r.L(this),this.v(e,0,0,t,0,0),this}rotate(e,t,i){this.f&&r.L(this),t===void 0&&(t=0),i===void 0&&(i=0);const s=lt.l();return s.Ue(),s.ks(e,t,i),this.v(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),lt.i(s),this}v(e,t,i,s,n,o){let a=0,l=0;switch(this.type){case 1:case 2:case 3:a=this.Li,l=this.Ai,this.Li=a*e+l*i+n,this.Ai=a*t+l*s+o,a=this.ni,l=this.oi,this.ni=a*e+l*i+n,this.oi=a*t+l*s+o;break;case 4:const h=this.figures.r,d=h.length;for(let f=0;f<d;f++){const m=h[f];a=m.startX,l=m.startY,m.startX=a*e+l*i+n,m.startY=a*t+l*s+o;const p=m.segments.r,b=p.length;for(let x=0;x<b;x++){const v=p[x];switch(v.type){case 2:case 1:a=v.endX,l=v.endY,v.endX=a*e+l*i+n,v.endY=a*t+l*s+o;break;case 3:a=v.point1X,l=v.point1Y,v.point1X=a*e+l*i+n,v.point1Y=a*t+l*s+o,a=v.point2X,l=v.point2Y,v.point2X=a*e+l*i+n,v.point2Y=a*t+l*s+o,a=v.endX,l=v.endY,v.endX=a*e+l*i+n,v.endY=a*t+l*s+o;break;case 4:a=v.point1X,l=v.point1Y,v.point1X=a*e+l*i+n,v.point1Y=a*t+l*s+o,a=v.endX,l=v.endY,v.endX=a*e+l*i+n,v.endY=a*t+l*s+o;break;case 5:if(a=v.centerX,l=v.centerY,v.centerX=a*e+l*i+n,v.centerY=a*t+l*s+o,t!==0){let S=Math.atan2(t,e)*180/Math.PI;S<0&&(S+=360),v.startAngle+=S}e<0&&(v.startAngle=180-v.startAngle,v.sweepAngle=-v.sweepAngle),s<0&&(v.startAngle=-v.startAngle,v.sweepAngle=-v.sweepAngle),v.radiusX*=Math.sqrt(e*e+i*i),v.radiusY!==void 0&&(v.radiusY*=Math.sqrt(t*t+s*s));break;case 6:if(a=v.endX,l=v.endY,v.endX=a*e+l*i+n,v.endY=a*t+l*s+o,v.radiusX===0||v.radiusY===0)break;if(t!==0){let S=Math.atan2(t,e)*180/Math.PI;S<0&&(S+=360),v.xAxisRotation+=S}e<0&&(v.xAxisRotation=180-v.xAxisRotation,v.isClockwiseArc=!v.isClockwiseArc),s<0&&(v.xAxisRotation=-v.xAxisRotation,v.isClockwiseArc=!v.isClockwiseArc),v.radiusX*=Math.sqrt(e*e+i*i),v.radiusY*=Math.sqrt(t*t+s*s);break;default:r.o("Unknown Segment type: "+v.type)}}}break}return this.yt=!0,this}containsPoint(e,t){t===void 0&&(t=0);const i=this.Li,s=this.Ai,n=this.ni,o=this.oi;switch(this.type){case 1:return B.Ve(i,s,n,o,t,e.x,e.y);case 2:{const a=Math.min(i,n)-t,l=Math.min(s,o)-t,h=Math.abs(n-i)+t*2,d=Math.abs(o-s)+t*2,f=Y.z(a,l,h,d),m=f.containsPoint(e);return Y.i(f),m}case 3:{let a=Math.min(i,n)-t,l=Math.min(s,o)-t;const h=Math.abs(n-i)+t*2,d=Math.abs(o-s)+t*2,f=h/2,m=d/2;return f<=0||m<=0?!1:(a=e.x-(a+f),l=e.y-(l+m),a*a/(f*f)+l*l/(m*m)<=1)}case 4:return this.VP(e,t,!0,!1);default:return!1}}VP(e,t,i,s){const n=e.x,o=e.y,a=this.bounds.x-20,l=o;let h=0,d=0,f=0,m=0,p=0,b=0;const x=this.figures.r,v=x.length;for(let S=0;S<v;S++){const P=x[S],T=!P.isEvenOdd;if(P.isFilled){if(i&&P.BP(n,o,t))return!0}else{if(P.BP(n,o,s?t:t+2))return!0;continue}const A=P.segments;d=P.startX,f=P.startY;let C=d,O=f;const R=A.r;let I=R[0];for(let H=0;H<=A.length;H++){let V;switch(H!==A.length?(I=R[H],V=I.type,p=I.endX,b=I.endY):(V=2,p=C,b=O),V){case 1:{const z=this.fx(n,o,a,l,d,f,C,O);if(isNaN(z))return!0;h+=z,C=p,O=b;break}case 2:{const z=this.fx(n,o,a,l,d,f,p,b);if(isNaN(z))return!0;h+=z;break}case 3:m=B.rm(d,f,I.point1X,I.point1Y,I.point2X,I.point2Y,p,b,a,l,n,o,.5),h+=m;break;case 4:{const z=(d+2*I.point1X)/3,K=(f+2*I.point1Y)/3,$=(I.point1X*2+p)/3,q=(I.point1Y*2+b)/3;m=B.rm(d,f,z,K,$,q,p,b,a,l,n,o,.5),h+=m;break}case 5:case 6:{const z=I.type===5?I.Fo(P):I.Za(P,d,f),K=z.length;if(K===0){const q=this.fx(n,o,a,l,d,f,I.type===5?I.centerX:I.endX,I.type===5?I.centerY:I.endY);if(isNaN(q))return!0;h+=q;break}let $=null;for(let q=0;q<K;q++){if($=z[q],q===0){const J=this.fx(n,o,a,l,d,f,$[0],$[1]);if(isNaN(J))return!0;h+=J}m=B.rm($[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],a,l,n,o,.5),h+=m}$!==null&&(p=$[6],b=$[7]);break}default:r.o("Unknown Segment type: "+I.type)}d=p,f=b}if(T){if(h!==0)return!0}else if(h%2!==0)return!0;h=0}return!1}fx(e,t,i,s,n,o,a,l){if(B.Ve(n,o,a,l,.05,e,t))return NaN;const h=(e-i)*(o-l);if(h===0)return 0;const d=((e*s-t*i)*(n-a)-(e-i)*(n*l-o*a))/h,f=(e*s-t*i)*(o-l)/h;if(d>=e)return 0;if((n>a?n-a:a-n)<(o>l?o-l:l-o)){if(o<l){if(f<o||f>l)return 0}else if(f<l||f>o)return 0}else if(n<a){if(d<n||d>a)return 0}else if(d<a||d>n)return 0;return h>0?1:-1}ZL(e,t,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].BP(e,t,i))return!0;return!1}getPointAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=new L),this.type===1)return t.e(this.startX+e*(this.endX-this.startX),this.startY+e*(this.endY-this.startY)),t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,a=n*e;let l=0;for(let h=0;h<o;h++){const d=s[h],f=d.length;for(let m=0;m<f;m++){const p=d[m];if(l+p>=a){const b=a-l,x=p===0?0:b/p,v=i[h],S=v[m*2],P=v[m*2+1],T=v[m*2+2],A=v[m*2+3];return t.e(S+(T-S)*x,P+(A-P)*x),t}l+=p}}return t}getAngleAlongPath(e){if(e<0?e=0:e>1&&(e=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=t.length,o=s*e;let a=0;for(let l=0;l<n;l++){const h=i[l],d=h.length;for(let f=0;f<d;f++){const m=h[f];if(a+m>=o){const p=t[l],b=p[f*2],x=p[f*2+1],v=p[f*2+2],S=p[f*2+3];return Math.abs(v-b)<1&&Math.abs(S-x)<1?0:Math.abs(v-b)<1?S-x>=0?90:270:Math.abs(S-x)<1?v-b>=0?0:180:Math.atan2(S-x,v-b)*180/Math.PI}a+=m}}return NaN}getPointAndAngleAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=[]),t.length=3,this.type===1)return t[0]=this.startX+e*(this.endX-this.startX),t[1]=this.startY+e*(this.endY-this.startY),t[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,a=n*e;let l=0;for(let h=0;h<o;h++){const d=s[h],f=d.length;for(let m=0;m<f;m++){const p=d[m];if(l+p>=a){const b=a-l,x=p===0?0:b/p,v=i[h],S=v[m*2],P=v[m*2+1],T=v[m*2+2],A=v[m*2+3];t[0]=S+(T-S)*x,t[1]=P+(A-P)*x;let C;return Math.abs(T-S)<1&&Math.abs(A-P)<1?C=0:Math.abs(T-S)<1?C=A-P>=0?90:270:Math.abs(A-P)<1?C=T-S>=0?0:180:C=Math.atan2(A-P,T-S)*180/Math.PI,t[2]=C,t}l+=p}}return t}getFractionForPoint(e){if(this.type===1){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=e.x,a=e.y;let l=0,h=0;if(t===s)return i<n?(l=i,h=n):(l=n,h=i),a<=l?l===i?0:1:a>=h?h===i?0:1:Math.abs(a-i)/(h-l);if(i===n)return t<s?(l=t,h=s):(l=s,h=t),o<=l?l===t?0:1:o>=h?h===t?0:1:Math.abs(o-t)/(h-l);{const d=(s-t)**2+(n-i)**2,f=L.l();B.Nl(t,i,s,n,o,a,f);const m=f.x,p=f.y;return L.i(f),Math.sqrt(((m-t)**2+(p-i)**2)/d)}}}else if(this.type===2){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=s-t,a=n-i,l=o*2+a*2;let h=e.x,d=e.y;h=Math.min(Math.max(h,t),s),d=Math.min(Math.max(d,i),n);const f=Math.abs(h-t),m=Math.abs(h-s),p=Math.abs(d-i),b=Math.abs(d-n),x=Math.min(f,m,p,b);if(x===p)return h/l;if(x===m)return(o+d)/l;if(x===b)return(o*2+a-h)/l;if(x===f)return(o*2+a*2-d)/l}}else{const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=L.l();let o=1/0,a=0,l=0;const h=t.length;let d=0,f=0;for(let p=0;p<h;p++){const b=t[p],x=i[p],v=b.length;for(let S=0;S<v;S+=2){const P=b[S],T=b[S+1];if(S===0){d=P,f=T;continue}B.Nl(d,f,P,T,e.x,e.y,n);const A=(n.x-e.x)**2+(n.y-e.y)**2;A<o&&(o=A,a=l,a+=Math.sqrt((n.x-d)**2+(n.y-f)**2)),l+=x[(S-2)/2],d=P,f=T}}L.i(n);const m=a/s;return m<0?0:m>1?1:m}return 0}get flattenedSegments(){return this.QL(),this.Pc}QL(){if(this.Pc===null){const e=this.Pc=[],t=this.Cu=[];this.nR(e,t)}}get flattenedLengths(){return this.QL(),this.Cu}get flattenedTotalLength(){let e=this.Lu;if(isNaN(e)){if(this.type===1){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(this.type===2){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=t*2+i*2}else{const t=this.flattenedLengths,i=t.length;e=0;for(let s=0;s<i;s++){const n=t[s],o=n.length;for(let a=0;a<o;a++)e+=n[a]}}this.Lu=e}return e}zP(e){const t=[];let i=0,s=0;const n=e.length;for(let o=0;o<n;o+=2){const a=e[o],l=e[o+1];if(o===0){i=a,s=l;continue}const h=Math.sqrt(L.distanceSquared(i,s,a,l));t.push(h),i=a,s=l}return t}nR(e,t){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),e.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),t.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),e.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),t.push(s);else if(this.type===3){const n=new Z;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new et(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const a=o.Fo(n),l=a.length;if(l===0)i.push(o.centerX),i.push(o.centerY);else{let h=n.startX,d=n.startY;for(let f=0;f<l;f++){const m=a[f];B.Wn(h,d,m[2],m[3],m[4],m[5],m[6],m[7],.5,i),h=m[6],d=m[7]}}e.push(i),t.push(this.zP(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let a=o.startX,l=o.startY,h=a,d=l;const f=o.segments.r,m=f.length;for(let p=0;p<m;p++){const b=f[p];switch(b.type){case 1:i.length>=4&&(e.push(i),t.push(this.zP(i))),i=[],i.push(b.endX),i.push(b.endY),a=b.endX,l=b.endY,h=a,d=l;break;case 2:i.push(b.endX),i.push(b.endY),a=b.endX,l=b.endY;break;case 3:B.Wn(a,l,b.point1X,b.point1Y,b.point2X,b.point2Y,b.endX,b.endY,.5,i),a=b.endX,l=b.endY;break;case 4:B.nm(a,l,b.point1X,b.point1Y,b.endX,b.endY,.5,i),a=b.endX,l=b.endY;break;case 5:{const x=b.Fo(o),v=x.length;if(v===0){i.push(b.centerX),i.push(b.centerY),a=b.centerX,l=b.centerY;break}for(let S=0;S<v;S++){const P=x[S];B.Wn(a,l,P[2],P[3],P[4],P[5],P[6],P[7],.5,i),a=P[6],l=P[7]}break}case 6:{const x=b.Za(o,a,l),v=x.length,S=b.endX,P=b.endY;if(v===0){i.push(S),i.push(P),a=S,l=P;break}for(let T=0;T<v;T++){const A=x[T];B.Wn(a,l,A[2],A[3],A[4],A[5],A[6],A[7],.5,i),a=A[6],l=A[7]}break}default:r.o("Segment not of valid type: "+b.type)}b.isClosed&&(i.push(h),i.push(d))}i.length>=4&&(e.push(i),t.push(this.zP(i)))}}}get type(){return this.W}set type(e){this.W!==e&&(this.f&&r.L(this,e),this.W=e,e===4?this.Ys=new E:(ci.hx===null&&(ci.hx=new E().k()),this.Ys=ci.hx),this.yt=!0)}get startX(){return this.Li}set startX(e){this.Li!==e&&(this.f&&r.L(this,e),this.Li=e,this.yt=!0)}get startY(){return this.Ai}set startY(e){this.Ai!==e&&(this.f&&r.L(this,e),this.Ai=e,this.yt=!0)}get endX(){return this.ni}set endX(e){this.ni!==e&&(this.f&&r.L(this,e),this.ni=e,this.yt=!0)}get endY(){return this.oi}set endY(e){this.oi!==e&&(this.f&&r.L(this,e),this.oi=e,this.yt=!0)}get figures(){return this.Ys}set figures(e){this.Ys!==e&&(this.f&&r.L(this,e),this.Ys=e,this.yt=!0)}add(e){return this.Ys.add(e),this}setSpots(e,t,i,s,n,o,a,l){return this.f&&r.L(this),this.$n=new X(e,t,n,o),this.Zn=new X(i,s,a,l),this}get spot1(){return this.$n}set spot1(e){this.f&&r.L(this,e),this.$n=e.N()}get spot2(){return this.Zn}set spot2(e){this.f&&r.L(this,e),this.Zn=e.N()}get defaultStretch(){return this.Qn}set defaultStretch(e){this.Qn=e}get bounds(){return this.UP()&&this.cx(),this.cm}polygonClosestSegment(e,t){if(t===void 0&&(t=10),this.type!==4)return null;const i=e.x,s=e.y;let n=1/0,o=0,a=0,l=0,h=0,d=0,f=0,m=0,p=0;return this.figures.each(b=>{let x=b.startX,v=b.startY;b.segments.each(S=>{let P=S.endX,T=S.endY,A=0;if(S.type===2)A=L.distanceLineSegmentSquared(i,s,x,v,P,T);else{x=S.endX,v=S.endY;return}A<n&&(n=A,o=l,a=h,d=x,f=v,m=P,p=T),x=P,v=T,h++,S.isClosed&&(P=b.startX,T=b.startY,A=L.distanceLineSegmentSquared(i,s,x,v,P,T),A<n&&(n=A,o=l,a=h,d=x,f=v,m=P,p=T),h++)}),l++,h=0}),n<t*t?{figi:o,segi:a,ax:d,ay:f,bx:m,by:p}:null}get polygonArea(){if(this.type===4){const e=this.figures.iterator;let t=0,i=0,s=0,n=0,o=0;for(;e.next();){const a=e.value;if(!a.isFilled)continue;t=a.startX,i=a.startY;const l=a.segments.iterator;for(;l.next();){const h=l.value;s=h.endX,n=h.endY,h.type===1||h.type!==5&&(o+=t*n-i*s),t=s,i=n}o+=t*a.startY-i*a.startX}return Math.abs(o)/2}else if(this.type===2){const e=Math.abs(this.startX-this.endX),t=Math.abs(this.startY-this.endY);return e*t}else if(this.type===3){const e=Math.abs(this.startX-this.endX),t=Math.abs(this.startY-this.endY);return Math.PI*e/2*t/2}else return 0}get polygonLength(){if(this.type===4){const e=this.figures.iterator;let t=0,i=0,s=0,n=0,o=0;for(;e.next();){const a=e.value;t=a.startX,i=a.startY;const l=a.segments.iterator;for(;l.next();){const d=l.value;s=d.endX,n=d.endY,d.type===1||d.type!==5&&(o+=Math.sqrt((s-t)*(s-t)+(n-i)*(n-i))),t=s,i=n}const h=a.segments.last();h&&h.isClosed&&(s=a.startX,n=a.startY,o+=Math.sqrt((s-t)*(s-t)+(n-i)*(n-i)))}return o}else if(this.type===2){const e=Math.abs(this.startX-this.endX),t=Math.abs(this.startY-this.endY);return e*2+t*2}else if(this.type===3){const e=Math.abs(this.startX-this.endX)/2,t=Math.abs(this.startY-this.endY)/2;if(e+t===0)return 0;const i=(e-t)*(e-t)/((e+t)*(e+t));let s=i,n=1+s/4;return s*=i,n+=s/64,s*=i,n+=s/256,s*=i,n+=s*25/16384,s*=i,n+=s*49/65536,s*=i,n+=s*441/1048576,Math.PI*(e+t)*n}else{const e=this.startX,t=this.startY,i=this.endX,s=this.endY;return Math.sqrt((i-e)*(i-e)+(s-t)*(s-t))}}static computeConvexHull(e){e.sort((s,n)=>s.x===n.x?n.y-s.y:n.x-s.x);const t=[];for(let s=0;s<e.length;s++){for(;t.length>=2&&e[s].compareWithLineSegmentPoint(t[t.length-2],t[t.length-1])>=0;)t.pop();t.push(e[s])}t.pop();const i=[];for(let s=e.length-1;s>=0;s--){for(;i.length>=2&&e[s].compareWithLineSegmentPoint(i[i.length-2],i[i.length-1])>=0;)i.pop();i.push(e[s])}return i.pop(),t.concat(i)}static generatePolygon(e,t,i){t===void 0&&(t=0),i===void 0&&(i=!0);const s=new ci;if(e.length>1)if(t>0)if(i){e.push(e[0]),e.push(e[1]);let n=!0;const o=new Z(0,0,i,!1);for(let l=1;l<e.length;l++){const h=(e[l-1].x+e[l].x)/2,d=(e[l-1].y+e[l].y)/2,f=e[l-1].distanceSquaredPoint(e[l]),m=.5*t/Math.sqrt(f);if(m<.5){const p=e[l-1].x+(e[l].x-e[l-1].x)*m,b=e[l-1].y+(e[l].y-e[l-1].y)*m;if(n?(n=!1,o.startX=p,o.startY=b):o.add(new et(3,p,b,e[l-1].x,e[l-1].y,e[l-1].x,e[l-1].y)),l<e.length-1){const x=e[l].x+(e[l-1].x-e[l].x)*m,v=e[l].y+(e[l-1].y-e[l].y)*m;o.add(new et(2,x,v))}}else n?(n=!1,o.startX=h,o.startY=d):o.add(new et(3,h,d,e[l-1].x,e[l-1].y,e[l-1].x,e[l-1].y))}const a=o.segments.last();a&&a.close(),s.add(o)}else{const n=new Z(e[0].x,e[0].y,!1,!1);for(let o=1;o<e.length;o++){const a=(e[o-1].x+e[o].x)/2,l=(e[o-1].y+e[o].y)/2,h=e[o-1].distanceSquaredPoint(e[o]),d=.5*t/Math.sqrt(h);if(d<.5){if(o>1){const p=e[o-1].x+(e[o].x-e[o-1].x)*d,b=e[o-1].y+(e[o].y-e[o-1].y)*d;n.add(new et(3,p,b,e[o-1].x,e[o-1].y,e[o-1].x,e[o-1].y))}const f=e[o].x+(e[o-1].x-e[o].x)*d,m=e[o].y+(e[o-1].y-e[o].y)*d;n.add(new et(2,f,m))}else o>1&&n.add(new et(3,a,l,e[o-1].x,e[o-1].y,e[o-1].x,e[o-1].y));o===e.length-1&&n.add(new et(2,e[o].x,e[o].y))}s.add(n)}else{const n=new Z(e[0].x,e[0].y,i,!1);for(let o=1;o<e.length;o++)n.add(new et(2,e[o].x,e[o].y));if(i){const o=n.segments.last();o&&o.close()}s.add(n)}return s}};y(ci,"Line",1),y(ci,"Rectangle",2),y(ci,"Ellipse",3),y(ci,"Path",4),y(ci,"hx",new E().k()),y(ci,"fm","UuBbMmZzLlHhVvCcSsQqTtAaFfXx");let It=ci;It.stringify=It.stringify,It.stringifyFixed=It.stringifyFixed,It.fillPath=It.fillPath,It.parse=It.parse;class Z{constructor(e,t,i,s,n){y(this,"n");y(this,"Li");y(this,"Ai");y(this,"Nc");y(this,"dm");y(this,"ji");i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),e!==void 0?this.Li=e:this.Li=0,t!==void 0?this.Ai=t:this.Ai=0,this.Nc=new E,this.dm=this.Nc.rt,this.ji=null}copy(){const e=new Z;e.n=this.n&-2,e.Li=this.Li,e.Ai=this.Ai;const t=this.Nc.r,i=t.length,s=e.Nc;for(let n=0;n<i;n++){const o=t[n].copy();s.add(o)}return e.dm=this.dm,e.ji=this.ji,e}equalsApprox(e){if(!(e instanceof Z)||!B.u(this.startX,e.startX)||!B.u(this.startY,e.startY))return!1;const t=this.segments.r,i=e.segments.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],a=i[n];if(!o.equalsApprox(a))return!1}return!0}toString(e){e===void 0&&(e=-1);let t="";if(e<0)t="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(e);t="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+o.toString(e)}return t}get f(){return(this.n&1)!==0}set f(e){e?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(e){e?this.n|=2:this.n&=-3}k(){this.f=!0;const e=this.segments;e.k();const t=e.r,i=e.length;for(let s=0;s<i;s++)t[s].k();return this}UP(){if(this.yt)return!0;const e=this.segments;if(this.dm!==e.rt)return!0;for(const t of e)if(t.yt)return!0;return!1}iR(){this.yt=!1,this.ji=null;const e=this.segments;this.dm=e.rt;for(const t of e)t.yt=!1,t.Hs=null}get isFilled(){return(this.n&4)!==0}set isFilled(e){this.f&&r.L(this,e),e?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(e){this.f&&r.L(this,e),e?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(e){this.f&&r.L(this,e),e?this.n|=16:this.n&=-17}get startX(){return this.Li}set startX(e){this.f&&r.L(this,e),this.Li=e,this.ji=null,this.yt=!0}get startY(){return this.Ai}set startY(e){this.f&&r.L(this,e),this.Ai=e,this.ji=null,this.yt=!0}get segments(){return this.Nc}set segments(e){this.f&&r.L(this,e),this.Nc=e,this.ji=null,this.yt=!0}add(e){return this.Nc.add(e),this.ji=null,this}BP(e,t,i){const s=this;let n=s.startX,o=s.startY,a=n,l=o;const h=s.segments.r,d=h.length;for(let f=0;f<d;f++){const m=h[f];switch(m.type){case 1:a=m.endX,l=m.endY,n=m.endX,o=m.endY;break;case 2:if(B.Ve(n,o,m.endX,m.endY,i,e,t))return!0;n=m.endX,o=m.endY;break;case 3:if(B.nx(n,o,m.point1X,m.point1Y,m.point2X,m.point2Y,m.endX,m.endY,.5,e,t,i))return!0;n=m.endX,o=m.endY;break;case 4:if(B.IP(n,o,m.point1X,m.point1Y,m.endX,m.endY,.5,e,t,i))return!0;n=m.endX,o=m.endY;break;case 5:case 6:const p=m.type===5?m.Fo(s):m.Za(s,n,o),b=p.length,x=m.type===5?m.centerX:m.endX,v=m.type===5?m.centerY:m.endY;if(b===0){if(B.Ve(n,o,x,v,i,e,t))return!0;n=x,o=v;break}let S=null;for(let P=0;P<b;P++)if(S=p[P],P===0&&B.Ve(n,o,S[0],S[1],i,e,t)||B.nx(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],.5,e,t,i))return!0;S!==null&&(n=S[6],o=S[7]);break;default:r.o("Unknown Segment type: "+m.type)}if(m.isClosed&&(n!==a||o!==l)&&B.Ve(n,o,a,l,i,e,t))return!0}return!1}}var Pt=(M=>(M[M.Move=1]="Move",M[M.Line=2]="Line",M[M.Bezier=3]="Bezier",M[M.QuadraticBezier=4]="QuadraticBezier",M[M.Arc=5]="Arc",M[M.SvgArc=6]="SvgArc",M))(Pt||{});const ds=class ds{constructor(e,t,i,s,n,o,a,l){y(this,"W");y(this,"n");y(this,"ni");y(this,"oi");y(this,"pn");y(this,"Ll");y(this,"Al");y(this,"br");y(this,"Hs");if(F.Je(this),e===void 0&&(e=2),this.W=e,this.n=2,t!==void 0?this.ni=t:this.ni=0,i!==void 0?this.oi=i:this.oi=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),a===void 0&&(a=0),e===6){let h=o;h=h%360,h<0&&(h+=360),this.pn=h,this.Ll=0,this.Al=Math.max(s,0),this.br=Math.max(n,0),typeof a=="boolean"?a&&(this.isLargeArc=!0):typeof a=="number"&&a&&(this.isLargeArc=!0),l&&(this.isClockwiseArc=!0)}else this.pn=s,this.Ll=n,e===5&&(o=Math.max(o,0)),this.Al=o,typeof a=="number"?(e===5&&(a=Math.max(a,0)),this.br=a):this.br=0;this.Hs=null}copy(){const e=new ds;return e.W=this.W,e.n=this.n&-2,e.ni=this.ni,e.oi=this.oi,e.pn=this.pn,e.Ll=this.Ll,e.Al=this.Al,e.br=this.br,e}equalsApprox(e){if(!(e instanceof ds)||this.type!==e.type||this.isClosed!==e.isClosed)return!1;switch(this.type){case 1:case 2:return B.u(this.endX,e.endX)&&B.u(this.endY,e.endY);case 3:return B.u(this.endX,e.endX)&&B.u(this.endY,e.endY)&&B.u(this.point1X,e.point1X)&&B.u(this.point1Y,e.point1Y)&&B.u(this.point2X,e.point2X)&&B.u(this.point2Y,e.point2Y);case 4:return B.u(this.endX,e.endX)&&B.u(this.endY,e.endY)&&B.u(this.point1X,e.point1X)&&B.u(this.point1Y,e.point1Y);case 5:return B.u(this.startAngle,e.startAngle)&&B.u(this.sweepAngle,e.sweepAngle)&&B.u(this.centerX,e.centerX)&&B.u(this.centerY,e.centerY)&&B.u(this.radiusX,e.radiusX)&&B.u(this.radiusY,e.radiusY);case 6:return this.isClockwiseArc===e.isClockwiseArc&&this.isLargeArc===e.isLargeArc&&B.u(this.xAxisRotation,e.xAxisRotation)&&B.u(this.endX,e.endX)&&B.u(this.endY,e.endY)&&B.u(this.radiusX,e.radiusX)&&B.u(this.radiusY,e.radiusY);default:return!1}}fe(e){e in Pt?this.type=e:r.dr(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i="";switch(this.type){case 1:e<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+t(this.endX)+" "+t(this.endY);break;case 2:e<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+t(this.endX)+" "+t(this.endY);break;case 3:e<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.point2X)+" "+t(this.point2Y)+" "+t(this.endX)+" "+t(this.endY);break;case 4:e<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.endX)+" "+t(this.endY);break;case 5:e<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+t(this.startAngle)+" "+t(this.sweepAngle)+" "+t(this.centerX)+" "+t(this.centerY)+" "+t(this.radiusX)+" "+t(this.radiusY);break;case 6:e<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+t(this.radiusX)+" "+t(this.radiusY)+" "+t(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+t(this.endX)+" "+t(this.endY);break;default:i=Pt[this.type]}return i+(this.isClosed?"z":"")}get f(){return(this.n&1)!==0}set f(e){e?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(e){e?this.n|=2:this.n&=-3}k(){return this.f=!0,this}close(){return this.isClosed=!0,this}Fo(e){if(this.Hs!==null&&e.yt===!1)return this.Hs;const t=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=t),t===0||i===0)return this.Hs=[],this.Hs;const s=this.pn,n=this.Ll,o=B.KL(0,0,t<i?t:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(t!==i){const l=lt.l();l.Ue(),t<i?l.it(1,i/t):l.it(t/i,1),It.JL(o,l),lt.i(l)}const a=o.length;for(let l=0;l<a;l++){const h=o[l];h[0]+=s,h[1]+=n,h[2]+=s,h[3]+=n,h[4]+=s,h[5]+=n,h[6]+=s,h[7]+=n}return this.Hs=o,this.Hs}Za(e,t,i){if(this.Hs!==null&&e.yt===!1)return this.Hs;if(this.radiusX===0||this.radiusY===0)return this.Hs=[],this.Hs;const s=t,n=i;let o=this.Al,a=this.br;o===0&&(o=1e-4),a===0&&(a=1e-4);const l=this.pn*(Math.PI/180),h=this.isLargeArc,d=this.isClockwiseArc,f=this.ni,m=this.oi,p=Math.cos(l),b=Math.sin(l),x=p*(s-f)/2+b*(n-m)/2,v=-b*(s-f)/2+p*(n-m)/2,S=x*x/(o*o)+v*v/(a*a);S>1&&(o*=Math.sqrt(S),a*=Math.sqrt(S));let P=(h===d?-1:1)*Math.sqrt((o*o*a*a-o*o*v*v-a*a*x*x)/(o*o*v*v+a*a*x*x));isNaN(P)&&(P=0);let T=P*o*v/a,A=P*-a*x/o;isNaN(T)&&(T=0),isNaN(A)&&(A=0);const C=(s+f)/2+p*T-b*A,O=(n+m)/2+b*T+p*A,R=(kt,Mt)=>Math.sqrt(kt*kt+Mt*Mt),I=(kt,Mt,St,Ct)=>(kt*St+Mt*Ct)/(R(kt,Mt)*R(St,Ct)),H=(kt,Mt,St,Ct)=>(kt*Ct<Mt*St?-1:1)*Math.acos(I(kt,Mt,St,Ct)),V=H(1,0,(x-T)/o,(v-A)/a),z=(x-T)/o,K=(v-A)/a,$=(-x-T)/o,q=(-v-A)/a;let J=H(z,K,$,q);const ot=I(z,K,$,q);ot<=-1?J=Math.PI:ot>=1&&(J=0),!d&&J>0&&(J=J-2*Math.PI),d&&J<0&&(J=J+2*Math.PI);const rt=o>a?o:a,st=o>a?1:o/a,ht=o>a?a/o:1,pt=B.KL(0,0,rt,V,V+J,!0),zt=lt.l();return zt.Ue(),zt.Gs(C,O),zt.ks(this.pn,0,0),zt.it(st,ht),It.JL(pt,zt),lt.i(zt),this.Hs=pt,this.Hs}get isClosed(){return(this.n&8)!==0}set isClosed(e){this.isClosed!==e&&(e?this.n|=8:this.n&=-9,this.yt=!0)}get type(){return this.W}set type(e){this.f&&r.L(this,e),this.W=e,this.yt=!0}get endX(){return this.ni}set endX(e){this.f&&r.L(this,e),this.ni=e,this.yt=!0}get endY(){return this.oi}set endY(e){this.f&&r.L(this,e),this.oi=e,this.yt=!0}get point1X(){return this.pn}set point1X(e){this.f&&r.L(this,e),this.pn=e,this.yt=!0}get point1Y(){return this.Ll}set point1Y(e){this.f&&r.L(this,e),this.Ll=e,this.yt=!0}get point2X(){return this.Al}set point2X(e){this.f&&r.L(this,e),this.Al=e,this.yt=!0}get point2Y(){return this.br}set point2Y(e){this.f&&r.L(this,e),this.br=e,this.yt=!0}get centerX(){return this.pn}set centerX(e){this.f&&r.L(this,e),this.pn=e,this.yt=!0}get centerY(){return this.Ll}set centerY(e){this.f&&r.L(this,e),this.Ll=e,this.yt=!0}get radiusX(){return this.Al}set radiusX(e){e<0&&r.J(e,">= zero",ds,"radiusX"),this.f&&r.L(this,e),this.Al=e,this.yt=!0}get radiusY(){return this.br}set radiusY(e){e<0&&r.J(e,">= zero",ds,"radiusY"),this.f&&r.L(this,e),this.br=e,this.yt=!0}get startAngle(){return this.ni}set startAngle(e){this.f&&r.L(this,e),e=e%360,e<0&&(e+=360),this.ni=e,this.yt=!0}get sweepAngle(){return this.oi}set sweepAngle(e){this.f&&r.L(this,e),e>360&&(e=360),e<-360&&(e=-360),this.oi=e,this.yt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(e){this.f&&r.L(this,e),e?this.n|=4:this.n&=-5,this.yt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(e){this.f&&r.L(this,e),e?this.n|=16:this.n&=-17,this.yt=!0}get xAxisRotation(){return this.pn}set xAxisRotation(e){this.f&&r.L(this,e),e=e%360,e<0&&(e+=360),this.pn=e,this.yt=!0}};y(ds,"Move",1),y(ds,"Line",2),y(ds,"Bezier",3),y(ds,"QuadraticBezier",4),y(ds,"Arc",5),y(ds,"SvgArc",6);let et=ds;class Dt{constructor(){y(this,"a");y(this,"ux");y(this,"gx");y(this,"gm");y(this,"mm");y(this,"pm");y(this,"ym");y(this,"wm");y(this,"xm");y(this,"bm");y(this,"km");y(this,"Pm");y(this,"Sm");y(this,"Mm");y(this,"Ro");y(this,"Nm");y(this,"Cm");y(this,"Ps");y(this,"Ti");this.a=null,this.ux=new L(0,0).k(),this.gx=new L(0,0).k(),this.gm=0,this.mm=0,this.pm=1,this.ym="",this.wm="",this.xm=!1,this.bm=!1,this.km=0,this.Pm=0,this.Sm=!1,this.Mm=!1,this.Ro=!1,this.Nm=null,this.Cm=0,this.Ps=null,this.Ti=null}copy(){const e=new Dt;return this.clone(e)}clone(e){return e.a=this.a,e.ux.h(this.viewPoint),e.gx.h(this.documentPoint),e.gm=this.gm,e.mm=this.mm,e.pm=this.pm,e.ym=this.ym,e.wm=this.wm,e.xm=this.xm,e.bm=this.bm,e.km=this.km,e.Pm=this.Pm,e.Sm=this.Sm,e.Mm=this.Mm,e.Ro=this.Ro,e.Nm=this.Nm,e.Cm=this.Cm,e.Ps=this.Ps,e.Ti=this.Ti,e}toString(){let e="^";return this.modifiers!==0&&(e+="M:"+this.modifiers),this.button!==0&&(e+="B:"+this.button),this.key!==""&&(e+="K:"+this.key),this.clickCount!==0&&(e+="C:"+this.clickCount),this.delta!==0&&(e+="D:"+this.delta),this.handled&&(e+="h"),this.bubbles&&(e+="b"),this.documentPoint!==null&&(e+="@"+this.documentPoint.toString()),e}get diagram(){return this.a}set diagram(e){this.a=e}get viewPoint(){return this.ux}set viewPoint(e){this.ux.h(e)}get documentPoint(){return this.gx}set documentPoint(e){this.gx.h(e)}getMultiTouchViewPoint(e,t){const i=this.diagram;return i===null||i._L(this.event,e,t),t}getMultiTouchDocumentPoint(e,t){const i=this.diagram;return i===null||(i._L(this.event,e,t),t.h(i.transformViewToDoc(t))),t}get modifiers(){return this.gm}set modifiers(e){this.gm=e}get button(){return this.mm}set button(e){if(this.mm=e,this.event===null)switch(e){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.pm}set buttons(e){this.pm=e}get key(){return this.ym}set key(e){this.ym=e}get code(){return this.wm}set code(e){this.wm=e}get down(){return this.xm}set down(e){this.xm=e}get up(){return this.bm}set up(e){this.bm=e}get clickCount(){return this.km}set clickCount(e){this.km=e}get delta(){return this.Pm}set delta(e){this.Pm=e}get isMultiTouch(){return this.Sm}set isMultiTouch(e){this.Sm=e}get handled(){return this.Mm}set handled(e){this.Mm=e}get bubbles(){return this.Ro}set bubbles(e){this.Ro=e}get event(){return this.Nm}set event(e){this.Nm=e}get isTouchEvent(){const e=this.event;return e===null?!1:e.pointerType==="touch"||e.pointerType==="pen"}get timestamp(){return this.Cm}set timestamp(e){this.Cm=e}get targetDiagram(){return this.Ps}set targetDiagram(e){this.Ps=e}get targetObject(){return this.Ti}set targetObject(e){this.Ti=e}get control(){return(this.modifiers&1)!==0}set control(e){this.modifiers=e?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(e){this.modifiers=e?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(e){this.modifiers=e?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(e){this.modifiers=e?this.modifiers|8:this.modifiers&-9}get left(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(e){e?this.buttons|=1:this.buttons&=-2}get right(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(e){e?this.buttons|=2:this.buttons&=-3}get middle(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(e){e?this.buttons|=4:this.buttons&=-5}get commandKey(){const e=this.code,t=this.key;return"cxvyzagCXVYZAG".includes(t)?t.toLowerCase():e==="KeyC"?"c":e==="KeyX"?"x":e==="KeyV"?"v":e==="KeyY"?"y":e==="KeyZ"?"z":e==="KeyA"?"a":e==="KeyG"?"g":e!==""?e:t}}class Rt{constructor(){y(this,"a");y(this,"Pt");y(this,"Lm");y(this,"Am");this.a=null,this.Pt="",this.Lm=null,this.Am=null}copy(){const e=new Rt;return e.a=this.a,e.Pt=this.Pt,e.Lm=this.Lm,e.Am=this.Am,e}toString(){let e="*"+this.name;return this.subject!==null&&(e+=":"+this.subject.toString()),this.parameter!==null&&(e+="("+this.parameter.toString()+")"),e}get diagram(){return this.a}set diagram(e){this.a=e}get name(){return this.Pt}set name(e){this.Pt=e}get subject(){return this.Lm}set subject(e){this.Lm=e}get parameter(){return this.Am}set parameter(e){this.Am=e}}var bt=(M=>(M[M.Transaction=1]="Transaction",M[M.Property=2]="Property",M[M.Insert=3]="Insert",M[M.Remove=4]="Remove",M))(bt||{});const Yn=class Yn{constructor(){y(this,"Du");y(this,"Tm");y(this,"yn");y(this,"Ce");y(this,"a");y(this,"vu");y(this,"Cc");y(this,"Lc");y(this,"Ac");y(this,"Tc");this.Du=2,this.Tm="",this.yn="",this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}clear(){this.Ce=null,this.a=null,this.vu=null,this.Cc=null,this.Lc=null,this.Ac=null,this.Tc=null}copy(){const e=new Yn;e.Du=this.Du,e.Tm=this.Tm,e.yn=this.yn,e.Ce=this.Ce,e.a=this.a,e.vu=this.vu;let t=this.Cc;return r.$(t)&&r.st(t.copyFrozen)?e.Cc=t.copyFrozen():e.Cc=t,t=this.Lc,r.$(t)&&r.st(t.copyFrozen)?e.Lc=t.copyFrozen():e.Lc=t,t=this.Ac,r.$(t)&&r.st(t.copyFrozen)?e.Ac=t.copyFrozen():e.Ac=t,t=this.Tc,r.$(t)&&r.st(t.copyFrozen)?e.Tc=t.copyFrozen():e.Tc=t,e}fe(e){e in bt?this.change=e:r.dr(this,e)}toString(){let e="";return this.change===1?e+="* ":this.change===2?e+=this.model!==null?"!m":"!d":e+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(e+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(e+=" "+this.modelChange),e+=": ",this.change===1?this.oldValue!==null&&(e+=" "+this.oldValue):(this.object!==null&&(e+=r.toString(this.object)),this.oldValue!==null&&(e+="  old: "+r.toString(this.oldValue)),this.oldParam!==null&&(e+=" "+this.oldParam),this.newValue!==null&&(e+="  new: "+r.toString(this.newValue)),this.newParam!==null&&(e+=" "+this.newParam)),e}getValue(e){return e?this.oldValue:this.newValue}getParam(e){return e?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.tA(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.tA(this,!1))}get model(){return this.Ce}set model(e){this.Ce=e}get diagram(){return this.a}set diagram(e){this.a=e}get change(){return this.Du}set change(e){this.Du=e}get modelChange(){return this.Tm}set modelChange(e){this.Tm=e}get propertyName(){return this.yn}set propertyName(e){this.yn=e}get isTransactionFinished(){return this.Du===1&&(this.yn==="CommittedTransaction"||this.yn==="FinishedUndo"||this.yn==="FinishedRedo")}get object(){return this.vu}set object(e){this.vu=e}get oldValue(){return this.Cc}set oldValue(e){this.Cc=e}get oldParam(){return this.Lc}set oldParam(e){this.Lc=e}get newValue(){return this.Ac}set newValue(e){this.Ac=e}get newParam(){return this.Tc}set newParam(e){this.Tc=e}};y(Yn,"Transaction",1),y(Yn,"Property",2),y(Yn,"Insert",3),y(Yn,"Remove",4);let Et=Yn;class Bt{constructor(){y(this,"eA");y(this,"Pt");y(this,"XP");this.eA=new E().k(),this.Pt="",this.XP=!1}toString(e){let t="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(e!==void 0&&e>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(t+=`
  `+n.toString())}}return t}clear(){const e=this.changes;e.ce();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),e.k()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let e=this.changes.count-1;e>=0;e--){const t=this.changes.elt(e);t!==null&&t.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const e=this.changes.count;for(let t=0;t<e;t++){const i=this.changes.elt(t);i!==null&&i.redo()}}oR(e){const t=this.changes;for(let i=t.count-1;i>=e;i--){const s=t.elt(i);s!==null&&s.undo(),t.ce(),t.removeAt(i)}t.k()}thaw(){this.changes.ce()}optimize(){if(!this.isComplete)return;const e=this.changes;e.ce();const t=new Map;for(let s=0;s<e.count;s++){const n=e.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=t.get(n.object);o||(o=new Map,t.set(n.object,o));const a=o.get(n.propertyName);a===void 0?o.set(n.propertyName,-1):(a>0&&e.setElt(a,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<e.count;s++){const n=e.elt(s);n!==null&&(s>i&&e.setElt(i,n),i++)}for(;e.length>i;)e.pop();e.k()}get changes(){return this.eA}get name(){return this.Pt}set name(e){this.Pt=e}get isComplete(){return this.XP}set isComplete(e){this.XP=e}}class Gt{constructor(e){y(this,"mx");y(this,"Be");y(this,"iA");y(this,"js");y(this,"GP");y(this,"Dm");y(this,"Tl");y(this,"YP");y(this,"KP");y(this,"wn");y(this,"Dc");y(this,"yx");y(this,"qs");y(this,"wx");y(this,"xx");y(this,"vm");y(this,"kx");this.mx=new F,this.Be=!1,this.iA=new E().k(),this.js=-1,this.GP=999,this.qs=!1,this.Dm=null,this.Tl=0,this.YP=!1,this.KP=23,this.wn=new E().k(),this.Dc=new E,this.yx=!0,this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1,e&&Object.assign(this,e)}toString(e){let t="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;t+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(t+=" "),t+=this.nestedTransactionNames.elt(s);if(t+="]",e!==void 0&&e>0){i=this.history.count;for(let s=0;s<i;s++)t+=`
 `+this.history.elt(s).toString(e-1)}return t}clear(){const e=this.history;e.ce();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),this.js=-1,e.k(),this.qs=!1,this.Dm=null,this.Tl=0,this.wn.ce(),this.wn.clear(),this.wn.k(),this.Dc.clear(),this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1}copyProperties(e){this.isEnabled=e.isEnabled,this.maxHistoryLength=e.maxHistoryLength,this.Fm=e.Fm}addModel(e){this.mx.add(e)}removeModel(e){this.mx.delete(e)}startTransaction(e){if(e===void 0&&(e=""),e===null&&(e=""),this.isUndoingRedoing)return!1;this.yx===!0&&(this.yx=!1,this.Tl++,this.Dl||this.vl("StartingFirstTransaction",e,this.currentTransaction),this.Tl>0&&this.Tl--),this.isEnabled&&(this.wn.ce(),this.wn.add(e),this.wn.k(),this.currentTransaction===null?this.Dc.add(0):this.Dc.add(this.currentTransaction.changes.count)),this.Tl++;const t=this.transactionLevel===1;return t&&(this.Dl||this.vl("StartedTransaction",e,this.currentTransaction)),t}commitTransaction(e){return e===void 0&&(e=""),this.sA(!0,e)}rollbackTransaction(){return this.sA(!1,"")}sA(e,t){if(this.isUndoingRedoing)return!1;this.Fm&&this.transactionLevel<1&&r.ne("Ending transaction without having started a transaction: "+t);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&e&&(this.Dl||this.vl("CommittingTransaction",t,s));let n=0;if(this.transactionLevel>0&&(this.Tl--,this.isEnabled)){const o=this.wn.count;o>0&&(t===""&&(t=this.wn.elt(0)),this.wn.ce(),this.wn.removeAt(o-1),this.wn.k());const a=this.Dc.count;a>0&&(n=this.Dc.elt(a-1),this.Dc.removeAt(a-1))}if(i){if(e){if(this.vm=!1,s===null&&t!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=t),this.discardHistoryAfterIndex();const a=this.history;a.ce();const l=this.maxHistoryLength;if(l>=0){if(l===0)a.clear();else if(a.count>=l){const h=a.elt(0);h!==null&&h.clear(),a.removeAt(0),this.js--}}l!==0&&(a.count===0||a.get(a.count-1)!==o)&&(a.add(o),this.js++),a.k(),s=o}this.Dl||this.vl("CommittedTransaction",t,s)}else{this.qs=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.Dl||this.vl("RolledBackTransaction",t,s),this.qs=!1}s!==null&&s.clear()}return this.Dm=null,this.Px&&this.clear(),this.Px=!1,this.Sx=!1,!0}else return this.isEnabled&&!e&&s!==null&&s.oR(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const e=this.history;e.ce();for(let t=e.count-1;t>this.historyIndex;t--){const i=e.elt(t);i!==null&&i.clear(),e.removeAt(t),this.vm=!0}e.k()}thaw(){this.history.ce()}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToUndo;return!!(e!==null&&e.canUndo())}undo(){if(!this.canUndo())return;const e=this.transactionToUndo;if(e!==null)try{this.qs=!0,this.vl("StartingUndo","Undo",e),this.js--,e.undo()}catch(t){r.ne("undo error: "+t.toString())}finally{this.vl("FinishedUndo","Undo",e),this.qs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToRedo;return!!(e!==null&&e.canRedo())}redo(){if(!this.canRedo())return;const e=this.transactionToRedo;if(e!==null)try{this.qs=!0,this.vl("StartingRedo","Redo",e),this.js++,e.redo()}catch(t){r.ne("redo error: "+t.toString())}finally{this.vl("FinishedRedo","Redo",e),this.qs=!1}}vl(e,t,i){const s=new Et;s.change=1,s.propertyName=e,s.object=i,s.oldValue=t;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.rR(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;t===null&&(t=new Bt,this.Dm=t);const i=e.copy(),s=t.changes;if(s.ce(),s.add(i),s.k(),this.Fm&&this.KP>0&&this.transactionLevel<=0&&!this.yx){const n=e.diagram;if(n!==null&&n.Qa===!1)return;r.ne("Change not within a transaction: "+i.toString()),this.KP--}}}skipsEvent(e){if(e===null||e.change===1)return!0;const t=e.object;if(t===null)return!1;if(t.layer!==void 0){const i=t.layer;if(i!==null&&i.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.mx.iterator}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.qs}get history(){return this.iA}get maxHistoryLength(){return this.GP}set maxHistoryLength(e){this.GP=e}get historyIndex(){return this.js}get currentTransaction(){return this.Dm}get transactionLevel(){return this.Tl}get isInTransaction(){return this.Tl>0}get Fm(){return this.YP}set Fm(e){this.YP=e}get nestedTransactionNames(){return this.wn}get Px(){return this.wx}set Px(e){this.wx=e}get Sx(){return this.xx}set Sx(e){this.xx=e}get Dl(){return this.kx}set Dl(e){this.kx=e}get isJustDiscarded(){return this.vm}}class Zt{constructor(){y(this,"a");y(this,"Pt");y(this,"Be");y(this,"HP");y(this,"jP");y(this,"Rm");y(this,"nA");F.Je(this),this.a=qt.Om(),this.Pt="",this.Be=!0,this.HP=!1,this.jP=null,this.nA=new Dt,this.Rm=-1}get diagram(){return this.a}set diagram(e){e instanceof qt&&(this.a=e)}toString(){return this.name!==""?this.name+" Tool":r.Hn(this.constructor)}updateAdornments(e){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const e=this.diagram;e.currentTool===this&&(e.currentTool=null,e.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,L.z(NaN,NaN)),s=t.getMultiTouchViewPoint(1,L.z(NaN,NaN));if(!i.isReal()||!s.isReal()){L.i(i),L.i(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){e.qP=e.scale;const n=s.x-i.x,o=s.y-i.y,a=Math.sqrt(n*n+o*o);e.WP=a,t.bubbles=!1}L.i(i),L.i(s)}standardPinchZoomMove(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,L.z(NaN,NaN)),s=t.getMultiTouchViewPoint(1,L.z(NaN,NaN));if(!i.isReal()||!s.isReal()){L.i(i),L.i(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,a=Math.sqrt(n*n+o*o)/e.WP,l=new L((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=e.qP*a,d=e.commandHandler;if(h!==e.scale&&d.canResetZoom(h)){const f=e.zoomPoint;e.zoomPoint=l,d.resetZoom(h),e.zoomPoint=f}t.bubbles=!1}L.i(i),L.i(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(e){return e===void 0&&(e=this.name),this.transactionResult=null,this.diagram.startTransaction(e)}stopTransaction(){const e=this.diagram;return this.transactionResult===null?e.rollbackTransaction():e.commitTransaction(this.transactionResult)}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;const t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(i!==null){if(r.ur?t.meta:t.control){e.T("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),e.T("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.T("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),e.T("ChangedSelection",e.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&e.select(s)}}else t.left&&!(r.ur?t.meta:t.control)&&!t.shift&&e.clearSelection()}standardMouseClick(e,t){e===void 0&&(e=null),t===void 0&&(t=o=>{var a;return!((a=o.layer)!=null&&a.isTemporary)});const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,e,t);return s.targetObject=n,this.oA(n,s,i)}oA(e,t,i){if(t.handled=!1,e!==null&&!e.isEnabledObject())return!1;let s=0;t.left?t.clickCount===1?s=1:t.clickCount===2?s=2:s=1:t.right&&t.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(e!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.T(n,e)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.T(n)}if(e!==null)for(;e!==null;){let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick;break}if(o!==null&&(o(t,e),t.handled))break;e=e.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(t)}return t.handled}standardMouseOver(){const e=this.diagram,t=e.lastInput;if(e.animationManager.ke===!0)return;const i=e.skipsUndoManager;e.skipsUndoManager=!0;let s=e.viewportBounds.containsPoint(t.documentPoint)?e.findObjectAt(t.documentPoint,null,null):null;t.event&&(t.event.type==="pointercancel"||t.event.type==="pointerout")&&(s=null),t.targetObject=s;let n=!1;if(s!==e.vc){let o=e.vc;const a=o;for(e.vc=s,this.rA(o,s),t.handled=!1;o!==null;){const l=o.mouseLeave;if(l!==null&&(s===o||s!==null&&s.isContainedBy(o)||(l(t,o,s),n=!0,t.handled)))break;o=o.panel}for(o=a,t.handled=!1;s!==null;){const l=s.mouseEnter;if(l!==null&&(o===s||o!==null&&o.isContainedBy(s)||(l(t,s,o),n=!0,t.handled)))break;s=s.panel}s=e.vc}if(s!==null){let o=s,a="";for(;o!==null&&(a=o.cursor,a==="");)o=o.panel;for(e.currentCursor=a,t.handled=!1,o=s;o!==null;){const l=o.mouseOver;if(l!==null&&(l(t,o),n=!0,t.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=e.mouseOver;o!==null&&(o(t),n=!0)}n&&e.requestUpdate(),e.skipsUndoManager=i}doUpdateCursor(e){const t=this.diagram;t&&(t.currentCursor="")}rA(e,t){}standardMouseWheel(){const e=this.diagram,t=e.lastInput;let i=t.delta;if(i===0||!e.documentBounds.isReal())return;const s=e.commandHandler,n=e.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!t.shift||n===1&&t.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=e.zoomPoint;e.zoomPoint=t.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),e.zoomPoint=o}t.bubbles=!1}else if(n===2&&t.shift||n===1&&!t.control){const o=e.position.copy(),a=t.event,l=a.deltaMode;let h=a.deltaX,d=a.deltaY,f="pixel";if((h!==0||d!==0)&&!t.shift){switch(l){case 0:f="pixel";break;case 1:f="line";break;case 2:f="page";break}if(h!==0&&e.allowHorizontalScroll){const m=e.scrollHorizontalLineChange;h=h*(m/16),e.scroll(f,h>0?"right":"left",Math.abs(h))}if(d!==0&&e.allowVerticalScroll){const m=e.scrollVerticalLineChange;d=d*(m/16),e.scroll(f,d>0?"down":"up",Math.abs(d))}}else!t.shift&&e.allowVerticalScroll?(i=i*3*e.scrollVerticalLineChange,e.scroll(f,i>0?"up":"down",Math.abs(i))):t.shift&&e.allowHorizontalScroll&&(i=i*3*e.scrollHorizontalLineChange,e.scroll(f,i>0?"left":"right",Math.abs(i)));this.doWheelChange(e,o,t)}}doWheelChange(e,t,i){(!e.position.equals(t)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(e,t){t===void 0&&(t=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=t.clone(this.nA);this.Rm=r.dn(()=>i.doWaitAfter(s),e)}cancelWaitAfter(){this.Rm!==-1&&r.wc(this.Rm),this.Rm=-1}doWaitAfter(e){}findToolHandleAt(e,t){const i=this.diagram.findObjectAt(e,s=>{for(;s!==null&&!(s.panel instanceof Jt);)s=s.panel;return s});return i===null?null:i.part.category===t?i:null}isBeyondDragSize(e,t){const i=this.diagram;e===void 0&&(e=i.firstInput.viewPoint),t===void 0&&(t=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>o}get name(){return this.Pt}set name(e){this.Pt=e}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e}get isActive(){return this.HP}set isActive(e){this.HP=e}get transactionResult(){return this.jP}set transactionResult(e){this.jP=e}}var he=(M=>(M[M.Scroll=1]="Scroll",M[M.Zoom=2]="Zoom",M[M.None=3]="None",M))(he||{}),ie=(M=>(M[M.Zoom=1]="Zoom",M[M.Cancel=2]="Cancel",M[M.None=3]="None",M))(ie||{});class ge extends Zt{constructor(t){super();y(this,"lA");y(this,"aA");y(this,"hA");y(this,"JP");y(this,"$P");y(this,"ZP");y(this,"QP");y(this,"_P");y(this,"tS");y(this,"eS");y(this,"Im");y(this,"_a");this.name="ToolManager",this.lA=new E,this.aA=new E,this.hA=new E,this.JP=850,this.$P=850,this.ZP=new _(2,2).kt(),this.QP=5e3,this._P=1,this.tS=1,this.eS=null,this.Im=null,this._a=-1,t&&Object.assign(this,t)}get mouseWheelBehavior(){return this._P}set mouseWheelBehavior(t){this._P=t}get gestureBehavior(){return this.tS}set gestureBehavior(t){this.tS=t}initializeStandardTools(){return this}updateAdornments(t){const i=this.currentToolTip;if(i instanceof Jt&&this.Im===t){const s=i.adornedObject;(t!==null?s!==null&&s.part===t:s===null)?this.showToolTip(i,s):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&this.gestureBehavior===2&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;const s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const n=this.mouseMoveTools.length;for(let o=0;o<n;o++){const a=this.mouseMoveTools.elt(o);if(a.diagram=this.diagram,a.canStart()){t.doFocus(),t.currentTool=a,t.currentTool===a&&(a.isActive||a.doActivate(),a.doMouseMove());return}}}this.cA(t);const s=i.event;s!==null&&(s.type==="pointermove"||!s.cancelable)&&(i.bubbles=!0)}cA(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}rA(t,i){const s=this.currentToolTip;s!==null&&(i!==null&&s instanceof Jt&&(i===s||i.isContainedBy(s))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(!i.lR())return;const s=i.lastInput;if(i.lastInput=t,this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled){const n=t.copy();n.button=2,i.lastInput=n,i.Mx=!0,i.doMouseUp()}i.lastInput=s}doMouseHover(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null)for(i.handled=!1;s!==null;){const n=this.isActive?s.mouseHold:s.mouseHover;if(n!==null&&(n(i,s),i.handled))break;s=s.panel}else{const n=this.isActive?t.mouseHold:t.mouseHover;n!==null&&n(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null){const n=this.currentToolTip;if(n instanceof Jt&&(s===n||s.isContainedBy(n)))return;for(;s!==null;){const o=s.toolTip;if(o!==null){this.showToolTip(o,s);return}s=s.panel}this.hideToolTip()}else{const n=t.toolTip;n!==null?this.showToolTip(n,null):this.hideToolTip()}}showToolTip(t,i){const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Jt){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const n=t.diagram;n!==null&&n!==s&&n.remove(t),s.add(t),i!==null?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof pn&&t!==this.currentToolTip&&t.show!==null&&t.show(i,s,this);this.currentToolTip=t,this.extendToolTip(this.toolTipDuration)}positionToolTip(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),a=s.measuredBounds,l=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=a.width),o.x+a.width>l.right&&(o.x-=a.width+5/n.scale),o.x<l.x&&(o.x=l.x),o.y+20/n.scale+a.height>l.bottom?o.y-=a.height+5/n.scale:o.y+=20/n.scale,o.y<l.y&&(o.y=l.y),s.position=o}extendToolTip(t){t===void 0&&(t=3e3),this.currentToolTip!==null&&(this._a!==-1&&(r.wc(this._a),this._a=-1),t>0&&t!==1/0&&(this._a=r.dn(()=>this.hideToolTip(),t)))}hideToolTip(){this._a!==-1&&(r.wc(this._a),this._a=-1);const t=this.diagram,i=this.currentToolTip;i!==null&&(i instanceof Jt?(t.remove(i),this.Im!==null&&this.Im.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof pn&&i.hide!==null&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eS}set currentToolTip(t){this.eS=t,this.Im=t!==null&&t instanceof Jt?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.diagram=this.diagram,n.canStart()){t.doFocus(),t.currentTool=n,t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return n}return null}replaceTool(t,i){i!==null&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.name===t)return i!==null?this.mouseDownTools.setElt(n,i):this.mouseDownTools.removeAt(n),o}s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.name===t)return i!==null?this.mouseMoveTools.setElt(n,i):this.mouseMoveTools.removeAt(n),o}s=this.mouseUpTools.length;for(let n=0;n<s;n++){const o=this.mouseUpTools.elt(n);if(o.name===t)return i!==null?this.mouseUpTools.setElt(n,i):this.mouseUpTools.removeAt(n),o}return null}replaceStandardTool(t,i,s){this.Jt(t,i,s)}Jt(t,i,s){i!==null&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):i!==null&&s.add(i)}get mouseDownTools(){return this.lA}get mouseMoveTools(){return this.aA}get mouseUpTools(){return this.hA}get hoverDelay(){return this.JP}set hoverDelay(t){this.JP=t}get holdDelay(){return this.$P}set holdDelay(t){this.$P=t}get dragSize(){return this.ZP}set dragSize(t){this.ZP=t.N()}get toolTipDuration(){return this.QP}set toolTipDuration(t){this.QP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}y(ge,"WheelScroll",1),y(ge,"WheelZoom",2),y(ge,"WheelNone",3),y(ge,"GestureZoom",1),y(ge,"GestureCancel",2),y(ge,"GestureNone",3);const de=class de extends Zt{constructor(t){super();y(this,"iS");y(this,"sS");y(this,"xn");y(this,"nS");y(this,"oS");y(this,"rS");y(this,"lS");y(this,"Fc");y(this,"Em");y(this,"aS");y(this,"th");y(this,"kr");y(this,"fA");y(this,"hS");y(this,"Fu");y(this,"Ru");y(this,"cS");y(this,"fS");y(this,"uS");y(this,"dS");this.name="Dragging",this.iS=!0,this.dS=!0,this.sS=!0,this.xn=null,this.nS=null,this.oS=null,this.rS=null,this.lS=!1,this.Fu=!1,this.Fc=new L(NaN,NaN),this.Em=new L,this.aS=!0,this.th=100,this.kr=[],this.fA=new F().k(),this.hS=new ca,this.Ru=null,this.cS="copy",this.fS="",this.uS="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.iS}set isCopyEnabled(t){this.iS=t}get copiesEffectiveCollection(){return this.sS}set copiesEffectiveCollection(t){this.sS=t}get dragOptions(){return this.hS}set dragOptions(t){this.hS=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aS}set isComplexRoutingRealtime(t){this.aS=t;const i=this.diagram.findRouter("AvoidsLinks");i!==null&&(i.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){this.dragOptions.dragsTree=t}get copyCursor(){return this.cS}set copyCursor(t){this.cS=t}get moveCursor(){return this.fS}set moveCursor(t){this.fS=t}get nodropCursor(){return this.uS}set nodropCursor(t){this.uS=t}get currentPart(){return this.nS}set currentPart(t){t!==null&&r.se(t,_t,de,"currentPart"),this.nS=t}get copiedParts(){return this.rS}set copiedParts(t){this.rS=t}get draggedParts(){return this.oS}set draggedParts(t){this.oS=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.fA}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){t!==null&&r.se(t,Nt,de,"draggedLink"),this.diagram.draggedLink=t}get isDragOutStarted(){return this.lS}set isDragOutStarted(t){this.lS=t}get startPoint(){return this.Em}set startPoint(t){this.Em.equals(t)||this.Em.h(t)}get delay(){return this.th}set delay(t){this.th=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const i=t.lastInput;return!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.th)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i===null)return null;for(;i!==null&&!i.canSelect();)i=i.containingGroup;return i!==null&&(i.canMove()||i.canCopy())?i:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i!==null){for(;i!==null&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,this.currentPart!==null&&!this.currentPart.isSelected){t.T("ChangingSelection",t.selection);const s=t.lastInput;!(r.ur?s.meta:s.control)&&!s.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.T("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.Ru=null,this.currentPart===null&&this.standardMouseSelect();const i=this.currentPart;if(i===null||!i.canMove()&&!i.canCopy())return;t.cacheGroupExternalLinks(!0),de.le=null,this.isActive=!0,this.Fc.set(t.position),this.gS(t.selection),this.kr.length=0,t.animationManager.stopAnimation();const s=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=s,this.dS=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.Ou=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Cx(),t.uA(this.draggedParts),t.Iu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.aR()}gS(t){if(!this.dragsLink)return;const i=this.diagram,s=i.model.Um(),n=t.first();s&&t.count===1&&n instanceof Nt&&this.mayDragLink(n)?(this.draggedLink=n,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.xn=i.toolManager.findTool("Relinking"),this.xn===null&&(this.xn=new ye,this.xn.diagram=i),this.xn.originalLink=this.draggedLink):(this.draggedLink=null,this.xn=null)}mayDragLink(t){const i=this.diagram;return i!==null&&i.allowRelink}computeEffectiveCollection(t,i){return this.diagram.commandHandler.computeEffectiveCollection(t,i)}Ws(t){return t===void 0?new jn(L.gn):this.isGridSnapEnabled?new jn(new L(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new jn(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.dS,t.Iu=!1,t.Fl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.mS(),t.pS(this.draggedParts),this.Ru=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.Fu=!1,de.hR(),this.dA(),this.Fc.e(NaN,NaN),de.eh!==null&&(de.eh.currentCursor=""),de.eh=null,de.le=null,this.Rl(),t.isMouseCaptured=!1,t.currentCursor="",t.Ou=!1,this.stopTransaction(),t.yS(!0)}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}mS(){const t=this.diagram,i=t.skipsUndoManager;t.skipsUndoManager=!0;const s=t.lastInput;this.gA(s,null),t.skipsUndoManager=i,this.kr.length=0}mA(){this.Rl(),this.wS();const t=this.diagram;this.Fc.isReal()&&(t.position=this.Fc),t.stopAutoScroll()}doCancel(){this.Rl(),this.wS();const t=this.diagram;this.Fc.isReal()&&(t.position=this.Fc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const i=t.lastInput,s=t.previousInput;i.code==="Escape"?this.doCancel():(i.code!==s.code||i.modifiers!==s.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}cR(t,i){let s=1/0,n=1/0,o=-1/0,a=-1/0;const l=t.iterator;for(;l.next();){const h=l.value;if(!h.isVisible())continue;const d=h.location,f=d.x,m=d.y;isNaN(f)||isNaN(m)||(f<s&&(s=f),m<n&&(n=m),f>o&&(o=f),m>a&&(a=m))}return s===1/0?i.e(0,0,0,0):i.e(s,n,o-s,a-n),i}xS(t){if(this.copiedParts!==null)return;const i=this.diagram;if(t&&(i.isReadOnly||i.isModelReadOnly)||this.draggedParts===null)return;const s=i.undoManager;s.isEnabled&&s.isInTransaction?s.currentTransaction!==null&&s.currentTransaction.changes.count>0&&(i.undoManager.rollbackTransaction(),i.startTransaction("Drag")):this.wS(),i.skipsUndoManager=!t,i.partManager.addsToTemporaryLayer=!t,this.startPoint=i.firstInput.documentPoint;const n=this.copiesEffectiveCollection?this.draggedParts.toKeySet():i.selection,o=i.copyParts(n,i,!0),a=new nt,l=this.draggedParts.iterator;for(;l.next();){const d=l.key;if(d.Di()&&d.canCopy()){const f=o.get(d);if(f===null)continue;f.location=d.location,f.ensureBounds(),a.set(f,this.Ws(f.location))}}const h=o.iterator;for(;h.next();){const d=h.value;d instanceof Nt&&d.canCopy()&&a.set(d,this.Ws())}if(this.copiedParts=a,this.gS(a.toKeySet()),this.draggedLink!==null){const d=this.draggedLink,f=d.routeBounds;d.Pr(this.startPoint.x-(f.x+f.width/2),this.startPoint.y-(f.y+f.height/2))}this.doUpdateCursor(null)}Rl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const i=this.draggedParts.iterator;for(;i.next();)if(i.key instanceof Nt){const s=i.value;s.point=new L(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}dA(){this.draggedLink!==null&&(this.dragsLink&&this.xn!==null&&(this.xn.stopDraggingMouseMove(),this.xn.originalLink=null),this.draggedLink=null,this.xn=null)}Rc(t,i){if(t===null)return;const s=this.diagram,n=this.startPoint,o=L.l();o.h(s.lastInput.documentPoint),this.moveParts(t,o.subtract(n),i),L.i(o),s.getRenderingHint("temporaryPixelRatio")===!0&&s.Ol===null&&s.avgSpf>30&&(s.Cx(),s.Eu())}moveParts(t,i,s){s===void 0&&(s=!1);const n=this.diagram;n!==null&&n.Lx(t,i,this.dragOptions,s)}wS(){if(this.draggedParts===null)return;const t=this.diagram;let i=this.draggedParts.iterator;for(;i.next();){const s=i.key;s.Di()&&(s.location=i.value.point)}for(i=this.draggedParts.iterator;i.next();){const s=i.key;if(s instanceof Nt&&s.suspendsRouting){const n=i.value.point;this.draggedParts.set(s,this.Ws()),s.Pr(-n.x,-n.y)}}t.maybeUpdate()}fR(t){var s;if(t===null)return!0;const i=t.part;return!!(i===null||i instanceof Jt||(s=i.layer)!=null&&s.isTemporary||this.draggedParts&&this.draggedParts.has(i)||this.copiedParts&&this.copiedParts.has(i))}bS(t){const i=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.pA(!1));const s=this.findDragOverObject(t),n=i.lastInput;n.targetObject=s,this.doUpdateCursor(s);const o=i.skipsUndoManager;let a=!1;try{if(i.skipsUndoManager=!0,a=this.gA(n,s),!this.isActive&&de.le===null)return;const l=s!==null?s.part:null;if(l===null||i.handlesDragDropForTopLevelParts&&l.isTopLevel&&!(l instanceof Ft)){const h=i.mouseDragOver;h!==null&&(h(n),a=!0)}if(!this.isActive&&de.le===null||(this.doDragOver(t,s),!this.isActive&&de.le===null))return}finally{i.skipsUndoManager=o,a&&i.maybeUpdate()}this.Ru=s,!i.isReadOnly&&(i.allowMove||i.allowCopy)&&(i.allowHorizontalScroll||i.allowVerticalScroll)&&i.doAutoScroll(n.viewPoint)}findDragOverObject(t){return this.diagram.kS(t,null,i=>!this.fR(i))}doUpdateCursor(t){const i=this.diagram;(t===null||this.Ru!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?i.currentCursor=this.copyCursor:this.mayMove()?i.currentCursor=this.moveCursor:this.mayDragOut()&&(i.currentCursor=this.nodropCursor))}gA(t,i){let s=!1,n=this.kr.length;const o=n>0?this.kr[0]:null;if(i===o)return!1;t.handled=!1;for(let l=0;l<n;l++){const h=this.kr[l],d=h.mouseDragLeave;if(d!==null&&(d(t,h,i),s=!0,t.handled))break}if(this.kr.length=0,!this.isActive&&de.le===null||i===null)return s;t.handled=!1;let a=i;for(;a!==null;)this.kr.push(a),a=this.yA(a);n=this.kr.length;for(let l=0;l<n;l++){const h=this.kr[l],d=h.mouseDragEnter;if(d!==null&&(d(t,h,o),s=!0,t.handled))break}return s}FU(t,i){var s;return t===null?!1:!!(t===i||t.isContainedBy(i)||i instanceof Ft&&!(t instanceof Ft)&&i.handlesDragDropForMembers&&((s=t.part)!=null&&s.isMemberOf(i)))}yA(t){const i=t.panel;if(i!==null)return i;if(t instanceof _t&&!(t instanceof Ft)){const s=t.containingGroup;if(s!==null&&s.handlesDragDropForMembers)return s}return null}wA(t,i){const s=this.diagram,n=this.xn;if(n===null)return null;const o=n.portGravity,a=s.findObjectsNear(t,o,f=>n.findValidLinkablePort(f,i)),l=L.l();let h=1/0,d=null;for(const f=a.iterator;f.next();){const m=f.value;if(m.part===null)continue;const p=m.getDocumentPoint(X.Center,l),b=t.distanceSquaredPoint(p);b<h&&(d=m,h=b)}return L.i(l),d}pA(t){const i=this.draggedLink;if(i!==null){if(i.pointsCount<2)return;const s=this.diagram;if(s.isReadOnly)return;const n=this.xn;if(n===null)return;let o=null,a=null;i.fromNode===null&&(o=this.wA(i.getPoint(0),!1),o!==null&&(a=o.part));let l=null,h=null;i.toNode===null&&(l=this.wA(i.getPoint(i.pointsCount-1),!0),l!==null&&(h=l.part)),n.isValidLink(a,o,h,l)?t?(i.defaultFromPoint=i.getPoint(0),i.defaultToPoint=i.getPoint(i.pointsCount-1),i.suspendsRouting=!1,i.fromNode=a,o!==null&&(i.fromPortId=o.portId),i.toNode=h,l!==null&&(i.toPortId=l.portId),i.fromPort!==s.PS&&s.T("LinkRelinked",i,s.PS),i.toPort!==s.SS&&s.T("LinkRelinked",i,s.SS)):n.doDraggingMouseMove(a,o,h,l):n.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,i){}xA(t){const i=this.diagram;this.dragsLink&&this.pA(!0),this.mS();const s=this.findDragOverObject(t),n=i.lastInput;if(n.targetObject=s,s!==null){n.handled=!1;let h=s;for(;h!==null;){const d=h.mouseDrop;if(d!==null&&(d(n,h),n.handled))break;this.uR(n,h),h=this.yA(h)}}else{const h=i.mouseDrop;h!==null&&h(n)}if(!this.isActive&&de.le===null)return;const o=this.copiedParts||this.draggedParts;if(o!==null){const h=o.iterator;for(;h.next();){const d=h.key;d instanceof wt&&d.linksConnected.each(f=>f.suspendsRouting=!1)}}if(this.doDropOnto(t,s),!this.isActive&&de.le===null)return;const a=Y.l(),l=i.selection.iterator;for(;l.next();){const h=l.value;h instanceof wt&&this.dR(i,h,a)}Y.i(a)}uR(t,i){const s=this.diagram,n=i.part;if(s.handlesDragDropForTopLevelParts&&n!==null&&n.isTopLevel&&!(n instanceof Ft)){const o=s.mouseDrop;o!==null&&o(t)}}dR(t,i,s){if(!i.canAvoid())return;let n=!1;s=i.getAvoidableRect(s),t.viewportBounds.containsRect(s)&&(n=!0);const o=this.copiedParts||this.draggedParts;if(o===null)return;const a=t.MS(s,h=>h.part,h=>h instanceof Nt,!0,h=>h instanceof Nt,n);if(a.count===0)return;const l=a.iterator;for(;l.next();){const h=l.value;o.has(h)&&o.has(i)||!h.isMemberOf(i)&&h.isAvoiding&&h.$t()}}doDropOnto(t,i){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;this.simulatedMouseMove(i.event,i.documentPoint,i.targetDiagram)||this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.mayMove()?(this.Rl(),this.Rc(this.draggedParts,!0)):this.mayDragOut()?(this.xS(!1),this.Rc(this.copiedParts,!1)):this.Rl(),this.bS(t.lastInput.documentPoint))}doMouseUp(){var o;if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram))return;let s=!1;const n=this.mayCopy();if(n&&this.copiedParts!==null?(this.Rl(),this.xS(!0),this.Rc(this.copiedParts,!1),this.copiedParts!==null&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(a=>{a.isSelected=!0}))):(s=!0,this.Rl(),this.mayMove()&&(this.Rc(this.draggedParts,!0),this.bS(t.lastInput.documentPoint))),this.Fu=!0,this.xA(t.lastInput.documentPoint),this.isActive){const a=n&&this.copiedParts,l=a?(o=this.copiedParts)==null?void 0:o.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,s&&this.gR(),t.invalidateDocumentBounds(),t.pS(this.draggedParts),this.transactionResult=a?"Copy":"Move",t.T(a?"SelectionCopied":"SelectionMoved",l)}this.stopTool(),n&&t.T("ChangedSelection",t.selection)}simulatedMouseMove(t,i,s){if(de.le===null)return!1;const n=de.le.diagram;s instanceof qt||(s=null);const o=de.eh;if(s!==o){if(o!==null&&o!==n){o.stopAutoScroll(),de.le.isDragOutStarted=!1;const l=o.toolManager.findTool("Dragging");l!==null&&l.doSimulatedDragLeave()}if(de.eh=s,s!==null&&s!==n){de.le.mA();const l=s.toolManager.findTool("Dragging");l!==null&&(l.bA(),l.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(s===null||s===n||!s.allowDrop||s.isReadOnly||!s.allowInsert)return!1;const a=s.toolManager.findTool("Dragging");if(a!==null){let l=i;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),l=s.getMouse(t)),s.lastInput.documentPoint=l,s.lastInput.viewPoint=s.transformDocToView(l),s.lastInput.down=!1,s.lastInput.up=!1,a.doSimulatedDragOver()}return!0}simulatedMouseUp(t,i,s){if(de.le===null)return!1;const n=de.eh,o=de.le.diagram;if(s===null)return de.le.doCancel(),!0;if(s!==n){if(n!==null){const l=n.toolManager.findTool("Dragging");if(n!==null&&n!==o&&l!==null)return n.stopAutoScroll(),de.le.isDragOutStarted=!1,l.doSimulatedDragLeave(),!1}de.eh=s;const a=s.toolManager.findTool("Dragging");a!==null&&(de.le.mA(),a.bA(),a.doSimulatedDragEnter())}if(s!==this.diagram){let a=i;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),a=s.getMouse(t)):a===null&&(a=new L),s.lastInput.documentPoint=a,s.lastInput.viewPoint=s.transformDocToView(a),s.lastInput.down=!1,s.lastInput.up=!0;const l=s.toolManager.findTool("Dragging");l!==null&&l.doSimulatedDrop();const h=de.le;if(h!==null){const d=h.mayCopy();h.transactionResult=d?"Copy":"Move",h.stopTool()}return!0}return!1}gR(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const i=t.key;if(i instanceof wt){const s=i.containingGroup;s!==null&&s.hasPlaceholder()&&!this.draggedParts.has(s)&&s.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(r.ur?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}bA(){de.Nx.has(this)||de.Nx.add(this)}static hR(){if(de.Nx.count>0){const t=de.Nx,i=t.length;for(let s=0;s<i;s++){const n=t.elt(s);n.dA(),n.Rl(),n.mS(),n.diagram.stopAutoScroll()}t.clear()}}mR(t,i,s){return!this.Fu&&this.draggedParts!==null&&!this.draggedParts.has(t)?(s.h(i),!0):!1}get draggingSource(){return de.le}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const i=de.le;return!(i===null||i.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.Sr(),t.animationManager.stopAnimation();const i=de.le;i!==null&&(this.diagram.Ou=!0,t.lastInput.event===null&&(t.lastInput.event=i.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=de.le;t!==null&&t.doSimulatedDragOut(),this.diagram.Ou=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.Uu=!0;const i=de.le;if(i!==null&&i.draggedParts!==null){if(!this.mayDragIn())return;this.kA(i.draggedParts.toKeySet(),!1,t.firstInput),this.Rc(this.copiedParts,!1),this.bS(t.lastInput.documentPoint)}t.animationManager.Uu=!1}doSimulatedDrop(){const t=this.diagram,i=de.le;if(i!==null){const s=i.diagram;if(i.Fu=!0,this.Rl(),i.draggedParts===null||!this.mayDragIn())return;t.animationManager.Uu=!0,t.T("ChangingSelection",t.selection),this.startTransaction("Drop"),this.kA(i.draggedParts.toKeySet(),!0,t.lastInput),this.Rc(this.copiedParts,!1);const n=new F;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(o=>{o.isSelected=!0,n.add(o)})),this.xA(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.Ou=!1,t.T("ExternalObjectsDropped",n,s),this.stopTransaction(),t.T("ChangedSelection",t.selection)}t.animationManager.Uu=!1}kA(t,i,s){if(this.copiedParts!==null)return;const n=this.diagram;if(n.isReadOnly||n.isModelReadOnly)return;n.skipsUndoManager=!i,n.partManager.addsToTemporaryLayer=!i,this.startPoint=s.documentPoint;const o=n.copyParts(t,n,!0),a=Y.l();this.cR(t,a);const l=a.x+a.width/2,h=a.y+a.height/2;Y.i(a);const d=this.Em,f=new nt,m=L.l(),p=t.iterator;for(;p.next();){const x=p.value;if(x instanceof Nt&&x.canCopy()){const v=o.get(x);if(v===null)continue;v.points=x.points,v.Pr(d.x-l,d.y-h),v.suspendsRouting=!0,f.set(v,this.Ws())}}const b=t.iterator;for(;b.next();){const x=b.value;if(x.Di()&&x.canCopy()){const v=o.get(x);if(v===null)continue;const S=x.location;m.e(d.x-(l-S.x),d.y-(h-S.y)),v.location=m,v.ensureBounds(),f.set(v,this.Ws(m))}}if(L.i(m),this.copiedParts=f,this.gS(f.toKeySet()),this.draggedLink!==null){const x=this.draggedLink,v=x.routeBounds;x.Pr(this.startPoint.x-(v.x+v.width/2),this.startPoint.y-(v.y+v.height/2))}this.doUpdateCursor(null)}aR(){this.isDragOutStarted=!0,this.Fu=!1,de.le=this,de.eh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.Ru=null}computeMove(t,i,s,n){const o=this.diagram;return o!==null?o.computeMove(t,i,this.dragOptions,n):new L}};y(de,"Nx",new E),y(de,"le",null),y(de,"eh",null);let ae=de;ge.prototype.doCancel=function(){ae.le!==null&&ae.le.doCancel(),Zt.prototype.doCancel.call(this)};class Ce extends Zt{constructor(){super();y(this,"NS");y(this,"CS");y(this,"Il");y(this,"LS");y(this,"AS");y(this,"ih");y(this,"TS");y(this,"nh");y(this,"DS");y(this,"vS");y(this,"FS");y(this,"RS");y(this,"OS");y(this,"IS");y(this,"PA");y(this,"ES");y(this,"El");y(this,"US");this.NS=100,this.CS=!1,this.Il="pointer",this.LS=new Nt({layerName:"Tool"}).add(new Xt({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new Xt({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).It(),this.ih=new Xt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:_.TP}).theme("stroke","tempPort"),this.AS=new wt({selectable:!1,layerName:"Tool"}).add(this.ih).It(),this.nh=new Xt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:_.TP}).theme("stroke","tempPort"),this.TS=new wt({selectable:!1,layerName:"Tool"}).add(this.nh).It(),this.DS=null,this.vS=null,this.FS=null,this.RS=null,this.OS=null,this.IS=!0,this.PA=new nt,this.ES=null,this.El=null,this.US=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.NS}set portGravity(t){t>=0&&(this.NS=t)}get isUnconnectedLinkValid(){return this.CS}set isUnconnectedLinkValid(t){this.CS=t}get linkingCursor(){return this.Il}set linkingCursor(t){this.Il=t}get temporaryLink(){return this.LS}set temporaryLink(t){t.It(),this.LS=t}get temporaryFromNode(){return this.AS}set temporaryFromNode(t){t.It(),this.AS=t,t&&(this.ih=t.port)}get temporaryFromPort(){return this.ih}set temporaryFromPort(t){if(this.ih!==null){const i=this.ih.panel;if(i!==null){const s=i.D.indexOf(this.ih);i.removeAt(s),i.insertAt(s,t)}}this.ih=t}get temporaryToNode(){return this.TS}set temporaryToNode(t){t.It(),this.TS=t,t&&(this.nh=t.port)}get temporaryToPort(){return this.nh}set temporaryToPort(t){if(this.nh!==null){const i=this.nh.panel;if(i!==null){const s=i.D.indexOf(this.nh);i.removeAt(s),i.insertAt(s,t)}}this.nh=t}get originalLink(){return this.DS}set originalLink(t){this.DS=t}get originalFromNode(){return this.vS}set originalFromNode(t){this.vS=t}get originalFromPort(){return this.FS}set originalFromPort(t){this.FS=t}get originalToNode(){return this.RS}set originalToNode(t){this.RS=t}get originalToPort(){return this.OS}set originalToPort(t){this.OS=t}get isForwards(){return this.IS}set isForwards(t){this.IS=t}get validPortsCache(){return this.PA}get targetPort(){return this.ES}set targetPort(t){this.ES=t}copyPortProperties(t,i,s,n,o){if(t===null||i===null||s===null||n===null)return;const a=i.getDocumentScale(),l=_.l();l.width=i.naturalBounds.width*a,l.height=i.naturalBounds.height*a,n.desiredSize=l,_.i(l),o?(n.toSpot=i.toSpot,n.toEndSegmentLength=i.toEndSegmentLength):(n.fromSpot=i.fromSpot,n.fromEndSegmentLength=i.fromEndSegmentLength),s.locationSpot=X.Center;const h=L.l();s.location=i.getDocumentPoint(X.Center,h),L.i(h),n.angle=i.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,i,s,n,o)}setNoTargetPortProperties(t,i,s){i!==null&&(i.desiredSize=_.TP,i.fromSpot=X.None,i.toSpot=X.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,i,s)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof wt){const i=this.targetPort.part;this.isForwards?this.copyPortProperties(i,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(i,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,i){if(t===null)return null;const s=t.part;if(!(s instanceof wt))return null;for(;t!==null;){const n=i?t.toLinkable:t.fromLinkable;if(n===!0&&(t.portId!==null||t instanceof wt)&&(i?this.isValidTo(s,t):this.isValidFrom(s,t)))return t;if(n===!1)return null;t=t.panel}return null}findTargetPort(t){const i=this.diagram,s=i.lastInput.documentPoint;let n=this.portGravity;const o=i.findObjectsNear(s,n,d=>this.findValidLinkablePort(d,t),null,!0);let a=1/0,l=null;const h=o.iterator;for(;h.next();){const d=h.value,f=d.part;if(!(f instanceof wt))continue;const m=d.getDocumentPoint(X.Center,L.l()),p=s.x-m.x,b=s.y-m.y;L.i(m);const x=p*p+b*b;if(x<a){const v=this.validPortsCache.get(d);v!==null?v&&(l=d,a=x):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,f,d)||!t&&this.isValidLink(f,d,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(d,!0),l=d,a=x):this.validPortsCache.set(d,!1)}}if(l!==null){const d=l.part;if(d instanceof wt&&(d.layer===null||d.layer.allowLink))return l}return null}isValidFrom(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.fromLinkable!==!0))return!1;const s=i.fromMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&i===this.originalFromPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksOutOf(n).count>=s)return!1}return!0}isValidTo(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.toLinkable!==!0))return!1;const s=i.toMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalToNode&&i===this.originalToPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksInto(n).count>=s)return!1}return!0}isInSameNode(t,i){if(t===null||i===null)return!1;if(t===i)return!0;const s=t.part,n=i.part;return s!==null&&s===n}isLinked(t,i){if(t===null||i===null)return!1;const s=t.part;if(!(s instanceof wt))return!1;let n=t.portId;n===null&&(n="");const o=i.part;if(!(o instanceof wt))return!1;let a=i.portId;a===null&&(a="");const l=o.findLinksInto(a);for(;l.next();){const h=l.value;if(h.fromNode===s&&h.fromPortId===n)return!0}return!1}isValidLink(t,i,s,n){if(!this.isValidFrom(t,i)||!this.isValidTo(s,n)||i!==null&&n!==null&&(!(i.fromLinkableSelfNode&&n.toLinkableSelfNode)&&this.isInSameNode(i,n)||!(i.fromLinkableDuplicates&&n.toLinkableDuplicates)&&this.isLinked(i,n))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||s!==null&&this.isLabelDependentOnLink(s,this.originalLink))||t!==null&&s!==null&&(t.data===null&&s.data!==null||t.data!==null&&s.data===null)||!this.isValidCycle(t,s,this.originalLink))return!1;let o;return t!==null&&i!==null&&(o=t.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))||s!==null&&n!==null&&(o=s.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))?!1:(o=this.linkValidation,o!==null?o(t,i,s,n,this.originalLink):!0)}isLabelDependentOnLink(t,i){if(t===null)return!1;const s=t.labeledLink;if(s===null)return!1;if(s===i)return!0;const n=new F;return n.add(t),this.VS(s,i,n)}VS(t,i,s){if(t===i)return!0;const n=t.fromNode;if(n!==null&&n.labeledLink&&(s.add(n),this.VS(n.labeledLink,i,s)))return!0;const o=t.toNode;return!!(o!==null&&o.labeledLink&&(s.add(o),this.VS(o.labeledLink,i,s)))}isValidCycle(t,i,s){if(s===void 0&&(s=null),t===null||i===null)return this.isUnconnectedLinkValid;const n=this.diagram;let o=1;if(n&&(n.model.Vm()?o=n.isTreePathToChildren?5:6:o=n.validCycle),o===1)return!0;if(o===5){const a=s||this.temporaryLink;if(a!==null&&!a.isTreeLink)return!0;const l=i.linksConnected;for(;l.next();){const h=l.value;if(h!==s&&h.isTreeLink&&h.toNode===i)return!1}return!this.Vu(t,i,s,!0)}else if(o===6){const a=s||this.temporaryLink;if(a!==null&&!a.isTreeLink)return!0;const l=t.linksConnected;for(;l.next();){const h=l.value;if(h!==s&&h.isTreeLink&&h.fromNode===t)return!1}return!this.Vu(t,i,s,!0)}else{if(o===2)return!this.pR(t,i,s);if(o===3)return!this.Vu(t,i,s,!1);if(o===4)return!this.yR(t,i,s)}return!0}Vu(t,i,s,n){if(t===i)return!0;if(t===null||i===null)return!1;const o=t.linksConnected;for(;o.next();){const a=o.value;if(a===s||n&&!a.isTreeLink||a.toNode!==t)continue;const l=a.fromNode;if(!(l===t||l===null)&&this.Vu(l,i,s,n))return!0}return!1}pR(t,i,s){if(t===i)return!0;const n=new Set;return n.add(i),this.SA(n,t,i,s)}SA(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const a=o.value;if(a===n||a.toNode!==i)continue;const l=a.fromNode;if(!(l===i||l===null)&&this.SA(t,l,s,n))return!0}return!1}yR(t,i,s){if(t===i)return!0;const n=new Set;return n.add(i),this.MA(n,t,i,s)}MA(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const a=o.value;if(a===n)continue;const l=a.fromNode,h=a.toNode,d=l===i?h:l;if(!(d===i||d===null)&&this.MA(t,d,s,n))return!0}return!1}get linkValidation(){return this.El}set linkValidation(t){this.El=t}get portTargeted(){return this.US}set portTargeted(t){this.US=t}}var Be=(M=>(M[M.Either=1]="Either",M[M.ForwardsOnly=2]="ForwardsOnly",M[M.BackwardsOnly=3]="BackwardsOnly",M))(Be||{});const Kn=class Kn extends Ce{constructor(t){super();y(this,"BS");y(this,"zS");y(this,"P");y(this,"XS");this.name="Linking",this.BS={},this.zS=null,this.P=1,this.XS=null,t&&Object.assign(this,t)}get archetypeLinkData(){return this.BS}set archetypeLinkData(t){t!==null&&r.xc(t,Kn,"archetypeLinkData"),this.BS=t}get archetypeLabelNodeData(){return this.zS}set archetypeLabelNodeData(t){t!==null&&r.xc(t,Kn,"archetypeLabelNodeData"),this.zS=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.XS}set startObject(t){this.XS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Ax()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(i===null&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),i===null)return null;const s=i.part;if(!(s instanceof wt))return null;const n=this.direction;if(n===1||n===2){const o=this.findValidLinkablePort(i,!1);if(o!==null)return this.isForwards=!0,o;if(this.startObject===s){const a=s.port;if(this.findValidLinkablePort(a,!1))return this.isForwards=!0,a}}if(n===1||n===3){const o=this.findValidLinkablePort(i,!0);if(o!==null)return this.isForwards=!1,o;if(this.startObject===s){const a=s.port;if(this.findValidLinkablePort(a,!0))return this.isForwards=!1,a}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(i===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const s=this.originalFromPort.part;s instanceof wt&&(this.originalFromNode=s),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const s=this.originalToPort.part;s instanceof wt&&(this.originalToNode=s),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,s=null,n=null,o=null,a=null;try{this.targetPort=this.findTargetPort(this.isForwards);const l=this.targetPort;if(l!==null){const h=l.part;h instanceof wt&&(this.isForwards?(this.originalFromNode!==null&&(i=this.originalFromNode,s=this.originalFromPort),n=h,o=l):(i=h,s=l,this.originalToNode!==null&&(n=this.originalToNode,o=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,s=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(n=this.originalToNode,o=this.originalToPort);i!==null||n!==null?(a=this.insertLink(i,s,n,o),a!==null?(l===null&&(this.isForwards?a.defaultToPoint=t.lastInput.documentPoint:a.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),a.isSelected=!0),this.transactionResult=this.name,t.T("LinkDrawn",a)):this.doNoLink(i,s,n,o)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),a&&t.allowSelect&&t.T("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof Nt)return t.isTreeLink;const i=this.diagram;if(i===null)return!0;const s=i.partManager.getLinkCategoryForData(t),n=i.partManager.findLinkTemplateForCategory(s);return n!==null?n.isTreeLink:!0}insertLink(t,i,s,n){return this.diagram.partManager.insertLink(t,i,s,n)}doNoLink(t,i,s,n){}};y(Kn,"Either",1),y(Kn,"ForwardsOnly",2),y(Kn,"BackwardsOnly",3);let Re=Kn;class ye extends Ce{constructor(t){super();y(this,"NA",null);y(this,"CA",null);y(this,"GS",null);y(this,"YS",null);y(this,"Ss");y(this,"KS");this.name="Relinking",this.fromHandleArchetype=new Xt("Diamond",{desiredSize:_.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new Xt("Diamond",{desiredSize:_.Su,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.KS=new Y,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof Nt))return;let i="RelinkFrom",s=null;if(t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null&&(s=this.makeAdornment(n,!1),t.addAdornment(i,s)))}if(s===null&&t.removeAdornment(i),i="RelinkTo",s=null,t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null?(s=this.makeAdornment(n,!0),t.addAdornment(i,s)):s.c())}s===null&&t.removeAdornment(i)}makeAdornment(t,i){let s=i?this.YS:this.GS;return s&&(s=s.copy(),s.adornedObject=t),s}get fromHandleArchetype(){return this.NA}set fromHandleArchetype(t){t!==null&&r.se(t,Ht,ye,"fromHandleArchetype"),this.NA=t,t!==null?this.GS=new Jt(Lt.Link).add(t).It():this.GS=null}get toHandleArchetype(){return this.CA}set toHandleArchetype(t){t!==null&&r.se(t,Ht,ye,"toHandleArchetype"),this.CA=t,t!==null?this.YS=new Jt(Lt.Link).add(t).It():this.YS=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Jt||r.o("new handle is not in an Adornment: "+t)),this.Ss=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Ax()||!t.lastInput.left)return!1;let i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),i!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let s=this.handle;if(s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),s===null)return;const n=s.part;if(!(n instanceof Jt)||!(n.adornedPart instanceof Nt))return;this.handle=s,this.isForwards=n===null||n.category==="RelinkTo",this.originalLink=n.adornedPart}const i=this.originalLink;i!==null&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=i.fromPort,this.originalFromNode=i.fromNode,this.originalToPort=i.toPort,this.originalToNode=i.toNode,this.KS.set(i.actualBounds),i.pointsCount>0&&(i.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=_.bc),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=i.getPoint(0))),i.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=_.bc),this.temporaryToNode!==null&&(this.temporaryToNode.location=i.getPoint(i.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(i,this.temporaryLink),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,i){if(t===null||i===null)return;i.adjusting=t.adjusting,i.corner=t.corner;let s=t.curve;(s===11||s===10)&&(s=0),i.curve=s,i.curviness=t.curviness,i.isTreeLink=t.isTreeLink,i.points=t.points,i.routing=t.routing,i.smoothness=t.smoothness,i.fromSpot=t.fromSpot,i.fromEndSegmentLength=t.fromEndSegmentLength,i.fromShortLength=t.fromShortLength,i.toSpot=t.toSpot,i.toEndSegmentLength=t.toEndSegmentLength,i.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=this.originalFromNode,s=this.originalFromPort,n=this.originalToNode,o=this.originalToPort,a=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const l=this.targetPort.part;l instanceof wt&&(this.isForwards?(n=l,o=this.targetPort):(i=l,s=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(n=null,o=null):(i=null,s=null):a=null;a!==null?(this.reconnectLink(a,this.isForwards?n:i,this.isForwards?o:s,this.isForwards),this.targetPort===null&&(this.isForwards?a.defaultToPoint=t.lastInput.documentPoint:a.defaultFromPoint=t.lastInput.documentPoint,a.$t()),this.transactionResult=this.name,t.T("LinkRelinked",a,this.isForwards?this.originalToPort:this.originalFromPort)):this.originalLink!==null&&this.doNoRelink(this.originalLink,this.isForwards),this.originalLink!==null&&this.originalLink.invalidateOtherJumpOvers(this.KS)}finally{this.stopTool()}}}reconnectLink(t,i,s,n){const o=s!==null&&s.portId!==null?s.portId:"";return n?(t.toNode=i,t.toPortId=o):(t.fromNode=i,t.fromPortId=o),!0}doNoRelink(t,i){}doDraggingMouseMove(t,i,s,n){t!==null?(this.copyPortProperties(t,i,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),s!==null?(this.copyPortProperties(s,n,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var Ee=(M=>(M[M.None=0]="None",M[M.Horizontal=1]="Horizontal",M[M.Vertical=2]="Vertical",M[M.All=3]="All",M))(Ee||{});class ve extends Zt{constructor(t){super();y(this,"Mr");y(this,"HS");y(this,"jS");y(this,"Ss");y(this,"Tx");y(this,"qS");y(this,"Bm");this.name="LinkReshaping",this.Mr=new Xt("Rectangle",{desiredSize:_.RL,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HS=new Xt("Diamond",{desiredSize:_.Su,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.jS=3,this.Ss=null,this.Tx=null,this.qS=new L,this.Bm=new E,t&&Object.assign(this,t)}getReshapingBehavior(t){return t?t.Nr:0}setReshapingBehavior(t,i){t.Nr=i}updateAdornments(t){if(t===null||!(t instanceof Nt))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.path;s!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(this.name),(i===null||i.WS!==t.pointsCount||i.JS!==t.resegmentable)&&(i=this.makeAdornment(s),i!==null&&(i.WS=t.pointsCount,i.JS=t.resegmentable,t.addAdornment(this.name,i))))}i===null&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,s=i.points,n=i.pointsCount,o=i.isOrthogonal;let a=null;if(s!==null&&n>1){a=new Jt,a.type=Lt.Link;const l=i.firstPickIndex,h=i.lastPickIndex,d=o?1:0;if(i.resegmentable&&i.computeCurve()!==9)for(let f=l+d;f<h-d;f++){const m=this.makeResegmentHandle(t,f);m!==null&&(m.segmentIndex=f,m.segmentFraction=.5,m.fromMaxLinks=999,a.add(m))}for(let f=l+1;f<h;f++){const m=this.makeHandle(t,f);if(m!==null){if(m.segmentIndex=f,f!==l)if(f===l+1&&o){const p=i.getPoint(l);let b=i.getPoint(l+1);B.u(p.x,b.x)&&B.u(p.y,b.y)?(b=i.getPoint(l-1),B.u(p.x,b.x)?(this.setReshapingBehavior(m,2),m.cursor="n-resize"):B.u(p.y,b.y)&&(this.setReshapingBehavior(m,1),m.cursor="w-resize")):B.u(p.x,b.x)?(this.setReshapingBehavior(m,2),m.cursor="n-resize"):B.u(p.y,b.y)&&(this.setReshapingBehavior(m,1),m.cursor="w-resize")}else if(f===h-1&&o){let p=i.getPoint(h-1);const b=i.getPoint(h);B.u(p.x,b.x)&&B.u(p.y,b.y)?(p=i.getPoint(h+1),B.u(p.x,b.x)?(this.setReshapingBehavior(m,2),m.cursor="n-resize"):B.u(p.y,b.y)&&(this.setReshapingBehavior(m,1),m.cursor="w-resize")):B.u(p.x,b.x)?(this.setReshapingBehavior(m,2),m.cursor="n-resize"):B.u(p.y,b.y)&&(this.setReshapingBehavior(m,1),m.cursor="w-resize")}else f===h||(this.setReshapingBehavior(m,3),m.cursor="move");a.add(m)}}a.adornedObject=t}return a}makeHandle(t,i){const s=this.handleArchetype;return s===null?null:s.copy().$S()}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t}makeResegmentHandle(t,i){const s=this.midHandleArchetype;return s===null?null:s.copy().$S()}get midHandleArchetype(){return this.HS}set midHandleArchetype(t){this.HS=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Jt||r.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedLink(){return this.Tx}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const i=this.handle.part.adornedPart;if(i instanceof Nt){if(this.Tx=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&this.handle.fromMaxLinks===999){const s=i.points.copy(),n=this.getResegmentingPoint();if(s.insertAt(this.handle.segmentIndex+1,n),i.isOrthogonal&&s.insertAt(this.handle.segmentIndex+1,n),i.points=s,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.qS=i.getPoint(this.handle.segmentIndex),this.Bm=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Tx=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.Bm),this.stopTool()}getResegmentingPoint(){return this.handle===null?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(X.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const s=this.adornedLink;if(s!==null&&s.resegmentable&&this.handle!==null){const n=this.handle.segmentIndex,o=s.getPoint(n-1),a=s.getPoint(n),l=s.getPoint(n+1);if(s.isOrthogonal){if(n>s.firstPickIndex+1&&n<s.lastPickIndex-1){let h=s.getPoint(n-2);if(this.isWithinResegmentingDistance(o,a)&&(this.isInLineOrtho(h,o,a,l,!0)||this.isInLineOrtho(h,o,a,l,!1))){const d=s.points.copy();this.isInLineOrtho(h,o,a,l,!0)?(d.setElt(n-2,new L(h.x,(l.y+h.y)/2)),d.setElt(n+1,new L(l.x,(l.y+h.y)/2))):(d.setElt(n-2,new L((l.x+h.x)/2,h.y)),d.setElt(n+1,new L((l.x+h.x)/2,l.y))),d.removeAt(n),d.removeAt(n-1),s.points=d,s.invalidateAdornments()}else if(h=s.getPoint(n+2),this.isWithinResegmentingDistance(a,l)&&(this.isInLineOrtho(o,a,l,h,!0)||this.isInLineOrtho(o,a,l,h,!1))){const d=s.points.copy();this.isInLineOrtho(o,a,l,h,!0)?(d.setElt(n-1,new L(o.x,(o.y+h.y)/2)),d.setElt(n+2,new L(h.x,(o.y+h.y)/2))):(d.setElt(n-1,new L((o.x+h.x)/2,o.y)),d.setElt(n+2,new L((o.x+h.x)/2,h.y))),d.removeAt(n+1),d.removeAt(n),s.points=d,s.invalidateAdornments()}}}else{const h=L.l();if(B.Nl(o.x,o.y,l.x,l.y,a.x,a.y,h)&&h.distanceSquaredPoint(a)<this.resegmentingDistance*this.resegmentingDistance){const d=s.points.copy();d.removeAt(n),s.points=d,s.invalidateAdornments()}L.i(h)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("LinkReshaped",this.adornedLink,this.Bm)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,s,n,o){return o?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance&&Math.abs(s.y-n.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance&&Math.abs(s.x-n.x)<this.resegmentingDistance}get resegmentingDistance(){return this.jS}set resegmentingDistance(t){this.jS=t}reshape(t){const i=this.adornedLink;if(i===null)return;const s=this.handle;if(s===null)return;i.startRoute();let n=s.segmentIndex;const o=this.getReshapingBehavior(s);if(i.isOrthogonal)if(n===i.firstPickIndex+1){const a=i.firstPickIndex+1;o===2?(i.setPointAt(a,i.getPoint(a-1).x,t.y),i.setPointAt(a+1,i.getPoint(a+2).x,t.y)):o===1&&(i.setPointAt(a,t.x,i.getPoint(a-1).y),i.setPointAt(a+1,t.x,i.getPoint(a+2).y))}else if(n===i.lastPickIndex-1){const a=i.lastPickIndex-1;o===2?(i.setPointAt(a-1,i.getPoint(a-2).x,t.y),i.setPointAt(a,i.getPoint(a+1).x,t.y)):o===1&&(i.setPointAt(a-1,t.x,i.getPoint(a-2).y),i.setPointAt(a,t.x,i.getPoint(a+1).y))}else{let a=n;const l=i.getPoint(a);if(!t.equalsApprox(l)){const h=i.getPoint(a-2),d=i.getPoint(a-1),f=i.getPoint(a+1),m=i.getPoint(a+2);B.u(l.x,f.x)&&B.u(f.y,m.y)?i.setPointAt(a+1,t.x,f.y):B.u(l.y,f.y)&&B.u(f.x,m.x)&&i.setPointAt(a+1,f.x,t.y),B.u(l.x,d.x)&&B.u(d.y,h.y)?i.setPointAt(a-1,t.x,d.y):B.u(l.y,d.y)&&B.u(d.x,h.x)&&i.setPointAt(a-1,d.x,t.y)}i.setPointAt(n,t.x,t.y)}else{i.setPointAt(n,t.x,t.y);let a=i.fromNode,l=i.fromPort;if(a!==null){const f=a.findVisibleNode();f!==null&&f!==a&&(a=f,l=a.port)}if(n===1&&l!==null&&i.computeSpot(!0,l).isNoSpot()){const f=l.getDocumentPoint(X.Center,L.l()),m=i.getLinkPointFromPoint(a,l,f,t,!0,L.l());i.setPointAt(0,m.x,m.y),L.i(f),L.i(m)}let h=i.toNode,d=i.toPort;if(h!==null){const f=h.findVisibleNode();f!==null&&f!==h&&(h=f,d=h.port)}if(n===i.pointsCount-2&&d!==null&&i.computeSpot(!1,d).isNoSpot()){const f=d.getDocumentPoint(X.Center,L.l()),m=i.getLinkPointFromPoint(h,d,f,t,!1,L.l());i.setPointAt(i.pointsCount-1,m.x,m.y),L.i(f),L.i(m)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink;if(i===null)return t;const s=this.handle;if(s===null)return t;const n=s.segmentIndex;switch(this.getReshapingBehavior(s)){case 3:return t;case 2:{const o=i.getPoint(n);return new L(o.x,t.y)}case 1:{const o=i.getPoint(n);return new L(t.x,o.y)}default:case 0:return i.getPoint(n)}}get originalPoint(){return this.qS}get originalPoints(){return this.Bm}}y(ve,"None",0),y(ve,"Horizontal",1),y(ve,"Vertical",2),y(ve,"All",3);class De extends Zt{constructor(t){super();y(this,"Cr");y(this,"Lr");y(this,"Oo");y(this,"Oc");y(this,"ZS");y(this,"Ms");y(this,"Mr");y(this,"Ss");y(this,"zm");y(this,"QS");y(this,"Ic");y(this,"Dx");y(this,"vx");y(this,"Fx");this.name="Resizing",this.Cr=new _(1,1).k(),this.Lr=new _(9999,9999).k(),this.Oo=new _(NaN,NaN).k(),this.Oc=!1,this.ZS=!0,this.Ms=null,this.Mr=new Xt("Rectangle",{alignmentFocus:X.Center,desiredSize:_.RL,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.zm=new L,this.QS=new _,this.Ic=new L,this.Dx=new _(0,0),this.vx=new _(1/0,1/0),this.Fx=new _(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Ar()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.resizeObject;let s=t.findAdornment(this.name);if(i!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null)){const n=i.getDocumentAngle();t.Ul()&&this.updateResizeHandles(s,n),t.addAdornment(this.name,s);return}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.resizeAdornmentTemplate;if(s){if(i=s.copy(),i===null)return null}else{i=new Jt,i.type=Lt.Spot,i.locationSpot=X.Center;const o=new Ui;o.isPanelMain=!0,i.add(o);let a=this.makeHandle(t,X.TopLeft);a!==null&&i.add(a),a=this.makeHandle(t,X.TopRight),a!==null&&i.add(a),a=this.makeHandle(t,X.BottomRight),a!==null&&i.add(a),a=this.makeHandle(t,X.BottomLeft),a!==null&&i.add(a),a=this.makeHandle(t,X.MiddleTop),a!==null&&i.add(a),a=this.makeHandle(t,X.MiddleRight),a!==null&&i.add(a),a=this.makeHandle(t,X.MiddleBottom),a!==null&&i.add(a),a=this.makeHandle(t,X.MiddleLeft),a!==null&&i.add(a)}return i.adornedObject=t,i}makeHandle(t,i){const s=this.handleArchetype;if(s===null)return null;const n=s.copy().$S();return n.alignment=i,n}updateResizeHandles(t,i){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.wR(t,i);else if(t instanceof Lt){const s=t.elements;for(;s.next();){const n=s.value;this.updateResizeHandles(n,i)}}}}wR(t,i){let s=t.alignment;s.isNoSpot()&&(s=X.Center);let n=i;if(s.x<=0)s.y<=0?n+=225:s.y>=1?n+=135:n+=180;else if(s.x>=1)s.y<=0?n+=315:s.y>=1&&(n+=45);else if(s.y<=0)n+=270;else if(s.y>=1)n+=90;else return;n=B.Ee(n),n<22.5?t.cursor="e-resize":n<67.5?t.cursor="se-resize":n<112.5?t.cursor="s-resize":n<157.5?t.cursor="sw-resize":n<202.5?t.cursor="w-resize":n<247.5?t.cursor="nw-resize":n<292.5?t.cursor="n-resize":n<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Jt||r.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof Jt&&r.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&this.adornedObject.part!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.Iu=!0,this.startTransaction(this.name),this.zm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Ic.set(this.adornedObject.part.location),this.QS.set(this.adornedObject.desiredSize),this.Fx=this.computeCellSize(),this.Dx=this.computeMinSize(),this.vx=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.Iu=!1,t.Fl=!0,this.stopTransaction(),this.handle=null,this.Ms=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){this.adornedObject!==null&&this.adornedObject.part!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||this.adornedObject===null||this.handle===null)return;const i=this.Dx,s=this.vx,n=this.Fx,o=t.lastInput.documentPoint,a=this.adornedObject.getLocalPoint(o,L.l()),l=this.computeReshape(),h=this.computeResize(a,this.handle.alignment,i,s,n,l);this.resize(h),t.maybeUpdate(),L.i(a)}doMouseUp(){const t=this.diagram;if(this.isActive&&this.adornedObject!==null&&this.handle!==null){const i=this.Dx,s=this.vx,n=this.Fx,o=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,L.l()),a=this.computeReshape(),l=this.computeResize(o,this.handle.alignment,i,s,n,a);this.resize(l),L.i(o),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const i=this.diagram,s=this.adornedObject;if(s===null)return;s.desiredSize=t.size;const n=s.part;if(n===null||this.handle===null)return;n.ensureBounds();const o=s.getDocumentPoint(this.handle.alignment.opposite());if(n instanceof Ft){const a=new E;a.add(n);let l;!this.dragsMembers&&!n.hasPlaceholder()&&(l=new ca,l.dragsMembers=!1),i.moveParts(a,this.oppositePoint.copy().subtract(o),!0,l)}else n.location=n.location.copy().subtract(o).add(this.oppositePoint);i.maybeUpdate()}computeResize(t,i,s,n,o,a){if(this.adornedObject===null)return Y.em;i.isNoSpot()&&(i=X.Center);const l=this.adornedObject.naturalBounds,h=l.x,d=l.y,f=l.x+l.width,m=l.y+l.height;let p=1;if(!a){let v=l.width,S=l.height;v<=0&&(v=1),S<=0&&(S=1),p=S/v}const b=L.l();B.tm(t.x,t.y,h,d,o.width,o.height,b);const x=l.copy();return i.x<=0?i.y<=0?(x.x=Math.max(b.x,f-n.width),x.x=Math.min(x.x,f-s.width),x.width=Math.max(f-x.x,s.width),x.y=Math.max(b.y,m-n.height),x.y=Math.min(x.y,m-s.height),x.height=Math.max(m-x.y,s.height),a||(x.height/x.width>=1?(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p):(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width),x.x=f-x.width,x.y=m-x.height)):i.y>=1?(x.x=Math.max(b.x,f-n.width),x.x=Math.min(x.x,f-s.width),x.width=Math.max(f-x.x,s.width),x.height=Math.max(Math.min(b.y-d,n.height),s.height),a||(x.height/x.width>=1?(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p):(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width),x.x=f-x.width)):(x.x=Math.max(b.x,f-n.width),x.x=Math.min(x.x,f-s.width),x.width=f-x.x,a||(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p,x.y=d+.5*(m-d-x.height))):i.x>=1?i.y<=0?(x.width=Math.max(Math.min(b.x-h,n.width),s.width),x.y=Math.max(b.y,m-n.height),x.y=Math.min(x.y,m-s.height),x.height=Math.max(m-x.y,s.height),a||(x.height/x.width>=1?(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p):(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width),x.y=m-x.height)):i.y>=1?(x.width=Math.max(Math.min(b.x-h,n.width),s.width),x.height=Math.max(Math.min(b.y-d,n.height),s.height),a||(x.height/x.width>=1?(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p):(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width))):(x.width=Math.max(Math.min(b.x-h,n.width),s.width),a||(x.height=Math.max(Math.min(p*x.width,n.height),s.height),x.width=x.height/p,x.y=d+.5*(m-d-x.height))):i.y<=0?(x.y=Math.max(b.y,m-n.height),x.y=Math.min(x.y,m-s.height),x.height=m-x.y,a||(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width,x.x=h+.5*(f-h-x.width))):i.y>=1&&(x.height=Math.max(Math.min(b.y-d,n.height),s.height),a||(x.width=Math.max(Math.min(x.height/p,n.width),s.width),x.height=p*x.width,x.x=h+.5*(f-h-x.width))),L.i(b),x}computeReshape(){let t=0;return this.adornedObject instanceof Xt&&(t=this.adornedObject._S()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){if(this.adornedObject===null)return _.bc;const t=this.adornedObject.minSize.copy(),i=this.minSize;return!isNaN(i.width)&&i.width>t.width&&(t.width=i.width),!isNaN(i.height)&&i.height>t.height&&(t.height=i.height),t}computeMaxSize(){if(this.adornedObject===null)return _.DP;const t=this.adornedObject.maxSize.copy(),i=this.maxSize;return!isNaN(i.width)&&i.width<t.width&&(t.width=i.width),!isNaN(i.height)&&i.height<t.height&&(t.height=i.height),t}computeCellSize(){var o;const t=new _(NaN,NaN),i=(o=this.adornedObject)==null?void 0:o.part;if(i){const a=i.resizeCellSize;!isNaN(a.width)&&a.width>0&&(t.width=a.width),!isNaN(a.height)&&a.height>0&&(t.height=a.height)}let s=this.cellSize;isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height);const n=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&n){const a=n.grid;a!==null&&a.visible&&this.isGridSnapEnabled&&(s=a.gridCellSize,isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.Cr}set minSize(t){if(!this.Cr.equals(t)){let i=t.width;isNaN(i)&&(i=0);let s=t.height;isNaN(s)&&(s=0),this.Cr.e(i,s)}}get maxSize(){return this.Lr}set maxSize(t){if(!this.Lr.equals(t)){let i=t.width;isNaN(i)&&(i=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.Lr.e(i,s)}}get cellSize(){return this.Oo}set cellSize(t){this.Oo.equals(t)||this.Oo.h(t)}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(t){this.Oc=t}get dragsMembers(){return this.ZS}set dragsMembers(t){this.ZS=t}get oppositePoint(){return this.zm}set oppositePoint(t){this.zm.equals(t)||this.zm.h(t)}get originalDesiredSize(){return this.QS}get originalLocation(){return this.Ic}}class Ve extends Zt{constructor(t){super();y(this,"tM");y(this,"eM");y(this,"Ms",null);y(this,"Mr",null);y(this,"Rx",null);y(this,"Ss",null);y(this,"iM");y(this,"Xm");y(this,"Ic");y(this,"sM");y(this,"nM");this.name="Rotating",this.tM=45,this.eM=2,this.Ic=new L,this.Ms=null,this.handleArchetype=new Xt("Ellipse",{desiredSize:_.Su,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.iM=0,this.Xm=new L(NaN,NaN),this.sM=0,this.nM=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Ar()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.rotateObject;if(i!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let s=t.findAdornment(this.name);if((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null){s.angle=i.getDocumentAngle(),s.hasPlaceholder()||(s.location=this.computeAdornmentLocation(i)),t.addAdornment(this.name,s);return}}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.rotateAdornmentTemplate;return s?i=s.copy():this.Rx!==null&&(i=this.Rx.copy()),i===null?null:(i.adornedObject=t,i)}get handleArchetype(){return this.Mr}set handleArchetype(t){this.Mr=t,t!==null?this.Rx=new Jt(Lt.Position,{locationSpot:X.Center}).add(t).It():this.Rx=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Jt||r.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof Jt&&r.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject===null||this.adornedObject.part===null||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.iM=this.adornedObject.angle,this.Xm=this.computeRotationPoint(this.adornedObject),this.Ic=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const i=t.part;if(i!==null){const s=i.locationObject;if(i.rotationSpot.isSpot())return t.getDocumentPoint(i.rotationSpot);if(t===i||t===s)return s.getDocumentPoint(i.locationSpot)}return t.getDocumentPoint(X.Center)}computeAdornmentLocation(t){let i=this.rotationPoint;i.isReal()||(i=this.computeRotationPoint(t));const s=t.getLocalPoint(i);let n=this.handleAngle;n=B.Ee(n),n=Math.round(Math.round(n/45)*45);const o=this.handleDistance;return n===0?s.x=t.naturalBounds.width+o:n===45?(s.x=t.naturalBounds.width+o,s.y=t.naturalBounds.height+o):n===90?s.y=t.naturalBounds.height+o:n===135?(s.x=-o,s.y=t.naturalBounds.height+o):n===180?s.x=-o:n===225?(s.x=-o,s.y=-o):n===270?s.y=-o:n===315&&(s.x=t.naturalBounds.width+o,s.y=-o),t.getDocumentPoint(s)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.Ms=null,this.Xm=new L(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const i=this.adornedObject;if(i===null||i.part===null)return;i.angle=t;const s=i.part;s.ensureBounds();const n=s.locationObject,o=s.rotateObject;if(n===o||n.isContainedBy(o)){const a=this.Ic.copy();s.location=a.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){var a;let i=this.rotationPoint.directionPoint(t)-this.handleAngle;const s=(a=this.adornedObject)==null?void 0:a.panel;s&&(i-=s.getDocumentAngle()),i=B.Ee(i);const n=Math.min(Math.abs(this.snapAngleMultiple),180),o=Math.min(Math.abs(this.snapAngleEpsilon),n/2);return!this.diagram.lastInput.shift&&n>0&&o>0&&(i%n<o?i=Math.floor(i/n)*n:i%n>n-o&&(i=(Math.floor(i/n)+1)*n)),B.Ee(i)}get snapAngleMultiple(){return this.tM}set snapAngleMultiple(t){this.tM=t}get snapAngleEpsilon(){return this.eM}set snapAngleEpsilon(t){this.eM=t}get originalAngle(){return this.iM}get rotationPoint(){return this.Xm}set rotationPoint(t){this.Xm=t.copy()}get handleAngle(){return this.sM}set handleAngle(t){this.sM=t}get handleDistance(){return this.nM}set handleDistance(t){this.nM=t}}class Ie extends Zt{constructor(e){super(),this.name="ClickSelecting",e&&Object.assign(this,e)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class Pi extends Zt{constructor(t){super();y(this,"Ec");this.name="Action",this.Ec=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,i=t.lastInput,s=t.findObjectAt(i.documentPoint,n=>{for(;n.panel!==null;){if(n.isActionable)return n;n=n.panel}return n});return s!==null&&s.isActionable?(this.Ec=s,t.vc=t.findObjectAt(i.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const t=this.diagram.lastInput,i=this.Ec;if(i===null)return;t.targetObject=i,i.actionDown!==null&&i.actionDown(t,i)}}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,i=this.Ec;if(i===null)return;t.targetObject=i,i.actionMove!==null&&i.actionMove(t,i)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,i=this.Ec;if(i===null)return;t.targetObject=i,i.actionUp!==null&&i.actionUp(t,i),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===i)return s;s=s.panel}return s},s=>s===i)}this.stopTool()}doCancel(){const t=this.diagram.lastInput,i=this.Ec;i!==null&&(t.targetObject=i,i.actionCancel!==null&&i.actionCancel(t,i),this.stopTool())}doStop(){this.Ec=null}}class Ci extends Zt{constructor(t){super();y(this,"Vl");y(this,"oM");y(this,"Oc");y(this,"rM");this.name="ClickCreating",this.Vl=null,this.oM=!0,this.Oc=!1,this.rM=new L(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.rM=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.rM))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const i=this.diagram,s=this.archetypeNodeData;if(s===null)return null;let n=null;try{if(i.T("ChangingSelection",i.selection),this.startTransaction(this.name),s instanceof _t)s.Di()&&(s.It(),n=s.copy(),n!==null&&i.add(n));else if(s!==null){const o=i.model.copyNodeData(s);i.model.addNodeData(o),n=i.findPartForData(o)}if(n!==null){const o=L.z(t.x,t.y);this.isGridSnapEnabled&&this.diagram.lM(n,t,o),n.location=o,i.allowSelect&&(i.clearSelection(!0),n.isSelected=!0),L.i(o)}i.invalidateDocumentBounds(),this.transactionResult=this.name,i.T("PartCreated",n)}finally{this.stopTransaction(),i.T("ChangedSelection",i.selection)}return n}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){t!==null&&r.xc(t,Ci,"archetypeNodeData"),this.Vl=t}get isDoubleClick(){return this.oM}set isDoubleClick(t){this.oM=t}get isGridSnapEnabled(){return this.Oc}set isGridSnapEnabled(t){this.Oc=t}}class Fu extends Zt{constructor(t){super();y(this,"th");y(this,"aM");y(this,"Bl");this.name="DragSelecting",this.th=175,this.aM=!1,this.Bl=new _t({layerName:"Tool",selectable:!1}).add(new Xt("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).It(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const i=t.lastInput;return!(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(i.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const i=this.computeBoxBounds();let s=this.box.findObject("SHAPE");s===null&&(s=this.box.findMainElement());const n=_.l().e(i.width,i.height);s!==null&&(s.desiredSize=n),this.box.Uc(i.x,i.y,!1),_.i(n),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.T("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new Y(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,s=i.lastInput,n=i.findPartsIn(t,this.isPartialInclusion);if(r.ur?s.meta:s.control)if(s.shift){const o=n.iterator;for(;o.next();){const a=o.value;a.isSelected&&(a.isSelected=!1)}}else{const o=n.iterator;for(;o.next();){const a=o.value;a.isSelected=!a.isSelected}}else if(s.shift){const o=n.iterator;for(;o.next();){const a=o.value;a.isSelected||(a.isSelected=!0)}}else{const o=new E,a=i.selection.iterator;for(;a.next();){const d=a.value;n.has(d)||o.add(d)}const l=o.iterator;for(;l.next();){const d=l.value;d.isSelected=!1}const h=n.iterator;for(;h.next();){const d=h.value;d.isSelected||(d.isSelected=!0)}}}get delay(){return this.th}set delay(t){this.th=t}get isPartialInclusion(){return this.aM}set isPartialInclusion(t){this.aM=t}get box(){return this.Bl}set box(t){t!==null&&t.It(),this.Bl=t}}class Ou extends Zt{constructor(t){super();y(this,"Ox");y(this,"LA");y(this,"Ro");y(this,"hM");this.name="Panning",this.Ox=new L,this.LA=new L,this.Ro=!1;const i=this;this.hM=()=>{const s=i.diagram;s!==null&&s.Le(c.document,"scroll",i.hM,!1),i.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.Ro?(t.lastInput.bubbles=!0,t.Et(c.document,"scroll",this.hM,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Ox.h(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Ox,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.AA()}doMouseUp(){this.AA(),this.stopTool()}AA(){const t=this.diagram;if(this.isActive&&t){if(this.Ro){t.lastInput.bubbles=!0;return}const i=t.position,s=t.firstInput.documentPoint,n=t.lastInput.documentPoint;let o=i.x+s.x-n.x,a=i.y+s.y-n.y;t.allowHorizontalScroll||(o=i.x),t.allowVerticalScroll||(a=i.y),t.position=this.LA.e(o,a)}}get bubbles(){return this.Ro}set bubbles(t){this.Ro=t}get originalPosition(){return this.Ox}}class pn{constructor(e){y(this,"Ix");y(this,"Ex");y(this,"cM");y(this,"fM");this.Ix=null,this.Ex=null,this.cM=null,this.fM=null,e&&Object.assign(this,e)}get mainElement(){return this.cM}set mainElement(e){this.cM=e}get show(){return this.Ix}set show(e){this.Ix!==e&&(this.Ix=e)}get hide(){return this.Ex}set hide(e){this.Ex!==e&&(this.Ex=e)}get valueFunction(){return this.fM}set valueFunction(e){this.fM=e}}class Zi{constructor(e,t,i){y(this,"ue");y(this,"Ux");y(this,"Vc");this.ue=e,this.Ux=t,this.Vc=i}}const je=class je extends Zt{constructor(t){super();y(this,"uM");y(this,"Vx");y(this,"dM");y(this,"gM");y(this,"Bx");y(this,"zx");y(this,"Gm");this.name="ContextMenu",this.uM=null,this.Vx=null,this.dM=null,this.gM=new L,this.Bx=null,this.Gm=!1;const i=this;this.zx=()=>i.stopTool(),t&&Object.assign(this,t)}xR(){const t=new pn;t.show=(l,h,d)=>d.showDefaultContextMenu(),t.hide=(l,h)=>h.hideDefaultContextMenu(),je.Bu=t;const i=this;this.zx=()=>i.stopTool();const s=r.Ni("div"),n=r.Ni("div");s.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",n.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const o=r.Ni("style");c.document.getElementsByTagName("head")[0].appendChild(o),o.sheet.insertRule(".goCXul { list-style: none; }",0),o.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),o.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const a=this.diagram;a!==null&&(a.Et(s,"contextmenu",je.oh,!1),a.Et(s,"selectstart",je.oh,!1),a.Et(n,"contextmenu",je.oh,!1)),s.className="goCXforeground",n.className="goCXbackground",c.document.body&&(c.document.body.appendChild(s),c.document.body.appendChild(n)),je.Ym=s,je.Km=n,je.mM=!0}static oh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.gM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Gm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const i=this.diagram,s=i.lastInput;let n=null;if(t instanceof qt||(t instanceof Ht?n=t:n=i.findObjectAt(s.documentPoint,null,o=>{var a;return!((a=o.layer)!=null&&a.isTemporary)})),n!==null){let o=n;for(;o!==null;){if(o.contextMenu!==null)return o;o=o.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return n.part}else if(i.contextMenu!==null)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Jt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Jt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const i=this.currentContextMenu;if(i===null)return;let s=null;i instanceof pn||(s=t.findObjectAt(t.lastInput.documentPoint,null,null),s!==null&&s.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(s)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(i===void 0&&(i=null),this.Gm)return;this.Gm=!0;let s=!1;if(i instanceof qt){const n=this.diagram.lastInput;n.targetObject=null,s=this.oA(null,n,this.diagram)}else t&&this.standardMouseSelect(),s=this.standardMouseClick();if(this.Gm=!1,!s){this.isActive=!0;const n=je.Bu;if(i===null&&(i=this.findObjectWithContextMenu()),i!==null){const o=i.contextMenu;o!==null?(this.currentObject=i instanceof Ht?i:null,this.showContextMenu(o,this.currentObject)):n!==null&&this.showContextMenu(n,this.currentObject)}else n!==null&&this.showContextMenu(n,null);this.currentContextMenu instanceof Jt&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Jt){const n=t;n.layerName="Tool",n.selectable=!1,n.scale=1/s.scale,n.category=this.name,n.hasPlaceholder()&&(n.placeholder.scale=s.scale);const o=n.diagram;o!==null&&o!==s&&o.remove(n),s.add(n),i!==null?n.adornedObject=i:n.data=s.model,n.ensureBounds(),this.positionContextMenu(n,i)}else t instanceof pn&&t.show!==null&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),a=s.measuredBounds,l=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=a.width),o.x+a.width>l.right&&(o.x-=a.width+5/n.scale),o.x<l.x&&(o.x=l.x),o.y+a.height>l.bottom&&(o.y-=a.height+5/n.scale),o.y<l.y&&(o.y=l.y),s.position=o}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;i!==null&&(i instanceof Jt?(t.remove(i),this.Vx!==null&&this.Vx.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof pn&&(i.hide!==null?i.hide(t,this):i.mainElement!==null&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}bR(){const t=this,i=new E;return i.add(new Zi("Copy",s=>s.commandHandler.copySelection(),s=>s.commandHandler.canCopySelection())),i.add(new Zi("Cut",s=>s.commandHandler.cutSelection(),s=>s.commandHandler.canCutSelection())),i.add(new Zi("Delete",s=>s.commandHandler.deleteSelection(),s=>s.commandHandler.canDeleteSelection())),i.add(new Zi("Paste",s=>s.commandHandler.pasteSelection(t.mouseDownPoint),s=>s.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new Zi("Select All",s=>s.commandHandler.selectAll(),s=>s.commandHandler.canSelectAll())),i.add(new Zi("Undo",s=>s.commandHandler.undo(),s=>s.commandHandler.canUndo())),i.add(new Zi("Redo",s=>s.commandHandler.redo(),s=>s.commandHandler.canRedo())),i.add(new Zi("Scroll To Part",s=>s.commandHandler.scrollToPart(),s=>s.commandHandler.canScrollToPart())),i.add(new Zi("Zoom To Fit",s=>s.commandHandler.zoomToFit(),s=>s.commandHandler.canZoomToFit())),i.add(new Zi("Reset Zoom",s=>s.commandHandler.resetZoom(),s=>s.commandHandler.canResetZoom())),i.add(new Zi("Group Selection",s=>s.commandHandler.groupSelection(),s=>s.commandHandler.canGroupSelection())),i.add(new Zi("Ungroup Selection",s=>s.commandHandler.ungroupSelection(),s=>s.commandHandler.canUngroupSelection())),i.add(new Zi("Edit Text",s=>s.commandHandler.editTextBlock(),s=>s.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;this.Bx===null&&(this.Bx=this.bR()),je.Ym.innerHTML="",je.Km.addEventListener("pointerdown",this.zx,!1);const i=this,s=r.Ni("ul");s.className="goCXul",je.Ym.appendChild(s),s.innerHTML="";const n=this.Bx.iterator;for(;n.next();){const o=n.value,a=o.Ux,l=o.Vc;if(!r.st(a)||r.st(l)&&!l(t))continue;const h=r.Ni("li");h.className="goCXli";const d=r.Ni("a");d.className="goCXa",d.href="#",d.Ux=a,d.addEventListener("pointerdown",function(f){return this.Ux(t),i.stopTool(),f.preventDefault(),!1},!1),d.textContent=o.ue,h.appendChild(d),s.appendChild(h)}je.Ym.style.display="block",je.Km.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==je.Bu)return;je.Ym.style.display="none",je.Km.style.display="none";const t=this.diagram;t!==null&&t.Le(je.Km,"pointerdown",this.zx,!1),this.currentContextMenu=null}doMouseWheel(){this.standardMouseWheel()}get currentContextMenu(){return this.uM}set currentContextMenu(t){this.uM=t,this.Vx=t instanceof Jt?t.adornedPart:null}get defaultTouchContextMenu(){return je.mM===!1&&je.Bu===null&&qt.isUsingDOM()&&this.xR(),je.Bu}set defaultTouchContextMenu(t){t===null&&(je.mM=!0),je.Bu=t}get currentObject(){return this.dM}set currentObject(t){this.dM=t}get mouseDownPoint(){return this.gM}};y(je,"Bu",null),y(je,"mM",!1),y(je,"Km"),y(je,"Ym");let yn=je;var Ru=(M=>(M[M.LostFocus=1]="LostFocus",M[M.MouseDown=2]="MouseDown",M[M.Tab=3]="Tab",M[M.Enter=4]="Enter",M))(Ru||{}),Iu=(M=>(M[M.SingleClick=1]="SingleClick",M[M.SingleClickSelected=2]="SingleClickSelected",M[M.DoubleClick=3]="DoubleClick",M))(Iu||{}),Bu=(M=>(M[M.None=1]="None",M[M.Active=2]="Active",M[M.Editing=3]="Editing",M[M.Validating=4]="Validating",M[M.Invalid=5]="Invalid",M[M.Validated=6]="Validated",M))(Bu||{});const Qe=class Qe extends Zt{constructor(t){super();y(this,"vi");y(this,"pM");y(this,"yM");y(this,"zl");y(this,"Gt");y(this,"wM");y(this,"xM");y(this,"bM");y(this,"Xx");y(this,"Gx");this.name="TextEditing",this.vi=new Se,this.pM=null,this.yM=2,this.zl=null,this.Gt=1,this.wM=1,this.xM=!0,this.bM=null,this.Xx=new pn,this.Gx=null,this.kR(this.Xx),t&&Object.assign(this,t)}kR(t){if(!qt.isUsingDOM())return;const i=r.Ni("textarea");this.Gx=i;const s=this;i.addEventListener("input",function(n){if(s.textBlock===null)return;const o=s.measureTemporaryTextBlock(this.value),a=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,o.measuredBounds.width)*a+"px",this.rows=Math.max(s.textBlock.lineCount,o.lineCount)},!1),i.addEventListener("keydown",function(n){if(n.isComposing||s.textBlock===null)return;const o=n.key;if(o==="Enter"){s.textBlock.isMultiline===!1&&n.preventDefault(),s.acceptText(4);return}else if(o==="Tab"){s.acceptText(3),n.preventDefault();return}else o==="Escape"&&(s.doCancel(),s.diagram!==null&&s.diagram.doFocus())},!1),i.addEventListener("focus",function(n){s.PR(n)},!1),i.addEventListener("blur",function(n){s.SR(n)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(n,o,a)=>{if(!(n instanceof Se)||!o||!o.div||!(a instanceof Qe))return;if(a.state===5){i.style.border="3px solid red",i.focus();return}const l=n.getDocumentPoint(X.Center),h=o.position,d=o.scale;let f=n.getDocumentScale()*d;f<a.minimumEditorScale&&(f=a.minimumEditorScale);const m=n.naturalBounds.width*f+6,p=n.naturalBounds.height*f+2,b=(l.x-h.x)*d,x=(l.y-h.y)*d,v=n.verticalAlignment,S=(n.lineHeight+n.spacingAbove+n.spacingBelow)*n.lineCount*f,P=.5*p-.5*S,T=v.y*p-v.y*S+v.offsetY-P-S/2;i.value=n.text,o.div.style.font=n.font;const A=1;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=f*100+"%",i.style.lineHeight="normal",i.style.width=m+"px",i.style.left=(b-m/2|0)-A+"px",i.style.top=(x+T|0)-A+"px",i.style.textAlign=n.textAlign,i.style.margin="0",i.style.padding=A+"px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=n.lineCount,i.textScale=f,i.className="goTXarea",o.div.appendChild(i),i.focus(),a.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(n,o)=>{n.div&&n.div.removeChild(i)}}get textBlock(){return this.pM}set textBlock(t){this.pM=t}get currentTextEditor(){return this.bM}set currentTextEditor(t){this.bM=t}get defaultTextEditor(){return this.Xx}set defaultTextEditor(t){this.Xx=t}get starting(){return this.yM}set starting(t){this.yM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||Qe.Bc&&Qe.Bc!==this&&(Qe.Bc.acceptText(2),Qe.Bc&&Qe.Bc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const i=t.lastInput.documentPoint,s=t.findObjectAt(i);if(s===null||!(s instanceof Se)||!s.editable||s.part===null||!s.part.canEdit())return!1;const n=s.part;return!(n===null||this.starting===2&&!n.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){Qe.Bc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let i=this.textBlock;if(i===null&&(i=t.findObjectAt(t.lastInput.documentPoint)),i===null||!(i instanceof Se)||(this.textBlock=i,i.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;i.textEditor!==null&&(s=i.textEditor),this.vi=this.textBlock.copy();const n=new Y(this.textBlock.getDocumentPoint(X.TopLeft),this.textBlock.getDocumentPoint(X.BottomRight));t.scrollToRect(n),s!==null&&s.show!==null&&s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.TA());break;case 1:case 4:case 3:if(t===4&&this.textBlock!==null&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.TA());break}}TA(){const t=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(t!==null&&s!==null){const n=t.text;let o="";if(s.valueFunction!==null&&(o=s.valueFunction()),!this.isValidText(t,n,o)){this.Gt=5,this.doError(n,o);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=o,this.doSuccess(n,o),i!==null&&i.T("TextEdited",t,n),this.stopTransaction(),this.stopTool(),i!==null&&i.doFocus()}}doError(t,i){const s=this.textBlock;if(s===null)return;s.errorFunction!==null&&s.errorFunction(this,t,i);const n=this.currentTextEditor;n!==null&&n.show!==null&&n.show(s,this.diagram,this)}doSuccess(t,i){const s=this.textBlock;s!==null&&s.textEdited!==null&&s.textEdited(s,t,i)}doDeactivate(){const t=this.diagram;if(t!==null){if(this.Gt=1,this.currentTextEditor!==null){const i=this.currentTextEditor;i!==null&&i.hide!==null&&i.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){Qe.Bc=null}PR(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.Gx;this.Gt===2&&(this.Gt=3),r.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}SR(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.Gx;r.st(i.focus)&&i.focus(),r.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,s){const n=this.textValidation;if(n!==null&&!n(t,i,s))return!1;const o=t.textValidation;return!(o!==null&&!o(t,i,s))}get textValidation(){return this.zl}set textValidation(t){this.zl=t}get minimumEditorScale(){return this.wM}set minimumEditorScale(t){this.wM=t}get selectsTextOnActivate(){return this.xM}set selectsTextOnActivate(t){this.xM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const i=this.vi;return i.text=t,this.textBlock!==null&&i.ht(this.textBlock.Xl,1/0),i}};y(Qe,"LostFocus",1),y(Qe,"MouseDown",2),y(Qe,"Tab",3),y(Qe,"Enter",4),y(Qe,"SingleClick",1),y(Qe,"SingleClickSelected",2),y(Qe,"DoubleClick",3),y(Qe,"StateNone",1),y(Qe,"StateActive",2),y(Qe,"StateEditing",3),y(Qe,"StateValidating",4),y(Qe,"StateInvalid",5),y(Qe,"StateValidated",6),y(Qe,"Bc",null);let ha=Qe;var Vu=(M=>(M[M.Default=1]="Default",M[M.AnimateLocations=2]="AnimateLocations",M[M.None=3]="None",M))(Vu||{});const Pn=class Pn{constructor(e){y(this,"a");y(this,"Ae");y(this,"Be");y(this,"Tr");y(this,"_n");y(this,"Io");y(this,"kM");y(this,"PM");y(this,"Hm");y(this,"Yx");y(this,"ke");y(this,"zc");y(this,"bn");y(this,"jm");y(this,"lh");y(this,"Kx");y(this,"qm");y(this,"Hx");y(this,"Xc");y(this,"Uu");y(this,"Wm");this.a=qt.Om(),this.Ae=!1,this.Hm=!1,this.Yx=!1,this.ke=!1,this.zc=!1,this.Hx=!0,this.Xc=1,this.Uu=!1,this.Be=!0,this.Tr=!0,this.Io=600,this.kM=!1,this.PM=!1,this._n=new F,this.bn=new wo,this.jm=new wo,this.bn.Ns=this,this.lh=new F,this.Kx=new F,this.qm=new F,this.Wm=new F,e&&Object.assign(this,e)}Eo(e){this.a=e}RU(){return this.a}canStart(e){return!0}Gl(e){return!this.Be||!this.canStart(e)?!1:(this._n.add(e),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.a.Te(),this.ke=!0,!0)}getBundleAnimation(){return this.jm}SM(){if(!this.Be||(this.jm.yi.count>0&&this.jm.start(),!this.ke))return;const e=this.bn,t=this.a,i=this._n.has("Model");if(i&&(this.zc=!0,this.Xc===1?(e.isViewportUnconstrained=!0,e.yi.clear(),e.add(t,"position",t.position.copy().offset(0,-200),t.position),e.add(t,"opacity",0,1)):this.Xc===3&&e.yi.clear(),this.Xc===2&&t.jx.equals(t.ct)?this.Hx=!0:this.Hx=!1,t.T("InitialAnimationStarting",this)),i&&!this.Tr||e.yi.count===0){this._n.clear(),this.ke=!1,e.yi.clear(),e.qx(t),this.zc=!1,t.C();return}this._n.clear(),t.Dr=!1;const s=e.yi.get(t);t.autoScale!==1&&s!==null&&(delete s.ae.scale,delete s.Cs.scale);const n=this;c.requestAnimationFrame(()=>{n.ke===!1||e.Ae||(t.getRenderingHint("temporaryPixelRatio")&&t.Cx(),t.MM(),n.ke=!1,e.start(),e.Ae&&(n.zu(),t.invalidateDocumentBounds(),e.DA(0),t.Sr(!0),n.Xu(),t.T("AnimationStarting",n)))})}NM(){return this._n.has("Trigger")&&this._n.count===1}vA(e,t,i,s){this.isTicking||this.NM()||e instanceof Nt&&(e.fromNode!==null||e.toNode!==null)||this.bn.add(e,"position",t,i,s)}Wx(e){return this.bn.Wx(e)}CM(e){return this.bn.CM(e)}MR(e){const t=this.lh,i=this;function s(){if(i.qm.count>0&&(t.addAll(i.qm),i.qm.clear(),i.Ae=!0),i.Ae===!1||t.count===0){i.Yx=!1;return}i.Kx.addAll(t);const n=i.Kx.iterator;for(;n.next();){const o=n.value;o.Ae!==!1&&(o.NR()?o.FA(!1):o.Gc=!0)}if(i.Kx.clear(),i.Ae===!1){c.requestAnimationFrame(s);return}i.zu(),i.a.Sr(),i.Xu(),c.requestAnimationFrame(s)}this.Ae?this.RA(e):(this.Ae=!0,this.Yx?this.RA(e):(this.Yx=!0,t.add(e),c.requestAnimationFrame(()=>s())))}RA(e){this.qm.add(e)}CR(){const e=this.lh.iterator;for(;e.next();)e.value.Gc=!1}zu(){if(this.Hm)return;const e=this.a;this.kM=e.skipsUndoManager,this.PM=e.wi,e.skipsUndoManager=!0,e.wi=!0,this.Hm=!0}Xu(){const e=this.a;e.skipsUndoManager=this.kM,e.wi=this.PM,this.Hm=!1}stopAnimation(e){const t=this.bn;if(this.ke===!0&&(this.ke=!1,this.zc=!1,this._n.clear(),t.LR()&&this.a.requestUpdate()),!this.Ae){t.yi.clear(),t.qx(this.a);return}if(t.Gu(!0),t.qx(null),e===!0){const i=this.lh.toArray();for(let s=0;s<i.length;s++)i[s].Gu(!0)}}Gu(e){this.lh.delete(e),this.lh.count===0&&(this.Ae=!1,this.a.requestUpdate()),e===this.defaultAnimation&&this.a.T("AnimationFinished",this)}Yc(e,t){this.ke&&(!this._n.has("Expand Tree")&&!this._n.has("Expand SubGraph")||(this.bn.Yc(e,t),this.OA(e)))}Kc(e,t){this.ke&&(!this._n.has("Collapse Tree")&&!this._n.has("Collapse SubGraph")||(this.bn.Kc(e,t),this.bn.LM(t,"position",t.position,t.position),this.OA(e)))}IA(e,t){!this.ke||e.equals(t)||this.NM()||(this.a.Qa||(e=t.copy()),this.bn.LM(this.a,"position",e,t))}EA(e,t){this.ke&&(this.NM()||this.bn.add(this.a,"scale",e,t))}AM(e,t){e.Fi&&(e.vr=t,this.Wm.add(e))}OA(e){const t=e.findLinksConnected();for(;t.next();){const i=t.value;i.Fi&&(i.vr=i.points.copy(),this.Wm.add(i))}}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e,e&&this.lh.each(t=>{!t.isAnimating&&t.runCount===1/0&&t.start()})}get duration(){return this.Io}set duration(e){e<1&&r.J(e,">= 1",Pn,"duration"),this.Io=e}get isAnimating(){return this.Ae}get isTicking(){return this.Hm}get isInitial(){return this.Tr}set isInitial(e){this.Tr=e}get defaultAnimation(){return this.bn}get activeAnimations(){return this.lh}get initialAnimationStyle(){return this.Xc}set initialAnimationStyle(e){this.Xc=e}static defineAnimationEffect(e,t){Pn.Jx.set(e,t)}static TM(e,t,i,s,n){e===null&&(e=[0,0,0,0]),t===null&&(t=[0,0,0,0]);let o=e[0],a=e[1];const l=e[2],h=e[3];let d=t[0],f=t[1];const m=t[2],p=t[3];l===0||l===100?(o=d,a=f):(m===0||m===100)&&(d=o,f=a),Math.abs(d-o)>180&&(d>o?o+=360:d+=360);const b=n(i,o,d-o,s)%360,x=n(i,a,f-a,s),v=n(i,l,m-l,s),S=n(i,h,p-h,s);return"hsla("+b+", "+x+"%, "+v+"%, "+S+")"}};y(Pn,"Jx",new nt),y(Pn,"Default",1),y(Pn,"AnimateLocations",2),y(Pn,"None",3);let Rs=Pn;{const M=Rs.Jx,e=(t,i,s,n,o,a)=>{t.position=new L(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a))};M.set("position:diagram",e),M.set("position",e),M.set("position:part",(t,i,s,n,o,a)=>{o<a?t.Uc(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a),!1):t.position=new L(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a))}),M.set("location",(t,i,s,n,o,a)=>{o<a?t.Uc(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a),!0):t.location=new L(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a))}),M.set("position:placeholder",(t,i,s,n,o,a)=>{o<a?t.Uc(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a),!1):t.position=new L(n(o,i.x,s.x-i.x,a),n(o,i.y,s.y-i.y,a))}),M.set("position:nodeCollapse",(t,i,s,n,o,a)=>{const l=t.actualBounds,h=s.actualBounds,d=h.x+h.width/2-l.width/2,f=h.y+h.height/2-l.height/2;o<a?t.Uc(n(o,i.x,d-i.x,a),n(o,i.y,f-i.y,a),!1):t.position=new L(n(o,i.x,d-i.x,a),n(o,i.y,f-i.y,a))}),M.set("desiredSize",(t,i,s,n,o,a)=>{t.desiredSize=new _(n(o,i.width,s.width-i.width,a),n(o,i.height,s.height-i.height,a))}),M.set("width",(t,i,s,n,o,a)=>{t.width=n(o,i,s-i,a)}),M.set("height",(t,i,s,n,o,a)=>{t.height=n(o,i,s-i,a)}),M.set("fill",(t,i,s,n,o,a)=>{t.fill=Rs.TM(i,s,o,a,n)}),M.set("stroke",(t,i,s,n,o,a)=>{t.stroke=Rs.TM(i,s,o,a,n)}),M.set("strokeWidth",(t,i,s,n,o,a)=>{t.strokeWidth=n(o,i,s-i,a)}),M.set("strokeDashOffset",(t,i,s,n,o,a)=>{t.strokeDashOffset=n(o,i,s-i,a)}),M.set("background",(t,i,s,n,o,a)=>{t.background=Rs.TM(i,s,o,a,n)}),M.set("opacity",(t,i,s,n,o,a)=>{t.opacity=n(o,i,s-i,a)}),M.set("scale",(t,i,s,n,o,a)=>{t.scale=n(o,i,s-i,a)}),M.set("angle",(t,i,s,n,o,a)=>{t.angle=n(o,i,s-i,a)})}const Yi=class Yi{constructor(e){y(this,"$x");y(this,"Jm");y(this,"Ae");y(this,"Yu");y(this,"Io");y(this,"Ls");y(this,"UA");y(this,"Hc");y(this,"yi");y(this,"Zx");y(this,"ae");y(this,"to");y(this,"Ku");y(this,"jc");y(this,"Qx");y(this,"_x");y(this,"Gc");y(this,"DM");y(this,"tb");y(this,"Ns");y(this,"a");y(this,"vM");y(this,"FM");y(this,"RM");this.a=null,this.Ns=null,this.DM=null,this.tb=null,this.vM=!1,this.Ae=!1,this.Gc=!1,this.ae=0,this.to=0,this.$x=Yi.EaseInOutQuad,this.Jm=Yi.EaseInOutQuad,this.Ku=!1,this.jc=!1,this.Qx=1,this._x=0,this.Io=NaN,this.Ls=NaN,this.FM=0,this.Yu=null,this.UA=L.gn,this.yi=new nt,this.Zx=new nt,this.Hc=new F,this.RM=1,e&&Object.assign(this,e)}suspend(){this.Gc=!0}advanceTo(e,t){t&&(this.Gc=!1),this.Ku&&e>=this.Ls&&(this.jc=!0,e=e-this.Ls),this.FM=e,this.FA(!0),this.Ns.zu(),this.a.Sr(),this.Ns.Xu(),this.a.redraw()}qx(e){if(this.Zx.clear(),this.jc=!1,this._x=0,this.Ls=NaN,this.Hc.count>0&&this.Hc.clear(),e!==null){const t=e.links;for(;t.next();)t.value.vr=null}}LR(){return this.yi.count>0}start(){if(this.yi.count===0)return this;if(this.Ae)return this;let e=this.a;const t=this.yi.iterator;for(;t.next();){const s=t.key;e===null&&(s instanceof qt?e=s:s instanceof Ht&&(e=s.diagram))}if(e!==null)this.a=e,this.Ns=e.animationManager;else return this;const i=this.Ns;return i.isEnabled===!1?this:(this.Ls=isNaN(this.Io)?i.duration:this.Io,this.Jm=this.$x,i.zc&&i.Xc===1&&this===i.defaultAnimation&&(this.Jm=Yi.EaseOutExpo,this.Ls=isNaN(this.Io)?i.duration===600?900:i.duration:this.Io),this.RM=e.scrollMode,this.isViewportUnconstrained&&(e.ah=2),i.zu(),this.Hc.each(s=>{s.data=null,e.add(s)}),i.Xu(),this.Ae=!0,this.ae=+new Date,this.to=this.ae+this.Ls,i.MR(this),this)}addTemporaryPart(e,t){return e.Di()?(this.Hc.add(e),this.a=t,this):this}add(e,t,i,s,n){if(this.a===null&&(e instanceof qt?this.a=e:e instanceof Ht&&e.diagram!==null&&(this.a=e.diagram)),e instanceof _t){if(!e.isAnimated)return this;t==="position"&&(t="position:part")}return this.LM(e,t,i,s,n),this}LM(e,t,i,s,n){const o=this.yi;let a,l,h;if(e instanceof qt&&t==="position"&&(t="position:diagram"),(t==="fill"||t==="stroke"||t==="background")&&(me.Uo(i),me.OM(),i=[me.ze.n0,me.ze.n1,me.ze.n2,me.ze.n3],me.Uo(s),me.OM(),s=[me.ze.n0,me.ze.n1,me.ze.n2,me.ze.n3]),o.has(e))a=o.get(e),l=a.ae,h=a.Cs,l[t]===void 0&&(l[t]=this.Hu(i)),h[t]=this.Hu(s);else{if(t==="position"&&i.equalsApprox(s))return;l={},h={},l[t]=this.Hu(i),h[t]=this.Hu(s),a=new Mp(l,h,n),o.set(e,a)}const d=l[t];d instanceof L&&!d.isReal()&&d.h(this.UA),n&&t.indexOf("position:")===0&&e instanceof _t?a.eb.location=this.Hu(e.location):n&&(a.eb[t]=this.Hu(i))}Hu(e){return e instanceof L||e instanceof _?e.copy():e}AR(e){const t=this.yi;if(t.has(e)){const i=t.get(e);i.ib=!0}}Wx(e){if(!this.Ae)return!1;const t=this.yi.get(e);return t!==null&&t.ib}CM(e){if(!this.Ae)return!1;const t=this.yi.get(e);return t!==null&&!!(t.ae.position||t.ae["position:part"]||t.ae.location)}NR(){if(this.Hc.count>0)return!0;const e=this.yi.iterator;for(;e.next();){const t=e.key;if(t instanceof Ht&&t.diagram!==null||t instanceof qt)return!0}return!1}FA(e){if(this.Gc&&!e)return;const t=this.Ns;if(this.Ae===!1)return;const i=+new Date;let s=i>this.to?this.Ls:i-this.ae;e&&(s=this.FM,s<this.Ls?(this.ae=+new Date-s,this.to=this.ae+this.Ls):s=this.Ls),t.zu(),this.DA(s),this.a.Sr(!0),t.Xu(),i>this.to&&(this.Ku&&!this.jc?(this.ae=+new Date,this.to=this.ae+this.Ls,this.jc=!0):this.Gu(!1))}DA(e){const t=this.Ls,i=this.yi.iterator,s=this.jc;for(;i.next();){const n=i.key;if(n instanceof Ht&&n.diagram===null)continue;const o=i.value,a=s?o.Cs:o.ae,l=s?o.ae:o.Cs,h=Rs.Jx;for(const d in l)d==="position"&&(l["position:placeholder"]||l["position:nodeCollapse"])||h.get(d)!==null&&h.get(d)(n,a[d],l[d],this.Jm,e,t,this)}}stop(){return this.Ae?(this.Gu(!0),this):this}Gu(e){if(this.tb!==null&&this.tb.TR(this.DM),!this.Ae)return;const t=this.a,i=this.Ns;i.zc=!1,this.Ae=!1,this.Gc=!1,i.zu();const s=this.yi,n=this.Hc.iterator;for(;n.next();)t.remove(n.value);const o=this.Ku,a=s.iterator,l=Rs.Jx;for(;a.next();){const d=a.key,f=a.value,m=o?f.Cs:f.ae,p=o?f.ae:f.Cs,b=f.eb;for(const x in p)if(l.get(x)!==null){let v=x;f.sb&&(v==="position:nodeCollapse"||v==="position:placeholder")&&(v="position"),l.get(v)(d,m[x],b[x]!==void 0?b[x]:f.sb?m[x]:p[x],this.Jm,this.Ls,this.Ls,this)}f.sb&&b.location!==void 0&&d instanceof _t&&(d.location=b.location),f.ib&&d instanceof _t&&d.Xe(!1)}this._x++;const h=!e&&this.Qx>this._x;if(!h&&(this===i.jm||this===i.defaultAnimation)&&this.yi.clear(),t.nb.clear(),t.yS(!1),t.invalidateDocumentBounds(),t.C(),t.Sr(!0),i.defaultAnimation===this){const d=i.Wm.iterator;for(;d.next();)d.value.DR();i.Wm.clear()}if(t.Sr(!0),this.isViewportUnconstrained&&(t.scrollMode=this.RM),i.Xu(),h){this.jc=!1,this.start();return}this.qx(null),t.VA(),i.Gu(this),this.Yu&&this.Yu(this),t.requestUpdate()}Yc(e,t){const i=t.actualBounds;let s=null;if(t instanceof Ft&&(s=t.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(X.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(e,"position",n,e.position,!1)}else this.add(e,"position",new L(i.x+i.width/2,i.y+i.height/2),e.position,!1);this.add(e,"scale",.01,e.scale,!1),e instanceof Ft&&this.vR(e,t)}vR(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof wt&&this.Yc(s,t)}}Kc(e,t){if(!e.isVisible())return;let i=null;if(t instanceof Ft&&(i=t.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(X.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(e,"position:placeholder",e.position,s,!0)}else this.add(e,"position:nodeCollapse",e.position,t,!0);this.add(e,"scale",e.scale,.01,!0),this.AR(e),e instanceof Ft&&this.FR(e,t)}FR(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof wt&&this.Kc(s,t)}}get duration(){return this.Io}set duration(e){r.s(e,"number",Yi,"duration"),e<1&&r.J(e,">= 1",Yi,"duration"),this.Io=e}get reversible(){return this.Ku}set reversible(e){this.Ku=e}get runCount(){return this.Qx}set runCount(e){e>0?this.Qx=e:r.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Yu}set finished(e){this.Yu!==e&&(e!==null&&r.S(e,Yi,"finished"),this.Yu=e)}get easing(){return this.$x}set easing(e){this.$x=e}get isViewportUnconstrained(){return this.vM}set isViewportUnconstrained(e){this.vM=e}get isAnimating(){return this.Ae}getTemporaryState(e){let t=this.Zx.get(e);return t===null&&(t={},this.Zx.set(e,t)),t}};y(Yi,"EaseLinear",(e,t,i,s)=>i*e/s+t),y(Yi,"EaseInOutQuad",(e,t,i,s)=>(e/=s/2,e<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t)),y(Yi,"EaseInQuad",(e,t,i,s)=>i*(e/=s)*e+t),y(Yi,"EaseOutQuad",(e,t,i,s)=>-i*(e/=s)*(e-2)+t),y(Yi,"EaseInExpo",(e,t,i,s)=>e===0?t:i*Math.pow(2,10*(e/s-1))+t),y(Yi,"EaseOutExpo",(e,t,i,s)=>e===s?t+i:i*(-Math.pow(2,-10*e/s)+1)+t);let wo=Yi;class Mp{constructor(e,t,i){y(this,"ae");y(this,"Cs");y(this,"eb");y(this,"sb");y(this,"ib");this.ae=e,this.Cs=t,this.eb={},this.sb=i,this.ib=!1}}var zu=(M=>(M[M.Default=1]="Default",M[M.Immediate=2]="Immediate",M[M.Bundled=3]="Bundled",M))(zu||{});const Co=class Co{constructor(e,t,i){y(this,"Ti");y(this,"yn");y(this,"ju");y(this,"qc");this.Ti=null,this.yn=e,this.ju=i||1,this.qc=null,t!==void 0&&(this.qc=t,i===void 0&&(this.ju=2))}copy(){const e=new Co(this.yn);e.ju=this.ju;const t=this.qc;if(t!==null){const i={};t.duration!==void 0&&(i.duration=t.duration),t.finished!==void 0&&(i.finished=t.finished),t.easing!==void 0&&(i.easing=t.easing),e.qc=i}return e}get propertyName(){return this.yn}set propertyName(e){this.yn=e}get animationSettings(){return this.qc}set animationSettings(e){this.qc=e}RR(e){const t=this.qc;t!==null&&(t.duration&&(e.duration=t.duration),t.finished&&(e.finished=t.finished),t.easing&&(e.easing=t.easing))}get startCondition(){return this.ju}set startCondition(e){this.ju=e}};y(Co,"Default",1),y(Co,"Immediate",2),y(Co,"Bundled",3);let ur=Co;class Oi{constructor(e){y(this,"a");y(this,"Pt");y(this,"Zt");y(this,"Fr");y(this,"Yl");y(this,"Kl");y(this,"Hl");y(this,"jl");y(this,"ql");y(this,"Wl");y(this,"Jl");y(this,"$l");y(this,"Zl");y(this,"Ql");y(this,"_l");y(this,"ta");y(this,"Vc");y(this,"ea");y(this,"ob");y(this,"$m");y(this,"qu");y(this,"Ct");F.Je(this),this.a=null,this.Ct=new E,this.Pt="",this.Zt=1,this.Fr=!1,this.Yl=!0,this.Kl=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Vc=!0,this.ea=!0,this.ob=!0,this.$m=!1,this.qu=[],e&&Object.assign(this,e)}OR(){const e=this.Ct;for(let t=0;t<e.length;t++)e.r[t].IM(null);e.clear(),this.qu.length=0}Eo(e){this.a=e}toString(e){e===void 0&&(e=0);const t='Layer "'+this.name+'"';if(e<=0)return t;let i=0,s=0,n=0,o=0,a=0;const l=this.Ct.iterator;for(;l.next();){const d=l.value;d instanceof Ft?n++:d instanceof wt?s++:d instanceof Nt?o++:d instanceof Jt?a++:i++}let h="";if(i>0&&(h+=i+" Parts "),s>0&&(h+=s+" Nodes "),n>0&&(h+=n+" Groups "),o>0&&(h+=o+" Links "),a>0&&(h+=a+" Adornments "),e>1){const d=this.Ct.iterator;for(;d.next();){const f=d.value;h+=`
    `+f.toString();const m=f.data;m!==null&&F.xs(m)&&(h+=" #"+F.xs(m)),f instanceof wt?h+=" "+r.toString(m):f instanceof Nt&&(h+=" "+r.toString(f.fromNode)+" "+r.toString(f.toNode))}}return t+" "+this.Ct.count+": "+h}findObjectAt(e,t,i){if(t===void 0&&(t=null),i===void 0&&(i=null),this.ea===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(s=!0);const n=L.l(),o=this.Ct.r,a=o.length;for(let l=a;l--;){const h=o[l];if(s===!0&&h.Ul()===!1||!h.isVisible())continue;n.h(e),n.Ki(h.Js);let d=h.BA(n,t,i);if(d!==null&&(t!==null&&(d=t(d)),d!==null&&(i===null||i(d))))return L.i(n),d}return L.i(n),null}findObjectsAt(e,t,i,s){if(t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof E)&&!(s instanceof F)&&(s=new F),this.ea===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(n=!0);const o=L.l(),a=this.Ct.r,l=a.length;for(let h=l;h--;){const d=a[h];if(n===!0&&d.Ul()===!1||!d.isVisible())continue;o.h(e),o.Ki(d.Js);let f=d;d.zA(o,t,i,s)&&(t!==null&&(f=t(f)),f!==null&&(i===null||i(f))&&s.add(f))}return L.i(o),s}findObjectsIn(e,t,i,s,n){if(t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof E)&&!(n instanceof F)&&(n=new F),this.ea===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(e)&&(o=!0);const a=this.Ct.r,l=a.length;for(let h=l;h--;){const d=a[h];if(o===!0&&d.Ul()===!1||!d.isVisible())continue;let f=d;d.Zm(e,t,i,s,n)&&(t!==null&&(f=t(f)),f!==null&&(i===null||i(f))&&n.add(f))}return n}MS(e,t,i,s,n,o,a){if(this.ea===!1)return n;const l=this.Ct.r,h=l.length;for(let d=h;d--;){const f=l[d];if(a===!0&&f.Ul()===!1||!o(f)||!f.isVisible())continue;let m=f;f.Zm(e,t,i,s,n)&&(t!==null&&(m=t(m)),m!==null&&(i===null||i(m))&&n.add(m))}return n}findObjectsNear(e,t,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof E||n instanceof F)&&(o=n),n=!0),!(o instanceof E)&&!(o instanceof F)&&(o=new F),this.ea===!1)return o;let a=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(a=!0);const l=L.l(),h=L.l(),d=this.Ct.r,f=d.length;for(let m=f;m--;){const p=d[m];if(a===!0&&p.Ul()===!1||!p.isVisible())continue;l.h(e),l.Ki(p.Js),h.e(e.x+t,e.y),h.Ki(p.Js);let b=p;p.XA(l,h,i,s,n,o)&&(i!==null&&(b=i(b)),b!==null&&(s===null||s(b))&&o.add(b))}return L.i(l),L.i(h),o}EM(){return this.Ct.r}As(e,t){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(s===0)return;const n=r.nt(),o=r.nt();for(let a=0;a<s;a++){const l=i[a];if(l.UM=a,l instanceof Nt){if(l.Fi===!1)continue}else if(l instanceof Jt&&l.adornedPart!==null)continue;const h=l.actualBounds;l.isVisible()&&h.UL(t,10)?(l.As(!0),n.push(l)):(l.As(!1),l.adornments!==null&&l.adornments.count>0&&o.push(l))}for(let a=0;a<n.length;a++){const l=n[a];l.VM();const h=l.adornments;for(;h.next();){const d=h.value;d.ht(1/0,1/0),d.Ut(),d.As(!0)}}for(let a=0;a<o.length;a++)o[a].VM();r.Z(n),r.Z(o)}Wu(e){let t=1;return this.Zt!==1&&(t=e.globalAlpha,e.globalAlpha=t*this.Zt),t}GA(e,t){for(let i=0;i<t;i++)e[i].Wc()}Ge(e,t,i){if(!this.visible||this.Zt===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(n===0)return;e.Fr&&this.GA(s,n);const o=this.Wu(e),a=this.qu;a.length=0;const l=t.scale,h=Y.l();for(let d=0;d<n;d++){const f=s[d];this.Qm(e,f,t,a,l,h,!0)}Y.i(h),e.Fr&&this.GA(s,n),e.globalAlpha=o}OU(e,t,i){if(!this.visible||this.Zt===0)return;const s=this.Ct.r,n=s.length;if(n===0)return;const o=this.Wu(e),a=this.qu;a.length=0;const l=t.scale,h=Y.l();for(let d=0;d<n;d++){const f=s[d];i.has(f)||this.Qm(e,f,t,a,l,h,!0)}Y.i(h),e.globalAlpha=o}IR(e,t,i,s){if(!this.visible||this.Zt===0||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(o===0)return;const a=this.Wu(e),l=this.qu;l.length=0;const h=t.scale,d=Y.l();for(let f=0;f<o;f++){const m=n[f];i.has(m)&&this.Qm(e,m,t,l,h,d,!1)}Y.i(d),e.globalAlpha=a}ER(e,t,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const a=this.Wu(e);o.Ge(e,i),e.globalAlpha=a}}else{const a=this.Wu(e),l=i.scale,h=Y.l(),d=this.Ct.r,f=d.length;for(let m=0;m<f;m++){const p=d[m];!n&&p===o||this.Qm(e,p,i,null,l,h,!1)}Y.i(h),e.globalAlpha=a}}IU(e,t,i){if(!this.visible||this.Zt===0)return;const s=this.Wu(e),n=this.qu;n.length=0;const o=t.scale,a=Y.l(),l=this.Ct.r,h=l.length,d=i.length;for(let f=0;f<h;f++){const m=l[f],p=m.hh(m.actualBounds);this.UR(p,i,d,o)&&this.Qm(e,m,t,n,o,a,!0)}Y.i(a),e.globalAlpha=s}Qm(e,t,i,s,n,o,a){if(a&&!t.Ul()){e.removePartFromView(t);return}if(s!==null&&t instanceof Nt&&(t.isOrthogonal&&s.push(t),t.Fi===!1)){e.removePartFromView(t);return}let l=!1,h=t.containingGroup;for(;h!==null;)l?h.he!==null&&o.intersectRect(h.he):h.he!==null&&(l=!0,o.h(h.he)),h=h.containingGroup;const d=t.actualBounds;let f=!1;if(l&&t.isVisible()){if(!o.intersectsRect(d)){e.removePartFromView(t);return}f=!o.containsRect(d)}f&&(e.save(),e instanceof Ri?e.partClipRect=o.copy():(e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.clip())),d.width*n>i._m||d.height*n>i._m?t.Ge(e,i):this.VR(e,t,i),f&&(e.restore(),e.clearContextCache(!0))}VR(e,t,i){if(e instanceof Ri){t.Ge(e,i);return}const s=t.actualBounds,n=t.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!t.isVisible())return;const o=t.v;if(t.background===null){t.kn(e,"rgba(0,0,0,0.3)",!0,!1,n,s),e.fillRect(s.x,s.y,s.width,s.height);return}if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),t.kn(e,t.background,!0,!1,n,s),e.fillRect(0,0,n.width/2,n.height/2),!o.RP()){const a=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*a,-o.m12*a,-o.m21*a,o.m11*a,a*(o.m21*o.dy-o.m22*o.dx),a*(o.m12*o.dx-o.m11*o.dy))}}UR(e,t,i,s){const n=2/s,o=4/s;for(let a=0;a<i;a++){const l=t[a];if(!(l.width===0||l.height===0)&&e.intersects(l.x-n,l.y-n,l.width+o,l.height+o))return!0}return!1}t(e,t,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,e,this,t,i,s,n)}ch(e,t,i){const s=this.Ct;if(t.IM(this),e>=s.count)e=s.count;else if(s.elt(e)===t)return-1;s.insertAt(e,t),t.tp(i);const n=this.diagram;return n!==null&&(i?n.C():n.ch(t)),this.rb(e,t),e}ri(e,t,i){if(!i&&t.layer!==this&&t.layer!==null)return t.layer.ri(e,t,i);const s=this.Ct;if(e<0||e>=s.length){if(e=s.indexOf(t),e<0)return-1}else if(s.elt(e)!==t&&(e=s.indexOf(t),e<0))return-1;t.ep(i),s.removeAt(e);const n=this.diagram;return n!==null&&(i?n.C():n.ri(t)),t.IM(null),e}rb(e,t){e=this.BR(e,t),t instanceof Ft&&this.zR(e,t),t.svg!==null&&t.svg.remove()}BR(e,t){const i=t.zOrder;if(isNaN(i))return e;const s=this.Ct,n=s.count;if(n<=1)return e;if(e<0&&(e=s.indexOf(t)),e<0)return-1;let o=e-1,a=NaN;for(;o>=0&&(a=s.elt(o).zOrder,!!isNaN(a));)o--;let l=e+1,h=NaN;for(;l<n&&(h=s.elt(l).zOrder,!!isNaN(h));)l++;if(!isNaN(a)&&a>i)for(;;){if(o===-1||a<=i)return o++,o===e?e:(s.removeAt(e),s.insertAt(o,t),o);for(a=NaN;--o>=0&&(a=s.elt(o).zOrder,!!isNaN(a)););}else if(!isNaN(h)&&h<i)for(;;){if(l===n||h>=i)return l--,l===e?e:(s.removeAt(e),s.insertAt(l,t),l);for(h=NaN;++l<n&&(h=s.elt(l).zOrder,!!isNaN(h)););}return e}zR(e,t){if(t===null||!isNaN(t.zOrder))return;this.XR(e,t);const i=t.containingGroup;i!==null&&this.rb(-1,i)}XR(e,t){if(t.memberParts.count===0)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const a=s[o];if(a===t&&(e=o,i>=0)||i<0&&a.containingGroup===t&&(i=o,e>=0))break}if(!(i<0)&&i<e){const o=this.Ct;o.removeAt(e),o.insertAt(i,t)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.a}get name(){return this.Pt}set name(e){const t=this.Pt;if(t!==e){const i=this.diagram;if(i!==null){t===""&&r.o("Cannot rename default Layer to: "+e);const n=i.layers;for(;n.next();)n.value.name===e&&r.o("Layer.name is already present in this diagram: "+e)}this.Pt=e,this.t("name",t,e);const s=this.Ct.iterator;for(;s.next();){const n=s.value;n.layerName=this.Pt}}}get opacity(){return this.Zt}set opacity(e){const t=this.Zt;if(t!==e){(e<0||e>1)&&r.J(e,"0 <= value <= 1",Oi,"opacity"),this.Zt=e;const i=this.diagram;i!==null&&i.C(),this.t("opacity",t,e)}}get isViewportAligned(){return this.$m}set isViewportAligned(e){const t=this.$m;t!==e&&(this.$m=e,this.diagram&&(this.YA(),this.diagram.C()),this.t("isViewportAligned",t,e),e&&(this.isInDocumentBounds=!1))}YA(){if(!this.$m)return;const e=this.diagram;if(e===null)return;const t=this.Ct.r,i=t.length,s=e.wt,n=e.xt;for(let o=0;o<i;o++){const a=t[o],l=a.naturalBounds.width,h=a.naturalBounds.height;let d=a.alignment;(d.isDefault()||!d.isSpot())&&(d=X.BottomRight);let f=a.alignmentFocus;f.isDefault()&&(f=new X(d.x,d.y));const m=d.x*s+d.offsetX-(f.x*l+f.offsetX),p=d.y*n+d.offsetY-(f.y*h+f.offsetY),b=L.z(m,p);e.GR(b),a.Uc(b.x,b.y,!0),L.i(b),a.it=1/e.scale}}get isTemporary(){return this.Fr}set isTemporary(e){const t=this.Fr;t!==e&&(this.Fr=e,this.t("isTemporary",t,e))}get visible(){return this.Vc}set visible(e){const t=this.Vc;if(t!==e){this.Vc=e;const i=this.Ct.iterator;for(;i.next();)i.value.Xe(e);const s=this.diagram;s!==null&&s.C(),this.t("visible",t,e)}}get pickable(){return this.ea}set pickable(e){const t=this.ea;t!==e&&(this.ea=e,this.t("pickable",t,e))}get isInDocumentBounds(){return this.ob}set isInDocumentBounds(e){const t=this.ob;t!==e&&(this.ob=e,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",t,e))}get allowCopy(){return this.Yl}set allowCopy(e){const t=this.Yl;t!==e&&(this.Yl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.Kl}set allowDelete(e){const t=this.Kl;t!==e&&(this.Kl=e,this.t("allowDelete",t,e))}get allowTextEdit(){return this.Hl}set allowTextEdit(e){const t=this.Hl;t!==e&&(this.Hl=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.jl}set allowGroup(e){const t=this.jl;t!==e&&(this.jl=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.ql}set allowUngroup(e){const t=this.ql;t!==e&&(this.ql=e,this.t("allowUngroup",t,e))}get allowLink(){return this.Wl}set allowLink(e){const t=this.Wl;t!==e&&(this.Wl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Jl}set allowRelink(e){const t=this.Jl;t!==e&&(this.Jl=e,this.t("allowRelink",t,e))}get allowMove(){return this.$l}set allowMove(e){const t=this.$l;t!==e&&(this.$l=e,this.t("allowMove",t,e))}get allowReshape(){return this.Zl}set allowReshape(e){const t=this.Zl;t!==e&&(this.Zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Ql}set allowResize(e){const t=this.Ql;t!==e&&(this.Ql=e,this.t("allowResize",t,e))}get allowRotate(){return this._l}set allowRotate(e){const t=this._l;t!==e&&(this._l=e,this.t("allowRotate",t,e))}get allowSelect(){return this.ta}set allowSelect(e){const t=this.ta;t!==e&&(this.ta=e,this.t("allowSelect",t,e))}}var Wl=(M=>(M[M.None=1]="None",M[M.Uniform=2]="Uniform",M[M.UniformToFill=3]="UniformToFill",M))(Wl||{}),ju=(M=>(M[M.All=1]="All",M[M.NotDirected=2]="NotDirected",M[M.NotDirectedFast=3]="NotDirectedFast",M[M.NotUndirected=4]="NotUndirected",M[M.DestinationTree=5]="DestinationTree",M[M.SourceTree=6]="SourceTree",M))(ju||{}),Uu=(M=>(M[M.Document=1]="Document",M[M.Infinite=2]="Infinite",M))(Uu||{}),Xu=(M=>(M[M.TreeParent=1]="TreeParent",M[M.AllParents=2]="AllParents",M[M.AnyParents=3]="AnyParents",M))(Xu||{});const at=class at{constructor(e,t){y(this,"Ns");y(this,"qt");y(this,"BM");y(this,"lb");y(this,"Rr");y(this,"Ju");y(this,"ab");y(this,"hb");y(this,"cb");y(this,"fb");y(this,"ub");y(this,"db");y(this,"fh");y(this,"ah");y(this,"gb");y(this,"pb");y(this,"yb");y(this,"ia");y(this,"Jc");y(this,"Or");y(this,"ip");y(this,"wb");y(this,"xb");y(this,"$u");y(this,"eo");y(this,"Ir");y(this,"uh");y(this,"Vo");y(this,"sp");y(this,"$c");y(this,"np");y(this,"Zc");y(this,"Zu");y(this,"Er");y(this,"io");y(this,"zM");y(this,"XM");y(this,"bb");y(this,"kb");y(this,"GM");y(this,"Pb");y(this,"YM");y(this,"KM");y(this,"HM");y(this,"Sb");y(this,"op");y(this,"Ur");y(this,"Vr");y(this,"Br");y(this,"zr");y(this,"Xr");y(this,"Gr");y(this,"Mb");y(this,"Yr");y(this,"Nb");y(this,"Kr");y(this,"Hr");y(this,"jr");y(this,"qr");y(this,"Cb");y(this,"jM");y(this,"Bo");y(this,"qM");y(this,"Lb");y(this,"Ab");y(this,"WM");y(this,"Ce");y(this,"JM");y(this,"Qc");y(this,"$M");y(this,"js");y(this,"zo");y(this,"Be");y(this,"Tb");y(this,"Yl");y(this,"Kl");y(this,"Db");y(this,"vb");y(this,"Hl");y(this,"jl");y(this,"ql");y(this,"Fb");y(this,"Wl");y(this,"Jl");y(this,"$l");y(this,"Zl");y(this,"Ql");y(this,"_l");y(this,"ta");y(this,"Rb");y(this,"Ob");y(this,"ZM");y(this,"Qu");y(this,"_u");y(this,"Ib");y(this,"Eb");y(this,"Ub");y(this,"Vb");y(this,"rp");y(this,"Bb");y(this,"zb");y(this,"Xb");y(this,"Qt");y(this,"KA");y(this,"Gb");y(this,"HA");y(this,"td");y(this,"Pn");y(this,"so");y(this,"li");y(this,"no");y(this,"jA");y(this,"sa");y(this,"QM");y(this,"_M");y(this,"lp");y(this,"Yb");y(this,"ed");y(this,"ap");y(this,"Kb");y(this,"Wr");y(this,"na");y(this,"dh");y(this,"t2");y(this,"e2");y(this,"hp");y(this,"Hb");y(this,"jb");y(this,"ls");y(this,"sd");y(this,"cp");y(this,"nd");y(this,"Xo");y(this,"_c");y(this,"fp");y(this,"Jr");y(this,"gh");y(this,"i2");y(this,"dp");y(this,"Ht");y(this,"v");y(this,"qi");y(this,"Dr");y(this,"Ye");y(this,"Ts");y(this,"s2");y(this,"oa");y(this,"$r");y(this,"Fl");y(this,"Zr");y(this,"mh");y(this,"tf");y(this,"o2");y(this,"od");y(this,"ph");y(this,"rd");y(this,"zt");y(this,"ra");y(this,"ct");y(this,"it");y(this,"ld");y(this,"wt");y(this,"xt");y(this,"lt");y(this,"ef");y(this,"Mx");y(this,"qb");y(this,"yh");y(this,"sf");y(this,"Wb");y(this,"Jb");y(this,"gp");y(this,"YR");y(this,"KR");y(this,"$e");y(this,"Ol");y(this,"_m");y(this,"mp");y(this,"l2");y(this,"a2");y(this,"qA");y(this,"pp");y(this,"HR");y(this,"jR");y(this,"qR");y(this,"$b");y(this,"WR");y(this,"JR");y(this,"$R");y(this,"wh");y(this,"WA");y(this,"la");y(this,"xh");y(this,"bh");y(this,"kh");y(this,"Ph");y(this,"Eu");y(this,"oh");y(this,"Wt");y(this,"Nt");y(this,"nf");y(this,"qP");y(this,"WP");y(this,"vc");y(this,"Zt");y(this,"Iu");y(this,"Qb");y(this,"_b");y(this,"ad");y(this,"t1");y(this,"e1");y(this,"yp");y(this,"f2");y(this,"wp");y(this,"xp");y(this,"bp");y(this,"jx");y(this,"u2");y(this,"d2");y(this,"of");y(this,"kp");y(this,"Pp");if(at.qw||(at.OP(),at.qw=!0),F.Je(this),at.$A(this),this.Ht=!0,this.Nt=null,this.wt=0,this.xt=0,this.lt=null,at.isUsingDOM()){const s=this,n=()=>{s.Le(c.document,"DOMContentLoaded",n,!1),s.setRTL()};c.document.body!==null?this.setRTL():s.Et(c.document,"DOMContentLoaded",n,!1)}this.ef=null,at.g2("Model",Xn);const i=this;return this.JM=s=>i.partManager.doModelDataChanged(s),this.Qc=s=>i.partManager.doModelChanged(s),this.Wb=null,this.Jb=null,this.ZA(),this.model=Ne.m2(),this.themeManager=new yr,this.Bo=!0,this.QA(),this.layout=new bi,this.Bo=!1,this.HR=null,this.jR=null,this.qR=null,this.$b=null,this.WR=null,this.JR=null,this.$R=null,this.wh=null,this.WA=null,this.la=null,this.xh=null,this.bh=null,this.kh=null,this.Ph=null,this.Eu=()=>{},this.oh=null,this.nd=!1,this.nf=new Cp(this),e!==void 0&&(typeof e=="string"||c.Element&&e instanceof Element?this.p2(e):t=e),t&&this.setProperties(t),this.Ht=!1,this.requestUpdate(),this}lR(){return this.lt!==null}get renderer(){return this._c}set renderer(e){if(this instanceof dr)return;e===""&&(e="default");const t=e.toLowerCase(),i=this._c;if(t===i)return;this._c=t;let s=null;t==="default"||t==="canvas"?(s=this.Xo.get("svg"),s!==null&&s.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))):t==="svg"?(this.Xo.has("svg")?s=this.Xo.get("svg"):(s=new gr(this,c.document),this.addRenderer("svg",s)),this.div!==null&&(s.bt.role="img",this.div.appendChild(s.bt)),this.lt&&(this.Wt=s._t,this.lt._t.setTransform(this.$e,0,0,this.$e,0,0),this.lt._t.clearRect(0,0,this.wt,this.xt))):t==="debug"&&(this.Xo.has("SVG")||(s=new gr(this,c.document),this.addRenderer("SVG",s),s.bt.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.bt))),this.Ht||this.redraw()}ZA(){if(this.of=new E,this.setupRouters(),this.Ns=new Rs,this.Ns.Eo(this),this.qt=17,this.BM=!1,this.ld=!1,this.lb="default",this.zt=new E,this.Xo){const e=this.Xo.get("svg");e!==null&&e.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))}this.Xo=new nt,this._c="default",this.resetRenderingHints(),this.ZR(),this.Zt=1,this.ct=new L(NaN,NaN).k(),this.jx=new L(NaN,NaN),this.it=1,this.dp=1,this.ab=new L(NaN,NaN).k(),this.hb=NaN,this.cb=1e-4,this.fb=100,this.v=new lt,this.ub=new L(NaN,NaN).k(),this.db=new Y(NaN,NaN,NaN,NaN).k(),this.fh=new ct(0,0,0,0).kt(),this.ah=1,this.gb=!1,this.pb=null,this.yb=null,this.ia=1,this.Jc=X.Default,this.Or=1,this.ip=X.Default,this.wb=X.None,this.xb=X.None,this.qi=!0,this.$u=!1,this.eo=new Set,this.Ir=new F,this.uh=new F,this.Vo=!1,this.ra=new nt,this.od=!0,this.sp=250,this.$c=-1,this.np=new ct(16,16,16,16).kt(),this.Dr=!1,this.Zc=!1,this.Zu=!0,this.fp=new Dt,this.fp.diagram=this,this.Jr=new Dt,this.Jr.diagram=this,this.gh=new Dt,this.gh.diagram=this,this.Er=null,this.io=null,this.Mx=!1,this.QR(),this.Zr=new F,this.bb=!0,this.kb=1,this.GM=!1,this.Pb=1,this.Sb="auto",this.op="auto",this.Ur=null,this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Gr=null,this.Mb=null,this.Yr=null,this.Nb=!1,this.Kr=null,this.Hr=null,this.jr=null,this.qr=null,this.Cb=!1,this.qb={},this.yh=[null,null],this.Bo=!1,this.qM=!1,this.Lb=!1,this.Ab=!1,this.WM=!0,this.Ts=!1,this.ph=!1,this.$M=!0,this.js=-2,this.oa=new nt,this.rd=new E,this.zo=!1,this.Be=!0,this.Tb=!0,this.Yl=!0,this.Kl=!0,this.Db=!1,this.vb=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Fb=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Rb=!0,this.Ob=!0,this.ZM=!1,this.sf=!1,this.Qu=!0,this._u=!0,this.Ib=!0,this.Eb=!0,this.Ub=16,this.Vb=16,this.rp=!1,this.Bb=!1,this.zb=0,this.Xb=0,this.Qt=new ct(5).kt(),this.KA=new F().k(),this.Gb=999999999,this.HA=new F().k(),this.mh=!0,this.td=!0,this.tf=!0,this.Pn=!1,this.so=!1,this.$r=!0,this.Fl=!1,this.no=!1,this.jA=new F,this.o2=new F,this.sa=null,this.QM=new _(Nt._A,Nt.tT),this._M=999,this.lp=!1,this.qP=1,this.WP=0,this.Ye={scale:1,position:new L,bounds:new Y,canvasSize:new _,newCanvasSize:new _,isScroll:!1},this.Ye.canvasSize=this.Ye.canvasSize,this.Ye.newCanvasSize=this.Ye.newCanvasSize,this.Ye.isScroll=!1,this.Yb=new Y(NaN,NaN,NaN,NaN).k(),this.ed=new _(NaN,NaN).k(),this.ap=new Y(NaN,NaN,NaN,NaN).k(),this.Kb=!1,this.kp=null,this.Pp=null,this._R(),this.ls=null,this.sd=!1,this.vc=null,this.partManager=new Xn,this.toolManager=new ge,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this._b=null,this.ad=new ca,this.t1=null,this.e1=null,this.Qb=!1,this.Iu=!1,this.commandHandler=new ua,this.xp=null,this.bp=L.mn,this.u2=!1,this.$e=1,this.Ol=null,this._m=1,this.yp=0,this.f2=[0,0,0,0,0],this.wp=0,this.mp=1,this.l2=0,this.a2=new L,this.qA=500,this.cp=new L,this.pp=!1}static isUsingDOM(){return at.eT}static setDocument(e){c.document=e}static useDOM(e){at.eT=e?c.document!==void 0:!1}clear(){this.animationManager.stopAnimation(),this.model.clear(),at.iT(),this.sT(!1),this.rd.clear(),this.nT(),this.sa=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}sT(e){this.animationManager.stopAnimation(!0),this.clearSelection(),this.clearHighlighteds();const t=this.skipsUndoManager,i=this.Ce!==null&&this.Ce!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.ls!==null&&(s=this.ls.part,s!==null&&this.remove(s));const n=[],o=this.zt.length;if(e){for(let a=0;a<o;a++){const l=this.zt.r[a].parts;for(;l.next();){const h=l.value;h!==s&&h.data===null&&n.push(h)}}for(let a=0;a<n.length;a++){const l=n[a];this.remove(l)}}for(let a=0;a<o;a++)this.zt.r[a].OR();return this.partManager.clear(),this.eo.clear(),this.Ir.clear(),this.uh.clear(),this.ra.clear(),this.Zr.clear(),this.vc=null,this.rd.clear(),this.nT(),r.LP=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=t),n}static iT(){at.Sp=null,at.i1=""}static EU(){return null}reset(){this.clear(),this.Ht=!0,this.ZA(),this.themeManager=new yr,this.aa(),this.Bo=!0,this.QA(),this.layout=new bi,this.Bo=!1,this.model=Ne.m2(),this.model.undoManager=new Gt,this.nd=!1,this.Ht=!1,this.C()}_R(){this.Wr=new nt,this.t2=new wt().add(new Se({stroke:"black",font:"10pt sans-serif"}).bind("text","",r.toString).theme("stroke","text").theme("font","normal")),this.Wr.set("",this.t2),this.Wr.set("Comment",new wt().add(new Se({stroke:"brown",font:"10pt sans-serif"}).bind("text","",r.toString).theme("stroke","comment").theme("font","normal"))),this.Wr.set("LinkLabel",new wt({selectable:!1,avoidable:!1}).add(new Xt("Ellipse",{fill:"black",stroke:null,desiredSize:new _(3,3).kt()}).theme("fill","link"))),this.dh=new nt,this.s2=new Ft(Lt.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new Se({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",r.toString).theme("stroke","text").theme("font","bold"),new Lt(Lt.Auto,{name:"GROUPPPANEL"}).add(new Xt({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Ui({padding:5}).theme("padding","group"))),this.dh.set("",this.s2),this.na=new nt,this.e2=new Nt().add(new Xt({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new Xt({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.na.set("",this.e2),this.na.set("Comment",new Nt().add(new Xt({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.hp=new Jt(Lt.Auto).add(new Xt({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Ui({margin:1.5}).theme("margin","selection","numbers",null,e=>e?new ct(e/2):1.5)).freezeBindings(),this.Hb=this.hp,this.jb=new Jt(Lt.Link).add(new Xt({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection")).freezeBindings()}setRTL(e){let t=e===void 0?this.div:e;t===null&&(t=c.document.body);const i=r.Ni("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",t.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),t.removeChild(i),this.lb=s}setScrollWidth(e){let t=e===void 0?this.div:e;t===null&&(t=c.document.body);let i=0;if(at.isUsingDOM()){let s=at.c2,n=at.h2;s===null&&(at.c2=r.Ni("p"),s=at.c2,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",at.h2=r.Ni("div"),n=at.h2,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",t.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let a=s.offsetWidth;o===a&&(a=n.clientWidth),t.removeChild(n),i=o-a,i===0&&!r.ur&&(i=11)}this.qt=i,this.BM=!0}fe(e){e in Wl?this.autoScale=e:r.dr(this,e)}toString(e){e===void 0&&(e=0);let t="";this.div&&this.div.id&&(t=this.div.id);let i='Diagram "'+t+'"';if(e<=0)return i;const s=this.zt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(e-1)}return i}static $A(e){at.Zb=e}static Om(){return at.Zb}static fromDiv(e){let t=e;if(typeof e=="string"&&(t=c.document.getElementById(e)),t instanceof HTMLDivElement){const i=at.Wi.get(t);if(i)return i}return null}get div(){return this.Nt}set div(e){if(e!==null&&r.se(e,HTMLDivElement,at,"div"),this.Nt!==e){const t=this.Nt;if(t!==null){if(at.Wi.delete(t),t.goDiagram=void 0,t.go=void 0,t.innerHTML="",this.lt!==null){const s=this.lt.bt;this.Le(s,"pointermove",this.xh,!1),this.Le(s,"pointerdown",this.la,!1),this.Le(s,"pointerup",this.bh,!1),this.Le(s,"pointerout",this.kh,!1),this.Le(s,"pointercancel",this.Ph,!1),this.lt.dispose()}this.ef&&(this.ef.disconnect(),this.ef=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.lt=null,this.Le(c,"resize",this.$b,!1),this.Le(c,"wheel",this.wh,!0),at.Om()===this&&at.$A(null)}else this.la===null&&(this.no=!1);if(this.Nt=null,e!==null){const i=at.Wi.get(e);i&&(i.div=null),this.p2(e),this.Eu(),this.themeManager&&this.themeManager.tO()}else this.themeManager&&this.themeManager.eO()}}setupRouters(){this.of.push(new qp)}p2(e){const t=this;if(!at.isUsingDOM())return;e==null&&r.o("Diagram setup requires an argument DIV."),t.Nt!==null&&r.o("Diagram has already completed setup."),typeof e=="string"?t.Nt=c.document.getElementById(e):e instanceof HTMLDivElement?t.Nt=e:r.o("No DIV or DIV id supplied: "+e),t.Nt===null&&r.o("Invalid DIV id; could not get element with id: "+e);const i=at.Wi.get(t.Nt);if(i&&i!==this&&r.o("Invalid div id; div already has a Diagram associated with it."),!t.ef&&c.ResizeObserver){const f=c.ResizeObserver,m=r.CP(()=>t.requestUpdate(),250,!1);t.ef=new f(()=>m()),t.ef.observe(t.Nt)}c.getComputedStyle(t.Nt,null).position==="static"&&(t.Nt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,t.Nt.style["-webkit-tap-highlight-color"]=n,t.Nt.innerHTML="",at.Wi.set(t.Nt,t),t.Nt.goDiagram=t,t.Nt.go=c.go;const o=new wn(t);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",c.getComputedStyle(t.Nt,null).getPropertyValue("direction")==="rtl"&&(t.ld=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),o.bt.setAttribute("role","application"),t.lt=o,t.Wt=o._t;const a=t.Wt;t.$e=t.computePixelRatio(),t.viewSize.isReal()||(t.wt=t.Nt.clientWidth||1,t.xt=t.Nt.clientHeight||1),t.oT(t.wt,t.xt);const l=t;t.Nt.insertBefore(o.bt,t.Nt.firstChild);const h=new wn(null);if(h.width=1,h.height=1,t.YR=h,t.KR=h._t,at.isUsingDOM()){const f=r.Ni("div"),m=r.Ni("div");f.style.position="absolute",f.style.overflow="auto",f.style.width=t.wt+"px",f.style.height=t.xt+"px",f.style.zIndex="1",m.style.position="absolute",m.style.width="1px",m.style.height="1px",t.Nt.appendChild(f),f.appendChild(m),f.onscroll=at.iO,f.addEventListener("pointerdown",at.sO),f.a=t,f.nO=!0,f.oO=!0,t.Wb=f,t.Jb=m}t.Eu=r.CP(()=>{t.Ol=null,t.C()},300,!1),t.$b=r.CP(()=>{t.MM()},250,!1),t.oh=f=>(f.preventDefault(),!1),t.wh=f=>{if(!l.isEnabled)return;const m=l.rf(f,!0);m.bubbles=!0;let p=0,b=0;m.delta=0,f.deltaX!==void 0?(f.deltaX!==0&&(p=f.deltaX>0?1:-1),f.deltaY!==0&&(b=f.deltaY>0?1:-1),m.delta=Math.abs(f.deltaX)>Math.abs(f.deltaY)?-p:-b):f.wheelDeltaX!==void 0?(f.wheelDeltaX!==0&&(p=f.wheelDeltaX>0?-1:1),f.wheelDeltaY!==0&&(b=f.wheelDeltaY>0?-1:1),m.delta=Math.abs(f.wheelDeltaX)>Math.abs(f.wheelDeltaY)?-p:-b):f.wheelDelta!==void 0&&f.wheelDelta!==0&&(m.delta=f.wheelDelta>0?1:-1),l.doMouseWheel(),l.Sh(m,f)},t.WA=f=>{if(!l.isEnabled)return;t.sf=!1,l.rf(f,!0);const m=l.currentTool;m.cancelWaitAfter(),m.standardMouseOver()},t.la=f=>{if(!l.isEnabled)return;t.sf=!0;const m=l.qb;m[f.pointerId]===void 0&&(m[f.pointerId]=f);const p=l.yh;let b=!1;if(p[0]!==null&&(p[0].pointerId===f.pointerId||p[0].pointerType!==f.pointerType))p[0]=f;else if(p[1]!==null&&p[1].pointerId===f.pointerId)p[1]=f,b=!0;else if(p[0]===null)p[0]=f;else if(p[1]===null)p[1]=f,b=!0;else{f.preventDefault();return}const x=f.pointerType==="touch"||f.pointerType==="pen";x&&(l.Mx=!1,l.pp=!0);const v=l.rO(f,f,b),S=l.a2,P=x?25:10;if(f.timeStamp-l.l2<l.qA&&!(Math.abs(S.x-f.screenX)>P||Math.abs(S.y-f.screenY)>P)?l.mp++:l.mp=1,v.clickCount=l.mp,l.l2=f.timeStamp,l.a2.setTo(f.screenX,f.screenY),l.doMouseDown(),f.button===1){f.preventDefault();return}l.Sh(v,f)},t.xh=f=>{if(!l.isEnabled)return;t.sf=!0;const m=l.yh;if(m[0]!==null&&(m[0].pointerId===f.pointerId||m[0].pointerType!==f.pointerType))m[0]=f;else if(m[1]!==null&&m[1].pointerId===f.pointerId){m[1]=f;return}else if(m[0]===null)m[0]=f;else return;if(m[0].pointerId!==f.pointerId)return;const p=l.lO(f,f,m[1]!==null);l.doMouseMove(),l.Sh(p,f)},t.bh=f=>{if(!l.isEnabled)return;t.sf=!0;const m=f.pointerType==="touch"||f.pointerType==="pen",p=l.qb;if(m&&l.Mx){delete p[f.pointerId],f.preventDefault();return}const b=l.yh;if(b[0]!==null&&(b[0].pointerId===f.pointerId||b[0].pointerType!==f.pointerType))b[0]=null;else if(b[1]!==null&&b[1].pointerId===f.pointerId){b[1]=null;return}else return;const x=l.w2(f,!1,!0,!1,!0,!1);let v=c.document.elementFromPoint(f.clientX,f.clientY)||null;v!==null&&v.shadowRoot&&(v=v.shadowRoot.elementFromPoint(f.clientX,f.clientY)||null),v!==null&&v.a instanceof at&&v.a!==l&&v.a.Mp(f,x),v===null&&(v=f.target),l.Mp(f,x),x.clickCount=l.mp,x.targetDiagram=l.s1(f,v),x.targetObject=null,l.doMouseUp(),l.Sh(x,f),m&&(l.pp=!1)},t.kh=f=>{if(!l.isEnabled)return;t.sf=!1;const m=l.qb;m[f.pointerId]&&delete m[f.pointerId];const p=l.yh;if(p[0]!==null&&p[0].pointerId===f.pointerId&&(p[0]=null),p[1]!==null&&p[1].pointerId===f.pointerId&&(p[1]=null),f.pointerType==="touch"||f.pointerType==="pen")return;const b=l.currentTool;b.cancelWaitAfter(),b.standardMouseOver()},t.Ph=f=>{const m=l.yh;m[0]!==null&&m[0].pointerId===f.pointerId?(m[0]=null,l.pp=!1):m[1]!==null&&m[1].pointerId===f.pointerId&&(m[1]=null)};const d=a;if(t.gp=d.F[r.We("7eba17a4ca3b1a8346")][r.We("78a118b7")](d.F,at.Mh,s,s),a.clearContextCache(!0),t.aO(),this._c==="svg"){const f=this.Xo.get("svg");this.Nt&&this.Nt.appendChild(f.bt),this.Wt=f._t}}addEventListener(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}Et(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}removeEventListener(e,t,i,s){e.removeEventListener(t,i,{capture:s})}Le(e,t,i,s){e.removeEventListener(t,i,{capture:s})}aO(){const e=this;let t=this.lt.bt;t instanceof HTMLCanvasElement||(t=e.div),this.Et(t,"pointerdown",e.la,!1),this.Et(t,"pointermove",e.xh,!1),this.Et(t,"pointerup",e.bh,!1),this.Et(t,"pointerout",e.kh,!1),this.Et(t,"pointercancel",e.Ph,!1),this.Et(t,"pointerenter",e.hO,!1),this.Et(t,"pointerleave",e.cO,!1),this.Et(t,"wheel",e.wh,!1),this.Et(t,"keydown",e.fO,!1),this.Et(t,"keyup",e.uO,!1),this.Et(t,"blur",e.dO,!1),this.Et(t,"focus",e.gO,!1),this.Et(t,"selectstart",i=>(i.preventDefault(),!1),!1),this.Et(t,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Et(c,"resize",e.$b,!1)}Cx(){this.yp>30&&(this.Ol=1)}yS(e){this.Ol!==null&&(this.Ol=null,e&&this.Eu(),this.yp=0,this.f2=[0,0,0,0,0],this.wp=0)}computePixelRatio(){return this.Ol!==null?this.Ol:c.devicePixelRatio||1}get avgSpf(){return this.yp}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){const e=this.commandHandler;if(!this.toggleKeyboardControl()){if((e.isFocusEnabled||e.isVirtualPointerEnabled)&&e.doVirtualFocusKeyDown()){const t=this.lastInput;t.bubbles=!1;const i=t.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyDown()}}toggleKeyboardControl(){const e=this.lastInput,t=e.commandKey;if((e.control||e.meta)&&e.alt&&(t==="Enter"||t==="NumpadEnter")){const i=this.commandHandler,s=i.isFocusEnabled||i.isVirtualPointerEnabled;return i.isFocusEnabled=!s,i.isVirtualPointerEnabled=!s,i.focus=i.findFirstFocus(),this.T("FocusOrVirtualPointerEnabledChanged"),!0}return!1}doKeyUp(){const e=this.commandHandler;if((e.isFocusEnabled||e.isVirtualPointerEnabled)&&e.doVirtualFocusKeyUp()){const t=this.lastInput;t.bubbles=!1;const i=t.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.lt)if(this.scrollsPageOnFocus)this.lt.focus();else{const e=c.scrollX,t=c.scrollY;this.lt.focus(),c.scrollTo(e,t)}}gO(e){const t=at.Wi.get(this);t&&t.T("GainedFocus")}dO(e){const t=at.Wi.get(this);t&&t.T("LostFocus")}MM(){if(this.lt===null)return;const e=this.Nt;if(e===null||e.clientWidth===0||e.clientHeight===0)return;this.BM||this.setScrollWidth();const t=this.so?this.qt:0,i=this.Pn?this.qt:0,s=this.$e;if(this.$e=this.computePixelRatio(),this.$e!==s&&(this.$u=!0,this.requestUpdate()),e.clientWidth!==this.wt+t||e.clientHeight!==this.xt+i){this.Nh(),this.qi=!0;const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(this.Zc=!0,n.p()),this.Ts||this.requestUpdate()}}QA(){let e=0,t=new Oi;t.name="Grid",t.allowSelect=!1,t.pickable=!1,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Oi,t.name="ViewportBackground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Oi,t.name="Background",this.Qr(t,e++),t=new Oi,t.name="",this.Qr(t,e++),t=new Oi,t.name="Foreground",this.Qr(t,e++),t=new Oi,t.name="ViewportForeground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Oi,t.name="Adornment",t.isTemporary=!0,t.isInDocumentBounds=!1,this.Qr(t,e++),t=new Oi,t.name="Tool",t.isTemporary=!0,t.isInDocumentBounds=!0,this.Qr(t,e++)}rT(){const e=new Lt(Lt.Grid,{name:"GRID"}).add(new Xt("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Xt("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Xt("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Xt("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Xt("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new Xt("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),t=new _t({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(e);return this.add(t),this.partManager.parts.delete(t),e.visible=!1,e}static iO(){const e=at.Wi.get(this.parentElement||this);if(e){if(e.Bb){e.Bb=!1;return}if(!e.isEnabled){e.lT();return}e.diagramScroll(this)}}static sO(e){if(!this.a.isEnabled){this.a.updateScroll();return}this.a.zb=e.target.scrollTop,this.a.Xb=e.target.scrollLeft}diagramScroll(e){if(this.lt===null)return;const t=this.Wb,i=this.Jb;this.rp=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.fh;let a=s.x-o.left,l=s.y-o.top;const h=s.width+o.left+o.right,d=s.height+o.top+o.bottom;let f=s.right+o.right,m=s.bottom+o.bottom,p=n.x,b=n.y;const x=n.width,v=n.height;let S=n.right,P=n.bottom;const T=this.scale;let A,C=e.scrollLeft;if(this.ld)switch(this.lb){case"negative":C=C+e.scrollWidth-e.clientWidth;break;case"reverse":C=e.scrollWidth-C-e.clientWidth;break}const O=C;if(x<h||v<d){A=L.z(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Xb!==O&&(A.x=O/T+a,this.Xb=O),this.allowVerticalScroll&&this.zb!==e.scrollTop&&(A.y=e.scrollTop/T+l,this.zb=e.scrollTop),this.position=A,L.i(A),this.rp=!1,this.td=!1;return}if(A=L.l(),e.nO&&this.allowHorizontalScroll&&(a<p&&(this.position=A.e(O+a,this.position.y)),f>S)){const R=t.scrollWidth-this.wt;this.position=A.e(-R+O-this.wt/T+f,this.position.y)}if(e.oO&&this.allowVerticalScroll&&(l<b&&(this.position=A.e(this.position.x,e.scrollTop+l)),m>P)){const R=t.scrollHeight-this.xt;this.position=A.e(this.position.x,-R+e.scrollTop-this.xt/T+m)}L.i(A),this.ha(),this.rp=!1,this.td=!1,s=this.documentBounds,n=this.viewportBounds,f=s.right,S=n.right,m=s.bottom,P=n.bottom,a=s.x,p=n.x,l=s.y,b=n.y,x>=h&&a>=p&&f<=S&&(i.style.width="1px"),v>=d&&l>=b&&m<=P&&(i.style.height="1px")}computeBounds(e){return e===void 0&&(e=new Y),this.Te(),this.aT(e)}aT(e){if(this.fixedBounds.isReal())return e.h(this.fixedBounds),e.addMargin(this.Qt),e;let t=!0;const i=this.zt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const a=o.Ct.r,l=a.length;for(let h=0;h<l;h++){const d=a[h];if(!d.isInDocumentBounds||!d.isVisible())continue;const f=d.actualBounds;f.isReal()&&(t?(t=!1,e.h(f)):e.unionRect(f))}}return t&&e.e(0,0,0,0),e.addMargin(this.Qt),e}computePartsBounds(e,t){t===void 0&&(t=!1);let i;if(Array.isArray(e))for(let s=0;s<e.length;s++){const n=e[s];!t&&n instanceof Nt||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=e.iterator;for(;s.next();){const n=s.value;!t&&n instanceof Nt||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===void 0?new Y(NaN,NaN,0,0):i}$s(e){if(!e&&!this.no||this.Ht||this.lt===null||!this.documentBounds.isReal())return;if(this.Ht=!0,e){const m=this.initialPosition;if(m.isReal()){this.Ht=!1,this.position=m;return}let p=this.initialDocumentSpot,b=this.initialViewportSpot;p.isNoSpot()&&(p=X.TopLeft),b.isNoSpot()&&(b=X.TopLeft);const x=L.l();x.setRectSpot(this.documentBounds,p);const v=this.viewportBounds,S=Y.z(0,0,v.width,v.height),P=L.l();P.setRectSpot(S,b),P.e(x.x-P.x,x.y-P.y),this.Ht=!1,this.position=P,Y.i(S),L.i(P)}let t=this.ia;e&&this.Or!==1&&(t=this.Or);const i=t!==1?this.hd(t):this.scale,s=this.ct.x,n=this.ct.y,o=this.wt/i,a=this.xt/i;let l=this.Jc;const h=this.ip;if(e&&!l.isSpot()&&(h.isSpot()||h.isDefault())){const m=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();l=h.isDefault()&&!m?X.Center:h}this.b2(this.documentBounds,o,a,l,e);const d=this.scale;this.scale=i,this.Ht=!1;const f=this.viewportBounds;f.equalsApproxTo(s,n,o,a)||this.onViewportBoundsChanged(new Y(s,n,o,a),f,d,!1)}hd(e){const t=this.dp;if(this.lt===null)return t;if(e===1)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return t;const s=i.width,n=i.height,o=this.wt+(this.so?this.qt:0),a=this.xt+(this.Pn?this.qt:0);let l=o/s,h=a/n;const d=this.fh,f=d.left+d.right!==0,m=d.top+d.bottom!==0;(f||m)&&(h===l?(h=(a-this.qt)/n,l=(o-this.qt)/s):h>l?h=(a-this.qt)/n:l=(o-this.qt)/s);let p=0;return e===2?p=Math.min(h,l):e===3&&(h>l?p=(a-this.qt)/n:p=(o-this.qt)/s),p>t&&(p=t),p<this.minScale&&(p=this.minScale),p>this.maxScale&&(p=this.maxScale),p}zoomToFit(){const e=this.ah;this.ah=1,this.scale=this.hd(2),this.alignDocument(X.Center,X.Center),e!==1&&(this.$s(!1),this.b2(this.documentBounds,this.wt/this.it,this.xt/this.it,this.Jc,!1)),this.ah=e}zoomToRect(e,t){t===void 0&&(t=2);const i=e.width,s=e.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(t===2||t===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.wt,a=this.xt;t===3?a/s>o/i?n=(a-(this.Pn?this.qt:0))/s:n=(o-(this.so?this.qt:0))/i:n=Math.min(a/s,o/i)}this.scale=n,this.position=new L(e.x,e.y)}get mO(){return this.Ht}set mO(e){this.Ht=e}alignDocument(e,t){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new L(i.x+(e.x*i.width+e.offsetX)-(t.x*s.width-t.offsetX),i.y+(e.y*i.height+e.offsetY)-(t.y*s.height-t.offsetY))}focusObject(e){if(e instanceof Ht){this.xp=e;const t=L.l();this.bp=this.transformDocToView(e.getDocumentPoint(X.TopLeft,t)),L.i(t)}else this.xp=null,this.bp=L.mn}b2(e,t,i,s,n){const o=L.z(this.ct.x,this.ct.y);let a=o.x,l=o.y;if(this.xp!==null){let h=L.l();h=this.xp.getDocumentPoint(X.TopLeft,h),a=h.x-this.bp.x/this.scale,l=h.y-this.bp.y/this.scale,s=X.None,L.i(h)}if(n||this.scrollMode===1){s.isSpot()&&(t>e.width&&(a=e.x+(s.x*e.width+s.offsetX)-(s.x*t-s.offsetX)),i>e.height&&(l=e.y+(s.y*e.height+s.offsetY)-(s.y*i-s.offsetY)));const h=this.fh,d=t-e.width;if(t<e.width+h.left+h.right){let m=a+t/2;m=Math.min(m,e.right+Math.max(d,h.right)-t/2),m=Math.max(m,e.left-Math.max(d,h.left)+t/2),a=m-t/2}else a>e.left?a=e.left:a<e.right-t&&(a=e.right-t);const f=i-e.height;if(i<e.height+h.top+h.bottom){let m=l+i/2;m=Math.min(m,e.bottom+Math.max(f,h.bottom)-i/2),m=Math.max(m,e.top-Math.max(f,h.top)+i/2),l=m-i/2}else l>e.top?l=e.top:l<e.bottom-i&&(l=e.bottom-i)}if(o.x=isFinite(a)?a:-this.Qt.left,o.y=isFinite(l)?l:-this.Qt.top,this.positionComputation!==null){const h=this.positionComputation(this,o);o.x=h.x,o.y=h.y}this.Ns.IA(this.ct,o),this.ct.e(o.x,o.y),this.Np(),this.aa(),this.pO(),L.i(o)}findPartAt(e,t){if(t===void 0&&(t=!0),t){const i=this.kS(e,s=>s.part,s=>s.canSelect());if(i instanceof _t)return i}else{const i=this.kS(e,s=>s.part);if(i instanceof _t)return i}return null}findObjectAt(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}kS(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Te();const s=this.zt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}findPartsAt(e,t,i){return t===void 0&&(t=!0),this.yO(e,s=>s.part,t?s=>s instanceof _t&&s.canSelect():null,i)}yO(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof E)&&!(s instanceof F)&&(s=new F),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(e,t,i,s)}return s}findObjectsAt(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof E)&&!(s instanceof F)&&(s=new F),this.Te();const n=this.zt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(e,t,i,s)}return s}findPartsIn(e,t,i,s){return t===void 0&&(t=!1),i===void 0&&(i=!0),this.wO(e,null,n=>n instanceof _t&&(!i||n.canSelect()),t,s)}findObjectsIn(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof E)&&!(n instanceof F)&&(n=new F),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const a=o.value;a.visible&&a.findObjectsIn(e,t,i,s,n)}return n}MS(e,t,i,s,n,o){const a=new F;this.Te();const l=this.zt.iteratorBackwards;for(;l.next();){const h=l.value;h.visible&&h.MS(e,t,i,s,a,n,o)}return a}wO(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof E)&&!(n instanceof F)&&(n=new F),this.Te();const o=this.zt.iteratorBackwards;for(;o.next();){const a=o.value;!a.visible||a.isTemporary||a.findObjectsIn(e,t,i,s,n)}return n}findPartsNear(e,t,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.xO(e,t,null,o=>o instanceof _t&&(!s||o.canSelect()),i,n)}findObjectsNear(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof E||n instanceof F)&&(o=n),n=!0),!(o instanceof E)&&!(o instanceof F)&&(o=new F),this.Te();const a=this.zt.iteratorBackwards;for(;a.next();){const l=a.value;l.visible&&l.findObjectsNear(e,t,i,s,n,o)}return o}xO(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof E||n instanceof F)&&(o=n),n=!0),!(o instanceof E)&&!(o instanceof F)&&(o=new F),this.Te();const a=this.zt.iteratorBackwards;for(;a.next();){const l=a.value;!l.visible||l.isTemporary||l.findObjectsNear(e,t,i,s,n,o)}return o}acceptEvent(e){return this.rf(e,e instanceof MouseEvent)}rf(e,t){const i=this.Jr;this.Jr=this.gh,this.gh=i,i.diagram=this,i.event=e,t?this.Mp(e,i):(i.viewPoint=this.Jr.viewPoint,i.documentPoint=this.Jr.documentPoint);let s=0;const n=e;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),r.ur&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=e.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.s1(e,e.target),i.targetObject=null,i}s1(e,t){if(t===null)return null;const i=at.Wi.get(t);if(i)return i;let s=e.path;if(!s&&r.st(e.composedPath)&&(s=e.composedPath()),s&&s[0]){const n=at.Wi.get(s[0]);if(n)return n}return null}rO(e,t,i){const s=this.w2(e,!0,!1,!1,!0,i);return this.Mp(t,s),s.targetDiagram=this.s1(e,e.target),s.targetObject=null,i||s.clone(this.fp),s}lO(e,t,i){const s=this.w2(e,!1,!1,!1,!1,i);let n=c.document.elementFromPoint(t.clientX,t.clientY)||null;n!==null&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(t.clientX,t.clientY)||null);let o=this,a=e;if(n){const l=this.s1(e,n);l&&(a=t,o=l)}return s.targetDiagram=o,this.Mp(a,s),s.targetObject=null,s}w2(e,t,i,s,n,o){const a=this.Jr;this.Jr=this.gh,this.gh=a,a.diagram=this,a.clickCount=1,a.delta=0;let l=0;return e.ctrlKey&&(l+=1),e.altKey&&(l+=2),e.shiftKey&&(l+=4),e.metaKey&&(l+=8),a.modifiers=l,a.event=e,a.timestamp=e.timeStamp,a.button=i?this.firstInput.button:e.button,a.buttons=e.buttons,r.ur&&e.button===0&&e.ctrlKey&&(a.button=2),a.down=t,a.up=i,a.handled=s,a.bubbles=n,a.isMultiTouch=o,a}Sh(e,t){return e.bubbles?!0:(t.stopPropagation!==void 0&&t.stopPropagation(),t.cancelable!==!1&&t.preventDefault(),t.cancelBubble=!0,!1)}fO(e){const t=at.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!1);return i.key=e.key,i.code=e.code,i.down=!0,t.doKeyDown(),t.Sh(i,e)}uO(e){const t=at.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!1);return i.key=e.key,i.code=e.code,i.up=!0,t.doKeyUp(),t.Sh(i,e)}hO(e){const t=at.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!0);return t.mouseEnter!==null&&t.mouseEnter(i),t.currentTool.standardMouseOver(),t.Sh(i,e)}cO(e){const t=at.Wi.get(this);if(!t||!t.isEnabled)return!1;const i=t.rf(e,!0);return t.mouseLeave!==null&&t.mouseLeave(i),t.Sh(i,e)}getMouse(e){const t=this.lt;if(t===null)return new L(0,0);const i=t.getBoundingClientRect(),s=(e.clientX-i.left)*(this.wt/i.width),n=(e.clientY-i.top)*(this.xt/i.height);return new L(s,n).Ki(this.v)}Mp(e,t){const i=this.lt;let s=0,n=0;if(i!==null){const a=i.getBoundingClientRect();s=(e.clientX-a.left)*(this.wt/a.width),n=(e.clientY-a.top)*(this.xt/a.height)}t.viewPoint.e(s,n);const o=L.z(s,n);this.v.Ci(o),t.documentPoint.h(o),L.i(o)}_L(e,t,i){let s;if(this.yh[0]!==null)s=this.yh[t];else return;const n=this.lt;if(n!==null){const o=n.getBoundingClientRect();i.e((s.clientX-o.left)*(this.wt/o.width),(s.clientY-o.top)*(this.xt/o.height))}}invalidateDocumentBounds(){this.mh||(this.mh=!0,this.requestUpdate(!1))}bO(){this.Ts||this.Te(),this.ensureBounds()}redraw(){this.Ht||this.Ts||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Dr}delayInitialization(e){e===void 0&&(e=null);const t=this.animationManager,i=t.isEnabled;t.stopAnimation(),t.isEnabled=!1,this.Sr(),this.no=!1,this.jx=new L(NaN,NaN),t.isEnabled=i,this.Ts=!0;const s=this;e!==null&&r.dn(()=>{s.Ts=!1,t.Gl("Model"),e(s)},1)}requestUpdate(e){if(e===void 0&&(e=!1),this.Dr===!0||this.Ht||e===!1&&this.Ts)return;this.Dr=!0;const t=this;c.requestAnimationFrame(()=>{t.Dr&&t.maybeUpdate()})}maybeUpdate(){this.Zu&&!this.Dr||(this.Zu&&(this.Zu=!1),this.Sr())}k2(e,t){!this.td||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.lT()||(e&&this.Te(),t&&this.$s(!1))}Sr(e){if(this.Ts||(this.Dr=!1,this.Nt===null&&!this.ed.isReal()))return;this.Ts=!0;const t=this.animationManager,i=this.rd;if(!t.isAnimating&&i.length!==0){const f=i.r,m=f.length;for(let p=0;p<m;p++){const b=f[p];b.xi(!1),b.c()}i.clear()}const s=this.o2;s.count>0&&(s.each(f=>f.P2()),s.clear());let n=!1,o=!1;t.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),t.ke||this.MM(),e||this.k2(!1,!0);const a=!this.undoManager.isUndoingRedoing&&(this.Fl||this.of.count!==0&&this.Ir.size!==0),l=!this.no||this.$r;this.Te(!0);let h=!1;(l||a)&&(this.no?this.S2(!this.Zc,a):(this.startTransaction("Initial Layout"),t.isEnabled===!1&&t.stopAnimation(),this.S2(!1,a)),h=l),this.Zc=!1,this.Fl=!1,this.Te(),this.ls!==null&&(this.ls.visible&&!this.sd&&(this.ca(),this.sd=!0),!this.ls.visible&&this.sd&&(this.sd=!1)),this.Lb||this.bO(),e||this.k2(!0,!1);let d=!1;if(h){const f=Y.l();f.h(this.viewportBounds),this.no||(this.no=!0,d=!0,this.skipsUndoManager||(this.undoManager.Px=!0),this.undoManager.Sx=!0,this.kO()),this.PO(),this.Te(!1),e||this.k2(!0,!0),Y.i(f)}else if(t.zc&&t.Hx){if(this.Or!==1)this.scale=this.hd(this.Or);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const f=this.initialScale;isFinite(f)&&f>0&&(this.scale=f)}this.$s(!0)}h&&d&&this.commitTransaction("Initial Layout"),e||this.Ge(this.Wt),o&&(this.skipsUndoManager=n),this.Ts=!1}get Qa(){return this.no}kO(){if(this.Or!==1)this.scale=this.hd(this.Or);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.$s(!0);const e=this.zt.r;this.As(e,e.length,this,this.viewportBounds),this.T("InitialLayoutCompleted"),this.jx.h(this.ct),this.ca()}PO(){this.T("LayoutCompleted")}Cp(e){this.eo.add(e)}addInvalidRoute(e){this.Vo?this.uh.add(e):this.Ir.add(e)}Te(e){if(this.eo.size!==0&&!(!this.Ts&&this.animationManager.isTicking)){if(this.Ts||(this.Fl=!0),e){this.hT(this.eo);return}for(let t=0;t<23&&this.eo.size!==0;t++){const i=new Set(this.eo);this.eo.clear(),this.P2(i,this.eo)}this.nodes.each(t=>{t instanceof Ft&&t.cT(!1)})}}hT(e,t){for(const i of e)!i.Di()||i instanceof Ft||(i._r()?(i.ht(1/0,1/0),i.Ut()):t&&t.add(i));for(const i of e)if(i instanceof Ft){if(!i.isVisible())continue;this.o1(i)}}P2(e,t){this.hT(e,t);for(const i of e){if(!(i instanceof Nt))continue;const s=i;s.isVisible()&&(s._r()?(s.ht(1/0,1/0),s.Ut()):t.add(s))}for(const i of e)i instanceof Jt&&i.isVisible()&&(i._r()?(i.ht(1/0,1/0),i.Ut()):t.add(i))}cd(e){const t=e instanceof at,i=t?e.links:e.memberParts,s=this.eo;if(t)this.Te(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.Di()||n instanceof Ft||n._r()&&(n.ht(1/0,1/0),n.Ut()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof Ft){if(!n.isVisible())continue;this.o1(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof Nt&&s.has(n)&&n.isVisible()&&n._r()&&(n.ht(1/0,1/0),n.Ut())}}o1(e){const t=r.nt(),i=r.nt(),s=e.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof Ft?(o.Go()||o.as()||o.fa())&&this.o1(o):o instanceof Nt?o.fromNode===e||o.toNode===e?i.push(o):t.push(o):(o.ht(1/0,1/0),o.Ut()))}let n=t.length;for(let o=0;o<n;o++){const a=t[o];a.ht(1/0,1/0),a.Ut()}r.Z(t),e.ht(1/0,1/0),e.Ut(),n=i.length;for(let o=0;o<n;o++){const a=i[o];a.ht(1/0,1/0),a.Ut()}r.Z(i)}As(e,t,i,s){if(!(!this.tf&&!this.animationManager.isAnimating)){for(let n=0;n<t;n++)e[n].As(i,s);this.Te()}}Ge(e){this.Nt!==null&&(this.lt===null&&r.o("No canvas specified"),this._c==="svg"?this.SO(e):this.MO(e))}MO(e){const t=this.animationManager;if(t.ke||t.isAnimating&&!t.isTicking)return;const i=new Date;if(this.Lp(),this.Nt&&this.Nt.style.opacity==="0")return;const s=e!==this.Wt,n=this.zt.r,o=n.length,a=this;if(this.As(n,o,a,a.viewportBounds),s)e.clearContextCache(!0),this.ha();else if(!this.qi&&!t.isAnimating)return;const l=this.v,h=this.$e;e.setTransform(h,0,0,h,0,0),e.clearRect(0,0,this.wt,this.xt),this.Zt!==1&&(e.globalAlpha=this.Zt),this.M2(e);for(let b=0;b<o;b++)e.setTransform(h,0,0,h,0,0),e.transform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),e.commitTransform(),n[b].Ge(e,a);let d=!1;this.nf?this.nf.Mh(this,e)&&(d=this.gp()):d=!0,d&&(lt.prototype.Ci=lt.prototype.Mu),s?(this.Wt.clearContextCache(!0),this.ha()):(this.tf=!1,this.qi=!1);const f=+new Date-+i,m=!1,p=this.f2;if(this.Ol===null){p[this.wp]=f,this.wp=(this.wp+1)%p.length;let b=0;for(let x=0;x<p.length;x++)b+=p[x];this.yp=b/p.length}this.Zt!==1&&(e.globalAlpha=1)}SO(e){if(this.Nt===null)return;const t=this.animationManager;if(t.ke||t.isAnimating&&!t.isTicking)return;this.Lp();const i=this.wt,s=this.xt;e.surface.resize(i,s,i,s);const n=this.zt.r,o=n.length,a=this;if(this.As(n,o,a,a.viewportBounds),!this.qi&&!t.isAnimating)return;const l=this.v;e.lastDrawnPart=null,e.setDiagramPosScale(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),this.Zt!==1&&(e.globalAlpha=this.Zt),this.M2(e);const h=this.$e,d=this.lt._t;d.setTransform(h,0,0,h,0,0),d.clearRect(0,0,this.wt,this.xt);for(let m=0;m<o;m++)n[m].Ge(e,a);let f=!1;this.nf?this.nf.Mh(this,d)&&(f=this.gp()):f=!0,f&&(lt.prototype.Ci=lt.prototype.Mu),this.tf=!1,this.qi=!1}l1(e,t,i,s,n,o,a,l,h){o===void 0&&(o=null),a===void 0&&(a=null),l===void 0&&(l=!1),h===void 0&&(h=!1),this.Lp(),e.clearContextCache(!0),this.ha(),this.ph=!0;const d=this.it;this.it=s;const f=this,m=this.zt.r,p=m.length;try{const b=new Y(n.x,n.y,i.width/s,i.height/s),x=b.copy();x.addMargin(t),this.ca(x),this.Te(),this.As(m,p,f,b),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),a!==null&&a!==""&&(e.fillStyle=a,e.fillBackground(0,0,i.width,i.height));const v=lt.l();v.Ue(),v.Gs(t.left,t.top),v.it(s),(n.x!==0||n.y!==0)&&v.Gs(-n.x,-n.y),e.setTransform(v.m11,v.m12,v.m21,v.m22,v.dx,v.dy),e.commitTransform(),e instanceof Ri&&e.setDiagramPosScale(v.m11,v.m12,v.m21,v.m22,v.dx,v.dy),lt.i(v),this.M2(e),e.globalAlpha=this.Zt;const S=this.findLayer("Grid");if(o){const P=new F,T=o.iterator;for(T.reset();T.next();){const A=T.value;A instanceof _t&&(!h&&A.layer===S||(A.Wc(),P.add(A)))}for(let A=0;A<p;A++)m[A].IR(e,f,P,l);P.each(A=>A.Wc())}else for(let P=0;P<p;P++){const T=m[P];T===S?h&&T.Ge(e,f,!0):T.Ge(e,f,l)}this.ph=!1,this.nf&&this.Wt&&this.nf.Mh(this,this.Wt)&&this.gp()}finally{this.it=d,e.clearContextCache(!0),this.ha(),this.As(m,p,f,f.viewportBounds),this.ca(),this.Wt instanceof Ri&&(this.Wt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(e){return this.Rr[e]}setRenderingHint(e,t){e==="minDrawingLength"&&(this._m=t),this.Rr[e]=t,this.redraw()}resetRenderingHints(){this.Rr=new g,this.Rr.drawShadows=!0,this.Rr.textGreeking=!0,this.Rr.viewportOptimizations=!r.ur,this.Rr.temporaryPixelRatio=!0,this.Rr.pictureRatioOptimization=!0,this.Rr.minDrawingLength=1,this._m=1}M2(e){const t=this.Rr;if(t===null)return;if(t.imageSmoothingEnabled!==void 0){const s=!!t.imageSmoothingEnabled;e.setImageSmoothingEnabled(s)}const i=t.defaultFont;i!=null&&(e.font=i)}getInputOption(e){return this.Ju[e]}setInputOption(e,t){this.Ju[e]=t}ZR(){this.Ju=new g,this.Ju.extraTouchArea=10,this.Ju.extraTouchThreshold=10,this.Ju.hasGestureZoom=!0}set(e){return e?(Object.assign(this,e),this):this}attach(e){return this.setProperties(e)}setProperties(e){return at.Ap(this,e),this}static Ap(e,t){if(!t)return;const i=e instanceof Lt,s=e instanceof at;for(const n in t){n===""&&r.o("Setting properties requires non-empty property names");let o=e,a=n;if(i||s){const h=n.indexOf(".");if(h>0){const d=n.substring(0,h);i?o=e.findObject(d):(o=e[d],o==null&&(o=e.toolManager[d])),r.$(o)?a=n.substring(h+1):r.o("Unable to find object named: "+d+" in "+e.toString()+" when trying to set property: "+n)}}if(a[0]!=="_"&&!r.jw(o,a))if(s&&a==="ModelChanged"){e.addModelChangedListener(t[a]);continue}else if(s&&a==="Changed"){e.addChangedListener(t[a]);continue}else if(s&&r.jw(e.toolManager,a))o=e.toolManager;else if(s&&e.fT(a)){e.addDiagramListener(a,t[a]);continue}else if(e instanceof Ne&&a==="Changed"){e.addChangedListener(t[a]);continue}else r.o('Trying to set undefined property "'+a+'" on object: '+o.toString());const l=t[n];o[a]=l,a[0]==="_"&&o instanceof Ht&&o.addCopyProperty(a)}}VA(){if(this.ra.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.ra.count>0;){const e=this.ra;this.ra=new nt;const t=e.iterator;for(;t.next();){const i=t.key;i.invalidateOtherJumpOvers(t.value),i.ai()}}this.C()}}C(e){if(e===void 0)this.qi=!0,this.requestUpdate();else{const t=this.viewportBounds;e.isReal()&&t.intersectsRect(e)&&(this.qi=!0,this.requestUpdate())}this.T("InvalidateDraw")}invalidateViewport(e,t){if(this.qi!==!0){if(this.qi=!0,this._c==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Cx(),this.maybeUpdate(),this.yS(!0)):this.maybeUpdate()}}Nh(){this.td=!0}ha(){this.tf=!0}Lp(){this.$u!==!1&&(this.$u=!1,this.oT(this.wt,this.xt))}oT(e,t){this.aa();const i=this.$e,s=e*i,n=t*i;this.lt.resize(s,n,e,t)&&(this.qi=!0,this.Wt.clearContextCache(!0))}lT(){const e=this.lt;if(e===null||this.ed.isReal())return!0;const t=this.wt,i=this.xt,s=this.Nt;let n=!1,o=this.so?this.qt:0,a=this.Pn?this.qt:0,l=s.clientWidth||t+o,h=s.clientHeight||i+a;const d=this.viewportBounds,f=d.x,m=d.y,p=d.width,b=d.height;if((l!==t+o||h!==i+a)&&(this.so=!1,this.Pn=!1,o=0,a=0,this.wt=l,this.xt=h,this.$u=!0,n=!0,this.aa()),!this.no||!this.viewportBounds.isReal())return!0;const x=this.Wb,v=this.Jb;if(this.td=!1,!n&&!this.so&&!this.Pn&&!this.Qu&&!this._u)return!0;const S=this.documentBounds;let P=0,T=0,A=0,C=0;const O=d.width,R=d.height,I=this.fh;this.contentAlignment.isSpot()?(S.width>O&&(P=I.left,T=I.right),S.height>R&&(A=I.top,C=I.bottom)):(P=I.left,T=I.right,A=I.top,C=I.bottom);const H=S.width+P+T,V=S.height+A+C,z=this.scale,K=z;let $=H>l/z,q=V>h/z;if(!n&&!this.so&&!this.Pn&&!$&&!q)return!0;const J=S.x-P,ot=d.x,rt=S.right+T;let st=d.right+o;const ht=S.y-A,pt=d.y,zt=S.bottom+C;let kt=d.bottom+a,Mt="1px",St="1px";if(this.scrollMode===1&&($||q)){if($&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let xt=1;J+1<ot&&(xt=Math.max((ot-J)*z+this.wt,xt)),rt>st+1&&(xt=Math.max((rt-st)*z+this.wt,xt)),O+o+1<H&&(xt=Math.max((H-O)*z+this.wt,xt)),Mt=xt.toString()+"px"}if(q&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let xt=1;ht+1<pt&&(xt=Math.max((pt-ht)*z+this.xt,xt)),zt>kt+1&&(xt=Math.max((zt-kt)*z+this.xt,xt)),R+a+1<V&&(xt=Math.max((V-R)*z+this.xt,xt)),St=xt.toString()+"px"}}let Ct=Mt!=="1px",Qt=St!=="1px";if(!(Ct&&Qt)&&(Ct||Qt)){if($=!(H<O+o),q=!(V<R+a),Qt&&(st-=this.qt),Ct&&(kt-=this.qt),$&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let Ot=1;J+1<ot&&(Ot=Math.max((ot-J)*z+this.wt,Ot)),rt>st+1&&(Ot=Math.max((rt-st)*z+this.wt,Ot)),O+1<H&&(Ot=Math.max((H-O)*z+this.wt,Ot)),Mt=Ot.toString()+"px"}Ct=Mt!=="1px";let xt=this.xt;if(Ct!==this.Pn&&(xt=Ct?this.xt-this.qt:this.xt+this.qt),q&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let Ot=1;ht+1<pt&&(Ot=Math.max((pt-ht)*z+xt,Ot)),zt>kt+1&&(Ot=Math.max((zt-kt)*z+xt,Ot)),R+1<V&&(Ot=Math.max((V-R)*z+xt,Ot)),St=Ot.toString()+"px"}Qt=St!=="1px"}if(this.rp&&!(Ct!==this.Pn||Qt!==this.so))return(t!==this.wt||i!==this.xt)&&this.maybeUpdate(),!1;if(Ct!==this.Pn&&(Mt==="1px"?this.xt=this.xt+this.qt:this.xt=Math.max(this.xt-this.qt,1),n=!0),this.Pn=Ct,v.style.width=Mt,Qt!==this.so&&(St==="1px"?this.wt=this.wt+this.qt:this.wt=Math.max(this.wt-this.qt,1),n=!0,this.ld)){const xt=L.l();Qt?(e.style.left=this.qt+"px",this.position=xt.e(this.ct.x+this.qt/this.scale,this.ct.y)):(e.style.left="0px",this.position=xt.e(this.ct.x-this.qt/this.scale,this.ct.y)),L.i(xt)}n&&this.aa(),this.so=Qt,v.style.height=St,this.Bb=!0,n&&(this.$u=!0);let Wt=x.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(O+1<H?Wt=(this.position.x-J)*z:J+1<ot?Wt=x.scrollWidth-x.clientWidth:rt>st+1&&(Wt=this.position.x*z)),this.ld)switch(this.lb){case"negative":Wt=-(x.scrollWidth-Wt-x.clientWidth);break;case"reverse":Wt=x.scrollWidth-Wt-x.clientWidth;break}if(x.scrollLeft=Wt,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(R+1<V?x.scrollTop=(this.position.y-ht)*z:ht+1<pt?x.scrollTop=x.scrollHeight-x.clientHeight:zt>kt+1&&(x.scrollTop=this.position.y*z)),l=this.wt,h=this.xt,x.style.width=l+(this.so?this.qt:0)+"px",x.style.height=h+(this.Pn?this.qt:0)+"px",t!==l||i!==h||this.animationManager.ke){const xt=Y.z(f,m,p,b);return this.onViewportBoundsChanged(xt,this.viewportBounds,K,n),Y.i(xt),!1}return!0}add(e){const t=e.diagram;if(t===this)return;t!==null&&r.o("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+t.toString());let i=this.findLayer(e.layerName);if(i===null&&(i=this.findLayer("")),i===null&&r.o('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer===i)return;const s=i.ch(99999999,e,e.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,e,null,s),i.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1);const n=e.layerChanged;n!==null&&n(e,null,i)}ch(e){this.partManager.ch(e);const t=this;at.isUsingDOM()&&e.Sn(i=>t.uT(i)),e.data||e.Yo(),e.hasPlaceholder()&&e.c(),e.data!==null&&e.Sn(i=>t.partManager.N2(i,null)),(e.as()===!0||e.fa()===!0)&&this.Cp(e),e.dT(!0,this),e instanceof wt&&e.canAvoid()&&this.fd(e),e.gT()?(e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.kp!==null&&this.kp(this,e),this.requestUpdate()}ri(e){e.clearAdornments(),this.partManager.ri(e);const t=this;e.data!==null&&e.Sn(i=>t.partManager.C2(i,t)),this.eo.delete(e),e instanceof Nt?this.Ir.delete(e):e instanceof wt&&e.canAvoid()&&this.fd(e),e.gT()?(e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.C(e.hh(e.actualBounds)),this.Pp!==null&&this.Pp(this,e),this.requestUpdate()}remove(e){this.L2(e,!0)}L2(e,t){const i=e.layer;if(i===null||i.diagram!==this)return;e.isSelected=!1,e.isHighlighted=!1,e.invalidateLayout(2),t&&e.lf();const s=i.ri(-1,e,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,e,null,s,null);const n=e.layerChanged;n!==null&&n(e,i,null)}removeParts(e,t){if(t===void 0&&(t=!1),Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t&&!n.canDelete()||this.remove(n)}}else{const i=new F;i.addAll(e);const s=i.iterator;for(;s.next();){const n=s.value;t&&!n.canDelete()||this.remove(n)}}}copyParts(e,t,i){i===void 0&&(i=!1);let s=null;const n=t||this,o=n.model;let a=!1,l=!1;try{o.Vm()&&(a=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.Um()||o.a1())&&(l=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(e,t,i)}finally{o.Vm()&&(o.copiesParentKeyOfNodeData=a),(o.Um()||o.a1())&&(o.copiesGroupKeyOfNodeData=l)}return s}moveParts(e,t,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.Tp()),this.toolManager===null)return;const n=new nt;if(e!==null)if(Array.isArray(e))for(let o=0;o<e.length;o++)this.tl(n,e[o],i,s);else{const o=e.iterator;for(;o.next();)this.tl(n,o.value,i,s)}else{let o=this.parts;for(;o.next();){const a=o.value;this.tl(n,a,i,s)}for(o=this.nodes;o.next();){const a=o.value;this.tl(n,a,i,s)}for(o=this.links;o.next();){const a=o.value;this.tl(n,a,i,s)}}this.Lx(n,t,s,i)}tl(e,t,i,s,n){if(!e.has(t)&&(n===void 0&&(n=!1),!(i&&!n&&!t.canMove()&&!t.canCopy())))if(s===void 0&&(s=this.Tp()),t instanceof wt){if(e.set(t,this.Ws(s,t,t.location)),t instanceof Ft&&(t.hasPlaceholder()||s.dragsMembers)){const a=t.memberParts;for(;a.next();){const l=a.value;this.tl(e,l,i,s,s.groupsAlwaysMove)}}const o=t.linksConnected;for(;o.next();){const a=o.value;if(e.has(a))continue;const l=a.fromNode,h=a.toNode;l!==null&&e.has(l)&&h!==null&&e.has(h)&&this.tl(e,a,i,s)}if(s.dragsTree){const a=t.findTreeChildrenNodes();for(;a.next();){const l=a.value;this.tl(e,l,i,s)}}}else if(t instanceof Nt){e.set(t,this.Ws(s,t));const o=t.labelNodes;for(;o.next();){const a=o.value;this.tl(e,a,i,s)}}else t instanceof Jt||e.set(t,this.Ws(s,t,t.location))}Lx(e,t,i,s){if(e===null||e.count===0)return;const n=L.l(),o=L.l();o.h(t),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const a=this.Qb;a||this.uA(e);const l=r.nt(),h=r.nt(),d=e.iterator;let f=L.l();for(;d.next();){const v=d.key,S=d.value;if(v.Di()){const P=this.mT(v,e);if(P!==null)l.push(new Np(v,S,P));else if(!s||v.canMove()){const T=S.point;n.h(T),this.computeMove(v,n.add(o),i,f),v.location=f,S.shifted===void 0&&(S.shifted=new L),S.shifted.h(f.subtract(T))}}else d.key instanceof Nt&&h.push(new tt(d.key,d.value))}L.i(f);const m=l.length;for(let v=0;v<m;v++){const S=l[v],P=S.pT.point;n.h(P),S.h1.shifted===void 0&&(S.h1.shifted=new L),S.Ri.location=n.add(S.h1.shifted)}const p=L.l(),b=L.l(),x=h.length;for(let v=0;v<x;v++){const S=h[v],P=S.key;if(P instanceof Nt){if(P.suspendsRouting){P.vr=null;const T=P.fromNode,A=P.toNode;if(this.draggedLink!==null&&i.dragsLink){const C=S.value.point;if(P.dragComputation===null){e.set(P,this.Ws(i,P,o));const O=o.x-C.x,R=o.y-C.y;P.Pr(O,R)}else{const O=L.z(0,0),R=P.getPoint(0);R&&R.isReal()&&O.h(R),f=L.l().h(O).add(o);let I=f;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(I=L.l(),this.lM(P,f,I,i)),f.h(P.dragComputation(P,f,I)).subtract(O),e.set(P,this.Ws(i,P,f));const H=f.x-C.x,V=f.y-C.y;P.Pr(H,V),L.i(O),L.i(f),I!==f&&L.i(I)}}else{if(T!==null){p.h(T.location);const C=e.get(T);C!==null&&p.subtract(C.point)}if(A!==null){b.h(A.location);const C=e.get(A);C!==null&&b.subtract(C.point)}if(T!==null&&A!==null)if(p.equalsApprox(b)){const C=S.value.point,O=n;O.h(p),O.subtract(C),e.set(P,this.Ws(i,P,p)),P.Pr(O.x,O.y)}else P.suspendsRouting=!1,P.$t();else{const C=S.value.point;let O;T!==null?O=p:A!==null?O=b:O=o,e.set(P,this.Ws(i,P,O));const R=O.x-C.x,I=O.y-C.y;P.Pr(R,I)}}}else if(P.fromNode===null||P.toNode===null){const T=S.value.point;e.set(P,this.Ws(i,P,o));const A=o.x-T.x,C=o.y-T.y;P.Pr(A,C)}}}L.i(n),L.i(o),L.i(p),L.i(b),r.Z(l),r.Z(h),a||(this.Te(),this.pS(e))}computeMove(e,t,i,s){if(s===void 0&&(s=new L),s.h(t),e===null)return s;let n=t;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=L.l(),this.lM(e,t,n,i));const a=e.dragComputation!==null?e.dragComputation(e,t,n):n,l=e.minLocation;let h=l.x;isNaN(h)&&(h=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let d=l.y;isNaN(d)&&(d=o?Math.round(e.location.y*1e3)/1e3:e.location.y);const f=e.maxLocation;let m=f.x;isNaN(m)&&(m=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let p=f.y;return isNaN(p)&&(p=o?Math.round(e.location.y*1e3)/1e3:e.location.y),s.e(Math.max(h,Math.min(a.x,m)),Math.max(d,Math.min(a.y,p))),n!==t&&L.i(n),s}Tp(){const e=this.toolManager.findTool("Dragging");return e instanceof ae?e.dragOptions:this.ad}lM(e,t,i,s){if(s===void 0&&(s=this.Tp()),i.h(t),e===null)return i;const n=this.grid,o=s.gridSnapCellSize;let a=o.width,l=o.height;const h=s.gridSnapOrigin;let d=h.x,f=h.y;const m=s.gridSnapCellSpot;if(n!==null){const b=n.gridCellSize;isNaN(a)&&(a=b.width),isNaN(l)&&(l=b.height);const x=n.gridOrigin;isNaN(d)&&(d=x.x),isNaN(f)&&(f=x.y)}const p=L.z(0,0);return p.setSpot(0,0,a,l,m),B.tm(t.x,t.y,d+p.x,f+p.y,a,l,i),L.i(p),i}uA(e){if(e===null)return;this.Qb=!0;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof Nt&&(i.suspendsRouting=!0)}}pS(e){if(e===null)return;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof Nt&&(i.suspendsRouting=!1,i.yT()&&i.$t())}this.Qb=!1}get draggedLink(){return this._b}set draggedLink(e){this._b!==e&&(this._b=e,e!==null&&(this.t1=e.fromPort,this.e1=e.toPort))}get PS(){return this.t1}set PS(e){this.t1=e}get SS(){return this.e1}set SS(e){this.e1=e}mT(e,t){const i=e.containingGroup;if(i!==null){let s=this.mT(i,t);if(s!==null||(s=t.get(i),s!==null))return s}return null}Ws(e,t,i){if(i===void 0)return new jn(L.gn);let s=e.isGridSnapEnabled;return!e.groupsSnapMembers&&t.containingGroup!==null&&(s=!1),s?new jn(new L(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new jn(i.copy())}A2(e,t){if(e.diagram!==null&&e.diagram!==this&&r.o("Cannot share a Layer with another Diagram: "+e+" of "+e.diagram),t===null?e.diagram!==null&&r.o("Cannot add an existing Layer to this Diagram again: "+e):(t.diagram!==this&&r.o("Existing Layer must be in this Diagram: "+t+" not in "+t.diagram),e===t&&r.o("Cannot move a Layer before or after itself: "+e)),e.diagram===this)return;const i=e.name,s=this.zt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&r.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(e){this.A2(e,null),e.Eo(this);const t=this.zt;let i=t.count-1;if(!e.isTemporary)for(;i>=0&&t.elt(i).isTemporary;)i--;return t.insertAt(i+1,e),this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(e,t){this.A2(e,t),e.Eo(this);const i=this.zt,s=i.indexOf(e);s>=0&&(i.delete(e),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o,e);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(e,t){this.A2(e,t),e.Eo(this);const i=this.zt,s=i.indexOf(e);s>=0&&(i.delete(e),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o+1,e);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Qr(e,t){e.Eo(this),this.zt.insertAt(t,e)}wT(e){this.zt.removeAt(e)}removeLayer(e){if(e.diagram!==this&&r.o("Cannot remove a Layer from another Diagram: "+e+" of "+e.diagram),e.name==="")return;const t=this.zt,i=t.indexOf(e);if(t.delete(e)){const s=e.Ct.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;o!==e.name?n.layerName=o:n.layerName=""}this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,e,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(e){const t=this.layers;for(;t.next();){const i=t.value;if(i.name===e)return i}return null}findRouter(e){for(const t of this.of)if(t.name===e)return t;return null}addModelChangedListener(e){return r.S(e,at,"addModelChangedListener:listener"),this.io===null&&(this.io=new E),this.io.add(e),this.model&&this.model.addChangedListener(e),this}removeModelChangedListener(e){r.S(e,at,"removeModelChangedListener:listener"),this.io!==null&&(this.io.delete(e),this.io.count===0&&(this.io=null)),this.model.removeChangedListener(e)}addChangedListener(e){return r.S(e,at,"addChangedListener:listener"),this.Er===null&&(this.Er=new E),this.Er.add(e),this}removeChangedListener(e){r.S(e,at,"removeChangedListener:listener"),this.Er!==null&&(this.Er.delete(e),this.Er.count===0&&(this.Er=null))}T2(e){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(e),e.change!==1&&(this.isModified=!0),this.Er!==null){const t=this.Er,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}}raiseChangedEvent(e,t,i,s,n,o,a){o===void 0&&(o=null),a===void 0&&(a=null);const l=new Et;l.diagram=this,l.change=e,l.propertyName=t,l.object=i,l.oldValue=s,l.oldParam=o,l.newValue=n,l.newParam=a,this.T2(l)}raiseChanged(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}t(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}get partAdded(){return this.kp}set partAdded(e){this.partAdded!==e&&(this.kp=e)}get partRemoved(){return this.Pp}set partRemoved(e){this.partRemoved!==e&&(this.Pp=e)}get animationManager(){return this.Ns}get undoManager(){return this.Ce.undoManager}get skipsUndoManager(){return this.Bo}set skipsUndoManager(e){r.s(e,"boolean",at,"skipsUndoManager"),this.Bo=e,this.Ce.skipsUndoManager=e}get delaysLayout(){return this.Ab}set delaysLayout(e){this.Ab=e}tA(e,t){var s,n;if(e===null||e.diagram!==this)return;const i=this.wi;try{this.wi=!0;const o=e.change;if(o===2){const a=e.object,l=e.propertyName,h=e.getValue(t);if(e.diagram.model.et(a,l,h),a instanceof Ht){const d=a.part;d!==null&&(d.invalidateAdornments(),d instanceof Nt&&((s=d.fromNode)==null||s.Ze(d.fromPort),(n=d.toNode)==null||n.Ze(d.toPort)))}this.isModified=!0}else if(o===3){const a=e.object,l=e.newParam,h=e.newValue;if(a instanceof Lt)if(typeof l=="number"&&h instanceof Ht){t?a.ri(l):a.insertAt(l,h);const d=a.part;d!==null&&d.invalidateAdornments()}else typeof l=="number"&&h instanceof ai&&(h.isRow?a.xT(l,t?void 0:h):a.bT(l,t?void 0:h));else if(a instanceof Oi){const d=e.oldParam===!0;typeof l=="number"&&h instanceof _t&&(t?(d||(h.isSelected=!1,h.isHighlighted=!1,h.invalidateAdornments()),a.ri(d?l:-1,h,d)):a.ch(l,h,d))}else a instanceof at?typeof l=="number"&&h instanceof Oi&&(t?this.wT(l):this.Qr(h,l)):r.o("unknown ChangeType.Insert object: "+e.toString());this.isModified=!0}else if(o===4){const a=e.object,l=e.oldParam,h=e.oldValue;if(a instanceof Lt)typeof l=="number"&&h instanceof Ht?t?a.insertAt(l,h):a.ri(l):typeof l=="number"&&h instanceof ai&&(h.isRow?a.xT(l,t?h:void 0):a.bT(l,t?h:void 0));else if(a instanceof Oi){const d=e.newParam===!0;typeof l=="number"&&h instanceof _t&&(t?a.Ct.indexOf(h)<0&&a.ch(l,h,d):(d||(h.isSelected=!1,h.isHighlighted=!1,h.invalidateAdornments()),a.ri(d?l:-1,h,d)))}else a instanceof at?typeof l=="number"&&h instanceof Oi&&(t?this.Qr(h,l):this.wT(l)):r.o("unknown ChangeType.Remove object: "+e.toString());this.isModified=!0}else o===1||r.o("unknown ChangedEvent: "+e.toString())}finally{this.wi=i}}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(e){this.partManager.updateAllTargetBindings(e)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.ls!==null){const e=this.ls.part;e!==null&&e.Yo()}}setDivBackground(e){this.div&&(this.div.style.backgroundColor=e)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}Np(){const e=this.v,t=this.it,i=this.ct;e.Ue(),t!==1&&e.it(t),(i.x!==0||i.y!==0)&&e.Gs(-i.x,-i.y)}kT(e,t){const i=this.animationManager;if(this.Ht||this.Ts){this.it=t,this.aa(),this.C(),this.Nh(),i.EA(e,this.it),this.Np();return}if(this.lt===null){this.it=t,this.Np();return}this.Ht=!0;const s=this.viewportBounds.copy(),n=this.wt,o=this.xt;let a=this.zoomPoint.x,l=this.zoomPoint.y;const h=this.contentAlignment;isNaN(a)&&(h.isSide()?h.includesSide(X.LeftSide)?a=0:h.includesSide(X.RightSide)&&(a=n-1):h.isSpot()?a=h.x*(n-1):a=n/2),isNaN(l)&&(h.isSide()?h.includesSide(X.TopSide)?l=0:h.includesSide(X.BottomSide)&&(l=o-1):h.isSpot()?l=h.y*(o-1):l=o/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(t=this.scaleComputation(this,t)),t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale);const d=L.z(this.ct.x+a/e-a/t,this.ct.y+l/e-l/t);this.position=d,L.i(d),this.it=t,this.Np(),this.aa(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,e,!1),this.$s(!1),i.EA(e,this.it),this.C()}pO(){const e=this.zt.r;for(let t=0;t<e.length;t++)e[t].YA()}onViewportBoundsChanged(e,t,i,s){if(e.equals(t))return;s===void 0&&(s=!1),s||this.Nh(),this.ha();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(e.width!==t.width||e.height!==t.height)&&n.p();const o=this.currentTool;this.sf===!0&&o instanceof ge&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.cA(this)),this.Ht||this.invalidateViewport(e,t),this.ca(),this.Ye.scale=i,this.Ye.position.x=e.x,this.Ye.position.y=e.y,this.Ye.bounds.h(e),this.Ye.canvasSize.width=Math.round(e.width*i),this.Ye.canvasSize.height=Math.round(e.height*i),this.Ye.newCanvasSize.width=this.wt,this.Ye.newCanvasSize.height=this.xt,this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,e),this.isVirtualized&&this.links.each(a=>{a.isAvoiding&&a.actualBounds.intersectsRect(t)&&a.$t()})}ca(e){const t=this.ls;if(t===null||!t.visible||t.part===null||t.layer===null)return;const i=e!==void 0?e:this.Yb;if(!i.isReal())return;const s=i.width,n=i.height;if(t.scale=1,t.angle=0,t.layer.isViewportAligned)t.width=s*this.scale,t.height=n*this.scale,t.part.alignment=X.TopLeft;else{t.Pe===null&&(t.Pe=new xo);const o=t.Pe.af;if(!o.isReal())return;t.width=s+o.width*2,t.height=n+o.height*2;const a=L.l();B.tm(i.x,i.y,0,0,o.width,o.height,a),a.offset(-o.width,-o.height),t.part.location=a,L.i(a)}}clearSelection(e){e===void 0&&(e=!1);const t=this.selection;if(t.count===0)return;e||this.T("ChangingSelection",t);const i=t.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}t.ce(),t.clear(),t.k(),e||this.T("ChangedSelection",t)}select(e){e!==null&&e.diagram===this&&(!e.isSelected||this.selection.count>1)&&(this.T("ChangingSelection",this.selection),this.clearSelection(!0),e.isSelected=!0,this.T("ChangedSelection",this.selection))}selectCollection(e){if(this.T("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s instanceof _t||r.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const t=e.iterator;for(;t.next();){const i=t.value;i instanceof _t||r.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.T("ChangedSelection",this.selection)}clearHighlighteds(){const e=this.highlighteds;if(e.count>0){const t=e.toArray(),i=t.length;for(let s=0;s<i;s++){const n=t[s];n.isHighlighted=!1}e.ce(),e.clear(),e.k()}}highlight(e){e!==null&&e.diagram===this&&(!e.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),e.isHighlighted=!0)}highlightCollection(e){const t=new F().addAll(e),i=this.highlighteds.copy().removeAll(t).iterator;for(;i.next();){const n=i.value;n.isHighlighted=!1}const s=t.iterator;for(;s.next();){const n=s.value;n instanceof _t||r.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(e,t,i){i===void 0&&(i=1);const s=t==="up"||t==="down";let n=0;const o=L.l();if(e==="pixel")n=i;else if(e==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(e==="page"){let l=s?this.viewportBounds.height:this.viewportBounds.width;if(l*=this.scale,l!==0){const h=Math.max(l-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*h}}else if(e==="document"){const l=this.documentBounds,h=this.viewportBounds;t==="up"?this.position=o.e(h.x,l.y):t==="left"?this.position=o.e(l.x,h.y):t==="down"?this.position=o.e(h.x,l.bottom-h.height):t==="right"&&(this.position=o.e(l.right-h.width,h.y)),L.i(o);return}else r.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+e);n/=this.scale;const a=this.position;t==="up"?this.position=o.e(a.x,a.y-n):t==="down"?this.position=o.e(a.x,a.y+n):t==="left"?this.position=o.e(a.x-n,a.y):t==="right"?this.position=o.e(a.x+n,a.y):r.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+t),L.i(o)}scrollToRect(e){const t=this.viewportBounds;if(t.containsRect(e))return;const i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}centerRect(e){const t=this.viewportBounds,i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}transformDocToView(e){return e.copy().v(this.v)}transformViewToDoc(e){return e.copy().Ki(this.v)}GR(e){return e.Ki(this.v)}get opacity(){return this.Zt}set opacity(e){const t=this.Zt;t!==e&&(r.s(e,"number",at,"opacity"),(e<0||e>1)&&r.J(e,"0 <= value <= 1",at,"opacity"),this.Zt=e,this.t("opacity",t,e),this.C())}get validCycle(){return this.Pb}set validCycle(e){const t=this.Pb;t!==e&&(this.Pb=e,this.t("validCycle",t,e))}get layers(){return this.zt.iterator}get isModelReadOnly(){const e=this.Ce;return e===null?!1:e.isReadOnly}set isModelReadOnly(e){const t=this.Ce;t!==null&&(t.isReadOnly=e)}get isReadOnly(){return this.zo}set isReadOnly(e){const t=this.zo;t!==e&&(r.s(e,"boolean",at,"isReadOnly"),this.zo=e,this.t("isReadOnly",t,e))}get isEnabled(){return this.Be}set isEnabled(e){const t=this.Be;t!==e&&(r.s(e,"boolean",at,"isEnabled"),this.Be=e,this.t("isEnabled",t,e))}get allowClipboard(){return this.Tb}set allowClipboard(e){const t=this.Tb;t!==e&&(r.s(e,"boolean",at,"allowClipboard"),this.Tb=e,this.t("allowClipboard",t,e))}get allowCopy(){return this.Yl}set allowCopy(e){const t=this.Yl;t!==e&&(r.s(e,"boolean",at,"allowCopy"),this.Yl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.Kl}set allowDelete(e){const t=this.Kl;t!==e&&(r.s(e,"boolean",at,"allowDelete"),this.Kl=e,this.t("allowDelete",t,e))}get allowDragOut(){return this.Db}set allowDragOut(e){const t=this.Db;t!==e&&(r.s(e,"boolean",at,"allowDragOut"),this.Db=e,this.t("allowDragOut",t,e))}get allowDrop(){return this.vb}set allowDrop(e){const t=this.vb;t!==e&&(r.s(e,"boolean",at,"allowDrop"),this.vb=e,this.t("allowDrop",t,e))}get allowTextEdit(){return this.Hl}set allowTextEdit(e){const t=this.Hl;t!==e&&(r.s(e,"boolean",at,"allowTextEdit"),this.Hl=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.jl}set allowGroup(e){const t=this.jl;t!==e&&(r.s(e,"boolean",at,"allowGroup"),this.jl=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.ql}set allowUngroup(e){const t=this.ql;t!==e&&(r.s(e,"boolean",at,"allowUngroup"),this.ql=e,this.t("allowUngroup",t,e))}get allowInsert(){return this.Fb}set allowInsert(e){const t=this.Fb;t!==e&&(r.s(e,"boolean",at,"allowInsert"),this.Fb=e,this.t("allowInsert",t,e))}get allowLink(){return this.Wl}set allowLink(e){const t=this.Wl;t!==e&&(r.s(e,"boolean",at,"allowLink"),this.Wl=e,this.t("allowLink",t,e))}get allowRelink(){return this.Jl}set allowRelink(e){const t=this.Jl;t!==e&&(r.s(e,"boolean",at,"allowRelink"),this.Jl=e,this.t("allowRelink",t,e))}get allowMove(){return this.$l}set allowMove(e){const t=this.$l;t!==e&&(r.s(e,"boolean",at,"allowMove"),this.$l=e,this.t("allowMove",t,e))}get allowReshape(){return this.Zl}set allowReshape(e){const t=this.Zl;t!==e&&(r.s(e,"boolean",at,"allowReshape"),this.Zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Ql}set allowResize(e){const t=this.Ql;t!==e&&(r.s(e,"boolean",at,"allowResize"),this.Ql=e,this.t("allowResize",t,e))}get allowRotate(){return this._l}set allowRotate(e){const t=this._l;t!==e&&(r.s(e,"boolean",at,"allowRotate"),this._l=e,this.t("allowRotate",t,e))}get allowSelect(){return this.ta}set allowSelect(e){const t=this.ta;t!==e&&(r.s(e,"boolean",at,"allowSelect"),this.ta=e,this.t("allowSelect",t,e))}get allowUndo(){return this.Rb}set allowUndo(e){const t=this.Rb;t!==e&&(r.s(e,"boolean",at,"allowUndo"),this.Rb=e,this.t("allowUndo",t,e))}get allowZoom(){return this.Ob}set allowZoom(e){const t=this.Ob;t!==e&&(r.s(e,"boolean",at,"allowZoom"),this.Ob=e,this.t("allowZoom",t,e))}get hasVerticalScrollbar(){return this._u}set hasVerticalScrollbar(e){const t=this._u;t!==e&&(r.s(e,"boolean",at,"hasVerticalScrollbar"),this._u=e,this.Nh(),this.C(),this.t("hasVerticalScrollbar",t,e),this.$s(!1))}get hasHorizontalScrollbar(){return this.Qu}set hasHorizontalScrollbar(e){const t=this.Qu;t!==e&&(r.s(e,"boolean",at,"hasHorizontalScrollbar"),this.Qu=e,this.Nh(),this.C(),this.t("hasHorizontalScrollbar",t,e),this.$s(!1))}get allowHorizontalScroll(){return this.Ib}set allowHorizontalScroll(e){const t=this.Ib;t!==e&&(r.s(e,"boolean",at,"allowHorizontalScroll"),this.Ib=e,this.t("allowHorizontalScroll",t,e),this.$s(!1))}get allowVerticalScroll(){return this.Eb}set allowVerticalScroll(e){const t=this.Eb;t!==e&&(r.s(e,"boolean",at,"allowVerticalScroll"),this.Eb=e,this.t("allowVerticalScroll",t,e),this.$s(!1))}get scrollHorizontalLineChange(){return this.Ub}set scrollHorizontalLineChange(e){const t=this.Ub;t!==e&&(r.s(e,"number",at,"scrollHorizontalLineChange"),e<0&&r.J(e,">= 0",at,"scrollHorizontalLineChange"),this.Ub=e,this.t("scrollHorizontalLineChange",t,e))}get scrollVerticalLineChange(){return this.Vb}set scrollVerticalLineChange(e){const t=this.Vb;t!==e&&(r.s(e,"number",at,"scrollVerticalLineChange"),e<0&&r.J(e,">= 0",at,"scrollVerticalLineChange"),this.Vb=e,this.t("scrollVerticalLineChange",t,e))}get lastInput(){return this.gh}set lastInput(e){this.gh=e}get previousInput(){return this.Jr}set previousInput(e){this.Jr=e}get firstInput(){return this.fp}set firstInput(e){this.fp=e}get currentCursor(){return this.Sb}set currentCursor(e){if(e===""&&(e=this.op),this.Sb!==e){r.s(e,"string",at,"currentCursor");const t=this.lt,i=this.Nt;if(t===null||i===null)return;this.Sb=e;const s=t.style.cursor;t.style.cursor=e,i.style.cursor=e,t.style.cursor===s&&(t.style.cursor="-webkit-"+e,i.style.cursor="-webkit-"+e,t.style.cursor===s&&(t.style.cursor="-moz-"+e,i.style.cursor="-moz-"+e,t.style.cursor===s&&(t.style.cursor=e,i.style.cursor=e)))}}get defaultCursor(){return this.op}set defaultCursor(e){e===""&&(e="auto");const t=this.op;t!==e&&(r.s(e,"string",at,"defaultCursor"),this.op=e,this.t("defaultCursor",t,e))}get click(){return this.Ur}set click(e){const t=this.Ur;t!==e&&(e!==null&&r.S(e,at,"click"),this.Ur=e,this.t("click",t,e))}get doubleClick(){return this.Vr}set doubleClick(e){const t=this.Vr;t!==e&&(e!==null&&r.S(e,at,"doubleClick"),this.Vr=e,this.t("doubleClick",t,e))}get contextClick(){return this.Br}set contextClick(e){const t=this.Br;t!==e&&(e!==null&&r.S(e,at,"contextClick"),this.Br=e,this.t("contextClick",t,e))}get mouseOver(){return this.zr}set mouseOver(e){const t=this.zr;t!==e&&(e!==null&&r.S(e,at,"mouseOver"),this.zr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.Xr}set mouseHover(e){const t=this.Xr;t!==e&&(e!==null&&r.S(e,at,"mouseHover"),this.Xr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.Gr}set mouseHold(e){const t=this.Gr;t!==e&&(e!==null&&r.S(e,at,"mouseHold"),this.Gr=e,this.t("mouseHold",t,e))}get mouseDragOver(){return this.Mb}set mouseDragOver(e){const t=this.Mb;t!==e&&(e!==null&&r.S(e,at,"mouseDragOver"),this.Mb=e,this.t("mouseDragOver",t,e))}get mouseDrop(){return this.Yr}set mouseDrop(e){const t=this.Yr;t!==e&&(this.Yr=e,this.t("mouseDrop",t,e))}get handlesDragDropForTopLevelParts(){return this.Nb}set handlesDragDropForTopLevelParts(e){const t=this.Nb;t!==e&&(r.s(e,"boolean",at,"handlesDragDropForTopLevelParts"),this.Nb=e,this.t("handlesDragDropForTopLevelParts",t,e))}get mouseEnter(){return this.Kr}set mouseEnter(e){const t=this.Kr;t!==e&&(e!==null&&r.S(e,at,"mouseEnter"),this.Kr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.Hr}set mouseLeave(e){const t=this.Hr;t!==e&&(e!==null&&r.S(e,at,"mouseLeave"),this.Hr=e,this.t("mouseLeave",t,e))}get toolTip(){return this.jr}set toolTip(e){const t=this.jr;t!==e&&(this.jr=e,this.t("toolTip",t,e))}get contextMenu(){return this.qr}set contextMenu(e){const t=this.qr;t!==e&&(this.qr=e,this.t("contextMenu",t,e))}get commandHandler(){return this.jM}set commandHandler(e){const t=this.jM;t!==e&&(t&&t.doStop(),this.jM=e,e.Eo(this),e.doStart())}get toolManager(){return this.YM}set toolManager(e){this.YM!==e&&(this.YM=e,e.diagram=this)}get defaultTool(){return this.KM}set defaultTool(e){const t=this.KM;t!==e&&(this.KM=e,e.diagram=this,this.currentTool===t&&(this.currentTool=e))}get currentTool(){return this.HM}set currentTool(e){const t=this.HM;t&&(t.isActive&&t.doDeactivate(),t.cancelWaitAfter(),t.doStop()),e===null&&(e=this.defaultTool),e!==null&&(this.HM=e,e.diagram=this,e.doStart())}get selection(){return this.KA}get maxSelectionCount(){return this.Gb}set maxSelectionCount(e){const t=this.Gb;if(t!==e)if(r.s(e,"number",at,"maxSelectionCount"),e>=0&&!isNaN(e)){if(this.Gb=e,this.t("maxSelectionCount",t,e),!this.undoManager.isUndoingRedoing){const i=this.selection.count-e;if(i>0){this.T("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.T("ChangedSelection",this.selection)}}}else r.J(e,">= 0",at,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.hp}set nodeSelectionAdornmentTemplate(e){const t=this.hp;t!==e&&(this.hp=e.It(),this.t("nodeSelectionAdornmentTemplate",t,e))}get groupSelectionAdornmentTemplate(){return this.Hb}set groupSelectionAdornmentTemplate(e){const t=this.Hb;t!==e&&(this.Hb=e.It(),this.t("groupSelectionAdornmentTemplate",t,e))}get linkSelectionAdornmentTemplate(){return this.jb}set linkSelectionAdornmentTemplate(e){const t=this.jb;t!==e&&(this.jb=e.It(),this.t("linkSelectionAdornmentTemplate",t,e))}get highlighteds(){return this.HA}get isModified(){const e=this.undoManager;return e.isEnabled?e.currentTransaction!==null?!0:this.nd&&this.js!==e.historyIndex:this.nd}set isModified(e){if(this.nd!==e){r.s(e,"boolean",at,"isModified"),this.nd=e;const t=this.undoManager;!e&&t.isEnabled&&(this.js=t.historyIndex),e||this.PT()}}PT(){const e=this.isModified;this.$M!==e&&(this.$M=e,this.T("Modified"))}get model(){return this.Ce}set model(e){const t=this.Ce;if(t!==e){this.currentTool.doCancel(),t&&t.undoManager!==e.undoManager&&t.undoManager.isInTransaction&&r.o("Do not replace a Diagram.model while a transaction is in progress.");const i=this.sT(!0);this.no=!1,this.Zu=!0,this.js=-2,this.Dr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Gl("Model"),t&&(this.io!==null&&this.io.each(n=>t.removeChangedListener(n)),t.removeChangedListener(this.Qc)),this.Ce=e,this.partManager=this.NO(this.Ce.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);e.addChangedListener(this.JM),this.partManager.D2(),e.removeChangedListener(this.JM),e.addChangedListener(this.Qc),this.io!==null&&this.io.each(n=>e.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.C(),t&&e.undoManager.copyProperties(t.undoManager)}}get themeManager(){return this.d2}set themeManager(e){const t=this.d2;t!==e&&(t&&t.removeDiagram(this),this.d2=e,e!==null&&e.addDiagram(this))}initializePartManager(e){}static g2(e,t){at.JA.set(e,t)}static get licenseKey(){return at.v2.last()}static set licenseKey(e){at.v2.add(e.replace(/\s/g,""))}static get version(){return at.CO}NO(e){const t=at.JA.get(e);return t!==null?new t:new Xn}get G(){return this.WM}set G(e){this.WM=e}get nb(){return this.jA}LO(e){if(e.model!==this.model)return;const t=e.change,i=e.propertyName;if(t===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.Ts&&!this.no&&(this.Zc=!0,this.Zu&&(this.Dr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.T("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.G){this.G=!1;try{if(e.modelChange===""&&t===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.T("ChangedSelection",this.selection),this.Te());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this.VA(),this.Zc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.SM(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.js=Math.min(this.js,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Sx&&r.dn(()=>{this.isModified=!1},1);const n=e.isTransactionFinished;if(n&&(this.PT(),this.nb.clear(),this.animationManager.CR()),!this.Cb&&n&&this.lastInput.targetDiagram){this.Cb=!0;const o=this;r.dn(()=>{o.currentTool.standardMouseOver(),o.Cb=!1},10)}}}finally{this.G=!0}}}get wi(){return this.qM}set wi(e){this.qM=e}get Ou(){return this.Lb}set Ou(e){this.Lb=e}uT(e){const t=e.D.r;for(const i of t)i instanceof cs&&this.F2(i)}F2(e){const t=e.element;if(t===null||!c.HTMLImageElement||!(t instanceof HTMLImageElement)||(t.hs instanceof F&&t.hs.add(this),e.AO(),!t.Dp))return;const i=t.getAttribute("src")||"",s=this.oa.get(i);if(s===null){cs.ST(e,t);const n=[];n.push(e),this.oa.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}TO(e){const t=e.D.r,i=t.length;for(let s=0;s<i;s++)this.R2(t[s])}R2(e){if(!(e instanceof cs))return;const t=e.element;if(t===null||!c.HTMLImageElement||!(t instanceof HTMLImageElement)||!t.Dp)return;const i=t.getAttribute("src")||"",s=this.oa.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&(this.oa.delete(i),cs.DO(t),t.hs instanceof F&&t.hs.delete(this));return}}}nT(){cs.clearCache(),this.oa.clear()}rebuildParts(){this.partManager.rebuildParts()}Kc(e,t){this.Ns.Kc(e,t)}Yc(e,t){this.Ns.Yc(e,t)}findPartForKey(e){return this.partManager.findPartForKey(e)}findNodeForKey(e){return this.partManager.findNodeForKey(e)}findLinkForKey(e){return this.partManager.findLinkForKey(e)}findPartForData(e){return this.partManager.findPartForData(e)}findNodeForData(e){return this.partManager.findNodeForData(e)}findLinkForData(e){return this.partManager.findLinkForData(e)}findNodesByExample(...e){return this.partManager.findNodesByExample(...e)}findLinksByExample(...e){return this.partManager.findLinksByExample(...e)}get nodeTemplate(){return this.Wr.get("")}set nodeTemplate(e){const t=this.Wr.get("");t!==e&&(this.Wr.set("",e),this.t("nodeTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Wr}set nodeTemplateMap(e){const t=this.Wr;t!==e&&(this.Wr=e,this.t("nodeTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.dh.get("")}set groupTemplate(e){const t=this.dh.get("");t!==e&&(this.dh.set("",e),this.t("groupTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.dh}set groupTemplateMap(e){const t=this.dh;t!==e&&(this.dh=e,this.t("groupTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.na.get("")}set linkTemplate(e){const t=this.na.get("");t!==e&&(this.na.set("",e),this.t("linkTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.na}set linkTemplateMap(e){const t=this.na;t!==e&&(this.na=e,this.t("linkTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.ZM}set isMouseCaptured(e){const t=this.lt;if(t===null)return;const i=t.bt;i instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Le(i,"pointermove",this.xh,!1),this.Le(i,"pointerdown",this.la,!1),this.Le(i,"pointerup",this.bh,!1),this.Le(i,"pointerout",this.kh,!1),this.Le(i,"pointercancel",this.Ph,!1),this.Et(c,"pointermove",this.xh,!0),this.Et(c,"pointerdown",this.la,!0),this.Et(c,"pointerup",this.bh,!0),this.Et(c,"pointerout",this.kh,!0),this.Et(c,"pointercancel",this.Ph,!0),this.Le(i,"wheel",this.wh,!1),this.Et(c,"wheel",this.wh,!0),this.Et(c,"selectstart",this.oh,!1)):(this.Le(c,"pointermove",this.xh,!0),this.Le(c,"pointerdown",this.la,!0),this.Le(c,"pointerup",this.bh,!0),this.Le(c,"pointerout",this.kh,!0),this.Le(c,"pointercancel",this.Ph,!0),this.Et(i,"pointermove",this.xh,!1),this.Et(i,"pointerdown",this.la,!1),this.Et(i,"pointerup",this.bh,!1),this.Et(i,"pointerout",this.kh,!1),this.Et(i,"pointercancel",this.Ph,!1),this.Le(c,"wheel",this.wh,!0),this.Le(c,"selectstart",this.oh,!1),this.Et(i,"wheel",this.wh,!1)),this.ZM=e)}get position(){return this.ct}set position(e){if(this.ct.equals(e))return;const t=L.l().h(this.ct),i=this.viewportBounds.copy();if(this.ct.h(e),this.animationManager.IA(t,this.ct),!this.Ht&&!(this.lt===null&&!this.ed.isReal())){this.Ht=!0;const s=this.scale,n=this.wt/s,o=this.xt/s;this.b2(this.ap,n,o,this.Jc,!1),this.Ht=!1}else this.aa(),this.Np();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.it,!1)}L.i(t)}get initialPosition(){return this.ab}set initialPosition(e){this.ab.equals(e)||(this.ab=e.N())}get initialScale(){return this.hb}set initialScale(e){this.hb!==e&&(r.s(e,"number",at,"initialScale"),this.hb=e)}get grid(){return this.ls===null&&(this.ls=this.rT()),this.ls}set grid(e){let t=this.ls;if(t!==e){t===null&&(this.ls=this.rT(),t=this.ls),e.type!==Lt.Grid&&r.o("Diagram.grid must be a Panel of type Panel.Grid");const i=t.panel;i!==null&&i.remove(t),this.ls=e,e.name="GRID",i!==null&&i.add(e),this.sd=!1,this.C(),this.t("grid",t,e)}}get viewportBounds(){return this.Yb}aa(){const e=this.Yb,t=this.ct,i=this.it;e.e(t.x,t.y,Math.max(this.wt,0)/i,Math.max(this.xt,0)/i),this.ha()}get viewSize(){return this.ed}set viewSize(e){const t=this.viewSize;if(!t.equals(e)){e=e.N(),this.ed=e;let i=0,s=0;e.isReal()?(i=e.width,s=e.height):this.Nt!==null&&(i=this.Nt.clientWidth||1,s=this.Nt.clientHeight||1),this.wt=i,this.xt=s,this.aa(),this.invalidateDocumentBounds(),this.t("viewSize",t,e),this.C()}}get fixedBounds(){return this.db}set fixedBounds(e){const t=this.db;t.equals(e)||((e.width===-1/0||e.height===1/0||e.height===-1/0)&&r.o("fixedBounds width/height must not be Infinity"),e=e.N(),this.db=e,this.invalidateDocumentBounds(),this.t("fixedBounds",t,e))}get scrollMargin(){return this.fh}set scrollMargin(e){typeof e=="number"&&(e=new ct(e));const t=this.fh;t.equals(e)||(e=e.N(),this.fh=e,this.t("scrollMargin",t,e),this.Eu())}get scrollMode(){return this.ah}set scrollMode(e){const t=this.ah;t!==e&&(this.ah=e,e===1&&this.$s(!1),this.t("scrollMode",t,e),this.Nh(),this.C())}get scrollsPageOnFocus(){return this.gb}set scrollsPageOnFocus(e){const t=this.gb;t!==e&&(r.s(e,"boolean",at,"scrollsPageOnFocus"),this.gb=e,this.t("scrollsPageOnFocus",t,e))}get positionComputation(){return this.pb}set positionComputation(e){const t=this.pb;t!==e&&(e!==null&&r.S(e,at,"positionComputation"),this.pb=e,this.$s(!1),this.t("positionComputation",t,e))}get scaleComputation(){return this.yb}set scaleComputation(e){const t=this.yb;t!==e&&(e!==null&&r.S(e,at,"scaleComputation"),this.yb=e,this.kT(this.scale,this.scale),this.t("scaleComputation",t,e))}get documentBounds(){return this.ap}MT(e){this.mh=!1;let t=this.ap;t.equals(e)||(t=t.copy(),this.ap.h(e),this.$s(!1),this.T("DocumentBoundsChanged",void 0,t),this.Nh(),this.C())}ensureBounds(){if(this.mh){const e=Y.l();this.MT(this.computeBounds(e)),Y.i(e)}}get isVirtualized(){return this.Kb}set isVirtualized(e){const t=this.Kb;t!==e&&(r.s(e,"boolean",at,"isVirtualized"),this.Kb=e,this.t("isVirtualized",t,e))}get scale(){return this.it}set scale(e){const t=this.it;t!==e&&this.kT(t,e)}get defaultScale(){return this.dp}set defaultScale(e){this.dp=e}get autoScale(){return this.ia}set autoScale(e){const t=this.ia;t!==e&&(this.ia=e,this.t("autoScale",t,e),e!==1&&this.$s(!1))}get initialAutoScale(){return this.Or}set initialAutoScale(e){const t=this.Or;t!==e&&(this.Or=e,this.t("initialAutoScale",t,e))}get initialViewportSpot(){return this.xb}set initialViewportSpot(e){const t=this.xb;t!==e&&(e.isSpot()||r.o("initialViewportSpot must be a specific Spot: "+e),this.xb=e,this.t("initialViewportSpot",t,e))}get initialDocumentSpot(){return this.wb}set initialDocumentSpot(e){const t=this.wb;t!==e&&(e.isSpot()||r.o("initialViewportSpot must be a specific Spot: "+e),this.wb=e,this.t("initialDocumentSpot",t,e))}get minScale(){return this.cb}set minScale(e){const t=this.cb;t!==e&&(e>0?(this.cb=e,this.t("minScale",t,e),e>this.scale&&(this.scale=e)):r.J(e,"> 0",at,"minScale"))}get maxScale(){return this.fb}set maxScale(e){const t=this.fb;t!==e&&(e>0?(this.fb=e,this.t("maxScale",t,e),e<this.scale&&(this.scale=e)):r.J(e,"> 0",at,"maxScale"))}get zoomPoint(){return this.ub}set zoomPoint(e){this.ub.equals(e)||(e=e.N(),this.ub=e)}get contentAlignment(){return this.Jc}set contentAlignment(e){const t=this.Jc;t.equals(e)||(e=e.N(),this.Jc=e,this.t("contentAlignment",t,e),this.$s(!1))}get initialContentAlignment(){return this.ip}set initialContentAlignment(e){const t=this.ip;t.equals(e)||(e=e.N(),this.ip=e,this.t("initialContentAlignment",t,e))}get padding(){return this.Qt}set padding(e){typeof e=="number"&&(e=new ct(e));const t=this.Qt;t.equals(e)||(e=e.N(),this.Qt=e,this.invalidateDocumentBounds(),this.t("padding",t,e))}get partManager(){return this.i2}set partManager(e){const t=this.i2;t!==e&&(e.diagram!==null&&r.o("Cannot share PartManagers between Diagrams: "+e.toString()),t&&t.Eo(null),this.i2=e,e.Eo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const e=new F,t=this.nodes;for(;t.next();){const s=t.value;s.isTopLevel&&e.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&e.add(s)}return e.iterator}findTopLevelGroups(){return this.Zr.iterator}get routers(){return this.of}doLinkRouting(e){this.Vo=!0;const t=this.of.r;for(let i=0;i<t.length;i++)t[i].canRoute(e)&&t[i].routeLinks(this.Ir,e);this.Vo=!1}get layout(){return this.li}set layout(e){const t=this.li;t!==e&&(this.li=e,e.diagram=this,e.group=null,this.$r=!0,this.t("layout",t,e),this.requestUpdate())}layoutDiagram(e){this.Te(),e&&this.c1(!0),this.Ts?this.S2(!1,this.Fl||this.of.count!==0&&this.eo.size!==0):(this.Zc=!0,this.Sr())}c1(e){const t=this.Zr.iterator;for(;t.next();)this.NT(t.value,e);this.layout&&(e?this.layout.isValidLayout=!1:this.layout.p())}NT(e,t){if(e===null)return;const i=e.Ch.iterator;for(;i.next();){const s=i.value;this.NT(s,t)}e.layout!==null&&(t?e.layout.isValidLayout=!1:e.layout.p())}S2(e,t){if(this.Ab)return;const i=this.G;this.G=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,a=this.animationManager;try{n===0&&(this.undoManager.Dl=!0,this.startTransaction(s)),n<=1&&!a.defaultAnimation.isAnimating&&!a.ke&&(e||a.Gl(s)),this.$r=!1;let l=this.Zr.iterator;for(;l.next();)this.cd(l.value),this.CT(l.value,e,n,t);let h=!1;if(o.isValidLayout||(!e||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.cd(this),h=!0,o.isValidLayout=!0):this.$r=!0),h||this.cd(this),this.doLinkRouting(this),this.Ir.clear(),this.uh.size!==0){for(let d=0;d<23&&this.uh.size!==0;d++){for(l=this.Zr.iterator;l.next();)this.LT(l.value);const f=this.Ir;this.Ir=this.uh,this.uh=f,this.cd(this),this.doLinkRouting(this)}this.Ir.clear(),this.uh.clear()}}finally{const l=this.undoManager.Dl;n===0&&(this.commitTransaction(s),this.undoManager.Dl=!1),l&&(n===0||n===1)&&a.SM(),this.$r&&(this.$r=!o.isValidLayout),this.G=i}}CT(e,t,i,s){const n=e.Ch.iterator;for(;n.next();)this.CT(n.value,t,i,s);const o=e.layout;o!==null&&!o.isValidLayout?!t||o.isRealtime||i===0?(e.Lh=!e.location.isReal(),o.doLayout(e),e.invalidateLayout(32),this.o1(e),this.cd(e),this.doLinkRouting(e),o.isValidLayout=!0):(this.doLinkRouting(e),this.$r=!0):s&&this.doLinkRouting(e)}LT(e){const t=e.Ch.iterator;for(;t.next();)this.LT(t.value);this.cd(e),this.doLinkRouting(e)}get isTreePathToChildren(){return this.bb}set isTreePathToChildren(e){const t=this.bb;if(t!==e&&(r.s(e,"boolean",at,"isTreePathToChildren"),this.bb=e,this.t("isTreePathToChildren",t,e),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.vp()}}findTreeRoots(){const e=new E,t=this.nodes;for(;t.next();){const i=t.value;i.isTopLevel&&i.findTreeParentLink()===null&&e.add(i)}return e.iterator}get treeCollapsePolicy(){return this.kb}set treeCollapsePolicy(e){const t=this.kb;t!==e&&(e!==1&&e!==2&&e!==3&&r.o("Unknown Diagram.treeCollapsePolicy: "+e),this.kb=e,this.t("treeCollapsePolicy",t,e))}get isCollapsingExpanding(){return this.GM}set isCollapsingExpanding(e){this.GM=e}QR(){const e=new nt,t=new nt;function i(s){const n=s.toLowerCase(),o=new E;e.set(s,o),e.set(n,o),t.set(s,s),t.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("FocusOrVirtualPointerEnabledChanged"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.zM=e,this.XM=t}fT(e){const t=this.XM.get(e);return t!==null?t:this.XM.get(e.toLowerCase())}O2(e){let t=this.zM.get(e);if(t!==null)return t;const i=e.toLowerCase();if(t=this.zM.get(i),t!==null)return t;r.o("Unknown DiagramEvent name: "+e)}addDiagramListener(e,t){r.s(e,"string",at,"addDiagramListener:name"),r.S(t,at,"addDiagramListener:listener");const i=this.O2(e);return i!==null&&i.add(t),this}removeDiagramListener(e,t){r.s(e,"string",at,"removeDiagramListener:name"),r.S(t,at,"addDiagramListener:listener");const i=this.O2(e);i!==null&&i.delete(t)}raiseDiagramEvent(e,t,i){this.T(e,t,i)}T(e,t,i){const s=this.O2(e),n=new Rt;n.diagram=this;const o=this.fT(e);o!==null&&(n.name=o),t!==void 0&&(n.subject=t),i!==void 0&&(n.parameter=i);const a=s.length;if(a===1)s.elt(0)(n);else if(a!==0){const l=s.toArray();for(let h=0;h<a;h++){const d=l[h];d(n)}}}isUnoccupied(e,t){return this.getPositions(!1,null,t||null).isUnoccupied(e.x,e.y,e.width,e.height)}computeOccupiedArea(e){return this.isVirtualized?this.viewportBounds.copy():this.mh?this.aT(e):e.h(this.documentBounds)}getPositions(e,t,i){let s=this.sa;s===null&&(this.sa=s=new Zs(this.avoidanceCellSize));let n=t;if(s.Ko||s.Ah!==n||s.I2!==i){if(s.E2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.U2=Math.max(s.hf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.AT(n)),n===null){const o=Y.l();this.computeOccupiedArea(o),o.inflate(100,100),s.f1(o);const a=this.nodes;for(;a.next();){const l=a.value,h=l.layer;h===null||!h.visible||h.isTemporary||this.V2(l,i,o)}Y.i(o)}else{if(n.memberParts.count>0){const l=this.computePartsBounds(n.memberParts,!1);l.inflate(20,20),s.f1(l)}const o=Y.l(),a=n.memberParts;for(;a.next();){const l=a.value;l instanceof wt&&this.V2(l,i,o)}Y.i(o)}s.Ah=n,s.I2=i,s.Ko=!1}else e&&s.TT();return s}get avoidanceCellSize(){return this.QM}set avoidanceCellSize(e){this.sa=null,this.QM=new _(Math.max(1,e.width),Math.max(1,e.height))}get avoidanceLimit(){return this._M}set avoidanceLimit(e){this._M=Math.max(1,e)}AT(e){return e.canAvoid()?e:e.containingGroup!==null?this.AT(e.containingGroup):null}V2(e,t,i){if(e===t||!e.isVisible())return;const s=e.canAvoid();if(s){const n=e.getAvoidableRect(i);this.sa.vO(n.x,n.y,n.width,n.height)}if(e instanceof Ft&&(!s||e.avoidableMembers)){const n=e.memberParts;for(;n.next();){const o=n.value;o instanceof wt&&this.V2(o,t,i)}}}fd(e){this.sa!==null&&!this.sa.Ko&&(e===void 0||e.canAvoid())&&(this.sa.Ko=!0)}get autoScrollInterval(){return this.sp}set autoScrollInterval(e){const t=this.sp;t!==e&&(this.sp=e,this.t("autoScrollInterval",t,e))}get autoScrollRegion(){return this.np}set autoScrollRegion(e){typeof e=="number"&&(e=new ct(e));const t=this.np;t.equals(e)||(e=e.N(),this.np=e,this.invalidateDocumentBounds(),this.t("autoScrollRegion",t,e))}doAutoScroll(e){this.cp.h(e);const t=L.l();this.computeAutoScrollPosition(this.cp,t).equalsApprox(this.position)?this.stopAutoScroll():this.DT(),L.i(t)}DT(){if(this.$c!==-1)return;const e=this.sp,t=this;this.$c=r.dn(()=>{if(t.$c===-1||(t.stopAutoScroll(),t.lastInput.event===null))return;const i=L.l(),s=t.computeAutoScrollPosition(t.cp,i);if(!s.equalsApprox(t.position)){t.position=s,t.lastInput.documentPoint=t.transformViewToDoc(t.cp),t.doMouseMove(),t.mh=!0;const n=Y.l();t.computeBounds(n),n.unionRect(t.documentBounds),t.MT(n),Y.i(n),t.qi=!0,t.maybeUpdate(),t.DT()}L.i(i)},e)}stopAutoScroll(){this.$c!==-1&&(r.wc(this.$c),this.$c=-1)}computeAutoScrollPosition(e,t){let i=this.position;t===void 0&&(t=new L),t.h(i);const s=this.np;if(s.top<=0&&s.left<=0&&s.right<=0&&s.bottom<=0)return t;const n=this.viewportBounds,o=this.scale,a=Y.z(0,0,n.width*o,n.height*o),l=L.z(0,0);if(e.x>=a.x&&e.x<a.x+s.left&&this.allowHorizontalScroll){let h=Math.max(this.scrollHorizontalLineChange,1);h=h|0,l.x-=h,e.x<a.x+s.left/2&&(l.x-=h),e.x<a.x+s.left/4&&(l.x-=4*h)}else if(e.x<=a.x+a.width&&e.x>a.x+a.width-s.right&&this.allowHorizontalScroll){let h=Math.max(this.scrollHorizontalLineChange,1);h=h|0,l.x+=h,e.x>a.x+a.width-s.right/2&&(l.x+=h),e.x>a.x+a.width-s.right/4&&(l.x+=4*h)}if(e.y>=a.y&&e.y<a.y+s.top&&this.allowVerticalScroll){let h=Math.max(this.scrollVerticalLineChange,1);h=h|0,l.y-=h,e.y<a.y+s.top/2&&(l.y-=h),e.y<a.y+s.top/4&&(l.y-=4*h)}else if(e.y<=a.y+a.height&&e.y>a.y+a.height-s.bottom&&this.allowVerticalScroll){let h=Math.max(this.scrollVerticalLineChange,1);h=h|0,l.y+=h,e.y>a.y+a.height-s.bottom/2&&(l.y+=h),e.y>a.y+a.height-s.bottom/4&&(l.y+=4*h)}return l.equalsApprox(L.gn)||(t.x=i.x+l.x/o,t.y=i.y+l.y/o),Y.i(a),L.i(l),t}makeSvg(e){this.Xo.has("SVG")||this.addRenderer("SVG",new gr(this,c.document));const t=new gr(this,c.document,!0);e===void 0&&(e={});const i=this;function s(n,o){const a=i.vT(n,"SVG",t),l=a!==null?a.svg:null,h=n.svgFinished;return l&&h&&h(l),r.st(o)?(o(l),null):l}return this.FT(s,e)}makeSVG(e){return this.makeSvg(e)}addRenderer(e,t){this.Xo.set(e,t)}removeRenderer(e){this.Xo.delete(e)}cacheGroupExternalLinks(e){this.u2=e,e||this.nodes.each(t=>{t instanceof Ft&&(t.Fp=null)})}FT(e,t){const i=t.callback;let s=!0;const n=this.oa.iterator;for(;n.next();)if(!n.value[0].Mn){s=!1;break}if(!r.st(i)||s)return e(t,i,this);const o=this;function a(){const d=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].Mn){s=!1;break}if(s||d-h>l){e(t,i,o);return}c.requestAnimationFrame(a)}const l=t.callbackTimeout||300,h=+new Date;return c.requestAnimationFrame(()=>a()),null}makeImage(e){return at.isUsingDOM()?(e===void 0&&(e={}),e.returnType="Image",this.makeImageData(e)):null}makeImageData(e){return e===void 0&&(e={}),this.FT(this.FO,e)}FO(e,t,i){const s=i.vT(e,"canvas",null);if(s===null)return null;const n=s.F.canvas;let o=null;if(n!==null){let a=e.returnType;switch(a===void 0?a="string":a=a.toLowerCase(),a){case at.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case at.img:const l=(e.document||document).createElement("img");l.src=n.toDataURL(e.type,e.details),o=l;break;case"blob":{const h=n;return r.st(t)||(o="",r.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),r.st(h.toBlob)?(h.toBlob(t,e.type,e.details),"toBlob"):(t(null),null)}case"string":default:o=n.toDataURL(e.type,e.details)}}return r.st(t)?(t(o),null):o}vT(e,t,i){this.animationManager.stopAnimation(),this.maybeUpdate(),r.$(e)||r.o("properties argument must be an Object.");let s=!1,n=e.size||null,o=e.scale||null;e.scale!==void 0&&isNaN(e.scale)&&(o="NaN");let a=e.maxSize;e.maxSize===void 0&&(s=!0,t==="SVG"?a=new _(1/0,1/0):a=new _(2e3,2e3));const l=e.position||null;let h=e.parts||null;Array.isArray(h)&&(h=new E(h));let d=e.padding===void 0?1:e.padding;const f=e.background||null;let m=e.omitTemporary;m===void 0&&(m=!0);const p=e.document||c.document,b=e.elementFinished||null;let x=e.showTemporary;x===void 0&&(x=!m);let v=e.showGrid;v===void 0&&(v=x),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof d=="number"?d=new ct(d):d instanceof ct||r.o("MakeImage padding must be a Margin or a number."),d.left=Math.max(d.left,0),d.right=Math.max(d.right,0),d.top=Math.max(d.top,0),d.bottom=Math.max(d.bottom,0),this.Wt&&this.Wt.clearContextCache(!0);const S=new wn(null,p,void 0,!0),P=S._t;if(!(n||o||h||l))return S.width=this.wt+Math.ceil(d.left+d.right),S.height=this.xt+Math.ceil(d.top+d.bottom),t==="SVG"?i===null?null:(i.resize(S.width,S.height,S.width,S.height),i.el=p,i.ud=b,this.l1(i._t,d,new _(S.width,S.height),this.it,this.ct,h,f,x,v),i._t):(this.od=!1,this.l1(P,d,new _(S.width,S.height),this.it,this.ct,h,f,x,v),this.od=!0,S._t);const T=this.dp,A=this.documentBounds.copy();if(A.subtractMargin(this.Qt),x){const K=this.zt.r,$=K.length;for(let q=0;q<$;q++){const J=K[q];if(!J.visible||!J.isTemporary)continue;const ot=J.Ct.r,rt=ot.length;for(let st=0;st<rt;st++){const ht=ot[st];if(!ht.isInDocumentBounds||!ht.isVisible())continue;const pt=ht.actualBounds;pt.isReal()&&A.unionRect(pt)}}}let C=new L(A.x,A.y);if(h!==null){const K=new Y(0,0,0,0);let $=!0;const q=h.iterator;for(q.reset();q.next();){const J=q.value;if(!(J instanceof _t))continue;const ot=J.layer;if(ot!==null&&!ot.visible||ot!==null&&!x&&ot.isTemporary||!J.isVisible())continue;const rt=J.actualBounds;rt.isReal()&&($?($=!1,K.h(rt)):K.unionRect(rt))}A.width=K.width,A.height=K.height,C.x=K.x,C.y=K.y}l!==null&&l.isReal()&&(C=l,o||(o=T));let O=0,R=0;d!==null&&(O=d.left+d.right,R=d.top+d.bottom);let I=0,H=0;n!==null&&(I=n.width,H=n.height,isFinite(I)&&(I=Math.max(0,I-O)),isFinite(H)&&(H=Math.max(0,H-R)));let V=0,z=0;if(n!==null&&o!==null?(o==="NaN"&&(o=T),n.isReal()?(V=I,z=H):isNaN(H)?(V=I,z=A.height*o):(V=A.width*o,z=H)):n!==null?n.isReal()?(o=Math.min(I/A.width,H/A.height),V=I,z=H):isNaN(H)?(o=I/A.width,V=I,z=A.height*o):(o=H/A.height,V=A.width*o,z=H):o!==null?o==="NaN"&&a.isReal()?(o=Math.min((a.width-O)/A.width,(a.height-R)/A.height),o>T?(o=T,V=A.width,z=A.height):(V=a.width,z=a.height)):(V=A.width*o,z=A.height*o):(o=T,V=A.width,z=A.height),d!==null?(V+=O,z+=R):d=new ct(0),a!==null){let K=a.width,$=a.height;t!=="SVG"&&s&&at.RO,isNaN(K)&&(K=2e3),isNaN($)&&($=2e3),isFinite(K)&&(V=Math.min(V,K)),isFinite($)&&(z=Math.min(z,$))}return S.width=Math.ceil(V),S.height=Math.ceil(z),t==="SVG"?i===null?null:(i.resize(S.width,S.height,S.width,S.height),i.el=p,i.ud=b,this.l1(i._t,d,new _(Math.ceil(V),Math.ceil(z)),o,C,h,f,x,v),i._t):(this.od=!1,this.l1(P,d,new _(Math.ceil(V),Math.ceil(z)),o,C,h,f,x,v),this.od=!0,S._t)}};y(at,"Zb",null),y(at,"JA",new nt),y(at,"h2"),y(at,"c2",null),y(at,"eT",c.document!==void 0),y(at,"Wi",new WeakMap),y(at,"Sp",null),y(at,"i1",""),y(at,"None",1),y(at,"Uniform",2),y(at,"UniformToFill",3),y(at,"CycleAll",1),y(at,"CycleNotDirected",2),y(at,"CycleNotDirectedFast",3),y(at,"CycleNotUndirected",4),y(at,"CycleDestinationTree",5),y(at,"CycleSourceTree",6),y(at,"DocumentScroll",1),y(at,"InfiniteScroll",2),y(at,"TreeParentCollapsed",1),y(at,"AllParentsCollapsed",2),y(at,"AnyParentsCollapsed",3),y(at,"v2",new E),y(at,"CO","3.1.3"),y(at,"img","image"),y(at,"RO",!1),y(at,"Mh",null),y(at,"B2","5da73c80a36555d5038e4972187c3cae51fd22"),y(at,"OO","5da73c80a36555d503aa5c72106c30b35bb2006b9cd041b259"),y(at,"qw",!1),y(at,"OP",()=>{if(at.B2[5]===void 0&&(lt.prototype.Ci=lt.prototype.Mu),!at.isUsingDOM())return;const e=r.Ni("canvas");e.width=350;const t=e.getContext("2d"),i=r.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[at.B2,r.qw+"4ae6247590da4bb21c324ba3a84e385776",lt.OP+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",B.za];t.scale(2,2);const o=8;for(let a=1;a<5;a++)t[r.We(s)](r.We(n[a-1]),o,a*15);t[i]=r.We("39f046ebb36e4b");for(let a=1;a<5;a++)t[r.We(s)](r.We(n[a-1]),o,a*15);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(lt.prototype.Ci=lt.prototype.Mu),at.Mh=e}),y(at,"IO",()=>{if(at.B2[5]===void 0&&(lt.prototype.Ci=lt.prototype.Mu),!at.isUsingDOM())return;const e=r.Ni("canvas"),t=e.getContext("2d"),i=r.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[at.OO,B.za],o=5;t.scale(2,2);for(let a=1;a<3;a++)t[r.We(s)](r.We(n[a-1]),o,a*11);t[i]=r.We("39f046ebb36e4b");for(let a=1;a<3;a++)t[r.We(s)](r.We(n[a-1]),o,a*11);(n.length!==2||n[0][0]!=="5")&&(lt.prototype.Ci=lt.prototype.Mu),at.Mh=e});let qt=at;class Cp{constructor(e){y(this,"RT");y(this,"OT");y(this,"z2");y(this,"bi");if(this.RT=null,this.OT="63ad05bbe23a1786468a4c741b6d2",this.z2="@onz",this.OT===this._tk){this.z2=!0,this.bi=this.z2;return}this.bi=null}EO(e,t){let i="f";const s=c[r.We("76a715b2f73f148a")][r.We("72ba13b5")]||"",n=r.We;if(this.bi=!0,!qt.isUsingDOM())return;let o=qt[n("76a115b6ed251eaf4692")];if(!o){const l=s[n("76ad18b4f73e")];for(let d=s[n("73a612b6fb191d")](n("35e7"))+2;d<l;d++)i+=s[d];const h=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.bi=!(h>=0&&h<i[n("73a612b6fb191d")](n("35")));return}const a=qt.v2.iterator;for(;a.next();){o=a.value;const l=n(o).split(n("39e9")),h=l.length===7?1:0;if(l.length===1&&o.includes(n("5b8b3797c61b32a7"))){if(qt.IO(),!e.lt)return;e.gp=e.lt._t.F[r.We("7eba17a4ca3b1a8346")][r.We("78a118b7")](e.lt._t.F,qt.Mh,4,4)}if(l.length<6)return;const d=n(l[1+h]).split(".");if(l[4+h]!=="7da71ca0")return;const f=n(r[n("6cae19")]).split(".");if(!(d[0]>f[0]||d[0]===f[0]&&d[1]>=f[1]))continue;const m="73a612b6fb191d",p=c[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),b=p[n(m)](n("3aad1ab6e022098b4dc4")),x=n(l[2+h]);if(b>-1){const V=p[n(m)](x.toLowerCase()+"/");if(this.bi=!(V>-1&&V<b),!this.bi)return}const v=s[n("76ad18b4f73e")];for(let V=s[n(m)](n("35e7"))+2;V<v;V++)i+=s[V];let S=i[n(m)](x);if(S<0&&x!==n("7da71ca0ad381e90")&&(S=i[n(m)](n("76a715b2ef3e149757"))),S<0&&(S=i[n(m)](n("76a715b2ef3e149757"))),S<0&&(S=i[n(m)](n("2bfa41fdb3784bca12"))),S<0&&(S=s[n(m)](n("7baa19a6f76c1988428554"))),S<0&&(S=s[n(m)](n("7ea902b2b9221e9c57c45767196566"))),this.bi=!(S>=0&&S<i[n(m)](n("35"))||i[n(m)](n("35"))===-1),!this.bi||s[n(m)](n("7fb002b6ed25128b4da25b2e"))&&(this.bi=!(s[n(m)](x)>-1),!this.bi))return;const P=c[r.We("76a715b2f73f148a")][r.We("69ad17a1e03e")],T=P[n(m)](n("7fb002b6ed25128b4da25b2e"));if(T>-1&&(this.bi=!(P[n(m)](x)>T),!this.bi))return;const A=x;if(A[0]!=="#")continue;const C=r.Ni("div");let O=l[0+h].replace(/[A-Za-z]/g,"");for(;O.length<4;)O+="9";const R=O;O=O.substring(O.length-4);const I=parseInt(f[0]),H=parseInt(f[1]);if(I>3||I===3&&H>=1){const V=parseInt(R)%40+30,z=parseInt(A.substring(1,5),16);if(Nt.IT===V+z){this.bi=!1;return}}else{let V="";const z=["gsh","gsf"],K=["Header","Background","Display","Feedback"];if(V+=z[parseInt(O.substring(0,1),10)%2],V+=K[parseInt(O.substring(0,1),10)%4],C[n("79a417a0f0181a8946")]=V,c.document[n("78a712aa")]){c.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](C);const $=c.getComputedStyle(C).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),q=c.getComputedStyle(C).getPropertyValue(n("75b817b0ea2202"));if(c.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](C),!$)continue;const J=c[n("77a902b0eb1b1e804a8a")],ot="0."+parseInt(R,10)%100;if(q===ot||$.indexOf(parseInt(A[1]+A[2],16).toString())!==-1&&$.indexOf(parseInt(A[3]+A[4],16).toString())!==-1){this.bi=!1;return}else if(J&&J(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){V="."+V;for(let rt=0;rt<c.document.styleSheets.length;rt++){const st=c.document.styleSheets[rt].rules||c.document.styleSheets[rt].cssRules;for(const ht in st)if(V===st[ht].selectorText){this.bi=!1;return}}}}else this.bi=null,t&&(this.bi=!1)}}}Mh(e,t){return t.setTransform(e.$e/2,0,0,e.$e/2,0,0),t.commitTransform(),this.bi===null&&this.EO(e,!0),0<this.bi&&this!==this.RT}}class jn{constructor(e){y(this,"X2");y(this,"G2");this.X2=e===void 0?new L:e,this.G2=new L}get point(){return this.X2}set point(e){this.X2=e}get shifted(){return this.G2}set shifted(e){this.G2=e}}class Np{constructor(e,t,i){y(this,"Ri");y(this,"pT");y(this,"h1");this.Ri=e,this.pT=t,this.h1=i}}class ca{constructor(e){y(this,"isGridSnapEnabled");y(this,"isGridSnapRealtime");y(this,"gridSnapCellSize");y(this,"gridSnapCellSpot");y(this,"gridSnapOrigin");y(this,"dragsLink");y(this,"dragsTree");y(this,"groupsSnapMembers");y(this,"groupsAlwaysMove");y(this,"dragsMembers");this.Ue(),e&&Object.assign(this,e)}Ue(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new _(NaN,NaN).k(),this.gridSnapCellSpot=X.TopLeft,this.gridSnapOrigin=new L(NaN,NaN).k(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Ap extends qt{constructor(e,t){let i;return e===void 0||typeof e=="string"||c.Element&&e instanceof Element?i=e:r.$(e)&&(t=e),super(i),this.ET(),t&&this.setProperties(t),this}ET(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=X.TopCenter,this.layout=new ga}setupRouters(){}reset(){super.reset(),this.ET()}}class dr extends qt{constructor(t,i){let s;t===void 0||typeof t=="string"||c.Element&&t instanceof Element?s=t:r.$(t)&&(i=t);super(s);y(this,"u1");y(this,"d1");y(this,"g1");y(this,"m1");y(this,"Rp");y(this,"cf");y(this,"Bl");y(this,"Y2");y(this,"K2");y(this,"p1");y(this,"H2");return this.animationManager.isEnabled=!1,this.Ht=!0,this.u1=null,this.Qu=!1,this._u=!1,this.d1=!0,this.g1=!0,this.m1=0,this.Rp=!1,this.cf=null,this.setRenderingHint("drawShadows",!1),this.Bl=new _t({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new Xt({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).It(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new ct(0,0,0,0),this.ct.e(0,0),this.toolManager.Jt("Dragging",new Tp,this.toolManager.mouseMoveTools),this.click=()=>{const n=this.observed;if(n===null)return;const o=n.viewportBounds,a=this.lastInput.documentPoint;n.position=new L(a.x-o.width/2,a.y-o.height/2)},this.Y2=n=>{this.invalidateDocumentBounds(),this.Op()},this.K2=n=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.C())},this.p1=n=>{this.updateDelay<1?this.C():this.Rp||(this.Rp=!0,r.dn(()=>this.redraw(),this.updateDelay))},this.H2=n=>{this.observed!==null&&this.Op()},this.autoScale=2,this.Ht=!1,i&&this.setProperties(i),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.Rp&&this.updateDelay>=1&&(this.Rp=!1,this.UO()),super.redraw()}Ge(){if(this.Nt===null&&r.o("No div specified"),this.lt===null&&r.o("No canvas specified"),this.lt instanceof gr||(this.box.VM(),!this.qi))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Qa)return;this.Lp();const i=this.lt,s=this.Wt;if(s.clearContextCache(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.UT();else if(this.cf!==null){s.drawImage(this.cf.bt,0,0);const a=this.v;s.scale(this.$e,this.$e),s.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),s.commitTransform()}const n=this.zt.r,o=n.length;for(let a=0;a<o;a++)n[a].Ge(s,this);this.tf=!1,this.qi=!1}UO(){const t=this.lt,i=this.Wt;if(!(t===null||i===null)){if(this.Lp(),this.cf===null){const s=new wn(null);s.width=t.width,s.height=t.height,this.cf=s}try{this.lt=this.cf,this.Wt=this.lt._t,this.Wt.clearContextCache(!0),this.Wt.setTransform(1,0,0,1,0,0),this.Wt.clearRect(0,0,this.lt.width,this.lt.height),this.UT()}finally{this.lt=t,this.Wt=i}}}UT(){const t=this.observed;if(t===null)return;const i=this.drawsTemporaryLayers,s=this.drawsGrid&&i,n=t.grid;if(s&&n!==null&&n.visible&&!(isNaN(n.width)||isNaN(n.height))){const m=Y.l().h(this.viewportBounds).unionRect(t.viewportBounds);t.ca(m),Y.i(m),t.Te()}const o=this.v,a=this.Wt;a.scale(this.$e,this.$e),a.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),a.commitTransform();const l=this.viewportBounds,h=t.zt.r,d=h.length,f=this.zt.r;this.As(f,f.length,this,this.viewportBounds);for(let m=0;m<d;m++)h[m].ER(a,l,this,i,s)}get observed(){return this.u1}set observed(t){const i=this.u1;if(t!==null&&r.se(t,qt,dr,"observed"),t instanceof dr&&r.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(i!==null&&this.VO(i),this.u1=t,t!==null&&this.BO(t),this.invalidateDocumentBounds(),t===null){this.cf=null;const s=this.lt,n=this.Wt;s&&n&&(n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,s.width,s.height))}else this.p1(null),this.Op(),this.C();this.t("observed",i,t)}}get box(){return this.Bl}set box(t){const i=this.Bl;i!==t&&(t.It(),this.Bl=t,this.remove(i),this.add(this.Bl),this.Op(),this.t("box",i,t))}get drawsTemporaryLayers(){return this.d1}set drawsTemporaryLayers(t){this.d1!==t&&(this.d1=t,this.redraw())}get drawsGrid(){return this.g1}set drawsGrid(t){this.g1!==t&&(this.g1=t,this.redraw())}get updateDelay(){return this.m1}set updateDelay(t){t<0&&(t=0),this.m1!==t&&(this.m1=t)}BO(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this.Y2),t.addDiagramListener("DocumentBoundsChanged",this.K2),t.addDiagramListener("InvalidateDraw",this.p1),t.addDiagramListener("AnimationFinished",this.H2),this.add(this.box))}VO(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.Y2),t.removeDiagramListener("DocumentBoundsChanged",this.K2),t.removeDiagramListener("InvalidateDraw",this.p1),t.removeDiagramListener("AnimationFinished",this.H2))}Op(){const t=this.box,i=this.observed;if(i===null)return;this.qi=!0;const s=i.viewportBounds,n=t.selectionObject,o=_.l();o.e(s.width,s.height),n.desiredSize=o,_.i(o);const a=2/this.scale;n instanceof Xt&&(n.strokeWidth=a),t.location=new L(s.x-a/2,s.y-a/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return Y.em;const i=t.documentBounds.copy();return i.unionRect(t.viewportBounds),i}invalidateViewport(t,i){this.qi!==!0&&(this.qi=!0,this.requestUpdate())}onViewportBoundsChanged(t,i,s,n){this.Ht||(this.ha(),this.C(),this.Nh(),this.invalidateDocumentBounds(),this.Op(),this.Ye.scale=s,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.isScroll=n,this.T("ViewportBoundsChanged",this.Ye,t))}}class Tp extends ae{constructor(){super();y(this,"ua");this.ua=L.mn}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const i=t.observed;if(i===null)return!1;const s=t.lastInput;if(!s.left||t.currentTool!==this&&(!this.isBeyondDragSize()||s.isTouchEvent&&s.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=i.viewportBounds;this.ua=new L(n.width/2,n.height/2);const o=t.firstInput.documentPoint;i.position=new L(o.x-this.ua.x,o.y-this.ua.y)}return!0}doActivate(){this.ua=L.mn,super.doActivate()}doUpdateCursor(t){const i=this.diagram,s=i.box;s!==null&&s.cursor&&(i.currentCursor=s.cursor)}moveParts(t,i,s){const n=this.diagram,o=n.observed;if(o===null)return;const a=n.box;if(a===null)return;if(!this.ua.isReal()){const h=n.firstInput.documentPoint,d=a.location;this.ua=new L(h.x-d.x,h.y-d.y)}const l=n.lastInput.documentPoint;o.position=new L(l.x-this.ua.x,l.y-this.ua.y)}}const Ye=class Ye{constructor(e){y(this,"a");y(this,"w1","go._clipboard");y(this,"b1","go._clipboardFormat");y(this,"j2");y(this,"q2");y(this,"W2");y(this,"J2");y(this,"$2");y(this,"Z2");y(this,"Q2");y(this,"_2");y(this,"tN");y(this,"da");y(this,"eN");y(this,"k1");y(this,"P1");y(this,"S1");y(this,"M1");y(this,"iN");y(this,"Ho");y(this,"sN");y(this,"nN");y(this,"Ip");y(this,"oN");y(this,"N1");y(this,"rN");y(this,"C1");y(this,"lN");y(this,"aN");y(this,"dd");y(this,"Ep");y(this,"Up");y(this,"hN");y(this,"Qc");y(this,"cN");y(this,"fN");y(this,"uN");y(this,"dN");y(this,"gN");y(this,"gd");y(this,"mN");y(this,"Oi");y(this,"Ps");y(this,"L1");y(this,"Vp");y(this,"BT",["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]);F.Je(this),this.a=qt.Om(),this.j2=!0,this.q2=!0,this.W2=!0,this.J2=!1,this.$2=!1,this.Z2=!1,this.Q2=!1,this._2="memory",this.tN=null,this.da=null,this.eN=1.05,this.k1=NaN,this.P1=L.mn,this.S1=NaN,this.M1=Y.em,this.iN=!1,this.Ho=null,this.sN=200,this.nN=!1,this.Ip=new Jt("Auto",{layerName:"Tool",pickable:!1,selectable:!1}).add(new Lt("Spot").add(new Xt({name:"SHAPE",fill:null,stroke:"lime",strokeWidth:4}).bindObject("stroke","adornedPart",t=>t.isSelected?"darkcyan":"lime"),new Xt({name:"SHAPE2",stretch:2,fill:null,stroke:"magenta",strokeWidth:4,strokeDashArray:[4,4]})),new Ui({padding:4})),this.oN=null,this.N1="",this.rN="",this.C1=r.ur,this.lN=!1,this.aN=!1,this.dd=new _t({layerName:"Tool",isInDocumentBounds:!1,locationObjectName:"CIRCLE",locationSpot:X.Center,pickable:!1,selectable:!1}).add(new Xt("Circle",{isGeometryPositioned:!0,width:30,height:30,fill:null,stroke:"darkcyan",strokeWidth:6,visible:!1}).bind("visible","down"),new Xt({isGeometryPositioned:!0,geometryString:"M15 0L15 30",stroke:"magenta"}),new Xt({isGeometryPositioned:!0,geometryString:"M0 15L30 15",stroke:"magenta"}),new Xt("Circle",{name:"CIRCLE",isGeometryPositioned:!0,width:20,height:20,fill:null,stroke:"magenta",position:new L(5,5)}),new Xt({isGeometryPositioned:!0,geometry:Ye.VT,fill:null,stroke:"cyan",strokeWidth:4}).bind("geometry","button",Ye.GO),new Se({position:new L(12,0),font:"bold 10pt sans-serif"}).bind("text","clickCount",t=>t>1?t.toString():""),new Se({position:new L(0,16)}).bind("text","modifiers",Ye.YO)).freezeBindings(),this.Ep=10,this.Up=1,this.hN=null,this.Qc=t=>this.KO(t),this.cN=t=>this.HO(t),this.fN=t=>this.jO(t),this.uN=t=>this.qO(t),this.dN=null,this.gN="distance",this.gd=null,this.mN=0,this.Oi={},this.Ps=null,this.L1=!1,this.Vp=null,this.yN(),this.dd.data=this.Oi,e&&Object.assign(this,e)}toString(){return"CommandHandler"}get diagram(){return this.a}Eo(e){this.a=e}doStart(){const e=this.a;e&&(e.addModelChangedListener(this.Qc),e.addDiagramListener("ViewportBoundsChanged",this.cN),e.addDiagramListener("GainedFocus",this.fN),e.addDiagramListener("LostFocus",this.uN))}doStop(){const e=this.a;e&&(e.removeDiagramListener("ViewportBoundsChanged",this.cN),e.removeDiagramListener("GainedFocus",this.fN),e.removeDiagramListener("LostFocus",this.uN),e.removeModelChangedListener(this.Qc))}doKeyDown(){const e=this.a,t=e.lastInput,i=t.control||t.meta,s=t.shift,n=t.alt,o=t.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||i&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():this.BT.indexOf(o)>=0?this.WO(o,i,s):o==="PageUp"?s&&e.allowHorizontalScroll?e.scroll("page","left"):e.allowVerticalScroll&&e.scroll("page","up"):o==="PageDown"?s&&e.allowHorizontalScroll?e.scroll("page","right"):e.allowVerticalScroll&&e.scroll("page","down"):o==="Home"?i&&e.allowVerticalScroll?e.scroll("document","up"):!i&&e.allowHorizontalScroll&&e.scroll("document","left"):o==="End"?i&&e.allowVerticalScroll?e.scroll("document","down"):!i&&e.allowHorizontalScroll&&e.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||i&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():t.bubbles=!0}doKeyUp(){const e=this.a.lastInput;e.bubbles=!0}stopCommand(){const e=this.a,t=e.currentTool;if(t instanceof ge){if(t.currentToolTip!==null){t.hideToolTip();return}e.allowSelect&&e.clearSelection()}t!==null&&t.doCancel()}canStopCommand(){return!0}selectAll(){const e=this.a;e.C();try{e.currentCursor="wait",e.T("ChangingSelection",e.selection);const t=e.parts;for(;t.next();){const n=t.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=e.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=e.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{e.T("ChangedSelection",e.selection),e.currentCursor=""}}canSelectAll(){return this.a.allowSelect}deleteSelection(){const e=this.a;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Delete"),e.T("SelectionDeleting",e.selection);const t=new F,i=e.selection.iterator;for(;i.next();){const s=i.value;_t.ga(t,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}e.removeParts(t,!0),e.T("SelectionDeleted",t)}finally{e.commitTransaction("Delete"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canDeleteSelection(){const e=this.a;return!(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||e.selection.count===0)}copySelection(){const e=this.a;try{const t=new F,i=e.selection.iterator;for(;i.next();){const s=i.value;_t.ga(t,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(t)}finally{}}canCopySelection(){const e=this.a;return!(!e.allowCopy||!e.allowClipboard||e.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const e=this.a;return!(e.isReadOnly||e.isModelReadOnly||!e.allowCopy||!e.allowDelete||!e.allowClipboard||e.selection.count===0)}copyToClipboard(e){const t=this.a,i=this.storageLocation==="systemClipboard";if(i||this.storageLocation!=="memory")try{if(e===null)if(i&&c.navigator.clipboard)c.navigator.clipboard.writeText("");else{const n=c[this.storageLocation];if(!n)return;n.setItem(this.w1,""),n.setItem(this.b1,"")}else{const n=new qt;if(n.isTreePathToChildren=t.isTreePathToChildren,n.toolManager.draggingTool.dragsLink=t.toolManager.draggingTool.dragsLink,n.model=t.model.copy(),t.copyParts(e,n,!1),i&&c.navigator.clipboard)c.navigator.clipboard.writeText(n.model.toJson());else{const o=c[this.storageLocation];if(!o)return;o.setItem(this.w1,n.model.toJson()),o.setItem(this.b1,n.model.dataFormat)}}t.T("ClipboardChanged",e);return}catch{return}let s=null;if(e===null)qt.iT();else{let n=null;try{n=t.copyParts(e,null,!0)}finally{s=new E,n!==null&&s.addAll(n.iteratorValues),qt.Sp=s,qt.i1=t.model.dataFormat}}t.T("ClipboardChanged",s)}pasteFromClipboard(){const e=this.a;if(this.storageLocation!=="memory"){const n=new F;try{const o=c[this.storageLocation];if(!o)return n;const a=o.getItem(this.w1),l=o.getItem(this.b1);if(a===null||a===""||l!==e.model.dataFormat)return n;{const h=new qt;h.model=Ne.fromJson(a);const d=new F;d.addAll(h.parts).addAll(h.nodes).addAll(h.links);const f=e.copyParts(d,e,!1);return new F().addAll(f.iteratorValues)}}catch{return n}}const t=new F,i=qt.Sp;if(i===null||qt.i1!==e.model.dataFormat)return t;let s=null;try{s=e.copyParts(i,e,!1)}finally{if(s!==null){const n=s.iterator;for(;n.next();){const o=n.value,a=n.key;o.location.isReal()||(a.location.isReal()?o.location=a.location:!o.position.isReal()&&a.position.isReal()&&(o.position=a.position)),t.add(o)}}}return t}async pasteSelectionAsync(e){const t=this.a;if(c.navigator.clipboard===void 0){r.ne('Cannot paste with storageLocation "clipboard", window.isSecureContext may be false.');return}try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Paste");let i=null;const s=await c.navigator.clipboard.readText();try{const o=s;if(!(o===null||o==="")){const a=new qt;a.model=Ne.fromJson(o);const l=new F;l.addAll(a.parts).addAll(a.nodes).addAll(a.links);const h=t.copyParts(l,t,!1);i=new F().addAll(h.iteratorValues)}}catch{}if(i===null)return;i.count>0&&t.clearSelection(!0);const n=i.iterator;for(;n.next();){const o=n.value;o.isSelected=!0}if(e){const o=t.computePartsBounds(t.selection);if(o.isReal()){const a=this.computeEffectiveCollection(t.selection,t.ad);t.Lx(a,new L(e.x-o.centerX,e.y-o.centerY),t.ad,!1)}}t.T("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}pasteSelection(e){if(this.storageLocation==="systemClipboard"){this.pasteSelectionAsync(e);return}const t=this.a;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&t.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(e){const n=t.computePartsBounds(t.selection);if(n.isReal()){const o=this.computeEffectiveCollection(t.selection,t.ad);t.Lx(o,new L(e.x-n.centerX,e.y-n.centerY),t.ad,!1)}}t.T("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canPasteSelection(e){const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowClipboard)return!1;if(this.storageLocation==="systemClipboard")return!0;if(this.storageLocation!=="memory")try{const i=c[this.storageLocation];if(!i)return!1;const s=i.getItem(this.w1),n=i.getItem(this.b1);return!(s===null||s===""||n!==t.model.dataFormat)}catch{return!1}return!(qt.Sp===null||qt.Sp.count===0||qt.i1!==t.model.dataFormat)}undo(){this.a.undoManager.undo()}canUndo(){const e=this.a;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canUndo()}redo(){this.a.undoManager.redo()}canRedo(){const e=this.a;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canRedo()}decreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.a;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canDecreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.a;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}increaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.a;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canIncreaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.a;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}resetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.a;e<t.minScale||e>t.maxScale||(t.scale=e)}canResetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.a;return e<t.minScale||e>t.maxScale?!1:t.allowZoom}zoomToFit(e){const t=this.a,i=t.animationManager;i.stopAnimation(),t.redraw();const s=t.position.copy(),n=t.scale;if(i.Gl("Zoom To Fit"),!e&&this.isZoomToFitRestoreEnabled&&n===this.S1&&!isNaN(this.k1)&&this.P1.isReal()&&t.documentBounds.equals(this.M1))t.scale=this.k1,t.position=this.P1,this.S1=NaN,this.M1=Y.em;else{if(this.k1=n,this.P1=s,e){const o=e.copy();if(o.width>0&&o.height>0){const a=t.viewportBounds,l=a.width*n,h=a.height*n,d=Math.min(l/o.width,h/o.height),f=l/d,m=h/d;o.width<f&&(o.x-=(f-o.width)/2),o.height<m&&(o.y-=(m-o.height)/2)}t.zoomToRect(o,2)}else t.zoomToFit();this.S1=t.scale,this.M1=t.documentBounds.copy()}i.SM()}canZoomToFit(e){return this.a.allowZoom}WO(e,t,i){const s=this.a;e==="ArrowUp"?s.allowVerticalScroll&&(t?s.scroll("pixel","up"):s.scroll("line","up")):e==="ArrowDown"?s.allowVerticalScroll&&(t?s.scroll("pixel","down"):s.scroll("line","down")):e==="ArrowLeft"?s.allowHorizontalScroll&&(t?s.scroll("pixel","left"):s.scroll("line","left")):e==="ArrowRight"&&s.allowHorizontalScroll&&(t?s.scroll("pixel","right"):s.scroll("line","right"))}scrollToPart(e){e===void 0&&(e=null),e!==null&&r.se(e,_t,Ye,"part");const t=this.a;if(t.ensureBounds(),e===null){try{this.Ho!==null&&(this.Ho.next()?e=this.Ho.value:this.Ho=null)}catch{this.Ho=null}e===null&&(t.highlighteds.count>0?this.Ho=t.highlighteds.iterator:t.selection.count>0&&(this.Ho=t.selection.iterator),this.Ho!==null&&this.Ho.next()&&(e=this.Ho.value))}if(e!==null){const i=t.animationManager;i.Gl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.ff(e,[e]);if(n.length===1)t.startTransaction(),t.centerRect(e.actualBounds),t.commitTransaction("Scroll To Part");else{const o=()=>{t.startTransaction();let l=n.pop();for(;n.length>0&&l instanceof wt&&l.isTreeExpanded&&(!(l instanceof Ft)||l.isSubGraphExpanded);)l=n.pop();n.length>0?(l instanceof _t&&t.scrollToRect(l.actualBounds),l instanceof wt&&!l.isTreeExpanded&&(l.isTreeExpanded=!0),l instanceof Ft&&!l.isSubGraphExpanded&&(l.isSubGraphExpanded=!0)):(l instanceof _t&&t.centerRect(l.actualBounds),t.removeDiagramListener("LayoutCompleted",a)),t.commitTransaction("Scroll To Part")},a=()=>{r.dn(o,(i.isEnabled?i.duration:0)+s)};t.addDiagramListener("LayoutCompleted",a),o()}}else{const n=t.position.copy();t.centerRect(e.actualBounds),n.equalsApprox(t.position)&&i.stopAnimation()}}}ff(e,t){if(e.isVisible())return t;if(e instanceof Jt){const i=e.adornedPart;i!==null&&this.ff(i,t)}else if(e instanceof Nt){const i=e.fromNode;i!==null&&this.ff(i,t);const s=e.toNode;s!==null&&this.ff(s,t)}else{if(e instanceof wt){const s=e.labeledLink;s!==null&&this.ff(s,t);const n=e.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&t.push(n),this.ff(n,t))}const i=e.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&t.push(i),this.ff(i,t))}return t}canScrollToPart(e){if(e===void 0&&(e=null),e!==null&&!(e instanceof _t))return!1;const t=this.a;return t.selection.count===0&&t.highlighteds.count===0?!1:t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(e){e===void 0&&(e=null);const t=this.a,i="Collapse Tree";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new E;if(e!==null&&e.isTreeExpanded)e.collapseTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof wt&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}t.T("TreeCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseTree(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof wt)||!e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof wt){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(e){e===void 0&&(e=null);const t=this.a,i="Expand Tree";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new E;if(e!==null&&!e.isTreeExpanded)e.expandTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof wt&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}t.T("TreeExpanded",s)}finally{t.commitTransaction(i)}}canExpandTree(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof wt)||e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof wt){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const e=this.a,t=e.model;if(!t.uf())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Group");const n=new E,o=e.selection.iterator;for(;o.next();){const d=o.value;d.Di()&&d.canGroup()&&n.add(d)}const a=new E,l=n.iterator;for(;l.next();){const d=l.value;let f=!1;const m=n.iterator;for(;m.next();){const p=m.value;if(d.isMemberOf(p)){f=!0;break}}f||a.add(d)}const h=a.first();if(h!==null){let d=h.containingGroup;if(d!==null)for(;d!==null;){let f=!1;const m=a.iterator;for(;m.next();)if(!m.value.isMemberOf(d)){f=!0;break}if(f)d=d.containingGroup;else break}if(i instanceof Ft)i.It(),s=i.copy(),s!==null&&e.add(s);else if(t.isGroupForData(i)){const f=t.copyNodeData(i);t.addNodeData(f),s=e.findNodeForData(f)}if(s!==null){d!==null&&this.isValidMember(d,s)&&(s.containingGroup=d);const f=a.iterator;for(;f.next();){const m=f.value;this.isValidMember(s,m)&&(m.containingGroup=s)}e.clearSelection(!0),s.isSelected=!0}}e.T("SelectionGrouped",s)}finally{e.commitTransaction("Group"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canGroupSelection(){const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowGroup||!e.model.uf()||this.archetypeGroupData===null)return!1;const t=e.selection.iterator;for(;t.next();){const i=t.value;if(i.Di()&&i.canGroup())return!0}return!1}wN(e){const t=r.nt();if(Array.isArray(e))e.forEach(n=>{n instanceof Nt||n instanceof _t&&t.push(n)});else{const n=e.iterator;for(;n.next();){const o=n.value;o instanceof Nt||o instanceof _t&&t.push(o)}}const i=new F,s=t.length;for(let n=0;n<s;n++){const o=t[n];let a=!0;for(let l=0;l<s;l++)if(o.isMemberOf(t[l])){a=!1;break}a&&i.add(o)}return r.Z(t),i}isValidMember(e,t){if(t===null||e===t||t instanceof Nt)return!1;let i;return e!==null&&(e===t||e.isMemberOf(t)||(i=e.memberValidation,i!==null&&!i(e,t))||e.data===null&&t.data!==null||e.data!==null&&t.data===null)?!1:(i=this.memberValidation,i!==null?i(e,t):!0)}ungroupSelection(e){e===void 0&&(e=null);const t=this.a,i=t.model;if(i.uf())try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Ungroup");const s=new E;if(e!==null)s.add(e);else{const o=t.selection.iterator;for(;o.next();){const a=o.value;a instanceof Ft&&a.canUngroup()&&s.add(a)}}const n=new E;if(s.count>0){t.clearSelection(!0);const o=s.iterator;for(;o.next();){const a=o.value;a.expandSubGraph();const l=a.containingGroup,h=l!==null&&l.data!==null?i.getKeyForNodeData(l.data):void 0;n.addAll(a.memberParts);const d=n.iterator;for(;d.next();){const f=d.value;if(f.isSelected=!0,f instanceof Nt)continue;const m=f.data;m!==null?i.setGroupForData(m,h):f.containingGroup=l}t.remove(a)}}t.T("SelectionUngrouped",s,n)}finally{t.commitTransaction("Ungroup"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canUngroupSelection(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||!t.allowUngroup||!t.model.uf())return!1;if(e!==null){if(!(e instanceof Ft))return!1;if(e.canUngroup())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Ft&&s.canUngroup())return!0}}return!1}addTopLevelParts(e,t){const i=this.wN(e);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!t||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(e){e===void 0&&(e=null);const t=this.a,i="Collapse SubGraph";try{t.startTransaction(i),t.animationManager.Gl(i);const s=new E;if(e!==null&&e.isSubGraphExpanded)e.collapseSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof Ft&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}t.T("SubGraphCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseSubGraph(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof Ft)||!e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Ft&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(e){e===void 0&&(e=null);const t=this.a,i="Expand SubGraph",s=new E;try{if(t.startTransaction(i),t.animationManager.Gl(i),e!==null&&!e.isSubGraphExpanded)e.expandSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof Ft&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}t.T("SubGraphExpanded",s)}finally{for(const n of s)this.zT(t,n);e&&this.zT(t,e),t.commitTransaction(i)}}zT(e,t){for(const i of t.memberParts)i instanceof wt&&e.Yc(i,t)}canExpandSubGraph(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof Ft)||e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Ft&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){e===void 0&&(e=null),e!==null&&r.se(e,Se,Ye,"editTextBlock");const t=this.a,i=t.toolManager.findTool("TextEditing");if(i!==null){if(e===null){let s=null;const n=t.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;e=s.findInVisualTree(o=>o instanceof Se&&o.editable)}e!==null&&(t.currentTool=null,i.textBlock=e,t.currentTool=i)}}canEditTextBlock(e){e===void 0&&(e=null);const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowTextEdit||t.toolManager.findTool("TextEditing")===null)return!1;if(e!==null){if(!(e instanceof Se))return!1;const i=e.part;if(i!==null&&i.canEdit())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(e=s.findInVisualTree(n=>n instanceof Se&&n.editable),e!==null))return!0}}return!1}showContextMenu(e){const t=this.a,i=t.toolManager.findTool("ContextMenu");if(i===null)return;e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t);const s=i.findObjectWithContextMenu(e);if(s!==null){const n=t.lastInput;let o;if(s instanceof Ht?o=s.getDocumentPoint(X.Center):t.viewportBounds.containsPoint(n.documentPoint)?o=L.mn:o=t.viewportBounds.center,o.isReal()){const a=new Dt;a.diagram=t,a.viewPoint=t.transformDocToView(o),a.documentPoint=o,a.button=2,a.up=!0,t.lastInput=a}t.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(e){const t=this.a,i=t.toolManager.findTool("ContextMenu");return!(i===null||(e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t),i.findObjectWithContextMenu(e)===null))}downloadSvg(e){const t=this.a,i={scale:1,background:t.div?t.div.style.backgroundColor:"white",name:this.JO("svg")};e&&Object.assign(i,e);const s=t.makeSvg(i);if(s!==null){const n=new XMLSerializer().serializeToString(s);this.$O(i.name,"image/svg+xml",n)}}downloadSVG(e){this.downloadSvg(e)}canDownloadSvg(e){return this.a!==null}$O(e,t,i){let s=null,n=null;try{const o=new Blob([i],{type:t});s=c.URL.createObjectURL(o),n=r.Ni("a"),n.style.display="none",n.href=s,n.download=e,c.document.body.appendChild(n),requestAnimationFrame(()=>{try{n!==null&&n.click()}finally{s!==null&&c.URL.revokeObjectURL(s),n!==null&&c.document.body.removeChild(n)}})}catch{s!==null&&c.URL.revokeObjectURL(s),n!==null&&c.document.body.removeChild(n)}}JO(e){const t="."+e;let i=this.diagram.model.name;return i?i.endsWith(t)&&(i=i.substring(0,i.length-t.length)):i="diagram",i+=t,i}get copiesClipboardData(){return this.j2}set copiesClipboardData(e){this.j2=!!e}get copiesConnectedLinks(){return this.q2}set copiesConnectedLinks(e){this.q2=!!e}get deletesConnectedLinks(){return this.W2}set deletesConnectedLinks(e){this.W2=!!e}get copiesTree(){return this.J2}set copiesTree(e){this.J2=!!e}get deletesTree(){return this.$2}set deletesTree(e){this.$2=!!e}get copiesParentKey(){return this.Z2}set copiesParentKey(e){this.Z2=!!e}get copiesGroupKey(){return this.Q2}set copiesGroupKey(e){this.Q2=!!e}get storageLocation(){return this._2}set storageLocation(e){e||(e="memory"),e!=="memory"&&e!=="sessionStorage"&&e!=="localStorage"&&e!=="systemClipboard"&&r.o("Invalid new value for CommandHandler.storageLocation: "+e),this._2=e}get archetypeGroupData(){return this.tN}set archetypeGroupData(e){e!==null&&r.xc(e,Ye,"archetypeGroupData"),this.a,this.tN=e}get memberValidation(){return this.da}set memberValidation(e){e!==null&&r.S(e,Ye,"memberValidation"),this.da=e}get defaultScale(){return this.diagram.defaultScale}set defaultScale(e){this.diagram.defaultScale=e}get zoomFactor(){return this.eN}set zoomFactor(e){e>1||r.o("zoomFactor must be larger than 1.0, not: "+e),this.eN=e}get isZoomToFitRestoreEnabled(){return this.iN}set isZoomToFitRestoreEnabled(e){this.iN=!!e}get scrollToPartPause(){return this.sN}set scrollToPartPause(e){this.sN=e}computeEffectiveCollection(e,t){const i=this.a,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;t===void 0&&(t=i.Tp());const o=new nt;if(e===null)return o;let a=e.iterator;for(;a.next();){const l=a.value;i.tl(o,l,n,t)}if(i.draggedLink!==null&&t.dragsLink)return o;for(a=e.iterator;a.next();){const l=a.value;if(l instanceof Nt){const h=l.fromNode;if(h!==null&&!o.has(h))o.delete(l);else{const d=l.toNode;d!==null&&!o.has(d)&&o.delete(l)}}}return o}static getModifierNames(){return Ye.md}static setModifierNames(e){Ye.md=e}static YO(e){let t="";return e&1&&(t+=Ye.md[0]||""),e&4&&(t+=Ye.md[1]||""),e&2&&(t+=Ye.md[2]||""),e&8&&(t+=Ye.md[3]||""),t}static GO(e){return e===1?Ye.zO:e===2?Ye.XO:Ye.VT}static pN(e,t,i){var s=new L(i,0).rotate(e-t/2),n=new It().add(new Z(-i,-i)).add(new Z(i,i)).add(new Z(s.x,s.y).add(new et(5,e-t/2,t,0,0,i,i)));return n.offset(i,i),n}KO(e){e.isTransactionFinished&&this.updateFocusBox()}HO(e){if(e.subject.scale===this.diagram.scale)return;const t=4/this.diagram.scale,i=this.focusBox.findObject("SHAPE");i!==null&&(i.strokeWidth=t);const s=this.focusBox.findObject("SHAPE2");s!==null&&(s.strokeWidth=t,s.strokeDashArray=[t,t]);const n=this.focusBox.placeholder;n!==null&&(n.padding=t)}jO(e){this.focus===null?r.dn(()=>{this.focus=this.findFirstFocus()},500):this.onFocusChanged(this.focus,this.focus)}qO(e){this.isVirtualPointerShown=!1}get isFocusEnabled(){return this.nN}set isFocusEnabled(e){e=!!e;const t=this.isFocusEnabled;e!==t&&(e||(this.isVirtualPointerShown=!1,this.dN=this.focus,this.focus=null),this.nN=e,e&&(this.focus=this.dN,this.updateFocusBox()))}get focusBox(){return this.Ip}set focusBox(e){if(!(e instanceof Jt))return;const t=this.Ip;if(e!==t&&(this.Ip=e,t.adornedObject!==null)){const i=t.adornedPart;i!==null&&i.removeAdornment("Focus"),e.adornedObject=t.adornedObject,i!==null&&i.addAdornment("Focus",e)}}get focus(){return this.Ip.adornedObject}set focus(e){const t=this.focus;if(e!==t){const i=this.a;if(!i||!this.isFocusEnabled||e!==null&&e.diagram!==i)return;i.currentTool instanceof yn||this.cancelVirtualPointer();const s=this.focusBox.adornedPart;s&&s.removeAdornment("Focus"),e===null?(this.gd=null,this.virtualPointerLocation=i.viewportBounds.center,this.focusBox.adornedObject=null):(this.virtualPointerLocation=e.getDocumentPoint(X.Center),this.focusBox.adornedObject=e,this.updateFocusBox()),this.onFocusChanged(t,e)}}onFocusChanged(e,t){const i=this.a;if(i&&(this.focusChanged!==null?this.focusChanged(e,t,this):this.ZO(this.describe(e,t)),t!==null&&t.part!==null)){const s=t.getDocumentBounds();i.viewportBounds.containsRect(s)||(t instanceof _t?i.commandHandler.scrollToPart(t):i.scrollToRect(s))}}get focusChanged(){return this.oN}set focusChanged(e){e!==null&&r.S(e,Ye,"focusChanged"),this.oN=e}get liveElementId(){return this.N1||this.rN}set liveElementId(e){const t=this.N1;e!==t&&(this.N1=e,this.xN())}xN(){var n;const e=this.diagram;if(!e||!qt.isUsingDOM())return;const t=(n=e.lt)==null?void 0:n.bt;if(!t)return;const i=this.liveElementId,s=c.document.getElementById(i);this.isUsingAriaLive?(t.removeAttribute("aria-labelledby"),s&&s.setAttribute("aria-live","polite")):(i&&t.setAttribute("aria-labelledby",i),s&&s.removeAttribute("aria-live"))}get isUsingAriaLive(){return this.C1}set isUsingAriaLive(e){const t=this.C1;e!==t&&(this.C1=e,this.xN())}ZO(e){const t=this.diagram;if(!t||!qt.isUsingDOM()||!t.div)return;let i=this.liveElementId;if(!i){const n=r.Ni("span"),o=n.style;for(o.opacity="0",o.position="absolute",o.right="-9999px",o.bottom="-9999px",o.width="0px",o.height="0px",o.overflow="hidden",o.border="0",i=(t.div.id||"diagram")+"_aria";c.document.getElementById(i);)i+=Math.floor(Math.random()*10);n.id=i,this.rN=i,t.div.appendChild(n),this.xN()}const s=c.document.getElementById(i);s&&(s.textContent=e)}describe(e,t){var o,a;let i="";t instanceof wt?t instanceof Ft?i="Group":i="Node":t instanceof Nt?i="Link":t instanceof _t?i="Part":t&&(t.click?i="button":t instanceof Se&&t.editable&&(i="editable"),t.portId!==null&&(i&&(i+=" "),i+="port",t.portId&&(i+=" "+t.portId)));const s=this.bN(t);s&&(i+=" "+s);const n=t;if(e&&n instanceof Nt&&n.fromNode&&n.toNode){if(e instanceof wt&&e.part===n.fromNode||e instanceof Nt&&e.fromNode===n.fromNode){i+=" to "+this.bN(n.toNode,!0);const l=(o=n.toPort)==null?void 0:o.portId;l&&(i+=" port "+l)}else if(e instanceof wt&&e.part===n.toNode||e instanceof Nt&&e.toNode===n.toNode){i+=" from "+this.bN(n.fromNode,!0);const l=(a=n.fromPort)==null?void 0:a.portId;l&&(i+=" port "+l)}}return i}bN(e,t){if(t===void 0&&(t=!1),!e)return"";if(e instanceof Se&&e.text)return e.text;if(e instanceof Lt){let i="";return e instanceof _t&&e.text&&(i=e.text),t&&i||e.walkVisualTreeFrom(e,(s,n)=>{n.isVisibleObject()&&n instanceof Se&&n.text&&(!t||!i)&&i!==n.text&&(i+=" "+n.text)}),i}return""}updateFocusBox(){var t,i;const e=this.focus;if(e!==null)if(e.diagram!==null&&(e instanceof _t?e.isVisible():e.isVisibleObject()&&((t=e.part)!=null&&t.isVisible())))this.focusBox.adornedObject=e,(i=e.part)==null||i.addAdornment("Focus",this.focusBox);else{let s=null;if(e instanceof _t||(s=e.part),s instanceof _t&&s.isVisible())this.focus=s;else{if(s instanceof wt&&!s.isVisible()){const n=s.findTreeParentNode();if(n!==null)s=n;else{const o=s.labeledLink;o!==null&&(s=o)}}for(;s instanceof _t&&!s.isVisible();)s=s.containingGroup;s instanceof _t&&s.isVisible()?this.focus=s:this.focus=null}}}findFirstFocus(){const e=this.a;if(e===null||!e.isEnabled)return null;if(this.focus!==null)return this.focus;if(this.isFocusEnabled)if(e.selection.count>0)this.focus=e.selection.first();else{const t=this.XT(e.isTreePathToChildren).first();if(t!==null)return t}return null}get isVirtualPointerEnabled(){return this.lN}set isVirtualPointerEnabled(e){e=!!e;const t=this.isVirtualPointerEnabled;if(e!==t&&(this.lN=e,e)){const i=this.Vp;i&&(this.Vp=null,i.commandHandler.Ps=null,i.commandHandler.cancelVirtualPointer())}}get isVirtualPointerShown(){return this.aN}set isVirtualPointerShown(e){e=!!e;const t=this.isVirtualPointerShown;if(e!==t){const i=this.a;if(!i||!this.isVirtualPointerEnabled)return;this.aN=e;const s=this.focus;e?this.virtualPointerBox.diagram===null&&(this.virtualPointerLocation.isReal()||(s!==null?this.virtualPointerLocation=s.getDocumentPoint(X.Center):this.virtualPointerLocation=i.viewportBounds.center),i.add(this.virtualPointerBox),this.ma()):this.virtualPointerBox.diagram!==null&&(i.remove(this.virtualPointerBox),this.ma())}}cancelVirtualPointer(){const e=this.a;e&&(this.yN(),this.isVirtualPointerShown=!1,e.currentTool.doCancel(),this.isVirtualPointerDown=!1,this.kN())}kN(){const e=this.Ps;if(e!==null){this.Ps=null;const t=e.commandHandler;t.Ps=null,t.Vp=null,t.isVirtualPointerShown=!1,t.isVirtualPointerDown=!1,t.yN(),this.L1&&(t.isVirtualPointerEnabled=!1),this.L1=!1}}yN(){this.Oi.button=0,this.Oi.modifiers=0,this.Oi.clickCount=1,this.Oi.down=!1,this.ma()}ma(){this.virtualPointerChanged!==null&&this.virtualPointerChanged(this.virtualPointerBox,this),this.updateVirtualPointer()}updateVirtualPointer(){const e=this.virtualPointerBox.diagram;e&&(this.virtualPointerBox.scale=1/e.scale),this.virtualPointerBox.updateTargetBindings()}get virtualPointerBox(){return this.dd}set virtualPointerBox(e){if(!(e instanceof _t))return;const t=this.dd;e!==t&&(t!==null&&(e.location=t.location,t.diagram!==null&&t.diagram.remove(t)),this.dd=e,this.isVirtualPointerShown&&this.diagram&&(this.diagram.add(e),e.data=t.data),this.ma())}get virtualPointerChanged(){return this.hN}set virtualPointerChanged(e){e!==null&&r.S(e,Ye,"virtualPointerChanged"),this.hN=e}get virtualPointerLocation(){return this.virtualPointerBox.location}set virtualPointerLocation(e){this.virtualPointerLocation.equals(e)||this.GT(e.x,e.y)}get isVirtualPointerDown(){return this.virtualPointerBox.data?this.virtualPointerBox.data.down:!1}set isVirtualPointerDown(e){e=!!e;const t=this.isVirtualPointerDown;if(e!==t){const i=this.a;if(!i||!this.isVirtualPointerEnabled||(this.virtualPointerBox.data===null&&(this.dd.data=this.Oi),this.virtualPointerBox.data.down=e,this.ma(),!this.isVirtualPointerShown))return;const s=i.lastInput,n=new Dt;n.diagram=i,this.YT(n,e),e?n.down=!0:n.up=!0,n.clickCount=1,n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,e&&(i.firstInput=n.copy()),this.pd(n,!0),e||this.Oi.clickCount===2&&(n.clickCount=2,n.down=!0,n.up=!1,this.pd(n,!0),n.down=!1,n.up=!0,this.pd(n,!0),this.KT(1)),i.lastInput=s}}get virtualPointerShiftMove(){return this.Ep}set virtualPointerShiftMove(e){this.Ep=e}get virtualPointerControlMove(){return this.Up}set virtualPointerControlMove(e){this.Up=e}Bp(e,t){this.GT(this.virtualPointerLocation.x+e,this.virtualPointerLocation.y+t)}GT(e,t){this.virtualPointerBox.moveTo(e,t,!0);const i=this.a;if(!i||!this.isVirtualPointerEnabled||!this.isVirtualPointerShown)return;i.ensureBounds();const s=i.lastInput,n=new Dt;n.diagram=i,this.YT(n,this.isVirtualPointerDown),n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,this.pd(n,!0),i.lastInput=s,this.isVirtualPointerDown&&(i.remove(this.virtualPointerBox),i.add(this.virtualPointerBox)),this.ma()}YT(e,t){const i=this.a;if(i){if(e.targetDiagram=i,e.documentPoint=this.virtualPointerLocation,i.allowDragOut){const s=i.div.getBoundingClientRect(),n=i.transformDocToView(this.virtualPointerLocation),o=s.x+n.x,a=s.y+n.y;let l=c.document.elementFromPoint(o,a)||null;l instanceof HTMLCanvasElement&&(l=l.parentElement),l!==null&&l.shadowRoot&&(l=l.shadowRoot.elementFromPoint(o,a)||null,l instanceof HTMLCanvasElement&&(l=l.parentElement));let h=null;if(l instanceof HTMLElement&&(h=qt.Wi.get(l))&&h!==i&&h.div){const d=h.div.getBoundingClientRect(),f=new L(n.x-(d.x-s.x),n.y-(d.y-s.y));this.Ps!==null&&this.Ps!==h&&this.kN(),e.targetDiagram=h,e.viewPoint=f,e.documentPoint=h.transformViewToDoc(f),e.viewPoint=h.transformDocToView(e.documentPoint),this.Ps=h;const m=h.commandHandler;this.L1=!m.isVirtualPointerEnabled,m.isVirtualPointerEnabled=!0,m.isVirtualPointerDown=t,m.virtualPointerLocation=e.documentPoint,m.isVirtualPointerShown=!0,m.Vp=i;return}}this.Ps!==null&&this.kN(),e.viewPoint=i.transformDocToView(e.documentPoint)}}pd(e,t){this.doVirtualPointerEvent(e,t)}doVirtualPointerEvent(e,t){const i=this.a;i&&(e.timestamp=Date.now(),i.lastInput=e,t&&(e.up?i.doMouseUp():e.down?i.doMouseDown():i.doMouseMove()),this.onVirtualPointerEvent(e,t))}onVirtualPointerEvent(e,t){const i=this.a;i&&(e.up?this.isVirtualPointerDown&&!i.viewportBounds.containsPoint(this.virtualPointerLocation)&&(this.virtualPointerLocation=this.focus instanceof Ht?this.focus.getDocumentPoint(X.Center):i.viewportBounds.center):e.down)}doVirtualFocusKeyDown(){const e=this.a;if(!e)return!1;const t=e.lastInput,i=t.commandKey;if(this.isVirtualPointerEnabled&&(i==="ShiftLeft"||i==="ShiftRight"))return this.isVirtualPointerShown=!0,!0;if(this.BT.indexOf(i)>=0)if(t.shift&&this.isVirtualPointerShown){const s=this.A1(i),n=t.control||t.meta?this.Up:this.Ep;s===270?this.Bp(0,-n):s===90?this.Bp(0,n):s===180?this.Bp(-n,0):this.Bp(n,0)}else this.QO();else if(t.shift&&this.isVirtualPointerShown&&(i==="Numpad1"||i==="Numpad2"||i==="Numpad3"||i==="Numpad4"||i==="Numpad6"||i==="Numpad7"||i==="Numpad8"||i==="Numpad9")){const s=t.control||t.meta?this.Up:this.Ep;let n=0;i==="Numpad1"||i==="Numpad4"||i==="Numpad7"?n=-s:(i==="Numpad3"||i==="Numpad6"||i==="Numpad9")&&(n=s);let o=0;i==="Numpad7"||i==="Numpad8"||i==="Numpad9"?o=-s:(i==="Numpad1"||i==="Numpad2"||i==="Numpad3")&&(o=s),this.Bp(n,o)}else if(i==="Enter"||i==="NumpadEnter"||i==="Numpad5")t.shift&&this.isVirtualPointerShown?this.isVirtualPointerDown=!this.isVirtualPointerDown:this._O();else if(i==="Escape")this.tI();else if(i==="Space")this.eI();else if(i==="ContextMenu"||t.shift&&i==="F10"||(t.control||t.meta)&&t.shift&&i==="Backslash")this.iI();else if(t.shift&&i==="c")this.T1(1);else if(t.shift&&i==="a")this.T1(2);else if(t.shift&&i==="KeyS")this.T1(4);else if(t.shift&&i==="KeyM")this.T1(8);else if(t.shift&&i==="Digit1")this.D1(0);else if(t.shift&&i==="Digit2")this.D1(1);else if(t.shift&&i==="Digit3")this.D1(2);else if(t.shift&&i==="Numpad0"){const s=this.Oi.button;this.D1(s===2?0:2)}else if(t.shift&&(i==="KeyD"||i==="NumpadDecimal")){const s=this.Oi.clickCount;this.KT(s===2?1:2)}else if(t.shift&&i==="KeyF"){const s=this.nextFocusFormula;this.nextFocusFormula=s==="distance"?"linear":"distance"}else if(t.shift&&i==="y")this.isUsingAriaLive=!this.isUsingAriaLive;else return!1;return!0}doVirtualFocusKeyUp(){const e=this.a;if(!e)return!1;const t=e.lastInput.commandKey;return this.isVirtualPointerEnabled&&(t==="ShiftLeft"||t==="ShiftRight")&&(this.isVirtualPointerShown=!1),!0}A1(e){switch(e){case"ArrowDown":return 90;case"ArrowLeft":return 180;case"ArrowUp":return 270;default:return 0}}T1(e){const t=this.Oi.modifiers;this.Oi.modifiers=t&e?t&~e:t|e,this.ma()}KT(e){this.Oi.clickCount=e,this.ma()}D1(e){this.Oi.button=e,this.ma()}QO(){const e=this.a;if(!e)return;const t=e.lastInput,i=this.focus;if(i===null){const s=this.XT(e.isTreePathToChildren).first();s!==null&&(this.focus=s)}else if(i instanceof Nt)this.sI(i);else if(i instanceof wt)this.nI(i);else{i instanceof _t&&(this.gd=null);const s=this.A1(t.commandKey);s===270?this.focus=this.findNextFocus(270):s===90?this.focus=this.findNextFocus(90):s===180?this.focus=this.findNextFocus(180):this.focus=this.findNextFocus(0)}}sI(e){const t=this.a;if(!t)return;const i=t.lastInput,s=this.A1(i.commandKey);let n=null;const o=this.gd;if(o!==null){const a=this.mN;if(s===a)n=e.getOtherNode(o);else if(s===B.Ee(a+180))n=o;else{let l=a===0||a===180?90:0,h=a===0||a===180?270:180;if(s===l){const d=this.PN(o,a,!0),f=d.indexOf(e);f>=0&&f<d.count-1&&(this.focus=d.elt(f+1))}else if(s===h){const d=this.PN(o,a,!0),f=d.indexOf(e);f>0&&(this.focus=d.elt(f-1))}}}else{const a=e.fromNode,l=e.toNode;if(!a||!l)return;s===270?n=a.location.y<l.location.y?a:l:s==90?n=a.location.y>l.location.y?a:l:s===180?n=a.location.x<l.location.x?a:l:n=a.location.x>l.location.x?a:l}for(;n!==null&&!n.isVisible();)n=n.containingGroup;n!==null&&(this.focus=n)}nI(e){const t=this.a;if(!t)return;const i=t.lastInput,s=this.A1(i.commandKey);if(i.control||i.meta){const n=this.PN(e,s,!0).first();n&&(this.gd=e,this.mN=s,this.focus=n)}else this.gd=null,this.focus=this.findNextFocus(s)}PN(e,t,i){if(e===null)return new E;const s=e.actualBounds;if(!s.isReal())return new E;const n=new Set;(e instanceof Ft?e.findExternalLinksConnected():e.findLinksConnected()).each(a=>{var d,f;if(!a.isVisible())return;let l=null;if(a.fromNode===e?l=a.toNode:a.toNode===e?l=a.fromNode:e instanceof Ft&&((d=a.fromNode)!=null&&d.isMemberOf(e)?l=a.toNode:(f=a.toNode)!=null&&f.isMemberOf(e)&&(l=a.fromNode)),l===null||l.isMemberOf(e))return;for(;l!==null&&!l.isVisible();)l=l.containingGroup;if(l===null)return;const h=l.location;if(h.isReal()&&!(t===270&&(l!==e?h.y>=s.top:a.midPoint.y>=s.top))){if(t===90&&(l!==e?h.y<=s.bottom:a.midPoint.y<=s.bottom)||t===180&&(l!==e?h.x>=s.left:a.midPoint.x>=s.left)||t===0&&(l!==e?h.x<=s.right:a.midPoint.x<=s.right))return;i&&a.actualBounds.isReal()?n.add(a):n.add(l)}});const o=new E(n);return t===90||t===270?o.sort((a,l)=>a.actualBounds.centerX-l.actualBounds.centerX):o.sort((a,l)=>a.actualBounds.centerY-l.actualBounds.centerY),o}findNextFocus(e){e=B.Ee(e);const t=this.focus,i=t instanceof wt?t.location:t.getDocumentPoint(X.Center);let s=1/0,n=t;const o=(a,l,h,d)=>{if(this.nextFocusFormula==="linear"){let f=1/0;e===0&&h>i.x||e===180&&h<i.x?f=Math.abs(h-i.x):(e===90&&d>i.y||e===270&&d<i.y)&&(f=Math.abs(d-i.y)),f<s&&(s=f,n=a)}else{if(e===0&&(l.right<i.x||(l.centerX-i.x)**2>s)||e===90&&(l.bottom<i.y||(l.centerY-i.y)**2>s)||e===180&&(l.x>i.x||(i.x-l.centerX)**2>s)||e===270&&(l.y>i.y||(i.y-l.centerY)**2>s))return;const f=i.direction(h,d),m=B.jF(e,f);if(e===90||e===270?m<=45:m<45){const p=i.distanceSquared(h,d);p<s&&(s=p,n=a)}}};if(t instanceof _t&&t.diagram!==null){const a=t.containingGroup;a!==null?a.memberParts.each(l=>{l===t||l instanceof Nt||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}):(t.diagram.nodes.each(l=>{l===t||!l.isTopLevel||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}),t.diagram.parts.each(l=>{l===t||!l.isTopLevel||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}))}else if(t.part!==null){const a=new Y;this.SN(t.part).each(l=>{l!==t&&(l.getDocumentBounds(a),o(l,a,a.centerX,a.centerY))})}return n}get nextFocusFormula(){return this.gN}set nextFocusFormula(e){this.gN=e}_O(){const e=this.a;if(!e)return;const t=e.currentTool;if(t instanceof yn){const n=t.currentObject;this.v1(this.focus),t.maybeStopTool(this.focus),e.currentTool instanceof yn||(this.focus=n);return}const i=this.focus,s=e.lastInput;if(i===null)s.control||s.meta?this.v1(null):this.focus=this.findFirstFocus();else if(i instanceof _t)if(s.control||s.meta)this.v1(i);else{const n=this.SN(i);if(n.count>0)this.focus=n.first();else if(i instanceof Nt&&i.isLabeledLink){const o=i.labelNodes.first();o!==null&&o.isVisible()&&(this.focus=o)}else if(i instanceof Ft&&i.isSubGraphExpanded){const o=i.memberParts.first();o!==null&&o.isVisible()&&(this.focus=o)}}else this.v1(i)}XT(e){const t=new E,i=this.a;if(!i)return t;let s=0;for(;t.count===0&&s<i.nodes.count;){const n=i.nodes;for(;n.next();){const o=n.value;o.isTopLevel&&o.isVisible()&&(e?o.findNodesInto():o.findNodesOutOf()).count===s&&t.add(o)}s++}return t}SN(e){return e instanceof _t?this.Sn(e,new E):new E}Sn(e,t){return!(e instanceof _t)&&e.isVisibleObject()&&e.isEnabledObject()&&(e.contextMenu||e.click||e instanceof Se&&e.editable||e.part instanceof wt&&e.portId!==null&&(e.portId!==""||e.part.ports.count>1)||e.toolTip)&&t.add(e),e instanceof Lt&&e.elements.each(i=>this.Sn(i,t)),t}v1(e){const t=this.a;if(!t)return;const i=t.lastInput,s=e instanceof Ht?e:t;if(s.click){const n=new Dt;n.diagram=t,n.documentPoint=e instanceof Ht?e.getDocumentPoint(X.Center):t.viewportBounds.center,n.viewPoint=t.transformDocToView(n.documentPoint),n.button=0,n.clickCount=1,n.targetObject=e,this.pd(n,!1),s instanceof Ht?s.click(n,s):s.click(n),t.lastInput=i}else s instanceof Se&&s.editable?this.editTextBlock(s):this.HT(e)}tI(){const e=this.a;if(!e)return;const t=e.currentTool;if(t instanceof ge&&t.currentToolTip!==null){t.hideToolTip();return}else if(t instanceof yn){const i=t.currentObject;t.doKeyDown(),this.focus=i;return}if(this.focus instanceof _t){const i=this.focus;i instanceof wt&&i.labeledLink!==null?this.focus=i.labeledLink:i.containingGroup!==null?this.focus=i.containingGroup:this.focus=null}else if(this.focus instanceof Ht){const i=this.focus.part;if(i instanceof Nt&&i.isLabeledLink){const s=i.labelNodes.first();if(s!==null&&s.isVisible()){this.focus=s;return}}else if(i instanceof Ft&&i.isSubGraphExpanded){const s=i.memberParts.first();if(s!==null&&s.isVisible()){this.focus=s;return}}this.focus=i}else this.cancelVirtualPointer(),this.stopCommand()}eI(){const e=this.a;if(e)if(e.lastInput.shift&&this.isVirtualPointerShown){const t=e.findPartAt(this.virtualPointerLocation);t!==null&&(t===this.focus?this.jT():this.focus=t)}else this.jT()}jT(){const e=this.a;if(!e)return;const t=e.lastInput,i=this.focus;if(i instanceof _t){let s=i.part;if(t.control||t.meta){for(e.raiseDiagramEvent("ChangingSelection",e.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),e.raiseDiagramEvent("ChangedSelection",e.selection)}else if(t.shift){if(s!==null&&!s.isSelected){for(e.raiseDiagramEvent("ChangingSelection",e.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),e.raiseDiagramEvent("ChangedSelection",e.selection)}}else if(s!==null&&!s.isSelected){for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&e.select(s)}}this.HT(i),this.onFocusChanged(i,i)}HT(e){const t=this.a;if(!t)return;t.toolManager.hideToolTip();const i=t.lastInput;let s=e instanceof Ht?e:t;for(;s instanceof Ht&&!s.toolTip;)s=s.panel;if(s&&s.toolTip){const n=new Dt;n.diagram=t,n.documentPoint=e!==null?e.getDocumentPoint(X.Center):t.viewportBounds.center,n.viewPoint=t.transformDocToView(n.documentPoint),n.targetObject=e,this.pd(n,!1),t.toolManager.showToolTip(s.toolTip,e),t.lastInput=i}}iI(){const e=this.a;if(!e)return;const t=this.focus;if(this.canShowContextMenu(t)){this.showContextMenu(t);const i=e.toolManager.contextMenuTool.currentContextMenu;if(i instanceof Jt){const s=this.SN(i);s.count>0&&(this.focus=s.first())}}}};y(Ye,"md",["Ctrl","Shft","Alt","Meta"]),y(Ye,"VT",Ye.pN(230,40,15)),y(Ye,"zO",Ye.pN(270,40,15)),y(Ye,"XO",Ye.pN(310,40,15));let ua=Ye;var Jl=(M=>(M[M.None=0]="None",M[M.Default=1]="Default",M[M.Vertical=4]="Vertical",M[M.Horizontal=5]="Horizontal",M[M.Fill=2]="Fill",M))(Jl||{}),Zl=(M=>(M[M.None=0]="None",M[M.Along=21]="Along",M[M.Plus90=22]="Plus90",M[M.Minus90=23]="Minus90",M[M.Opposite=24]="Opposite",M[M.Upright=25]="Upright",M[M.Plus90Upright=26]="Plus90Upright",M[M.Minus90Upright=27]="Minus90Upright",M[M.Upright45=28]="Upright45",M))(Zl||{}),Yu=(M=>(M[M.None=0]="None",M[M.Vertical=1]="Vertical",M[M.Horizontal=2]="Horizontal",M[M.Both=3]="Both",M))(Yu||{});const ne=class ne{constructor(){y(this,"n");y(this,"zp");y(this,"Xp");y(this,"pa");y(this,"w");y(this,"ya");y(this,"ft");y(this,"ct");y(this,"hi");y(this,"Zt");y(this,"Gp");y(this,"Zs");y(this,"Lt");y(this,"cs");y(this,"il");y(this,"wa");y(this,"Se");y(this,"Th");y(this,"it");y(this,"Xt");y(this,"sl");y(this,"De");y(this,"Ke");y(this,"yd");y(this,"de");y(this,"wd");y(this,"Ot");y(this,"he");y(this,"nl");y(this,"F1");y(this,"xa");y(this,"df");F.Je(this),this.n=30723,this.Zt=1,this.Gp="",this.Zs=null,this.Lt=null,this.ct=new L(NaN,NaN).k(),this.cs=_.Zw,this.il=new lt,this.wa=new lt,this.Se=null,this.Th=1,this.it=1,this.Xt=0,this.sl=ct.im,this.hi=new Y(NaN,NaN,NaN,NaN).k(),this.De=new Y(NaN,NaN,NaN,NaN).k(),this.Ke=new Y(0,0,NaN,NaN).k(),this.yd=null,this.zp=null,this.ft=null,this.de=X.Default,this.wd=X.Default,this.Xp=0,this.pa=0,this.Ot=null,this.w=null,this.ya=null,this.he=null,this.F1=null,this.xa=null,this.nl=null,this.df=null}cloneProtected(e){e.n=(this.n|2048|4096)&-32769,e.Zt=this.Zt,e.Gp=this.Gp,e.Lt=this.Lt,e.ct.h(this.ct),e.cs=this.cs.N(),this.Se!==null?e.Se=this.Se.copy():e.Se=null,e.it=this.it,e.Xt=this.Xt,e.sl=this.sl.N(),e.hi.h(this.hi),e.De.h(this.De),e.Ke.h(this.Ke),e.zp=this.zp,this.ft!==null&&(e.ft=this.ft.copy()),e.de=this.de.N(),e.wd=this.wd.N(),e.Xp=this.Xp,e.pa=this.pa,this.Ot!==null&&(e.Ot=this.Ot.copy()),this.w!==null&&(this.w.me?e.w=this.w:e.w=this.w.copy()),this.ya!==null&&(e.ya=this.ya.slice()),this.he!==null&&(e.he=this.he.copy())}addCopyProperty(e){let t=this.ya;if(!Array.isArray(t))t=[],this.ya=t;else for(let i=0;i<t.length;i++)if(t[i]===e)return;t.push(e)}jo(e){e.yd=null,e.nl=null,e.c()}clone(){const e=new this.constructor;if(this.cloneProtected(e),this.ya!==null)for(let t=0;t<this.ya.length;t++){const i=this.ya[t];e[i]=this[i]}return e}copy(){return this.clone()}$S(){const e=this.ve;if(e!==null){this.ve=null;for(const t of e)t.xd()&&(t.isToData?this.themeData(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):t.isToObject?this.themeObject(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter,t.sourceName):t.isToModel?this.themeModel(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):this.theme(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter))}return this}fe(e){e in Zl?this.segmentOrientation=e:e in Jl?this.stretch=e:r.dr(this,e)}toString(){return r.Hn(this.constructor)+"#"+F.xs(this)}ba(){this.w!==null&&(this.w.me=!0)}Yt(){return this.w===null?this.w=new Un:this.w.me&&(this.w=this.w.copy()),this.w}Ji(){if(this.ft===null){const e=new fa;e.Dh=X.None,e.vh=X.None,e.Fh=10,e.Rh=10,e.Oh=0,e.Ih=0,this.ft=e}return this.ft}raiseChangedEvent(e,t,i,s,n,o,a){const l=this.part;if(l!==null){l.gf(e,t,i,s,n,o,a),i===this&&e===2&&this.mf()&&this.Eh(l,t);const h=this.diagram;if(this.Ds!==null&&h!==null&&h.Qa&&!h.undoManager.isUndoingRedoing&&!h.animationManager.Uu){const d=this.Ds.get(t);if(d!==null&&h.animationManager.isEnabled&&!h.animationManager.isTicking){this.df===null&&(this.df=new nt);let f=h.undoManager.transactionLevel===0;if(d.startCondition===2?f=!0:d.startCondition===3&&(f=!1),f){const m=new wo;d.RR(m);const p=this.df.get(d);p!==null&&p.stop(),this.df.set(d,m),m.tb=this,m.DM=d,m.add(this,t,s,n),m.start()}else h.animationManager.getBundleAnimation().add(this,t,s,n)}}if(this instanceof Lt&&i===l&&l.MN()&&l.data!==null){const d=this.D.r,f=d.length;for(let m=0;m<f;m++){const p=d[m];p instanceof Lt&&p.Sn(b=>{b.data!==null&&b.MN()&&b.updateTargetBindings(t)})}}}}TR(e){this.df&&this.df.delete(e)}Yo(){if(this.diagram!==null&&this.findBindingPanel()===null&&this.ve!==null){const e=this.diagram.model,t=this.ve.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.qT(n));let o=this;const a=i.targetId;a!==-1&&(o=this.Yp(a),o===null)||(n==="/"?s=o.part:n==="."?s=o:n===".."&&(s=o.panel),i.updateTarget(o,s,void 0,e))}}}Eh(e,t){const i=this.findBindingPanel();if(i!==null){const s=e.diagram,n=this.ve.iterator;for(;n.next();){const o=n.value;let a=null;if(o.isToObject){if(a=o.WT(i,this),a===null)continue;o.updateSource(this,a,t,null)}else if(o.isToModel)s!==null&&!s.wi&&o.updateSource(this,s.model.modelData,t,i);else if(!o.isToTheme){const l=i.data;if(l===null)continue;s!==null&&!s.wi&&o.updateSource(this,l,t,i)}if(a===this){const l=o.targetId,h=i.Yp(l);h!==null&&o.updateTarget(h,a,t,s==null?void 0:s.model)}}}}Yp(e){return this.oo===e?this:null}qT(e){let t;return e===""?t=this:e==="/"?t=this:e==="."?t=this:e===".."?t=this:t=this.part.findObject(e),t}get oo(){return this.w!==null?this.w.oo:-1}set oo(e){this.oo!==e&&(this.w===null&&(this.w=new Un),this.w.oo=e)}get ve(){return this.w!==null?this.w.ve:null}set ve(e){this.ve!==e&&(this.w===null&&(this.w=new Un),this.w.ve=e)}get ro(){return this.w!==null?this.w.ro:null}set ro(e){this.ro!==e&&(this.w===null&&(this.w=new Un),this.w.ro=e)}raiseChanged(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}t(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}lo(e,t,i,s){const n=this.hi;if(n.e(e,t,i,s),this.it!==1||this.Xt!==0){this.Se===null&&(this.Se=new lt);const o=this.Se;o.Ue(),this.Kp(o,e,t,i,s),o.sm(n)}}JT(e,t,i){return this.pickable===!1?!1:(i.kc(this.v),t?this.intersectsRect(e,i):this.containedInRect(e,i))}$T(e,t,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=e.distanceSquaredPoint(t);return i?L.distanceLineSegmentSquared(e.x,e.y,0,0,0,s.height)<=n||L.distanceLineSegmentSquared(e.x,e.y,0,s.height,s.width,s.height)<=n||L.distanceLineSegmentSquared(e.x,e.y,s.width,s.height,s.width,0)<=n||L.distanceLineSegmentSquared(e.x,e.y,s.width,0,0,0)<=n:e.distanceSquared(0,0)<=n&&e.distanceSquared(0,s.height)<=n&&e.distanceSquared(s.width,0)<=n&&e.distanceSquared(s.width,s.height)<=n}Nn(){return!0}containsPoint(e){const t=L.l();t.h(e),this.v.gt(t);const i=this.actualBounds;if(!i.isReal())return L.i(t),!1;const s=this.diagram;if(s!==null&&s.pp){const o=s.getInputOption("extraTouchThreshold"),a=s.getInputOption("extraTouchArea"),l=a/2,h=this.naturalBounds,d=this.getDocumentScale()*s.scale,f=1/d;if(h.width*d<o&&h.height*d<o){const m=Y.contains(i.x-l*f,i.y-l*f,i.width+a*f,i.height+a*f,t.x,t.y);return L.i(t),m}}let n=!1;return(this instanceof Jt||this instanceof Xt?Y.contains(i.x-5,i.y-5,i.width+10,i.height+10,t.x,t.y):i.containsPoint(t))&&(this.he&&!this.he.containsPoint(t)?n=!1:this.Lt!==null&&this.Ke.containsPoint(e)?n=!0:n=this.ka(e)),L.i(t),n}ka(e){const t=this.naturalBounds;return Y.contains(0,0,t.width,t.height,e.x,e.y)}containsRect(e){if(this.angle===0)return this.actualBounds.containsRect(e);const t=this.naturalBounds,i=Y.z(0,0,t.width,t.height),s=this.v;let n=!1;const o=L.z(e.x,e.y);return i.containsPoint(s.Ci(o))&&(o.e(e.x,e.bottom),i.containsPoint(s.Ci(o))&&(o.e(e.right,e.bottom),i.containsPoint(s.Ci(o))&&(o.e(e.right,e.y),i.containsPoint(s.Ci(o))&&(n=!0)))),L.i(o),Y.i(i),n}containedInRect(e,t){if(t===void 0)return e.containsRect(this.actualBounds);const i=this.naturalBounds,s=t;let n=!1;const o=L.z(0,0);return e.containsPoint(s.gt(o))&&(o.e(0,i.height),e.containsPoint(s.gt(o))&&(o.e(i.width,i.height),e.containsPoint(s.gt(o))&&(o.e(i.width,0),e.containsPoint(s.gt(o))&&(n=!0)))),L.i(o),n}intersectsRect(e,t){if(t===void 0&&(t=this.v,this.angle===0))return e.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=t,n=L.z(0,0),o=L.z(0,i.height),a=L.z(i.width,i.height),l=L.z(i.width,0);let h=!1;if(e.containsPoint(s.gt(n))||e.containsPoint(s.gt(o))||e.containsPoint(s.gt(a))||e.containsPoint(s.gt(l)))h=!0;else{const d=Y.z(0,0,i.width,i.height),f=L.z(e.x,e.y);d.containsPoint(s.Ci(f))?h=!0:(f.e(e.x,e.bottom),d.containsPoint(s.Ci(f))?h=!0:(f.e(e.right,e.bottom),d.containsPoint(s.Ci(f))?h=!0:(f.e(e.right,e.y),d.containsPoint(s.Ci(f))&&(h=!0)))),L.i(f),Y.i(d),h||(B.lx(e,n,o)||B.lx(e,o,a)||B.lx(e,a,l)||B.lx(e,l,n))&&(h=!0)}return L.i(n),L.i(o),L.i(a),L.i(l),h}getDocumentPoint(e,t){if(t===void 0&&(t=new L),e instanceof X){const i=e,s=this.naturalBounds;return t.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Js.gt(t),t}else return t.set(e),this.Js.gt(t),t}getDocumentBounds(e){e===void 0&&(e=new Y);const t=this.naturalBounds,i=this.Js,s=L.z(0,0).v(i);return e.e(s.x,s.y,0,0),s.e(t.width,0).v(i),e.re(s.x,s.y,0,0),s.e(t.width,t.height).v(i),e.re(s.x,s.y,0,0),s.e(0,t.height).v(i),e.re(s.x,s.y,0,0),L.i(s),e}getDocumentAngle(){return this.Js.YF()}getDocumentScale(){if(this.Hp()===!1)return this.Th;const e=this.it;return this.panel!==null?e*this.panel.getDocumentScale():e}getLocalPoint(e,t){return t===void 0&&(t=new L),t.h(e),this.Js.Ci(t),t}getNearestIntersectionPoint(e,t,i){return this.pf(e.x,e.y,t.x,t.y,i)}pf(e,t,i,s,n){const o=this.v,a=1/(o.m11*o.m22-o.m12*o.m21),l=o.m22*a,h=-o.m12*a,d=-o.m21*a,f=o.m11*a,m=a*(o.m21*o.dy-o.m22*o.dx),p=a*(o.m12*o.dx-o.m11*o.dy),b=e*l+t*d+m,x=e*h+t*f+p,v=i*l+s*d+m,S=i*h+s*f+p;n.e(0,0);const P=this.naturalBounds,T=B.Cl(0,0,P.width,P.height,b,x,v,S,n);return n.v(o),T}ht(e,t,i,s){if(this.Go()===!1)return;const n=this.sl,o=n.right+n.left,a=n.top+n.bottom;e=Math.max(e-o,0),t=Math.max(t-a,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-a,0);const l=this.angle;let h=0;const d=this.desiredSize,f=this.jp();l===90||l===270?(e=isFinite(d.height)?d.height+f:e,t=isFinite(d.width)?d.width+f:t):(e=isFinite(d.width)?d.width+f:e,t=isFinite(d.height)?d.height+f:t);let m=i||0,p=s||0;const b=this instanceof Lt;switch(this.Qs(!0)){case 0:m=0,p=0,b&&(e=1/0,t=1/0);break;case 2:isFinite(e)&&e>i&&(m=e),isFinite(t)&&t>s&&(p=t);break;case 5:isFinite(e)&&e>i&&(m=e),p=0,b&&(t=1/0);break;case 4:isFinite(t)&&t>s&&(p=t),m=0,b&&(e=1/0);break}const x=this.maxSize,v=this.minSize;m>x.width&&v.width<x.width&&(m=x.width),p>x.height&&v.height<x.height&&(p=x.height),i=Math.max(m,v.width),s=Math.max(p,v.height),x.width<i&&(i=Math.min(v.width,i)),x.height<s&&(s=Math.min(v.height,s)),e=Math.min(x.width,e),t=Math.min(x.height,t),e=Math.max(i,e),t=Math.max(s,t),(l===90||l===270)&&(h=e,e=t,t=h,h=i,i=s,s=h),this.hi.ce(),this.bd(e,t,i,s),this.hi.k(),this.hi.isReal()||r.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.hi.toString()),this.xi(!1)}bd(e,t,i,s){}_s(){return!1}Ut(e,t,i,s,n){this.yf();const o=Y.l();o.h(this.De),this.De.ce(),this.as()===!1?this.De.e(e,t,i,s):this.Pa(e,t,i,s),this.De.k(),n===void 0?this.he=null:this.he=n;let a=!1;if(n!==void 0)a=!0;else{let l=this.panel;if(l!==null&&l.ol()&&(l=l.panel),l!==null){const h=l.Ke,d=this.measuredBounds,f=t+d.height,m=e+d.width;if(a=!(0<=e+.05&&m<=h.width+.05&&0<=t+.05&&f<=h.height+.05),this instanceof Se){const p=this.naturalBounds;(this.qp>p.height||this.pe>p.width)&&(a=!0)}}}a?this.n|=256:this.n&=-257,this.De.isReal()||r.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.De.toString()),this.kd(o,this.De),this.ao(!1),Y.i(o)}Pa(e,t,i,s){}commonArrange(e,t,i,s){if(this.De.e(e,t,i,s),this.desiredSize.isReal())return;const n=this.hi,o=this.sl,a=o.right+o.left,l=o.top+o.bottom,h=n.width+a,d=n.height+l;i+=a,s+=l;let f=this.Qs(!0);switch(h===i&&d===s&&(f=0),f){case 0:(h>i||d>s)&&(this.xi(!0),this.ht(h>i?i:h,d>s?s:d,0,0));break;case 2:this.xi(!0),this.ht(i,s,0,0);break;case 5:this.xi(!0),this.ht(i,d,0,0);break;case 4:this.xi(!0),this.ht(h,s,0,0);break}}kd(e,t){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.NN(!0),this.C(),!e.equalsApproxClose(t)&&(i.Sa(),this.Wp(i)))}Wp(e){this.portId!==null&&(e.NN(!0),e instanceof wt&&e.invalidateConnectedLinks(void 0,this))}get shadowVisible(){return this.w!==null?this.w.Jp:null}set shadowVisible(e){const t=this.shadowVisible;t!==e&&(this.Yt().Jp=e,this.$i(!0),this.C(),this.t("shadowVisible",t,e))}oI(e,t){const i=this.naturalBounds,s=this.wa,n=s.m11,o=s.m21,a=s.dx,l=s.m12,h=s.m22,d=s.dy;let f=0,m=0,p=f,b=m;f=p*n+b*o+a,m=p*l+b*h+d;let x=f,v=m,S=0,P=0;p=i.width+t,b=0,f=p*n+b*o+a,m=p*l+b*h+d;let T=Math.min(x,f),A=Math.min(v,m);S=Math.max(x+S,f)-T,P=Math.max(v+P,m)-A,x=T,v=A,p=i.width+t,b=i.height+t,f=p*n+b*o+a,m=p*l+b*h+d,T=Math.min(x,f),A=Math.min(v,m),S=Math.max(x+S,f)-T,P=Math.max(v+P,m)-A,x=T,v=A,p=0,b=i.height+t,f=p*n+b*o+a,m=p*l+b*h+d,T=Math.min(x,f),A=Math.min(v,m),S=Math.max(x+S,f)-T,P=Math.max(v+P,m)-A,x=T,v=A;const C=e.viewportBounds,O=C.x,R=C.y,I=C.width,H=C.height;return x>I+O||O>S+x||v>H+R||R>P+v}Ge(e,t){if(this.rI(e,t)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=e.globalAlpha,e.globalAlpha=s*i);let n="";this.filter!==""&&(n=e.filter,e.filter=this.filter);const o=this.v,a=this.panel;this.Hp()===!0&&this.R1();const l=this.part;let h=!1,d=0;if(l&&t.getRenderingHint("drawShadows")&&(h=l.isShadowed,h)){const v=l.shadowOffset;d=Math.max(v.y,v.x)*t.scale*t.$e}const f=this instanceof Lt&&this.ol(),m=this.De;if(f&&(this.ZT(h,e,!1,a),this.lI(e,t),this.QT(h,e,!1,a),this._T(h,e,!1)),f||!f&&(m.width===0||m.height===0||isNaN(m.x)||isNaN(m.y))){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}const p=this._s();if(!t.ph&&p&&this.oI(t,d)){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}let b=(this.n&256)!==0;if(e.clipInsteadOfFill&&(b=!1),this instanceof Se&&(e.font=this.font),b){const v=a.Nn()?a.naturalBounds:a.actualBounds;let S=Math.max(m.x,v.x),P=Math.max(m.y,v.y),T=Math.min(m.right,v.right)-S,A=Math.min(m.bottom,v.bottom)-P;const C=this.he;if(C!==null&&(S=C.x,P=C.y,T=C.width,A=C.height),S>m.width+m.x||m.x>v.width+v.x){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}e.save(),e.beginPath(),e.rect(S,P,T,A),e.clip()}if(p){if(!l.isVisible()){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}if(h){const v=l.shadowOffset;e.shadowsSet(v.x*t.scale*this.scale*t.$e,v.y*t.scale*this.scale*t.$e,l.shadowBlur),e.shadowsOn(),e.shadowColor=l.shadowColor}}const x=this.naturalBounds;if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.ZT(h,e,p,a),this.Lt!==null&&(e.commitTransform(),this.O1(e,x,m)),this.QT(h,e,p,a),this.Ma(e,t),this._T(h,e,p),b&&(e.restore(),e.clearContextCache(this instanceof Lt)),!o.RP()){const v=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*v,-o.m12*v,-o.m21*v,o.m11*v,v*(o.m21*o.dy-o.m22*o.dx),v*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n)}ZT(e,t,i,s){e&&this.shadowVisible===!0?t.shadowsOn():e&&this.shadowVisible===!1&&t.shadowsOff(),e&&this.I1(s)&&this.shadowVisible===null&&t.shadowsOff()}QT(e,t,i,s){e&&(this.Lt!==null||this.I1(s))?(this.E1(!0),this.shadowVisible===null&&t.shadowsOff()):this.E1(!1)}_T(e,t,i){e&&this.CN()===!0&&t.shadowsOn(),i&&e&&t.shadowsOff()}aI(e,t,i){const s=this.part;let n=!1;s&&e.getRenderingHint("drawShadows")&&(n=s.isShadowed),t.clipInsteadOfFill&&(n=!1),this._s()&&n&&t.shadowsOn(),n&&this.shadowVisible===!0?t.shadowsOn():n&&this.shadowVisible===!1&&t.shadowsOff();const o=this.panel;if(n&&this.I1(o)&&this.shadowVisible===null&&t.shadowsOff(),t.rl){const a=e.computePixelRatio(),l=`drop-shadow(${t.shadowOffsetX/a}px ${t.shadowOffsetY/a}px ${t.shadowBlur/a/2}px ${t.shadowColor})`;this.background!==null&&i.Lt.setAttributeNS(null,"filter",l)}return n&&(this.Lt!==null||this.I1(o))?(this.E1(!0),this.shadowVisible===null&&t.shadowsOff()):this.E1(!1),n}hI(e,t,i,s){if(i.rl){const n=t.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.LN(e,o)}s&&this.CN()===!0&&i.shadowsOn(),this._s()&&i.shadowsOff()}I1(e){return e===null?!1:(e.ol()&&(e=e.panel),e.CN()||(e.type===Lt.Auto||e.type===Lt.Spot)&&e.findMainElement()!==this)}LN(e,t){}O1(e,t,i){const s=this.jp(),n=t.x,o=t.y,a=t.width+s,l=t.height+s;this.kn(e,this.Lt,!0,!1,t,i),this.Lt instanceof me&&this.Lt.type===3?(e.beginPath(),e.rect(n-s/2,o-s/2,a,l),e.fillContext(this.Lt,!1,null)):e.fillRect(n-s/2,o-s/2,a,l)}tD(e,t){let i=e.cI(this);const s=e.xa!==null?e.xa:e.svg;if(s!==null&&i!==-1){for(;i!==0&&!e.elt(i-1).isVisibleObject();)i--;if(i===0)this.fI(e,t,s);else{const n=e.elt(i-1).svg;n!==null?n.after(t):s.appendChild(t)}}}fI(e,t,i){if(e.type===Lt.Table){const s=i.getElementsByClassName("gojs-ts"),n=s.length!==0?s[0]:null;n!==null&&n.after(t)}else i.Lt?i.Lt.after(t):i.prepend(t)}rI(e,t){if(!(e instanceof Ri))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.De;if(this._s()&&(!this.isVisible()||i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;e.setCurrentTransform(1,0,0,1,0,0);const s=this.panel,n=this.Pd(e);if(this.wf(e,t,n))return this.eD(this.svg),this.svg.parentElement!==null?(this._s()&&(e.lastDrawnPart=this.svg),!0):(this._s()?(e.lastDrawnPart!==null?e.lastDrawnPart.after(this.svg):e.diagramGroup.prepend(this.svg),e.lastDrawnPart=this.svg):s&&this.tD(s,this.svg),!0);if(this.$i(!1),this._s()&&this.isShadowed){const x=this.shadowOffset;e.shadowsSet(x.x*t.scale*this.scale*t.$e,x.y*t.scale*this.scale*t.$e,this.shadowBlur),e.shadowsOn(),e.shadowColor=this.shadowColor}this instanceof Se&&(e.font=this.font),e.currentElement=null;const o=this.v,a=this instanceof Lt,l=this instanceof Lt?this.ol():!1,h=this.svg;if(this.Hp()===!0&&this.R1(),e.outerGroup=!1,n)if(e.outerGroup=!0,a&&l)e.newGroup(1,0,0,1,0,0),this.svg=e.lastCreatedElement;else if(a&&this.isClipping){const x=this.findMainElement();let v=0,S=0;x!==null&&(v=x.actualBounds.x,S=x.actualBounds.y),e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+v,o.dy+S),this.svg=e.lastCreatedElement,x!==null&&e.createOrUpdateClipGroup(this,x.actualBounds),e.currentElement=e.lastCreatedElement}else a?(e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=e.lastCreatedElement):e.newGroup(1,0,0,1,0,0);const d=this.naturalBounds;a||e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(a?(l&&e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(e,d,i),l&&e.setCurrentTransform(1,0,0,1,0,0)):(e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(e,d,i)),e.currentElement.Lt=e.lastCreatedElement,e.currentElement.prepend(e.lastCreatedElement));const f=this.aI(t,e,e.currentElement);this.Ma(e,t),a&&e.endGroup(),e.outerGroup&&e.endGroup();const m=e.surface.ud,p=a?this.svg:e.currentElement;if(h!==null&&h.parentNode!==null&&p!==h&&(this.panel===null||h.parentNode===this.panel.svg)){const x=this.svg.getAttribute("filter");return x!==null&&p.setAttribute("filter",x),this.filter!==""&&p.setAttributeNS(null,"filter",this.filter),h.replaceWith(p),this.svg=p,p!==null&&this.$p(e,s,i,p),!0}if(this.svg=p,m!==null&&p===null&&e.dummyGroup(),p===null)return!0;this.$p(e,s,i,p),this.hI(p,t,e,f);const b=this._s()?this.opacity*e.globalAlpha:this.opacity;if(b!==1&&p.setAttributeNS(null,"opacity",b.toString()),this.filter!==""&&p.setAttributeNS(null,"filter",this.filter),this._s()){if(h!==null&&p!==h&&h.parentNode===e.diagramGroup){const x=h.getAttribute("filter");x!==null&&p.setAttribute("filter",x),h.replaceWith(p)}else e.lastDrawnPart?e.lastDrawnPart.after(p):e.diagramGroup.prepend(p);e.lastDrawnPart=p}else s!==null&&this.tD(s,p);return m!==null&&m(this,p),this.eD(p),!0}eD(e){const t=this,i=e.dataset;t instanceof ne&&(t.portId!==null&&(i.portId=t.portId),t instanceof Lt&&(isNaN(t.itemIndex)||(i.itemIndex=t.itemIndex.toString()),t instanceof _t&&(i.className=r.Hn(t),t.key!==void 0&&(i.key=t.key.toString()),t.containingGroup!==null&&(i.group=t.containingGroup.key.toString()),t instanceof Nt&&(t.fromNode!==null&&t.fromNode.key!==void 0&&(i.fromKey=t.fromNode.key.toString()),t.fromPortId!==""&&(i.fromPortId=t.fromPortId),t.toNode!==null&&t.toNode.key!==void 0&&(i.toKey=t.toNode.key.toString()),t.toPortId!==""&&(i.toPortId=t.toPortId)))))}$p(e,t,i,s){let n=(this.n&256)!==0;if(e.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=t.Nn()?t.naturalBounds:t.actualBounds;let a=Math.max(i.x,o.x),l=Math.max(i.y,o.y),h=Math.min(i.right,o.right)-a,d=Math.min(i.bottom,o.bottom)-l;const f=this.he;f!==null&&(a=f.x,l=f.y,h=f.width,d=f.height);const m=Y.z(a,l,Math.max(h,0),Math.max(d,0));if(this instanceof Lt){const p=lt.l();p.set(this.v),p.ex(),p.sm(m),lt.i(p)}s.setAttributeNS(null,"clip-path",`path('      M ${m.x},${m.y}       L ${m.width+m.x} ${m.y}       L ${m.width+m.x} ${m.height+m.y}       L ${m.x} ${m.height+m.y} z') view-box`),Y.i(m)}uI(){if(this.svg===null)return;const e=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),t=this.svg.ownerDocument;if(e!==null)for(const i of e){const s=t.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}lI(e,t){const i=this.De,s=this.Ke,n=this.Lt;n!==null&&e.commitTransform(),n!==null&&(this.kn(e,n,!0,!1,s,i),n instanceof me&&n.type===3?(e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillContext(n,!1,null)):e.fillRect(i.x,i.y,i.width,i.height)),this.Ma(e,t)}Ma(e,t){}xf(){this.$i(!0)}wf(e,t,i){const s=this.svg;if(this.dI()){if(this.xf(),this.$i(!1),s===null)return!1;const f=s.getAttribute("clip-path");if(f!==null&&f.includes("url")){const m=e.svg.getElementById(f.split("#")[1].slice(0,-1));m!==null&&m.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.v,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",a=this instanceof Lt,l=a?this.ol():!1;if(!(a&&l))if(this instanceof cs){const f=this.U1;e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),f!==null&&e.amendImageTransform(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]),i?s.lastElementChild.setAttributeNS(null,"transform",e.getCurrentTransform()):s.setAttributeNS(null,"transform",e.getCurrentTransform())}else if(i&&!a)if(this instanceof Xt){const f=s.getElementsByTagName("path");for(let m=0;m<f.length;m++)f[m].setAttributeNS(null,"transform",o)}else if(this instanceof Se){const f=s.getElementsByTagName("text"),m=typeof this.stroke=="string"?this.stroke:null;for(let p=0;p<f.length;p++)f[p].setAttributeNS(null,"transform",o),m&&f[p].setAttributeNS(null,"fill",m)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(a&&this.isClipping&&this.xa){const f=this.findMainElement(),m=f!==null?f.actualBounds.x:0,p=f!==null?f.actualBounds.y:0;this.xa.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-m+", "+-p+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+m)+", "+(n.dy+p)+")")}else s.setAttributeNS(null,"transform",o);const h=this._s()?this.opacity*e.globalAlpha:this.opacity;h===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),e.setCurrentTransform(1,0,0,1,0,0);const d=this.xa?this.xa:this.F1;if(this.background!==null||d.Lt!==void 0){const f=d.Lt;if(this.background===null)e.removeOldGradient(this,d.Lt,"fill"),d.Lt.remove(),d.Lt=void 0;else{if((l||i&&!(this instanceof Lt))&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.O1(e,this.naturalBounds,this.actualBounds),d.Lt){e.removeOldGradient(this,d.Lt,"fill");const m=d.Lt.getAttribute("filter");m!==null&&e.lastCreatedElement.setAttribute("filter",m),d.Lt.replaceWith(e.lastCreatedElement)}else d.prepend(e.lastCreatedElement);d.Lt=e.lastCreatedElement}f&&e.removeOldGradient(this,f,"fill")}return this.$p(e,this.panel,this.actualBounds,s),!0}Pd(e){if(this.background!==null)return!0;let t=(this.n&256)!==0;return e.clipInsteadOfFill&&(t=!1),!!t}static UU(e,t,i,s,n,o,a){let l=.001;const h=o.length;e.moveTo(t,i);let d=s-t;const f=n-i;d===0&&(d=.001);const m=f/d;let p=Math.sqrt(d*d+f*f),b=0,x=!0;l=o[b%h];let v=a!==0;for(;p>=.1;){if(v){for(l=o[b++%h],l-=a;l<0;)l+=o[b++%h],x=!x;v=!1}else l=o[b++%h];l>p&&(l=p);let S=Math.sqrt(l*l/(1+m*m));d<0&&(S=-S),t+=S,i+=m*S,x?e.lineTo(t,i):e.moveTo(t,i),p-=l,x=!x}}kn(e,t,i,s,n,o){let a=1,l=1;if(typeof t=="string"){i?e.fillStyle=t:e.strokeStyle=t;return}else if(t.type===1){i?e.fillStyle=t.color:e.strokeStyle=t.color;return}let h;const d=this.jp();a=n.width,l=n.height,s?(a=o.width,l=o.height):i||(a+=d,l+=d);const f=e instanceof mr;if(f&&t.Cn&&(t.type===4||t.bf===a&&t.V1===l))h=t.Cn;else{let m=0,p=0,b=0,x=0,v=0,S=0,P=0,T=0;if(s?(P=o.x,T=o.y):i||(P-=d/2,T-=d/2),m=t.start.x*a+t.start.offsetX+P,p=t.start.y*l+t.start.offsetY+T,b=t.end.x*a+t.end.offsetX+P,x=t.end.y*l+t.end.offsetY+T,t.type===2)h=e.createLinearGradient(m,p,b,x);else if(t.type===3)S=isNaN(t.endRadius)?Math.max(a,l)/2:t.endRadius,isNaN(t.startRadius)?(v=0,S=Math.max(a,l)/2):v=t.startRadius,h=e.createRadialGradient(m,p,v,b,x,S);else if(t.type===4)try{h=e.createPattern(t.pattern,"repeat")}catch{h=null}else r.si(t.type,"Brush type");if(t.type!==4){const A=t.colorStops;if(A!==null){const C=A.iterator;for(;C.next();)h.addColorStop(C.key,C.value)}}if(f&&(t.Cn=h,h!==null&&(t.bf=a,t.V1=l),h===null&&t.type===4&&t.bf!==-1)){t.bf=-1;const A=this.diagram;A!==null&&t.bf===-1&&r.dn(()=>{A.redraw()},600)}}i?e.fillStyle=h:e.strokeStyle=h}isContainedBy(e){return e instanceof Lt?this.gI(this,e):!1}gI(e,t){if(e===t||t===null)return!1;let i=e.panel;for(;i!==null;){if(i===t)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const e=this.panel;return e!==null?e.isVisibleObject():!0}isEnabledObject(){let e=this instanceof Lt?this:this.panel;for(;e!==null&&e.isEnabled;)e=e.panel;return e===null}get enabledChanged(){return this.w!==null?this.w.Zp:null}set enabledChanged(e){const t=this.enabledChanged;t!==e&&(e!==null&&r.S(e,ne,"enabledChanged"),this.Yt().Zp=e,this.t("enabledChanged",t,e))}R1(){if(this.B1()===!0){const e=this.il;if(e.Ue(),!this.De.isReal()||!this.hi.isReal()){this.Sd(!1);return}if(e.Gs(this.De.x-this.hi.x,this.De.y-this.hi.y),this.scale!==1||this.angle!==0){const t=this.naturalBounds;this.Kp(e,t.x,t.y,t.width,t.height)}this.Sd(!1),this.Uh(!0)}if(this.Hp()===!0){const e=this.panel;if(e===null)this.wa.set(this.il),this.Th=this.scale;else if(e.Js!==null){const t=this.wa;t.Ue(),e.Nn()?t.kc(e.wa):e.panel!==null&&t.kc(e.panel.wa),t.kc(this.il),this.Th=this.scale*e.Th}this.Uh(!1)}}Kp(e,t,i,s,n){if(this.it!==1&&e.it(this.it),this.Xt===0)return;const o=L.l();o.setSpot(t,i,s,n,X.Center),e.ks(this.Xt,o.x,o.y),L.i(o)}c(e){if(this.Go())return;e===void 0&&(e=!1),this.xi(!0),this.ao(!0);const t=this.panel;t!==null&&!e&&t.c()}kf(){this.Go()||(this.xi(!0),this.ao(!0))}Pf(e){if(this.as())return;const t=this.panel;!e&&t!==null&&t.c(),this.ao(!0)}yf(){this.B1()===!1&&(this.Sd(!0),this.Uh(!0))}AN(){this.Uh(!0)}C(){const e=this.part;e!==null&&e.C()}Qs(e){const t=this.stretch,i=this.panel;if(i===null)return this.qo(t===1?0:t,e);if(i.type===Lt.Table)return this.Qp(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),e);if(i.type===Lt.Auto&&i.findMainElement()===this)return this.qo(2,e);if(t===1){if(i.type===Lt.Spot&&i.findMainElement()===this)return this.qo(2,e);const s=i.defaultStretch;return s===1?this.qo(0,e):this.qo(s,e)}return this.qo(t,e)}Qp(e,t,i){const s=this.stretch;if(s!==1)return this.qo(s,i);let n=null,o=null;switch(e.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(t.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const a=this.panel.defaultStretch;return n===null&&(n=a===5||a===2),o===null&&(o=a===4||a===2),n===!0&&o===!0?this.qo(2,i):n===!0?this.qo(5,i):o===!0?this.qo(4,i):this.qo(0,i)}qo(e,t){if(t)return e;if(e===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(e===5)return 0;if(e===2)return 4}else{if(e===4)return 0;if(e===2)return 5}if(n)if(o!==90&&o!==270){if(e===4)return 0;if(e===2)return 5}else{if(e===5)return 0;if(e===2)return 4}return e}get segmentOrientation(){return this.Ot!==null?this.Ot._p:0}set segmentOrientation(e){const t=this.segmentOrientation;t!==e&&(this.Ot===null&&(this.Ot=new xn),this.Ot._p=e,this.c(),this.t("segmentOrientation",t,e),e===0&&(this.angle=0))}mI(){this.segmentOrientation=21}get segmentIndex(){return this.Ot!==null?this.Ot.t0:-1/0}set segmentIndex(e){e=Math.round(e);const t=this.segmentIndex;t!==e&&(this.Ot===null&&(this.Ot=new xn),this.Ot.t0=e,this.c(),this.t("segmentIndex",t,e))}get segmentFraction(){return this.Ot!==null?this.Ot.e0:0}set segmentFraction(e){e<0?e=0:e>1&&(e=1);const t=this.segmentFraction;t!==e&&(this.Ot===null&&(this.Ot=new xn),this.Ot.e0=e,this.c(),this.t("segmentFraction",t,e))}get segmentOffset(){return this.Ot!==null?this.Ot.i0:L.gn}set segmentOffset(e){const t=this.segmentOffset;t.equals(e)||(e=e.N(),this.Ot===null&&(this.Ot=new xn),this.Ot.i0=e,this.c(),this.t("segmentOffset",t,e))}get stretch(){return this.w!==null?this.w.ho:1}set stretch(e){const t=this.stretch;t!==e&&(this.Yt().ho=e,this.c(),this.t("stretch",t,e))}get name(){return this.w!==null?this.w.Pt:""}set name(e){const t=this.name;t!==e&&(this.Yt().Pt=e,this.part!==null&&this.part.s0(),this.t("name",t,e))}get opacity(){return this.Zt}set opacity(e){e<0?e=0:e>1&&(e=1);const t=this.opacity;if(t!==e){this.Zt=e,this.t("opacity",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get filter(){return this.Gp}set filter(e){const t=this.filter;if(t!==e){this.Gp=e,this.$i(!0),this.t("filter",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(e){const t=(this.n&1)!==0;if(t!==e){this.n=this.n^1,this.xf(),this.t("visible",t,e);const i=this.panel;i!==null?i.c():this._s()&&this.Xe(e),this.C(),this.iD()}}get pickable(){return(this.n&2)!==0}set pickable(e){const t=(this.n&2)!==0;t!==e&&(this.n=this.n^2,this.t("pickable",t,e))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(e){const t=(this.n&4)!==0;t!==e&&(this.n=this.n^4,this.t("fromLinkableDuplicates",t,e))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(e){const t=(this.n&8)!==0;t!==e&&(this.n=this.n^8,this.t("fromLinkableSelfNode",t,e))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(e){const t=(this.n&16)!==0;t!==e&&(this.n=this.n^16,this.t("toLinkableDuplicates",t,e))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(e){const t=(this.n&32)!==0;t!==e&&(this.n=this.n^32,this.t("toLinkableSelfNode",t,e))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(e){const t=(this.n&64)!==0;t!==e&&(this.n=this.n^64,this.c(),this.t("isPanelMain",t,e))}get isActionable(){return(this.n&128)!==0}set isActionable(e){const t=(this.n&128)!==0;t!==e&&(this.n=this.n^128,this.t("isActionable",t,e))}get background(){return this.Lt}set background(e){const t=this.background;t!==e&&(e!==null&&me.Md(e,"GraphObject.background"),e instanceof me&&e.k(),this.Lt=e,this.C(),this.t("background",t,e))}CN(){return(this.n&512)!==0}E1(e){e?this.n|=512:this.n&=-513}mf(){return(this.n&1024)!==0}TN(e){e?this.n|=1024:this.n&=-1025}B1(){return(this.n&2048)!==0}Sd(e){e?this.n|=2048:this.n&=-2049}Hp(){return(this.n&4096)!==0}Uh(e){e?this.n|=4096:this.n&=-4097}Go(){return(this.n&8192)!==0}xi(e){e?this.n|=8192:this.n&=-8193}as(){return(this.n&16384)!==0}ao(e){e?this.n|=16384:this.n&=-16385}dI(){return(this.n&32768)!==0}$i(e){e?this.n|=32768:this.n&=-32769}get part(){if(this._s())return this;if(this.nl!==null)return this.nl;let e=this;for(e=e.panel;e;){if(e instanceof _t)return this.nl=e,e;e=e.panel}return null}get svg(){return this.F1}set svg(e){this.F1=e}Wc(){this.svg=null}get panel(){return this.Zs}Vh(e){this.Zs=e,this.svg!==null&&this.svg.remove()}get layer(){const e=this.part;return e!==null?e.layer:null}get diagram(){const e=this.part;return e!==null?e.diagram:null}get position(){return this.ct}set position(e){const t=e.x,i=e.y,s=this.position,n=s.x,o=s.y;n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i))?(e=e.copy(),this.DN(e,n,o)&&this.t("position",new L(n,o),e.copy())):this.vN()}vN(){}DN(e,t,i){return this.ct=e,this.Pf(),!0}Uc(e,t,i){this.ct.x===e&&this.ct.y===t||(this.ct.e(e,t),this.yf())}get actualBounds(){return this.De}get scale(){return this.it}set scale(e){const t=this.scale;t!==e&&(e<=0&&r.o("GraphObject.scale for "+this+" must be greater than zero, not: "+e),this.it=e,this.c(),this.t("scale",t,e))}get angle(){return this.Xt}set angle(e){const t=this.angle;if(t!==e){if(e=e%360,e<0&&(e+=360),t===e)return;this.Xt=e,this.iD(),this.c(),this.t("angle",t,e)}}get desiredSize(){return this.cs}set desiredSize(e){const t=e.width,i=e.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(e=e.N(),this.cs=e,this.c(),this instanceof Xt&&this.ai(),this.t("desiredSize",s,e),this.mf())){const a=this.part;a!==null&&(this.Eh(a,"width"),this.Eh(a,"height"))}}get width(){return this.cs.width}set width(e){const t=this.cs.width;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.cs,s=new _(e,this.cs.height).k();if(this.cs=s,this.c(),this instanceof Xt&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;n!==null&&this.Eh(n,"width")}}}get height(){return this.cs.height}set height(e){const t=this.cs.height;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.cs,s=new _(this.cs.width,e).k();if(this.cs=s,this.c(),this instanceof Xt&&this.ai(),this.t("desiredSize",i,s),this.mf()){const n=this.part;n!==null&&this.Eh(n,"height")}}}get minSize(){return this.w!==null?this.w.Cr:_.bc}set minSize(e){const t=this.minSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e.k(),this.Yt().Cr=e,this.c(),this.t("minSize",t,e))}get maxSize(){return this.w!==null?this.w.Lr:_.DP}set maxSize(e){const t=this.maxSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=1/0),isNaN(e.height)&&(e.height=1/0),e.k(),this.Yt().Lr=e,this.c(),this.t("maxSize",t,e))}get measuredBounds(){return this.hi}get naturalBounds(){return this.Ke}jp(){return 0}get margin(){return this.sl}set margin(e){typeof e=="number"&&(e=new ct(e));const t=this.sl;t.equals(e)||(e=e.N(),this.sl=e,this.c(),this.t("margin",t,e))}get v(){return this.B1()===!0&&this.R1(),this.il}get Js(){return this.Hp()===!0&&this.R1(),this.wa}trigger(e,t,i){let s=null;return typeof e=="string"?s=new ur(e,t,i):s=e,s.Ti=this,this.Ds===null&&(this.Ds=new nt),this.Ds.set(s.propertyName,s),this}get Ds(){return this.w!==null?this.w.Ds:null}set Ds(e){this.Ds!==e&&(this.Yt().Ds=e)}get Nr(){return this.w!==null?this.w.Nr:0}set Nr(e){this.Nr!==e&&(this.Yt().Nr=e)}get alignment(){return this.de}set alignment(e){const t=this.alignment;t.equals(e)||(e.isNoSpot()&&!e.isDefault()&&r.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+e),e=e.N(),this.de=e,this.Pf(),this.t("alignment",t,e))}get column(){return this.pa}set column(e){e=Math.round(e);const t=this.column;t!==e&&(e<0&&r.J(e,">= 0",ne,"column"),this.pa=e,this.c(),this.t("column",t,e),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.w!==null?this.w.o0:1}set columnSpan(e){e=Math.round(e);const t=this.columnSpan;t!==e&&(e<1&&r.J(e,">= 1",ne,"columnSpan"),this.Yt().o0=e,this.c(),this.t("columnSpan",t,e))}get row(){return this.Xp}set row(e){e=Math.round(e);const t=this.row;t!==e&&(e<0&&r.J(e,">= 0",ne,"row"),this.Xp=e,this.c(),this.t("row",t,e),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.w!==null?this.w.r0:1}set rowSpan(e){e=Math.round(e);const t=this.rowSpan;t!==e&&(e<1&&r.J(e,">= 1",ne,"rowSpan"),this.Yt().r0=e,this.c(),this.t("rowSpan",t,e))}get spanAllocation(){return this.w!==null?this.w.l0:null}set spanAllocation(e){const t=this.spanAllocation;t!==e&&(e!==null&&r.S(e,ne,"spanAllocation"),this.Yt().l0=e,this.c(),this.t("spanAllocation",t,e))}get alignmentFocus(){return this.wd}set alignmentFocus(e){const t=this.alignmentFocus;t.equals(e)||(e=e.N(),this.wd=e,this.c(),this.t("alignmentFocus",t,e))}get portId(){return this.zp}set portId(e){const t=this.portId;if(t!==e){const i=this.part;i!==null&&!(i instanceof wt)&&r.o("Cannot set portID on a Link: "+e);const s=i;t!==null&&s!==null&&s.FN(this),this.zp=e,e!==null&&s!==null&&(s.Ln=!0,s.sD(this)),this.t("portId",t,e)}}Bh(){const e=this.part;if(e instanceof wt&&(this.portId!==null||this===e.port)){const t=e.diagram;t!==null&&!t.undoManager.isUndoingRedoing&&e.invalidateConnectedLinks(void 0,this)}}iD(){const e=this.diagram;e===null||e.undoManager.isUndoingRedoing||(this instanceof Lt?this instanceof wt?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Bh()}):this.Bh())}get toSpot(){return this.ft!==null?this.ft.vh:X.None}set toSpot(e){const t=this.toSpot;t.equals(e)||(e=e.N(),this.Ji().vh=e,this.t("toSpot",t,e),this.Bh())}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:10}set toEndSegmentLength(e){const t=this.toEndSegmentLength;t!==e&&(e<0&&r.J(e,">= 0",ne,"toEndSegmentLength"),this.Ji().Rh=e,this.t("toEndSegmentLength",t,e),this.Bh())}get toShortLength(){return this.ft!==null?this.ft.Ih:0}set toShortLength(e){const t=this.toShortLength;t!==e&&(this.Ji().Ih=e,this.t("toShortLength",t,e),this.Bh())}get toLinkable(){return this.ft!==null?this.ft.a0:null}set toLinkable(e){const t=this.toLinkable;t!==e&&(this.Ji().a0=e,this.t("toLinkable",t,e))}get toMaxLinks(){return this.ft!==null?this.ft.h0:1/0}set toMaxLinks(e){const t=this.toMaxLinks;t!==e&&(e<0&&r.J(e,">= 0",ne,"toMaxLinks"),this.Ji().h0=e,this.t("toMaxLinks",t,e))}get fromSpot(){return this.ft!==null?this.ft.Dh:X.None}set fromSpot(e){const t=this.fromSpot;t.equals(e)||(e=e.N(),this.Ji().Dh=e,this.t("fromSpot",t,e),this.Bh())}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:10}set fromEndSegmentLength(e){const t=this.fromEndSegmentLength;t!==e&&(e<0&&r.J(e,">= 0",ne,"fromEndSegmentLength"),this.Ji().Fh=e,this.t("fromEndSegmentLength",t,e),this.Bh())}get fromShortLength(){return this.ft!==null?this.ft.Oh:0}set fromShortLength(e){const t=this.fromShortLength;t!==e&&(this.Ji().Oh=e,this.t("fromShortLength",t,e),this.Bh())}get fromLinkable(){return this.ft!==null?this.ft.c0:null}set fromLinkable(e){const t=this.fromLinkable;t!==e&&(this.Ji().c0=e,this.t("fromLinkable",t,e))}get fromMaxLinks(){return this.ft!==null?this.ft.f0:1/0}set fromMaxLinks(e){const t=this.fromMaxLinks;t!==e&&(e<0&&r.J(e,">= 0",ne,"fromMaxLinks"),this.Ji().f0=e,this.t("fromMaxLinks",t,e))}get cursor(){return this.w!==null?this.w.Il:""}set cursor(e){const t=this.cursor;t!==e&&(r.s(e,"string",ne,"cursor"),this.Yt().Il=e,this.t("cursor",t,e))}get click(){return this.w!==null?this.w.Ur:null}set click(e){const t=this.click;t!==e&&(e!==null&&r.S(e,ne,"click"),this.Yt().Ur=e,this.t("click",t,e))}get doubleClick(){return this.w!==null?this.w.Vr:null}set doubleClick(e){const t=this.doubleClick;t!==e&&(e!==null&&r.S(e,ne,"doubleClick"),this.Yt().Vr=e,this.t("doubleClick",t,e))}get contextClick(){return this.w!==null?this.w.Br:null}set contextClick(e){const t=this.contextClick;t!==e&&(e!==null&&r.S(e,ne,"contextClick"),this.Yt().Br=e,this.t("contextClick",t,e))}get mouseEnter(){return this.w!==null?this.w.Kr:null}set mouseEnter(e){const t=this.mouseEnter;t!==e&&(e!==null&&r.S(e,ne,"mouseEnter"),this.Yt().Kr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.w!==null?this.w.Hr:null}set mouseLeave(e){const t=this.mouseLeave;t!==e&&(e!==null&&r.S(e,ne,"mouseLeave"),this.Yt().Hr=e,this.t("mouseLeave",t,e))}get mouseOver(){return this.w!==null?this.w.zr:null}set mouseOver(e){const t=this.mouseOver;t!==e&&(e!==null&&r.S(e,ne,"mouseOver"),this.Yt().zr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.w!==null?this.w.Xr:null}set mouseHover(e){const t=this.mouseHover;t!==e&&(e!==null&&r.S(e,ne,"mouseHover"),this.Yt().Xr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.w!==null?this.w.Gr:null}set mouseHold(e){const t=this.mouseHold;t!==e&&(e!==null&&r.S(e,ne,"mouseHold"),this.Yt().Gr=e,this.t("mouseHold",t,e))}get mouseDragEnter(){return this.w!==null?this.w.u0:null}set mouseDragEnter(e){const t=this.mouseDragEnter;t!==e&&(e!==null&&r.S(e,ne,"mouseDragEnter"),this.Yt().u0=e,this.t("mouseDragEnter",t,e))}get mouseDragLeave(){return this.w!==null?this.w.d0:null}set mouseDragLeave(e){const t=this.mouseDragLeave;t!==e&&(e!==null&&r.S(e,ne,"mouseDragLeave"),this.Yt().d0=e,this.t("mouseDragLeave",t,e))}get mouseDrop(){return this.w!==null?this.w.Yr:null}set mouseDrop(e){const t=this.mouseDrop;t!==e&&(e!==null&&r.S(e,ne,"mouseDrop"),this.Yt().Yr=e,this.t("mouseDrop",t,e))}get actionDown(){return this.w!==null?this.w.g0:null}set actionDown(e){const t=this.actionDown;t!==e&&(e!==null&&r.S(e,ne,"actionDown"),this.Yt().g0=e,this.t("actionDown",t,e))}get actionMove(){return this.w!==null?this.w.m0:null}set actionMove(e){const t=this.actionMove;t!==e&&(e!==null&&r.S(e,ne,"actionMove"),this.Yt().m0=e,this.t("actionMove",t,e))}get actionUp(){return this.w!==null?this.w.p0:null}set actionUp(e){const t=this.actionUp;t!==e&&(e!==null&&r.S(e,ne,"actionUp"),this.Yt().p0=e,this.t("actionUp",t,e))}get actionCancel(){return this.w!==null?this.w.y0:null}set actionCancel(e){const t=this.actionCancel;t!==e&&(e!==null&&r.S(e,ne,"actionCancel"),this.Yt().y0=e,this.t("actionCancel",t,e))}get toolTip(){return this.w!==null?this.w.jr:null}set toolTip(e){const t=this.toolTip;t!==e&&(this.Yt().jr=e,this.t("toolTip",t,e))}get contextMenu(){return this.w!==null?this.w.qr:null}set contextMenu(e){const t=this.contextMenu;t!==e&&(this.Yt().qr=e,this.t("contextMenu",t,e))}findBindingPanel(){let e=this instanceof Lt?this:this.panel;for(;e!==null;){if(e.RN())return e;e=e.panel}return null}bind(e,t,i,s){return this.Sf(e,t,i,s),this}bindTwoWay(e,t,i,s){return this.Sf(e,t,i,s).makeTwoWay(),this}bindModel(e,t,i,s){return this.Sf(e,t,i,s).ofModel(),this}bindObject(e,t,i,s,n){return this.Sf(e,t,i,s).ofObject(n),this}theme(e,t,i,s,n){return this.Na(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.Na(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.Na(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.Na(e,t,i,s,n).ofModel(),this}Sf(e,t,i,s){let n=null;return typeof e=="string"?n=new Qs(e,t,i,s):n=e,this.w0(n),n}Na(e,t,i,s,n){let o=null;return typeof e=="string"?o=new So(e,t,i,s,n):o=e,this.w0(o),o}w0(e){e.Ti=this;const t=this.findBindingPanel();t!==null&&t.nD()&&r.o("Cannot add a Binding to a template that has already been copied: "+e),this.ve===null&&(this.ve=new E),this.ve.add(e)}set(e){return e?(Object.assign(this,e),this):this}attach(e){return ne.ON(this,e),this}apply(e,...t){return e.apply(this,[this,...t]),this}setProperties(e){return qt.Ap(this,e),this}static make(e,...t){let i=arguments,s=null,n=null;if(r.st(e))n=e;else if(typeof e=="string"){const a=ne.z1.get(e);r.st(a)?(i=Array.prototype.slice.call(i),s=a(i),r.$(s)||r.o('GraphObject.make invoked object builder "'+e+'", but it did not return an Object')):n=c.go[e]}s===null&&((n==null||!n.constructor)&&r.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+e),s=new n);let o=1;if(s instanceof qt&&i.length>1){const a=s,l=i[1];(typeof l=="string"||l instanceof HTMLDivElement)&&(a.p2(l),o++)}for(let a=o;a<i.length;a++){const l=i[a];l===void 0?r.o("Undefined value at argument "+a+" for object being constructed by GraphObject.make: "+s):s&&ne.ON(s,l)}return s}static ON(e,t){if(typeof t=="number")ne.pI(e,t);else if(typeof t=="string")ne.yI(e,t);else if(t instanceof ne)e instanceof Lt||r.o("A GraphObject can only be added to a Panel, not to: "+e),e.add(t);else if(t instanceof ai){let i=null;t.isRow&&r.st(e.getRowDefinition)?i=e.getRowDefinition(t.index):!t.isRow&&r.st(e.getColumnDefinition)&&(i=e.getColumnDefinition(t.index)),i instanceof ai?i.X1(t):r.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(t instanceof le){const i=e;i.type=t}else if(t instanceof Qs)e instanceof ne||e instanceof ai?e.bind(t):r.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(t instanceof ur)e instanceof ne?e.trigger(t):r.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(t instanceof Z)e instanceof It&&e.type===4?e.figures.add(t):r.o("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(t instanceof et)e instanceof Z?e.segments.add(t):r.o("A PathSegment can only be added to a PathFigure, not to: "+e);else if(t instanceof bi)e instanceof qt||e instanceof Ft?e.layout=t:r.o("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];ne.ON(e,s)}else r.$(t)?ne.wI(e,t):r.o('Unknown initializer "'+t+'" for object being constructed by GraphObject.make: '+e)}static yI(e,t){if(e instanceof Se)e.text=t;else if(e instanceof Xt)e.figure=t;else if(e instanceof cs)e.source=t;else if(e instanceof Lt){const i=le.fs.get(t);i!==null&&(e.type=i)}else if(e instanceof me){const i=r.$a(bn,t);i!==null?e.type=i:r.o("Unknown Brush type as an argument to GraphObject.make: "+t)}else if(e instanceof It){const i=r.$a(se,t);i!==null&&(e.type=i)}else if(e instanceof et){const i=r.$a(Pt,t);i!==null&&(e.type=i)}}static pI(e,t){r.st(e.fe)?e.fe(t):r.dr(e,t)}static wI(e,t){if(e instanceof me){const i=new g;for(const s in t){const n=parseFloat(s);isNaN(n)?i[s]=t[s]:e.addColorStop(n,t[s])}qt.Ap(e,i)}else if(e instanceof ai){if(t.row!==void 0){const s=t.row;(s==null||s===1/0||isNaN(s)||s<0)&&r.o("Must specify non-negative integer row for RowColumnDefinition "+t+", not: "+s),e.isRow=!0,e.index=s}else if(t.column!==void 0){const s=t.column;(s==null||s===1/0||isNaN(s)||s<0)&&r.o("Must specify non-negative integer column for RowColumnDefinition "+t+", not: "+s),e.isRow=!1,e.index=s}const i=new g;for(const s in t)s==="row"||s==="column"||(i[s]=t[s]);qt.Ap(e,i)}else qt.Ap(e,t)}static build(e,t,...i){const s=ne.z1.get(e);if(r.st(s)){const n=s([e].concat(i));if(n instanceof ne)return t&&n.setProperties(t),n}r.o('GraphObject.build invoked object builder "'+e+'", but it did not return an Object')}static defineBuilder(e,t){r.s(e,"string",ne,"defineBuilder:name"),r.S(t,ne,"defineBuilder:func"),e.toLowerCase(),ne.z1.set(e,t)}static isBuilderDefined(e){return ne.z1.has(e)}static takeBuilderArgument(e,t,i){i===void 0&&(i=null);const s=e[1];return(r.st(i)?i(s):typeof s=="string")?(e.splice(1,1),s):(t===void 0&&r.o("no "+(r.st(i)?"satisfactory":"string")+" argument for GraphObject builder "+e[0]),t)}};y(ne,"None",0),y(ne,"Default",1),y(ne,"Fill",2),y(ne,"Vertical"),y(ne,"Horizontal"),y(ne,"Uniform",6),y(ne,"UniformToFill",7),y(ne,"FlipVertical",1),y(ne,"FlipHorizontal",2),y(ne,"FlipBoth",3),y(ne,"z1",new nt);let Ht=ne;Ht.Vertical=4,Ht.Horizontal=5,Ht.defineBuilder("Button",M=>{const e="#f5f5f5",t="#737373",i="#d4d4d4",s="#737373",n="#a3a3a3",o=2.76142374915397,a=2.761423749153969,l=new Lt(Lt.Auto,{isActionable:!0,enabledChanged:(h,d)=>{if(h instanceof Lt){const f=h.findObject("ButtonBorder");if(f!==null)if(h._buttonFillNormal===void 0&&(h._buttonFillNormal=f.fill),d){let m=null;h.layer!==null&&h.diagram!==null&&h.isVisibleObject()&&(m=h.layer.findObjectAt(h.diagram.lastInput.documentPoint)),m===h||m!==null&&m.isContainedBy(h)?f.fill=h._buttonFillOver:f.fill=h._buttonFillNormal}else f.fill=h._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:i,_buttonStrokeOver:s,_buttonFillDisabled:n}).add(new Xt("RoundedRectangle",{name:"ButtonBorder",spot1:new X(0,0,o,a),spot2:new X(1,1,-o,-a),parameter1:2,fill:e,stroke:t}));return l.mouseEnter=(h,d,f)=>{if(!d.isEnabledObject()||!(d instanceof Lt))return;const m=d.findObject("ButtonBorder");m instanceof Xt&&(d._buttonFillNormal===void 0&&(d._buttonFillNormal=m.fill),m.fill=d._buttonFillOver,d._buttonStrokeNormal===void 0&&(d._buttonStrokeNormal=m.stroke),m.stroke=d._buttonStrokeOver)},l.mouseLeave=(h,d,f)=>{if(!d.isEnabledObject()||!(d instanceof Lt))return;const m=d.findObject("ButtonBorder");m instanceof Xt&&(d._buttonFillNormal!==void 0&&(m.fill=d._buttonFillNormal),d._buttonStrokeNormal!==void 0&&(m.stroke=d._buttonStrokeNormal))},l}),Ht.defineBuilder("TreeExpanderButton",M=>{const e=Ht.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new Xt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:_.Su}).bindObject("figure","isTreeExpanded",(t,i)=>{const s=i.panel;return t?s._treeExpandedFigure:s._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,i)=>{let s=i.part;if(s instanceof Jt&&(s=s.adornedPart),!(s instanceof wt))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;t.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},e}),Ht.defineBuilder("SubGraphExpanderButton",M=>{const e=Ht.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new Xt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:_.Su}).bindObject("figure","isSubGraphExpanded",(t,i)=>{const s=i.panel;return t?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),e.click=(t,i)=>{let s=i.part;if(s instanceof Jt&&(s=s.adornedPart),!(s instanceof Ft))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;t.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},e}),Ht.defineBuilder("ToolTip",M=>new Jt(Lt.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new L(0,2),mouseOver:(e,t)=>{const i=e.diagram.toolManager;i.extendToolTip(i.toolTipDuration)}}).add(new Xt("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new X(0,0,4,6),spot2:new X(1,1,-4,-4)}))),Ht.defineBuilder("ContextMenu",M=>new Jt(Lt.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new L(0,2)}).bindObject("background","",e=>e.adornedPart!==null&&e.hasPlaceholder()?null:"#f5f5f5")),Ht.defineBuilder("ContextMenuButton",M=>{const e=Ht.build("Button");e.stretch=5;const t=e.findObject("ButtonBorder");return t instanceof Xt&&(t.figure="Rectangle",t.strokeWidth=0,t.spot1=new X(0,0,4,6),t.spot2=new X(1,1,-4,-4)),e}),Ht.defineBuilder("PanelExpanderButton",M=>{const e=Ht.takeBuilderArgument(M,"COLLAPSIBLE"),t=Ht.build("Button");t.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),t.add(new Xt({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?t._buttonExpandedFigure:t._buttonCollapsedFigure,void 0,e));const i=t.findObject("ButtonBorder");return i instanceof Xt&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),t.click=(s,n)=>{if(!(n instanceof Lt))return;const o=n.diagram;if(o===null||o.isReadOnly)return;let a=n.findBindingPanel();if(a===null&&(a=n.part),a!==null){const l=a.findObject(e);l!==null&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),l.visible=!l.visible,o.commitTransaction("Collapse/Expand Panel"))}},t}),Ht.defineBuilder("CheckBoxButton",M=>{const e=Ht.takeBuilderArgument(M),t=Ht.build("Button",{desiredSize:new _(14,14)});t.attach({"ButtonBorder.spot1":new X(0,0,1,1),"ButtonBorder.spot2":new X(1,1,-1,-1)});const i=new Xt({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return e!==""&&i.bindTwoWay("visible",e),t.add(i),t.click=(s,n)=>{if(!(n instanceof Lt))return;const o=s.diagram;if(o===null||o.isReadOnly||e!==""&&o.model.isReadOnly)return;s.handled=!0;const a=n.findObject("ButtonIcon");o.startTransaction("checkbox"),a!==null&&(a.visible=!a.visible),r.st(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},t}),Ht.defineBuilder("CheckBox",M=>{const e=Ht.takeBuilderArgument(M),t=Ht.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new ct(0,1,0,0)},e),i=new Lt("Horizontal",{isActionable:!0,cursor:t.cursor,margin:new ct(1),mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonFillNormal:t._buttonFillNormal,_buttonStrokeNormal:t._buttonStrokeNormal,_buttonFillOver:t._buttonFillOver,_buttonStrokeOver:t._buttonStrokeOver,_buttonFillDisabled:t._buttonFillDisabled,_buttonClick:t.click});return i.add(t),t.mouseEnter=null,t.mouseLeave=null,t.click=null,i}),Ht.defineBuilder("AutoRepeatButton",M=>{const e=Ht.takeBuilderArgument(M,50,a=>typeof a=="number"),t=Ht.takeBuilderArgument(M,500,a=>typeof a=="number");function i(a,l){n(a,l),l.click&&(l.Nd=r.dn(()=>s(a,l),t))}function s(a,l){l.Nd&&r.wc(l.Nd),l.click&&(l.Nd=r.dn(()=>{l.click&&(l.click(a,l),s(a,l))},e))}function n(a,l){l.Nd&&(r.wc(l.Nd),l.Nd=void 0)}const o=Ht.build("Button");return o.actionDown=(a,l)=>i(a,l),o.actionUp=(a,l)=>n(a,l),o.actionCancel=(a,l)=>n(a,l),o}),Ht.defineBuilder("ToggleSwitch",function(M){const e=Ht.takeBuilderArgument(M);e||r.o("ToggleSwitch must be data-bound to a property name, not: "+e);const t=Ht.takeBuilderArgument(M,!1,a=>typeof a=="boolean"),i="gray",s="transparent",n="white",o=new Lt("Auto",{width:t?15:28,height:t?28:15}).attach({_buttonFillOff:i,_buttonBorderOff:s,_buttonIconFillOff:n,_buttonFillOn:"green",_buttonBorderOn:"transparent",_buttonIconFillOn:"white"}).add(new Xt("Capsule",{name:"ButtonBorder",fill:i,stroke:s,strokeWidth:1}).bind("fill",e,(a,l)=>a?l.panel._buttonFillOn:l.panel._buttonFillOff).bind("stroke",e,(a,l)=>a?l.panel._buttonBorderOn:l.panel._buttonBorderOff)).add(new Xt("Circle",{name:"ButtonIcon",width:11,height:11,fill:n,stroke:null,alignment:t?X.Bottom:X.Left}).bind("fill",e,(a,l)=>a?l.panel._buttonIconFillOn:l.panel._buttonIconFillOff).bind("alignment",e,a=>a?t?X.Top:X.Right:t?X.Bottom:X.Left));return o.click=function(a,l){if(!l.isEnabledObject())return;const h=a.diagram;if(h===null||h.isReadOnly||e!==""&&h.model.isReadOnly)return;a.handled=!0;const d=l.findBindingPanel();d!==null&&(h.startTransaction("toggle switch"),h.model.set(d.data,e,!d.data[e]),typeof l._doClick=="function"&&l._doClick(a,l),h.commitTransaction("toggle switch"))},o}),Ht.defineBuilder("Toggle",function(M){const e=Ht.takeBuilderArgument(M),t=Ht.build("ToggleSwitch",{name:"Button"},e),i=new Lt("Horizontal",{cursor:t.cursor,margin:1,mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonClick:t.click}).add(t);return t.mouseEnter=null,t.mouseLeave=null,t.click=null,i});class Un{constructor(){y(this,"me");y(this,"Pt");y(this,"oo");y(this,"ve");y(this,"ro");y(this,"vs");y(this,"Il");y(this,"Ur");y(this,"Vr");y(this,"Br");y(this,"Kr");y(this,"Hr");y(this,"zr");y(this,"Xr");y(this,"Gr");y(this,"u0");y(this,"d0");y(this,"Yr");y(this,"g0");y(this,"m0");y(this,"p0");y(this,"y0");y(this,"jr");y(this,"qr");y(this,"Zp");y(this,"l0");y(this,"Ds");y(this,"Cr");y(this,"Lr");y(this,"ho");y(this,"r0");y(this,"o0");y(this,"Nr");y(this,"Jp");y(this,"x0");y(this,"b0");this.me=!1,this.Pt="",this.oo=-1,this.ve=null,this.ro=null,this.vs=null,this.Il="",this.Ur=null,this.Vr=null,this.Br=null,this.Kr=null,this.Hr=null,this.zr=null,this.Xr=null,this.Gr=null,this.u0=null,this.d0=null,this.Yr=null,this.g0=null,this.m0=null,this.p0=null,this.y0=null,this.jr=null,this.qr=null,this.Zp=null,this.l0=null,this.Ds=null,this.Cr=_.bc,this.Lr=_.DP,this.ho=1,this.r0=1,this.o0=1,this.Nr=0,this.Jp=null,this.x0=null,this.b0="category"}copy(){const e=new Un;return e.Pt=this.Pt,e.oo=this.oo,e.ve=this.ve,e.vs=this.vs,e.Il=this.Il,e.Ur=this.Ur,e.Vr=this.Vr,e.Br=this.Br,e.Kr=this.Kr,e.Hr=this.Hr,e.zr=this.zr,e.Xr=this.Xr,e.Gr=this.Gr,e.u0=this.u0,e.d0=this.d0,e.Yr=this.Yr,e.g0=this.g0,e.m0=this.m0,e.p0=this.p0,e.y0=this.y0,e.jr=this.jr,e.qr=this.qr,e.Zp=this.Zp,e.l0=this.l0,e.Ds=this.Ds,e.Cr=this.Cr.N(),e.Lr=this.Lr.N(),e.ho=this.ho,e.r0=this.r0,e.o0=this.o0,e.Nr=this.Nr,e.Jp=this.Jp,e.x0=this.x0,e.b0=this.b0,e}}class da{constructor(){y(this,"m");this.m=[1,0,0,1,0,0]}copy(){const e=new da;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}rotate(e,t,i){if(e=B.Ee(e),e===0)return;this.translate(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const d=e*Math.PI/180;s=Math.cos(d),n=Math.sin(d)}const o=this.m[0]*s+this.m[2]*n,a=this.m[1]*s+this.m[3]*n,l=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=a,this.m[2]=l,this.m[3]=h,this.translate(-t,-i)}}class fr{constructor(e){y(this,"type");y(this,"x1");y(this,"y1");y(this,"r1");y(this,"x2");y(this,"y2");y(this,"r2");y(this,"colors");y(this,"pattern");this.type=e,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(e,t){this.colors.push({offset:e,color:t})}}class gr{constructor(e,t,i){y(this,"bt");y(this,"_t");y(this,"el");y(this,"ud");y(this,"IN");const s=t===void 0?c.document:t;this.el=s,this.IN="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.bt.setAttributeNS(n,"xmlns",this.IN),this.bt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ud=null,this._t=new Ri(this,i)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",this.bt.setAttributeNS(null,"width",i+"px"),this.bt.setAttributeNS(null,"height",s+"px"),this.bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._t.EN.firstElementChild.setAttributeNS(null,"width",i+"px"),this._t.EN.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(e,t,i){const s=this.el.createElementNS(this.IN,e);if(r.$(t))for(const n in t)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,t[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return parseInt(this.bt.getAttribute("width")||"1")}set width(e){this.bt.setAttribute("width",e+"px")}get height(){return parseInt(this.bt.getAttribute("height")||"1")}set height(e){this.bt.setAttribute("height",e+"px")}dispose(){this.el=null}get style(){return this.bt.style}}class Ri{constructor(e,t){y(this,"Mf");y(this,"Nf");y(this,"An");y(this,"Fe");y(this,"Zi");y(this,"fillStyle");y(this,"font");y(this,"globalAlpha");y(this,"lineCap");y(this,"lineDashOffset");y(this,"lineJoin");y(this,"lineWidth");y(this,"miterLimit");y(this,"shadowBlur");y(this,"shadowColor");y(this,"shadowOffsetX");y(this,"shadowOffsetY");y(this,"strokeStyle");y(this,"textAlign");y(this,"imageSmoothingEnabled");y(this,"clipInsteadOfFill");y(this,"lastCreatedElement");y(this,"Cf");y(this,"Lf");y(this,"surface");y(this,"svg");y(this,"EN");y(this,"oD");y(this,"G1");y(this,"Wo");y(this,"Ca");y(this,"zh");y(this,"currentElement");y(this,"clipPathGroup");y(this,"diagramGroup");y(this,"lastDrawnPart");y(this,"currentPath");y(this,"outerGroup");y(this,"pathAttributes");y(this,"rl");y(this,"Fr");y(this,"filter");y(this,"letterSpacing");y(this,"wordSpacing");y(this,"partClipRect");if(this.surface=e,this.svg=e.bt,this.Cf=[],this.Lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.rl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.lastCreatedElement=null,this.currentElement=null,this.Fe=[],this.pathAttributes={},this.G1=!1,this.Wo=null,this.Ca=0,this.oD={},this.Fr=!!t,this.filter="",this.partClipRect=null,this.Zi=new da,this.letterSpacing="0px",this.wordSpacing="0px",e.el===null||e.el===void 0)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=F.Ww++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:e.width,height:e.height};s.appendChild(this.makeElement("rect",n)),this.EN=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")")}setDiagramPosScale(e,t,i,s,n,o){this.diagramGroup===void 0?this.newGroup(e,t,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+e+", "+t+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(e,t,i,s,n,o,a,l){const h=2*Math.PI,d=1e-6,f=h-d,m=i*Math.cos(s),p=i*Math.sin(s),b=e+m,x=t+p,v=o?0:1;let S=o?s-n:n-s;(Math.abs(a-b)>d||Math.abs(l-x)>d)&&this.Fe.push(["L",b,+x]),S<0&&(S=S%h+h),S>f?(this.Fe.push(["A",i,i,0,1,v,e-m,t-p]),this.Fe.push(["A",i,i,0,1,v,b,x])):S>d&&this.Fe.push(["A",i,i,0,+(S>=Math.PI),v,e+i*Math.cos(n),t+i*Math.sin(n)])}beginPath(){this.Fe=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(e){this.xI(this.Fe,this.Zi,e||0)}bezierCurveTo(e,t,i,s,n,o){this.Fe.push(["C",e,t,i,s,n,o])}clearRect(e,t,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Fe.push(["z"])}createLinearGradient(e,t,i,s){const n=new fr("linear");return n.x1=e,n.y1=t,n.x2=i,n.y2=s,n}createPattern(e,t){let i="";e instanceof HTMLCanvasElement&&(i=e.toDataURL()),e instanceof HTMLImageElement&&(i=e.getAttribute("src"));const s=this.oD;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+F.Ww++,o={width:e.width,height:e.height,id:n,patternUnits:"userSpaceOnUse"},a={x:0,y:0,width:e.width,height:e.height,href:i},l=this.makeElement("pattern",o);return l.appendChild(this.makeElement(qt.img,a)),this.svg.appendChild(l),s[i]=n,"url(#"+n+")"}createRadialGradient(e,t,i,s,n,o){const a=new fr("radial");return a.x1=e,a.y1=t,a.r1=i,a.x2=s,a.y2=n,a.r2=o,a}amendImageTransform(e,t,i,s,n,o,a,l){const h=a/i,d=l/s;(n!==0||o!==0)&&this.Zi.translate(n,o),(h!==1||d!==1)&&this.Zi.scale(h,d),(e!==0||t!==0)&&this.Zi.translate(-e,-t)}drawImage(e,t,i,s,n,o,a,l,h){let d="",f=e.width,m=e.height;typeof e.toDataURL=="function"?e.toDataURL():(d=e.getAttribute("src"),f=e.naturalWidth,m=e.naturalHeight),s===void 0&&(o=t,a=i,l=s=f,h=n=m),s=s||0,n=n||0,o=o||0,a=a||0,l=l||0,h=h||0,this.amendImageTransform(t,i,s,n,o,a,l,h);const p={x:0,y:0,width:f||s,height:m||n,href:d};!B.X(s,l)||!B.X(n,h)?p.preserveAspectRatio="none":d.toLowerCase().indexOf(".svg")===-1&&d.toLowerCase().indexOf("data:image/svg")===-1&&(p.preserveAspectRatio="xMidYMid slice"),(t!==0||i!==0||s!==f||n!==m)&&(s+=t,n+=i,p["clip-path"]=`path('M ${t},${i} L ${s} ${i} L ${s} ${n} L ${t} ${n} z')`),this.processCommon(qt.img,p,this.Zi),this.Cd(qt.img,p)}fill(e,t){e&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(e,t,i){this.clipInsteadOfFill?this.clip():this.fill(t,i)}createOrUpdateClipGroup(e,t){const i=this.newGroup(1,0,0,1,-t.x,-t.y);i.setAttributeNS(null,"class","spotClip"),e.xa=i}fillRect(e,t,i,s){this.addRect("fill",[e,t,i,s],this.Zi)}fillBackground(e,t,i,s){const n={x:e,y:t,width:i,height:s};this.processCommon("fill",n,this.Zi),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(e,t,i){this.addText("fill",[e,t,i],this.Zi)}lineTo(e,t){this.Fe.push(["L",e,t])}moveTo(e,t){this.Fe.push(["M",e,t])}quadraticCurveTo(e,t,i,s){this.Fe.push(["Q",e,t,i,s])}rect(e,t,i,s){this.Fe.push(["M",e,t],["L",e+i,t],["L",e+i,t+s],["L",e,t+s],["z"])}restore(){this.Zi=this.Cf.pop(),this.Fe=this.Cf.pop();const e=this.Cf.pop();this.fillStyle=e.fillStyle,this.font=e.font,this.globalAlpha=e.globalAlpha,this.lineCap=e.lineCap,this.lineDashOffset=e.lineDashOffset,this.lineJoin=e.lineJoin,this.lineWidth=e.lineWidth,this.miterLimit=e.miterLimit,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.strokeStyle=e.strokeStyle,this.textAlign=e.textAlign,this.partClipRect=e.partClipRect,this.letterSpacing=e.letterSpacing,this.wordSpacing=e.wordSpacing}save(){const e={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.Cf.push(e);const t=[];for(let i=0;i<this.Fe.length;i++)t.push(this.Fe[i]);this.Cf.push(t),this.Cf.push(this.Zi.copy())}setTransform(e,t,i,s,n,o){e===1&&t===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(e,t,i,s,n,o)}setCurrentTransform(e,t,i,s,n,o){this.Zi.m=[e,t,i,s,n,o]}getCurrentTransform(){const e=this.Zi.m;return"matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}scale(e,t){this.Zi.scale(e,t)}translate(e,t){this.Zi.translate(e,t)}transform(e,t,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(e,t,i,s){this.addRect("stroke",[e,t,i,s],this.Zi)}makeElement(e,t,i){return this.surface.makeElement(e,t,i)}Cd(e,t,i){const s=this.makeElement(e,t,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(e,t,i){if(e==="fill"?this.setFill(t):e==="stroke"&&this.setStroke(t),i!==null){const s=i.m;t.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(e){if(this.fillStyle instanceof fr){e.fill=this.addGradient(this.fillStyle,"fill");return}if(/^rgba\(/.test(this.fillStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.fill="rgb("+t[1]+","+t[2]+","+t[3]+")",e["fill-opacity"]=t[4]}else e.fill=this.fillStyle}setFillOrStrokeInPlace(e,t){const i=t?"fill":"stroke";if(this.fillStyle instanceof fr){e.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,i));return}if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),e.setAttributeNS(null,i+"-opacity",s[4])}else e.setAttributeNS(null,i,this.fillStyle)}setStroke(e){if(this.strokeStyle instanceof fr)e.stroke=this.addGradient(this.strokeStyle,"stroke");else if(/^rgba\(/.test(this.strokeStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);e.stroke="rgb("+t[1]+","+t[2]+","+t[3]+")",e["stroke-opacity"]=t[4]}else e.stroke=this.strokeStyle;e["stroke-width"]=this.lineWidth,e["stroke-linecap"]=this.lineCap,e["stroke-linejoin"]=this.lineJoin,e["stroke-miterlimit"]=this.miterLimit,this.G1&&(e["stroke-dasharray"]=this.Wo.toString(),e["stroke-dashoffset"]=this.Ca)}addGradient(e,t){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(t):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const l=this.svg.getElementById(i);l!==null&&l.remove()}else i="GRAD"+F.Ww++;let n;if(e.type==="linear"){const l={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",l)}else if(e.type==="radial"){const l={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,r1:e.r1,r2:e.r2,id:i};n=this.makeElement("radialGradient",l)}else r.o("invalid gradient");const o=e.colors.sort((l,h)=>l.offset>h.offset?1:-1),a=o.length;for(let l=0;l<a;l++){const h=o[l],d=h.color;n.appendChild(this.makeElement("stop",{offset:h.offset,"stop-color":d}))}return this.svg.appendChild(n),"url(#"+i+")"}addRect(e,t,i){const s={x:t[0],y:t[1],width:t[2],height:t[3]};this.processCommon(e,s,i),this.Cd("rect",s)}addText(e,t,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:t[1],y:t[2],style:"font: "+this.font,"text-anchor":s};n["letter-spacing"]=this.letterSpacing,n["word-spacing"]=this.wordSpacing,this.processCommon(e,n,i),this.Cd("text",n,t[0])}xI(e,t,i){const s=this.bI(e),n=this.pathAttributes;if(n.clipPath){this.Lf.length>1&&this.Lf[this.Lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,t),this.currentPath!==null){const o=this.currentPath;if(o.nodeName!=="g")for(const a in n)a!=="transform"&&o.setAttributeNS(null,a,n[a]);else{const a=o.getElementsByTagName("path");for(const l in n)l!=="transform"&&a[i].setAttributeNS(null,l,n[l])}}else this.Cd("path",n)}bI(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());t.push(n.join(" "))}return t.join(" ")}newGroup(e,t,i,s,n,o){const a=new da;a.m=[e,t,i,s,n,o];const l={};this.processCommon("g",l,a);const h=this.Cd("g",l);return this.Lf.push(h),h}newGroup2(e){const t={};e&&(t.class=e);const i=this.Cd("g",t);return this.Lf.push(i),i}endGroup(){return this.Lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(e,t,i){this.Mf=e,this.Nf=t,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(e,t){this.G1=!0,this.Wo=e,this.Ca=t}disableDash(){this.G1=!1}clearContextCache(e){}setImageSmoothingEnabled(e){}rotate(e){this.Zi.rotate(e*57.2958,0,0)}getImageData(e,t,i,s){return null}measureText(e){return null}removeOldGradient(e,t,i){const s=t.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const a=new RegExp(o.id,"g");this.svg.innerHTML.match(a).length===1&&o.remove()}}removePartFromView(e){e.svg!==null&&e.svg.parentNode===this.diagramGroup&&e.svg.remove()}}class wn{constructor(e,t,i,s){y(this,"bt");y(this,"_t");y(this,"el");y(this,"ud");const n=t===void 0?c.document:t;this.el=n,this.ud=null;const o=n.createElement("canvas");o.tabIndex=0,this.bt=o,this._t=new mr(o,i,s),e&&qt.Wi.set(o,e)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(e,t){return this.bt.toDataURL(e,t)}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return this.bt.width}set width(e){this.bt.width=e}get height(){return this.bt.height}set height(e){this.bt.height=e}dispose(){qt.Wi.delete(this.bt),this.el=null}get style(){return this.bt.style}}const wa=class wa{constructor(e,t,i){y(this,"F");y(this,"Y1");y(this,"K1");y(this,"H1");y(this,"clipInsteadOfFill");y(this,"Mf");y(this,"Nf");y(this,"An");y(this,"zh");y(this,"rl");y(this,"Fr");e.getContext||r.o("Browser does not support HTML Canvas Element"),this.F=e.getContext("2d",t),this.Y1="",this.K1="",this.H1="",this.clipInsteadOfFill=!1,this.Mf=0,this.Nf=0,this.An=0,this.rl=!1,this.zh=new lt,this.Fr=!!i}createOrUpdateClipGroup(e,t){}setImageSmoothingEnabled(e){this.F.imageSmoothingEnabled=e}get fillStyle(){return this.F.fillStyle}set fillStyle(e){this.H1!==e&&(this.F.fillStyle=e,this.H1=e)}get font(){return this.F.font}set font(e){this.Y1!==e&&(this.F.font=e,this.Y1=e)}get globalAlpha(){return this.F.globalAlpha}set globalAlpha(e){this.F.globalAlpha=e}get lineCap(){return this.F.lineCap}set lineCap(e){this.F.lineCap=e}get lineDashOffset(){return this.F.lineDashOffset}set lineDashOffset(e){this.F.lineDashOffset=e}get lineJoin(){return this.F.lineJoin}set lineJoin(e){this.F.lineJoin=e}get lineWidth(){return this.F.lineWidth}set lineWidth(e){this.F.lineWidth=e}get miterLimit(){return this.F.miterLimit}set miterLimit(e){this.F.miterLimit=e}get shadowBlur(){return this.F.shadowBlur}set shadowBlur(e){this.F.shadowBlur=e}get shadowColor(){return this.F.shadowColor}set shadowColor(e){this.F.shadowColor=e}get shadowOffsetX(){return this.F.shadowOffsetX}set shadowOffsetX(e){this.F.shadowOffsetX=e}get shadowOffsetY(){return this.F.shadowOffsetY}set shadowOffsetY(e){this.F.shadowOffsetY=e}get strokeStyle(){return this.F.strokeStyle}set strokeStyle(e){this.K1!==e&&(this.F.strokeStyle=e,this.K1=e)}get textAlign(){return this.F.textAlign}set textAlign(e){this.F.textAlign=e}get imageSmoothingEnabled(){return this.F.imageSmoothingEnabled}set imageSmoothingEnabled(e){this.F.imageSmoothingEnabled=e}get filter(){return this.F.filter}set filter(e){e===""?this.F.filter="none":this.F.filter=e}get letterSpacing(){return this.F.letterSpacing}set letterSpacing(e){this.F.letterSpacing=e}get wordSpacing(){return this.F.wordSpacing}set wordSpacing(e){this.F.wordSpacing=e}arc(e,t,i,s,n,o,a,l){this.F.arc(e,t,i,s,n,o)}beginPath(){this.F.beginPath()}endPath(){}bezierCurveTo(e,t,i,s,n,o){this.F.bezierCurveTo(e,t,i,s,n,o)}clearRect(e,t,i,s){this.commitTransform(),this.F.clearRect(e,t,i,s)}clip(e){e?this.F.clip(e):this.F.clip()}closePath(){this.F.closePath()}createLinearGradient(e,t,i,s){return this.F.createLinearGradient(e,t,i,s)}createPattern(e,t){return this.F.createPattern(e,t)}createRadialGradient(e,t,i,s,n,o){return this.F.createRadialGradient(e,t,i,s,n,o)}drawImage(e,t,i,s,n,o,a,l,h){s===void 0?this.F.drawImage(e,t,i):this.F.drawImage(e,t,i,s,n,o,a,l,h)}fill(e,t){t?this.F.fill(t,e?"evenodd":"nonzero"):this.F.fill(e?"evenodd":"nonzero")}fillRect(e,t,i,s){this.F.fillRect(e,t,i,s)}fillBackground(e,t,i,s){this.F.fillRect(e,t,i,s)}fillText(e,t,i){this.F.fillText(e,t,i)}getImageData(e,t,i,s){return this.F.getImageData(e,t,i,s)}lineTo(e,t){this.F.lineTo(e,t)}measureText(e){return this.F.measureText(e)}moveTo(e,t){this.F.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this.F.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this.F.rect(e,t,i,s)}restore(){this.F.restore()}save(){this.commitTransform(),this.F.save()}rotate(e){this.zh.ks(e*57.2958,0,0)}setTransform(e,t,i,s,n,o){this.zh.setTo(e,t,i,s,n,o)}scale(e,t){this.zh.it(e,t)}translate(e,t){this.zh.Gs(e,t)}stroke(e){e?this.F.stroke(e):this.F.stroke()}transform(e,t,i,s,n,o){if(e===1&&t===0&&i===0&&s===1&&n===0&&o===0)return;const a=this.zh,l=a.m11*e+a.m21*t,h=a.m12*e+a.m22*t,d=a.m11*i+a.m21*s,f=a.m12*i+a.m22*s;a.dx=a.m11*n+a.m21*o+a.dx,a.dy=a.m12*n+a.m22*o+a.dy,a.m11=l,a.m12=h,a.m21=d,a.m22=f}commitTransform(){const e=this.zh;this.F.setTransform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy)}fillContext(e,t,i){this.radialFill(e,t,i)||this.fillOrClip(t,i)}radialFill(e,t,i){if(!(e instanceof me)||e.type!==3)return!1;const s=e.bf,n=e.V1;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(t,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(e,t){this.clipInsteadOfFill?this.clip(t):this.fill(e,t)}shadowsSet(e,t,i){this.Mf=e,this.Nf=t,this.An=i}shadowsOff(){this.rl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.rl=!0,this.shadowOffsetX=this.Mf,this.shadowOffsetY=this.Nf,this.shadowBlur=this.An}enableDash(e,t){const i=this.F;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}disableDash(){const e=this.F;e.setLineDash!==void 0&&(e.setLineDash(wa.EmptyArray),e.lineDashOffset=0)}clearContextCache(e){e&&(this.Y1=""),this.K1="",this.H1=""}removePartFromView(e){}};y(wa,"EmptyArray",Object.freeze([]));let mr=wa;var bn=(M=>(M[M.Solid=1]="Solid",M[M.Linear=2]="Linear",M[M.Radial=3]="Radial",M[M.Pattern=4]="Pattern",M))(bn||{}),Ku=(M=>(M[M.Lab=1]="Lab",M[M.HSL=2]="HSL",M[M.Oklch=3]="Oklch",M))(Ku||{});class bo{constructor(){y(this,"n0");y(this,"n1");y(this,"n2");y(this,"n3");this.n0=0,this.n1=0,this.n2=0,this.n3=0}}const Q=class Q{constructor(e,t){y(this,"f");y(this,"W");y(this,"Xh");y(this,"ae");y(this,"Cs");y(this,"k0");y(this,"P0");y(this,"Jo");y(this,"S0");y(this,"Cn");y(this,"bf");y(this,"V1");if(F.Je(this),this.f=!1,e===void 0)this.W=1,this.Xh="black";else if(typeof e=="string"){const s=r.$a(bn,e);s!==null?(this.W=s,this.Xh="black"):(this.W=1,this.Xh=e)}else Object.keys(bn).hasOwnProperty(e)?(this.W=e,this.Xh="black"):typeof e=="object"&&(this.W=1,t=e);const i=this.W;if(i===2?(this.ae=X.TopCenter,this.Cs=X.BottomCenter):i===3?(this.ae=X.Center,this.Cs=X.Center):(this.ae=X.None,this.Cs=X.None),this.k0=0,this.P0=NaN,this.Jo=null,this.S0=null,this.Cn=null,this.bf=0,this.V1=0,t){const s={};for(const n in t)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),t[n]):s[n]=t[n];Object.assign(this,s)}}copy(){const e=new Q;return e.W=this.W,e.Xh=this.Xh,e.ae=this.ae.N(),e.Cs=this.Cs.N(),e.k0=this.k0,e.P0=this.P0,this.Jo!==null&&(e.Jo=this.Jo.copy()),e.S0=this.S0,e}k(){return this.f=!0,this.Jo!==null&&this.Jo.k(),this}fe(e){e in bn?this.type=e:r.dr(this,e)}toString(){let e="Brush(";if(this.type===1)e+=this.color;else if(this.type===2?e+="Linear ":this.type===3?e+="Radial ":this.type===4?e+="Pattern ":e+="(unknown) ",e+=this.start+" "+this.end,this.colorStops!==null){const t=this.colorStops.iterator;for(;t.next();){const i=t.key,s=t.value;e+=" "+i+":"+s}}return e+=")",e}addColorStop(e,t){return this.f&&r.L(this),(typeof e!="number"||!isFinite(e)||e>1||e<0)&&r.J(e,"0 <= loc <= 1",Q,"addColorStop:loc"),r.s(t,"string",Q,"addColorStop:color"),this.Jo===null&&(this.Jo=new nt),this.Jo.set(e,t),this.W===1&&(this.type=2),this.Cn=null,this}get type(){return this.W}set type(e){this.f&&r.L(this,e),this.W=e,this.start.isNoSpot()&&(e===2?this.start=X.TopCenter:e===3&&(this.start=X.Center)),this.end.isNoSpot()&&(e===2?this.end=X.BottomCenter:e===3&&(this.end=X.Center)),this.Cn=null}get color(){return this.Xh}set color(e){this.f&&r.L(this,e),this.Xh=e,this.Cn=null}get start(){return this.ae}set start(e){this.f&&r.L(this,e),this.ae=e.N(),this.Cn=null}get end(){return this.Cs}set end(e){this.f&&r.L(this,e),this.Cs=e.N(),this.Cn=null}get startRadius(){return this.k0}set startRadius(e){this.f&&r.L(this,e),e<0&&r.J(e,">= zero",Q,"startRadius"),this.k0=e,this.Cn=null}get endRadius(){return this.P0}set endRadius(e){this.f&&r.L(this,e),e<0&&r.J(e,">= zero",Q,"endRadius"),this.P0=e,this.Cn=null}get colorStops(){return this.Jo}set colorStops(e){this.f&&r.L(this,e),this.Jo=e,this.Cn=null}get pattern(){return this.S0}set pattern(e){this.f&&r.L(this,e),this.S0=e,this.Cn=null}static randomColor(e,t){e===void 0&&(e=128),t===void 0&&(t=Math.max(e,255));const i=Math.abs(t-e);let s=Math.floor(e+Math.random()*i).toString(16),n=Math.floor(e+Math.random()*i).toString(16),o=Math.floor(e+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return c.CSS?c.CSS.supports("color",e):!0}static lighten(e){return Q.lightenBy(e)}lightenBy(e,t){this.f&&r.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)Q.Uo(this.color),this.color=Q.Ld(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Q.Uo(n.value),this.addColorStop(n.key,Q.Ld(i,s))}return this}static lightenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return Q.Uo(e),Q.Ld(s,n)}static darken(e){return Q.darkenBy(e)}darkenBy(e,t){this.f&&r.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)Q.Uo(this.color),this.color=Q.Ld(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Q.Uo(n.value),this.addColorStop(n.key,Q.Ld(-i,s))}return this}static darkenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return Q.Uo(e),Q.Ld(-s,n)}static mix(e,t,i){Q.Uo(e);const s=Q.Y.n0,n=Q.Y.n1,o=Q.Y.n2,a=Q.Y.n3;Q.Uo(t),i===void 0&&(i=.5);const l=Math.round((Q.Y.n0-s)*i+s),h=Math.round((Q.Y.n1-n)*i+n),d=Math.round((Q.Y.n2-o)*i+o),f=Math.round((Q.Y.n3-a)*i+a);return`rgba(${l}, ${h}, ${d}, ${f})`}isDark(){if(this.type===1)return Q.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const e=this.colorStops;if(this.type===3){const l=e.first();return l?Q.isDark(l.value):!1}if(e.get(.5)!==null)return Q.isDark(e.get(.5));if(e.count===2){const l=e.toArray();return Q.isDark(Q.mix(l[0].value,l[1].value))}const t=e.iterator;let i=-1,s=-1,n=1,o=1;for(;t.next();){const l=t.key,h=Math.abs(.5-t.key);n>o&&h<n?(i=l,n=h):o>=n&&h<o&&(s=l,o=h)}if(i>s){let l=i;i=s,s=l,l=n,n=o,o=l}const a=s-i;return Q.isDark(Q.mix(e.get(i),e.get(s),1-o/a))}return!1}static isDark(e){return e?e instanceof Q?e.isDark():(Q.Uo(e),(299*Q.Y.n0+587*Q.Y.n1+114*Q.Y.n2)/1e3<128):!1}static Ld(e,t){switch(t){case 1:return Q.kI(),Q.co.n0=Math.min(100,Math.max(0,Q.co.n0+100*e)),Q.SI(),"rgba("+Q.Y.n0+", "+Q.Y.n1+", "+Q.Y.n2+", "+Q.Y.n3+")";case 2:return Q.OM(),Q.ze.n2=Math.min(100,Math.max(0,Q.ze.n2+100*e)),"hsla("+Q.ze.n0+", "+Q.ze.n1+"%, "+Q.ze.n2+"%, "+Q.ze.n3+")";case 3:return Q.MI(),Q.fo.n0=Math.min(100,Math.max(0,Q.fo.n0+100*e)),Q.NI(),"rgba("+Q.Y.n0+", "+Q.Y.n1+", "+Q.Y.n2+", "+Q.Y.n3+")";default:r.o("Unknown color space: "+t)}}static Uo(e){Q.M0===!1&&(Q.M0=!0,Q.us=qt.isUsingDOM()?new wn(null,void 0,{willReadFrequently:!0})._t:null);const t=Q.us;if(t===null)return;t.clearRect(0,0,1,1),t.fillStyle="#000000";const i=t.fillStyle;if(t.fillStyle=e,t.fillStyle!==i){t.fillRect(0,0,1,1);const s=t.getImageData(0,0,1,1).data;Q.Y.n0=s[0],Q.Y.n1=s[1],Q.Y.n2=s[2],Q.Y.n3=s[3]/255}else t.fillStyle="#FFFFFF",t.fillStyle,t.fillStyle=e,t.fillStyle,Q.Y.n0=0,Q.Y.n1=0,Q.Y.n2=0,Q.Y.n3=1}static OM(){const e=Q.Y.n0/255,t=Q.Y.n1/255,i=Q.Y.n2/255,s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n;let a,l;const h=(s+n)/2;if(o===0)a=l=0;else{switch(s){case e:a=(t-i)/o%6;break;case t:a=(i-e)/o+2;break;case i:a=(e-t)/o+4;break;default:a=0;break}a*=60,a<0&&(a+=360),l=o/(1-Math.abs(2*h-1))}Q.ze.n0=Math.round(a),Q.ze.n1=Math.round(l*100),Q.ze.n2=Math.round(h*100),Q.ze.n3=Q.Y.n3}static VU(){const e=Q.ze.n0,t=Q.ze.n1/100,i=Q.ze.n2/100;let s,n,o;const a=(1-Math.abs(2*i-1))*t,l=e/60,h=a*(1-Math.abs(l%2-1));l>=0&&l<1?(s=a,n=h,o=0):l>=1&&l<2?(s=h,n=a,o=0):l>=2&&l<3?(s=0,n=a,o=h):l>=3&&l<4?(s=0,n=h,o=a):l>=4&&l<5?(s=h,n=0,o=a):(s=a,n=0,o=h);const d=i-.5*a;s+=d,n+=d,o+=d,Q.Y.n0=Math.round(s*255),Q.Y.n1=Math.round(n*255),Q.Y.n2=Math.round(o*255),Q.Y.n3=Q.ze.n3}static kI(){Q.rD(),Q.CI()}static SI(){Q.LI(),Q.lD()}static UN(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}static VN(e){return e<=.0031308?e*12.92:1.055*Math.pow(e,1/2.4)-.055}static rD(){const e=Q.UN(Q.Y.n0),t=Q.UN(Q.Y.n1),i=Q.UN(Q.Y.n2);Q.At.n0=.4124564*e+.3575761*t+.1804375*i,Q.At.n1=.2126729*e+.7151522*t+.072175*i,Q.At.n2=.0193339*e+.119192*t+.9503041*i,Q.At.n3=Q.Y.n3}static lD(){const e=3.2404542*Q.At.n0+-1.5371385*Q.At.n1+-.4985314*Q.At.n2,t=-.969266*Q.At.n0+1.8760108*Q.At.n1+.041556*Q.At.n2,i=.0556434*Q.At.n0+-.2040259*Q.At.n1+1.0572252*Q.At.n2;Q.Y.n0=Q.VN(e)*255,Q.Y.n1=Q.VN(t)*255,Q.Y.n2=Q.VN(i)*255,Q.Y.n3=Q.At.n3,Q.Y.n0=Math.round(Q.Y.n0),Q.Y.n0>255?Q.Y.n0=255:Q.Y.n0<0&&(Q.Y.n0=0),Q.Y.n1=Math.round(Q.Y.n1),Q.Y.n1>255?Q.Y.n1=255:Q.Y.n1<0&&(Q.Y.n1=0),Q.Y.n2=Math.round(Q.Y.n2),Q.Y.n2>255?Q.Y.n2=255:Q.Y.n2<0&&(Q.Y.n2=0)}static zN(e){return e>Q.BN?Math.pow(e,1/3):(Q.j1*e+16)/116}static CI(){const e=Q.zN(Q.At.n0*100/Q.Ad[0]),t=Q.zN(Q.At.n1*100/Q.Ad[1]),i=Q.zN(Q.At.n2*100/Q.Ad[2]);Q.co.n0=116*t-16,Q.co.n1=500*(e-t),Q.co.n2=200*(t-i),Q.co.n3=Q.At.n3}static aD(e){const t=e*e*e;return t>Q.BN?t:(116*e-16)/Q.j1}static LI(){const e=(Q.co.n0+16)/116,t=Q.co.n1/500+e,i=e-Q.co.n2/200;Q.At.n0=Q.Ad[0]/100*Q.aD(t),Q.At.n1=Q.Ad[1]/100*(Q.co.n0>Q.j1*Q.BN?Math.pow(e,3):Q.co.n0/Q.j1),Q.At.n2=Q.Ad[2]/100*Q.aD(i),Q.At.n3=Q.co.n3}static AI(){let e=.8190224*Q.At.n0+.3619062*Q.At.n1+-.1288737*Q.At.n2,t=.03298366*Q.At.n0+.9292868*Q.At.n1+.03614466*Q.At.n2,i=.04817719*Q.At.n0+.2642395*Q.At.n1+.6335478*Q.At.n2;e=Math.cbrt(e),t=Math.cbrt(t),i=Math.cbrt(i),Q.ge.n0=.2104542*e+.7936177*t+-.004072046*i,Q.ge.n1=1.977998*e+-2.428592*t+.4505937*i,Q.ge.n2=.02590403*e+.7827717*t+-.8086757*i,Q.ge.n3=Q.At.n3,Q.ge.n0*=100}static TI(){Q.ge.n0/=100;let e=.9999999*Q.ge.n0+.3963377*Q.ge.n1+.2158037*Q.ge.n2,t=1.000000009*Q.ge.n0+-.1055613*Q.ge.n1+-.06385417*Q.ge.n2,i=1.00000005*Q.ge.n0+-.08948418*Q.ge.n1+-1.291485*Q.ge.n2;e=e**3,t=t**3,i=i**3,Q.At.n0=1.2268798*e+-.5578149*t+.281391*i,Q.At.n1=-.04057576*e+1.112286*t+-.07171106*i,Q.At.n2=-.07637294*e+-.4214933*t+1.586924*i,Q.At.n3=Q.ge.n3}static DI(){const e=Math.atan2(Q.ge.n2,Q.ge.n1)*180/Math.PI;Q.fo.n0=Q.ge.n0,Q.fo.n1=Math.sqrt(Q.ge.n1**2+Q.ge.n2**2),Q.fo.n2=e>=0?e:e+360,Q.fo.n3=Q.ge.n3}static vI(){Q.ge.n0=Q.fo.n0,Q.ge.n1=Q.fo.n1*Math.cos(Q.fo.n2*Math.PI/180),Q.ge.n2=Q.fo.n1*Math.sin(Q.fo.n2*Math.PI/180),Q.ge.n3=Q.fo.n3}static MI(){Q.rD(),Q.AI(),Q.DI()}static NI(){Q.vI(),Q.TI(),Q.lD()}static Md(e,t){typeof e=="string"||e instanceof Q||r.o("Value for "+t+" must be a color string or a Brush, not "+e)}};y(Q,"BN",216/24389),y(Q,"j1",24389/27),y(Q,"Ad",[95.047,100,108.883]),y(Q,"Solid",1),y(Q,"Linear",2),y(Q,"Radial",3),y(Q,"Pattern",4),y(Q,"Lab",1),y(Q,"HSL",2),y(Q,"us",null),y(Q,"M0",!1),y(Q,"Y",new bo),y(Q,"ze",new bo),y(Q,"At",new bo),y(Q,"co",new bo),y(Q,"ge",new bo),y(Q,"fo",new bo);let me=Q;const ba=class ba{constructor(){y(this,"Pt","Base")}static Tn(e,t){t.name=e,ba.fs.set(e,t)}get name(){return this.Pt}set name(e){this.Pt=e}get classType(){return Lt}measure(e,t,i,s,n,o,a){}measureElement(e,t,i,s,n){e.ht(t,i,s,n)}arrange(e,t,i){}arrangeElement(e,t,i,s,n,o){e.Ut(t,i,s,n,o)}remeasureObject(e){e.kf()}Ge(e,t,i){}};y(ba,"fs",new nt);let le=ba;class Dp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length,h=e.$o();for(let d=0;d<l;d++){const f=s[d];if(!f.visible&&f!==h)continue;const m=f.margin,p=m.right+m.left,b=m.top+m.bottom;f.ht(t,i,o,a);const x=f.measuredBounds,v=Math.max(x.width+p,0),S=Math.max(x.height+b,0);let P=f.position.x,T=f.position.y;if(isFinite(P)||(P=0),isFinite(T)||(T=0),f instanceof Xt&&f.isGeometryPositioned){const A=f.strokeWidth/2;P-=A,T-=A}n.re(P,T,v,S)}}arrange(e,t,i){const s=t.length,n=e.padding,o=i.x-n.left,a=i.y-n.top;for(let l=0;l<s;l++){const h=t[l],d=h.measuredBounds,f=h.margin,m=h.position.x,p=h.position.y;let b=isNaN(m)?-o:m-o,x=isNaN(p)?-a:p-a;if(h instanceof Xt&&h.isGeometryPositioned){const v=h.strokeWidth/2;b-=v,x-=v}h.visible&&h.Ut(b+f.left,x+f.top,d.width,d.height)}}}le.Tn("Position",new Dp);class Lp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length,h=r.nt(),d=e.$o();for(let m=0;m<l;m++){const p=s[m];if(!p.visible&&p!==d)continue;const b=p.Qs(!1);if(b!==0&&b!==5){h.push(p);continue}p.ht(1/0,i,0,a);const x=p.margin,v=p.measuredBounds,S=Math.max(v.width+x.right+x.left,0),P=Math.max(v.height+x.top+x.bottom,0);n.jn(n.width+S,Math.max(n.height,P))}const f=h.length;e.desiredSize.height?i=Math.min(e.desiredSize.height,e.maxSize.height):n.height!==0&&(i=Math.min(n.height,e.maxSize.height));for(let m=0;m<f;m++){const p=h[m];if(!p.visible&&p!==d)continue;const b=p.margin,x=b.right+b.left,v=b.top+b.bottom;p.ht(1/0,i,0,a);const S=p.measuredBounds,P=Math.max(S.width+x,0),T=Math.max(S.height+v,0);n.width+=P,n.height=Math.max(n.height,T)}r.Z(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.top,a=e.isOpposite;let l=a?i.width:n.left;for(let h=0;h<s;h++){const d=o,f=t[h];if(!f.visible)continue;const m=f.measuredBounds,p=f.margin,b=p.top+p.bottom,x=o+n.bottom;let v=m.height;const S=f.Qs(!1);(isNaN(f.desiredSize.height)&&S===2||S===4)&&(v=Math.max(i.height-b-x,0));const P=v+b+x;let T=f.alignment;T.isDefault()&&(T=e.defaultAlignment),T.isSpot()||(T=X.Center),a&&(l-=m.width+p.left+p.right),f.Ut(l+T.offsetX+p.left,d+T.offsetY+p.top+(i.height*T.y-P*T.y),m.width,v),a||(l+=m.width+p.left+p.right)}}}le.Tn("Horizontal",new Lp);class Ep extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length,h=r.nt(),d=e.$o();for(let m=0;m<l;m++){const p=s[m];if(!p.visible&&p!==d)continue;const b=p.Qs(!1);if(b!==0&&b!==4){h.push(p);continue}p.ht(t,1/0,o,0);const x=p.margin,v=p.measuredBounds,S=Math.max(v.width+x.right+x.left,0),P=Math.max(v.height+x.top+x.bottom,0);n.jn(Math.max(n.width,S),n.height+P)}const f=h.length;e.desiredSize.width?t=Math.min(e.desiredSize.width,e.maxSize.width):n.width!==0&&(t=Math.min(n.width,e.maxSize.width));for(let m=0;m<f;m++){const p=h[m];if(!p.visible&&p!==d)continue;const b=p.margin,x=b.right+b.left,v=b.top+b.bottom;p.ht(t,1/0,o,0);const S=p.measuredBounds,P=Math.max(S.width+x,0),T=Math.max(S.height+v,0);n.width=Math.max(n.width,P),n.height+=T}r.Z(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,a=e.isOpposite;let l=a?i.height:n.top;for(let h=0;h<s;h++){const d=o,f=t[h];if(!f.visible)continue;const m=f.measuredBounds,p=f.margin,b=p.left+p.right,x=o+n.right;let v=m.width;const S=f.Qs(!1);(isNaN(f.desiredSize.width)&&S===2||S===5)&&(v=Math.max(i.width-b-x,0));const P=v+b+x;let T=f.alignment;T.isDefault()&&(T=e.defaultAlignment),T.isSpot()||(T=X.Center),a&&(l-=m.height+p.bottom+p.top),f.Ut(d+T.offsetX+p.left+(i.width*T.x-P*T.x),l+T.offsetY+p.top,v,m.height),a||(l+=m.height+p.bottom+p.top)}}}le.Tn("Vertical",new Ep);const br=class br extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length;if(l===0)return;const h=e.findMainElement();let d=h.margin,f=0,m=0;const p=d.right+d.left,b=d.top+d.bottom;h.ht(t,i,o,a);let x=h.measuredBounds,v=x.width,S=x.height,P=Math.max(v+p,0),T=Math.max(S+b,0);const A=e.isClipping;A&&h.jp()!==0&&!br.hD&&(br.hD=!0,r.ne("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+e.toString()));const C=Y.z(-d.left,-d.top,P,T);let O=Y.z(0,0,v,S);this.XN(h,O,!0),v=O.width,S=O.height;let R=!0;const I=e.$o();let H;for(let V=0;V<l;V++){const z=s[V];let K=t,$=i;if(z===h||!z.visible&&z!==I)continue;d=z.margin;let q=d.left,J=d.top;switch(f=d.right+d.left,m=d.top+d.bottom,H=z.Qs(!1),H){case 2:K=v,$=S,f=0,m=0,q=0,J=0;break;case 5:K=v,f=0,q=0;break;case 4:$=S,m=0,J=0;break}z.ht(K,$,0,0),x=z.measuredBounds,P=Math.max(x.width+f,0),T=Math.max(x.height+m,0);let ot=z.alignment;ot.isDefault()&&(ot=e.defaultAlignment),ot.isSpot()||(ot=X.Center);let rt=z.alignmentFocus;rt.isDefault()&&(rt=X.Center);let st=null;z instanceof Lt&&z.uo!==""&&(st=z.findObject(z.uo),st===z&&(st=null));let ht=O.x-q,pt=O.y-J;if(st!==null){z.Ut(0,0,x.width,x.height);const zt=st.actualBounds,kt=L.z(zt.x+(rt.x*zt.width-rt.offsetX),zt.y+(rt.y*zt.height-rt.offsetY));for(st=st.panel;st!==null&&st!==z;)st.v.gt(kt),st=st.panel;ht+=ot.x*v+ot.offsetX-kt.x,pt+=ot.y*S+ot.offsetY-kt.y,L.i(kt)}else ht+=ot.x*v+ot.offsetX-(rt.x*x.width+rt.offsetX),pt+=ot.y*S+ot.offsetY-(rt.y*x.height+rt.offsetY);R?(R=!1,n.e(ht,pt,P,T)):n.re(ht,pt,P,T)}switch(R?n.h(C):A?n.intersect(O.x,O.y,O.width,O.height):n.re(C.x,C.y,C.width,C.height),Y.i(C),Y.i(O),H=h.stretch,H===1&&(H=h.Qs(!1)),H){case 0:return;case 2:if(!isFinite(t)&&!isFinite(i))return;break;case 5:if(!isFinite(t))return;break;case 4:if(!isFinite(i))return;break}x=h.measuredBounds,v=x.width,S=x.height,P=Math.max(v+p,0),T=Math.max(S+b,0),d=h.margin,O=Y.z(-d.left,-d.top,P,T),this.XN(h,O,!0),v=O.width,S=O.height;for(let V=0;V<l;V++){const z=s[V];if(z===h||!z.visible&&z!==I)continue;d=z.margin,f=d.right+d.left,m=d.top+d.bottom,x=z.measuredBounds,P=Math.max(x.width+f,0),T=Math.max(x.height+m,0);let K=z.alignment;K.isDefault()&&(K=e.defaultAlignment),K.isSpot()||(K=X.Center);let $=z.alignmentFocus;$.isDefault()&&($=X.Center),R?(R=!1,n.e(K.x*v+K.offsetX-($.x*x.width+$.offsetX)-d.left,K.y*S+K.offsetY-($.y*x.height+$.offsetY)-d.top,P,T)):n.re(K.x*v+K.offsetX-($.x*x.width+$.offsetX)-d.left,K.y*S+K.offsetY-($.y*x.height+$.offsetY)-d.top,P,T)}R?n.h(C):A?n.intersect(O.x,O.y,O.width,O.height):n.re(C.x,C.y,C.width,C.height),Y.i(O)}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,a=o.width,l=o.height,h=e.padding,d=h.left,f=h.top;let m=d-i.x,p=f-i.y;n.Ut(m,p,a,l);const b=Y.z(0,0,a,l);this.XN(n,b,!1);for(let x=0;x<s;x++){const v=t[x];if(v===n)continue;const S=v.measuredBounds,P=S.width,T=S.height;let A=v.alignment;A.isDefault()&&(A=e.defaultAlignment),A.isSpot()||(A=X.Center);let C=v.alignmentFocus;C.isDefault()&&(C=X.Center);let O=null;if(v instanceof Lt&&v.uo!==""&&(O=v.findObject(v.uo),O===v&&(O=null)),O!==null){const R=O.actualBounds,I=L.z(R.x+(C.x*R.width-C.offsetX),R.y+(C.y*R.height-C.offsetY));for(O=O.panel;O!==null&&O!==v;)O.v.gt(I),O=O.panel;m=A.x*b.width+A.offsetX-I.x,p=A.y*b.height+A.offsetY-I.y,L.i(I)}else m=A.x*b.width+A.offsetX-(C.x*P+C.offsetX),p=A.y*b.height+A.offsetY-(C.y*T+C.offsetY);m+=b.x-i.x,p+=b.y-i.y,v.visible&&v.Ut(d+m,f+p,P,T)}Y.i(b)}XN(e,t,i){let s=null;if(e instanceof Lt&&e.uo!==""&&(s=e.findObject(e.uo),s===e&&(s=null)),s!==null)for(i&&e.Ut(0,0,t.width,t.height),t.h(s.actualBounds),s=s.panel;s!==null&&s!==e;)s.v.sm(t),s=s.panel}};y(br,"hD",!1);let Ql=br;le.Tn("Spot",new Ql);class Fp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length;if(l===0)return;const h=e.findMainElement();let d=h.margin,f=t,m=i;const p=d.right+d.left,b=d.top+d.bottom;h.ht(t,i,o,a);let x=h.measuredBounds,v=0,S=null;h instanceof Xt&&(S=h,v=S.strokeWidth*S.scale);let P=Math.max(x.width+p,0),T=Math.max(x.height+b,0),A=e.GN(h);const C=A.x*P+A.offsetX,O=A.y*T+A.offsetY;let R=e.YN(h);const I=R.x*P+R.offsetX,H=R.y*T+R.offsetY;isFinite(t)&&(f=Math.max(Math.abs(C-I)-v,0)),isFinite(i)&&(m=Math.max(Math.abs(O-H)-v,0));let V=0,z=0;o>0&&(V=Math.max(Math.abs(A.x*o+A.offsetX-(R.x*o+R.offsetX))-v,0)),a>0&&(z=Math.max(Math.abs(A.y*a+A.offsetY-(R.y*a+R.offsetY))-v,0));const K=_.l();K.e(0,0);const $=e.$o();for(let rt=0;rt<l;rt++){const st=s[rt];if(st===h||!st.visible&&st!==$)continue;d=st.margin;const ht=d.right+d.left,pt=d.top+d.bottom;st.ht(f,m,V,z),x=st.measuredBounds,P=Math.max(x.width+ht,0),T=Math.max(x.height+pt,0),K.e(Math.max(P,K.width),Math.max(T,K.height))}if(l===1){x=h.measuredBounds,n.width=P,n.height=T,_.i(K);return}A=e.GN(h),R=e.YN(h);let q=0,J=0;R.x!==A.x&&R.y!==A.y&&(q=K.width/Math.abs(R.x-A.x),J=K.height/Math.abs(R.y-A.y)),_.i(K),v=0,S!==null&&(v=S.strokeWidth*S.scale,S._S()===6&&(q=J=Math.max(q,J))),q+=Math.abs(A.offsetX)+Math.abs(R.offsetX)+v,J+=Math.abs(A.offsetY)+Math.abs(R.offsetY)+v;let ot=h.stretch;switch(ot===1&&(ot=h.Qs(!1)),ot){case 0:o=0,a=0;break;case 2:isFinite(t)&&(q=t),isFinite(i)&&(J=i);break;case 5:isFinite(t)&&(q=t),a=0;break;case 4:o=0,isFinite(i)&&(J=i);break}h.kf(),h.ht(q,J,o,a),n.width=h.measuredBounds.width+p,n.height=h.measuredBounds.height+b}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,a=Y.l();a.e(0,0,1,1);let l=n.margin;const h=l.left,d=l.top,f=e.padding,m=f.left,p=f.top;let b=h,x=d,v=o.width,S=o.height;n.Ut(m+b,p+x,v,S);const P=e.GN(n),T=e.YN(n),A=0+P.x*o.width+P.offsetX,C=0+P.y*o.height+P.offsetY,O=0+T.x*o.width+T.offsetX,R=0+T.y*o.height+T.offsetY;a.x=A,a.y=C,a.re(O,R,0,0),a.x+=h+m,a.y+=d+p;for(let I=0;I<s;I++){const H=t[I];if(H===n)continue;const V=H.measuredBounds;l=H.margin;const z=Math.max(V.width+l.right+l.left,0),K=Math.max(V.height+l.top+l.bottom,0);let $=H.alignment;$.isDefault()&&($=e.defaultAlignment),$.isSpot()||($=X.Center),b=a.width*$.x+$.offsetX-z*$.x+l.left+a.x,x=a.height*$.y+$.offsetY-K*$.y+l.top+a.y,v=a.width,S=a.height,H.visible&&(Y.contains(a.x,a.y,a.width,a.height,b,x,V.width,V.height)?H.Ut(b,x,V.width,V.height):H.Ut(b,x,V.width,V.height,new Y(a.x,a.y,a.width,a.height)))}Y.i(a)}}le.Tn("Auto",new Fp);class Op extends le{constructor(){super(),this.name="Table"}measure(e,t,i,s,n,o,a){let l=s.length;const h=r.nt(),d=r.nt();for(let vt=0;vt<l;vt++){const mt=s[vt],Vt=mt instanceof Lt?mt:null;if(Vt!==null&&Vt.ol()&&mt.visible){d.push(Vt);const oe=Vt.D.r,Ue=oe.length;for(let qe=0;qe<Ue;qe++){const ti=oe[qe];Vt.type===Lt.TableRow?ti.row=mt.row:Vt.type===Lt.TableColumn&&(ti.column=mt.column),h.push(ti)}}else h.push(mt)}l=h.length,l===0&&(e.getRowDefinition(0),e.getColumnDefinition(0));const f=[];for(let vt=0;vt<l;vt++){const mt=h[vt];mt.visible&&(mt.xi(!0),mt.ao(!0),f[mt.row]||(f[mt.row]=[]),f[mt.row][mt.column]||(f[mt.row][mt.column]=[]),f[mt.row][mt.column].push(mt))}r.Z(h);const m=r.nt(),p=r.nt(),b=r.nt(),x={count:0},v={count:0};let S=t,P=i;const T=e.Qi,A=e._i;let C;l=T.length;for(let vt=0;vt<l;vt++)C=T[vt],C!==void 0&&(C.actual=0,C.Re=0);l=A.length;for(let vt=0;vt<l;vt++)C=A[vt],C!==void 0&&(C.actual=0,C.Re=0);let O=f.length,R=0;for(let vt=0;vt<O;vt++)f[vt]&&(R=Math.max(R,f[vt].length));const I=Math.min(e.topIndex,O-1),H=Math.min(e.leftIndex,R-1);let V=0,z;O=f.length;const K=e.$o();for(let vt=0;vt<O;vt++){if(!f[vt])continue;R=f[vt].length;const mt=e.getRowDefinition(vt);mt.actual=0,mt.Re=0;for(let Vt=0;Vt<R;Vt++){if(!f[vt][Vt])continue;const oe=e.getColumnDefinition(Vt);m[Vt]===void 0&&(oe.actual=0,oe.Re=0,m[Vt]=!0);const Ue=f[vt][Vt],qe=Ue.length;for(let ti=0;ti<qe;ti++){const si=Ue[ti];if(!si.visible&&si!==K)continue;const Ms=si.rowSpan>1,Gi=si.columnSpan>1;(Ms||Gi)&&!(vt<I)&&!(Vt<H)&&p.push(si);const _i=si.margin,oi=_i.right+_i.left,mi=_i.top+_i.bottom;z=si.Qp(mt,oe,!1);const gs=si.desiredSize,we=!isNaN(gs.width),Bs=!isNaN(gs.height);if(z!==0&&!(we&&Bs)&&!(vt<I)&&!(Vt<H)&&(!Gi&&x[Vt]===void 0&&(z===2||z===5)&&(x[Vt]=-1,x.count++),!Ms&&v[vt]===void 0&&(z===2||z===4)&&(v[vt]=-1,v.count++),!Ms&&!Gi&&b.push(si)),si.ht(1/0,1/0,0,0),vt<I||Vt<H)continue;const Ti=si.measuredBounds,Cs=Math.max(Ti.width+oi,0),tn=Math.max(Ti.height+mi,0);if(si.rowSpan===1&&(z===0||z===5)){C=e.getRowDefinition(vt);const Ns=C.computeEffectiveSpacing(),xr=C.j===0;V=Math.max(tn-C.actual,0),V+(xr?Ns:0)>P&&(V=Math.max(P-Ns,0)),C.Re=C.Re+V,C.actual=C.j+V,P=Math.max(P-(V+(xr?Ns:0)),0)}if(si.columnSpan===1&&(z===0||z===4)){C=e.getColumnDefinition(Vt);const Ns=C.computeEffectiveSpacing(),xr=C.j===0;V=Math.max(Cs-C.actual,0),V+(xr?Ns:0)>S&&(V=Math.max(S-Ns,0)),C.Re=C.Re+V,C.actual=C.j+V,S=Math.max(S-(V+(xr?Ns:0)),0)}(Ms||Gi)&&si.kf()}}}r.Z(m);let $=0,q=0;l=e.columnCount;for(let vt=0;vt<l;vt++){const mt=A[vt];mt!==void 0&&($+=isNaN(mt.ki)?mt.Re:mt.ki,mt.Re!==0&&($+=mt.computeEffectiveSpacing()))}l=e.rowCount;for(let vt=0;vt<l;vt++){const mt=T[vt];mt!==void 0&&(q+=isNaN(mt.ki)?mt.Re:mt.ki,mt.Re!==0&&(q+=mt.computeEffectiveSpacing()))}S=Math.max(t-$,0),P=Math.max(i-q,0);let J=P,ot=S;l=b.length;for(let vt=0;vt<l;vt++){const mt=b[vt],Vt=e.getRowDefinition(mt.row),oe=e.getColumnDefinition(mt.column),Ue=mt.measuredBounds,qe=mt.margin,ti=qe.right+qe.left,si=qe.top+qe.bottom;oe.Re===0&&x[mt.column]!==void 0?x[mt.column]=Math.max(Ue.width+ti,x[mt.column]):x[mt.column]=null,Vt.Re===0&&v[mt.row]!==void 0?v[mt.row]=Math.max(Ue.height+si,v[mt.row]):v[mt.row]=null}let rt=0,st=0,ht;for(ht in v)ht!=="count"&&(rt+=v[ht]);for(ht in x)ht!=="count"&&(st+=x[ht]);const pt=_.l();for(let vt=0;vt<l;vt++){const mt=b[vt];if(!mt.visible&&mt!==K)continue;const Vt=e.getRowDefinition(mt.row),oe=e.getColumnDefinition(mt.column);let Ue=0;isFinite(oe.width)?Ue=oe.width:(isFinite(S)&&x[mt.column]!==null?st===0?Ue=oe.actual+S:Ue=x[mt.column]/st*ot:x[mt.column]!==null?Ue=S:Ue=oe.actual||S,Ue=Math.max(0,Ue-oe.computeEffectiveSpacing()));let qe=0;switch(isFinite(Vt.height)?qe=Vt.height:(isFinite(P)&&v[mt.row]!==null?rt===0?qe=Vt.actual+P:qe=v[mt.row]/rt*J:v[mt.row]!==null?qe=P:qe=Vt.actual||P,qe=Math.max(0,qe-Vt.computeEffectiveSpacing())),pt.e(Math.max(oe.minimum,Math.min(Ue,oe.maximum)),Math.max(Vt.minimum,Math.min(qe,Vt.maximum))),z=mt.Qp(Vt,oe,!1),z){case 5:pt.height=Math.max(pt.height,Vt.actual+P);break;case 4:pt.width=Math.max(pt.width,oe.actual+S);break}const ti=mt.margin,si=ti.right+ti.left,Ms=ti.top+ti.bottom;mt.kf();let Gi=oe.minimum,_i=Vt.minimum;const oi=mt.measuredBounds;oi.width===0&&x[mt.column]!==null&&(Gi=Math.max(Gi,x[mt.column])),oi.height===0&&v[mt.row]!==null&&(_i=Math.max(Gi,v[mt.row])),mt.ht(pt.width,pt.height,Gi,_i);const mi=mt.measuredBounds;let gs=Math.max(mi.width+si,0),we=Math.max(mi.height+Ms,0);isFinite(S)&&(gs=Math.min(gs,pt.width)),isFinite(P)&&(we=Math.min(we,pt.height));let Bs=0;Bs=Vt.actual,Vt.actual=Math.max(Vt.actual,we),Vt.Re=Math.max(Vt.Re,we),V=Vt.actual-Bs,P=Math.max(P-V,0),v[mt.row]===null&&(J=Math.max(J-V,0)),Bs=oe.actual,oe.actual=Math.max(oe.actual,gs),oe.Re=Math.max(oe.Re,gs),V=oe.actual-Bs,S=Math.max(S-V,0),x[mt.column]===null&&(ot=Math.max(ot-V,0))}r.Z(b);const zt=_.l(),kt=r.nt(),Mt=r.nt();if(l=p.length,l!==0)for(let vt=0;vt<O;vt++){if(!f[vt])continue;R=f[vt].length;const mt=e.getRowDefinition(vt);kt[vt]=mt.actual;for(let Vt=0;Vt<R;Vt++){if(!f[vt][Vt])continue;const oe=e.getColumnDefinition(Vt);Mt[Vt]=oe.actual}}for(let vt=0;vt<l;vt++){const mt=p[vt];if(!mt.visible&&mt!==K)continue;const Vt=e.getRowDefinition(mt.row),oe=e.getColumnDefinition(mt.column);switch(pt.e(Math.max(oe.minimum,Math.min(t,oe.maximum)),Math.max(Vt.minimum,Math.min(i,Vt.maximum))),z=mt.Qp(Vt,oe,!1),z){case 2:Mt[oe.index]!==0&&(pt.width=Math.min(pt.width,Mt[oe.index])),kt[Vt.index]!==0&&(pt.height=Math.min(pt.height,kt[Vt.index]));break;case 5:Mt[oe.index]!==0&&(pt.width=Math.min(pt.width,Mt[oe.index]));break;case 4:kt[Vt.index]!==0&&(pt.height=Math.min(pt.height,kt[Vt.index]));break}isFinite(oe.width)&&(pt.width=oe.width),isFinite(Vt.height)&&(pt.height=Vt.height),zt.e(0,0);let Ue=oe.minimum,qe=Vt.minimum;for(let we=1;we<mt.rowSpan&&!(mt.row+we>=e.rowCount);we++){if(C=e.getRowDefinition(mt.row+we),V=0,z===2||z===4){if(C.j===0)continue;V=Math.max(C.minimum,C.j===0?C.maximum:Math.min(C.j,C.maximum))}else V=Math.max(C.minimum,isNaN(C.ki)?C.maximum:Math.min(C.ki,C.maximum));zt.height+=V,qe+=C.minimum}for(let we=1;we<mt.columnSpan&&!(mt.column+we>=e.columnCount);we++){if(C=e.getColumnDefinition(mt.column+we),V=0,z===2||z===5){if(C.j===0)continue;V=Math.max(C.minimum,C.j===0?C.maximum:Math.min(C.j,C.maximum))}else V=Math.max(C.minimum,isNaN(C.ki)?C.maximum:Math.min(C.ki,C.maximum));zt.width+=V,Ue+=C.minimum}pt.width+=zt.width,pt.height+=zt.height;const ti=mt.margin,si=ti.right+ti.left,Ms=ti.top+ti.bottom;mt.ht(pt.width,pt.height,Ue,qe);const Gi=mt.measuredBounds,_i=Math.max(Gi.width+si,0),oi=Math.max(Gi.height+Ms,0);let mi=0;for(let we=0;we<mt.rowSpan&&!(mt.row+we>=e.rowCount);we++)C=e.getRowDefinition(mt.row+we),mi+=C.total||0;if(mi<oi){let we=oi-mi;const Bs=oi-mi;if(mt.spanAllocation!==null){const Ti=mt.spanAllocation;for(let Cs=0;Cs<mt.rowSpan&&!(we<=0||mt.row+Cs>=e.rowCount);Cs++){C=e.getRowDefinition(mt.row+Cs);const tn=C.j||0,Ns=Ti(mt,C,Bs);C.actual=Math.min(C.maximum,tn+Ns),C.j!==tn&&(we-=C.j-tn)}}for(;we>0&&C!==void 0;){const Ti=C.j||0;if(isNaN(C.height)&&C.maximum>Ti&&(C.actual=Math.min(C.maximum,Ti+we),C.j!==Ti&&(we-=C.j-Ti)),C.index===0)break;C=e.getRowDefinition(C.index-1)}}let gs=0;for(let we=0;we<mt.columnSpan&&!(mt.column+we>=e.columnCount);we++)C=e.getColumnDefinition(mt.column+we),gs+=C.total||0;if(gs<_i){let we=_i-gs;const Bs=_i-gs;if(mt.spanAllocation!==null){const Ti=mt.spanAllocation;for(let Cs=0;Cs<mt.columnSpan&&!(we<=0||mt.column+Cs>=e.columnCount);Cs++){C=e.getColumnDefinition(mt.column+Cs);const tn=C.j||0,Ns=Ti(mt,C,Bs);C.actual=Math.min(C.maximum,tn+Ns),C.j!==tn&&(we-=C.j-tn)}}for(;we>0&&C!==void 0;){const Ti=C.j||0;if(isNaN(C.width)&&C.maximum>Ti&&(C.actual=Math.min(C.maximum,Ti+we),C.j!==Ti&&(we-=C.j-Ti)),C.index===0)break;C=e.getColumnDefinition(C.index-1)}}}r.Z(p),_.i(zt),_.i(pt),kt!==void 0&&r.Z(kt),Mt!==void 0&&r.Z(Mt);let St=0,Ct=0;const Qt=e.desiredSize,Wt=e.maxSize;z=e.Qs(!0),$=0,q=0;let xt=0,Ot=0;l=e.columnCount;for(let vt=0;vt<l;vt++)if(A[vt]!==void 0){if(C=e.getColumnDefinition(vt),isFinite(C.width)){xt+=C.width,xt+=C.computeEffectiveSpacing();continue}else if(C.q1()===2){xt+=C.j,xt+=C.computeEffectiveSpacing();continue}C.j!==0&&($+=C.j,$+=C.computeEffectiveSpacing())}isFinite(Qt.width)?St=Math.min(Qt.width,Wt.width):z!==0&&isFinite(t)?St=t:St=$,St=Math.max(St,isFinite(t)?Math.min(o,t):o),St=Math.max(St-xt,0);const Le=$===0?1:Math.max(St/$,1);for(let vt=0;vt<l;vt++)A[vt]!==void 0&&(C=e.getColumnDefinition(vt),!isFinite(C.width)&&C.q1()!==2&&(C.actual=C.j*Le),C.position=n.width,C.j!==0&&(n.width+=C.j,n.width+=C.computeEffectiveSpacing()));l=e.rowCount;for(let vt=0;vt<l;vt++)if(T[vt]!==void 0){if(C=e.getRowDefinition(vt),isFinite(C.height)){Ot+=C.height,Ot+=C.computeEffectiveSpacing();continue}else if(C.q1()===2){Ot+=C.j,Ot+=C.computeEffectiveSpacing();continue}C.j!==0&&(q+=C.j,q+=C.computeEffectiveSpacing())}isFinite(Qt.height)?Ct=Math.min(Qt.height,Wt.height):z!==0&&isFinite(i)?Ct=i:Ct=q,Ct=Math.max(Ct,isFinite(i)?Math.min(a,i):a),Ct=Math.max(Ct-Ot,0);const te=q===0?1:Math.max(Ct/q,1);for(let vt=0;vt<l;vt++)T[vt]!==void 0&&(C=e.getRowDefinition(vt),!isFinite(C.height)&&C.q1()!==2&&(C.actual=C.j*te),C.position=n.height,C.j!==0&&(n.height+=C.j,n.height+=C.computeEffectiveSpacing()));l=d.length;for(let vt=0;vt<l;vt++){const mt=d[vt];let Vt=0,oe=0;mt.type===Lt.TableRow?(Vt=n.width,C=e.getRowDefinition(mt.row),oe=C.actual):(C=e.getColumnDefinition(mt.column),Vt=C.actual,oe=n.height),mt.measuredBounds.e(0,0,Vt,oe),mt.xi(!1)}r.Z(d),e.La=f}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,a=n.top,l=e.La;if(l===null)return;let h=0,d=0;const f=l.length;let m=0;for(let H=0;H<f;H++)l[H]&&(m=Math.max(m,l[H].length));const p=e.Qi,b=e._i;let x=0,v=0,S=Math.min(e.topIndex,f-1);if(p.length>0){for(;S!==f&&(p[S]===void 0||p[S].j===0);)S++;S=Math.max(Math.min(S,f-1),0),x=-p[S].position}let P=Math.min(e.leftIndex,m-1);if(b.length>0){for(;P!==m&&(b[P]===void 0||b[P].j===0);)P++;P=Math.max(Math.min(P,m-1),0),v=-b[P].position}let T=0,A=0;for(;T!==f&&p[T]===void 0;)T++;for(;A!==f&&b[A]===void 0;)A++;const C=e.part;let O=e.getRowDefinition(T),R=e.getColumnDefinition(A);for(let H=0;H<t.length;H++){const V=t[H];if(!(V instanceof Lt&&V.visible&&V.ol()))continue;V.type===Lt.TableRow?(O=e.getRowDefinition(V.row),R=e.getColumnDefinition(A)):(O=e.getRowDefinition(T),R=e.getColumnDefinition(V.column)),d=O.position+x+a,O.j!==0&&(d+=O.computeEffectiveSpacingTop(Math.max(T,S))),h=R.position+v+o,R.j!==0&&(h+=R.computeEffectiveSpacingTop(Math.max(A,P)));const z=V.measuredBounds;V.yf(),V.actualBounds.ce();const K=V.actualBounds,$=Y.z(K.x,K.y,K.width,K.height);if(K.x=V.type===Lt.TableRow?o:h,K.y=V.type===Lt.TableColumn?a:d,K.width=z.width,K.height=z.height,V.actualBounds.k(),V.ao(!1),$.equalsApproxClose(K)){Y.i($);continue}C!==null&&(C.Sa(),V.Wp(C)),Y.i($)}const I=_.l();for(let H=0;H<f;H++){if(!l[H])continue;m=l[H].length;const V=e.getRowDefinition(H);d=V.position+x+a,V.j!==0&&(d+=V.computeEffectiveSpacingTop(Math.max(T,S)));for(let z=0;z<m;z++){if(!l[H][z])continue;const K=e.getColumnDefinition(z);h=K.position+v+o,K.j!==0&&(h+=K.computeEffectiveSpacingTop(Math.max(A,P)));const $=l[H][z],q=$.length;for(let J=0;J<q;J++){const ot=$[J],rt=ot.measuredBounds;I.e(0,0);for(let oi=1;oi<ot.rowSpan&&!(H+oi>=e.rowCount);oi++){const mi=e.getRowDefinition(H+oi);mi.j!==0&&(I.height+=mi.total)}for(let oi=1;oi<ot.columnSpan&&!(z+oi>=e.columnCount);oi++){const mi=e.getColumnDefinition(z+oi);mi.j!==0&&(I.width+=mi.total)}const st=K.j+I.width,ht=V.j+I.height;let pt=h,zt=d;const kt=st,Mt=ht,St=h,Ct=d;let Qt=st,Wt=ht;h+st>i.width&&(Qt=Math.max(i.width-h,0)),d+ht>i.height&&(Wt=Math.max(i.height-d,0));let xt=ot.alignment,Ot=0,Le=0,te=0,vt=0;if(xt.isDefault()){xt=e.defaultAlignment,xt.isSpot()||(xt=X.Center),Ot=xt.x,Le=xt.y,te=xt.offsetX,vt=xt.offsetY;const oi=K.alignment,mi=V.alignment;oi.isSpot()&&(Ot=oi.x,te=oi.offsetX),mi.isSpot()&&(Le=mi.y,vt=mi.offsetY)}else Ot=xt.x,Le=xt.y,te=xt.offsetX,vt=xt.offsetY;(isNaN(Ot)||isNaN(Le))&&(Ot=.5,Le=.5,te=0,vt=0);let mt=rt.width,Vt=rt.height;const oe=ot.margin,Ue=oe.left+oe.right,qe=oe.top+oe.bottom,ti=ot.Qp(V,K,!1);isNaN(ot.desiredSize.width)&&(ti===2||ti===5)&&(mt=Math.max(st-Ue,0)),isNaN(ot.desiredSize.height)&&(ti===2||ti===4)&&(Vt=Math.max(ht-qe,0));const si=ot.maxSize,Ms=ot.minSize;mt=Math.min(si.width,mt),Vt=Math.min(si.height,Vt),mt=Math.max(Ms.width,mt),Vt=Math.max(Ms.height,Vt);const Gi=mt+Ue,_i=Vt+qe;pt+=kt*Ot-Gi*Ot+te+oe.left,zt+=Mt*Le-_i*Le+vt+oe.top,ot.visible&&(Y.contains(St,Ct,Qt,Wt,pt,zt,rt.width,rt.height)?ot.Ut(pt,zt,mt,Vt):ot.Ut(pt,zt,mt,Vt,new Y(St,Ct,Qt,Wt)))}}}_.i(I);for(let H=0;H<s;H++){const V=t[H],z=V instanceof Lt?V:null;if(z!==null&&z.ol()){const K=V.actualBounds;V.naturalBounds.ce(),V.naturalBounds.e(0,0,K.width,K.height),V.naturalBounds.k()}}}}le.Tn("Table",new Op);class Rp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){}arrange(e,t,i){}}le.Tn("TableRow",new Rp);class Ip extends le{constructor(){super()}measure(e,t,i,s,n,o,a){}arrange(e,t,i){}}le.Tn("TableColumn",new Ip);class Bp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){s.length!==1&&r.o("Viewbox Panel must contain exactly one GraphObject.");const l=s[0];l.it=1,l.kf(),l.ht(1/0,1/0,o,a);let h=l.measuredBounds;const d=l.margin,f=d.right+d.left,m=d.top+d.bottom;if(isFinite(t)||isFinite(i)){const p=l.scale,b=h.width,x=h.height,v=Math.max(t-f,0),S=Math.max(i-m,0);let P=1;e.viewboxStretch===6?(b!==0&&x!==0&&(P=Math.min(v/b,S/x)),P===0&&(P=1e-4),l.it*=P):(b!==0&&x!==0&&(P=Math.max(v/b,S/x)),P===0&&(P=1e-4),l.it*=P),p!==l.scale&&(l.xi(!0),l.ht(1/0,1/0,o,a))}h=l.measuredBounds,n.width=isFinite(t)?t:Math.max(h.width+f,0),n.height=isFinite(i)?i:Math.max(h.height+m,0)}arrange(e,t,i){const s=t[0],n=s.measuredBounds,o=s.margin,a=o.right+o.left,l=o.top+o.bottom,h=Math.max(n.width+a,0),d=Math.max(n.height+l,0);let f=s.alignment;f.isDefault()&&(f=e.defaultAlignment),f.isSpot()||(f=X.Center),s.Ut(i.width*f.x-h*f.x+f.offsetX,i.height*f.y-d*f.y+f.offsetY,n.width,n.height)}}le.Tn("Viewbox",new Bp);class Vp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){e.Pe===null&&(e.Pe=new xo),this.FI(e),this.RI(e)}arrange(e,t,i){}Ge(e,t,i){const s=e.naturalBounds;t.save(),t.beginPath(),t.rect(0,0,s.width,s.height),t.clip(),t.endPath(),this.OI(e,t,i),t.restore(),t.clearContextCache(!1)}OI(e,t,i){let s=e.getDocumentScale()*i.scale;s<=0&&(s=1);const n=e.gridCellSize,o=n.width,a=n.height,l=e.naturalBounds,h=e.actualBounds,d=l.width,f=l.height,m=Math.ceil(d/o),p=Math.ceil(f/a),b=e.gridOrigin,x=b.x,v=b.y,S=e.Pe.N0,P=e.D.r,T=P.length;for(let A=0;A<T;A++){const C=P[A];if(!C.visible)continue;const O=C.interval||1,R=Math.abs(O);if(o*R*s<2)continue;let I=C.segmentIndex;(!isFinite(I)||isNaN(I))&&(I=0),I<0&&(I=R-Math.min(-I,R)),I=Math.round(I%R);const H=C.opacity;let V=1;if(H!==1){if(H===0)continue;V=t.globalAlpha,t.globalAlpha=V*H}const z=S[A];let K=!1;const $=C.strokeDashArray;if($!==null&&(K=!0,t.enableDash($,C.strokeDashOffset)),C.stroke!==null&&C.strokeWidth>0&&(C.figure==="LineV"||C.figure==="LineH")){if(t.lineWidth=C.strokeWidth,e.kn(t,C.stroke,!1,!1,l,h),t.beginPath(),C.figure==="LineV"){const q=Math.floor((x-o)/o);for(let J=q;J<=q+m;J++){const ot=J*o+x;0<=ot&&ot<=d&&this.W1(J,O,I,z)&&(t.moveTo(ot,0),t.lineTo(ot,f))}}else if(C.figure==="LineH"){const q=Math.floor((v-a)/a);for(let J=q;J<=q+p;J++){const ot=J*a+v;0<=ot&&ot<=f&&this.W1(J,O,I,z)&&(t.moveTo(0,ot),t.lineTo(d,ot))}}t.stroke(),t.endPath()}else if(C.fill!==null){if(e.kn(t,C.fill,!0,!1,l,h),C.figure==="BarV"){let q=C.width;isNaN(q)&&(q=o);const J=Math.floor((x-o)/o);for(let ot=J;ot<=J+m;ot++){const rt=ot*o+x;0<=rt+q&&rt<=d&&this.W1(ot,O,I,z)&&t.fillRect(rt,0,q,f)}}else if(C.figure==="BarH"){let q=C.height;isNaN(q)&&(q=a);const J=Math.floor((v-a)/a);for(let ot=J;ot<=J+p;ot++){const rt=ot*a+v;0<=rt+q&&rt<=f&&this.W1(ot,O,I,z)&&t.fillRect(0,rt,d,q)}}}K&&t.disableDash(),H!==1&&(t.globalAlpha=V)}}W1(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const a=s[o];if(e%a===i)return!1}return!0}RI(e){const t=[],i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],a=[];if(t.push(a),!o.visible)continue;const l=o.interval;if(l<0)continue;const h=o.figure,d=this.KN(h);for(let f=0;f<s;f++){if(f===n)continue;const m=i[f];if(!m.visible)continue;const p=m.figure;if(this.KN(p)!==d)continue;const b=m.interval;b>l&&a.push(b)}}e.Pe.N0=t}KN(e){return e==="LineV"||e==="BarV"}FI(e){let t=1,i=1;const s=e.D.r,n=s.length;for(let l=0;l<n;l++){const h=s[l],d=Math.abs(h.interval);d<2||(this.KN(h.figure)?i=i*d/B.HL(i,d):t=t*d/B.HL(t,d))}const o=e.gridCellSize,a=e.Pe;a.af.isReal()?a.af.e(i*o.width,t*o.height):a.af=new _(i*o.width,t*o.height)}}le.Tn("Grid",new Vp);class zp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=s.length;if(!(e instanceof Jt||e instanceof Nt))return;let h=null,d=null;if(e instanceof Nt&&(h=e),e instanceof Jt&&(d=e,h=d.adornedPart,e.Af===null&&(e.Af=[])),!(h instanceof Nt))return;const f=h;if(l===0){e.naturalBounds.jn(0,0),e.measuredBounds.e(0,0,0,0);return}const m=e instanceof Jt?null:h.path,p=h.routeBounds,b=e.Zo;b.e(0,0,p.width,p.height);const x=f.points,v=h.pointsCount;d!==null?d.Td(!1):h!==null&&h.Td(!1);const S=p.width,P=p.height,T=e.Af;if(T.length=0,m!==null){this.measureLinkPath(e,S,P,m);const R=m.measuredBounds;b.unionRect(R),T.push(R)}const A=lt.l(),C=L.l(),O=L.l();for(let R=0;R<l;R++){const I=s[R];if(I===m)continue;let H=I.measuredBounds;if(I.isPanelMain&&I instanceof Xt){this.measureLinkPath(e,S,P,I),H=I.measuredBounds,b.unionRect(H),T.push(H);continue}if(v<2){I.ht(1/0,1/0,0,0),H=I.measuredBounds,b.unionRect(H),T.push(H);continue}const V=I.segmentIndex,z=I.segmentFraction;let K=I.alignmentFocus;K.isNoSpot()&&(K=X.Center);const $=I.segmentOrientation,q=I.segmentOffset;let J=0,ot=0,rt=0,st=0;if(isNaN(V)){const xt=f.ut,Ot=r.nt();xt.getPointAndAngleAlongPath(z,Ot);const Le=L.z(Ot[0],Ot[1]);st=Ot[2],$!==0&&(rt=f.computeAngle(I,$,st),I.Xt=rt,I.xi(!0),I.ao(!0)),J=Le.x,ot=Le.y,L.i(Le),r.Z(Ot)}else if(V<-v||V>=v){const xt=L.l();f.HN(xt),st=f.midAngle,$!==0&&(rt=f.computeAngle(I,$,st),I.Xt=rt,I.xi(!0),I.ao(!0)),J=xt.x-p.x,ot=xt.y-p.y,L.i(xt)}else{let xt,Ot,Le=0;if(V>=0?(xt=x.elt(V),Ot=V<v-1?x.elt(V+1):xt):(Le=v+V,xt=x.elt(Le),Ot=Le>0?x.elt(Le-1):xt),xt.equalsApprox(Ot)){let te,vt;V>=0?(te=V>0?x.elt(V-1):xt,vt=V<v-2?x.elt(V+2):Ot):(te=Le<v-1?x.elt(Le+1):xt,vt=Le>1?x.elt(Le-2):Ot);const mt=te.distanceSquaredPoint(xt),Vt=Ot.distanceSquaredPoint(vt);mt>Vt+10?st=V>=0?te.directionPoint(xt):xt.directionPoint(te):Vt>mt+10?st=V>=0?Ot.directionPoint(vt):vt.directionPoint(Ot):st=V>=0?te.directionPoint(vt):vt.directionPoint(te)}else st=V>=0?xt.directionPoint(Ot):Ot.directionPoint(xt);$!==0&&(rt=f.computeAngle(I,$,st),I.Xt=rt,I.xi(!0),I.ao(!0)),J=xt.x+(Ot.x-xt.x)*z-p.x,ot=xt.y+(Ot.y-xt.y)*z-p.y}I.ht(1/0,1/0,0,0),H=I.measuredBounds;const ht=I.naturalBounds;let pt=0;I instanceof Xt&&(pt=I.strokeWidth);const zt=ht.width+pt,kt=ht.height+pt;A.Ue(),A.Gs(-H.x,-H.y),A.it(I.scale,I.scale),A.ks($===0?I.angle:st,zt/2,kt/2),($===22||$===26)&&A.ks(90,zt/2,kt/2),($===23||$===27)&&A.ks(-90,zt/2,kt/2),$===28&&(st>45&&st<135||st>225&&st<315)&&A.ks(-st,zt/2,kt/2);const Mt=new Y(0,0,zt,kt);C.setRectSpot(Mt,K),A.gt(C);const St=-C.x+pt/2*I.scale,Ct=-C.y+pt/2*I.scale;O.h(q);const Qt=isNaN(q.x),Wt=isNaN(q.y);if(Qt||Wt){const xt=zt/2+Nt.J1,Ot=kt/2+Nt.J1,Le=st>=45&&st<=135,te=st>=225&&st<=315;$===0&&(Le||te)?(O.x=Wt?xt:q.y,O.y=Qt?Ot:q.x,Le?V>=0||isNaN(V)&&z<.5||Qt&&(O.y=-Ot):te&&((V>=0||isNaN(V)&&z<.5)&&Qt&&(O.y=-Ot),Wt&&(O.x=-xt))):(Qt&&(V>=0||isNaN(V)&&z<.5?O.x=xt:O.x=-xt),Wt&&(O.y=-Ot),O.rotate(st))}else O.rotate(st);J+=O.x,ot+=O.y,Mt.e(J+St,ot+Ct,H.width,H.height),T.push(Mt),b.unionRect(Mt)}if(h!==null){const R=h.labelNodes;for(;R.next();)R.value.ht(1/0,1/0)}e.Zo=b,e.position.e(p.x+b.x,p.y+b.y),n.jn(b.width||0,b.height||0),lt.i(A),L.i(C),L.i(O)}arrange(e,t,i){const s=t.length;if(!(e instanceof Jt||e instanceof Nt))return;let n=e,o=null;e instanceof Jt&&(o=e,n=o.adornedPart);const a=e,l=e instanceof Jt?null:n.path,h=e.Af;if(h.length!==0){let p=0;if(l!==null&&p<h.length){const b=h[p];p++,l.Ut(b.x-a.Zo.x,b.y-a.Zo.y,b.width,b.height)}for(let b=0;b<s;b++){const x=t[b];if(x!==l&&p<h.length){const v=h[p];p++,x.Ut(v.x-a.Zo.x,v.y-a.Zo.y,v.width,v.height)}}}const d=n.points,f=d.count;if(f>=2&&a instanceof Nt){const p=a.labelNodes;for(;p.next();){const b=p.value;a.II(b,f,d)}}o!==null?o.Td(!1):n.Td(!1);const m=e.cD(L.l());e.location.e(e.position.x+m.x,e.position.y+m.y),L.i(m)}measureLinkPath(e,t,i,s){if(s.Go()===!1)return;let n=s.strokeWidth;if(n===0&&e instanceof Jt&&e.type===Lt.Link&&e.adornedObject instanceof Xt&&(n=e.adornedObject.strokeWidth),n=n*s.it,e instanceof Nt&&e.ut!==null){const o=e.geometry.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(e instanceof Jt&&e.adornedPart.ut!==null){const o=e.adornedPart.ut.bounds;s.lo(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.lo(-(n/2),-(n/2),t+n,i+n);s.EI(),s.xi(!1)}}le.Tn("Link",new zp);class jp extends le{constructor(){super()}measure(e,t,i,s,n,o,a){const l=e.findMainElement();if(!(l instanceof Xt))return;e.ts=[];const h=l.margin,d=h.right+h.left,f=h.top+h.bottom;l.ht(t,i,o,a);const m=l.measuredBounds,p=m.width,b=m.height,x=Math.max(p+d,0),v=Math.max(b+f,0),S=new Y(-h.left,-h.top,x,v);e.ts.push(S),n.h(S),this.determineGraduatedMarks(e,l);const P=e.Fs;if(P===null)return;const T=s.length;for(let A=0;A<T;A++){const C=s[A],O=P[A];!C.visible||C===l||O.length===0||(C instanceof Xt?this.measureGraduatedTicks(e,C,O,n):C instanceof Se&&this.measureGraduatedLabels(e,C,O,n),C.xi(!1))}}arrange(e,t,i){if(e.ts===null)return;const s=e.findMainElement(),n=e.Fs;if(n===null)return;const o=e.ts;let a=0,l=o[a];a++,s!==null&&s.Ut(l.x-i.x,l.y-i.y,l.width,l.height);const h=t.length;for(let d=0;d<h;d++){const f=t[d],m=n[d];!f.visible||f===s||m.length===0||(l=o[a],a++,f.Ut(l.x-i.x,l.y-i.y,l.width,l.height))}e.ts=null}measureGraduatedTicks(e,t,i,s){let n=t.alignmentFocus;n.isNoSpot()&&(n=X.TopCenter);const o=t.angle;t.Xt=0,t.ht(1/0,1/0,0,0),t.Xt=o;const a=t.measuredBounds,l=a.width,h=a.height,d=Y.z(0,0,l,h),f=L.l();f.setRectSpot(d,n),Y.i(d);const m=-f.x,p=-f.y,b=new Y,x=i.length;for(let v=0;v<x;v++){const S=i[v],P=S.pt.x,T=S.pt.y,A=S.angle;for(let C=0;C<4;C++){switch(C){case 0:f.e(m,p);break;case 1:f.e(m+l,p);break;case 2:f.e(m,p+h);break;case 3:f.e(m+l,p+h);break}f.rotate(A+t.angle),f.offset(P,T),v===0&&C===0?b.e(f.x,f.y,0,0):b.unionPoint(f),f.offset(-P,-T),f.rotate(-A-t.angle)}}L.i(f),e.ts!==null&&e.ts.push(b),s.re(b.x,b.y,b.width,b.height)}measureGraduatedLabels(e,t,i,s){e.vi===null&&(e.vi=new Se);const n=e.vi;this.fD(t,n);let o=t.alignmentFocus;o.isNoSpot()&&(o=X.TopCenter);const a=t.segmentOrientation,l=t.segmentOffset,h=new Y;let d=0,f=0,m=0,p=0,b=0;const x=i.length;for(let v=0;v<x;v++){const S=i[v];d=S.pt.x,f=S.pt.y,m=S.angle,p=t.angle,b=t.angle,a!==0&&(a===21||a===25?b=m+t.angle:b=m,p=Nt.computeAngle(a,b)),n.Xt=p,n.text=S.text||"",n.ht(1/0,1/0,0,0);const P=n.measuredBounds,T=n.naturalBounds,A=T.width,C=T.height,O=lt.l();O.Ue(),O.Gs(-P.x,-P.y),O.it(n.scale,n.scale),O.ks(b,A/2,C/2),(a===22||a===26)&&O.ks(90,A/2,C/2),(a===23||a===27)&&O.ks(-90,A/2,C/2),a===28&&(m>45&&m<135||m>225&&m<315)&&O.ks(-m,A/2,C/2);const R=Y.z(0,0,A,C),I=L.l();I.setRectSpot(R,o),O.gt(I);const H=-I.x,V=-I.y,z=L.l();z.h(l),isNaN(z.x)&&(z.x=A/2+3),isNaN(z.y)&&(z.y=-(C/2+3)),z.rotate(m),d+=z.x+H,f+=z.y+V;const K=new Y(d,f,P.width,P.height),$=new Y(P.x,P.y,P.width,P.height),q=new Y(T.x,T.y,T.width,T.height);S.labelAngle=p,S.lineCount=n.lineCount,S.lines=n.getMetrics(),S.actualBounds=K,S.measuredBounds=$,S.naturalBounds=q,v===0?h.h(K):h.unionRect(K),L.i(z),L.i(I),Y.i(R),lt.i(O)}e.ts!==null&&e.ts.push(h),s.re(h.x,h.y,h.width,h.height)}determineGraduatedMarks(e,t){const i=t.geometry,s=t.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,a=i.flattenedTotalLength,l=n.length;let h=0,d=0;const f=r.nt();for(let T=0;T<l;T++){const A=n[T],C=[];h=0,d=0;const O=A.length;for(let R=0;R<O;R+=2){const I=A[R],H=A[R+1];if(R===0){h=I,d=H;continue}let V=Math.atan2(H-d,I-h)*180/Math.PI;V<0&&(V+=360),C.push(V),h=I,d=H}f.push(C)}const m=this.UI(e),p=e.D.r,b=p.length;let x=0,v=0,S=a;e.Fs=[];let P;for(let T=0;T<b;T++){const A=p[T];if(P=[],!A.visible||A===t){e.Fs.push(P);continue}const C=Math.abs(A.interval),O=e.graduatedTickUnit;if(O*C*a/e.graduatedRange<2&&A.graduatedSkip===null){e.Fs.push(P);continue}let R=o[0][0],I=0,H=0;v=a*A.graduatedStart-1e-4,S=a*A.graduatedEnd+1e-4;const V=O*C;let z=e.graduatedTickBase;if(z<e.graduatedMin){let J=(e.graduatedMin-z)/V;J=J%1===0?J:Math.floor(J+1),z+=J*V}else if(z>e.graduatedMin+V){const J=Math.floor((z-e.graduatedMin)/V);z-=J*V}const K=m[T],$=z,q=e.graduatedMax*1e-6;for(let J=1;z<=e.graduatedMax+q;J++){if(this.VI(e,z-e.graduatedTickBase,K)&&(z>e.graduatedMax&&(z=e.graduatedMax),(A.graduatedSkip===null||A instanceof Se&&!A.graduatedSkip(z,A)||A instanceof Xt&&!A.graduatedSkip(z,A))&&(x=(z-e.graduatedMin)*a/e.graduatedRange,x>a&&(x=a),v<=x&&x<=S))){let ot=f[I][H],rt=o[I][H];for(;I<o.length;){for(;x>R&&H<o[I].length-1;)H++,ot=f[I][H],rt=o[I][H],R+=rt;if(x<=R)break;I++,H=0,ot=f[I][H],rt=o[I][H],R+=rt}const st=n[I],ht=st[H*2],pt=st[H*2+1],zt=st[H*2+2],kt=st[H*2+3],Mt=(x-(R-rt))/rt,St=new L(ht+(zt-ht)*Mt+s/2-i.bounds.x,pt+(kt-pt)*Mt+s/2-i.bounds.y);if(St.scale(t.scale,t.scale),ot=this.BI(ot,Mt,st,f[I],H),A instanceof Se){let Ct="";A.graduatedFunction!==null?(Ct=A.graduatedFunction(z,A),Ct=Ct!=null?Ct.toString():""):Ct=(+z.toFixed(2)).toString(),Ct!==""&&P.push({pt:St,angle:ot,text:Ct})}else P.push({pt:St,angle:ot})}z=$+J*V}e.Fs.push(P)}r.Z(f)}BI(e,t,i,s,n){if(t<.5005&&t>.4995)return e;let o=e;if(t<.5?n>0?o=s[n-1]:B.X(i[0],i[i.length-2])&&B.X(i[1],i[i.length-1])&&(o=s[s.length-1]):t>.5&&(n+1<s.length?o=s[n+1]:B.X(i[0],i[i.length-2])&&B.X(i[1],i[i.length-1])&&(o=s[0])),e!==o){let a=Math.abs(e-o);if(a>180&&(e<o?e+=360:o+=360,a=Math.abs(e-o)),t<5e-4||t>.9995)return(e+o)/2%360;if(a<10){const l=1-Math.abs(.5-t);return(e*l+o*(1-l))%360}}return e}UI(e){if(e.ds===null){const t=[],i=e.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],a=[];if(t.push(a),!o.visible)continue;const l=o.interval;if(!(l<0))for(let h=0;h<s;h++){if(h===n)continue;const d=i[h];if(!d.visible||o.constructor!==d.constructor)continue;const f=d.interval;f>l&&a.push(f)}}e.ds=t}return e.ds}VI(e,t,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*e.graduatedTickUnit,a=t%o,l=e.graduatedTickUnit*1e-6;if(a<l&&a>-l)return!1}return!0}Ge(e,t,i){const s=i.ph;i.ph=!0;const n=e.naturalBounds,o=n.width,a=n.height,l=t instanceof Ri;t.save(),t.beginPath(),t.rect(-1,-1,o+1,a+1),t.clip(),t.endPath();const h=e.findMainElement();h.Ge(t,i);let d=e.getDocumentScale()*i.scale;d<=0&&(d=1);const f=h.actualBounds,m=e.D.r,p=e.Fs,b=m.length;for(let x=0;x<b;x++){const v=m[x],S=p[x],P=S.length;if(!(!v.visible||v===h||S.length===0)){if(v instanceof Xt){if(e.graduatedTickUnit*v.interval*h.geometry.flattenedTotalLength/e.graduatedRange*d<2&&v.graduatedSkip===null)continue;const T=v.measuredBounds,A=v.strokeWidth*v.scale;let C=v.alignmentFocus;C.isNoSpot()&&(C=X.TopCenter);for(let O=0;O<P;O++){const R=S[O].pt,I=S[O].angle;this.zI(v,R,f,I,T,A,C),v.Ge(t,i),l&&(e.svg.appendChild(v.svg),v.svg=null),v.il.Ue()}}else if(v instanceof Se){e.vi===null&&(e.vi=new Se);const T=e.vi;this.fD(v,T),T.jN=!0;for(let A=0;A<P;A++){const C=S[A];if(C.actualBounds&&C.measuredBounds&&C.naturalBounds){T.XI(C);const O=C.actualBounds;T.Ut(O.x,O.y,O.width,O.height),this.GI(T,f,O,C.measuredBounds,C.naturalBounds),T.nl=v.part,T.Zs=v.panel,T.Ge(t,i),T.Zs=null,T.nl=null,l&&(e.svg.appendChild(T.svg),T.svg=null)}}}}}i.ph=s,t.restore(),t.clearContextCache(!0)}zI(e,t,i,s,n,o,a){const l=e.il;l.Ue(),l.Gs(t.x+i.x,t.y+i.y),l.ks(s+e.angle,0,0),l.Gs(-n.width*a.x+a.offsetX+o/2,-n.height*a.y+a.offsetY+o/2),l.it(e.scale,e.scale),e.Sd(!1),e.wa.set(e.il),e.Th=e.scale,e.Uh(!1)}GI(e,t,i,s,n){const o=e.il;o.Ue(),o.Gs(i.x+t.x,i.y+t.y),o.Gs(-s.x,-s.y),e.Kp(o,n.x,n.y,n.width,n.height),e.Sd(!1),e.wa.set(e.il),e.Th=e.scale,e.Uh(!1)}fD(e,t){t.YI(e)}}le.Tn("Graduated",new jp);var Gu=(M=>(M[M.Uniform=6]="Uniform",M[M.UniformToFill=7]="UniformToFill",M))(Gu||{});const Tt=class Tt extends Ht{constructor(t,i){super();y(this,"W");y(this,"D");y(this,"Qt");y(this,"Dd");y(this,"Qn");y(this,"ll");y(this,"uo");y(this,"Zo");y(this,"qN");y(this,"O");y(this,"vd");y(this,"ot");y(this,"Pe");y(this,"te");y(this,"Fd");y(this,"Aa");y(this,"tn");if(t===void 0)this.W=Tt.Position;else if(typeof t=="string"){const s=le.fs.get(t);s!==null?this.W=s:r.o("PanelLayout not loaded: "+t)}else t instanceof le?this.W=t:(this.W=Tt.Position,t&&(i=t));this.n|=4194304|(this.W===Tt.Grid?1048576:0),this.D=new E,this.Qt=ct.im,this.Dd=X.Default,this.Qn=1,this.ll=null,this.uo="",this.Zo=new Y(NaN,NaN,NaN,NaN),this.qN=null,this.O=null,this.vd=6,this.Pe=null,this.ot=null,this.te=null,this.Fd=NaN,this.Aa=null,this.tn=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.W=this.W,t.Qt=this.Qt.N(),t.Dd=this.Dd.N(),t.Qn=this.Qn,t.uo=this.uo,t.Zo.h(this.Zo),this.O!==null&&(t.O=this.O.copy(t)),t.vd=this.vd,this.ot!==null&&(t.ot=this.ot.copy()),this.Pe!==null&&(t.Pe=this.Pe.copy()),t.te=this.te,t.Fd=this.Fd,t.Aa=this.Aa}jo(t){super.jo(t),t.D=this.D;const i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.Zs=t}t.ll=null}copy(){const t=super.copy(),i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].copy();t.KI(o)}return t}toString(){return"Panel("+this.type.name+")#"+F.xs(this)}get type(){return this.W}set type(t){const i=this.W;i!==t&&(this.W=t,this.Tf=this.W===Tt.Grid,this.c(),this.t("type",i,t))}get elements(){return this.D.iterator}get naturalBounds(){return this.Ke}get padding(){return this.Qt}set padding(t){typeof t=="number"?(t<0&&r.J(t,">= 0",Tt,"padding"),t=new ct(t)):(t.left<0&&r.J(t.left,">= 0",Tt,"padding:value.left"),t.right<0&&r.J(t.right,">= 0",Tt,"padding:value.right"),t.top<0&&r.J(t.top,">= 0",Tt,"padding:value.top"),t.bottom<0&&r.J(t.bottom,">= 0",Tt,"padding:value.bottom"));const i=this.Qt;i.equals(t)||(t=t.N(),this.Qt=t,this.c(),this.t("padding",i,t))}get defaultAlignment(){return this.Dd}set defaultAlignment(t){const i=this.Dd;i.equals(t)||(t=t.N(),this.Dd=t,this.c(),this.t("defaultAlignment",i,t))}get defaultStretch(){return this.Qn}set defaultStretch(t){const i=this.Qn;i!==t&&(this.Qn=t,this.c(),this.t("defaultStretch",i,t))}get defaultSeparatorPadding(){return this.O!==null?this.O.C0:ct.im}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new ct(t));const i=this.defaultSeparatorPadding;i.equals(t)||(t=t.N(),this.O===null&&(this.O=new Ni),this.O.C0=t,this.c(),this.t("defaultSeparatorPadding",i,t))}get defaultRowSeparatorStroke(){return this.O!==null?this.O.L0:null}set defaultRowSeparatorStroke(t){const i=this.defaultRowSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof me)&&(t instanceof me&&t.k(),this.O===null&&(this.O=new Ni),this.O.L0=t,this.C(),this.t("defaultRowSeparatorStroke",i,t))}get defaultRowSeparatorStrokeWidth(){return this.O!==null?this.O.A0:1}set defaultRowSeparatorStrokeWidth(t){const i=this.defaultRowSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new Ni),this.O.A0=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",i,t))}get defaultRowSeparatorDashArray(){return this.O!==null?this.O.T0:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&r.si(t,"Array",Tt,"defaultRowSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const a=t[o];(typeof a!="number"||!(a>=0)||!isFinite(a))&&r.o("defaultRowSeparatorDashArray value "+a+" at index "+o+" must be a positive number or zero."),n+=a}if(n===0){if(i===null)return;t=null}}this.O===null&&(this.O=new Ni),this.O.T0=t,this.C(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return this.O!==null?this.O.D0:null}set defaultColumnSeparatorStroke(t){const i=this.defaultColumnSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof me)&&(t instanceof me&&t.k(),this.O===null&&(this.O=new Ni),this.O.D0=t,this.C(),this.t("defaultColumnSeparatorStroke",i,t))}get defaultColumnSeparatorStrokeWidth(){return this.O!==null?this.O.v0:1}set defaultColumnSeparatorStrokeWidth(t){const i=this.defaultColumnSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new Ni),this.O.v0=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",i,t))}get defaultColumnSeparatorDashArray(){return this.O!==null?this.O.F0:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&r.si(t,"Array",Tt,"defaultColumnSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const a=t[o];(typeof a!="number"||!(a>=0)||!isFinite(a))&&r.o("defaultColumnSeparatorDashArray value "+a+" at index "+o+" must be a positive number or zero."),n+=a}if(n===0){if(i===null)return;t=null}}this.O===null&&(this.O=new Ni),this.O.F0=t,this.C(),this.t("defaultColumnSeparatorDashArray",i,t)}}get La(){return this.O!==null?this.O.La:null}set La(t){this.O===null&&(this.O=new Ni),this.O.La=t}get viewboxStretch(){return this.vd}set viewboxStretch(t){const i=this.vd;i!==t&&(this.vd=t,this.c(),this.t("viewboxStretch",i,t))}get gridCellSize(){return this.Pe!==null?this.Pe.Rd:_.OL}set gridCellSize(t){this.Pe===null&&(this.Pe=new xo);const i=this.Pe.Rd;if(!i.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&r.o("Invalid Panel.gridCellSize: "+t),this.Pe.Rd=t.N();const s=this.diagram;s!==null&&this===s.grid&&s.ca(),this.C(),this.t("gridCellSize",i,t)}}get gridOrigin(){return this.Pe!==null?this.Pe.Od:L.gn}set gridOrigin(t){this.Pe===null&&(this.Pe=new xo);const i=this.Pe.Od;if(!i.equals(t)){t.isReal()||r.o("Invalid Panel.gridOrigin: "+t),this.Pe.Od=t.N();const s=this.diagram;s!==null&&this===s.grid&&s.ca(),this.C(),this.t("gridOrigin",i,t)}}get graduatedMin(){return this.ot!==null?this.ot.R0:0}set graduatedMin(t){const i=this.graduatedMin;if(i!==t&&(this.ot===null&&(this.ot=new Is),this.ot.R0=t,this.c(),this.t("graduatedMin",i,t),this.mf())){const s=this.part;s!==null&&this.Eh(s,"graduatedRange")}}get graduatedMax(){return this.ot!==null?this.ot.O0:100}set graduatedMax(t){const i=this.graduatedMax;if(i!==t&&(this.ot===null&&(this.ot=new Is),this.ot.O0=t,this.c(),this.t("graduatedMax",i,t),this.mf())){const s=this.part;s!==null&&this.Eh(s,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.ot!==null?this.ot.I0:10}set graduatedTickUnit(t){const i=this.graduatedTickUnit;i!==t&&t>0&&(this.ot===null&&(this.ot=new Is),this.ot.I0=t,this.c(),this.t("graduatedTickUnit",i,t))}get graduatedTickBase(){return this.ot!==null?this.ot.E0:0}set graduatedTickBase(t){const i=this.graduatedTickBase;i!==t&&(this.ot===null&&(this.ot=new Is),this.ot.E0=t,this.c(),this.t("graduatedTickBase",i,t))}get Fs(){return this.ot!==null?this.ot.Fs:null}set Fs(t){this.ot!==null?this.ot.Fs=t:t!==null&&(this.ot=new Is,this.ot.Fs=t)}get ts(){return this.ot!==null?this.ot.ts:null}set ts(t){this.ot!==null?this.ot.ts=t:t!==null&&(this.ot=new Is,this.ot.ts=t)}get ds(){return this.ot!==null?this.ot.ds:null}set ds(t){this.ot!==null?this.ot.ds=t:t!==null&&(this.ot=new Is,this.ot.ds=t)}get vi(){return this.ot!==null?this.ot.vi:null}set vi(t){this.ot!==null?this.ot.vi=t:t!==null&&(this.ot=new Is,this.ot.vi=t)}Wp(t){super.Wp(t);const i=this.D.r,s=i.length;for(let n=0;n<s;n++)i[n].Wp(t)}Ma(t,i){if(this.W===Tt.Grid){t.commitTransform(),this.W.Ge(this,t,i);return}if(this.W===Tt.Graduated){t.commitTransform(),this.W.Ge(this,t,i);return}if(this.W===Tt.Table)if(t.commitTransform(),t instanceof Ri){const l=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.WN(t,i),t.endGroup(),t.currentElement=l}else this.WN(t,i);const s=this.isClipping&&this.W===Tt.Spot;s&&t.save();const n=this.findMainElement(),o=this.D.r,a=o.length;for(let l=0;l<a;l++){const h=o[l];s&&h===n&&(t.clipInsteadOfFill=!0),h.Ge(t,i),s&&h===n&&(t.clipInsteadOfFill=!1)}s&&(t.restore(),t.clearContextCache(!0))}WN(t,i){t.lineCap="butt";const s=this.rowCount>0?this.Qi:null,n=this.columnCount>0?this._i:null;s!==null&&this.$1(t,i,!0,s,!0),n!==null&&this.$1(t,i,!1,n,!0),s!==null&&this.uD(t,!0,s),n!==null&&this.uD(t,!1,n),s!==null&&this.$1(t,i,!0,s,!1),n!==null&&this.$1(t,i,!1,n,!1)}uD(t,i,s){const n=s.length,o=this.actualBounds,a=this.naturalBounds;let l=!0;for(let h=0;h<n;h++){const d=s[h];if(d===void 0||d.actual===0)continue;if(l){l=!1;continue}if(i){if(d.position>a.height)continue}else if(d.position>a.width)continue;let f=d.separatorStrokeWidth;isNaN(f)&&(f=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let m=d.separatorStroke;if(m===null&&(m=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),f===0||m===null)continue;this.kn(t,m,!1,!1,a,o);let p=!1,b=d.separatorDashArray;b===null&&(b=i?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),b!==null&&(p=!0,t.enableDash(b,0)),t.beginPath();const x=d.position+f;i?x>a.height&&(f-=x-a.height):x>a.width&&(f-=x-a.width);let v=d.position+f/2;t.lineWidth=f;const S=this.Qt;if(i){v+=S.top;const P=S.left,T=a.width-S.right;t.moveTo(P,v),t.lineTo(T,v)}else{v+=S.left;const P=S.top,T=a.height-S.bottom;t.moveTo(v,P),t.lineTo(v,T)}t.stroke(),t.endPath(),p&&t.disableDash()}}$1(t,i,s,n,o){const a=n.length,l=this.actualBounds,h=this.naturalBounds,d=this.dD(!0),f=this.dD(!1);for(let m=0;m<a;m++){const p=n[m];if(p===void 0||p.background===null||p.coversSeparators===o||p.actual===0)continue;const b=s?l.height:l.width;if(p.position>b)continue;let x=p.computeEffectiveSpacing(),v=p.separatorStrokeWidth;isNaN(v)&&(v=s?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let S=p.separatorStroke;S===null&&(S=s?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(S===null||p.index===(s?d:f))&&(v=0),x-=v;const P=p.position+v;let T=x+p.actual;if(P+T>b&&(T=b-P),T<=0)continue;const A=this.Qt;this.kn(t,p.background,!0,!1,h,l),s?t.fillRect(A.left,P+A.top,l.width-(A.left+A.right),T):t.fillRect(P+A.left,A.top,T,l.height-(A.top+A.bottom))}}dD(t){const i=t?this.rowCount:this.columnCount;for(let s=0;s<i;s++){const n=t?this.Qi[s]:this._i[s];if(n!==void 0)return n.index}return 0}xf(){const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].xf();this.$i(!0)}wf(t,i,s){const n=this.svg;if(n===null)return!1;if(this.type===Tt.Table){const l=n.getElementsByClassName("gojs-ts"),h=l.length!==0?l[0]:null;h!==null&&(h.innerHTML=""),t.currentElement=h,this.WN(t,i),t.currentElement=null}else{if(this.W===Tt.Grid||this.W===Tt.Graduated)return n.innerHTML="",n.remove(),!1;if(this.W===Tt.Spot&&this.isClipping)return n.innerHTML="",n.remove(),this.xa=null,this.xf(),!1}if(!super.wf(t,i,s))return!1;const o=this.D.r,a=o.length;for(let l=0;l<a;l++)o[l].Ge(t,i);return!0}Pd(t){return!0}$p(t,i,s,n){if(!this.isClipping){if(this._s()&&t.partClipRect!==null){const o=t.partClipRect,a=this.D.r;let l=0,h=0;for(let d=0;d<a.length;d++){if(!a[d].isVisibleObject())continue;const f=a[d].actualBounds;l=d===0?f.x:Math.min(f.x,l),h=d===0?f.y:Math.min(f.y,h)}n.setAttributeNS(null,"clip-path",`path('M ${o.x-s.x-l},${o.y-s.y-h} l ${o.width} 0 l 0 ${o.height} l -${o.width} 0 z')`);return}super.$p(t,i,s,n)}}pf(t,i,s,n,o){const a=this.Nn(),l=this.v,h=1/(l.m11*l.m22-l.m12*l.m21);let d=l.m22*h,f=-l.m12*h,m=-l.m21*h,p=l.m11*h,b=h*(l.m21*l.dy-l.m22*l.dx),x=h*(l.m12*l.dx-l.m11*l.dy);if(this.background!==null){const v=t*d+i*m+b,S=t*f+i*p+x,P=s*d+n*m+b,T=s*f+n*p+x;o.e(0,0);const A=this.naturalBounds,C=B.Cl(0,0,A.width,A.height,v,S,P,T,o);return o.v(l),C}else{a||(d=1,f=0,m=0,p=1,b=0,x=0);const v=t*d+i*m+b,S=t*f+i*p+x,P=s*d+n*m+b,T=s*f+n*p+x;o.e(P,T);let A=(P-v)**2+(T-S)**2,C=!1;const O=this.D.r,R=O.length,I=L.l();let H=null,V=1/0,z=null;const K=this.isClipping&&this.W===Tt.Spot;K&&(z=L.l(),H=this.findMainElement(),C=H.pf(v,S,P,T,z),C&&(V=(v-z.x)**2+(S-z.y)**2));for(let $=0;$<R;$++){const q=O[$];if(!q.visible||q===H||!q.pf(v,S,P,T,I))continue;C=!0;const J=(v-I.x)**2+(S-I.y)**2;J<A&&(A=J,o.set(I))}return K&&(V>A&&o.set(z),L.i(z)),L.i(I),a&&o.v(l),C}}Wc(){const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].Wc();super.Wc()}c(t){if(this.Go())return;super.c(t);let i=null;(this.W===Tt.Auto||this.W===Tt.Link)&&(i=this.findMainElement());const s=this.D.r,n=s.length;for(let o=0;o<n;o++){const a=s[o];if((a===i||a.isPanelMain)&&a.c(!0),a.desiredSize.isReal()||!a.visible)continue;const l=a.Qs(!1);!(a instanceof Ui)&&!(a instanceof Tt)&&!(a instanceof Se)&&l===0||a.c(!0)}}kf(){if(this.Go())return;this.xi(!0),this.ao(!0);const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].kf()}yf(){if(this.B1()===!1){this.Sd(!0),this.Uh(!0);const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].AN()}}AN(){this.Uh(!0);const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].AN()}bd(t,i,s,n){const o=this.Zo;o.e(0,0,0,0);const a=this.desiredSize,l=this.minSize;s===void 0&&(s=l.width,n=l.height),s=Math.max(s,l.width),n=Math.max(n,l.height);const h=this.maxSize;isNaN(a.width)||(t=Math.min(a.width,h.width)),isNaN(a.height)||(i=Math.min(a.height,h.height)),t=Math.max(s,t),i=Math.max(n,i);const d=this.Qt;t=Math.max(t-d.left-d.right,0),i=Math.max(i-d.top-d.bottom,0);const f=this.D.r;this.W.measure(this,t,i,f,o,s,n);let m=o.width+d.left+d.right,p=o.height+d.top+d.bottom;isFinite(a.width)&&(m=a.width),isFinite(a.height)&&(p=a.height),m=Math.min(h.width,m),p=Math.min(h.height,p),m=Math.max(l.width,m),p=Math.max(l.height,p),m=Math.max(s,m),p=Math.max(n,p),o.jn(m,p),this.naturalBounds.jn(m,p),this.lo(0,0,m,p)}findMainElement(){if(this.ll===null){const t=this.D.r,i=t.length;if(i===0)return null;for(let s=0;s<i;s++){const n=t[s];if(n.isPanelMain===!0)return this.ll=n,n}this.ll=t[0]}return this.ll}$o(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.qN}set panelLayoutState(t){this.qN=t}Pa(t,i,s,n){const o=this.D.r;if(this.actualBounds.e(t,i,s,n),!this.desiredSize.isReal()){let a=this.Qs(!0);const l=this.measuredBounds,h=l.width,d=l.height,f=this.sl,m=f.left+f.right,p=f.top+f.bottom;switch(h===s&&d===n&&(a=0),a){case 0:(h>s||d>n)&&(this.c(),this.ht(h>s?s:h,d>n?n:d,0,0));break;case 2:this.c(!0),this.ht(s+m,n+p,0,0);break;case 5:this.c(!0),this.ht(s+m,d+p,0,0);break;case 4:this.c(!0),this.ht(h+m,n+p,0,0);break}}this.W.arrange(this,o,this.Zo)}ka(t){const i=this.naturalBounds,s=this.$o();if(Y.contains(0,0,i.width,i.height,t.x,t.y)){const n=this.D.r,o=n.length,a=L.z(0,0);for(let l=o;l--;){const h=n[l];if(!(!h.visible&&h!==s)&&(a.set(t).Ki(h.v),h.containsPoint(a)))return L.i(a),!0}return L.i(a),this.Lt!==null}return!1}Yp(t){if(this.oo===t)return this;const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].Yp(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,i){if(i(this,t),t instanceof Tt){const s=t.D.r,n=s.length;for(let o=0;o<n;o++)this.walkVisualTreeFrom(s[o],i)}}Sn(t){this.gD(this,t)}gD(t,i){i(t);const s=t.D.r,n=s.length;for(let o=0;o<n;o++){const a=s[o];a instanceof Tt&&this.gD(a,i)}}HI(t){this.mD(this,t)}mD(t,i){if(i(t),t instanceof Tt){const s=t.D.r,n=s.length;for(let o=0;o<n;o++)this.mD(s[o],i)}}findInVisualTree(t){return this.pD(this,t)}pD(t,i){if(i(t))return t;if(t instanceof Tt){const s=t.D.r,n=s.length;for(let o=0;o<n;o++){const a=this.pD(s[o],i);if(a!==null)return a}}return null}findObject(t){if(this.name===t)return this;const i=this.D.r;let s=i.length;this.jI()&&(s=this.U0());for(let n=0;n<s;n++){const o=i[n];if(o instanceof Tt){const a=o.findObject(t);if(a!==null)return a}if(o.name===t)return o}return null}yD(){const t=this.D.r,i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];o instanceof Tt?s=Math.max(s,o.yD()):o instanceof Xt&&(s=Math.max(s,o.qI()))}return s}Nn(){return!(this.type===Tt.TableRow||this.type===Tt.TableColumn)}ol(){return this.type===Tt.TableRow||this.type===Tt.TableColumn}BA(t,i,s){if(this.pickable===!1||(i===void 0&&(i=null),s===void 0&&(s=null),this.as()))return null;const n=this.naturalBounds,o=1/this.getDocumentScale(),a=this.Nn(),l=a?t:L.z(t.x,t.y).Ki(this.v),h=this.diagram;let d=10,f=5;if(h!==null&&(d=h.getInputOption("extraTouchArea"),f=d/2),Y.contains(-(f*o),-(f*o),n.width+d*o,n.height+d*o,l.x,l.y)){if(!this.Tf){const p=this.D.r,b=p.length,x=L.l(),v=this.isClipping&&this.W===Tt.Spot,S=v?this.findMainElement():null;if(v&&S&&(S.Nn()?x.set(t).Ki(S.v):x.set(t),!S.containsPoint(x)))return L.i(x),a||L.i(l),null;const P=this.$o();for(let T=b;T--;){const A=p[T];if(!A.visible&&A!==P||(A.Nn()?x.set(t).Ki(A.v):x.set(t),v&&A===S))continue;let C=null;if(A instanceof Tt?C=A.BA(x,i,s):A.pickable===!0&&A.containsPoint(x)&&(C=A),C!==null&&(i!==null&&(C=i(C)),C!==null&&(s===null||s(C))))return L.i(x),a||L.i(l),C}L.i(x)}if(this.background===null)return a||L.i(l),null;const m=Y.contains(0,0,n.width,n.height,l.x,l.y)?this:null;return a||L.i(l),m}return a||L.i(l),null}zA(t,i,s,n){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const o=this.naturalBounds,a=this.Nn(),l=a?t:L.z(t.x,t.y).Ki(this.v),h=this.ol(),d=Y.contains(0,0,o.width,o.height,l.x,l.y);if(h||d){if(!this.Tf){const f=this.D.r,m=f.length,p=L.l(),b=this.$o();for(let x=m;x--;){const v=f[x];if(!v.visible&&v!==b)continue;v.Nn()?p.set(t).Ki(v.v):p.set(t);let S=v;const P=v instanceof Tt?v:null;if(P!==null?P.zA(p,i,s,n):S.containsPoint(p)){if(S.pickable===!1)continue;i!==null&&(S=i(S)),S!==null&&(s===null||s(S))&&n.add(S)}}L.i(p)}return a||L.i(l),d&&this.background!==null}return a||L.i(l),!1}Zm(t,i,s,n,o,a){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let l=a;if(l===void 0&&(l=lt.l(),l.Ue()),l.kc(this.v),this.containedInRect(t,l))return this.JN(i,s,o),a===void 0&&lt.i(l),!0;if(this.intersectsRect(t,l)){if(!this.Tf){const h=this.$o(),d=this.D.r,f=d.length;for(let m=f;m--;){const p=d[m];if(!p.visible&&p!==h)continue;const b=p.actualBounds,x=this.naturalBounds;if(b.x>x.width||b.y>x.height||b.x+b.width<0||b.y+b.height<0)continue;let v=p;const S=p instanceof Tt?p:null,P=lt.l();P.set(l),(S!==null?S.Zm(t,i,s,n,o,P):v.JT(t,n,P))&&(i!==null&&(v=i(v)),v!==null&&(s===null||s(v))&&o.add(v)),lt.i(P)}}return a===void 0&&lt.i(l),n}return a===void 0&&lt.i(l),!1}JN(t,i,s){const n=this.D.r,o=n.length;for(let a=o;a--;){const l=n[a];if(!l.visible)continue;const h=l.actualBounds,d=this.naturalBounds;if(h.x>d.width||h.y>d.height||h.x+h.width<0||h.y+h.height<0)continue;l instanceof Tt&&l.JN(t,i,s);let f=l;t!==null&&(f=t(f)),f!==null&&(i===null||i(f))&&s.add(f)}}XA(t,i,s,n,o,a){if(this.pickable===!1)return!1;s===void 0&&(s=null),n===void 0&&(n=null);const l=this.naturalBounds,h=this.Nn(),d=h?t:L.z(t.x,t.y).Ki(this.v),f=h?i:L.z(i.x,i.y).Ki(this.v),m=d.distanceSquaredPoint(f),p=d.x>0&&d.x<l.width&&d.y>0&&d.y<l.height||L.distanceLineSegmentSquared(d.x,d.y,0,0,0,l.height)<=m||L.distanceLineSegmentSquared(d.x,d.y,0,l.height,l.width,l.height)<=m||L.distanceLineSegmentSquared(d.x,d.y,l.width,l.height,l.width,0)<=m||L.distanceLineSegmentSquared(d.x,d.y,l.width,0,0,0)<=m,b=d.distanceSquared(0,0)<=m&&d.distanceSquared(0,l.height)<=m&&d.distanceSquared(l.width,0)<=m&&d.distanceSquared(l.width,l.height)<=m;if(h||(L.i(d),L.i(f)),p){if(!this.Tf){const x=L.l(),v=L.l(),S=this.$o(),P=this.D.r,T=P.length;for(let A=T;A--;){const C=P[A];if(!C.visible&&C!==S)continue;const O=C.actualBounds,R=this.naturalBounds;if(h&&(O.x>R.width||O.y>R.height||O.x+O.width<0||O.y+O.height<0))continue;if(C.Nn()){const V=C.v;x.set(t).Ki(V),v.set(i).Ki(V)}else x.set(t),v.set(i);let I=C;const H=C instanceof Tt?C:null;(H!==null?H.XA(x,v,s,n,o,a):I.$T(x,v,o))&&(s!==null&&(I=s(I)),I!==null&&(n===null||n(I))&&a.add(I))}L.i(x),L.i(v)}return o?p:b}return!1}GN(t){let i=null;if(t instanceof Xt){i=t.spot1,i===X.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot1)}return i===null&&(i=X.TopLeft),i}YN(t){let i=null;if(t instanceof Xt){i=t.spot2,i===X.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot2)}return i===null&&(i=X.BottomRight),i}add(...t){for(let i=0;i<t.length;i++)this.insertAt(this.D.count,t[i]);return this}elt(t){return this.D.elt(t)}insertAt(t,i){i instanceof _t&&r.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&r.o("Cannot make a Panel contain itself: "+this.toString()),r.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const s=i.panel;if(s!==null&&s!==this&&r.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.W===Tt.Grid&&!(i instanceof Xt)&&r.o("Can only add Shapes to a Grid Panel, not: "+i),this.W===Tt.Graduated&&!(i instanceof Xt||i instanceof Se)&&r.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.Vh(this),i.nl=null,this.itemArray!==null){const l=i.data;r.$(l)&&(this.tn===null&&(this.tn=new nt),this.tn.set(l,i))}const n=this.D;let o=-1;if(s===this){let l=-1;const h=this.D.r,d=h.length;for(let f=0;f<d;f++)if(h[f]===i){l=f;break}if(l!==-1){if(l===t||l+1>=n.count&&t>=n.count)return;n.removeAt(l),o=l}else r.o("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),(t===0||i.isPanelMain)&&(this.ll=null),this.Go()||this.c(),i.c(!1),i.portId!==null?this.Ln=!0:i instanceof Tt&&i.Ln===!0&&(this.Ln=!0),this.ds=null,this.isEnabledObject()||this.Z1(i,!1);const a=this.part;if(a!==null){a.s0(),a.Df(),this.Ln&&a instanceof wt&&(a.Ln=!0),a.Ln&&a instanceof wt&&(a.ci=null);const l=this.diagram;if(l!==null&&l.undoManager.isUndoingRedoing)return;o!==-1&&a.raiseChangedEvent(4,"elements",this,i,null,o,null),a.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get Ln(){return(this.n&8388608)!==0}set Ln(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}MN(){return(this.n&16777216)!==0}$N(t){t?this.n|=16777216:this.n&=-16777217}KI(t){t.Vh(this),t.nl=null;const i=this.D,s=i.count;i.insertAt(s,t);const n=this.part;if(n!==null){n.s0(),t.portId!==null&&n instanceof wt&&(n.Ln=!0);const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(3,"elements",this,null,t,null,s)}}cI(t){const i=this.D.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}return n}remove(t){const i=this.D.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}n!==-1&&this.ri(n,!0)}removeAt(t){t>=0&&this.ri(t,!0)}ri(t,i){const s=this.D,n=s.elt(t);if(n.nl=null,n.Vh(null),this.tn!==null){const a=n.data;r.$(a)&&this.tn.delete(a)}s.removeAt(t),this.xi(!1),this.c(),this.ll===n&&(this.ll=null),this.ds=null;const o=this.part;if(o!==null){o.s0(),o.Df(),o.invalidateAdornments(),o instanceof wt&&(n instanceof Tt?n.walkVisualTreeFrom(n,(l,h)=>o.FN(h,i)):o.FN(n,i));const a=this.diagram;if(a!==null&&a.undoManager.isUndoingRedoing)return;o.raiseChangedEvent(4,"elements",this,n,null,t,null)}}get Qi(){return this.O===null&&(this.O=new Ni),this.O.Qi}get rowCount(){return this.O===null?0:this.Qi.length}getRowDefinition(t){t<0&&r.J(t,">= 0",Tt,"getRowDefinition:idx"),t=Math.round(t);const i=this.Qi;if(i[t]===void 0){const s=new ai;s.Vh(this),s.isRow=!0,s.index=t,i[t]=s,this.raiseChangedEvent(3,"rowdefs",this,null,s,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&r.J(t,">= 0",Tt,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const i=this.Qi,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,t,null),this.c()}}xT(t,i){const s=this.Qi;if(!(t<0)){if(s[t]=i instanceof ai?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}get _i(){return this.O===null&&(this.O=new Ni),this.O._i}get columnCount(){return this.O===null?0:this._i.length}getColumnDefinition(t){t<0&&r.J(t,">= 0",Tt,"getColumnDefinition:idx"),t=Math.round(t);const i=this._i;if(i[t]===void 0){const s=new ai;s.Vh(this),s.isRow=!1,s.index=t,i[t]=s,this.raiseChangedEvent(3,"coldefs",this,null,s,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&r.J(t,">= 0",Tt,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const i=this._i,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,t,null),this.c()}}bT(t,i){const s=this._i;if(!(t<0)){if(s[t]=i instanceof ai?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}addRowColumnDefinition(t){let i=null;return t.isRow?i=this.getRowDefinition(t.index):t.isRow||(i=this.getColumnDefinition(t.index)),i&&i.X1(t),this}addRowDefinition(t,i){const s=this.getRowDefinition(t);return s&&s.X1(new ai(i)),this}addColumnDefinition(t,i){const s=this.getColumnDefinition(t);return s&&s.X1(new ai(i)),this}get rowSizing(){return this.O!==null?this.O.V0:3}set rowSizing(t){const i=this.rowSizing;i!==t&&(this.O===null&&(this.O=new Ni),this.O.V0=t,this.c(),this.t("rowSizing",i,t))}get columnSizing(){return this.O!==null?this.O.B0:3}set columnSizing(t){const i=this.columnSizing;i!==t&&(this.O===null&&(this.O=new Ni),this.O.B0=t,this.c(),this.t("columnSizing",i,t))}get topIndex(){return this.O!==null?this.O.z0:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&r.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new Ni),this.O.z0=t,this.c(),this.t("topIndex",i,t))}get leftIndex(){return this.O!==null?this.O.X0:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&r.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new Ni),this.O.X0=t,this.c(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==Tt.Table||this.rowCount===0)return-1;let i=0;const s=this.Qi,n=s.length;let o=this.topIndex;for(;o<n;o++){const a=s[o];if(a!==void 0&&(i+=a.total,t<i))return o}return o}findColumnForLocalX(t){if(t<0||this.type!==Tt.Table||this.columnCount===0)return-1;let i=0;const s=this._i,n=s.length;let o=this.leftIndex;for(;o<n;o++){const a=s[o];if(a!==void 0&&(i+=a.total,t<i))return o}return o}graduatedPointForValue(t,i){if(i===void 0&&(i=new L(NaN,NaN)),this.type!==Tt.Graduated)return i.e(NaN,NaN),i;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const s=this.findMainElement();return s.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,i),s.v.gt(i)}graduatedValueForPoint(t){if(this.type!==Tt.Graduated)return NaN;const i=this.findMainElement();return i.v.Ci(t),i.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.te}set data(t){const i=this.te;if(i!==t){const s=this instanceof _t&&!(this instanceof Jt);s&&r.s(t,"object",Tt,"data"),this.It(),this.te=t;const n=this.diagram;if(n!==null)if(s){n.partManager.WI(this,i,t);let o=this.adornments;for(;o.next();){const a=o.value,l=a.adornedObject;if(l!==null){const h=l.findBindingPanel();h!==null&&(a.data=h.data)}}}else{const o=this.panel;o!==null&&o.tn!==null&&(i!==null&&o.tn.delete(i),t!==null&&o.tn.set(t,this))}if(this.t("data",i,t),n!==null&&n.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.Fd}set itemIndex(t){const i=this.Fd;i!==t&&(this.Fd=t,this.t("itemIndex",i,t))}get vs(){return this.w!==null?this.w.vs:null}set vs(t){this.ve!==t&&(this.w===null&&(this.w=new Un),this.w.vs=t)}RN(){return this.vs!==null}nD(){const t=this.vs;return t!==null&&t.f}freezeBindings(){return this.It()}It(){let t=this.vs;if(t===null)this.data!==null&&r.o("Template cannot have .data be non-null: "+this),this.vs=t=new E;else if(t.f)return this;const i=new E;this.$N(!1),this.walkVisualTreeFrom(this,(o,a)=>{a.ba();const l=a.ve;if(l!==null){a.TN(!1);const h=l.iterator;for(;h.next();){const d=h.value;d.mode===2&&a.TN(!0);const f=d.sourceName;if(d.isToObject){f==="/"&&o.$N(!0);const m=d.WT(o,a);m!==null&&(i.add(m),m.ro===null&&(m.ro=new E),m.ro.add(d))}t.add(d)}}if(a instanceof Tt&&a.type===Tt.Table){if(a.rowCount>0){const h=a.Qi,d=h.length;for(let f=0;f<d;f++){const m=h[f];if(m!==void 0&&m.Rs!==null){const p=m.Rs.iterator;for(;p.next();){const b=p.value;b.Ti=m,b.Id=2,b.vf=m.index,t.add(b)}}}}if(a.columnCount>0){const h=a._i,d=h.length;for(let f=0;f<d;f++){const m=h[f];if(m!==void 0&&m.Rs!==null){const p=m.Rs.iterator;for(;p.next();){const b=p.value;b.Ti=m,b.Id=1,b.vf=m.index,t.add(b)}}}}}});const s=i.iterator;for(;s.next();){const o=s.value;if(o.ro!==null){o.TN(!0);const a=o.ro.iterator;for(;a.next();){const l=a.value;o.ve===null&&(o.ve=new E),o.ve.add(l)}}o.ro=null}let n=t.iterator;for(;n.next();){const o=n.value;let a=o.Ti;if(a!==null){o.Ti=null;const l=o.targetProperty,h=l.indexOf(".");if(h>0&&a instanceof Tt){const d=l.substring(0,h),f=l.substring(h+1),m=a.findObject(d);m!==null?(a=m,o.targetProperty=f):(r.ne('Warning: unable to find GraphObject named "'+d+'" for Binding: '+o.toString()),a=null)}if(a instanceof ai){const d=F.xs(a.panel);o.targetId=d===void 0?-1:d,a.panel.oo=o.targetId}else if(a instanceof Ht){const d=F.xs(a);o.targetId=d===void 0?-1:d,a.oo=o.targetId}else r.o("Unknown type of binding target: "+a);o.check(a)}}return t.k(),this instanceof _t&&this.Di()&&this.ensureBounds(),this}copyTemplate(t){t===void 0&&(t=!1);const i=this.copy();return i.HI(s=>{s instanceof Tt&&(s.vs=null,s.te=null);const n=s.ve;n!==null&&(s.ve=null,n.each(a=>s.bind(a.copy())));const o=s.Ds;o!==null&&(s.Ds=null,o.each(a=>s.trigger(a.value.copy())))}),t&&i.It(),i}updateTargetBindings(t){var o;const i=this.vs;if(i===null)return;t===void 0&&(t="");const s=(o=this.diagram)==null?void 0:o.model,n=i.iterator;for(;n.next();){const a=n.value,l=this.ZN(a,t);if(l===null)continue;const{data:h,elt:d}=l;a.isToTheme&&this.diagram===null||d!==void 0&&a.updateTarget(d,h,void 0,s)}}JI(t){var o;if(t===""){this.updateTargetBindings(t);return}const i=this.vs;if(i===null)return;const s=(o=this.diagram)==null?void 0:o.model,n=i.iterator;for(;n.next();){const a=n.value;if(a.isToData&&a.sourceProperty!=="")continue;const l=this.ZN(a,"");if(l===null)continue;const{data:h,elt:d}=l;d!==void 0&&a.updateTarget(d,h,void 0,s)}}Yo(){if(this.diagram!==null)if(this.RN()){const t=this.diagram.model,i=this.vs.iterator;for(;i.next();){const s=i.value;if(!s.isToTheme)continue;const n=this.ZN(s);if(n===null)continue;const{data:o,elt:a}=n;a!==void 0&&s.updateTarget(a,o,void 0,t)}}else{const t=this.D.r,i=t.length;for(let s=0;s<i;s++)t[s].Yo()}}ZN(t,i=""){const s=t.sourceProperty;if(i!==""&&s!==""&&s!==i)return null;const n=t.targetProperty;if(t.converter===null&&n==="")return null;let o=this.data;const a=t.sourceName;if(t.isToObject){if(o=this.qT(a),o===null)return null}else if(t.isToModel){const f=this.diagram;if(f===null)return null;o=f.model.modelData}let l=this;const h=t.targetId;if(h!==-1){if(l=this.Yp(h),l===null)return null}else t.Ti!==null&&(l=t.Ti);a==="/"?o=l.part:a==="."?o=l:a===".."&&(o=l.panel);const d=t.Id;if(d!==0){if(!(l instanceof Tt))return null;d===1?l=l.getColumnDefinition(t.vf):d===2&&(l=l.getRowDefinition(t.vf))}return{data:o,elt:l}}get itemArray(){return this.Aa}set itemArray(t){const i=this.Aa;if(i!==t||t!==null&&this.$I(t)){const s=this.diagram;if(i!==t&&(s!==null&&i!==null&&s.partManager.C2(this,s),this.Aa=t,s!==null&&t!==null&&s.partManager.N2(this,s)),this.t("itemArray",i,t),s!==null&&s.undoManager.isUndoingRedoing)return;this.wD(i,t)}}findItemPanelForData(t){return t==null||this.tn===null?null:(r.xc(t,Tt,"findItemPanelForData"),this.tn.get(t))}$I(t){const i=this.D.r,s=i.length,n=t.length;let o=0,a=null;for(;o<s&&(a=i[o],!(a instanceof Tt)||a.data===null);)o++,a=i[o];if(s-o!==n)return!0;if(a===null)return n>0;let l=0;for(;o<s&&l<n;){if(a=i[o],!(a instanceof Tt)||a.data!==t[l])return!0;o++,l++}return!1}U0(){if(this.type===Tt.Spot||this.type===Tt.Auto)return Math.min(this.D.length,1);if(this.type===Tt.Link){const t=this.D,i=t.length;let s=0;for(;s<i;s++){const n=t.elt(s);if(!(n instanceof Xt)||!n.isPanelMain)return s}return s}if(this.type===Tt.Table&&this.D.length>0){const t=this.D.elt(0);if(t.isPanelMain&&t instanceof Tt&&t.ol())return 1}return 0}rebuildItemElements(){const t=this.U0();for(;this.D.length>t;)this.ri(this.D.length-1,!1);this.wD(null,this.itemArray)}wD(t,i){const s=this.U0(),n=i;if(n===null||n.length===0){for(;this.D.length>s;)this.ri(this.D.length-1,!1);return}if(this.D.length<=s){const o=n.length;for(let a=0;a<o;a++)this.Q1(n[a],a,!0)}else{let o=s;for(let l=0;l<n.length;l++,o++){const h=n[l],d=o<this.D.length?this.D.elt(o):null;if(d instanceof Tt){if(d.data!==h){const f=this.QN(d.data,l),m=this.QN(h,l);let p=m!==f;if(!p){const b=this._N(d.data,l,f);p=this._N(h,l,m)!==b}p?(this.ri(o,!1),this.Q1(h,l,!1)):d.data=h}}else this.Q1(h,l,!1)}for(;o<this.D.length;)this.ri(o,!1);this.ll=null,this.tC(s,0),this.Go()||this.c(),this.ds=null,this.isEnabledObject()||this.Z1(this,!1);const a=this.part;a!==null&&(a.s0(),a.Df(),this.Ln&&a instanceof wt&&(a.Ln=!0),a.Ln&&a instanceof wt&&(a.ci=null))}}Q1(t,i,s){if(t==null||i<0)return;const n=this.QN(t,i),o=this._N(t,i,n);if(o!==null){o.It();const a=o.copy();if(a.MN()){const h=this.findBindingPanel();h!==null&&h.$N(!0)}r.$(t)&&(this.tn===null&&(this.tn=new nt),this.tn.set(t,a));const l=i+this.U0();this.insertAt(l,a),s&&(a.te=t,this.tC(l,i),a.te=null),a.data=t}}ZI(t){if(t<0)return;const i=t+this.U0();this.ri(i,!0),this.tC(i,t)}tC(t,i){const s=this.D;let n=t,o=i;for(;n<s.length;){const a=s.elt(n);a instanceof Tt&&a.QI(n,o),n++,o++}}QI(t,i){this.type===Tt.TableRow?this.row=t:this.type===Tt.TableColumn&&(this.column=t),this.itemIndex=i}jI(){return this.Aa!==null||this.itemTemplateMap!==null}get itemTemplate(){const t=this.itemTemplateMap;if(t!==null){const i=t.get("");if(i)return i}return Tt.xD()}set itemTemplate(t){const i=this.itemTemplate;if(i!==t){(t instanceof _t||t.isPanelMain)&&r.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap===null&&(this.itemTemplateMap=new nt),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.w!==null?this.w.x0:null}set itemTemplateMap(t){const i=this.itemTemplateMap;if(i!==t){const s=t.iterator;for(;s.next();)s.value;this.Yt().x0=t,this.t("itemTemplateMap",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.w!==null?this.w.b0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&(typeof t!="string"&&!r.st(t)&&r.si(t,"string or function",Tt,"itemCategoryProperty"),this.Yt().b0=t,this.t("itemCategoryProperty",i,t))}QN(t,i){if(t===null)return"";const s=this.itemCategoryProperty;let n="";if(r.st(s))n=s(t);else if(typeof s=="string"&&r.$(t)){if(s==="")return"";const o=this.diagram,a=o!==null?o.model:null;a?n=a.St(t,s):n=Ne.St(t,s)}else return"";if(n===void 0)return"";if(typeof n=="string")return n;r.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+n)}static xD(){return Tt.eC||(Tt.eC=new Tt().add(new Se().bind("text","",r.toString).theme("stroke","text"))),Tt.eC}_N(t,i,s){let n=null;const o=this.itemTemplateMap;return o!==null&&(n=o.get(s),n===null&&(n=o.get(""))),n===null&&(Tt.bD||(Tt.bD=!0,r.ne('No item template Panel found for category "'+s+'" on '+this),r.ne("  Using default item template.")),n=Tt.xD()),n}get Tf(){return(this.n&1048576)!==0}set Tf(t){const i=(this.n&1048576)!==0;i!==t&&(r.s(t,"boolean",Tt,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",i,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const i=(this.n&2097152)!==0;i!==t&&(this.xf(),this.n=this.n^2097152,this instanceof Ft&&(this.he=null),this.c(),this.t("isClipping",i,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const i=(this.n&33554432)!==0;i!==t&&(this.n=this.n^33554432,this.c(),this.t("isOpposite",i,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const i=(this.n&4194304)!==0;if(i!==t){const s=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s&&this.Z1(this,t)}}Z1(t,i){const s=t.enabledChanged;if(s!==null&&s(t,i),t instanceof Tt){const n=t.D.r,o=n.length;for(let a=0;a<o;a++){const l=n[a];i&&l instanceof Tt&&!l.isEnabled||this.Z1(l,i)}}}get alignmentFocusName(){return this.uo}set alignmentFocusName(t){const i=this.uo;i!==t&&(this.uo=t,this.c(),this.t("alignmentFocusName",i,t))}static definePanelLayout(t,i){le.Tn(t,i)}static isLayoutDefined(t){return le.fs.has(t)}};y(Tt,"BU",!1),y(Tt,"bD",!1),y(Tt,"eC"),y(Tt,"Position",le.fs.get("Position")),y(Tt,"Horizontal",le.fs.get("Horizontal")),y(Tt,"Vertical",le.fs.get("Vertical")),y(Tt,"Spot",le.fs.get("Spot")),y(Tt,"Auto",le.fs.get("Auto")),y(Tt,"Table",le.fs.get("Table")),y(Tt,"Viewbox",le.fs.get("Viewbox")),y(Tt,"TableRow",le.fs.get("TableRow")),y(Tt,"TableColumn",le.fs.get("TableColumn")),y(Tt,"Link",le.fs.get("Link")),y(Tt,"Grid",le.fs.get("Grid")),y(Tt,"Graduated",le.fs.get("Graduated"));let Lt=Tt;Lt.definePanelLayout=Lt.definePanelLayout;class Is{constructor(){y(this,"R0");y(this,"O0");y(this,"I0");y(this,"E0");y(this,"Fs");y(this,"ts");y(this,"ds");y(this,"vi");this.R0=0,this.O0=100,this.I0=10,this.E0=0,this.Fs=null,this.ts=null,this.ds=null,this.vi=null}copy(){const e=new Is;return e.R0=this.R0,e.O0=this.O0,e.I0=this.I0,e.E0=this.E0,e.Fs=this.Fs,e.ts=this.ts,e.ds=this.ds,e.vi=this.vi,e}}class xo{constructor(){y(this,"Rd");y(this,"Od");y(this,"af");y(this,"N0");this.Rd=_.OL,this.Od=L.gn,this.af=_.Zw,this.N0=[]}copy(){const e=new xo;return e.Rd=this.Rd.copy(),e.Od=this.Od.copy(),e.af=this.af.copy(),e.N0=this.N0,e}}class Ni{constructor(){y(this,"Qi");y(this,"_i");y(this,"V0");y(this,"B0");y(this,"z0");y(this,"X0");y(this,"C0");y(this,"A0");y(this,"L0");y(this,"T0");y(this,"v0");y(this,"D0");y(this,"F0");y(this,"La");this.Qi=[],this._i=[],this.V0=3,this.B0=3,this.z0=0,this.X0=0,this.C0=ct.im,this.A0=1,this.L0=null,this.T0=null,this.v0=1,this.D0=null,this.F0=null,this.La=null}copy(e){const t=new Ni,i=this.Qi,s=i.length,n=t.Qi;for(let h=0;h<s;h++){const d=i[h];if(d===void 0)continue;const f=d.copy();f.Vh(e),n[h]=f}const o=this._i,a=o.length,l=t._i;for(let h=0;h<a;h++){const d=o[h];if(d===void 0)continue;const f=d.copy();f.Vh(e),l[h]=f}return t.V0=this.V0,t.B0=this.B0,t.z0=this.z0,t.X0=this.X0,t.C0=this.C0.N(),t.A0=this.A0,t.L0=this.L0,t.T0=this.T0,t.v0=this.v0,t.D0=this.D0,t.F0=this.F0,t.La=this.La,t}}var _l=(M=>(M[M.Default=1]="Default",M[M.None=2]="None",M[M.ProportionalExtra=3]="ProportionalExtra",M))(_l||{});const fs=class fs{constructor(e){y(this,"Zs");y(this,"G0");y(this,"Tt");y(this,"Gh");y(this,"Yh");y(this,"de");y(this,"ct");y(this,"Ed");y(this,"ho");y(this,"al");y(this,"Ud");y(this,"Vd");y(this,"Kh");y(this,"Lt");y(this,"Bd");y(this,"Rs");y(this,"j");y(this,"Re");y(this,"ki");F.Je(this),this.Zs=null,this.G0=!0,this.Tt=0,this.ki=NaN,this.Gh=0,this.Yh=1/0,this.de=X.Default,this.j=0,this.Re=0,this.ct=0,this.Rs=null,this.Ed=1,this.ho=1,this.al=null,this.Ud=null,this.Vd=NaN,this.Kh=null,this.Lt=null,this.Bd=!1,e&&(Object.assign(this,e),e.column!==void 0?(this.isRow=!1,this.index=e.column):e.row!==void 0&&(this.isRow=!0,this.index=e.row))}copy(){const e=new fs;return e.G0=this.G0,e.Tt=this.Tt,e.ki=this.ki,e.Gh=this.Gh,e.Yh=this.Yh,e.de=this.de,e.j=this.j,e.Re=this.Re,e.ct=this.ct,e.ho=this.ho,e.Ed=this.Ed,this.al===null?e.al=null:e.al=this.al.N(),e.Ud=this.Ud,e.Vd=this.Vd,e.Kh=null,this.Kh!==null&&(e.separatorDashArray=this.Kh.slice()),e.Lt=this.Lt,e.Bd=this.Bd,e.Rs=this.Rs,e}X1(e){e.isRow?e.height!==void 0&&(this.height=e.height):e.width!==void 0&&(this.width=e.width),e.minimum!==void 0&&(this.minimum=e.minimum),e.maximum!==void 0&&(this.maximum=e.maximum),e.alignment!==void 0&&(this.alignment=e.alignment),e.stretch!==void 0&&(this.stretch=e.stretch),e.sizing!==void 0&&(this.sizing=e.sizing),e.separatorPadding!==void 0&&(this.separatorPadding=e.separatorPadding),e.separatorStroke!==void 0&&(this.separatorStroke=e.separatorStroke),e.separatorStrokeWidth!==void 0&&(this.separatorStrokeWidth=e.separatorStrokeWidth),e.separatorDashArray!==void 0&&(this.Kh=e.separatorDashArray),e.background!==void 0&&(this.background=e.background),e.coversSeparators!==void 0&&(this.coversSeparators=e.coversSeparators),e.Rs!==void 0&&(this.Rs=e.Rs)}fe(e){e in _l?this.sizing=e:r.dr(this,e)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+F.xs(this)}Vh(e){this.Zs=e}computeEffectiveSpacingTop(e){let t=0;const i=this.Zs;if(this.index!==e){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(i!==null?t=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:t=0))}let s=this.al;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return t;return t+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let e=0;const t=this.Zs;let i=0;const s=this.isRow;if(t!==null&&t.type===Lt.Table){const o=s?t.Qi.length:t._i.length;for(let a=0;a<o;a++){const l=s?t.Qi[a]:t._i[a];if(l!==void 0&&l.j!==0){i=l.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&t!==null&&(o=s?t.defaultRowSeparatorStroke:t.defaultColumnSeparatorStroke),o!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(t!==null?e=s?t.defaultRowSeparatorStrokeWidth:t.defaultColumnSeparatorStrokeWidth:e=0))}let n=this.al;if(n===null)if(t!==null)n=t.defaultSeparatorPadding;else return e;return e+(this.isRow?n.top+n.bottom:n.left+n.right)}t(e,t,i,s,n){const o=this.Zs;if(o!==null&&(o.raiseChangedEvent(2,e,this,t,i,s,n),this.Rs!==null)){const a=o.diagram;if(a!==null&&!a.wi){const l=o.findBindingPanel();if(l!==null){const h=l.data;if(h!==null){const d=this.Rs.iterator;for(;d.next();)d.value.updateSource(this,h,e,l)}}}}}get panel(){return this.Zs}get isRow(){return this.G0}set isRow(e){this.G0=e}get index(){return this.Tt}set index(e){this.Tt=e}get height(){return this.ki}set height(e){const t=this.ki;t!==e&&(e<0&&r.J(e,">= 0",fs,"height"),this.ki=e,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("height",t,e))}get width(){return this.ki}set width(e){const t=this.ki;t!==e&&(e<0&&r.J(e,">= 0",fs,"width"),this.ki=e,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("width",t,e))}get minimum(){return this.Gh}set minimum(e){const t=this.Gh;t!==e&&((e<0||!isFinite(e))&&r.J(e,">= 0",fs,"minimum"),this.Gh=e,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("minimum",t,e))}get maximum(){return this.Yh}set maximum(e){const t=this.Yh;t!==e&&(e<0&&r.J(e,">= 0",fs,"maximum"),this.Yh=e,this.actual=this.j,this.panel!==null&&this.panel.c(),this.t("maximum",t,e))}get alignment(){return this.de}set alignment(e){const t=this.de;t.equals(e)||(this.de=e.N(),this.panel!==null&&this.panel.c(),this.t("alignment",t,e))}get stretch(){return this.ho}set stretch(e){const t=this.ho;t!==e&&(this.ho=e,this.panel!==null&&this.panel.c(),this.t("stretch",t,e))}get separatorPadding(){return this.al}set separatorPadding(e){typeof e=="number"&&(e=new ct(e));const t=this.al;(e===null||t===null||!t.equals(e))&&(e!==null&&(e=e.N()),this.al=e,this.panel!==null&&this.panel.c(),this.t("separatorPadding",t,e))}get separatorStroke(){return this.Ud}set separatorStroke(e){const t=this.Ud;t!==e&&(e!==null&&me.Md(e,"RowColumnDefinition.separatorStroke"),e instanceof me&&e.k(),this.Ud=e,this.panel!==null&&this.panel.c(),this.t("separatorStroke",t,e))}get separatorStrokeWidth(){return this.Vd}set separatorStrokeWidth(e){const t=this.Vd;t!==e&&(this.Vd=e,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",t,e))}get separatorDashArray(){return this.Kh}set separatorDashArray(e){const t=this.Kh;if(t!==e){if(e!==null&&!Array.isArray(e)&&r.si(e,"Array",fs,"separatorDashArray:value"),e!==null){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&r.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(t===null)return;e=null}}this.Kh=e,this.panel!==null&&this.panel.C(),this.t("separatorDashArray",t,e)}}get background(){return this.Lt}set background(e){const t=this.Lt;t!==e&&(e!==null&&me.Md(e,"RowColumnDefinition.background"),e instanceof me&&e.k(),this.Lt=e,this.panel!==null&&this.panel.C(),this.t("background",t,e))}get coversSeparators(){return this.Bd}set coversSeparators(e){const t=this.Bd;t!==e&&(r.s(e,"boolean",fs,"coversSeparators"),this.Bd=e,this.panel!==null&&this.panel.C(),this.t("coversSeparators",t,e))}get sizing(){return this.Ed}set sizing(e){const t=this.Ed;t!==e&&(this.Ed=e,this.panel!==null&&this.panel.c(),this.t("sizing",t,e))}q1(){if(this.sizing===1){const e=this.Zs;return e===null?2:this.isRow?e.rowSizing:e.columnSizing}return this.sizing}get actual(){return this.j}set actual(e){isNaN(this.ki)?this.j=Math.max(Math.min(this.Yh,e),this.Gh):this.j=Math.max(Math.min(this.Yh,this.ki),this.Gh)}get measured(){return this.Re}set measured(e){this.Re=e}get total(){return this.j+this.computeEffectiveSpacing()}get position(){return this.ct}set position(e){this.ct=e}bind(e,t,i,s){return this.Sf(e,t,i,s),this}bindTwoWay(e,t,i,s){const n=this.Sf(e,t,i,s);return s===void 0&&n.makeTwoWay(),this}theme(e,t,i,s,n){return this.Na(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.Na(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.Na(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.Na(e,t,i,s,n).ofModel(),this}Sf(e,t,i,s){let n;return typeof e=="string"?n=new Qs(e,t,i,s):n=e,this.w0(n),n}Na(e,t,i,s,n){let o;return typeof e=="string"?o=new So(e,t,i,s,n):o=e,this.w0(o),o}w0(e){e.Ti=this;const t=this.panel;if(t!==null){const i=t.findBindingPanel();i!==null&&i.nD()&&r.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+e+" on "+t)}this.Rs===null&&(this.Rs=new E),this.Rs.add(e)}};y(fs,"Default",1),y(fs,"None",2),y(fs,"ProportionalExtra",3);let ai=fs;const Ae=class Ae extends Ht{constructor(t,i){super();y(this,"ut");y(this,"en");y(this,"zd");y(this,"Hh");y(this,"Qe");y(this,"Qo");y(this,"Wo");y(this,"Kt");y(this,"Xd");y(this,"Gd");y(this,"K");this.ut=null,this.en=null,this.zd="None",this.Hh="black",this.Qe="black",this.Qo=1,this.Wo=null,this.Kt=null,this.Xd=NaN,this.Gd=NaN,this.K=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.ut=this.ut,t.en=this.en,t.zd=this.zd,t.Hh=this.Hh,t.Qe=this.Qe,t.Qo=this.Qo,this.Wo!==null&&(t.Wo=this.Wo.slice()),this.Kt!==null&&(this.Kt.me?t.Kt=this.Kt:t.Kt=this.Kt.copy()),t.Xd=this.Xd,t.Gd=this.Gd,this.K!==null&&(t.K=this.K.copy())}jh(){return this.Kt===null?this.Kt=new th:this.Kt.me&&(this.Kt=this.Kt.copy()),this.Kt}ba(){super.ba(),this.Kt!==null&&(this.Kt.me=!0)}fe(t){t in Yt?this.geometryStretch=t:super.fe(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+F.xs(this)}_I(t,i){const s=this.pathPattern;if(s===null)return;s.ht(1/0,1/0);const n=s.measuredBounds;s.Ut(0,0,n.width,n.height);const o=this.geometry;if(o===null)return;t.save(),t.beginPath();const a=r.nt();if(o.type===1)a.push(o.startX),a.push(o.startY),a.push(o.endX),a.push(o.endY),this.Yd(t,i,a,s);else if(o.type===4){const l=o.figures.iterator;for(;l.next();){const h=l.value;a.length=0,a.push(h.startX),a.push(h.startY);let d=h.startX,f=h.startY,m=d,p=f;const b=h.segments.r,x=b.length;for(let v=0;v<x;v++){const S=b[v];switch(S.type){case 1:this.Yd(t,i,a,s),a.length=0,a.push(S.endX),a.push(S.endY),d=S.endX,f=S.endY,m=d,p=f;break;case 2:a.push(S.endX),a.push(S.endY),d=S.endX,f=S.endY;break;case 3:B.Wn(d,f,S.point1X,S.point1Y,S.point2X,S.point2Y,S.endX,S.endY,.5,a),d=S.endX,f=S.endY;break;case 4:B.nm(d,f,S.point1X,S.point1Y,S.endX,S.endY,.5,a),d=S.endX,f=S.endY;break;case 5:{const P=S.Fo(h),T=P.length;if(T===0){a.push(S.centerX),a.push(S.centerY),d=S.centerX,f=S.centerY;break}for(let A=0;A<T;A++){const C=P[A];B.Wn(d,f,C[2],C[3],C[4],C[5],C[6],C[7],.5,a),d=C[6],f=C[7]}break}case 6:{const P=S.Za(h,d,f),T=P.length;if(T===0){a.push(S.endX),a.push(S.endY),d=S.endX,f=S.endY;break}for(let A=0;A<T;A++){const C=P[A];B.Wn(d,f,C[2],C[3],C[4],C[5],C[6],C[7],.5,a),d=C[6],f=C[7]}break}default:r.o("Segment not of valid type: "+S.type)}S.isClosed&&(a.push(m),a.push(p),this.Yd(t,i,a,s))}this.Yd(t,i,a,s)}}else if(o.type===2)a.push(o.startX),a.push(o.startY),a.push(o.endX),a.push(o.startY),a.push(o.endX),a.push(o.endY),a.push(o.startX),a.push(o.endY),a.push(o.startX),a.push(o.startY),this.Yd(t,i,a,s);else if(o.type===3){const l=new Z;l.startX=o.endX,l.startY=(o.startY+o.endY)/2;const h=new et(5);h.startAngle=0,h.sweepAngle=360,h.centerX=(o.startX+o.endX)/2,h.centerY=(o.startY+o.endY)/2,h.radiusX=Math.abs(o.startX-o.endX)/2,h.radiusY=Math.abs(o.startY-o.endY)/2,l.add(h);const d=h.Fo(l),f=d.length;if(f===0)a.push(h.centerX),a.push(h.centerY);else{let m=l.startX,p=l.startY;for(let b=0;b<f;b++){const x=d[b];B.Wn(m,p,x[2],x[3],x[4],x[5],x[6],x[7],.5,a),m=x[6],p=x[7]}}this.Yd(t,i,a,s)}r.Z(a),t.restore(),t.clearContextCache(!1)}tE(t){let i=t.measuredBounds.width;return t instanceof Ae&&(i-=t.strokeWidth),i<1&&(i=1),i}Yd(t,i,s,n){const o=s.length;if(o<4)return;const a=n.measuredBounds,l=Math.max(1,a.width),h=a.height;let d=s[0],f=s[1],m=0,p=0,b=0,x=0,v=0,S=0,P=0,T=0;const A=r.nt();for(let K=2;K<o;K+=2)m=s[K],p=s[K+1],b=m-d,x=p-f,b===0&&(b=.001),v=x/b,S=Math.atan2(x,b),P=Math.sqrt(b*b+x*x),A.push([b,S,v,P]),T+=P,d=m,f=p;d=s[0],f=s[1];const C=this.tE(n);let O=C;const R=l/2;let I=R!==0,H=0,V=A[H];b=V[0],S=V[1],v=V[2],P=V[3];let z=0;for(;T>=.1;){if(z===0&&(I?(O=C,O-=R,T-=R,I=!1):O=C,O===0&&(O=1)),O>T){O=T,r.Z(A);return}O>P?(z=O-P,O=P):z=0;let K=Math.sqrt(O*O/(1+v*v));if(b<0&&(K=-K),d+=K,f+=v*K,t.translate(d,f),t.rotate(S),t.translate(-(l/2),-(h/2)),z===0&&n.Ma(t,i),t.translate(l/2,h/2),t.rotate(-S),t.translate(-d,-f),T-=O,P-=O,z!==0){if(H++,H===A.length){r.Z(A);return}V=A[H],b=V[0],S=V[1],v=V[2],P=V[3],O=z}}r.Z(A)}Ma(t,i){const s=t instanceof Ri;let n=this.Qe;const o=this.Hh;if(n===null&&o===null)return;const a=this.ut;if(a===null)return;t.commitTransform();const l=this.actualBounds,h=this.naturalBounds;o!==null&&this.kn(t,o,!0,!1,h,l);const d=this.part;let f=this.Qo;n!==null&&f===0&&d!==null&&(this.isPanelMain||d.findMainElement()===this)&&(f=d.eE()),f===0&&(n=null),n!==null&&f!==0&&(this.kn(t,n,!1,!1,h,l),t.lineWidth=f,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let m=!1;d&&i.getRenderingHint("drawShadows")&&(m=d.isShadowed),t.rl===!1&&(m=!1);let p=!0;n!==null&&(o===null||o==="transparent")&&(p=!1);let b=!1;const x=this.strokeDashArray;if(x!==null&&(b=!0,t.enableDash(x,this.strokeDashOffset)),a.type===1)t.beginPath(),t.moveTo(a.startX,a.startY),t.lineTo(a.endX,a.endY),n!==null&&t.strokeContext(),t.endPath();else if(a.type===2){const v=a.startX,S=a.startY,P=a.endX,T=a.endY,A=Math.min(v,P),C=Math.min(S,T),O=Math.abs(P-v),R=Math.abs(T-S);t.beginPath(),t.rect(A,C,O,R),o!==null&&t.fillContext(o,!1,null),n!==null&&(p&&m&&t.shadowsOff(),t.strokeContext(),p&&m&&t.shadowsOn()),t.endPath()}else if(a.type===3){const v=a.startX,S=a.startY,P=a.endX,T=a.endY,A=Math.abs(P-v)/2,C=Math.abs(T-S)/2,O=Math.min(v,P)+A,R=Math.min(S,T)+C;t.beginPath(),t.moveTo(O,R-C),t.bezierCurveTo(O+B.qn*A,R-C,O+A,R-B.qn*C,O+A,R),t.bezierCurveTo(O+A,R+B.qn*C,O+B.qn*A,R+C,O,R+C),t.bezierCurveTo(O-B.qn*A,R+C,O-A,R+B.qn*C,O-A,R),t.bezierCurveTo(O-A,R-B.qn*C,O-B.qn*A,R-C,O,R-C),t.closePath(),o!==null&&t.fillContext(o,!1,null),n!==null&&(p&&m&&t.shadowsOff(),t.strokeContext(),p&&m&&t.shadowsOn()),t.endPath()}else if(a.type===4){const v=a.figures,S=v.length;for(let P=0;P<S;P++){const T=v.r[P];s?(t.beginPath(),this.kD(t,T)):T.ji===null&&(T.ji=new Path2D,this.kD(T.ji,T));const A=T.isFilled;m?T.isShadowed?(A===!0&&o!=="transparent"&&o!==null&&t.fillContext(o,T.isEvenOdd,T.ji),n!==null&&(A&&p&&t.shadowsOff(),t.stroke(T.ji),A&&p&&t.shadowsOn())):(t.shadowsOff(),A&&o!=="transparent"&&o!==null&&t.fillContext(o,T.isEvenOdd,T.ji),n!==null&&t.stroke(T.ji),t.shadowsOn()):(A&&o!==null&&t.fillContext(o,T.isEvenOdd,T.ji),n!==null&&t.stroke(T.ji)),t.endPath(P)}}b&&t.disableDash(),this._I(t,i)}kD(t,i){t.moveTo(i.startX,i.startY);const s=i.segments.r,n=s.length;let o=null;for(let a=0;a<n;a++){const l=s[a];switch(l.type){case 1:t.moveTo(l.endX,l.endY);break;case 2:t.lineTo(l.endX,l.endY);break;case 3:t.bezierCurveTo(l.point1X,l.point1Y,l.point2X,l.point2Y,l.endX,l.endY);break;case 4:t.quadraticCurveTo(l.point1X,l.point1Y,l.endX,l.endY);break;case 5:if(l.radiusX===l.radiusY){const h=o!==null?o.endX:i.startX,d=o!==null?o.endY:i.startY,f=Math.PI/180;t.arc(l.point1X,l.point1Y,l.radiusX,l.startAngle*f,(l.startAngle+l.sweepAngle)*f,l.sweepAngle<0,h,d)}else{const h=l.Fo(i),d=h.length;if(d===0){t.lineTo(l.centerX,l.centerY);break}for(let f=0;f<d;f++){const m=h[f];f===0&&t.lineTo(m[0],m[1]),t.bezierCurveTo(m[2],m[3],m[4],m[5],m[6],m[7])}}break;case 6:{let h=0,d=0,f;if(o!==null&&o.type===5){f=o.Fo(i);const p=f.length;if(p===0){t.lineTo(l.endX,l.endY);break}const b=f[p-1]||null;b!==null&&(h=b[6],d=b[7])}else h=o!==null?o.endX:i.startX,d=o!==null?o.endY:i.startY;f=l.Za(i,h,d);const m=f.length;if(m===0){t.lineTo(l.endX,l.endY);break}for(let p=0;p<m;p++){const b=f[p];t.bezierCurveTo(b[2],b[3],b[4],b[5],b[6],b[7])}break}}l.isClosed&&t.closePath(),o=l}}wf(t,i,s){if(!super.wf(t,i,s)||this.Qe===null&&this.Hh===null||this.ut===null||this.pathPattern!==null)return!1;const n=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==n.length?!1:(t.currentPath=this.svg,this.Ma(t,i),t.currentPath=null,!0)}Pd(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.Pd(t)}LN(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("path");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}getDocumentPoint(t,i){if(i===void 0&&(i=new L),t instanceof X){const s=t;s.isNoSpot()&&r.o("getDocumentPoint Spot must be a real, specific Spot, not: "+s.toString());const n=this.naturalBounds,o=this.strokeWidth;return i.e(s.x*(n.width+o)-o/2+n.x+s.offsetX,s.y*(n.height+o)-o/2+n.y+s.offsetY),this.Js.gt(i),i}else return i.set(t),this.Js.gt(i),i}getDocumentBounds(t){t===void 0&&(t=new Y);const i=this.naturalBounds,s=this.Js,n=Y.z(i.x,i.y,i.width,i.height),o=this.strokeWidth;n.inflate(o/2,o/2);const a=L.z(n.x,n.y).v(s);return t.e(a.x,a.y,0,0),a.e(n.right,n.y).v(s),t.re(a.x,a.y,0,0),a.e(n.right,n.bottom).v(s),t.re(a.x,a.y,0,0),a.e(n.x,n.bottom).v(s),t.re(a.x,a.y,0,0),Y.i(n),L.i(a),t}ka(t,i){const s=this.geometry;if(s===null||this.fill===null&&this.stroke===null)return!1;const n=s.bounds;let o=this.strokeWidth/2;s.type===1&&!i&&(o+=2);const a=Y.l();if(a.h(n),a.inflate(o+2,o+2),!a.containsPoint(t))return Y.i(a),!1;const l=o+1e-4;if(s.type===1){if(this.stroke===null)return!1;const h=(s.startX-s.endX)*(t.x-s.endX)+(s.startY-s.endY)*(t.y-s.endY),d=(s.endX-s.startX)*(t.x-s.startX)+(s.endY-s.startY)*(t.y-s.startY);return h<0||d<0?!1:(Y.i(a),B.Ve(s.startX,s.startY,s.endX,s.endY,o,t.x,t.y))}else if(s.type===2){const h=s.startX,d=s.startY,f=s.endX,m=s.endY;if(a.x=Math.min(h,f),a.y=Math.min(d,m),a.width=Math.abs(f-h),a.height=Math.abs(m-d),this.fill===null){if(a.inflate(-l,-l),a.containsPoint(t))return Y.i(a),!1;a.inflate(l,l)}this.stroke!==null&&a.inflate(o,o);const p=a.containsPoint(t);return Y.i(a),p}else if(s.type===3){const h=s.startX,d=s.startY,f=s.endX,m=s.endY;let p=Math.min(h,f),b=Math.min(d,m);const x=Math.abs(f-h),v=Math.abs(m-d);let S=x/2,P=v/2;if(p=t.x-(p+S),b=t.y-(b+P),this.fill===null){if(S-=l,P-=l,S<=0||P<=0||p*p/(S*S)+b*b/(P*P)<=1)return Y.i(a),!1;S+=l,P+=l}return this.stroke!==null&&(S+=l,P+=l),Y.i(a),S<=0||P<=0?!1:p*p/(S*S)+b*b/(P*P)<=1}else{if(s.type===4)return Y.i(a),this.fill===null?s.ZL(t.x,t.y,o):s.VP(t,o,this.strokeWidth>1,i);r.o("Unknown Geometry type: "+s.type)}}bd(t,i,s,n){const o=this.desiredSize,a=this.Qo;t=Math.max(t,0),i=Math.max(i,0);let l;if(this.en!==null)l=this.geometry.bounds;else{const v=this.figure;let S=Ae.iC[v];if(S===void 0){let P=B.Jn[v];typeof P=="string"&&(P=B.Jn[P]),r.st(P)?(S=P(null,100,100),Ae.iC[v]=S):r.o("Unsupported Figure: "+v)}l=S.bounds}let h=l.width,d=l.height,f=l.width,m=l.height;switch(this.Qs(!0)){case 0:s=0,n=0;break;case 2:f=Math.max(t-a,0),m=Math.max(i-a,0);break;case 5:f=Math.max(t-a,0),n=0;break;case 4:s=0,m=Math.max(i-a,0);break}isFinite(o.width)&&(f=o.width),isFinite(o.height)&&(m=o.height);const p=this.maxSize,b=this.minSize;s=Math.max(s-a,b.width),n=Math.max(n-a,b.height),f=Math.min(p.width,f),m=Math.min(p.height,m),f=isFinite(f)?Math.max(s,f):Math.max(h,s),m=isFinite(m)?Math.max(n,m):Math.max(d,n);const x=this._S();switch(x){case 0:break;case 2:h=f,d=m;break;case 6:{let v=Math.min(f/h,m/d);isFinite(v)||(v=1),h=h*v,d=d*v;break}default:r.o(x+" is not a valid geometryStretch.")}if(this.en!==null){h===0&&(h=.001),d===0&&(d=.001);const v=this.en.sR(h,d);this.ut=v}else(this.ut===null||!B.X(this.ut.Sc,t-a)||!B.X(this.ut.Mc,i-a))&&(this.ut=Ae.iE(this,h,d));l=this.ut.bounds,t===1/0||i===1/0?this.lo(l.x-a/2,l.y-a/2,t===0&&h===0?0:l.width+a,i===0&&d===0?0:l.height+a):this.lo(-(a/2),-(a/2),f+a,m+a),o.isReal()?(f=o.width,m=o.height,f=Math.min(p.width,f),m=Math.min(p.height,m),f=Math.max(b.width,f),m=Math.max(b.height,m),this.Ke.e(0,0,f,m)):this.Ke.h(l)}_S(){const t=this.geometryStretch;return this.en!==null?t===1?2:t:t===1?Ae.iC[this.figure].defaultStretch:t}Pa(t,i,s,n){this.commonArrange(t,i,s,n)}getNearestIntersectionPoint(t,i,s){return this.pf(t.x,t.y,i.x,i.y,s)}pf(t,i,s,n,o){const a=this.v,l=1/(a.m11*a.m22-a.m12*a.m21),h=a.m22*l,d=-a.m12*l,f=-a.m21*l,m=a.m11*l,p=l*(a.m21*a.dy-a.m22*a.dx),b=l*(a.m12*a.dx-a.m11*a.dy),x=t*h+i*f+p,v=t*d+i*m+b,S=s*h+n*f+p,P=s*d+n*m+b,T=this.Qo/2;let A=this.ut;A===null&&(this.ht(1/0,1/0),A=this.ut);const C=A.bounds;let O=!1;if(A.type===1)if(this.strokeWidth<=1.5)O=B.vo(A.startX,A.startY,A.endX,A.endY,x,v,S,P,o);else{let R=0,I=0;if(A.startX===A.endX)R=T,I=0;else{const $=(A.endY-A.startY)/(A.endX-A.startX);I=T/Math.sqrt(1+$*$),R=I*$}const H=r.nt();let V=new L;B.vo(A.startX+R,A.startY+I,A.endX+R,A.endY+I,x,v,S,P,V)&&H.push(V),V=new L,B.vo(A.startX-R,A.startY-I,A.endX-R,A.endY-I,x,v,S,P,V)&&H.push(V),V=new L,B.vo(A.startX+R,A.startY+I,A.startX-R,A.startY-I,x,v,S,P,V)&&H.push(V),V=new L,B.vo(A.endX+R,A.endY+I,A.endX-R,A.endY-I,x,v,S,P,V)&&H.push(V);const z=H.length;if(z===0)return r.Z(H),!1;O=!0;let K=1/0;for(let $=0;$<z;$++){const q=H[$],J=(q.x-x)**2+(q.y-v)**2;J<K&&(K=J,o.x=q.x,o.y=q.y)}r.Z(H)}else if(A.type===2)O=B.Cl(C.x-T,C.y-T,C.x+C.width+T,C.y+C.height+T,x,v,S,P,o);else if(A.type===3){const R=Y.z(C.x,C.y,C.width,C.height).inflate(T,T);O=this.sE(R,x,v,S,P,o),Y.i(R)}else if(A.type===4){let R=0,I=0,H=0,V=0;const z=L.l();let K=S-x,$=P-v,q=K*K+$*$,J=x,ot=v;if(q>0&&C.contains(J,ot)&&(z.x=J,z.y=ot,this.containsPoint(z)))for(K!==0&&Math.abs(K)<.5?($*=.5/K,K=.5):$!==0&&Math.abs($)<.5&&(K*=.5/$,$=.5),J-=K,ot-=$;C.contains(J,ot);)J-=K,ot-=$;const rt=.6;o.x=S,o.y=P;for(let zt=0;zt<A.figures.count;zt++){const kt=A.figures.r[zt],Mt=kt.isFilled?J:x,St=kt.isFilled?ot:v,Ct=kt.segments;R=kt.startX,I=kt.startY;let Qt=R,Wt=I;for(let xt=0;xt<Ct.count;xt++){const Ot=Ct.r[xt],Le=Ot.type;H=Ot.endX,V=Ot.endY;let te=!1;switch(Le){case 1:Qt=H,Wt=V;break;case 2:te=this._1(R,I,H,V,Mt,St,S,P,z);break;case 3:{te=B.om(R,I,Ot.point1X,Ot.point1Y,Ot.point2X,Ot.point2Y,H,V,Mt,St,S,P,rt,z);break}case 4:{te=B.om(R,I,R+2/3*(Ot.point1X-R),I+2/3*(Ot.point1Y-I),H+2/3*(Ot.point1X-H),V+2/3*(Ot.point1Y-V),H,V,Mt,St,S,P,rt,z);break}case 5:case 6:{const vt=Ot.type===5?Ot.Fo(kt):Ot.Za(kt,R,I),mt=vt.length;if(mt===0){te=this._1(R,I,Ot.type===5?Ot.centerX:Ot.endX,Ot.type===5?Ot.centerY:Ot.endY,Mt,St,S,P,z);break}let Vt=null;for(let oe=0;oe<mt;oe++){if(Vt=vt[oe],oe===0&&this._1(R,I,Vt[0],Vt[1],Mt,St,S,P,z)){const Ue=this.tk(Mt,St,z,q,o);Ue<q&&(q=Ue,O=!0)}if(B.om(Vt[0],Vt[1],Vt[2],Vt[3],Vt[4],Vt[5],Vt[6],Vt[7],Mt,St,S,P,rt,z)){const Ue=this.tk(Mt,St,z,q,o);Ue<q&&(q=Ue,O=!0)}}H=Vt[6],V=Vt[7];break}default:r.o("Unknown Segment type: "+Le)}if(R=H,I=V,te){const vt=this.tk(Mt,St,z,q,o);vt<q&&(q=vt,O=!0)}if(Ot.isClosed&&(H=Qt,V=Wt,this._1(R,I,H,V,Mt,St,S,P,z))){const vt=this.tk(Mt,St,z,q,o);vt<q&&(q=vt,O=!0)}}}let st=s-t,ht=n-i;const pt=Math.sqrt(st*st+ht*ht);pt!==0&&(st/=pt,ht/=pt),o.x-=st*T,o.y-=ht*T,L.i(z)}else r.o("Unknown Geometry type: "+A.type);return O?(this.v.gt(o),!0):!1}tk(t,i,s,n,o){const a=s.x-t,l=s.y-i,h=a*a+l*l;return h<n?(o.x=s.x,o.y=s.y,h):n}_1(t,i,s,n,o,a,l,h,d){if(B.X(t,s)&&B.X(i,n)||B.X(o,l)&&B.X(a,h))return!1;let f=!1;const m=(o-l)*(i-n)-(a-h)*(t-s);if(m===0)return!1;if(d.x=((o*h-a*l)*(t-s)-(o-l)*(t*n-i*s))/m,d.y=((o*h-a*l)*(i-n)-(a-h)*(t*n-i*s))/m,(t>s?t-s:s-t)<(i>n?i-n:n-i)){const p=i<n?i:n,b=i<n?n:i;(d.y>p||B.X(d.y,p))&&(d.y<b||B.X(d.y,b))&&(f=!0)}else{const p=t<s?t:s,b=t<s?s:t;(d.x>p||B.X(d.x,p))&&(d.x<b||B.X(d.x,b))&&(f=!0)}return f}nE(t,i,s){return this.pickable===!1?!1:(s.kc(this.v),i?this.oE(t,s):this.containedInRect(t,s))}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);let s=this.ut;s===null&&(this.ht(1/0,1/0),s=this.ut);const n=s.bounds,o=this.strokeWidth/2;let a=!1;const l=L.l();return l.e(n.x-o,n.y-o),t.containsPoint(i.gt(l))&&(l.e(n.x-o,n.bottom+o),t.containsPoint(i.gt(l))&&(l.e(n.right+o,n.bottom+o),t.containsPoint(i.gt(l))&&(l.e(n.right+o,n.y-o),t.containsPoint(i.gt(l))&&(a=!0)))),L.i(l),a}intersectsRect(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.v,t.containsRect(this.actualBounds)))return!0;const s=lt.l();s.set(i),s.ex();const n=t.left,o=t.right,a=t.top,l=t.bottom,h=L.l();if(h.e(n,a),s.gt(h),this.ka(h,!0)||(h.e(o,a),s.gt(h),this.ka(h,!0))||(h.e(n,l),s.gt(h),this.ka(h,!0))||(h.e(o,l),s.gt(h),this.ka(h,!0)))return L.i(h),!0;const d=L.l(),f=L.l();s.set(i),s.zL(this.v),s.ex(),d.x=o,d.y=a,d.v(s),h.x=n,h.y=a,h.v(s);let m=!1;return this.qh(h,d,f)?m=!0:(h.x=o,h.y=l,h.v(s),this.qh(h,d,f)?m=!0:(d.x=n,d.y=l,d.v(s),this.qh(h,d,f)?m=!0:(h.x=n,h.y=a,h.v(s),this.qh(h,d,f)&&(m=!0)))),L.i(h),lt.i(s),L.i(d),L.i(f),m}qh(t,i,s){if(!this.getNearestIntersectionPoint(t,i,s))return!1;const n=t.x,o=t.y,a=i.x,l=i.y,h=s.x,d=s.y;if(n===a){let f=0,m=0;return o<l?(f=o,m=l):(f=l,m=o),d>=f&&d<=m}else{let f=0,m=0;return n<a?(f=n,m=a):(f=a,m=n),h>=f&&h<=m}}oE(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.v,t.containsRect(this.actualBounds)))return!0;const s=t.left,n=t.right,o=t.top,a=t.bottom,l=L.l(),h=L.l(),d=L.l(),f=lt.l();f.set(i),f.zL(this.v),f.ex(),h.x=n,h.y=o,h.v(f),l.x=s,l.y=o,l.v(f);let m=!1;return this.qh(l,h,d)?m=!0:(l.x=n,l.y=a,l.v(f),this.qh(l,h,d)?m=!0:(h.x=s,h.y=a,h.v(f),this.qh(l,h,d)?m=!0:(l.x=s,l.y=o,l.v(f),this.qh(l,h,d)&&(m=!0)))),lt.i(f),L.i(l),L.i(h),L.i(d),m}$T(t,i,s){if(s&&this.fill!==null&&this.ka(t,!0))return!0;let n=t.distanceSquaredPoint(i);const o=n;this.strokeWidth>1.5&&(n=this.strokeWidth/2+Math.sqrt(n),n*=n);let a=this.ut;if(a===null&&(this.ht(1/0,1/0),a=this.ut,a===null))return!1;if(!s){const p=a.bounds,b=p.x,x=p.y,v=p.x+p.width,S=p.y+p.height;if(L.distanceSquared(t.x,t.y,b,x)<=n&&L.distanceSquared(t.x,t.y,v,x)<=n&&L.distanceSquared(t.x,t.y,b,S)<=n&&L.distanceSquared(t.x,t.y,v,S)<=n)return!0}function l(p,b){const x=p.length;for(let v=0;v<x;v+=2)if(b.distanceSquared(p[v],p[v+1])>n)return!0;return!1}const h=a.startX,d=a.startY,f=a.endX,m=a.endY;if(a.type===1){const p=L.distanceLineSegmentSquared(t.x,t.y,h,d,f,m),b=(f-h)*(t.x-h)+(m-d)*(t.y-d),x=(h-f)*(t.x-f)+(d-m)*(t.y-m),v=b>=0&&x>=0?n:o;return p<=v}else if(a.type===2){let p=!1;return s&&(p=L.distanceLineSegmentSquared(t.x,t.y,h,d,h,m)<=n||L.distanceLineSegmentSquared(t.x,t.y,h,d,f,d)<=n||L.distanceLineSegmentSquared(t.x,t.y,f,d,f,m)<=n||L.distanceLineSegmentSquared(t.x,t.y,h,m,f,m)<=n),p}else if(a.type===3){const p=(h+f)/2,b=(d+m)/2,x=t.x-p,v=t.y-b,S=Math.abs(f-h)/2,P=Math.abs(m-d)/2;if(S===0||P===0)return L.distanceLineSegmentSquared(t.x,t.y,h,d,f,m)<=n;if(s){const T=B.WF(S,P,x,v);return T*T<=n}else return!(L.distanceSquared(x,v,-S,0)>=n||L.distanceSquared(x,v,0,-P)>=n||L.distanceSquared(x,v,0,P)>=n||L.distanceSquared(x,v,S,0)>=n)}else if(a.type===4){const p=a.bounds,b=p.x,x=p.y,v=p.x+p.width,S=p.y+p.height;if(t.x>v&&t.x<b&&t.y>S&&t.y<x&&L.distanceLineSegmentSquared(t.x,t.y,b,x,b,S)>n&&L.distanceLineSegmentSquared(t.x,t.y,b,x,v,x)>n&&L.distanceLineSegmentSquared(t.x,t.y,v,S,b,S)>n&&L.distanceLineSegmentSquared(t.x,t.y,v,S,v,x)>n)return!1;const P=Math.sqrt(n);if(s){if(this.fill===null?a.ZL(t.x,t.y,P):a.VP(t,P,!0,!1))return!0}else{const T=a.figures;for(let A=0;A<T.count;A++){const C=T.r[A];let O=C.startX,R=C.startY;if(t.distanceSquared(O,R)>n)return!1;const I=C.segments.r,H=I.length;for(let V=0;V<H;V++){const z=I[V];switch(z.type){case 1:case 2:if(O=z.endX,R=z.endY,t.distanceSquared(O,R)>n)return!1;break;case 3:{const K=r.nt();B.Wn(O,R,z.point1X,z.point1Y,z.point2X,z.point2Y,z.endX,z.endY,.8,K);const $=l(K,t);if(r.Z(K),$||(O=z.endX,R=z.endY,t.distanceSquared(O,R)>n))return!1;break}case 4:{const K=r.nt();B.nm(O,R,z.point1X,z.point1Y,z.endX,z.endY,.8,K);const $=l(K,t);if(r.Z(K),$||(O=z.endX,R=z.endY,t.distanceSquared(O,R)>n))return!1;break}case 5:case 6:{const K=z.type===5?z.Fo(C):z.Za(C,O,R),$=K.length;if($===0){if(O=z.type===5?z.centerX:z.endX,R=z.type===5?z.centerY:z.endY,t.distanceSquared(O,R)>n)return!1;break}let q=null;const J=r.nt();for(let ot=0;ot<$;ot++)if(q=K[ot],J.length=0,B.Wn(q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7],.8,J),l(J,t))return r.Z(J),!1;r.Z(J),q!==null&&(O=q[6],R=q[7]);break}default:r.o("Unknown Segment type: "+z.type)}}}return!0}}return!1}sE(t,i,s,n,o,a){if(t.width===0)return B.vo(t.x,t.y,t.x,t.y+t.height,i,s,n,o,a);if(t.height===0)return B.vo(t.x,t.y,t.x+t.width,t.y,i,s,n,o,a);{const l=t.width/2,h=t.height/2,d=t.x+l,f=t.y+h;let m=9999;if(i!==n&&(m=(s-o)/(i-n)),Math.abs(m)<9999){const p=s-f-m*(i-d);if(l*l*(m*m)+h*h-p*p<0)return a.x=NaN,a.y=NaN,!1;const b=Math.sqrt(l*l*(m*m)+h*h-p*p),x=(-(l*l*m*p)+l*h*b)/(h*h+l*l*(m*m))+d,v=(-(l*l*m*p)-l*h*b)/(h*h+l*l*(m*m))+d,S=m*(x-d)+p+f,P=m*(v-d)+p+f,T=Math.abs((i-x)**2)+Math.abs((s-S)**2),A=Math.abs((i-v)**2)+Math.abs((s-P)**2);T<A?(a.x=x,a.y=S):(a.x=v,a.y=P)}else{const p=h*h,b=l*l,x=i-d,v=p-p/b*(x*x);if(v<0)return a.x=NaN,a.y=NaN,!1;const S=Math.sqrt(v),P=f+S,T=f-S,A=Math.abs(P-s),C=Math.abs(T-s);A<C?(a.x=i,a.y=P):(a.x=i,a.y=T)}return!0}}qI(){return this.Qo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ut!==null?this.ut:this.en}set geometry(t){const i=this.ut,s=this.en;if(i===t)return;t!==null?(this.ut=t.k(),this.en=this.ut):(this.ut=null,this.en=null);const n=this.part;if(n!==null&&n.Df(),this.c(),this.t("geometry",i||s,t),this.mf()){const o=this.part;o!==null&&this.Eh(o,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const i=It.parse(t),s=i.normalize();this.geometry=i;const n=L.z(-s.x,-s.y);this.position=n,L.i(n)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",i,t))}ai(){this.ut=null}get fill(){return this.Hh}set fill(t){const i=this.Hh;i!==t&&(t!==null&&me.Md(t,"Shape.fill"),t instanceof me&&t.k(),this.Hh=t,this.C(),this.t("fill",i,t))}get stroke(){return this.Qe}set stroke(t){const i=this.Qe;i!==t&&(t!==null&&me.Md(t,"Shape.stroke"),t instanceof me&&t.k(),this.Qe=t,this.C(),this.t("stroke",i,t))}get strokeWidth(){return this.Qo}set strokeWidth(t){const i=this.Qo;if(i!==t)if(t>=0){this.Qo=t,this.c();const s=this.part;s!==null&&s.Df(),this.t("strokeWidth",i,t)}else r.J(t,"value >= 0",Ae,"strokeWidth:value")}jp(){return this.Qo}get strokeCap(){return this.Kt!==null?this.Kt.Y0:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.jh().Y0=t,this.C(),this.t("strokeCap",i,t)):r.J(t,'"butt", "round", or "square"',Ae,"strokeCap"))}get strokeJoin(){return this.Kt!==null?this.Kt.K0:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.jh().K0=t,this.C(),this.t("strokeJoin",i,t)):r.J(t,'"miter", "bevel", or "round"',Ae,"strokeJoin"))}get strokeMiterLimit(){return this.Kt!==null?this.Kt.H0:10}set strokeMiterLimit(t){const i=this.strokeMiterLimit;if(i!==t&&t>=1){this.jh().H0=t,this.C();const s=this.part;s!==null&&s.Df(),this.t("strokeMiterLimit",i,t)}}get strokeDashArray(){return this.Wo}set strokeDashArray(t){const i=this.Wo;if(i!==t){if(t!==null&&!Array.isArray(t)&&r.si(t,"Array",Ae,"strokeDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const a=t[o];(!(a>=0)||!isFinite(a))&&r.o("strokeDashArray:value "+a+" at index "+o+" must be a positive number or zero."),n+=a}if(n===0){if(i===null)return;t=null}}this.Wo=t,this.C(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return this.Kt!==null?this.Kt.Ca:0}set strokeDashOffset(t){const i=this.strokeDashOffset;i!==t&&t>=0&&(this.jh().Ca=t,this.C(),this.t("strokeDashOffset",i,t))}get figure(){return this.zd}set figure(t){const i=this.zd;if(i!==t){let s=B.Jn[t];if(r.st(s)?s=t:(s=B.Jn[t.toLowerCase()],(!s||typeof s=="function")&&r.o("Unknown Shape.figure: "+t)),i!==s){const n=this.part;n!==null&&n.Df(),this.zd=s,this.en=null,this.ai(),this.c(),this.t("figure",i,s)}}}get toArrow(){return this.Ot!==null?this.Ot.j0:"None"}set toArrow(t){const i=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Ae.PD(t);s===null?r.o("Unknown Shape.toArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new xn),this.Ot.j0=s,this.en=null,this.ai(),this.c(),this.SD(s),this.t("toArrow",i,s))}}get fromArrow(){return this.Ot!==null?this.Ot.q0:"None"}set fromArrow(t){const i=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Ae.PD(t);s===null?r.o("Unknown Shape.fromArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new xn),this.Ot.q0=s,this.en=null,this.ai(),this.c(),this.SD(s),this.t("fromArrow",i,s))}}SD(t){const i=this.diagram;i!==null&&i.undoManager.isUndoingRedoing||(this.mI(),this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=X.Right):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=X.Left))}get spot1(){return this.Kt!==null?this.Kt.$n:X.Default}set spot1(t){const i=this.spot1;i.equals(t)||(t=t.N(),this.jh().$n=t,this.c(),this.t("spot1",i,t))}get spot2(){return this.Kt!==null?this.Kt.Zn:X.Default}set spot2(t){const i=this.spot2;i.equals(t)||(t=t.N(),this.jh().Zn=t,this.c(),this.t("spot2",i,t))}get parameter1(){return this.Xd}set parameter1(t){const i=this.Xd;i!==t&&(this.Xd=t,this.ai(),this.c(),this.t("parameter1",i,t))}get parameter2(){return this.Gd}set parameter2(t){const i=this.Gd;i!==t&&(this.Gd=t,this.ai(),this.c(),this.t("parameter2",i,t))}get naturalBounds(){return this.Ke}EI(){const t=this.desiredSize;if(!t.isReal()&&this.ut!==null){const i=this.ut.bounds;this.Ke.h(i)}else this.Ke.e(0,0,t.width,t.height)}get pathPattern(){return this.Kt!==null?this.Kt.W0:null}set pathPattern(t){const i=this.pathPattern;i!==t&&(this.jh().W0=t,this.C(),this.t("pathPattern",i,t))}get geometryStretch(){return this.Kt!==null?this.Kt.J0:1}set geometryStretch(t){const i=this.geometryStretch;i!==t&&(this.jh().J0=t,this.c(),this.t("geometryStretch",i,t))}get interval(){return this.K!==null?this.K.Ff:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new vs),this.K.Ff=t;const s=this.diagram;s!==null&&this.panel===s.grid&&s.ca(),this.c();const n=this.panel;n!==null&&(n.ds=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.Rf:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new vs),this.K.Rf=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.Of:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new vs),this.K.Of=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedSkip(){return this.K!==null?this.K.If:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&r.S(t,Ae,"graduatedSkip"),this.K===null&&(this.K=new vs),this.K.If=t,this.c(),this.t("graduatedSkip",i,t))}polygonContainsRect(t){const i=this;if(!i.part||!i.part.actualBounds.containsRect(t))return!1;const s=i.geometry;if(!s)return!1;const n=t.x,o=t.y,a=t.width,l=t.height,h=L.l();if(h.x=n,h.y=o,i.getLocalPoint(h,h),!s.containsPoint(h)||a>0&&l>0&&(h.x=n+a,h.y=o+l,i.getLocalPoint(h,h),!s.containsPoint(h))||a>0&&(h.x=n+a,h.y=o,i.getLocalPoint(h,h),!s.containsPoint(h))||l>0&&(h.x=n,h.y=o+l,i.getLocalPoint(h,h),!s.containsPoint(h))||s.type===1)return!1;if(s.type===4){const d=s.figures.iterator;for(;d.next();){const f=d.value;if(!f.isFilled)continue;h.x=f.startX,h.y=f.startY,i.getDocumentPoint(h,h);let m=h.x,p=h.y,b=m,x=p,v=m,S=p;const P=f.segments.iterator;for(;P.next();){const T=P.value;if(h.x=T.endX,h.y=T.endY,i.getDocumentPoint(h,h),v=h.x,S=h.y,T.type===1)m=v,p=S;else if(T.type!==5&&(Y.intersectsLineSegment(n,o,a,l,b,x,v,S)||T.isClosed&&Y.intersectsLineSegment(n,o,a,l,v,S,m,p)))return!1;b=v,x=S}}}return L.i(h),!0}static iE(t,i,s){let n=null;if(t.toArrow!=="None")n=Ae.Dn[t.toArrow];else if(t.fromArrow!=="None")n=Ae.Dn[t.fromArrow];else{let o=B.Jn[t.figure];typeof o=="string"&&(o=B.Jn[o]),o===void 0&&r.o("Unknown Shape.figure: "+t.figure),n=o(t,i,s),n.Sc=i,n.Mc=s}if(n===null){const o=B.Jn.Rectangle;r.st(o)&&(n=o(t,i,s))}return n}static getFigureGenerators(){const t=new nt;for(const i in B.Jn){if(i===i.toLowerCase())continue;const s=B.Jn[i];t.set(i,s)}return t.k(),t}static defineFigureGenerator(t,i){r.s(t,"string",Ae,"defineFigureGenerator:name"),typeof i=="string"||r.S(i,Ae,"defineFigureGenerator:func");const s=t.toLowerCase(),n=B.Jn;n[t]=i,n[s]=t}static isFigureDefined(t){return t in B.Jn}static getArrowheadGeometries(){const t=new nt;for(const i in B.lm)if(Ae.Dn[i]===void 0){const s=It.parse(B.lm[i],!1);Ae.Dn[i]=s;const n=i.toLowerCase();n!==i&&(Ae.Dn[n]=i)}for(const i in Ae.Dn){if(i===i.toLowerCase())continue;const s=Ae.Dn[i];s instanceof It&&t.set(i,s)}return t.k(),t}static defineArrowheadGeometry(t,i){r.s(t,"string",Ae,"defineArrowheadGeometry:name");let s=null;typeof i=="string"?(r.s(i,"string",Ae,"defineArrowheadGeometry:pathstr"),s=It.parse(i,!1)):s=i;const n=t.toLowerCase();(n==="none"||t===n)&&r.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const o=Ae.Dn;o[t]=s,o[n]=t}static isArrowheadDefined(t){return Ae.Dn.has(t)}static PD(t){let i=Ae.Dn[t];if(i===void 0){const s=t.toLowerCase();if(s==="none")return"None";if(i=Ae.Dn[s],i===void 0){let n=null;for(const o in B.lm)if(o.toLowerCase()===s){n=o;break}if(n!==null){const o=It.parse(B.lm[n],!1);return Ae.Dn[n]=o,s!==n&&(Ae.Dn[s]=n),n}}}return typeof i=="string"?i:i instanceof It?t:null}};y(Ae,"Dn",new g),y(Ae,"iC",new g);let Xt=Ae;class th{constructor(){y(this,"me");y(this,"Y0");y(this,"K0");y(this,"H0");y(this,"Ca");y(this,"W0");y(this,"J0");y(this,"$n");y(this,"Zn");this.me=!1,this.Y0="butt",this.K0="miter",this.H0=10,this.Ca=0,this.W0=null,this.J0=1,this.$n=X.Default,this.Zn=X.Default}copy(){const e=new th;return e.Y0=this.Y0,e.K0=this.K0,e.H0=this.H0,e.Ca=this.Ca,e.W0=this.W0,e.J0=this.J0,e.$n=this.$n.N(),e.Zn=this.Zn.N(),e}}var eh=(M=>(M[M.None=0]="None",M[M.Fit=1]="Fit",M[M.DesiredSize=2]="DesiredSize",M[M.BreakAll=3]="BreakAll",M))(eh||{}),$u=(M=>(M[M.Clip=0]="Clip",M[M.Ellipsis=1]="Ellipsis",M))($u||{}),ih=(M=>(M[M.Trim=0]="Trim",M[M.None=1]="None",M))(ih||{});const Kt=class Kt extends Ht{constructor(t,i){super();y(this,"ue");y(this,"Qe");y(this,"vn");y(this,"Pi");y(this,"pe");y(this,"qp");y(this,"Kd");y(this,"K");y(this,"tt");y(this,"Xl");y(this,"go");y(this,"Fn");y(this,"Ii");y(this,"ye");y(this,"Rn");return Kt.M0===!1&&(Kt.M0=!0,Kt.us=qt.isUsingDOM()?new wn(null)._t:null),this.n|=2097152,this.ue="",this.Qe="black",this.vn="13px sans-serif",this.Pi=0,this.pe=0,this.qp=0,this.Kd=null,this.K=null,this.tt=null,this.Xl=0,this.go=null,this.Fn=0,this.Ii=null,this.ye=null,this.Rn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),i&&Object.assign(this,i),this}cloneProtected(t){super.cloneProtected(t),t.ue=this.ue,t.Qe=this.Qe,t.vn=this.vn,t.Pi=this.Pi,t.pe=this.pe,t.qp=this.qp,t.Kd=this.Kd,this.K!==null&&(t.K=this.K.copy()),this.tt!==null&&(this.tt.me?t.tt=this.tt:t.tt=this.tt.copy()),t.Xl=this.Xl,t.go=this.go,t.Fn=this.Fn,t.Ii=this.Ii,t.ye=this.ye,t.Rn=this.Rn}Os(){return this.tt===null?this.tt=new sh:this.tt.me&&(this.tt=this.tt.copy()),this.tt}ba(){super.ba(),this.tt!==null&&(this.tt.me=!0)}YI(t){this.n=t.n|2048|4096,this.Zt=t.opacity,this.Lt=t.background,this.cs=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),t.Se!==null?this.Se=t.Se.copy():this.Se=null,this.it=t.scale,this.Xt=t.angle,this.stretch=t.stretch,this.sl=t.margin.N(),this.de=t.alignment.N(),this.wd=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,t.he!==null&&(this.he=t.he.copy()),this.shadowVisible=t.shadowVisible,this.ue=t.ue,this.Qe=t.Qe,this.vn=t.vn,this.K!==null&&(this.K=t.K.copy()),t.tt!==null&&(t.tt.me?this.tt=t.tt:this.tt=t.tt.copy()),this.Xl=t.Xl}XI(t){if(this.ue=t.text||"",this.Xt=t.labelAngle||0,this.Pi=t.lineCount||0,this.rE(t.lines),t.naturalBounds&&(this.Ke=t.naturalBounds),t.actualBounds){const i=t.actualBounds;this.Ut(i.x,i.y,i.width,i.height)}}fe(t){t in eh?this.wrap=t:super.fe(t)}toString(){return this.ue.length>22?'TextBlock("'+this.ue.substring(0,20)+'"...)':'TextBlock("'+this.ue+'")'}static getEllipsis(){return Kt.$0}static setEllipsis(t){Kt.$0=t,Kt.ek=new g,Kt.sC=0}static getBaseline(){return Kt.ik}static setBaseline(t){Kt.ik=t}static getUnderline(){return Kt.sk}static setUnderline(t){Kt.sk=t}c(){super.c(),this.$i(!0)}get font(){return this.vn}set font(t){const i=this.vn;i!==t&&(this.vn=t,this.go=null,this.c(),this.t("font",i,t))}static isValidFont(t){return c.CSS?c.CSS.supports("font",t):!0}get text(){return this.ue}set text(t){const i=this.ue;t!=null?t=t.toString():t="",i!==t&&(this.ue=t,this.c(),this.t("text",i,t))}get textAlign(){return this.tt!==null?this.tt.Z0:"start"}set textAlign(t){const i=this.textAlign;i!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.Os().Z0=t,this.C(),this.t("textAlign",i,t))}get flip(){return this.tt!==null?this.tt.mo:0}set flip(t){const i=this.flip;i!==t&&(this.Os().mo=t,this.C(),this.t("flip",i,t))}get verticalAlignment(){return this.tt!==null?this.tt.hl:X.Top}set verticalAlignment(t){const i=this.verticalAlignment;i.equals(t)||(t=t.N(),this.Os().hl=t,this.Pf(),this.t("verticalAlignment",i,t))}get naturalBounds(){if(!this.Ke.isReal()){const t=_.l();this.nC(this.ue,999999,t);let i=t.width;_.i(t);let s=this.MD(i);const n=this.desiredSize;isNaN(n.width)||(i=n.width),isNaN(n.height)||(s=n.height),this.Ke.jn(i,s)}return this.Ke}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const i=(this.n&2097152)!==0;i!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",i,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const i=(this.n&4194304)!==0;i!==t&&(this.n=this.n^4194304,this.$i(!0),this.C(),this.t("isUnderline",i,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const i=(this.n&8388608)!==0;i!==t&&(this.n=this.n^8388608,this.$i(!0),this.C(),this.t("isStrikethrough",i,t))}get wrap(){return this.tt!==null?this.tt.Q0:2}set wrap(t){const i=this.wrap;i!==t&&(this.Os().Q0=t,this.c(),this.t("wrap",i,t))}get overflow(){return this.tt!==null?this.tt._0:0}set overflow(t){const i=this.overflow;i!==t&&(this.Os()._0=t,this.c(),this.t("overflow",i,t))}get isOverflowed(){return(this.n&16777216)!==0}oC(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Qe}set stroke(t){const i=this.Qe;i!==t&&(t!==null&&me.Md(t,"TextBlock.stroke"),t instanceof me&&t.k(),this.Qe=t,typeof t!="string"&&this.xf(),this.C(),this.t("stroke",i,t))}get lineCount(){return this.Pi}get lineHeight(){return this.ty()}get editable(){return(this.n&1048576)!==0}set editable(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.t("editable",i,t))}get jN(){return(this.n&33554432)!==0}set jN(t){this.n=this.n^33554432}get textEditor(){return this.tt!==null?this.tt.ey:null}set textEditor(t){const i=this.textEditor;i!==t&&(this.Os().ey=t,this.t("textEditor",i,t))}get errorFunction(){return this.tt!==null?this.tt.gs:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(t!==null&&r.S(t,Kt,"errorFunction"),this.Os().gs=t,this.t("errorFunction",i,t))}get interval(){return this.K!==null?this.K.Ff:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new vs),this.K.Ff=t,this.c();const s=this.panel;s!==null&&(s.ds=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.Rf:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new vs),this.K.Rf=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.Of:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new vs),this.K.Of=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedFunction(){return this.K!==null?this.K.iy:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(t!==null&&r.S(t,Kt,"graduatedFunction"),this.K===null&&(this.K=new vs),this.K.iy=t,this.c(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return this.K!==null?this.K.If:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&r.S(t,Kt,"graduatedSkip"),this.K===null&&(this.K=new vs),this.K.If=t,this.c(),this.t("graduatedSkip",i,t))}Ma(t,i){if(this.Qe===null||this.ue.length===0||this.vn===null)return;const s=this.naturalBounds,n=this.actualBounds,o=s.width,a=s.height,l=this.ty();let h=t.textAlign=this.textAlign;const d=i.ld;h==="start"?h=d?"right":"left":h==="end"&&(h=d?"left":"right");const f=this.isUnderline,m=this.isStrikethrough;this.kn(t,this.Qe,!0,!1,s,n),(f||m)&&this.kn(t,this.Qe,!1,!1,s,n);const p=0;let b=0;const x=o;let v=!1;i.Wt===t&&!(i.Wt instanceof Ri)&&!this.jN&&i.getRenderingHint("textGreeking")===!0&&l*this.Th*i.scale<3&&(v=!0);const S=this.spacingAbove,P=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(o,0),t.scale(-1,1);break;case 1:t.translate(0,a),t.scale(1,-1);break;case 3:t.translate(o,a),t.scale(-1,-1);break}t.commitTransform();const T=this.Pi,A=(S+l+P)*T;if(a>A){const C=this.verticalAlignment;b=C.y*a-C.y*A+C.offsetY}if(Kt.nk&&(t.letterSpacing=this.letterSpacing,t.wordSpacing=this.wordSpacing),T===1&&this.Rn!==null){let C=this.pe;C>x&&(C=x),b+=S,this.ND(this.Rn,t,p,b,x,l,C,v,h,f,m)}else if(this.Ii!==null&&this.ye!==null)for(let C=0;C<T;C++){let O=this.Ii[C];O>x&&(O=x),b+=S,this.ND(this.ye[C],t,p,b,x,l,O,v,h,f,m),b+=l+P}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-o,0);break;case 1:t.scale(1,-1),t.translate(0,-a);break;case 3:t.scale(-1,-1),t.translate(-o,-a);break}}ND(t,i,s,n,o,a,l,h,d,f,m){let p=0;if(h){d==="left"?p=0:d==="right"?p=o-l:d==="center"&&(p=(o-l)/2);const v=i.globalAlpha;i.globalAlpha=v/2,i.fillRect(s+p,n+a/4,l,a/2),i.globalAlpha=v;return}d==="left"?p=0:d==="right"?p=o:d==="center"&&(p=o/2);const b=Kt.ik!==null?Kt.ik(this,a):a*.75;i.fillText(t,s+p,n+b);let x=a/20|0;if(x===0&&(x=1),d==="right"?p-=l:d==="center"&&(p-=l/2),f){const v=Kt.sk!==null?Kt.sk(this,a):a*.8;this.CD(s+p,n+v,s+p+l,n+v,x,i),i instanceof Ri&&i.lastCreatedElement.classList.add("gojs-td")}if(m){let v=n+a-a/2.2|0;x%2!==0&&(v+=.5),this.CD(s+p,v,s+p+l,v,x,i),i instanceof Ri&&i.lastCreatedElement.classList.add("gojs-td")}}CD(t,i,s,n,o,a){a.beginPath(),a.lineWidth=o,a.moveTo(t,i),a.lineTo(s,n),a.stroke(),a.endPath()}wf(t,i,s){if(!super.wf(t,i,s))return!1;if(this.kn(t,this.Qe,!0,!1,this.naturalBounds,this.actualBounds),s){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.lE(this.svg,this.ye?this.ye[0]:this.text,t);return!0}lE(t,i,s){t.innerHTML=i,s.setFillOrStrokeInPlace(t,!0)}Pd(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.Pd(t)}LN(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("text");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}aE(){this.Fn=0,this.pe=0,this.go=null,this.Ii=null,this.ye=null,this.Rn=null}bd(t,i,s,n){const o=this.Pi;this.Xl=t,this.oC(!1);const a=this.vn;Kt.us!==null&&(Kt.LD!==a&&(Kt.us.font=a,Kt.LD=a),Kt.nk&&(Kt.us.letterSpacing=this.letterSpacing,Kt.us.wordSpacing=this.wordSpacing)),this.aE();let l=0,h=0;isNaN(this.desiredSize.width)?(l=this.hE(),l=Math.min(l,t/this.scale)):l=this.desiredSize.width,this.panel!==null&&(l=Math.min(l,this.panel.maxSize.width)),h=this.MD(l),isNaN(this.desiredSize.height)?h=Math.min(h,i/this.scale):h=this.desiredSize.height,this.cE(t,h),(this.wrap===1||isNaN(this.desiredSize.width))&&(l=isNaN(t)?this.pe:Math.min(t,this.pe)),l=Math.max(s,l),h=Math.max(n,h),this.Ke.jn(l,h),this.lo(0,0,l,h),this.svg!==null&&o!==this.Pi&&this.$i(!0)}Pa(t,i,s,n){this.commonArrange(t,i,s,n)}On(t,i){this.Rn===null?(this.Rn=t,this.pe=i):((this.ye===null||this.Ii===null)&&(this.ye=[],this.Ii=[],this.ye.push(this.Rn),this.Ii.push(this.pe)),this.ye.push(t),this.Ii.push(i),this.ye.length>this.maxLines&&(this.n|=16777216))}nC(t,i,s){const n=this.formatting===0;n&&(t=t.trim());let o=0,a=0,l=0;const h=this.vn,d=this.spacingAbove+this.spacingBelow,f=Math.max(0,this.ty()+d),m=this.overflow===1?this.AD(h):0;if(this.Pi>=this.maxLines){s!==void 0&&s.e(0,f);return}let p=t;if(this.wrap===0){if(this.Fn=1,a=this.getStringWidth(t),m===0||a<=i){this.pe=Math.max(this.pe,a),this.On(t,this.pe),s!==void 0&&s.e(a,f);return}let x=this.Hd(p);p=p.substring(x.length);let v=this.Hd(p);for(a=this.getStringWidth(x+v),l=0;v.length>0&&a<=i;){x+=v,p=p.substring(v.length),v=this.Hd(p),l=a;let S=x+v;n&&(S=S.trim()),a=this.getStringWidth(S)}for(n&&(v=v.trim()),x+=v,i=Math.max(1,i-m);this.getStringWidth(x)>i&&x.length>1;)x=x.substring(0,x.length-1);this.oC(!0),x+=Kt.$0,l=this.getStringWidth(x),this.pe=l,this.On(x,l),s!==void 0&&s.e(l,f);return}let b=0;for(p.length===0&&(b=1,this.On(p,0));p.length>0;){let x=this.Hd(p);for(p=p.substring(x.length);this.getStringWidth(x)>i;){let P=1;for(a=this.getStringWidth(x.substring(0,P)),l=0;a<=i;)P++,l=a,a=this.getStringWidth(x.substring(0,P));let T=0;P===1?(T=a,o=Math.max(o,a)):(T=l,o=Math.max(o,l)),P--,P<1&&(P=1);const A=x.substring(0,P);if(this.On(A,T),b++,x=x.substring(P),this.Pi+b>this.maxLines)break}let v=this.Hd(p);for(a=this.getStringWidth(x+v),l=0;v.length>0&&a<=i;){x+=v,p=p.substring(v.length),v=this.Hd(p),l=a;let P=x+v;n&&(P=P.trim()),a=this.getStringWidth(P)}if(n&&(x=x.trim()),x==="")continue;x[x.length-1]===""&&(x=x.substring(0,x.length-1)+"");let S=0;if(v.length===0?(S=a,o=Math.max(o,a)):(l=this.getStringWidth(x),S=l,o=Math.max(o,l)),this.On(x,S),b++,this.Pi+b>this.maxLines)break}this.Fn=Math.min(this.maxLines-this.Pi,b),this.pe=Math.max(this.pe,o),s!==void 0&&s.e(this.pe,f*this.Fn)}cE(t,i){if(this.pe===0||this.Ii===null||this.ye===null||this.overflow!==1)return;const s=this.vn,n=this.overflow===1?this.AD(s):0,o=this.spacingAbove+this.spacingBelow,a=Math.max(0,this.ty()+o),l=Math.min(this.maxLines-1,Math.max(Math.floor(i/a+.01)-1,0));if(l+1>=this.ye.length)return;this.oC(!0);let h=this.ye[l];const d=Math.max(1,t-n);for(;this.getStringWidth(h)>d&&h.length>1;)h=h.substring(0,h.length-1);h+=Kt.$0;const f=this.getStringWidth(h);this.ye[l]=h,this.ye=this.ye.slice(0,l+1),this.Ii[l]=f,this.Ii=this.Ii.slice(0,l+1),this.Fn=this.ye.length,this.pe=Math.max(this.pe,f),this.Pi=this.Fn,this.Pi===1&&(this.Rn=this.ye[0])}Hd(t){if(this.wrap===3)return t.substring(0,1);let i=t.length,s=0;const n=Kt.fE;for(;s<i&&!n.test(t.charAt(s));)s++;for(this.formatting===1&&(i=Math.min(i,s+1));s<i&&n.test(t.charAt(s));)s++;return s>=t.length?t:t.substring(0,s)}getStringWidth(t){return Kt.us===null?t.length*8:Kt.us.measureText(t).width}ty(){if(this.go!==null)return this.go;const t=this.vn;let i=0;if(Kt.us===null)return i=16,this.go=i,i;if(Kt.rC[t]!==void 0&&Kt.TD<5e3)i=Kt.rC[t];else{Kt.us.letterSpacing="0px";const s=Kt.us.measureText("M");Kt.us.letterSpacing=this.letterSpacing,i=s.width*1.3,Kt.rC[t]=i,Kt.TD++}return this.go=i,i}AD(t){if(Kt.us===null)return 6;let i=0;return Kt.ek[t]!==void 0&&Kt.sC<5e3?i=Kt.ek[t]:(i=Kt.us.measureText(Kt.$0).width,Kt.ek[t]=i,Kt.sC++),i}ok(t,i){return t.indexOf(`
`,i)}MD(t){let i=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const s=this.spacingAbove+this.spacingBelow,n=Math.max(0,this.ty()+s);if(i.length===0)return this.pe=0,this.Pi=1,n;if(!this.isMultiline){const d=this.ok(i,0);d>=0&&(i=i.substring(0,d))}let o=0;this.Pi=0;let a=0,l=-1,h=!1;for(;!h;){if(l=this.ok(i,a),l===-1&&(l=i.length,h=!0),a<=l){const d=i.substring(a,l);if(this.wrap!==0){this.Fn=0;const f=_.l();this.nC(d,t,f),o+=f.height,_.i(f),this.Pi+=this.Fn}else this.nC(d,t),o+=n,this.Pi++;this.Pi===this.maxLines&&(h=!0)}a=l+1}return this.qp=o,o}hE(){let t=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let i=0,s=0,n=!1;for(;!n;){let o=this.ok(t,s);o===-1&&(o=t.length,n=!0);let a=t.substring(s,o);this.formatting===0&&(a=a.trim()),i=Math.max(i,this.getStringWidth(a)),s=o+1}return i}else{const i=this.ok(t,0);return i>=0&&(t=t.substring(0,i)),this.getStringWidth(t)}}get textValidation(){return this.tt!==null?this.tt.zl:null}set textValidation(t){const i=this.textValidation;i!==t&&(t!==null&&r.S(t,Kt,"textValidation"),this.Os().zl=t,this.t("textValidation",i,t))}get textEdited(){return this.tt!==null?this.tt.ny:null}set textEdited(t){const i=this.textEdited;i!==t&&(t!==null&&r.S(t,Kt,"textEdited"),this.Os().ny=t,this.t("textEdited",i,t))}get spacingAbove(){return this.tt!==null?this.tt.ly:0}set spacingAbove(t){const i=this.spacingAbove;i!==t&&(this.Os().ly=t,this.c(),this.t("spacingAbove",i,t))}get spacingBelow(){return this.tt!==null?this.tt.hy:0}set spacingBelow(t){const i=this.spacingBelow;i!==t&&(this.Os().hy=t,this.c(),this.t("spacingBelow",i,t))}get letterSpacing(){return this.tt!==null?this.tt.cy:"0px"}set letterSpacing(t){const i=this.letterSpacing;i!==t&&(Kt.nk=!0,this.Os().cy=t,this.c(),this.t("letterSpacing",i,t))}get wordSpacing(){return this.tt!==null?this.tt.fy:"0px"}set wordSpacing(t){const i=this.wordSpacing;i!==t&&(Kt.nk=!0,this.Os().fy=t,this.c(),this.t("wordSpacing",i,t))}get formatting(){return this.tt!==null?this.tt.uy:0}set formatting(t){const i=this.formatting;i!==t&&(this.Os().uy=t,this.c(),this.t("formatting",i,t))}get maxLines(){return this.tt!==null?this.tt.gy:1/0}set maxLines(t){const i=this.maxLines;i!==t&&(t=Math.floor(t),t<=0&&r.J(t,"> 0",Kt,"maxLines"),this.Os().gy=t,this.c(),this.t("maxLines",i,t))}getMetrics(){return[this.pe,this.Xl,this.go,this.Fn,this.Ii,this.ye,this.Rn||""]}rE(t){t!==void 0&&(this.pe=t[0],this.Xl=t[1],this.go=t[2],this.Fn=t[3],this.Ii=t[4],this.ye=t[5],this.Rn=t[6])}get metrics(){return{arrSize:this.Ii!==null?this.Ii:[this.pe],arrText:this.ye!==null?this.ye:[this.Rn],maxLineWidth:this.pe,fontHeight:this.go}}get choices(){return this.Kd}set choices(t){const i=this.Kd;i!==t&&(this.Kd=t,this.t("choices",i,t))}};y(Kt,"ik",null),y(Kt,"sk",null),y(Kt,"None",0),y(Kt,"WrapFit",1),y(Kt,"WrapDesiredSize",2),y(Kt,"WrapBreakAll",3),y(Kt,"OverflowClip",0),y(Kt,"OverflowEllipsis",1),y(Kt,"FormatTrim",0),y(Kt,"FormatNone",1),y(Kt,"fE",new RegExp("[ ]")),y(Kt,"rC",new g),y(Kt,"TD",0),y(Kt,"ek",new g),y(Kt,"sC",0),y(Kt,"$0","..."),y(Kt,"LD",""),y(Kt,"us",null),y(Kt,"M0",!1),y(Kt,"nk",!1);let Se=Kt;class sh{constructor(){y(this,"me");y(this,"gs");y(this,"mo");y(this,"uy");y(this,"gy");y(this,"_0");y(this,"ly");y(this,"hy");y(this,"Z0");y(this,"ny");y(this,"ey");y(this,"zl");y(this,"hl");y(this,"Q0");y(this,"cy");y(this,"fy");this.me=!1,this.gs=null,this.mo=0,this.uy=0,this.gy=1/0,this._0=0,this.ly=0,this.hy=0,this.Z0="start",this.ny=null,this.ey=null,this.zl=null,this.hl=X.Top,this.Q0=2,this.cy="0px",this.fy="0px"}copy(){const e=new sh;return e.gs=this.gs,e.mo=this.mo,e.uy=this.uy,e.gy=this.gy,e._0=this._0,e.ly=this.ly,e.hy=this.hy,e.Z0=this.Z0,e.ny=this.ny,e.ey=this.ey,e.zl=this.zl,e.hl=this.hl,e.Q0=this.Q0,e.cy=this.cy,e.fy=this.fy,e}}class vs{constructor(){y(this,"Ff");y(this,"Rf");y(this,"Of");y(this,"iy");y(this,"If");this.Ff=1,this.Rf=0,this.Of=1,this.iy=null,this.If=null}copy(){const e=new vs;return e.Ff=this.Ff,e.Rf=this.Rf,e.Of=this.Of,e.iy=this.iy,e.If=this.If,e}}var nh=(M=>(M[M.None=0]="None",M[M.Fill=2]="Fill",M[M.Uniform=6]="Uniform",M[M.UniformToFill=7]="UniformToFill",M))(nh||{});const $e=class $e extends Ht{constructor(t,i){super();y(this,"cl");y(this,"sn");y(this,"fl");y(this,"Ef");y(this,"gs");y(this,"ul");y(this,"Uf");y(this,"mo");y(this,"Vf");y(this,"Bf");y(this,"U1");this.n|=2097152,this.cl=null,this.sn="",this.fl=Y.GF,this.Ef=2,this.gs=null,this.ul=null,this.Uf=X.Center,this.mo=0,this.Vf=null,this.Bf=null,this.U1=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.sn=this.sn,t.element=this.cl,t.fl=this.fl.N(),t.Ef=this.Ef,t.mo=this.mo,t.gs=this.gs,t.ul=this.ul,t.Uf=this.Uf.N(),t.Bf=this.Bf}fe(t){t in nh?this.imageStretch=t:super.fe(t)}toString(){return"Picture("+this.source+")#"+F.xs(this)}get zf(){return(this.n&1048576)!==0}set zf(t){this.zf!==t&&(this.n=this.n^1048576)}get my(){return(this.n&2097152)!==0}set my(t){this.my!==t&&(this.n=this.n^2097152)}get Mn(){return(this.n&4194304)!==0}set Mn(t){this.Mn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),r.s(t,"string",$e,"clearCache:url"),t!==""?$e.yy[t]&&(delete $e.yy[t],$e.rk--):($e.yy=new g,$e.rk=0)}static ST(t,i){i.DD||(i.lk=s=>{$e.uE(i,s),t.desiredSize.isReal()||(t.xi(!1),t.c())},i.ak=s=>$e.dE(i,s),i.addEventListener("load",i.lk),i.addEventListener("error",i.ak),i.DD=!0)}static DO(t){t.lk&&t.removeEventListener("load",t.lk),t.ak&&t.removeEventListener("error",t.ak),delete t.lk,delete t.ak,t.DD=!1}get element(){return this.cl}set element(t){const i=this.cl;if(this.$i(!0),i!==t){const s=qt.isUsingDOM();let n=!1;s&&(this.zf=t instanceof HTMLCanvasElement,n=t instanceof HTMLImageElement,t!==null&&!(n||t instanceof HTMLVideoElement||this.zf)&&r.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t));const o=this.diagram;o!==null&&o.R2(this),this.cl=t,t!==null&&n&&t.hs===void 0&&(t.hs=new F),o!==null&&n&&o.F2(this),this.t("element",i,t),this.C()}}AO(){const t=this.cl;if(t===null)return;const i=this.desiredSize.isReal();(this.zf||t.complete===!0)&&(t.Dp&&(t.wy instanceof Event&&this.gs!==null?this.gs(this,t.wy):t.Mn===!0&&!t.wy&&this.ul!==null&&t.lC&&this.ul(this,t.lC)),t.Mn=!0),t.Mn&&i&&this.diagram!==null&&this.diagram.rd.add(this)}gE(){if(this.cl===null){this.Vf=!1;return}const t=new wn(null)._t;try{t.drawImage(this.cl,0,0)}catch{this.my=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Vf=!1),this.Vf=!1}catch{this.Vf=!0}}get source(){return this.sn}set source(t){const i=this.sn;if(i!==t){this.$i(!0),r.s(t,"string",$e,"source"),this.sn=t;let s=$e.yy,n=null;if(s[t]!==void 0)n=s[t];else if(t!==""){$e.rk>30&&($e.clearCache(),s=$e.yy),n=r.Ni("img"),n.Dp=!0,$e.ST(this,n);const o=this.Bf;o!==null&&(n.crossOrigin=o(this)),n.src=t,s[t]=n,$e.rk++}this.element=n,n!==null&&n.__goCache===void 0&&(n.__goCache=new Up),this.c(),this.C(),this.t("source",i,t)}}static uE(t,i){t.Mn=!0,t.wy=!1;let s;const n=t.hs.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const a=o.value;a.C();const l=t.getAttribute("src")||"",h=a.oa.get(l);if(h===null)continue;const d=h.length;for(let f=0;f<d;f++)s=h[f],s.desiredSize.isReal()||a.rd.add(s),s.$i(!0),a.requestUpdate(),t.Dp&&(t.lC===void 0&&(t.lC=i),s.ul!==null&&s.ul(s,i))}t.hs.clear()}static dE(t,i){t.wy=i;let s;const n=t.hs.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const a=o.value,l=t.getAttribute("src")||"",h=a.oa.get(l);if(h===null)continue;const d=h.length,f=r.nt();for(let m=0;m<d;m++)f.push(h[m]);if(t.Dp)for(let m=0;m<d;m++)s=f[m],s.gs!==null&&s.gs(s,i);r.Z(f)}t.hs.clear()}reloadSource(){if(this.source==="")return;$e.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.$i(!0)}get sourceCrossOrigin(){return this.Bf}set sourceCrossOrigin(t){if(this.Bf!==t){t!==null&&r.S(t,$e,"sourceCrossOrigin"),this.Bf=t;const i=this.element;if(i!==null){const s=i.getAttribute("src");i.crossOrigin!==void 0&&(t===null&&typeof s=="string"?i.crossOrigin=null:t!==null&&(i.crossOrigin=t(this)),s&&(i.src=s))}}}get sourceRect(){return this.fl}set sourceRect(t){const i=this.fl;i.equals(t)||(t=t.N(),this.fl=t,this.C(),this.t("sourceRect",i,t))}get imageStretch(){return this.Ef}set imageStretch(t){const i=this.Ef;i!==t&&(this.Ef=t,this.C(),this.t("imageStretch",i,t))}get flip(){return this.mo}set flip(t){const i=this.mo;i!==t&&(this.mo=t,this.C(),this.t("flip",i,t))}get imageAlignment(){return this.Uf}set imageAlignment(t){const i=this.Uf;i.equals(t)||(t=t.N(),this.Uf=t,this.C(),this.t("imageAlignment",i,t))}get errorFunction(){return this.gs}set errorFunction(t){const i=this.gs;i!==t&&(t!==null&&r.S(t,$e,"errorFunction"),this.gs=t,this.t("errorFunction",i,t))}get successFunction(){return this.ul}set successFunction(t){const i=this.ul;i!==t&&(t!==null&&r.S(t,$e,"successFunction"),this.ul=t,this.t("successFunction",i,t))}Ma(t,i){const s=this.cl;if(s===null)return;const n=s.getAttribute("src"),o=qt.isUsingDOM();if(o&&s instanceof HTMLImageElement&&(n===null||n==="")||s.wy instanceof Event&&t instanceof mr)return;const a=t instanceof Ri,l=this.naturalBounds;let h=0,d=0;const f=this.zf;let m=f?+s.width:s.naturalWidth,p=f?+s.height:s.naturalHeight;if(m===void 0&&s.videoWidth&&(m=s.videoWidth),p===void 0&&s.videoHeight&&(p=s.videoHeight),o){if(m===0||p===0)return}else m=this.width,p=this.height;const b=m,x=p;this.sourceRect.isReal()&&(h=this.fl.x,d=this.fl.y,m=this.fl.width,p=this.fl.height);let v=m,S=p;const P=this.Ef,T=this.Uf;switch(P){case 0:if(this.sourceRect.isReal())break;v>=l.width&&(h=h+T.offsetX+(v*T.x-l.width*T.x)),S>=l.height&&(d=d+T.offsetY+(S*T.y-l.height*T.y)),m=Math.min(l.width,v),p=Math.min(l.height,S);break;case 2:v=l.width,S=l.height;break;case 6:case 7:let J=0;P===6?(J=Math.min(l.height/S,l.width/v),v*=J,S*=J):P===7&&(J=Math.max(l.height/S,l.width/v),v*=J,S*=J,v>=l.width&&(h=(h+T.offsetX+(v*T.x-l.width*T.x)/v)*m),S>=l.height&&(d=(d+T.offsetY+(S*T.y-l.height*T.y)/S)*p),m*=1/(v/l.width),p*=1/(S/l.height),v=l.width,S=l.height);break}const A=m*p,C=this.getDocumentScale()*i.scale,O=v*C,R=S*C,I=O*R,H=A/I,V=s.__goCache;let z=null;const K=$e.mE;if(!a){if(s.Mn&&V!==void 0&&b<8e3&&x<8e3&&I>4&&H>K*K){V.Vt===null&&(V.vD(4,b,x,s),V.vD(16,b,x,s));const J=V.Vt,ot=J.length;for(let rt=0;rt<ot&&J[rt].jd*J[rt].jd<H;rt++)z=J[rt]}if(!i.od&&(this.Vf===null&&this.gE(),this.Vf))return}const $=v<l.width?T.offsetX+(l.width*T.x-v*T.x):0,q=S<l.height?T.offsetY+(l.height*T.y-S*T.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(l.width,v),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(l.height,S)),t.scale(1,-1);break;case 3:t.translate(Math.min(l.width,v),Math.min(l.height,S)),t.scale(-1,-1);break}if(t.commitTransform(),i.getRenderingHint("pictureRatioOptimization")&&!i.ph&&V!==void 0&&z!==null&&z.jd!==1){t.save();const J=z.jd;try{t.drawImage(z.sn,h/J,d/J,Math.min(z.sn.width,m/J),Math.min(z.sn.height,p/J),$,q,Math.min(l.width,v),Math.min(l.height,S)),t instanceof Ri&&(this.U1=[h/J,d/J,Math.min(z.sn.width,m/J),Math.min(z.sn.height,p/J),$,q,Math.min(l.width,v),Math.min(l.height,S)])}catch{this.my=!1}t.restore()}else try{t.drawImage(s,h,d,m,p,$,q,Math.min(l.width,v),Math.min(l.height,S)),t instanceof Ri&&(this.U1=[h,d,m,p,$,q,Math.min(l.width,v),Math.min(l.height,S)])}catch{this.my=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(l.width,v),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(l.height,S));break;case 3:t.scale(-1,-1),t.translate(-Math.min(l.width,v),-Math.min(l.height,S));break}}get naturalBounds(){return this.Ke}bd(t,i,s,n){const o=this.desiredSize,a=this.Qs(!0),l=this.cl,h=this.zf;let d=0,f=0;(h||!this.Mn&&l&&l.complete)&&(this.Mn=!0),l===null?(isFinite(o.width)||(t=s),isFinite(o.height)||(i=n)):(d=h?+l.width:l.naturalWidth,f=h?+l.height:l.naturalHeight),!isFinite(o.width)&&a!==2&&a!==5?l!==null&&this.Mn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=d):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:l!==null&&(t=d)),s=0),!isFinite(o.height)&&a!==2&&a!==4?l!==null&&this.Mn!==!1&&(this.sourceRect.isReal()?i=this.sourceRect.height:i=f):(isFinite(i)||(this.sourceRect.isReal()?i=this.sourceRect.height:l!==null&&(i=f)),n=0),isFinite(o.width)&&(t=o.width),isFinite(o.height)&&(i=o.height);const m=this.maxSize,p=this.minSize;s=Math.max(s||0,p.width),n=Math.max(n||0,p.height),t=Math.min(m.width,t),i=Math.min(m.height,i),t=Math.max(s,t),i=Math.max(n,i),l!==null&&!l.complete&&(isFinite(t)||(t=0),isFinite(i)||(i=0)),this.Ke.jn(t,i),this.lo(0,0,t,i)}Pa(t,i,s,n){this.commonArrange(t,i,s,n)}};y($e,"yy",new g),y($e,"rk",0),y($e,"mE",4);let cs=$e;class Up{constructor(){y(this,"Vt");this.Vt=null}vD(e,t,i,s){this.Vt===null&&(this.Vt=[]);const n=new wn(null),o=n._t,a=1/e;if(n.width=t/e,n.height=i/e,n.width===0||n.height===0)return;const l=new Xp(n.bt,e);let h=s,d=1;if(this.Vt.length>0){const f=this.Vt[this.Vt.length-1];h=f.sn,d=f.jd}o.setTransform(a*d,0,0,a*d,0,0),o.commitTransform(),o.drawImage(h,0,0),this.Vt.push(l)}}class Xp{constructor(e,t){y(this,"sn");y(this,"jd");this.sn=e,this.jd=t}}const Gn=class Gn{constructor(){y(this,"Ne");y(this,"um");this.um=new It,this.Ne=null}Ue(e){e!==null?(this.um=e,e.figures.clear()):this.um=new It,this.Ne=null}Au(e,t,i,s,n,o){if(s!==void 0&&s===!0){const a=new et(1);a.endX=e,a.endY=t,this.Ne.segments.add(a)}else this.Ne=new Z,this.Ne.startX=e,this.Ne.startY=t,this.Ne.isFilled=i,this.Ne.isEvenOdd=o||!1,this.um.figures.add(this.Ne);n!==void 0&&(this.Ne.isShadowed=n)}_F(){const e=this.Ne.segments.length;e>0&&this.Ne.segments.elt(e-1).close()}tR(){this.Ne.segments.length>0&&(this.Ne.isFilled=!0)}eR(e){this.Ne.isShadowed=e}zU(e){this.Ne.isEvenOdd=e}$F(e,t,i){i===void 0&&(i=!1);const s=new et(1);s.endX=e,s.endY=t,i&&s.close(),this.Ne.segments.add(s)}Ks(e,t,i){i===void 0&&(i=!1);const s=new et(2);s.endX=e,s.endY=t,i&&s.close(),this.Ne.segments.add(s)}xr(e,t,i,s,n,o,a){a===void 0&&(a=!1);const l=new et(3);l.point1X=e,l.point1Y=t,l.point2X=i,l.point2Y=s,l.endX=n,l.endY=o,a&&l.close(),this.Ne.segments.add(l)}Tu(e,t,i,s,n){n===void 0&&(n=!1);const o=new et(4);o.point1X=e,o.point1Y=t,o.endX=i,o.endY=s,n&&o.close(),this.Ne.segments.add(o)}ZF(e,t,i,s,n,o,a){o===void 0&&(o=0),a===void 0&&(a=!1);const l=new et(5);l.startAngle=e,l.sweepAngle=t,l.centerX=i,l.centerY=s,l.radiusX=n,o!==0?l.radiusY=o:l.radiusY=n,a&&l.close(),this.Ne.segments.add(l)}QF(e,t,i,s,n,o,a,l){l===void 0&&(l=!1);const h=new et(6,o,a,e,t,i,s,n);l&&h.close(),this.Ne.segments.add(h)}static qL(e){const t=Gn.aC;if(t!==null)return Gn.aC=null,t.Ue(e),t;{const i=new Gn;return i.Ue(e),i}}static WL(e){Gn.aC=e}};y(Gn,"aC",null);let vo=Gn;{const M=function(n,o){const a=n.toLowerCase(),l=B.Jn;l[n]=o,l[a]=n};M("Rectangle",(n,o,a)=>{const l="r"+o+","+a;let h=B.yr[l];return h!==void 0||(h=new It(2),h.endX=o,h.endY=a,B.wr<B.am&&(B.yr[l]=h,B.wr++)),h}),M("Square",(n,o,a)=>{const l="s"+o+","+a;let h=B.yr[l];return h!==void 0||(h=new It(2),h.endX=o,h.endY=a,h.defaultStretch=6,B.wr<B.am&&(B.yr[l]=h,B.wr++)),h});const e=(n,o,a,l,h)=>{(isNaN(l)||l<0)&&(l=5),isNaN(h)&&(h=15);const d="rr"+o+","+a+","+l+","+h;let f=B.yr[d];if(f!==void 0)return f;let m=l;(h&1)===1?(m=Math.min(m,(h&2)===2?o/3:o),m=Math.min(m,(h&8)===8?a/3:a)):m=0;const p=new Z(m,0,!0);f=new It().add(p);const b=X.TopLeft.copy(),x=X.BottomRight.copy();if((h&2)===2){let v=l;v=Math.min(v,(h&1)===1?o/3:o),v=Math.min(v,(h&4)===4?a/3:a);const S=v*B.qn;p.add(new et(2,o-v,0)).add(new et(3,o,v,o-S,0,o,S)),b.offsetY=S,x.offsetX=-S}else p.add(new et(2,o,0));if((h&4)===4){let v=l;v=Math.min(v,(h&8)===8?o/3:o),v=Math.min(v,(h&2)===2?a/3:a);const S=v*B.qn;p.add(new et(2,o,a-v)).add(new et(3,o-v,a,o,a-S,o-S,a)),x.offsetX=-S,x.offsetY=-S}else p.add(new et(2,o,a));if((h&8)===8){let v=l;v=Math.min(v,(h&4)===4?o/3:o),v=Math.min(v,(h&1)===1?a/3:a);const S=v*B.qn;p.add(new et(2,v,a)).add(new et(3,0,a-v,S,a,0,a-S)),b.offsetX=S,x.offsetY=-S}else p.add(new et(2,0,a));if((h&1)===1){const v=m*B.qn;p.add(new et(2,0,m)).add(new et(3,m,0,0,v,v,0).close()),b.offsetX=v,b.offsetY=v}else p.add(new et(2,0,0).close());return f.spot1=b,f.spot2=x,B.wr<B.am&&(B.yr[d]=f,B.wr++),f};M("RoundedRectangle",(n,o,a)=>{const l=n?n.parameter1:NaN,h=n?n.parameter2:NaN;return e(n,o,a,l,h)}),M("Border","RoundedRectangle"),M("RoundedTopRectangle",(n,o,a)=>{const l=n?n.parameter1:NaN;return e(n,o,a,l,3)}),M("RoundedBottomRectangle",(n,o,a)=>{const l=n?n.parameter1:NaN;return e(n,o,a,l,12)}),M("RoundedLeftRectangle",(n,o,a)=>{const l=n?n.parameter1:NaN;return e(n,o,a,l,9)}),M("RoundedRightRectangle",(n,o,a)=>{const l=n?n.parameter1:NaN;return e(n,o,a,l,6)}),M("Ellipse",(n,o,a)=>{const l="e"+o+","+a;let h=B.yr[l];return h!==void 0||(h=new It(3),h.endX=o,h.endY=a,h.spot1=X.vP,h.spot2=X.FP,B.wr<B.am&&(B.yr[l]=h,B.wr++)),h}),M("Circle",(n,o,a)=>{const l="c"+o+","+a;let h=B.yr[l];return h!==void 0||(h=new It(3),h.endX=o,h.endY=a,h.spot1=X.vP,h.spot2=X.FP,h.defaultStretch=6,B.wr<B.am&&(B.yr[l]=h,B.wr++)),h}),M("TriangleRight",(n,o,a)=>new It().add(new Z(0,0).add(new et(2,o,.5*a)).add(new et(2,0,a).close())).setSpots(0,.25,.5,.75)),M("TriangleDown",(n,o,a)=>new It().add(new Z(0,0).add(new et(2,o,0)).add(new et(2,.5*o,a).close())).setSpots(.25,0,.75,.5)),M("TriangleLeft",(n,o,a)=>new It().add(new Z(o,a).add(new et(2,0,.5*a)).add(new et(2,o,0).close())).setSpots(.5,.25,1,.75)),M("TriangleUp",(n,o,a)=>new It().add(new Z(o,a).add(new et(2,0,a)).add(new et(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),M("Triangle","TriangleUp"),M("Diamond",(n,o,a)=>new It().add(new Z(.5*o,0).add(new et(2,0,.5*a)).add(new et(2,.5*o,a)).add(new et(2,o,.5*a).close())).setSpots(.25,.25,.75,.75)),M("LineH",(n,o,a)=>{const l=new It(1);return l.startX=0,l.startY=a/2,l.endX=o,l.endY=a/2,l}),M("LineV",(n,o,a)=>{const l=new It(1);return l.startX=o/2,l.startY=0,l.endX=o/2,l.endY=a,l}),M("None","Rectangle"),M("BarH","Rectangle"),M("BarV","Rectangle"),M("MinusLine","LineH"),M("PlusLine",(n,o,a)=>new It().add(new Z(0,a/2,!1).add(new et(2,o,a/2)).add(new et(1,o/2,0)).add(new et(2,o/2,a)))),M("XLine",(n,o,a)=>new It().add(new Z(0,a,!1).add(new et(2,o,0)).add(new et(1,0,0)).add(new et(2,o,a)))),M("LineRight",(n,o,a)=>new It().add(new Z(.25*o,0,!1).add(new et(2,.75*o,.5*a)).add(new et(2,.25*o,a)))),M("LineDown",(n,o,a)=>new It().add(new Z(0,.25*a,!1).add(new et(2,.5*o,.75*a)).add(new et(2,o,.25*a)))),M("LineLeft",(n,o,a)=>new It().add(new Z(.75*o,0,!1).add(new et(2,.25*o,.5*a)).add(new et(2,.75*o,a)))),M("LineUp",(n,o,a)=>new It().add(new Z(0,.75*a,!1).add(new et(2,.5*o,.25*a)).add(new et(2,o,.75*a)))),M("Capsule",(n,o,a)=>{const l=new It;if(o<a){const h=o/2,d=new Z(0,h,!0);l.add(d),d.add(new et(5,180,180,h,h,h,h)),d.add(new et(2,o,a-h)),d.add(new et(5,0,180,h,a-h,h,h)),d.add(new et(2,0,h));const f=isFinite(n.parameter1)?n.parameter1:o*.156;return l.setSpots(0,0,1,1,0,f,0,-f),l}else if(o>a){const h=a/2,d=new Z(h,0,!0);l.add(d),d.add(new et(2,o-h,0)),d.add(new et(5,270,180,o-h,h,h,h)),d.add(new et(2,h,a)),d.add(new et(5,90,180,h,h,h,h));const f=isFinite(n.parameter1)?n.parameter1:a*.156;return l.setSpots(0,0,1,1,f,0,-f,0),l}else return l.type=3,l.endX=o,l.endY=a,l.spot1=X.vP,l.spot2=X.FP,l});const t=(n,o)=>new Z(n,o,!1,!1),i=(n,o,a)=>n.add(new et(2,o,a)),s=(n,o,a)=>n.add(new et(1,o,a));M("Borders",(n,o,a)=>{let l=n?n.parameter1:NaN;isNaN(l)?l=10:l=l&15;const h=new It;let d;return l===10?(d=t(o,0),i(d,o,a),s(d,0,a),i(d,0,0)):l===5?(d=t(0,0),i(d,o,0),s(d,o,a),i(d,0,a)):l===1?(d=t(0,0),i(d,o,0),s(d,o,a)):l===2?(d=t(o,0),i(d,o,a)):l===4?(d=t(o,a),i(d,0,a)):l===8?(d=t(0,a),i(d,0,0),s(d,o,a)):l===3?(d=t(0,0),i(d,o,0),i(d,o,a)):l===6?(d=t(o,0),i(d,o,a),i(d,0,a)):l===12?(d=t(o,a),i(d,0,a),i(d,0,0)):l===9?(d=t(0,a),i(d,0,0),i(d,o,0)):l===7?(d=t(0,0),i(d,o,0),i(d,o,a),i(d,0,a)):l===14?(d=t(o,0),i(d,o,a),i(d,0,a),i(d,0,0)):l===13?(d=t(o,a),i(d,0,a),i(d,0,0),i(d,o,0)):l===11?(d=t(0,a),i(d,0,0),i(d,o,0),i(d,o,a)):l===15?(d=t(0,0),i(d,o,0),i(d,o,a),i(d,0,a),d.add(new et(2,0,0).close())):(d=t(0,0),s(d,o,a)),h.add(d),h})}B.lm={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var Hu=(M=>(M[M.None=0]="None",M[M.Added=1]="Added",M[M.Removed=2]="Removed",M[M.Shown=4]="Shown",M[M.Hidden=8]="Hidden",M[M.NodeSized=16]="NodeSized",M[M.GroupLayout=32]="GroupLayout",M[M.NodeReplaced=64]="NodeReplaced",M[M.Standard=127]="Standard",M[M.All=16777215]="All",M))(Hu||{});const He=class He extends Lt{constructor(t,i){let s;t===void 0||t instanceof le||typeof t=="string"?s=t:t&&(i=t);super(s);y(this,"b");y(this,"_o");y(this,"H");y(this,"dl");y(this,"gl");y(this,"tr");y(this,"ue");y(this,"pl");y(this,"Ta");y(this,"nn");y(this,"er");y(this,"qd");y(this,"UM");y(this,"FD");y(this,"xy");y(this,"ky");this.b=2408959,this._o="",this.H=null,this.dl="",this.gl=null,this.tr=null,this.ue="",this.pl=null,this.Ta=null,this.nn=new L(NaN,NaN).k(),this.er=null,this.qd=NaN,this.UM=-1,this.FD=new Y,this.xy=null,this.ky=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.b=this.b&-4097|16384|32768,t._o=this._o,this.H!==null&&(this.H.me?t.H=this.H:t.H=this.H.copy()),t.dl=this.dl,t.tr=null,t.ue=this.ue,t.nn.h(this.nn),t.qd=this.qd}jo(t){super.jo(t),t.Sa(),t.gl=null,t.er=null,t.xy=null}toString(){let t=r.Hn(this.constructor)+"#"+F.xs(this);return this.data!==null&&(t+="("+r.toString(this.data)+")"),t}_e(){return this.H===null?this.H=new oh:this.H.me&&(this.H=this.H.copy()),this.H}ba(){super.ba(),this.H!==null&&(this.H.me=!0)}gf(t,i,s,n,o,a,l){const h=this.diagram;h!==null&&(t===3&&i==="elements"?o instanceof Lt?o.Sn(d=>{h.partManager.N2(d,h)}):o instanceof cs&&h.F2(o):t===4&&i==="elements"&&(o instanceof Lt?o.Sn(d=>h.partManager.C2(d,h)):o instanceof cs&&h.R2(o)),h.raiseChangedEvent(t,i,s,n,o,a,l))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const i=this.D.r,s=i.length;for(let o=0;o<s;o++){const a=i[o];a instanceof Lt&&a.Sn(l=>{l.data!==null&&l.JI(t)})}const n=this.adornments;for(;n.next();)n.value.updateTargetBindings(t)}Yo(){if(super.Yo(),this.RN()){const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof Lt&&o.Sn(a=>a.Yo())}}const t=this.adornments;for(;t.next();)t.value.Yo()}updateRelationshipsFromData(){var t;this.data!==null&&((t=this.diagram)==null||t.partManager.updateRelationshipsFromData(this))}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.tr===null?w.instance:this.tr.iteratorValues}findAdornment(t){const i=this.tr;return i===null?null:i.get(t)}addAdornment(t,i){if(i===null)return;let s=null,n=this.tr;if(n!==null&&(s=n.get(t)),s!==i){if(s!==null){const a=s.diagram;a!==null&&a.remove(s)}n===null&&(n=new nt,this.tr=n),i._o!==t&&(i.category=t),n.set(t,i);const o=this.diagram;if(o!==null){o.add(i);const a=i.adornedObject;if(a!==null){const l=a.findBindingPanel();l!==null&&(i.data=l.data)}}}}removeAdornment(t){const i=this.tr;if(i===null)return;const s=i.get(t);if(s!==null){const n=s.diagram;n!==null&&(n.remove(s),s.data=null)}i.delete(t),i.count===0&&(this.tr=null)}clearAdornments(){const t=this.tr;if(t===null)return;const i=r.nt(),s=t.iterator;for(;s.next();){const o=s.key;i.push(o)}const n=i.length;for(let o=0;o<n;o++)this.removeAdornment(i[o]);r.Z(i)}updateAdornments(){const t=this.diagram;if(t===null)return;this.pE(t),this.yE(t);let i=this.adornments;for(;i.next();){const s=i.value;s.c(),s.hasPlaceholder()&&s.placeholder.c()}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t.ha(),this.RD()!==!0&&this.OD(!0))}VM(){this.RD()!==!1&&(this.updateAdornments(),this.OD(!1))}pE(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const s=this.selectionObject;if(s!==null&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let n=this.findAdornment(i);if(n===null){let o=this.selectionAdornmentTemplate;o===null&&(this.Ar()?o=t.linkSelectionAdornmentTemplate:this instanceof Ft?o=t.groupSelectionAdornmentTemplate:o=t.nodeSelectionAdornmentTemplate),n=o.copy(),n!==null&&(this.Ar()&&this.selectionObject===this.path&&(n.type=Lt.Link),n.adornedObject=s)}if(n!==null){n.type===Lt.Link&&n.c(),this.addAdornment(i,n);return}}}this.removeAdornment(i)}yE(t){const i=this;t.toolManager.mouseDownTools.each(s=>{s.isEnabled&&s.updateAdornments(i)}),t.toolManager.updateAdornments(i)}IM(t){this.pl=t,t===null&&this.uI()}get layer(){return this.pl}get diagram(){const t=this.pl;return t==null?null:t.diagram}get layerName(){return this.dl}set layerName(t){const i=this.dl;if(i===t)return;let s=this.diagram;if(s!==null&&(s.findLayer(t)===null||s.partManager.addsToTemporaryLayer))return;this.dl=t,s!==null&&s.invalidateDocumentBounds(),this.t("layerName",i,t);const n=this.layer;if(n===null||n.name===t||(s=n.diagram,s===null))return;const o=s.findLayer(t);if(o===null||o===n)return;let a=n.ri(-1,this,!0);a>=0&&s.raiseChangedEvent(4,"parts",n,this,null,a,!0),a=o.ch(99999999,this,!0),n.visible!==o.visible&&this.Xe(o.visible),a>=0&&s.raiseChangedEvent(3,"parts",o,null,this,!0,a);const l=this.layerChanged;if(l===null)return;const h=s.G;s.G=!0,l(this,n,o),s.G=h}get layerChanged(){return this.H!==null?this.H.Py:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(t!==null&&r.S(t,He,"layerChanged"),this._e().Py=t,this.t("layerChanged",i,t))}get zOrder(){return this.qd}set zOrder(t){const i=this.qd;if(i===t)return;this.qd=t;const s=this.layer;s!==null&&s.rb(-1,this),this.t("zOrder",i,t);const n=this.diagram;n!==null&&n.C()}wE(){const t=this.layer;t!==null&&t.rb(-1,this)}hk(){if(this.fa()!==!1)return;this.hC(!0),this.yf();const t=this.diagram;t!==null&&(t.Cp(this),t.requestUpdate())}ID(){if(this.b|=2097152,this.fa()===!1)return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.ED(t,i);const s=this.De,n=Y.l().h(s);s.ce(),s.x=t.x,s.y=t.y,s.k(),this.kd(n,s),Y.i(n),this.hC(!1),this.yf()}lo(t,i,s,n){const o=this.hi;o.e(t,i,s,n),this.Se===null&&(this.Se=new lt);const a=this.Se;a.Ue(),this.Kp(a,t,i,s,n),this.Se=a,a.RP()||a.sm(o)}Kp(t,i,s,n,o){if(this.it!==1&&t.it(this.it),this.Xt===0)return;let a=X.Center;this.locationSpot.isSpot()&&(a=this.locationSpot);const l=L.l();if(this.locationObject!==this){const h=this.locationObject,d=h.naturalBounds;l.setSpot(d.x,d.y,d.width,d.height,a),h.Se!==null&&h.Se.gt(l),l.offset(-h.measuredBounds.x,-h.measuredBounds.y);let f=h.panel;for(;f!==null&&f!==this;)f.Se!==null&&f.Se.gt(l),l.offset(-f.measuredBounds.x,-f.measuredBounds.y),f=f.panel}else l.setSpot(i,s,n,o,a);t.ks(this.Xt,l.x,l.y),L.i(l)}get locationObject(){var t;if(this.er===null)if(this instanceof Jt&&this.type!==Lt.Link&&this.hasPlaceholder())this.er=this.placeholder;else{const i=this.locationObjectName;if(i!==""){const s=this.findObject(i);s!==null?this.er=s:this.er=this}else this.er=this}return(t=this.er)!=null&&t.visible?this.er:this}get minLocation(){return this.H!==null?this.H.Sy:L.DL}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.N(),this._e().Sy=t,this.t("minLocation",i,t))}get maxLocation(){return this.H!==null?this.H.My:L.vL}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.N(),this._e().My=t,this.t("maxLocation",i,t))}get locationObjectName(){return this.H!==null?this.H.Ny:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this._e().Ny=t,this.er=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return this.H!==null?this.H.Cy:X.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.N(),this._e().Cy=t,this.c(),this.t("locationSpot",i,t))}move(t,i){i===!0?this.location=t:this.position=t}moveTo(t,i,s){const n=L.z(t,i);this.move(n,s),L.i(n)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const s=t.diagram;if(s!==null&&s.animationManager.Wx(this))return!0}const i=this.containingGroup;return!(i!==null&&(!i.isSubGraphExpanded||!i.isVisible()))}Xe(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),i!==null&&i.Cp(this)):(this.invalidateLayout(8),this.clearAdornments()),this.Sa(),i!==null&&(i.invalidateDocumentBounds(),this instanceof wt&&this.canAvoid()&&i.fd(this),i.C())}findObject(t){if(this.name===t)return this;let i=this.xy;if(i===null&&(this.xy=i=new nt),i.get(t)!==null)return i.get(t);const s=super.findObject(t);return s!==null?(i.set(t,s),s):(i.set(t,null),null)}s0(){this.xy=null}getRelativePoint(t,i,s){s===void 0&&(s=new L);const n=i.isNoSpot()?X.Center:i,o=t.naturalBounds;if(s.e(o.width*n.x+n.offsetX,o.height*n.y+n.offsetY),t===null||t===this)return s;t.v.gt(s);let a=t.panel;for(;a!==null&&a!==this;)a.v.gt(s),a=a.panel;return this.Se!==null&&this.Se.gt(s),s.offset(-this.hi.x,-this.hi.y),s}getDocumentBounds(t){return t===void 0&&(t=new Y),t.h(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Ut()}cD(t){const i=this.locationSpot,s=this.locationObject;let n=s.naturalBounds;n.isReal()||(n=Y.em);const o=s instanceof Xt?s.strokeWidth:0;if(t.setSpot(0,0,n.width+o,n.height+o,i),s!==this){t.offset(-o/2,-o/2),s.v.gt(t);let a=s.panel;for(;a!==null&&a!==this;)a.v.gt(t),a=a.panel}return this.Se!==null&&this.Se.gt(t),t.offset(-this.hi.x,-this.hi.y),t}hh(t,i){const s=i===void 0?this.FD:i,n=this.xE(),o=n*2;if(!this.isShadowed)return s.e(t.x-1-n,t.y-1-n,t.width+2+o,t.height+2+o),s;let a=t.x,l=t.y,h=t.width,d=t.height;const f=this.shadowBlur,m=this.shadowOffset;return h+=f,d+=f,a-=f/2,l-=f/2,m.x>0?h+=m.x:(a+=m.x,h-=m.x),m.y>0?d+=m.y:(l+=m.y,d-=m.y),s.e(a-1,l-1,h+2,d+2),s}eE(){return this.type===Lt.Link&&this instanceof Jt&&this.category==="Selection"&&this.adornedObject instanceof Xt&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}xE(){return isNaN(this.ky)&&(this.ky=this.yD()),this.ky}Df(){this.ky=NaN}Ut(){if(this.as()===!1){this.ID();return}this.ao(!1);const t=this.De,i=Y.l();i.h(t);const s=this.Ul();this.Pa(0,0,this.hi.width,this.hi.height);const n=this.position;this.ED(n,this.location),t.ce(),t.x=n.x,t.y=n.y,t.k(),this.kd(i,t),i.equals(t)?this.As(s):this.Di()&&(!B.u(i.width,t.width)||!B.u(i.height,t.height))&&this.UM>=0&&this.invalidateLayout(16),Y.i(i),this.hC(!1)}kd(t,i){const s=this.diagram;if(s===null)return;let n=!1;if(s.mh===!1&&t.isReal()){const o=Y.l();o.h(s.documentBounds),o.subtractMargin(s.padding),t.x>o.x&&t.y>o.y&&t.right<o.right&&t.bottom<o.bottom&&i.x>o.x&&i.y>o.y&&i.right<o.right&&i.bottom<o.bottom&&(n=!0),Y.i(o)}(this.bE()===!0||!t.equals(i))&&this.dT(n,s),s.C(),!(!t.isReal()&&!i.isReal()||t.equalsApproxClose(i))&&(this instanceof wt&&!s.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.Sa())}get location(){return this.nn}set location(t){const i=t.x,s=t.y,n=this.nn;(n.x!==i&&(!isNaN(n.x)||!isNaN(i))||n.y!==s&&(!isNaN(n.y)||!isNaN(s)))&&(t=t.copy(),this.kE(t,n)&&this.t("location",n,t.copy()))}kE(t,i){if(this.Ar())return!1;if(this.nn=t,this.b|=2097152,this.as()===!1){this.hk();const s=this.ct;if(s.isReal()){const n=this.diagram;if(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing){const o=s.copy();s.e(s.x+(t.x-i.x),s.y+(t.y-i.y)),this.UD(n,s,o.x,o.y),this.t("position",o,s.copy())}}}return!0}DN(t,i,s){if(this.Ar()||!t.isReal())return!1;const n=this.diagram;if(n!==null&&this.UD(n,t,i,s),this.ct=t,this.b&=-2097153,this.nn.isReal()&&(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing)){const o=this.nn;this.nn=new L(o.x+(t.x-i),o.y+(t.y-s)).k(),this.t("location",o,this.nn.copy())}return this.fa()===!1&&this.as()===!1&&(this.hk(),this.ID()),!0}UD(t,i,s,n){if(t===null||this instanceof Jt)return;const o=t.animationManager;o.ke&&o.vA(this,new L(s,n),i,!1)}Uc(t,i,s){const n=this.nn,o=this.ct;if(s){if(n.x===t&&n.y===i)return;this.fa()||this.as()?o.e(NaN,NaN):o.e(o.x+t-n.x,o.y+i-n.y),n.e(t,i)}else{if(o.x===t&&o.y===i)return;n.e(n.x+t-o.x,n.y+i-o.y),o.e(t,i)}this.hk()}vN(){this.b&=-2097153,this.hk()}ED(t,i){const s=this.cD(L.l()),n=this.diagram,o=i.isReal(),a=t.isReal();o&&a?(this.b&2097152)!==0?this.VD(t,i,n,s):this.BD(t,i,n,s):o?this.VD(t,i,n,s):a&&this.BD(t,i,n,s),this.b|=2097152,L.i(s),this.yf()}VD(t,i,s,n){const o=t.x,a=t.y;if(t.e(i.x-n.x,i.y-n.y),s!==null){const l=s.animationManager,h=l.defaultAnimation.isAnimating;!h&&l.ke&&!(this instanceof Jt)&&l.vA(this,new L(o,a),t,!1),!h&&!(t.x===o&&t.y===a)&&this.t("position",new L(o,a),t.copy())}}BD(t,i,s,n){const o=i.copy();i.e(t.x+n.x,t.y+n.y),!i.equals(o)&&s!==null&&this.t("location",o,i.copy())}dT(t,i){this.NN(!1),this instanceof wt&&i.fd(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const s=this.De,n=i.viewportBounds;n.isReal()?this.Ul()?(s.UL(n,10)||this.As(!1),this.updateAdornments()):this.isVisible()&&s.intersectsRect(n)?(this.As(!0),this.updateAdornments()):this.invalidateAdornments():i.tf=!0}_r(){return!0}Di(){return!0}Ar(){return!1}_s(){return!0}hasPlaceholder(){return!1}get category(){return this._o}set category(t){const i=this._o;if(i===t)return;this.svg!==null&&(this.svg.remove(),this.$i(!0));const s=this.diagram,n=this.data;let o=null;if(s!==null&&n!==null&&!(this instanceof Jt)){const a=s.model.undoManager;a.isEnabled&&!a.isUndoingRedoing&&(o=this.clone(),o.D.addAll(this.D))}if(this._o=t,this.t("category",i,t),s!==null&&n!==null&&!(this instanceof Jt)){const a=s.model;if(a.undoManager.isUndoingRedoing)return;if(this.Ar()){s.partManager.setLinkCategoryForData(n,t);const l=s.partManager.findLinkTemplateForCategory(t);if(l!==null){l.It();const h=l.copy();h!==null&&this.cC(h,i,t)}}else{a!==null&&a.setCategoryForNodeData(n,t);const l=s.partManager.findTemplateForNodeData(n,t);if(l!==null){l.It();const h=l.copy();if(h!==null&&!(h instanceof Nt)){const d=this.location.copy();this.cC(h,i,t),this.location.isReal()||(this.location=d)}}}if(o!==null){const l=this.clone();l.D.addAll(this.D),this.t("self",o,l)}}else if(this instanceof Jt){const a=this.adornedPart;if(a!==null){const l=a.tr;l!==null&&l.delete(i),a.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.cC(t,this.category,t.category)}cC(t,i,s){t.constructor!==this.constructor&&(He.zD||(He.zD=!0,r.ne('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),r.ne("  Old class: "+r.Hn(this.constructor)+", new class: "+r.Hn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,a=this.isSelected,l=this.isHighlighted;let h=!0,d=!0,f=!1;this instanceof wt&&(h=this.isTreeLeaf,d=this.isTreeExpanded,f=this.wasTreeExpanded),t.jo(this),t.cloneProtected(this),this._o=s,this.svg!==null&&(this.svg.remove(),this.Wc(),this.$i(!0)),this.c(),this.C();const m=this.diagram;let p=!0;m!==null&&(p=m.skipsUndoManager,m.skipsUndoManager=!0),this.te=n,this.b=a?this.b|4096:this.b&-4097,this.b=l?this.b|524288:this.b&-524289,this instanceof wt&&(this.E=h?this.E|4:this.E&-5,this.E=d?this.E|1:this.E&-2,this.E=f?this.E|2:this.E&-3),n!==null&&this.updateTargetBindings();const b=this.layerName;b!==o&&(this.dl=o,this.layerName=b),m!==null&&(m.skipsUndoManager=p),this.Di()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return i===null?!0:!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return i===null?!0:!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return i===null?!0:!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return i===null?!0:!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const i=t.diagram;return i===null?!0:!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return i===null?!0:!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const i=t.diagram;return i===null?!0:!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return i===null?!0:!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return i===null?!0:!!i.allowSelect}get copyable(){return(this.b&1)!==0}set copyable(t){const i=(this.b&1)!==0;i!==t&&(this.b=this.b^1,this.t("copyable",i,t))}get deletable(){return(this.b&2)!==0}set deletable(t){const i=(this.b&2)!==0;i!==t&&(this.b=this.b^2,this.t("deletable",i,t))}get textEditable(){return(this.b&4)!==0}set textEditable(t){const i=(this.b&4)!==0;i!==t&&(this.b=this.b^4,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return(this.b&8)!==0}set groupable(t){const i=(this.b&8)!==0;i!==t&&(this.b=this.b^8,this.t("groupable",i,t))}get movable(){return(this.b&16)!==0}set movable(t){const i=(this.b&16)!==0;i!==t&&(this.b=this.b^16,this.t("movable",i,t))}get selectionAdorned(){return(this.b&32)!==0}set selectionAdorned(t){const i=(this.b&32)!==0;i!==t&&(this.b=this.b^32,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.b&64)!==0}set isInDocumentBounds(t){const i=(this.b&64)!==0;if(i!==t){this.b=this.b^64;const s=this.diagram;s!==null&&s.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return(this.b&128)!==0}set isLayoutPositioned(t){const i=(this.b&128)!==0;i!==t&&(this.b=this.b^128,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.b&256)!==0}set selectable(t){const i=(this.b&256)!==0;i!==t&&(this.b=this.b^256,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return(this.b&512)!==0}set reshapable(t){const i=(this.b&512)!==0;i!==t&&(this.b=this.b^512,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return(this.b&1024)!==0}set resizable(t){const i=(this.b&1024)!==0;i!==t&&(this.b=this.b^1024,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return(this.b&2048)!==0}set rotatable(t){const i=(this.b&2048)!==0;i!==t&&(this.b=this.b^2048,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return(this.b&4096)!==0}set isSelected(t){const i=(this.b&4096)!==0;if(i!==t){const s=this.diagram;if(t){if(!this.canSelect())return;if(s!==null){const a=s.maxSelectionCount;if(s.selection.count>=a)return}}this.b=this.b^4096;let n=!1;if(s!==null){n=s.skipsUndoManager,s.skipsUndoManager=!0;const a=s.selection;a.ce(),t?a.add(this):a.delete(this),a.k()}this.t("isSelected",i,t),this.invalidateAdornments();const o=this.selectionChanged;o!==null&&o(this),s!==null&&(s.requestUpdate(),s.skipsUndoManager=n)}}get isHighlighted(){return(this.b&524288)!==0}set isHighlighted(t){const i=(this.b&524288)!==0;if(i!==t){this.b=this.b^524288;const s=this.diagram;if(s!==null){const o=s.highlighteds;o.ce(),t?o.add(this):o.delete(this),o.k()}this.t("isHighlighted",i,t),this.C();const n=this.highlightedChanged;n!==null&&n(this)}}get isShadowed(){return(this.b&8192)!==0}set isShadowed(t){const i=(this.b&8192)!==0;i!==t&&(this.b=this.b^8192,this.$i(!0),this.t("isShadowed",i,t),this.C())}RD(){return(this.b&16384)!==0}OD(t){t?this.b|=16384:this.b&=-16385}fa(){return(this.b&32768)!==0}hC(t){t?this.b|=32768:this.b&=-32769}bE(){return(this.b&65536)!==0}NN(t){t?this.b|=65536:this.b&=-65537}Ul(){return(this.b&131072)!==0}As(t){t?this.b|=131072:this.b&=-131073}XD(){return(this.b&1048576)!==0}ck(t){t?this.b|=1048576:this.b&=-1048577}get isAnimated(){return(this.b&262144)!==0}set isAnimated(t){const i=(this.b&262144)!==0;i!==t&&(this.b=this.b^262144,this.t("isAnimated",i,t))}get highlightedChanged(){return this.H!==null?this.H.Ly:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(t!==null&&r.S(t,He,"highlightedChanged"),this._e().Ly=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return this.H!==null?this.H.Ay:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this._e().Ay=t,this.gl=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return this.H!==null?this.H.Ty:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(t!==null&&t.It(),this._e().Ty=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(this.gl===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const i=this.findObject(t);i!==null?this.gl=i:this.gl=this}else if(this instanceof Nt){const i=this.path;i!==null?this.gl=i:this.gl=this}else this.gl=this}return this.gl}get selectionChanged(){return this.H!==null?this.H.Dy:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(t!==null&&r.S(t,He,"selectionChanged"),this._e().Dy=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return this.H!==null?this.H.vy:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this._e().vy=t!==null?t.It():null,this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return this.H!==null?this.H.Fy:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this._e().Fy=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get resizeCellSize(){return this.H!==null?this.H.Ry:_.Zw}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.N(),this._e().Ry=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return this.H!==null?this.H.Oy:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this._e().Oy=t!==null?t.It():null,this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return this.H!==null?this.H.Iy:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this._e().Iy=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get rotationSpot(){return this.H!==null?this.H.Ey:X.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.N(),this._e().Ey=t,this.t("rotationSpot",i,t))}get text(){return this.ue}set text(t){const i=this.ue;i!==t&&(this.ue=t,this.t("text",i,t))}get containingGroup(){return this.Ta}set containingGroup(t){if(this.Di()){const i=this.Ta;if(i!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&r.o("Cannot make a Group a member of itself: "+this.toString()),r.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(i!==null?i.fC(this):this instanceof Ft&&s!==null&&s.Zr.delete(this),this.Ta=t,t!==null?t.uC(this):this instanceof Ft&&s!==null&&s.Zr.add(this),this.invalidateLayout(1),s!==null&&s.G){const o=this.data,a=s.model;if(o!==null&&a.uf()){const l=t!==null?t.data:null;a.setGroupForData(o,a.getKeyForNodeData(l))}}const n=this.containingGroupChanged;if(n!==null){let o=!0;s!==null&&(o=s.G,s.G=!0),n(this,i,t),s!==null&&(s.G=o)}if(this instanceof Ft){const o=new F;He.ga(o,this,!0,0,!0);const a=o.iterator;for(;a.next();){const l=a.value;if(l instanceof wt){const h=l.linksConnected;for(;h.next();)h.value.Wd()}}}if(this instanceof wt){const o=this.linksConnected;for(;o.next();)o.value.Wd();const a=this.labeledLink;a!==null&&a.Wd()}this.t("containingGroup",i,t),t!==null&&t.wE()}}else r.o("cannot set the Part.containingGroup of a Link or Adornment")}Sa(){const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&t.placeholder.c(),t.c(),t.invalidateConnectedLinks())}C(){const t=this.diagram;t!==null&&!this.as()&&!this.fa()&&this.isVisible()&&this.De.isReal()&&t.C(this.hh(this.De))}c(){if(this.Go())return;super.c();const t=this.diagram;t!==null&&(t.Cp(this),this instanceof wt&&this.labeledLink!==null&&this.labeledLink.Pf(),t.requestUpdate(!0))}Pf(t){if(this.as())return;const i=this.diagram;i!==null&&(i.Cp(this),this instanceof wt&&this.invalidateConnectedLinks(),i.requestUpdate()),this.ao(!0)}tp(t){if(!t){const i=this.Ta;i!==null&&i.uC(this)}}ep(t){if(!t){const i=this.Ta;i!==null&&i.fC(this)}}lf(){const t=this.data;if(t!==null){const i=this.diagram;if(i!==null){const s=i.model;s!==null&&s.removeNodeData(t)}}}get containingGroupChanged(){return this.H!==null?this.H.Uy:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(t!==null&&r.S(t,He,"containingGroupChanged"),this._e().Uy=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.dC(this)}dC(t){const i=t.containingGroup;if(i!==null)return 1+this.dC(i);if(t instanceof wt){const s=t.labeledLink;if(s!==null)return this.dC(s)}return 0}findTopLevelPart(){return this.gC(this)}gC(t){const i=t.containingGroup;if(i!==null)return this.gC(i);if(t instanceof wt){const s=t.labeledLink;if(s!==null)return this.gC(s)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof wt&&this.labeledLink!==null)}isMemberOf(t){return t instanceof Ft?this.mC(this,t):!1}mC(t,i){if(t===i||i===null)return!1;const s=t.containingGroup;if(s!==null&&(s===i||this.mC(s,i)))return!0;if(t instanceof wt){const n=t.labeledLink;if(n!==null)return this.mC(n,i)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let i=this;for(;i!==null;){if(i instanceof Ft&&i.ck(!0),i instanceof wt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}let s=null;for(i=t;i!==null;){if(i.XD()){s=i;break}if(i instanceof wt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}for(i=this;i!==null;){if(i instanceof Ft&&i.ck(!1),i instanceof wt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}return s}get layoutConditions(){return this.H!==null?this.H.Vy:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this._e().Vy=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof wt&&this.isLinkLabel)}PE(t){if(!this.isLayoutPositioned||(t&this.layoutConditions)===0)return!1;const i=this.layer;if(i!==null&&i.isTemporary||this instanceof wt&&this.isLinkLabel)return!1;const s=this.diagram;return!(s!==null&&s.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.PE(t))return;const i=this.Ta;if(i!==null){const s=i.layout;s!==null?s.p():i.invalidateLayout(t)}else{const s=this.diagram;if(s!==null){const n=s.layout;n!==null&&n.p()}}}gT(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static ga(t,i,s,n,o,a){if(a===void 0&&(a=null),!t.has(i)&&!(a!==null&&!a(i))&&!(i instanceof Jt)){if(t.add(i),i instanceof wt){if(s&&i instanceof Ft){const l=i.memberParts;for(;l.next();){const h=l.value;He.ga(t,h,s,n,o,a)}}if(o!==!1){const l=i.linksConnected;for(;l.next();){const h=l.value;if(t.has(h))continue;const d=h.fromNode,f=h.toNode,m=d===null||t.has(d),p=f===null||t.has(f);(o?m&&p:m||p)&&He.ga(t,h,s,n,o,a)}}if(n>1){const l=i.findTreeChildrenNodes();for(;l.next();){const h=l.value;He.ga(t,h,s,n-1,o,a)}}}else if(i instanceof Nt){const l=i.labelNodes;for(;l.next();){const h=l.value;He.ga(t,h,s,n,o,a)}}}}get dragComputation(){return this.H!==null?this.H.By:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(t!==null&&r.S(t,He,"dragComputation"),this._e().By=t,this.t("dragComputation",i,t))}get shadowOffset(){return this.H!==null?this.H.zy:L.FL}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.N(),this._e().zy=t,this.C(),this.t("shadowOffset",i,t))}get shadowColor(){return this.H!==null?this.H.Xy:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this._e().Xy=t,this.C(),this.t("shadowColor",i,t))}get shadowBlur(){return this.H!==null?this.H.An:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this._e().An=t,this.C(),this.t("shadowBlur",i,t))}};y(He,"LayoutNone",0),y(He,"LayoutAdded",1),y(He,"LayoutRemoved",2),y(He,"LayoutShown",4),y(He,"LayoutHidden",8),y(He,"LayoutNodeSized",16),y(He,"LayoutGroupLayout",32),y(He,"LayoutNodeReplaced",64),y(He,"LayoutStandard",127),y(He,"LayoutAll",16777215),y(He,"zD",!1);let _t=He;class oh{constructor(){y(this,"me");y(this,"Py");y(this,"Uy");y(this,"Ty");y(this,"Ay");y(this,"Dy");y(this,"Ly");y(this,"vy");y(this,"Fy");y(this,"Ry");y(this,"Oy");y(this,"Iy");y(this,"Ey");y(this,"Ny");y(this,"Cy");y(this,"Sy");y(this,"My");y(this,"By");y(this,"Vy");y(this,"zy");y(this,"Xy");y(this,"An");this.me=!1,this.Py=null,this.Uy=null,this.Ty=null,this.Ay="",this.Dy=null,this.Ly=null,this.vy=null,this.Fy="",this.Ry=_.Zw,this.Oy=null,this.Iy="",this.Ey=X.Default,this.Ny="",this.Cy=X.TopLeft,this.Sy=L.DL,this.My=L.vL,this.By=null,this.Vy=127,this.zy=L.FL,this.Xy="gray",this.An=4}copy(){const e=new oh;return e.Py=this.Py,e.Uy=this.Uy,e.Ty=this.Ty,e.Ay=this.Ay,e.Dy=this.Dy,e.Ly=this.Ly,e.vy=this.vy,e.Fy=this.Fy,e.Ry=this.Ry.N(),e.Oy=this.Oy,e.Iy=this.Iy,e.Ey=this.Ey.N(),e.Ny=this.Ny,e.Cy=this.Cy.N(),e.Sy=this.Sy.N(),e.My=this.My.N(),e.By=this.By,e.Vy=this.Vy,e.zy=this.zy.N(),e.Xy=this.Xy,e.An=this.An,e}}class Jt extends _t{constructor(t,i){let s;t===void 0||t instanceof le||typeof t=="string"?s=t:t&&(i=t);super(s);y(this,"Ms");y(this,"Dt");y(this,"WS");y(this,"JS");y(this,"Af");this.b&=-257,this.dl="Adornment",this.Ms=null,this.WS=0,this.JS=!1,this.Dt=null,this.Af=null,i&&Object.assign(this,i)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}Td(t){const i=this.adornedObject;if(!(i instanceof Xt))return;const s=i.part;if(!(s instanceof Nt))return;const n=s.path;let o=n.geometry;s.Td(t),o=n.geometry;const a=this.D.r,l=a.length;for(let h=0;h<l;h++){const d=a[h];d.isPanelMain&&d instanceof Xt&&(d.ut=o)}}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()}get placeholder(){return this.Dt}get adornedObject(){return this.Ms}set adornedObject(t){const i=this.adornedPart;let s=null;t!==null&&(s=t.part),i!==null&&(t===null||i!==s)&&i.removeAdornment(this.category),this.Ms=t,s!==null&&s.addAdornment(this.category,this)}get adornedPart(){const t=this.Ms;return t!==null?t.part:null}_r(){const t=this.Ms;if(t===null)return!0;const i=t.part;return i===null||!i.as()}Di(){return!1}get containingGroup(){return null}gf(t,i,s,n,o,a,l){if(t===3&&i==="elements"){if(o instanceof Ui)this.Dt===null&&(this.Dt=o);else if(o instanceof Lt){const h=o.findInVisualTree(d=>d instanceof Ui);h instanceof Ui&&this.Dt===null&&(this.Dt=h)}}else t===4&&i==="elements"&&this.Dt!==null&&(n===this.Dt?this.Dt=null:n instanceof Lt&&this.Dt.isContainedBy(n)&&(this.Dt=null));super.gf(t,i,s,n,o,a,l)}updateAdornments(){}lf(){}}var qu=(M=>(M[M.None=0]="None",M[M.Evenly=1]="Evenly",M[M.Packed=2]="Packed",M))(qu||{});const ks=class ks extends _t{constructor(t,i){let s;t===void 0||t instanceof le||typeof t=="string"?s=t:t&&(i=t);super(s);y(this,"E");y(this,"vt");y(this,"Xf");y(this,"yl");y(this,"Da");y(this,"ci");y(this,"ee");this.E=13,this.vt=null,this.ee=new E,this.Xf=null,this.yl=null,this.ci=null,this.Da=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,this.vt!==null&&(this.vt.me?t.vt=this.vt:t.vt=this.vt.copy())}jo(t){super.jo(t),t.invalidateConnectedLinks(),t.yl=this.yl,t.ci=null}wl(){return this.vt===null?this.vt=new rh:this.vt.me&&(this.vt=this.vt.copy()),this.vt}ba(){super.ba(),this.vt!==null&&(this.vt.me=!0)}GD(t){t!==null&&(this.yl===null&&(this.yl=new F),this.yl.add(t))}YD(t){t!==null&&this.yl!==null&&this.yl.delete(t)}KD(t,i,s){if(t===null||this.yl===null)return null;const n=this.yl.iterator;for(;n.next();){const o=n.value;if(o.Gy===this&&o.fk===t&&o.pC===i&&o.yC===s||o.Gy===t&&o.fk===this&&o.pC===s&&o.yC===i)return o}return null}invalidateLinkBundle(t,i,s){i==null&&(i=""),s==null&&(s="");const n=this.KD(t,i,s);n!==null&&n.Jd()}gf(t,i,s,n,o,a,l){t===3&&i==="elements"?this.ci=null:t===4&&i==="elements"&&(this.ci=null),super.gf(t,i,s,n,o,a,l)}invalidateConnectedLinks(t,i){const s=this.linksConnected;for(;s.next();){const n=s.value;t&&t.has(n)||i&&n.fromPort!==i&&n.toPort!==i||(this.Ze(n.fromPort),this.Ze(n.toPort),n.$t())}}Ze(t){if(t===null)return;const i=t.yd;i!==null&&i.Jd();const s=t.part,n=s.containingGroup;n!==null&&!s.isVisible()&&n.Ze(n.port)}_r(){return!0}get portSpreading(){return this.vt!==null?this.vt.Yy:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.wl().Yy=t,this.t("portSpreading",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.E&8)!==0}set avoidable(t){const i=(this.E&8)!==0;if(i!==t){this.E=this.E^8;const s=this.diagram;s!==null&&s.fd(this),this.t("avoidable",i,t)}}get avoidableMargin(){return this.vt!==null?this.vt.Ky:ct.BL}set avoidableMargin(t){typeof t=="number"&&(t=new ct(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.N(),this.wl().Ky=t;const s=this.diagram;s!==null&&s.fd(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const s=this.diagram;if(s!==null){if(s.animationManager.Wx(this))return!0;t=s.isTreePathToChildren,i=s.treeCollapsePolicy}if(i===1){const o=this.findTreeParentNode();if(o!==null&&!o.isTreeExpanded)return!1}else if(i===2){const o=t?this.findLinksInto():this.findLinksOutOf();let a=!1,l=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){a=!0;const d=t?h.fromNode:h.toNode;if(d&&d.isTreeExpanded){l=!0;break}}}if(a&&!l)return!1}else if(i===3){const o=t?this.findLinksInto():this.findLinksOutOf();let a=!1,l=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){a=!0;const d=t?h.fromNode:h.toNode;if(d&&!d.isTreeExpanded){l=!0;break}}}if(a&&l)return!1}const n=this.labeledLink;return n!==null?n.isVisible():!0}Xe(t){super.Xe(t);const i=this.linksConnected;for(;i.next();){const s=i.value;if(t&&this.containingGroup!==null){const n=s.getOtherNode(this);n!==null&&!n.isMemberOf(this.containingGroup)&&s.$t()}s.Xe(t)}}get linksConnected(){return this.ee.iterator}findExternalTreeLinksConnected(){const t=new F,i=new F;return this.HD(this,t,i),i.iterator}HD(t,i,s){if(t===null||i.has(t))return;i.add(t);let n=!0;const o=this.diagram;o!==null&&(n=o.isTreePathToChildren),t.linksConnected.each(a=>{a.isTreeLink?(n?a.fromNode===t:a.toNode===t)&&this.HD(n?a.toNode:a.fromNode,i,s):s.add(a)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ee.iterator;const i=new N(this.ee),s=this;return i.predicate=n=>n.fromNode===s&&n.fromPortId===t||n.toNode===s&&n.toPortId===t,i}findLinksOutOf(t){t===void 0&&(t=null);const i=new N(this.ee),s=this;return i.predicate=n=>n.fromNode!==s?!1:t===null?!0:n.fromPortId===t,i}findLinksInto(t){t===void 0&&(t=null);const i=new N(this.ee),s=this;return i.predicate=n=>n.toNode!==s?!1:t===null?!0:n.toPortId===t,i}findNodesConnected(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this){if(t===null||o.fromPortId===t){const a=o.toNode;i!==null?i.add(a):s!==null&&s!==a?(i=new F,i.add(s),i.add(a)):s=a}}else if(o.toNode===this&&(t===null||o.toPortId===t)){const a=o.fromNode;i!==null?i.add(a):s!==null&&s!==a?(i=new F,i.add(s),i.add(a)):s=a}}return i!==null?i.iterator:s!==null?new k(s):w.instance}findNodesOutOf(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this&&(t===null||o.fromPortId===t)){const a=o.toNode;i!==null?i.add(a):s!==null&&s!==a?(i=new F,i.add(s),i.add(a)):s=a}}return i!==null?i.iterator:s!==null?new k(s):w.instance}findNodesInto(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ee.iterator;for(;n.next();){const o=n.value;if(o.toNode===this&&(t===null||o.toPortId===t)){const a=o.fromNode;i!==null?i.add(a):s!==null&&s!==a?(i=new F,i.add(s),i.add(a)):s=a}}return i!==null?i.iterator:s!==null?new k(s):w.instance}findLinksBetween(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new N(this.ee),o=this;return n.predicate=a=>a.fromNode===o&&a.toNode===t&&(i===null||a.fromPortId===i)&&(s===null||a.toPortId===s)||a.fromNode===t&&a.toNode===o&&(s===null||a.fromPortId===s)&&(i===null||a.toPortId===i),n}findLinksTo(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new N(this.ee),o=this;return n.predicate=a=>!(a.fromNode!==o||a.toNode!==t||i!==null&&a.fromPortId!==i||s!==null&&a.toPortId!==s),n}findSuccessorParts(t){return t===void 0&&(t=new F),this.jD(this,t),t.remove(this),t}jD(t,i){t!==null&&(i.has(t)||(i.add(t),t.findLinksOutOf().each(s=>{if(i.has(s))return;i.add(s);const n=s.toNode;n!==null&&this.jD(n,i)})))}findPredecessorParts(t){return t===void 0&&(t=new F),this.qD(this,t),t.remove(this),t}qD(t,i){t!==null&&(i.has(t)||(i.add(t),t.findLinksInto().each(s=>{if(i.has(s))return;i.add(s);const n=s.fromNode;n!==null&&this.qD(n,i)})))}get linkConnected(){return this.vt!==null?this.vt.Hy:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(t!==null&&r.S(t,ks,"linkConnected"),this.wl().Hy=t,this.t("linkConnected",i,t))}get linkDisconnected(){return this.vt!==null?this.vt.jy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(t!==null&&r.S(t,ks,"linkDisconnected"),this.wl().jy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return this.vt!==null?this.vt.El:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(t!==null&&r.S(t,ks,"linkValidation"),this.wl().El=t,this.t("linkValidation",i,t))}uk(t,i){this.Ze(i);const s=this.ee.has(t);if(s||this.ee.add(t),!s||t.fromNode===t.toNode){const n=this.linkConnected;if(n!==null){let o=!0;const a=this.diagram;a!==null&&(o=a.G,a.G=!0),n(this,t,i),a!==null&&(a.G=o)}}if(!s){if(!t.isTreeLink)return;const n=t.fromNode,o=t.toNode;if(n!==null&&o!==null&&n!==o){let a=!0;const l=this.diagram;l!==null&&(a=l.isTreePathToChildren);const h=a?o:n,d=a?n:o;if(h.Da||(h.Da=d),d.isTreeLeaf){if(l!==null&&l.undoManager.isUndoingRedoing)return;a?n===d&&(d.isTreeLeaf=!1):o===d&&(d.isTreeLeaf=!1)}}}}dk(t,i){this.Ze(i);const s=this.ee.delete(t);let n=null;if(s||t.toNode===t.fromNode){const o=this.linkDisconnected;if(n=this.diagram,o!==null){let a=!0;n!==null&&(a=n.G,n.G=!0),o(this,t,i),n!==null&&(n.G=a)}}if(s){if(!t.isTreeLink)return;let o=!0;n!==null&&(o=n.isTreePathToChildren);const a=o?t.toNode:t.fromNode,l=o?t.fromNode:t.toNode;if(a!==null&&(a.Da=!1),l!==null&&!l.isTreeLeaf)if(l.ee.count===0){if(l.Da=null,n!==null&&n.undoManager.isUndoingRedoing)return;l.isTreeLeaf=!0}else l.vp()}}vp(){if(this.Da=!1,this.ee.count===0)return;let t=!0;const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;i!==null&&(t=i.isTreePathToChildren);const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.isTreeLink){if(t){if(n.fromNode===this){this.isTreeLeaf=!1;return}}else if(n.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}tp(t){if(super.tp(t),!t){this.vp();const i=this.Xf;i!==null&&i.WD(this)}}ep(t){if(super.ep(t),!t){const i=this.Xf;i!==null&&i.JD(this)}}lf(){if(this.ee.count>0){const t=this.diagram;if(t!==null){const i=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this.ee.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.lf()}get isLinkLabel(){return this.Xf!==null}get labeledLink(){return this.Xf}set labeledLink(t){const i=this.Xf;if(i!==t){const s=this.diagram,n=this.data;if(i!==null){if(i.JD(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=i.data,a=s.model;if(o!==null&&a.Wh()){const l=a.getKeyForNodeData(n);l!==void 0&&a.removeLabelKeyForLinkData(o,l)}}this.containingGroup=null}if(this.Xf=t,t!==null){if(t.WD(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=t.data,a=s.model;if(o!==null&&a.Wh()){const l=a.getKeyForNodeData(n);l!==void 0&&a.addLabelKeyForLinkData(o,l)}}this.containingGroup=t.containingGroup}this.Pf(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;i!==null&&(!i.actualBounds.isReal()||!i.isVisibleObject());)i=i.panel;return i===null?this.port:i}findPort(t){if(this.ci===null){if(t===""&&this.Ln===!1)return this;this.$D()}let i=this.ci.get(t);return i!==null||t!==""&&(i=this.ci.get(""),i!==null)?i:this}get port(){return this.findPort("")}get ports(){return this.ci===null&&this.$D(),this.ci.iteratorValues}$D(){this.ci===null?this.ci=new nt:this.ci.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.sD(i)),this.ci.count===0&&this.ci.set("",this)}sD(t){const i=t.portId;i!==null&&this.ci!==null&&this.ci.set(i,t)}FN(t,i){const s=t.portId;if(s!==null){this.ci!==null&&this.ci.delete(s);const n=this.diagram;if(n!==null&&i){let o=null;const a=this.findLinksConnected(s);for(;a.next();){const l=a.value;o===null&&(o=r.nt()),o.push(l)}if(o!==null){for(let l=0;l<o.length;l++){const h=o[l];n.remove(h)}r.Z(o)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);let n=this;const o=t;let a;if(i)for(;n!==o;){a=null;const l=n.ee.iterator;for(;l.next();){const h=l.value;if(h.isTreeLink&&(a=h.fromNode,a!==n&&a!==this))break}if(a===this||a===null||a===n)return!1;n=a}else for(;n!==o;){a=null;const l=n.ee.iterator;for(;l.next();){const h=l.value;if(h.isTreeLink&&(a=h.toNode,a!==n&&a!==this))break}if(a===this||a===null||a===n)return!1;n=a}return!0}findTreeRoot(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=this,n;if(t)for(;;){n=null;const o=s.ee.iterator;for(;o.next();){const a=o.value;if(a.isTreeLink&&(n=a.fromNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}else for(;;){n=null;const o=s.ee.iterator;for(;o.next();){const a=o.value;if(a.isTreeLink&&(n=a.toNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let i=this;for(;i!==null;)i.ck(!0),i=i.findTreeParentNode();let s=null;for(i=t;i!==null;){if(i.XD()){s=i;break}i=i.findTreeParentNode()}for(i=this;i!==null;)i.ck(!1),i=i.findTreeParentNode();return s}findTreeParentLink(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=this.ee.iterator;if(t)for(;s.next();){const n=s.value;if(n.isTreeLink&&n.fromNode!==this)return n}else for(;s.next();){const n=s.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){const t=this.Da;if(t===null)return null;if(t instanceof ks)return t;const i=this.diagram,s=i!==null?i.isTreePathToChildren:!0,n=this.ee.iterator;for(;n.next();){const o=n.value;if(!o.isTreeLink)continue;const a=s?o.fromNode:o.toNode;if(a!==this)return this.Da=a,a}return this.Da=null,null}findTreeParentChain(t){function i(s,n){n.add(s);const o=s.findTreeParentLink();if(o!==null){n.add(o);const a=s.findTreeParentNode();if(a===null)return;i(a,n)}}return t===void 0&&(t=new F),i(this,t),t}findTreeLevel(){return this.SE(this)}SE(t){let i=0,s=t.findTreeParentNode();for(;s!==null&&s!==t;)s=s.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=new N(this.ee),n=this;return t?s.predicate=o=>!(!o.isTreeLink||o.fromNode!==n):s.predicate=o=>!(!o.isTreeLink||o.toNode!==n),s}findTreeChildrenNodes(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=null,n=null;const o=this.ee.iterator;if(t)for(;o.next();){const a=o.value;if(a.isTreeLink&&a.fromNode===this){const l=a.toNode;s!==null?s.add(l):n!==null&&n!==l?(s=new E,s.add(n),s.add(l)):n=l}}else for(;o.next();){const a=o.value;if(a.isTreeLink&&a.toNode===this){const l=a.fromNode;s!==null?s.add(l):n!==null&&n!==l?(s=new E,s.add(n),s.add(l)):n=l}}return s!==null?s.iterator:n!==null?new k(n):w.instance}findTreeParts(t,i){return t===void 0&&(t=1/0),r.s(t,"number",ks,"findTreeParts:level"),i===void 0&&(i=new F),_t.ga(i,this,!1,t,!0),i}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new F;s.add(this),this.ZD(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}ZD(t,i,s,n,o,a){if(s>1){const l=i?this.findLinksOutOf():this.findLinksInto();for(;l.next();){const h=l.value;if(!h.isTreeLink)continue;const d=h.getOtherNode(this);d!==null&&d!==this&&!t.has(d)&&(t.add(d),d.ZD(t,i,s-1,n,o,a))}}else this.QD(t,i,n,o,a)}QD(t,i,s,n,o){const a=n===this?!0:this.isTreeExpanded,l=i?this.findLinksOutOf():this.findLinksInto();for(;l.next();){const h=l.value;if(!h.isTreeLink)continue;const d=h.getOtherNode(this);if(d!==null&&d!==this){const f=t.has(d);if(f||t.add(d),a){const m=i?d.findNodesInto():d.findNodesOutOf(),p=this;m.all(b=>b===p||!b.isTreeExpanded)&&s.Kc(d,n),d.Sa(),d.Xe(!1)}d.isTreeExpanded&&(d.wasTreeExpanded=d.isTreeExpanded,f||d.QD(t,i,s,n,o))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new F;s.add(this),this._D(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}_D(t,i,s,n,o,a){const l=o===this?!1:this.isTreeExpanded,h=i?this.findLinksOutOf():this.findLinksInto();for(;h.next();){const d=h.value;if(!d.isTreeLink)continue;l||d.Fi||d.$t();const f=d.getOtherNode(this);if(f!==null&&f!==this&&!t.has(f)){if(t.add(f),!l){f.Xe(!0),f.Sa();const m=i?f.findNodesInto():f.findNodesOutOf(),p=this;m.all(b=>b===p||!b.isTreeExpanded)&&n.Yc(f,o)}(s>2||f.wasTreeExpanded)&&(f.wasTreeExpanded=!1,f._D(t,i,s-1,n,o,a))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.E&1)!==0}set isTreeExpanded(t){const i=(this.E&1)!==0;if(i!==t){this.E=this.E^1;const s=this.diagram;this.t("isTreeExpanded",i,t);const n=this.treeExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.G,s.G=!0),n(this),s!==null&&(s.G=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Xe(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.E&2)!==0}set wasTreeExpanded(t){const i=(this.E&2)!==0;i!==t&&(this.E=this.E^2,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return this.vt!==null?this.vt.qy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(t!==null&&r.S(t,ks,"treeExpandedChanged"),this.wl().qy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return(this.E&4)!==0}set isTreeLeaf(t){const i=(this.E&4)!==0;i!==t&&(this.E=this.E^4,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return this.findTreeParentLink()===null}};y(ks,"SpreadingNone",0),y(ks,"SpreadingEvenly",1),y(ks,"SpreadingPacked",2);let wt=ks;class rh{constructor(){y(this,"me");y(this,"Hy");y(this,"jy");y(this,"El");y(this,"qy");y(this,"Ky");y(this,"Yy");y(this,"Wy");y(this,"Jy");y(this,"da");y(this,"$y");this.me=!1,this.Hy=null,this.jy=null,this.El=null,this.qy=null,this.Ky=ct.BL,this.Yy=1,this.Wy=null,this.Jy=null,this.da=null,this.$y=null}copy(){const e=new rh;return e.Hy=this.Hy,e.jy=this.jy,e.El=this.El,e.qy=this.qy,e.Ky=this.Ky.N(),e.Yy=this.Yy,e.Wy=this.Wy,e.Jy=this.Jy,e.da=this.da,e.$y=this.$y,e}}var ah=(M=>(M[M.None=0]="None",M[M.End=17]="End",M[M.Scale=18]="Scale",M[M.Stretch=19]="Stretch",M))(ah||{}),lh=(M=>(M[M.Normal=1]="Normal",M[M.Orthogonal=2]="Orthogonal",M[M.AvoidsNodes=6]="AvoidsNodes",M[M.AvoidsNodesStraight=7]="AvoidsNodesStraight",M))(lh||{}),hh=(M=>(M[M.None=0]="None",M[M.Bezier=9]="Bezier",M[M.JumpGap=10]="JumpGap",M[M.JumpOver=11]="JumpOver",M))(hh||{});const yt=class yt extends _t{constructor(t){super(Lt.Link);y(this,"Mt");y(this,"po");y(this,"yo");y(this,"$d");y(this,"wo");y(this,"xo");y(this,"Zd");y(this,"Gf");y(this,"Qd");y(this,"_d");y(this,"tg");y(this,"Jh");y(this,"eg");y(this,"on");y(this,"Me");y(this,"xl");y(this,"vr");y(this,"va");y(this,"ir");y(this,"wC");y(this,"xC");y(this,"gk");y(this,"bC");y(this,"kC");y(this,"$h");y(this,"mk");y(this,"ut");y(this,"sr");y(this,"Af");y(this,"PC");y(this,"SC");this.Mt=8,this.po=null,this.yo="",this.$d=null,this.wo=null,this.xo="",this.Zd=null,this.Gf=0,this.Qd=0,this._d=0,this.tg=NaN,this.Jh=1,this.eg=.5,this.on=null,this.Me=new E().k(),this.xl=null,this.vr=null,this.va=new Y,this.ut=new It,this.ir=null,this.sr=null,this.wC=L.mn,this.xC=L.mn,this.PC=0,this.SC=0,this.gk=new L,this.bC=null,this.kC=null,this.$h=null,this.mk=NaN,this.ft=null,this.Af=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mt=this.Mt&-113,t.yo=this.yo,t.$d=this.$d,t.xo=this.xo,t.Zd=this.Zd,t.Gf=this.Gf,t.Qd=this.Qd,t._d=this._d,t.tg=this.tg,t.Jh=this.Jh,t.eg=this.eg,this.ft!==null&&(t.ft=this.ft.copy())}jo(t){super.jo(t),this.yo=t.yo,this.xo=t.xo,t.xl=null,t.$t(),t.sr=this.sr;const i=t.fromPort;i!==null&&t.fromNode.Ze(i);const s=t.toPort;s!==null&&t.toNode.Ze(s)}fe(t){t in lh||t in hh||t in ah?yt.MC(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||r.o("Unknown Link enum value for a Link property: "+t):super.fe(t)}static setRoutingParameter(t,i){switch(t){case 1:yt.tv=i;break;case 2:yt.ev=i;break;case 3:yt.Fa=i;break;case 4:yt.J1=i;break;case 5:yt.iv=i;break;case 6:yt.sv=i;break;case 7:yt.NC=i;break;case 8:yt.CC=i;break;case 9:yt.nv=i;break;case 10:yt.Yf=i;break;case 11:yt.ov=i;break;case 12:yt.rv=i;break;case 13:yt.LC=i;break;case 14:yt.lv=i;break;case 15:yt.av=i;break;case 16:yt.hv=i;break;case 17:yt.cv=i;break;case 18:yt._A=i;break;case 19:yt.tT=i;break;case 20:yt.fv=i;break}t>29&&t<71&&(yt.IT=t+parseInt(i.toString().slice(0,-1)))}Ji(){return this.ft===null&&(this.ft=new fa),this.ft}II(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let a=t.alignmentFocus;const l=t.segmentOrientation,h=t.segmentOffset;let d=0,f=0,m=0,p=0;if(isNaN(n)){const V=this.ut,z=r.nt();V.getPointAndAngleAlongPath(o,z);const K=L.z(z[0],z[1]);if(p=z[2],K.add(this.getPoint(0)),V.type===1)K.offset(-V.startX,-V.startY);else{const $=V.figures.first();K.offset(-$.startX,-$.startY)}l!==0&&(m=this.computeAngle(t,l,p),t.angle=m),d=K.x,f=K.y,L.i(K),r.Z(z)}else if(n<-i||n>=i){const V=L.l();this.HN(V),p=this.midAngle,l!==0&&(m=this.computeAngle(t,l,p),t.angle=m),d=V.x,f=V.y,L.i(V)}else{let V,z,K=0;if(n>=0?(V=s.r[n],z=n<i-1?s.r[n+1]:V):(K=i+n,V=s.r[K],z=K>0?s.r[K-1]:V),V.equalsApprox(z)){let $,q;n>=0?($=n>0?s.r[n-1]:V,q=n<i-2?s.r[n+2]:z):($=K<i-1?s.r[K+1]:V,q=K>1?s.r[K-2]:z);const J=$.distanceSquaredPoint(V),ot=z.distanceSquaredPoint(q);J>ot+10?p=n>=0?$.directionPoint(V):V.directionPoint($):ot>J+10?p=n>=0?z.directionPoint(q):q.directionPoint(z):p=n>=0?$.directionPoint(q):q.directionPoint($)}else p=n>=0?V.directionPoint(z):z.directionPoint(V);l!==0&&(m=this.computeAngle(t,l,p),t.angle=m),d=V.x+(z.x-V.x)*o,f=V.y+(z.y-V.y)*o}if(a.isNone()){t.moveTo(d,f,!0);return}else a.isNoSpot()&&(a=X.Center);const b=lt.l();b.Ue(),b.it(t.scale,t.scale),b.ks(t.angle,0,0);const x=t.naturalBounds,v=Y.z(0,0,x.width,x.height),S=L.l();S.setRectSpot(v,a),b.gt(S);let P=-S.x,T=-S.y;const A=x.width,C=x.height,O=L.bs(h),R=isNaN(h.x),I=isNaN(h.y);if(R||I){const V=A/2+yt.J1,z=C/2+yt.iv,K=p>=45&&p<=135,$=p>=225&&p<=315;l===0&&(K||$)?(O.x=I?V:h.y,O.y=R?z:h.x,K?n>=0||isNaN(n)&&o<.5||R&&(O.y=-z):$&&((n>=0||isNaN(n)&&o<.5)&&R&&(O.y=-z),I&&(O.x=-V))):(R&&(n>=0||isNaN(n)&&o<.5?O.x=V:O.x=-V),I&&(O.y=-z),O.rotate(p))}else O.rotate(p);d+=O.x,f+=O.y,b.sm(v),P+=v.x,T+=v.y;const H=L.z(d+P,f+T);t.move(H),L.i(H),L.i(O),L.i(S),Y.i(v),lt.i(b)}_r(){let t=this.fromNode;if(t!==null){const s=t.findVisibleNode();if(s!==null&&(t=s),t.as()||t.fa())return!1}let i=this.toNode;if(i!==null){const s=i.findVisibleNode();if(s!==null&&(i=s),i.as()||i.fa())return!1}return!0}DN(t,i,s){return!1}vN(){}Di(){return!1}computeAngle(t,i,s){return yt.computeAngle(i,s)}static computeAngle(t,i){let s=0;switch(t){default:case 0:s=0;break;case 21:s=i;break;case 22:s=i+90;break;case 23:s=i-90;break;case 24:s=i+180;break;case 25:s=B.Ee(i),s>90&&s<270&&(s-=180);break;case 26:s=B.Ee(i+90),s>90&&s<270&&(s-=180);break;case 27:s=B.Ee(i-90),s>90&&s<270&&(s-=180);break;case 28:if(s=B.Ee(i),s>45&&s<135||s>225&&s<315)return 0;s>90&&s<270&&(s-=180);break}return B.Ee(s)}get fromNode(){return this.po}set fromNode(t){const i=this.po;if(i!==t){const s=this.fromPort;i!==null&&(this.wo!==i&&i.dk(this,s),this.Zy(),this.invalidateLayout(2)),this.po=t,t!==null&&this.Xe(t.isVisible()),this.ir=null,this.$t();const n=this.diagram;n!==null&&n.G&&n.partManager.setFromNodeForLink(this,t,i);const o=this.fromPort,a=this.fromPortChanged;if(a!==null){let l=!0;n!==null&&(l=n.G,n.G=!0),a(this,s,o),n!==null&&(n.G=l)}t!==null&&(this.wo!==t&&t.uk(this,o),this.Qy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Wd()}}get fromPortId(){return this.yo}set fromPortId(t){var s,n;const i=this.yo;if(i!==t){const o=this.fromPort;o!==null&&((s=this.fromNode)==null||s.Ze(o)),this.Zy(),this.yo=t;const a=this.fromPort;a!==null&&((n=this.fromNode)==null||n.Ze(a));const l=this.diagram;if(l!==null){const h=this.data,d=l.model;h!==null&&d.Wh()&&d.setFromPortIdForLinkData(h,t)}if(o!==a){this.ir=null,this.$t();const h=this.fromPortChanged;if(h!==null){let d=!0;l!==null&&(d=l.G,l.G=!0),h(this,o,a),l!==null&&(l.G=d)}}this.Qy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.po;if(t===null)return null;const i=this.yo;return t.findPort(i)}get fromPortChanged(){return this.$d}set fromPortChanged(t){const i=this.$d;i!==t&&(t!==null&&r.S(t,yt,"fromPortChanged"),this.$d=t,this.t("fromPortChanged",i,t))}get toNode(){return this.wo}set toNode(t){const i=this.wo;if(i!==t){const s=this.toPort;i!==null&&(this.po!==i&&i.dk(this,s),this.Zy(),this.invalidateLayout(2)),this.wo=t,t!==null&&this.Xe(t.isVisible()),this.ir=null,this.$t();const n=this.diagram;n!==null&&n.G&&n.partManager.setToNodeForLink(this,t,i);const o=this.toPort,a=this.toPortChanged;if(a!==null){let l=!0;n!==null&&(l=n.G,n.G=!0),a(this,s,o),n!==null&&(n.G=l)}t!==null&&(this.po!==t&&t.uk(this,o),this.Qy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Wd()}}get toPortId(){return this.xo}set toPortId(t){var s,n;const i=this.xo;if(i!==t){const o=this.toPort;o!==null&&((s=this.toNode)==null||s.Ze(o)),this.Zy(),this.xo=t;const a=this.toPort;a!==null&&((n=this.toNode)==null||n.Ze(a));const l=this.diagram;if(l!==null){const h=this.data,d=l.model;h!==null&&d.Wh()&&d.setToPortIdForLinkData(h,t)}if(o!==a){this.ir=null,this.$t();const h=this.toPortChanged;if(h!==null){let d=!0;l!==null&&(d=l.G,l.G=!0),h(this,o,a),l!==null&&(l.G=d)}}this.Qy(),this.t("toPortId",i,t)}}get toPort(){const t=this.wo;if(t===null)return null;const i=this.xo;return t.findPort(i)}get toPortChanged(){return this.Zd}set toPortChanged(t){const i=this.Zd;i!==t&&(t!==null&&r.S(t,yt,"toPortChanged"),this.Zd=t,this.t("toPortChanged",i,t))}get fromSpot(){return this.ft!==null?this.ft.Dh:X.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.N(),this.Ji().Dh=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const s=this.fromNode;s!==null&&s.Ze(this.fromPort)}this.$t()}}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&r.J(t,">= 0",yt,"fromEndSegmentLength"),this.Ji().Fh=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const s=this.fromNode;s!==null&&s.Ze(this.fromPort)}this.$t()}}get fromShortLength(){return this.ft!==null?this.ft.Oh:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Ji().Oh=t,this.ai(),this.t("fromShortLength",i,t))}get toSpot(){return this.ft!==null?this.ft.vh:X.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.N(),this.Ji().vh=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const s=this.toNode;s!==null&&s.Ze(this.toPort)}this.$t()}}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&r.J(t,">= 0",yt,"toEndSegmentLength"),this.Ji().Rh=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const s=this.toNode;s!==null&&s.Ze(this.toPort)}this.$t()}}get toShortLength(){return this.ft!==null?this.ft.Ih:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Ji().Ih=t,this.ai(),this.t("toShortLength",i,t))}Wd(){const t=this.fromNode,i=this.toNode;let s=null;if(t!==null?i!==null?s=t.findCommonContainingGroup(i):s=t.containingGroup:i!==null?s=i.containingGroup:s=null,this.ME(s),this.isLabeledLink){const n=this.labelNodes;for(;n.next();){const o=n.value;o.containingGroup=s}}}ME(t){const i=this.Ta;if(i!==t){i!==null&&i.fC(this),this.Ta=t,t!==null&&t.uC(this);const s=this.containingGroupChanged;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.G,o.G=!0),s(this,i,t),o!==null&&(o.G=n)}this.Fi&&(this.bC===i||this.kC===i)&&this.$t()}}Sa(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.Sa()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return this.on===null?!1:this.on.count>0}get labelNodes(){return this.on===null?w.instance:this.on.iterator}WD(t){this.on===null&&(this.on=new F),this.on.add(t),this.c()}JD(t){this.on!==null&&(this.on.delete(t),this.c())}tp(t){if(super.tp(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.po;let s=null;i!==null&&(s=this.fromPort,i.uk(this,s));const n=this.wo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.uk(this,o)),this.Qy()}}ep(t){if(super.ep(t),this._h()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.po;let s=null;i!==null&&(s=this.fromPort,i.dk(this,s));const n=this.wo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.dk(this,o)),this.Zy()}}lf(){if(this.Fi=!0,this.on!==null){const t=this.diagram;if(t!==null){const i=this.on.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}if(this.data!==null){const t=this.diagram;t!==null&&t.partManager.AC(this)}}updateRelationshipsFromData(){if(this.data===null)return;const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}move(t,i){const s=i?this.location:this.position;let n=s.x;isNaN(n)&&(n=0);let o=s.y;isNaN(o)&&(o=0);const a=t.x-n,l=t.y-o;if(i===!0)super.move(t,!1);else{const d=L.z(s.x+a,s.y+l);super.move(d,!1),L.i(d)}this.Pr(a,l);const h=this.labelNodes;for(;h.next();){const d=h.value,f=d.position;d.moveTo(f.x+a,f.y+l)}}get relinkableFrom(){return(this.Mt&1)!==0}set relinkableFrom(t){const i=(this.Mt&1)!==0;i!==t&&(this.Mt=this.Mt^1,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return(this.Mt&2)!==0}set relinkableTo(t){const i=(this.Mt&2)!==0;i!==t&&(this.Mt=this.Mt^2,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}get resegmentable(){return(this.Mt&4)!==0}set resegmentable(t){const i=(this.Mt&4)!==0;i!==t&&(this.Mt=this.Mt^4,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return(this.Mt&8)!==0}set isTreeLink(t){const i=(this.Mt&8)!==0;i!==t&&(this.Mt=this.Mt^8,this.t("isTreeLink",i,t),this.fromNode!==null&&this.fromNode.vp(),this.toNode!==null&&this.toNode.vp())}get path(){const t=this.findMainElement();return t instanceof Xt?t:null}get routeBounds(){return this.updateRoute(),this.va}uv(t){let i=1/0,s=1/0;const n=this.pointsCount;if(n===0)return t.e(NaN,NaN,0,0),t;if(n===1){const o=this.getPoint(0);i=Math.min(o.x,i),s=Math.min(o.y,s),t.e(o.x,o.y,0,0)}else if(n===2){const o=this.getPoint(0),a=this.getPoint(1);i=Math.min(o.x,a.x),s=Math.min(o.y,a.y),t.e(o.x,o.y,0,0),t.unionPoint(a)}else if(this.computeCurve()===9&&n>=3&&!this.isOrthogonal){let o=this.getPoint(0);if(i=o.x,s=o.y,t.e(i,s,0,0),n===3){const a=this.getPoint(1);i=Math.min(a.x,i),s=Math.min(a.y,s);const l=this.getPoint(2);i=Math.min(l.x,i),s=Math.min(l.y,s),B.Nu(o.x,o.y,a.x,a.y,a.x,a.y,l.x,l.y,.5,t)}else for(let a=3;a<n;a+=3){const l=this.getPoint(a-2);a+3>=n&&(a=n-1);const h=this.getPoint(a-1),d=this.getPoint(a);B.Nu(o.x,o.y,l.x,l.y,h.x,h.y,d.x,d.y,.5,t),i=Math.min(d.x,i),s=Math.min(d.y,s),o=d}}else{const o=this.getPoint(0),a=this.getPoint(1);i=Math.min(o.x,a.x),s=Math.min(o.y,a.y),t.e(o.x,o.y,0,0),t.unionPoint(a);for(let l=2;l<n;l++){const h=this.getPoint(l);i=Math.min(h.x,i),s=Math.min(h.y,s),t.unionPoint(h)}}return this.gk.e(i-t.x,s-t.y),t}get midPoint(){return this.HN(new L)}HN(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(i===0)return t.h(L.mn),t;if(i===1)return t.h(this.getPoint(0)),t;if(i===2){const f=this.getPoint(0),m=this.getPoint(1);return t.e((f.x+m.x)/2,(f.y+m.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ut.getPointAlongPath(.5,t),t.add(this.getPoint(0));const f=this.ut.figures.first();return t.offset(-f.startX,-f.startY),t}if(this.computeCurve()===9){if(i===3){const p=this.getPoint(0),b=this.getPoint(1),x=this.getPoint(2);return B.YL(p.x,p.y,b.x,b.y,b.x,b.y,x.x,x.y,t),t}const f=(i-1)/3|0,m=(f/2|0)*3;if(f%2===1){const p=this.getPoint(m),b=this.getPoint(m+1),x=this.getPoint(m+2),v=this.getPoint(m+3);return B.YL(p.x,p.y,b.x,b.y,x.x,x.y,v.x,v.y,t),t}else return t.h(this.getPoint(m)),t}const s=this.flattenedLengths,n=this.flattenedTotalLength;let o=0,a=0,l=0;for(;o<n/2&&a<i&&(l=s[a],!(o+l>n/2));)o+=l,a++;const h=this.getPoint(a),d=this.getPoint(a+1);if(Math.abs(h.x-d.x)<1)h.y>d.y?t.e(h.x,h.y-(n/2-o)):t.e(h.x,h.y+(n/2-o));else if(Math.abs(h.y-d.y)<1)h.x>d.x?t.e(h.x-(n/2-o),h.y):t.e(h.x+(n/2-o),h.y);else{const f=(n/2-o)/l,m=f*(d.x-h.x),p=f*(d.y-h.y);t.e(h.x+m,h.y+p)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const d=this.getPoint(0),f=this.getPoint(1);return d.directionPoint(f)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ut.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const d=(t-1)/3|0;let f=(d/2|0)*3;if(d%2===1){f=Math.floor(f);const m=this.getPoint(f),p=this.getPoint(f+1),b=this.getPoint(f+2),x=this.getPoint(f+3);return B.HF(m.x,m.y,p.x,p.y,b.x,b.y,x.x,x.y)}else if(f>0&&f+1<t){const m=this.getPoint(f-1),p=this.getPoint(f+1);return m.directionPoint(p)}}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,a=0;for(;n<s/2&&o<t&&(a=i[o],!(n+a>s/2));)n+=a,o++;const l=this.getPoint(o),h=this.getPoint(o+1);if(Math.abs(l.x-h.x)<.5&&Math.abs(l.y-h.y)<yt.NC){if(o>0&&o<t-2){const d=this.getPoint(o-1),f=this.getPoint(o+2);return d.x<f.x?0:d.x>f.x?180:d.y<f.y?90:270}}else if(Math.abs(l.y-h.y)<.5&&Math.abs(l.x-h.x)<yt.NC&&o>0&&o<t-2){const d=this.getPoint(o-1),f=this.getPoint(o+2);return d.y<f.y?90:d.y>f.y?270:d.x<f.x?0:180}return l.directionPoint(h)}get flattenedLengths(){return this.$h!==null?this.$h:(this.Fi||this.pk(),this.NE())}get flattenedTotalLength(){let t=this.mk;if(isNaN(t)){const i=this.flattenedLengths,s=i.length;t=0;for(let n=0;n<s;n++)t+=i[n];this.mk=t}return t}NE(){this.$h===null?this.$h=[]:this.$h.length=0;const t=this.$h,i=this.pointsCount;for(let s=0;s<i-1;s++){let n=0;const o=this.getPoint(s),a=this.getPoint(s+1);B.X(o.x,a.x)?(n=a.y-o.y,n<0&&(n=-n),t.push(n)):B.X(o.y,a.y)?(n=a.x-o.x,n<0&&(n=-n),t.push(n)):(n=Math.sqrt(o.distanceSquaredPoint(a)),t.push(n))}return t}get points(){return this.Me}set points(t){const i=this.Me;if(i===t)return;let s=null;if(Array.isArray(t))s=this.convertPointsArrayToList(t);else if(t instanceof E){s=t.copy();const o=s.iterator;for(;o.next();)o.value.k()}else r.o("Link.points value is not an instance of List or Array: "+t);if(s===null)return;s.k(),this.Me=s,this.ai(),this.pk();const n=this.diagram;n!==null&&(!n.Qa&&!n.undoManager.isUndoingRedoing&&n.nb.add(this),n.animationManager.ke&&n.animationManager.AM(this,s)),this.t("points",i,s)}convertPointsArrayToList(t){let i=null,s=t.length%2===0;if(s){for(let n=0;n<t.length;n++)if(typeof t[n]!="number"||isNaN(t[n])){s=!1;break}}if(s){i=new E;for(let n=0;n<t.length/2;n++)i.add(new L(t[n*2],t[n*2+1]).k())}else{let n=!0;for(let o=0;o<t.length;o++){const a=t[o];if(!r.$(a)||typeof a.x!="number"||isNaN(a.x)||typeof a.y!="number"||isNaN(a.y)){n=!1;break}}if(n){i=new E;for(let o=0;o<t.length;o++){const a=t[o];i.add(new L(a.x,a.y).k())}}}return i}get pointsCount(){return this.Me.count}getPoint(t){return this.Me.r[t]}setPoint(t,i){this.Me.setElt(t,i)}setPointAt(t,i,s){this.Me.setElt(t,new L(i,s))}insertPoint(t,i){this.Me.insertAt(t,i)}insertPointAt(t,i,s){this.Me.insertAt(t,new L(i,s))}addPoint(t){this.Me.add(t)}addPointAt(t,i){this.Me.add(new L(t,i))}removePoint(t){this.Me.removeAt(t)}clearPoints(){this.Me.clear()}Pr(t,i){if(t===0&&i===0)return;if(this.pointsCount===0){this.defaultFromPoint.isReal()&&this.defaultFromPoint.offset(t,i),this.defaultToPoint.isReal()&&this.defaultToPoint.offset(t,i);return}const s=this.Fi,n=new E,o=this.Me.iterator;for(;o.next();){const h=o.value;n.add(new L(h.x+t,h.y+i).k())}n.k();const a=this.Me;this.Me=n;const l=this.diagram;isNaN(t)||isNaN(i)||l!==null&&l.animationManager.ke?this.c():(this.nn.e(this.nn.x+t,this.nn.y+i),this.ct.e(this.ct.x+t,this.ct.y+i),this.Pf()),s?this.pk():(this.defaultFromPoint.isReal()&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint.isReal()&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),l!==null&&l.animationManager.ke&&l.animationManager.AM(this,n),this.t("points",a,n)}startRoute(){this.xl===null&&(this.xl=this.Me,this.Me=this.Me.copy())}commitRoute(){if(this.xl===null)return;const t=this.xl,i=this.Me;this.xl=null;const s=this.diagram;s!==null&&s.animationManager.ke&&s.animationManager.AM(this,i),this.ai(),this.pk(),this.t("points",t,i)}rollbackRoute(){this.xl!==null&&(this.Me=this.xl,this.xl=null,this.uv(this.va))}DR(){this.vr!==null&&(this.points=this.vr,this.vr=null)}pk(){if(this.Me.count===0){this.Fi=!1;return}this.Fi=!0,this.uv(this.va),this.$h=null,this.mk=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.yk(!1)}invalidateRoute(){this.$t()}$t(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const i=this.diagram;if(i){if(i.nb.has(this)||i.undoManager.isUndoingRedoing)return;const s=i.animationManager;if(s.isTicking&&!s.isAnimating)return;this.vr!==null&&!s.isTicking&&(this.vr=null)}this.Fi=!1,this.c(),t.c()}get Fi(){return(this.Mt&16)!==0}set Fi(t){(this.Mt&16)!==0!==t&&(this.Mt=this.Mt^16)}get suspendsRouting(){return(this.Mt&32)!==0}set suspendsRouting(t){(this.Mt&32)!==0!==t&&(this.Mt=this.Mt^32)}get _y(){return(this.Mt&64)!==0}set _y(t){(this.Mt&64)!==0!==t&&(this.Mt=this.Mt^64)}get TC(){return(this.Mt&512)!==0}set TC(t){(this.Mt&512)!==0!==t&&(this.Mt=this.Mt^512)}get defaultFromPoint(){return this.wC}set defaultFromPoint(t){this.wC=t&&t.isReal()?t.copy():L.mn}get defaultToPoint(){return this.xC}set defaultToPoint(t){this.xC=t&&t.isReal()?t.copy():L.mn}updateRoute(){if(this.Fi||this._y)return;let t=!0;try{this._y=!0,this.startRoute(),t=this.computePoints()}catch{this._y=!1,this.rollbackRoute()}finally{this._y=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let i=this.fromNode,s=null;if(i===null?(yt.Zh||(yt.Zh=new wt,yt.Zh.desiredSize=_.bc,yt.Zh.ensureBounds()),this.defaultFromPoint.isReal()&&(yt.Zh.location=this.defaultFromPoint,yt.Zh.ensureBounds(),i=yt.Zh,s=yt.Zh)):s=this.fromPort,s!==null&&!i.isVisible()){const v=i.findVisibleNode();v!==null&&v!==i?(i=v,s=v.port):i=v}if(this.bC=i,i===null||!i.location.isReal()||s===null||(s=i.findVisiblePort(s),s===null))return!1;let n=this.toNode,o=null;if(n===null?(yt.Qh||(yt.Qh=new wt,yt.Qh.desiredSize=_.bc,yt.Qh.ensureBounds()),this.defaultToPoint.isReal()&&(yt.Qh.location=this.defaultToPoint,yt.Qh.ensureBounds(),n=yt.Qh,o=yt.Qh)):o=this.toPort,o!==null&&!n.isVisible()){const v=n.findVisibleNode();v!==null&&v!==n?(n=v,o=v.port):n=v}if(this.kC=n,n===null||!n.location.isReal()||o===null||(o=n.findVisiblePort(o),o===null))return!1;const a=this.pointsCount,l=this.computeSpot(!0,s),h=this.computeSpot(!1,o),d=this.bl(l),f=this.bl(h),m=s===o&&s!==null,p=this.isOrthogonal;let b=this.curve===9;m&&!p?(b=!0,this.ir=!0):this.ir=!1;const x=this.computeAdjusting()===0||m;if(!p&&!m&&d&&f){let v=!1;if(!x&&a>=3){let S=this.getLinkPoint(i,s,l,!0,!1,n,o),P=this.getLinkPoint(n,o,h,!1,!1,i,s);v=this.adjustPoints(0,S,a-1,P),v&&(S=this.getLinkPoint(i,s,l,!0,!1,n,o),P=this.getLinkPoint(n,o,h,!1,!1,i,s),this.adjustPoints(0,S,a-1,P))}v||(this.clearPoints(),b?this.CE(i,s,l,n,o,h):this.LE(i,s,l,n,o,h))}else{const v=m?this.computeCurviness():0;x&&(p&&this.isAvoiding||m)&&this.clearPoints();const S=this.getLinkPoint(i,s,l,!0,p,n,o),P=this.getLinkPoint(n,o,h,!1,p,i,s);let T=0,A=0,C=0;if(p||!d||m){C=this.getLinkDirection(i,s,S,l,!0,p,n,o);let z=this.wk(i,s,l,!0,C);if(m&&(d||l.equals(h)||!p&&l.x+h.x===1&&l.y+h.y===1)&&(C-=p?90:yt.ov,v<0&&(C-=180)),C=B.Ee(C),m&&(z+=Math.abs(v)*(p?1:2)),C===0?T=z:C===90?A=z:C===180?T=-z:C===270?A=-z:(T=z*Math.cos(C*Math.PI/180),A=z*Math.sin(C*Math.PI/180)),l.isNoSpot()&&m){const K=s.getDocumentPoint(X.Center,L.l()),$=L.z(K.x+T*yt.Yf,K.y+A*yt.Yf);this.getLinkPointFromPoint(i,s,K,$,!0,S),L.i(K),L.i($)}}let O=0,R=0,I=0;if(p||!f||m){I=this.getLinkDirection(n,o,P,h,!1,p,i,s);let z=this.wk(n,o,h,!1,I);if(m&&(f||l.equals(h)||!p&&l.x+h.x===1&&l.y+h.y===1)&&(I+=p?0:yt.rv,v<0&&(I+=180)),I=B.Ee(I),m&&(z+=Math.abs(v)*(p?1:2)),I===0?O=z:I===90?R=z:I===180?O=-z:I===270?R=-z:(O=z*Math.cos(I*Math.PI/180),R=z*Math.sin(I*Math.PI/180)),h.isNoSpot()&&m){const K=o.getDocumentPoint(X.Center,L.l()),$=L.z(K.x+O*yt.Yf,K.y+R*yt.Yf);this.getLinkPointFromPoint(n,o,K,$,!1,P),L.i(K),L.i($)}}let H=S;(p||!d||m)&&(H=new L(S.x+T,S.y+A));let V=P;(p||!f||m)&&(V=new L(P.x+O,P.y+R)),!x&&!p&&d&&a>3&&this.adjustPoints(0,S,a-2,V)?this.setPoint(a-1,P):!x&&!p&&f&&a>3&&this.adjustPoints(1,H,a-1,P)?this.setPoint(0,S):!x&&(p?a>=6:a>4)&&this.adjustPoints(1,H,a-2,V)?(this.setPoint(0,S),this.setPoint(a-1,P)):(this.clearPoints(),this.addPoint(S),(p||!d||m)&&this.addPoint(H),p&&this.addOrthoPoints(H,C,V,I,i,n),(p||!f||m)&&this.addPoint(V),this.addPoint(P))}return t.addInvalidRoute(this),!0}DC(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x>=t.x?i.x=t.x+9e9:i.x=t.x-9e9,i.y=t.y):(i.y>=t.y?i.y=t.y+9e9:i.y=t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,s,n,o,a){if(a===void 0&&(a=new L),t===null||i===null)return a.h(s),a;if(!t.isVisible()){const b=t.findVisibleNode();b!==null&&b!==t&&(t=b,i=t.port)}let l=0,h=0,d=0,f=0,m=null,p=i.panel;if(p!==null&&!p.Nn()&&(p=p.panel),p===null)l=n.x,h=n.y,d=s.x,f=s.y;else{m=p.Js;const b=1/(m.m11*m.m22-m.m12*m.m21),x=m.m22*b,v=-m.m12*b,S=-m.m21*b,P=m.m11*b,T=b*(m.m21*m.dy-m.m22*m.dx),A=b*(m.m12*m.dx-m.m11*m.dy);l=n.x*x+n.y*S+T,h=n.x*v+n.y*P+A,d=s.x*x+s.y*S+T,f=s.x*v+s.y*P+A}return i.pf(l,h,d,f,a),m!==null&&a.v(m),a}AE(t,i){const s=t.yd;return s!==null?s.dv(i):null}xk(t){if(t===null)return null;let i=t.yd;return i===null&&(i=new ch(t.part,t),t.yd=i),i.dv(this)}getLinkPoint(t,i,s,n,o,a,l,h){if(h===void 0&&(h=new L),s.isSpot()&&!this.bl(s))return i.getDocumentPoint(s,h),h;if(s.isSide()){const m=this.xk(i);if(m!==null){const p=m.tc;if(h.h(p),o&&this.routing===7){const b=this.xk(l);if(b!==null&&m.Kf<b.Kf){const x=L.l(),v=L.l(),S=Y.l();i.getDocumentPoint(X.TopLeft,x),i.getDocumentPoint(X.BottomRight,v);const P=x.x,T=x.y,A=v.x,C=v.y;S.x=Math.min(P,A),S.y=Math.min(T,C),S.width=Math.abs(P-A),S.height=Math.abs(T-C);const O=this.computeSpot(!n,l),R=this.getLinkPoint(a,l,O,!n,o,t,i,v);(s.includesSide(X.LeftSide)||s.includesSide(X.RightSide))&&R.y>=S.y&&R.y<=S.y+S.height?h.y=R.y:(s.includesSide(X.TopSide)||s.includesSide(X.BottomSide))&&R.x>=S.x&&R.x<=S.x+S.width&&(h.x=R.x),Y.i(S),L.i(x),L.i(v)}}return h}}const d=i.getDocumentPoint(this.ig(s,n),L.l()),f=L.l();if(this.pointsCount>(o?6:2))f.h(n?this.getPoint(1):this.getPoint(this.pointsCount-2)),o&&this.DC(d,f);else if(t!=null&&t.isMemberOf(a)||a!=null&&a.isMemberOf(t)){const m=i.getDocumentBounds(Y.l()),p=l.getDocumentBounds(Y.l());m.isReal()&&p.isReal()?p.containsRect(m)?(f.h(d),this.vC(p,d.x,d.y,0,this.computeSpot(l===this.toPort,l),f)):m.containsRect(p)?(l.getDocumentPoint(X.Center,f),this.vC(m,f.x,f.y,0,this.computeSpot(i===this.toPort,i),f)):this.FC(l,d,n,o,f):this.FC(l,d,n,o,f),Y.i(m),Y.i(p)}else this.FC(l,d,n,o,f);return this.getLinkPointFromPoint(t,i,d,f,n,h),L.i(f),L.i(d),h}FC(t,i,s,n,o){const a=this.computeSpot(!s,t);t.getDocumentPoint(this.ig(a,!s),o),n&&this.DC(i,o)}getLinkDirection(t,i,s,n,o,a,l,h){let d=this.TE(t,i,s,n,o,a,l,h);if(t&&l){const m=Y.l(),p=Y.l();if(n.isNone()&&t.isMemberOf(l)&&i&&h){if(i.getDocumentBounds(m),h.getDocumentBounds(p),m.isReal()&&p.isReal()&&p.containsRect(m)){const b=this.computeSpot(h===this.toPort,h);b.equals(X.Left)||b.equals(X.LeftSide)?d=180:b.equals(X.Right)||b.equals(X.RightSide)?d=0:b.equals(X.Top)||b.equals(X.TopSide)?d=270:b.equals(X.Bottom)||b.equals(X.BottomSide)?d=90:d=B.Ee(d+180)}}else l!=null&&l.isMemberOf(t)&&i&&h&&(i.getDocumentBounds(m),h.getDocumentBounds(p),m.isReal()&&p.isReal()&&m.containsRect(p)&&(d=B.Ee(d+180)));Y.i(m),Y.i(p)}if(this.bl(n)||i===null)return d;const f=i.getDocumentAngle();return f===0?d:(45<=f&&f<135?d+=90:135<=f&&f<225?d+=180:225<=f&&f<315&&(d+=270),B.Ee(d))}TE(t,i,s,n,o,a,l,h){if(n.isSpot())return B._w(null,n.x,n.y);if(n.isSide()){const p=this.xk(i);if(p!==null)switch(p.fi){case 1:return 270;case 8:return 90;case 2:return 180;default:return 0}else return n.includesSide(X.TopSide)?270:n.includesSide(X.BottomSide)?90:n.includesSide(X.LeftSide)?180:0}if(i===null||h===null)return 0;const d=i.getDocumentPoint(X.Center,L.l()),f=L.l();this.pointsCount>(a?6:2)?a?(f.h(o?this.getPoint(1):this.getPoint(this.pointsCount-2)),this.DC(d,f)):f.h(s):h.getDocumentPoint(X.Center,f);let m=0;return Math.abs(f.x-d.x)>Math.abs(f.y-d.y)?f.x>=d.x?m=0:m=180:f.y>=d.y?m=90:m=270,L.i(f),L.i(d),m}computeEndSegmentLength(t,i,s,n){return this.wk(t,i,s,n,NaN)}wk(t,i,s,n,o){if(i!==null&&s.isSide()){const l=this.xk(i);if(l!==null)return l.bk}let a=NaN;if(n?a=this.fromEndSegmentLength:a=this.toEndSegmentLength,i!==null&&isNaN(a))if(o===void 0&&(o=NaN),yt.CC>0&&this.computeCurve()===9&&!isNaN(o)&&s.isSpot()){const l=this.getOtherPort(i);if(l){const h=L.l(),d=L.l(),f=i.getDocumentPoint(s,h),m=l.getDocumentPoint(s.opposite(),d),p=o>=315||o<=45||o>=135&&o<=225;let b=Math.abs(p?f.x-m.x:f.y-m.y)/yt.CC;return b=Math.max(b,yt.LC),L.i(h),L.i(d),b}}else n?a=i.fromEndSegmentLength:a=i.toEndSegmentLength;return isNaN(a)&&(a=yt.LC),a}computeSpot(t,i){return i===void 0&&(i=null),t?this.DE(i||this.fromPort):this.vE(i||this.toPort)}DE(t){if(t===null)return X.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===X.Default?X.None:i}vE(t){if(t===null)return X.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===X.Default?X.None:i}bl(t){return t===X.None||t.x===.5&&t.y===.5}ig(t,i){return t.x===.5&&t.y===.5?t:X.Center}computeOtherPoint(t,i){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new L);{const s=this.AE(i,this);if(s!==null)return s.tc;if(t instanceof Ft){let n=this.fromNode,o=this.fromPort;o===i&&(n=this.toNode,o=this.toPort);const a=Y.l(),l=Y.l();if(o&&(n!=null&&n.isMemberOf(t))){const h=this.computeSpot(o===i,i);if(i.getDocumentBounds(a),o.getDocumentBounds(l),a.isReal()&&l.isReal()&&a.containsRect(l)){const d=o.getDocumentPoint(X.Center);return this.vC(a,d.x,d.y,0,h,d),Y.i(a),Y.i(l),d}}Y.i(a),Y.i(l)}return i.getDocumentPoint(X.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const s=this.fromPort;s!==null&&(i=s.fromShortLength)}return isNaN(i)?0:i}else{let i=this.toShortLength;if(isNaN(i)){const s=this.toPort;s!==null&&(i=s.toShortLength)}return isNaN(i)?0:i}}Zm(t,i,s,n,o,a){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let l;if(a===void 0?(l=lt.l(),l.Ue()):l=a,l.kc(this.v),this.containedInRect(t,l))return this.JN(i,s,o),a===void 0&&lt.i(l),!0;if(this.intersectsRect(t,l)){let h=!1;if(!this.Tf){const d=this.D.r,f=d.length;for(let m=f;m--;){const p=d[m];if(!p.visible&&p!==this.locationObject)continue;const b=p.actualBounds,x=this.naturalBounds;if(b.x>x.width||b.y>x.height||b.x+b.width<0||b.y+b.height<0)continue;const v=p,S=lt.l();if(S.set(l),v instanceof Lt?h=v.Zm(t,i,s,n,o,S):this.path===v?v instanceof Xt&&(h=v.nE(t,n,S)):h=v.JT(t,n,S),h){let P=v;i!==null&&(P=i(v)),P&&(s===null||s(P))&&o.add(P)}lt.i(S)}}return a===void 0&&lt.i(l),h||this.background!==null}return a===void 0&&lt.i(l),!1}get isOrthogonal(){return(this.Jh&2)===2}static MC(t){return(t&2)===2}get isAvoiding(){return(this.Jh&4)===4}computeCurve(){if(this.ir===null){const t=this.fromPort,i=t!==null&&t===this.toPort,s=this.isOrthogonal;this.ir=i&&!s}return this.ir?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=yt.lv),t}findMidLabel(){const t=this.path,i=this.D.r,s=i.length;for(let o=0;o<s;o++){const a=i[o];if(!(a===t||a.isPanelMain)&&(a.segmentIndex===-1/0||isNaN(a.segmentIndex)))return a}const n=this.labelNodes;for(;n.next();){const o=n.value;if(o.segmentIndex===-1/0||isNaN(o.segmentIndex))return o}return null}computeSpacing(){if(!this.isVisible())return 0;let t=yt.av;t=Math.max(t,this.computeThickness());const i=this.fromPort,s=this.toPort;if(i!==null&&s!==null){const n=this.findMidLabel();if(n!==null){const o=n.naturalBounds,a=n.margin,l=isNaN(o.width)?yt.hv:o.width*n.scale+a.left+a.right,h=isNaN(o.height)?yt.cv:o.height*n.scale+a.top+a.bottom,d=n.segmentOrientation;if(d===21||d===25||d===24)t=Math.max(t,h);else if(d===23||d===27||d===22||d===26)t=Math.max(t,l);else{const f=i.getDocumentPoint(X.Center).directionPoint(s.getDocumentPoint(X.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(f)*l)+Math.abs(Math.cos(f)*h)+1)}this.curve===9&&(t*=yt.sv)}}return t}arrangeBundledLinks(t,i){if(i)for(let s=0;s<t.length;s++){const n=t[s];n.computeAdjusting()===0&&n.$t()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=yt.ev;const i=this.sr;if(i!==null){const s=r.nt();let n=0;const o=i.rn;for(let l=0;l<o.length;l++){const h=o[l].computeSpacing();s.push(h),n+=h}let a=-n/2;for(let l=0;l<o.length;l++){if(o[l]===this){t=a+s[l]/2;break}a+=s[l]}i.Gy===this.fromNode&&(t=-t),r.Z(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.sr!==null}LE(t,i,s,n,o,a){let l=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,a,!1,!1,t,i);if(this.gv(t,i,s,l,n,o,a,h),this.addPoint(l),this.addPoint(h),this.hasCurviness()){const d=h.x-l.x,f=h.y-l.y,m=this.computeCurviness(),p=m,b=l.x+d/2,x=l.y+f/2;let v=b,S=x;if(B.u(f,0))d>0?S-=p:S+=p;else{const P=-d/f;let T=Math.sqrt(p*p/(P*P+1));m<0&&(T=-T),v=(f<0?-1:1)*T+b,S=P*(v-b)+x}this.insertPointAt(1,v,S)}}gv(t,i,s,n,o,a,l,h){const d=a.getDocumentBounds(Y.l()),f=i.getDocumentBounds(Y.l());if(d.intersectsRect(f)&&!d.containsRect(f)&&!f.containsRect(d)){const m=L.l();i.getDocumentPoint(this.ig(s,!0),m);const p=L.l();a.getDocumentPoint(this.ig(l,!1),p);const b=f.width*f.height,x=d.width*d.height;b>x?(n.h(m),this.getLinkPointFromPoint(o,a,p,m,!1,p),h.h(p)):b<x?(this.getLinkPointFromPoint(t,i,m,p,!0,m),n.h(m),h.h(p)):(n.h(m),h.h(p)),L.i(m),L.i(p)}else if(d.containsPoint(n)){const m=L.l();i.getDocumentPoint(this.ig(s,!0),m),h.h(m),this.RC(d,m.x,m.y,yt.Yf,h),this.getLinkPointFromPoint(o,a,d.containsPoint(m)?m:n,h,!1,h),this.getLinkPointFromPoint(t,i,m,h,!0,n),L.i(m)}else if(f.containsPoint(h)){const m=L.l();a.getDocumentPoint(this.ig(l,!1),m),n.h(m),this.RC(f,m.x,m.y,yt.Yf,n),this.getLinkPointFromPoint(t,i,f.containsPoint(m)?m:h,n,!0,n),this.getLinkPointFromPoint(o,a,m,n,!1,h),L.i(m)}Y.i(f),Y.i(d)}vC(t,i,s,n,o,a){let l=-1;return o.equals(X.Left)||o.equals(X.LeftSide)?l=180:o.equals(X.Right)||o.equals(X.RightSide)?l=0:o.equals(X.Top)||o.equals(X.TopSide)?l=270:(o.equals(X.Bottom)||o.equals(X.BottomSide))&&(l=90),l===-1?this.RC(t,i,s,0,a):this.mv(t,i,s,0,l,a)}RC(t,i,s,n,o){const a=B._w(t,i,s);return this.mv(t,i,s,n,a,o)}mv(t,i,s,n,o,a){return o===0?a.x=t.right+n:o===90?a.y=t.bottom+n:o===180?a.x=t.x-n:o===270?a.y=t.y-n:o===45?(a.x=t.right+n,a.y=t.bottom+n):o===135?(a.x=t.x-n,a.y=t.bottom+n):o===225?(a.x=t.x-n,a.y=t.y-n):o===315&&(a.x=t.right+n,a.y=t.y-n),a}CE(t,i,s,n,o,a){let l=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,a,!1,!1,t,i);this.gv(t,i,s,l,n,o,a,h),this.addPoint(l),this.addPoint(h);const d=h.x-l.x,f=h.y-l.y,m=this.computeCurviness();let p=0,b=0,x=l.x+d/3,v=l.y+f/3,S=x,P=v;B.u(f,0)?d>0?P-=m:P+=m:(p=-d/f,b=Math.sqrt(m*m/(p*p+1)),m<0&&(b=-b),S=(f<0?-1:1)*b+x,P=p*(S-x)+v),x=l.x+2*d/3,v=l.y+2*f/3;let T=x,A=v;B.u(f,0)?d>0?A-=m:A+=m:(T=(f<0?-1:1)*b+x,A=p*(T-x)+v),this.insertPointAt(1,S,P),this.insertPointAt(2,T,A),this.setPoint(0,this.getLinkPoint(t,i,s,!0,!1,n,o)),this.setPoint(3,this.getLinkPoint(n,o,a,!1,!1,t,i))}adjustPoints(t,i,s,n){let o=this.computeAdjusting();if(this.isOrthogonal){if(o===18)return!1;o===19&&(o=17)}switch(o){case 18:return this.FE(t,i,s,n);case 19:return this.RE(t,i,s,n);case 17:return this.OE(t,i,s,n);default:return!1}}FE(t,i,s,n){const o=this.getPoint(t),a=this.getPoint(s);if(o.equalsApprox(i)&&a.equalsApprox(n))return!0;const l=o.x,h=o.y,d=a.x,f=a.y;let m=d-l,p=f-h;const b=Math.sqrt(m*m+p*p);if(B.X(b,0))return!0;let x=0;B.X(m,0)?p<0?x=-Math.PI/2:x=Math.PI/2:(x=Math.atan(p/Math.abs(m)),m<0&&(x=Math.PI-x));const v=i.x,S=i.y,P=n.x,T=n.y,A=P-v,C=T-S,O=Math.sqrt(A*A+C*C);let R=0;B.X(A,0)?C<0?R=-Math.PI/2:R=Math.PI/2:(R=Math.atan(C/Math.abs(A)),A<0&&(R=Math.PI-R));const I=O/b,H=R-x;this.setPoint(t,i);for(let V=t+1;V<s;V++){const z=this.getPoint(V);m=z.x-l,p=z.y-h;const K=Math.sqrt(m*m+p*p);if(B.X(K,0))continue;let $=0;B.X(m,0)?p<0?$=-Math.PI/2:$=Math.PI/2:($=Math.atan(p/Math.abs(m)),m<0&&($=Math.PI-$));const q=$+H,J=K*I,ot=v+J*Math.cos(q),rt=S+J*Math.sin(q);this.setPointAt(V,ot,rt)}return this.setPoint(s,n),!0}RE(t,i,s,n){const o=this.getPoint(t),a=this.getPoint(s);if(o.equalsApprox(i)&&a.equalsApprox(n))return!0;const l=o.x,h=o.y,d=a.x,f=a.y,m=(d-l)**2+(f-h)**2,p=i.x,b=i.y,x=n.x,v=n.y;let S=0,P=1;x-p!==0?(S=(v-b)/(x-p),P=Math.sqrt(1+1/(S*S))):S=9e9,this.setPoint(t,i);for(let T=t+1;T<s;T++){const A=this.getPoint(T),C=A.x,O=A.y;let R=.5;m!==0&&(R=((l-C)*(l-d)+(h-O)*(h-f))/m);const I=l+R*(d-l),H=h+R*(f-h);let V=Math.sqrt((C-I)**2+(O-H)**2);O<S*(C-I)+H&&(V=-V),S>0&&(V=-V);const z=p+R*(x-p),K=b+R*(v-b);if(S!==0){const $=z+V/P,q=K-($-z)/S;this.setPointAt(T,$,q)}else this.setPointAt(T,z,K+V)}return this.setPoint(s,n),!0}OE(t,i,s,n){if(this.isOrthogonal){let o=this.getPoint(t),a=this.getPoint(t+1),l=this.getPoint(t+2),h=a.x,d=a.y;const f=h,m=d;B.u(o.y,a.y)?B.u(a.x,l.x)?d=i.y:B.u(a.y,l.y)&&(h=i.x):B.u(o.x,a.x)&&(B.u(a.y,l.y)?h=i.x:B.u(a.x,l.x)&&(d=i.y)),this.setPointAt(t+1,h,d),o=this.getPoint(s),a=this.getPoint(s-1),l=this.getPoint(s-2);let p=a.x,b=a.y;const x=p,v=b;if(B.u(o.y,a.y)?B.u(a.x,l.x)?b=n.y:B.u(a.y,l.y)&&(p=n.x):B.u(o.x,a.x)&&(B.u(a.y,l.y)?p=n.x:B.u(a.x,l.x)&&(b=n.y)),this.setPointAt(s-1,p,b),this.yT())return this.setPointAt(t+1,f,m),this.setPointAt(s-1,x,v),!1}return this.setPoint(t,i),this.setPoint(s,n),!0}addOrthoPoints(t,i,s,n,o,a){i=B.Ee(i),n=B.Ee(n);const l=n;i>=315||i<45?i=0:45<=i&&i<135?i=90:135<=i&&i<225?i=180:i=270,n>=315||n<45?n=0:45<=n&&n<135?n=90:135<=n&&n<225?n=180:n=270;const h=t,d=s,f=Y.bs(o.actualBounds),m=Y.bs(a.actualBounds);f.inflate(yt.Fa,yt.Fa),m.inflate(yt.Fa,yt.Fa),f.unionPoint(t),m.unionPoint(s);const p=L.l(),b=L.l();i===0?d.x>h.x||n===270&&d.y<h.y&&m.right>h.x||n===90&&d.y>h.y&&m.right>h.x?(p.e(d.x,h.y),b.e(d.x,(h.y+d.y)/2),n===180?(p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1),b.x=p.x,b.y=d.y):n===270&&d.y<h.y||n===90&&d.y>h.y?(h.x<m.left?p.x=this.computeMidOrthoPosition(h.x,h.y,m.left,d.y,!1):h.x<m.right&&(n===270&&h.y<m.top||n===90&&h.y>m.bottom)?p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1):p.x=m.right,b.x=p.x,b.y=d.y):n===0&&h.x<m.left&&h.y>m.top&&h.y<m.bottom&&(p.x=h.x,h.y<d.y?p.y=Math.min(d.y,m.top):p.y=Math.max(d.y,m.bottom),b.y=p.y)):(p.e(h.x,d.y),b.e((h.x+d.x)/2,d.y),(n===180||n===90&&d.y<f.top||n===270&&d.y>f.bottom)&&(n===180&&(m.containsPoint(h)||f.containsPoint(d))?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0):d.y<h.y&&(n===180||n===90)?p.y=this.computeMidOrthoPosition(h.x,f.top,d.x,Math.min(d.y,m.bottom),!0):d.y>h.y&&(n===180||n===270)&&(p.y=this.computeMidOrthoPosition(h.x,f.bottom,d.x,Math.max(d.y,m.top),!0)),b.x=d.x,b.y=p.y),p.y>f.top&&p.y<f.bottom&&(d.x>=f.left&&d.x<=h.x||h.x<=m.right&&h.x>=d.x?(n===90||n===270)&&(p.e(Math.max((h.x+d.x)/2,h.x),h.y),b.e(p.x,d.y)):(n===270||(n===0||n===180)&&d.y<h.y?p.y=Math.min(d.y,n===0?f.top:Math.min(f.top,m.top)):p.y=Math.max(d.y,n===0?f.bottom:Math.max(f.bottom,m.bottom)),b.x=d.x,b.y=p.y))):i===180?d.x<h.x||n===270&&d.y<h.y&&m.left<h.x||n===90&&d.y>h.y&&m.left<h.x?(p.e(d.x,h.y),b.e(d.x,(h.y+d.y)/2),n===0?(p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1),b.x=p.x,b.y=d.y):n===270&&d.y<h.y||n===90&&d.y>h.y?(h.x>m.right?p.x=this.computeMidOrthoPosition(h.x,h.y,m.right,d.y,!1):h.x>m.left&&(n===270&&h.y<m.top||n===90&&h.y>m.bottom)?p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1):p.x=m.left,b.x=p.x,b.y=d.y):n===180&&h.x>m.right&&h.y>m.top&&h.y<m.bottom&&(p.x=h.x,h.y<d.y?p.y=Math.min(d.y,m.top):p.y=Math.max(d.y,m.bottom),b.y=p.y)):(p.e(h.x,d.y),b.e((h.x+d.x)/2,d.y),(n===0||n===90&&d.y<f.top||n===270&&d.y>f.bottom)&&(n===0&&(m.containsPoint(h)||f.containsPoint(d))?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0):d.y<h.y&&(n===0||n===90)?p.y=this.computeMidOrthoPosition(h.x,f.top,d.x,Math.min(d.y,m.bottom),!0):d.y>h.y&&(n===0||n===270)&&(p.y=this.computeMidOrthoPosition(h.x,f.bottom,d.x,Math.max(d.y,m.top),!0)),b.x=d.x,b.y=p.y),p.y>f.top&&p.y<f.bottom&&(d.x<=f.right&&d.x>=h.x||h.x>=m.left&&h.x<=d.x?(n===90||n===270)&&(p.e(Math.min((h.x+d.x)/2,h.x),h.y),b.e(p.x,d.y)):(n===270||(n===0||n===180)&&d.y<h.y?p.y=Math.min(d.y,n===180?f.top:Math.min(f.top,m.top)):p.y=Math.max(d.y,n===180?f.bottom:Math.max(f.bottom,m.bottom)),b.x=d.x,b.y=p.y))):i===90?d.y>h.y||n===180&&d.x<h.x&&m.bottom>h.y||n===0&&d.x>h.x&&m.bottom>h.y?(p.e(h.x,d.y),b.e((h.x+d.x)/2,d.y),n===270?(p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0),b.x=d.x,b.y=p.y):n===180&&d.x<h.x||n===0&&d.x>h.x?(h.y<m.top?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,m.top,!0):h.y<m.bottom&&(n===180&&h.x<m.left||n===0&&h.x>m.right)?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0):p.y=m.bottom,b.x=d.x,b.y=p.y):n===90&&h.y<m.top&&h.x>m.left&&h.x<m.right&&(h.x<d.x?p.x=Math.min(d.x,m.left):p.x=Math.max(d.x,m.right),p.y=h.y,b.x=p.x)):(p.e(d.x,h.y),b.e(d.x,(h.y+d.y)/2),(n===270||n===0&&d.x<f.left||n===180&&d.x>f.right)&&(n===270&&(m.containsPoint(h)||f.containsPoint(d))?p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1):d.x<h.x&&(n===270||n===0)?p.x=this.computeMidOrthoPosition(f.left,h.y,Math.min(d.x,m.right),d.y,!1):d.x>h.x&&(n===270||n===180)&&(p.x=this.computeMidOrthoPosition(f.right,h.y,Math.max(d.x,m.left),d.y,!1)),b.x=p.x,b.y=d.y),p.x>f.left&&p.x<f.right&&(d.y>=f.top&&d.y<=h.y||h.y<=m.bottom&&h.y>=d.y?(n===0||n===180)&&(p.e(h.x,Math.max((h.y+d.y)/2,h.y)),b.e(d.x,p.y)):(n===180||(n===90||n===270)&&d.x<h.x?p.x=Math.min(d.x,n===90?f.left:Math.min(f.left,m.left)):p.x=Math.max(d.x,n===90?f.right:Math.max(f.right,m.right)),b.x=p.x,b.y=d.y))):d.y<h.y||n===180&&d.x<h.x&&m.top<h.y||n===0&&d.x>h.x&&m.top<h.y?(p.e(h.x,d.y),b.e((h.x+d.x)/2,d.y),n===90?(p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0),b.x=d.x,b.y=p.y):n===180&&d.x<h.x||n===0&&d.x>=h.x?(h.y>m.bottom?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,m.bottom,!0):h.y>m.top&&(n===180&&h.x<m.left||n===0&&h.x>m.right)?p.y=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!0):p.y=m.top,b.x=d.x,b.y=p.y):n===270&&h.y>m.bottom&&h.x>m.left&&h.x<m.right&&(h.x<d.x?p.x=Math.min(d.x,m.left):p.x=Math.max(d.x,m.right),p.y=h.y,b.x=p.x)):(p.e(d.x,h.y),b.e(d.x,(h.y+d.y)/2),(n===90||n===0&&d.x<f.left||n===180&&d.x>f.right)&&(n===90&&(m.containsPoint(h)||f.containsPoint(d))?p.x=this.computeMidOrthoPosition(h.x,h.y,d.x,d.y,!1):d.x<h.x&&(n===90||n===0)?p.x=this.computeMidOrthoPosition(f.left,h.y,Math.min(d.x,m.right),d.y,!1):d.x>h.x&&(n===90||n===180)&&(p.x=this.computeMidOrthoPosition(f.right,h.y,Math.max(d.x,m.left),d.y,!1)),b.x=p.x,b.y=d.y),p.x>f.left&&p.x<f.right&&(d.y<=f.bottom&&d.y>=h.y||h.y>=m.top&&h.y<=d.y?(n===0||n===180)&&(p.e(h.x,Math.min((h.y+d.y)/2,h.y)),b.e(d.x,p.y)):(n===180||(n===90||n===270)&&d.x<h.x?p.x=Math.min(d.x,n===270?f.left:Math.min(f.left,m.left)):p.x=Math.max(d.x,n===270?f.right:Math.max(f.right,m.right)),b.x=p.x,b.y=d.y))),this.TC=n!==l,this.PC=i,this.SC=n,this.addPoint(p.copy()),this.addPoint(b.copy()),L.i(p),L.i(b),Y.i(f),Y.i(m)}computeMidOrthoPosition(t,i,s,n,o){let a=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(a=this.computeCurviness()),o?(i+n)/2+a:(t+s)/2+a}yT(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const s=this.diagram.getPositions(!1,this.containingGroup,null);for(let n=1;n<i-2;n++){const o=t[n],a=t[n+1];if(!s.isUnoccupied(Math.min(o.x,a.x),Math.min(o.y,a.y),Math.abs(o.x-a.x),Math.abs(o.y-a.y)))return!0}return!1}findClosestSegment(t){const i=t.x,s=t.y;let n=this.getPoint(0),o=this.getPoint(1),a=L.distanceLineSegmentSquared(i,s,n.x,n.y,o.x,o.y),l=0;for(let h=1;h<this.pointsCount-1;h++){n=this.getPoint(h+1);const d=L.distanceLineSegmentSquared(i,s,o.x,o.y,n.x,n.y);o=n,d<a&&(l=h,a=d)}return l}invalidateGeometry(){this.ai()}ai(){this.Ra&&(this.Ra=!1,this.c())}get Ra(){return(this.Mt&128)!==0}set Ra(t){(this.Mt&128)!==0!==t&&(this.Mt=this.Mt^128)}get geometry(){if(!this.Ra){if(this.updateRoute(),this.pointsCount<2)return this.Ra=!0,this.ut;this.ut=this.makeGeometry(),this.Ra=!0}return this.ut}Td(t){if(!t){if(this.Fi===!1)return;const o=this.findMainElement();if(this.Ra&&(o===null||o.geometry!==null))return}this.pointsCount>=2&&(this.ut=this.makeGeometry()),this.Ra=!0;const i=this.path;if(i===null)return;i.ut=this.ut;const s=this.D.r,n=s.length;for(let o=0;o<n;o++){const a=s[o];a!==i&&a.isPanelMain&&a instanceof Xt&&(a.ut=this.ut)}}IE(t){return this._h()&&t.ra.has(this)&&(this.va.width!==0||this.va.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ut,i=this.pointsCount;let s=!1;const n=this.diagram;n!==null&&this.IE(n)&&(s=!0);let o=0,a=0,l=L.bs(this.getPoint(0));const h=L.bs(l),d=this.Me.r,f=this.computeCurve();if(f===9&&i>=3&&!B.X(this.smoothness,0))if(i===3){let m=this.getPoint(1);o=Math.min(l.x,m.x),a=Math.min(l.y,m.y),m=this.getPoint(2),o=Math.min(o,m.x),a=Math.min(a,m.y)}else if(this.isOrthogonal){for(let m=0;m<i;m++){const p=d[m];h.x=Math.min(p.x,h.x),h.y=Math.min(p.y,h.y)}o=h.x,a=h.y}else{for(let m=3;m<i;m+=3){m+3>=i&&(m=i-1);const p=this.getPoint(m);h.x=Math.min(p.x,h.x),h.y=Math.min(p.y,h.y)}o=h.x,a=h.y}else{for(let m=0;m<i;m++){const p=d[m];h.x=Math.min(p.x,h.x),h.y=Math.min(p.y,h.y)}o=h.x,a=h.y}if(o-=this.gk.x,a-=this.gk.y,l.x-=o,l.y-=a,this.computeShortLength(!0)!==0&&(l=this.ec(l,!0,h)),i===2&&!this._h()){let m=L.bs(this.getPoint(1));return m.x-=o,m.y-=a,this.computeShortLength(!1)!==0&&(m=this.ec(m,!1,h)),t.type=1,t.startX=l.x,t.startY=l.y,t.endX=m.x,t.endY=m.y,L.i(m),L.i(l),L.i(h),t}else{t.type=4;const m=vo.qL(t);if(m.Au(l.x,l.y,!1,!1),f===9&&i>=3&&!B.X(this.smoothness,0))if(i===3){const p=this.getPoint(1),b=p.x-o,x=p.y-a,v=L.bs(this.getPoint(2));v.x-=o,v.y-=a,this.computeShortLength(!1)!==0&&this.ec(v,!1,h),m.xr(b,x,b,x,v.x,v.y),L.i(v)}else if(this.isOrthogonal){const p=L.z(o,a),b=L.bs(this.getPoint(1)),x=L.z(o,a),v=L.z(o,a);let S=this.getPoint(0),P;const T=this.smoothness/3;for(let R=1;R<this.pointsCount-1;R++){P=this.getPoint(R);const I=S,H=P,V=this.getPoint(this.OC(P,R,!1));B.X(I.x,H.x)&&B.X(H.x,V.x)||B.X(I.y,H.y)&&B.X(H.y,V.y)||(this.EE(I,H,V,T,x,v),(R===1||R===2&&B.X(S.x,this.getPoint(0).x)&&B.X(S.y,this.getPoint(0).y))&&(b.x=(S.x+P.x)*.5,b.y=(S.y+P.y)*.5),m.xr(b.x-o,b.y-a,x.x-o,x.y-a,P.x-o,P.y-a),p.h(x),b.h(v),S=P)}let A=S.x,C=S.y;const O=L.bs(this.getPoint(this.pointsCount-1));this.computeShortLength(!1)!==0&&this.ec(O,!1,L.gn),A=.5*(A+O.x),C=.5*(C+O.y),m.xr(v.x-o,v.y-a,A-o,C-a,O.x-o,O.y-a),L.i(O),L.i(p),L.i(b),L.i(x),L.i(v)}else for(let p=3;p<i;p+=3){const b=this.getPoint(p-2);p+3>=i&&(p=i-1);const x=this.getPoint(p-1),v=L.bs(this.getPoint(p));p===i-1&&this.computeShortLength(!1)!==0&&this.ec(v,!1,L.gn),m.xr(b.x-o,b.y-a,x.x-o,x.y-a,v.x-o,v.y-a),L.i(v)}else if(this.isOrthogonal||i===2){const p=L.bs(this.getPoint(0)),b=L.l(),x=L.bs(p),v=this.computeCorner();let S=1,P=0;for(;S<i;){if(S=this.OC(p,S,S>1),b.h(this.getPoint(S)),S>=i-1){if(!p.equals(b))this.computeShortLength(!1)!==0&&this.ec(b,!1,L.gn),this.On(m,-o,-a,p,b,s);else if(P===0)for(S=1;S<i;)x.h(p),b.h(this.getPoint(S++)),this.On(m,-o,-a,p,b,s),p.h(b);break}P=this.OC(b,S+1,S<i-3);const T=this.getPoint(P);this.UE(m,-o,-a,p,b,T,p,x,v,s),x.h(b),S=P}L.i(p),L.i(b),L.i(x)}else{const p=this.computeCorner();if(i>2&&p>=.5){const b=L.bs(d[i-1]);this.computeShortLength(!1)!==0&&this.ec(b,!1,L.gn),l.x+=o,l.y+=a;for(let x=1;x<i;x++){const v=x===1?l:d[x-1],S=x===i-1?b:d[x],P=Math.sqrt(v.distanceSquaredPoint(S)),T=p/P;if(T<.5){if(x>1){const A=v.x+(S.x-v.x)*T,C=v.y+(S.y-v.y)*T;m.Tu(v.x-o,v.y-a,A-o,C-a)}m.Ks(S.x+(v.x-S.x)*T-o,S.y+(v.y-S.y)*T-a)}else x>1&&m.Tu(v.x-o,v.y-a,(v.x+S.x)/2-o,(v.y+S.y)/2-a);x===i-1&&m.Ks(b.x-o,b.y-a)}L.i(b)}else if(i>=2){const b=L.bs(d[i-1]);this.computeShortLength(!1)!==0&&this.ec(b,!1,L.gn);for(let x=1;x<i-1;x++)m.Ks(d[x].x-o,d[x].y-a);m.Ks(b.x-o,b.y-a),L.i(b)}}return vo.WL(m),L.i(l),L.i(h),t}}kk(t,i,s,n){let o=s-t;if(isNaN(o)||o===1/0||o===-1/0)return NaN;o<0&&(o=-o);let a=n-i;return isNaN(a)||a===1/0||a===-1/0?NaN:(a<0&&(a=-a),B.X(o,0)?a:B.X(a,0)?o:Math.sqrt(o*o+a*a))}EE(t,i,s,n,o,a){isNaN(n)&&(n=this.smoothness/3);const l=t.x,h=t.y,d=i.x,f=i.y,m=s.x,p=s.y,b=n*this.kk(l,h,d,f),x=n*this.kk(d,f,m,p);if(B.X(h,f)&&B.X(d,m)&&(d>l?p>f?(o.x=d-b,o.y=f-b,a.x=d+x,a.y=f+x):(o.x=d-b,o.y=f+b,a.x=d+x,a.y=f-x):p>f?(o.x=d+b,o.y=f-b,a.x=d-x,a.y=f+x):(o.x=d+b,o.y=f+b,a.x=d-x,a.y=f-x)),B.X(l,d)&&B.X(f,p)&&(f>h?m>d?(o.x=d-b,o.y=f-b,a.x=d+x,a.y=f+x):(o.x=d+b,o.y=f-b,a.x=d-x,a.y=f+x):m>d?(o.x=d-b,o.y=f+b,a.x=d+x,a.y=f-x):(o.x=d+b,o.y=f+b,a.x=d-x,a.y=f-x)),B.X(l,d)&&B.X(d,m)||B.X(h,f)&&B.X(f,p)){const v=.5*(l+m),S=.5*(h+p);o.x=v,o.y=S,a.x=v,a.y=S}}ec(t,i,s){const n=this.pointsCount;if(n<2)return t;if(i){const o=this.getPoint(1),a=o.x-s.x,l=o.y-s.y,h=this.kk(t.x,t.y,a,l);if(h===0)return t;const d=n===2?h*.5:h;let f=this.computeShortLength(!0);f>d&&(f=d);const m=f*(a-t.x)/h,p=f*(l-t.y)/h;t.x+=m,t.y+=p}else{const o=this.getPoint(n-2),a=o.x-s.x,l=o.y-s.y,h=this.kk(t.x,t.y,a,l);if(h===0)return t;const d=n===2?h*.5:h;let f=this.computeShortLength(!1);f>d&&(f=d);const m=f*(t.x-a)/h,p=f*(t.y-l)/h;t.x-=m,t.y-=p}return t}OC(t,i,s){const n=this.pointsCount;let o=t;for(;B.X(t.x,o.x)&&B.X(t.y,o.y);){if(i>=n)return n-1;o=this.getPoint(i++)}if(!B.X(t.x,o.x)&&!B.X(t.y,o.y))return i-1;let a=o;for(;B.X(t.x,o.x)&&B.X(o.x,a.x)&&(!s||(t.y>=o.y?o.y>=a.y:o.y<=a.y))||B.X(t.y,o.y)&&B.X(o.y,a.y)&&(!s||(t.x>=o.x?o.x>=a.x:o.x<=a.x));){if(i>=n)return n-1;a=this.getPoint(i++)}return i-2}UE(t,i,s,n,o,a,l,h,d,f){if(B.u(n.y,o.y)&&B.u(o.x,a.x)){let m=Math.min(d,Math.abs(o.x-h.x)/2);const p=Math.min(m,Math.abs(a.y-o.y)/2);if(m=p,B.u(m,0)){this.On(t,i,s,n,o,f),l.h(o);return}let b=o.x;const x=o.y,v=b;let S=x;o.x>n.x?(b=o.x-m,a.y>o.y?S=o.y+p:S=o.y-p):(b=o.x+m,a.y>o.y?S=o.y+p:S=o.y-p);const P=L.z(b,x);this.On(t,i,s,n,P,f),L.i(P),t.Tu(o.x+i,o.y+s,v+i,S+s),l.e(v,S)}else if(B.u(n.x,o.x)&&B.u(o.y,a.y)){let m=Math.min(d,Math.abs(o.y-h.y)/2);const p=Math.min(m,Math.abs(a.x-o.x)/2);if(m=p,B.u(p,0)){this.On(t,i,s,n,o,f),l.h(o);return}const b=o.x;let x=o.y,v=b;const S=x;o.y>n.y?(x=o.y-m,a.x>o.x?v=o.x+p:v=o.x-p):(x=o.y+m,a.x>o.x?v=o.x+p:v=o.x-p);const P=L.z(b,x);this.On(t,i,s,n,P,f),L.i(P),t.Tu(o.x+i,o.y+s,v+i,S+s),l.e(v,S)}else this.On(t,i,s,n,o,f),l.h(o)}On(t,i,s,n,o,a){if(a||!this._h())t.Ks(o.x+i,o.y+s);else{const l=yt.nv,h=l/2,d=[];let f=0;this.isVisible()&&(f=this.VE(n,o,d));let m=n.x,p=n.y;if(f>0){if(B.u(n.y,o.y))if(n.x<o.x){let b=0;for(;b<f;){const x=Math.max(n.x,Math.min(d[b++]-h,o.x-l));t.Ks(x+i,o.y+s),m=x+i,p=o.y+s;let v=Math.min(x+l,o.x);for(;b<f;){const A=d[b];if(A<v+l)b++,v=Math.min(A+h,o.x);else break}const S=o.y-l+s,P=v+i,T=o.y+s;this.curve===10?t.Au(P,T,!1,!1):t.xr(m,S,P,S,P,T),m=P,p=T}}else{let b=f-1;for(;b>=0;){const x=Math.min(n.x,Math.max(d[b--]+h,o.x+l));t.Ks(x+i,o.y+s),m=x+i,p=o.y+s;let v=Math.max(x-l,o.x);for(;b>=0;){const A=d[b];if(A>v-l)b--,v=Math.max(A-h,o.x);else break}const S=o.y-l+s,P=v+i,T=o.y+s;this.curve===10?t.Au(P,T,!1,!1):t.xr(m,S,P,S,P,T),m=P,p=T}}else if(B.u(n.x,o.x))if(n.y<o.y){let b=0;for(;b<f;){const x=Math.max(n.y,Math.min(d[b++]-h,o.y-l));t.Ks(o.x+i,x+s),m=o.x+i,p=x+s;let v=Math.min(x+l,o.y);for(;b<f;){const A=d[b];if(A<v+l)b++,v=Math.min(A+h,o.y);else break}const S=o.x-l+i,P=o.x+i,T=v+s;this.curve===10?t.Au(P,T,!1,!1):t.xr(S,p,S,T,P,T),m=P,p=T}}else{let b=f-1;for(;b>=0;){const x=Math.min(n.y,Math.max(d[b--]+h,o.y+l));t.Ks(o.x+i,x+s),m=o.x+i,p=x+s;let v=Math.max(x-l,o.y);for(;b>=0;){const A=d[b];if(A>v-l)b--,v=Math.max(A-h,o.y);else break}const S=o.x-l+i,P=o.x+i,T=v+s;this.curve===10?t.Au(P,T,!1,!1):t.xr(S,p,S,T,P,T),m=P,p=T}}}t.Ks(o.x+i,o.y+s)}}VE(t,i,s){const n=this.diagram;if(n===null||t.equals(i))return 0;const o=n.layers;for(;o.next();){const a=o.value;if(a!==null&&a.visible){const l=a.EM(),h=l.length;for(let d=0;d<h;d++){const f=l[d];if(!(f instanceof yt))continue;if(f===this)return s.length>0&&s.sort((b,x)=>b-x),s.length;if(!f.isVisible()||!f._h())continue;const m=f.routeBounds;if(!m.isReal()||!this.routeBounds.intersectsRect(m)||this.usesSamePort(f))continue;const p=f.path;p!==null&&p.isVisibleObject()&&this.BE(t,i,s,f)}}}return s.length>0&&s.sort((a,l)=>a-l),s.length}BE(t,i,s,n){const o=B.u(t.y,i.y),a=n.pointsCount;let l=n.getPoint(0);const h=L.l();for(let d=1;d<a;d++){const f=n.getPoint(d);if(d<a-1){const m=n.getPoint(d+1);if(l.y===f.y&&f.y===m.y){if(f.x>l.x&&m.x>=f.x||f.x<l.x&&m.x<=f.x)continue}else if(l.x===f.x&&f.x===m.x&&(f.y>l.y&&m.y>=f.y||f.y<l.y&&m.y<=f.y))continue}this.zE(t,i,l,f,h)&&(o?s.push(h.x):s.push(h.y)),l=f}L.i(h)}zE(t,i,s,n,o){const a=t.x,l=t.y,h=i.x,d=i.y,f=s.x,m=s.y,p=n.x,b=n.y;if(B.u(a,h)){if(!B.u(l,d)&&B.u(m,b)&&Math.min(l,d)<m&&Math.max(l,d)>m&&Math.min(f,p)<a&&Math.max(f,p)>a&&!B.u(f,p))return o.x=a,o.y=m,!0}else if(B.u(l,d)&&B.u(f,p)&&Math.min(a,h)<f&&Math.max(a,h)>f&&Math.min(m,b)<l&&Math.max(m,b)>l&&!B.u(m,b))return o.x=f,o.y=l,!0;return o.x=0,o.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.bl(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.bl(this.computeSpot(!1))?t-2:t-1}_h(){const t=this.curve;return t===11||t===10}yk(t){if(t||this._h()){const i=this.diagram;i!==null&&!i.animationManager.isTicking&&!i.ra.has(this)&&(this.va.width!==0||this.va.height!==0)&&i.ra.set(this,this.va.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(i===null||!i.visible||i.isTemporary)return;const s=i.diagram;if(s===null||s.animationManager.isTicking)return;let n=!1;const o=s.layers;for(;o.next();){const a=o.value;if(a.visible){if(a===i){n=!0;let l=!1;const h=a.EM(),d=h.length;for(let f=0;f<d;f++){const m=h[f];m instanceof yt&&(m===this?l=!0:l&&this.pv(m,t))}}else if(n){const l=a.EM(),h=l.length;for(let d=0;d<h;d++){const f=l[d];f instanceof yt&&this.pv(f,t)}}}}}pv(t,i){if(t===null||!t.Ra||!t.Fi||!t._h())return;const s=t.routeBounds;s.isReal()&&(!this.routeBounds.intersectsRect(s)&&!i.intersectsRect(s)||this.usesSamePort(t)||t.ai())}usesSamePort(t){const i=this.pointsCount,s=t.pointsCount;if(i>0&&s>0){const n=this.getPoint(0),o=t.getPoint(0);if(n.equalsApprox(o))return!0;const a=this.getPoint(i-1),l=t.getPoint(s-1);if(a.equalsApprox(l)||n.equalsApprox(l)||a.equalsApprox(o))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);const n=this.fromNode;if(n!==null){if(this.isTreeLink&&i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let a=n;for(;a!==null;){if(a.labeledLink===this)return!0;a=a.containingGroup}const l=n.findVisibleNode();if(l===null||l===t)return!1}const o=this.toNode;if(o!==null){if(this.isTreeLink&&!i&&!o.isTreeExpanded)return!1;if(o===t)return!0;let a=o;for(;a!==null;){if(a.labeledLink===this)return!0;a=a.containingGroup}const l=o.findVisibleNode();if(l===null||l===t)return!1}return!0}Xe(t){if(super.Xe(t),t&&this.yk(!1),this.sr!==null&&this.sr.Jd(),this.on!==null){const i=this.on.iterator;for(;i.next();)i.value.Xe(t)}}get adjusting(){return this.Gf}set adjusting(t){const i=this.Gf;i!==t&&(this.Gf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Gf}get corner(){return this.Qd}set corner(t){const i=this.Qd;i!==t&&(this.Qd=t,this.ai(),this.t("corner",i,t))}get curve(){return this._d}set curve(t){const i=this._d;i!==t&&(this._d=t,this.$t(),this.ai(),this.yk(i===10||i===11||t===10||t===11),this.t("curve",i,t))}get curviness(){return this.tg}set curviness(t){const i=this.tg;i!==t&&(this.tg=t,this.$t(),this.ai(),this.t("curviness",i,t))}get routing(){return this.Jh}set routing(t){const i=this.Jh;i!==t&&(this.Jh=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.lp=!0),this.ir=null,this.$t(),this.yk(yt.MC(i)||yt.MC(t)),this.t("routing",i,t))}get smoothness(){return this.eg}set smoothness(t){const i=this.eg;i!==t&&(this.eg=t,this.ai(),this.t("smoothness",i,t))}Qy(){const t=this.po;if(t===null)return;const i=this.wo;if(i===null||!isNaN(this.curviness))return;const s=this.yo,n=this.xo;let o=null,a=null;const l=t.ee.r,h=l.length;for(let d=0;d<h;d++){const f=l[d];!(f.po===t&&f.yo===s&&f.wo===i&&f.xo===n)&&!(f.po===i&&f.yo===n&&f.wo===t&&f.xo===s)||(a===null?a=f:(o===null&&(o=[],o.push(a)),o.push(f)))}if(o!==null){let d=t.KD(i,s,n);d===null&&(d=new Yp(t,s,i,n),t.GD(d),i.GD(d)),d.rn=o;for(let f=0;f<o.length;f++){const m=o[f];m.sr=d}d.Jd()}}Zy(){const t=this.sr;if(t!==null){if(!isNaN(this.curviness))return;this.sr=null;const i=t.rn.indexOf(this);i>=0&&(t.rn.splice(i,1),t.Jd())}}Ar(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Wh()))return t.model.getKeyForLinkData(this.data)}};y(yt,"Zh",null),y(yt,"Qh",null),y(yt,"Normal",1),y(yt,"Orthogonal",2),y(yt,"AvoidsNodes",6),y(yt,"AvoidsNodesStraight",7),y(yt,"None",0),y(yt,"Bezier",9),y(yt,"JumpGap",10),y(yt,"JumpOver",11),y(yt,"End",17),y(yt,"Scale",18),y(yt,"Stretch",19),y(yt,"OrientAlong",21),y(yt,"OrientPlus90",22),y(yt,"OrientMinus90",23),y(yt,"OrientOpposite",24),y(yt,"OrientUpright",25),y(yt,"OrientPlus90Upright",26),y(yt,"OrientMinus90Upright",27),y(yt,"OrientUpright45",28),y(yt,"tv",8),y(yt,"ev",16),y(yt,"Fa",8),y(yt,"J1",3),y(yt,"iv",3),y(yt,"sv",1.333),y(yt,"NC",1),y(yt,"CC",0),y(yt,"nv",10),y(yt,"Yf",9999),y(yt,"ov",30),y(yt,"rv",30),y(yt,"LC",10),y(yt,"lv",10),y(yt,"av",14),y(yt,"hv",30),y(yt,"cv",14),y(yt,"_A",8),y(yt,"tT",8),y(yt,"fv",11),y(yt,"IT");let Nt=yt;class Yp{constructor(e,t,i,s){y(this,"Ko");y(this,"qs");y(this,"Gy");y(this,"pC");y(this,"fk");y(this,"yC");y(this,"rn");F.Je(this),this.Ko=!1,this.qs=!1,this.Gy=e,this.pC=t,this.fk=i,this.yC=s,this.rn=[]}Jd(){if(!this.Ko){const e=this.rn;if(e.length>0){const t=e[0].diagram;t!==null&&(t.o2.add(this),this.qs=t.undoManager.isUndoingRedoing)}}this.Ko=!0}P2(){if(this.Ko){this.Ko=!1;const e=this.rn;if(e.length>0){const t=e[0],i=t.diagram,s=i===null||i.Qa&&!this.qs;this.qs=!1,t.arrangeBundledLinks(e,s),e.length===1&&(t.sr=null,e.length=0)}e.length===0&&(this.Gy.YD(this),this.fk.YD(this))}}}const Pe=class Pe{constructor(e){y(this,"ui");y(this,"di");y(this,"ic");y(this,"sc");y(this,"we");y(this,"xe");y(this,"Vt");y(this,"Oa");y(this,"Ia");y(this,"Ah");y(this,"I2");y(this,"Ko");y(this,"tw");y(this,"hf");y(this,"E2");y(this,"U2");F.Je(this),this.Ah=null,this.I2=null,this.Ko=!0,this.tw=!1,this.ui=1,this.di=1,this.ic=-1,this.sc=-1,this.we=e.width,this.xe=e.height,this.Vt=[],this.Oa=0,this.Ia=0,this.hf=Nt.fv,this.E2=this.hf*2,this.U2=this.hf*2}f1(e){if(e.width<=0||e.height<=0)return;const t=e.x,i=e.y,s=e.x+e.width,n=e.y+e.height;this.ui=Math.floor((t-this.we)/this.we)*this.we,this.di=Math.floor((i-this.xe)/this.xe)*this.xe,this.ic=Math.ceil((s+2*this.we)/this.we)*this.we,this.sc=Math.ceil((n+2*this.xe)/this.xe)*this.xe;const o=1+(Math.ceil((this.ic-this.ui)/this.we)|0),a=1+(Math.ceil((this.sc-this.di)/this.xe)|0);if(this.Vt.length===0||this.Oa<o-1||this.Ia<a-1){const l=[];for(let h=0;h<=o;h++)l[h]=new Uint32Array(a);this.Vt=l,this.Oa=o-1,this.Ia=a-1}this.XE(Pe.IC)}get bounds(){return new Y(this.ui,this.di,this.ic-this.ui,this.sc-this.di)}get cellWidth(){return this.we}set cellWidth(e){e>0&&e!==this.we&&(this.we=e,this.f1(this.bounds))}get cellHeight(){return this.xe}set cellHeight(e){e>0&&e!==this.xe&&(this.xe=e,this.f1(this.bounds))}ng(e,t){return this.ui<=e&&e<=this.ic&&this.di<=t&&t<=this.sc}bo(e,t){if(!this.ng(e,t))return Pe.IC;e-=this.ui,e/=this.we,t-=this.di,t/=this.xe;const i=e|0,s=t|0;return this.Vt[i][s]}vO(e,t,i,s){if(!this.ng(e,t))return;const n=(e-this.ui)/this.we|0,o=(t-this.di)/this.xe|0,a=(e+i-this.ui)/this.we|0,l=(t+s-this.di)/this.xe|0,h=Math.min(a,this.Oa),d=Math.min(l,this.Ia);for(let f=n;f<=h;f++){const m=this.Vt[f];if(m.fill)m.fill(Pe.ln,o,d+1);else for(let p=o;p<=d;p++)m[p]=Pe.ln}}XE(e){for(let t=0;t<=this.Oa;t++){const i=this.Vt[t];if(i.fill)i.fill(e);else for(let s=0;s<=this.Ia;s++)i[s]=e}}TT(){for(let e=0;e<=this.Oa;e++){const t=this.Vt[e];for(let i=0;i<=this.Ia;i++)t[i]>=Pe.nc&&(t[i]=Pe.IC)}}GE(e,t){return this.bo(e,t)===Pe.ln}isUnoccupied(e,t,i,s){if(e>this.ic||e+i<this.ui||t>this.sc||t+s<this.di)return!0;let n=(e-this.ui)/this.we|0,o=(t-this.di)/this.xe|0,a=Math.max(0,i)/this.we+1|0,l=Math.max(0,s)/this.xe+1|0;if(n<0&&(a+=n,n=0),o<0&&(l+=o,o=0),a<0||l<0)return!0;const h=Math.min(n+a-1,this.Oa)|0,d=Math.min(o+l-1,this.Ia)|0;for(let f=n;f<=h;f++){const m=this.Vt[f];for(let p=o;p<=d;p++)if(m[p]===Pe.ln)return!1}return!0}maxAvoidsLinksSpaceH(e,t,i,s){if(e>this.ic||t<this.ui||i>this.sc||i<this.di)return 0;const n=(e-this.ui)/this.we|0,o=(t-this.ui)/this.we|0,a=(i-this.di)/this.xe|0,l=s/this.xe+1|0;let h;for(h=0;h<l/2;h++){let d=!1;for(let f=n;f<=o;f++)if(this.Vt[f][a+h]===Pe.ln||this.Vt[f][a-h]===Pe.ln){d=!0;break}if(d)return Math.max(0,(2*h-1)*this.xe)}return s}maxAvoidsLinksSpaceV(e,t,i,s){if(e>this.sc||t<this.di||i>this.ic||i<this.ui)return 0;const n=(e-this.di)/this.xe|0,o=(t-this.di)/this.xe|0,a=(i-this.ui)/this.we|0,l=s/this.we+1|0;let h;for(h=0;h<l/2;h++){let d=!1;for(let f=n;f<=o;f++)if(this.Vt[a+h][f]===Pe.ln||this.Vt[a-h][f]===Pe.ln){d=!0;break}if(d)return Math.max(0,(2*h-1)*this.we)}return s}YE(e,t,i,s,n,o,a,l){e=e|0,t=t|0;let h=this.Vt[e][t];if(h>=Pe.nc&&h<Pe.sg)for(s?t+=i:e+=i,h+=1;n<=e&&e<=o&&a<=t&&t<=l;){const d=this.Vt[e][t];if(h>=d)break;this.Vt[e][t]=h,h+=1,s?t+=i:e+=i}return s?t:e}ko(e,t,i,s,n,o,a,l){if(e<n||e>o||t<a||t>l)return;const h=this.YE(e,t,i,s,n,o,a,l);if(s)if(i>0)for(let d=t+i;d<h;d+=i)this.ko(e,d,1,!s,n,o,a,l),this.ko(e,d,-1,!s,n,o,a,l);else for(let d=t+i;d>h;d+=i)this.ko(e,d,1,!s,n,o,a,l),this.ko(e,d,-1,!s,n,o,a,l);else if(i>0)for(let d=e+i;d<h;d+=i)this.ko(d,t,1,!s,n,o,a,l),this.ko(d,t,-1,!s,n,o,a,l);else for(let d=e+i;d>h;d+=i)this.ko(d,t,1,!s,n,o,a,l),this.ko(d,t,-1,!s,n,o,a,l)}Pk(e,t,i,s,n,o,a,l,h,d){let f=e|0,m=t|0,p=Pe.ln,b=Pe.nc;for(this.Vt[f][m]=b;p===Pe.ln&&f>a&&f<l&&m>h&&m<d;)b+=1,this.Vt[f][m]=b,o?m+=n:f+=n,p=this.Vt[f][m];return o?m:f}Sk(e,t,i,s,n,o,a,l,h,d){let f=i|0,m=s|0,p=Pe.ln;const b=Pe.sg;for(this.Vt[f][m]=b;p===Pe.ln&&f>a&&f<l&&m>h&&m<d;)this.Vt[f][m]=b,o?m+=n:f+=n,p=this.Vt[f][m]}yv(e,t,i,s,n,o){this.tw=!1;let a=e.x,l=e.y;if(!this.ng(a,l))return;a-=this.ui,a/=this.we,l-=this.di,l/=this.xe;let h=i.x,d=i.y;if(!this.ng(h,d))return;if(h-=this.ui,h/=this.we,d-=this.di,d/=this.xe,Math.abs(a-h)<=1&&Math.abs(l-d)<=1){this.tw=!0;return}let f=n.x,m=n.y,p=n.x+n.width,b=n.y+n.height;f-=this.ui,f/=this.we,m-=this.di,m/=this.xe,p-=this.ui,p/=this.we,b-=this.di,b/=this.xe;const x=Math.max(0,Math.min(this.Oa,f|0)),v=Math.min(this.Oa,Math.max(0,p|0)),S=Math.max(0,Math.min(this.Ia,m|0)),P=Math.min(this.Ia,Math.max(0,b|0)),T=0,A=90,C=270,O=this.Vt,R=a|0,I=l|0,H=h|0,V=d|0,z=t===T||t===A?1:-1,K=t===A||t===C;O[R][I]===Pe.ln?(this.Pk(R,I,H,V,z,K,x,v,S,P),this.Pk(R,I,H,V,1,!K,x,v,S,P),this.Pk(R,I,H,V,-1,!K,x,v,S,P)):this.Pk(R,I,H,V,z,K,R,I,R,I),O[H][V]===Pe.ln?(this.Sk(R,I,H,V,s===T||s===A?1:-1,s===A||s===C,x,v,S,P),this.Sk(R,I,H,V,1,!(s===A||s===C),x,v,S,P),this.Sk(R,I,H,V,-1,!(s===A||s===C),x,v,S,P)):this.Sk(R,I,H,V,z,K,H,V,H,V);const $=r.nt();if(o&&this.wv(H,V,s,R,I,$)){($[0]!==H||$[1]!==V)&&($.unshift(V),$.unshift(H)),($[$.length-2]!==R||$[$.length-1]!==I)&&($.push(R),$.push(I));let q=Pe.nc,J=$[$.length-2],ot=$[$.length-1];O[J][ot]=q++;for(let rt=$.length-4;rt>=0;rt-=2){J=$[rt+2],ot=$[rt+3];const st=$[rt],ht=$[rt+1];for(;st>J?J++:st<J?J--:ht>ot?ot++:ht<ot&&ot--,O[J][ot]=q++,!(J===st&&ot===ht););}}else this.ko(R,I,1,!1,x,v,S,P),this.ko(R,I,-1,!1,x,v,S,P),this.ko(R,I,1,!0,x,v,S,P),this.ko(R,I,-1,!0,x,v,S,P);r.Z($)}wv(e,t,i,s,n,o){const a=this.Vt;let l=e,h=t;for(;;){if(l===s&&h===n)return!0;let d=l,f=h;if(i===0)if(d<s)d++;else break;else if(i===90)if(f<n)f++;else break;else if(i===180)if(d>s)d--;else break;else if(f>n)f--;else break;const m=a[d][f];if(m===0||m===Pe.EC)break;l=d,h=f}for(;;){let d=i,f=l,m=h;i===0?m<n?(d=90,m++):m>n&&(d=270,m--):i===90?f<s?(d=0,f++):f>s&&(d=180,f--):i===180?m<n?(d=90,m++):m>n&&(d=270,m--):f<s?(d=0,f++):f>s&&(d=180,f--);const p=a[f][m];if(d!==i&&p!==0&&p!==Pe.EC){if(o.push(l),o.push(h),this.wv(l,h,d,s,n,o))return!0;o.pop(),o.pop()}if(a[l][h]=Pe.EC,i===0){if(l===e)return!1;l--}else if(i===90){if(h===t)return!1;h--}else if(i===180){if(l===e)return!1;l++}else{if(h===t)return!1;h++}}}};y(Pe,"ln",0),y(Pe,"nc",1),y(Pe,"sg",999999),y(Pe,"IC",Pe.sg+1),y(Pe,"EC",Pe.sg+2);let Zs=Pe;class ch{constructor(e,t){y(this,"Ri");y(this,"kl");y(this,"Ei");y(this,"og");F.Je(this),this.Ri=e,this.kl=t,this.Ei=[],this.og=!1}toString(){const e=this.Ei;let t=this.Ri.toString()+" "+e.length.toString()+":";for(let i=0;i<e.length;i++){const s=e[i];s!==null&&(t+=`
  `+s.toString())}return t}KE(e,t,i,s){const n=t.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const a=Math.atan2(e.height,e.width)*180/Math.PI;switch(n){case 3:return o>a&&o<=180+a?180:270;case 5:return o>180-a&&o<=360-a?270:0;case 12:return o>a&&o<=180+a?90:0;case 10:return o>180-a&&o<=360-a?180:90;case 7:return o>90&&o<=180+a?180:o>180+a&&o<=360-a?270:0;case 13:return o>180&&o<=360-a?270:o>a&&o<=180?90:0;case 14:return o>a&&o<=180-a?90:o>180-a&&o<=270?180:0;case 11:return o>180-a&&o<=180+a?180:o>180+a?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>a&&o<180-a?90:o>=180-a&&o<=180+a?180:o>180+a&&o<360-a?270:0}Jd(){this.Ei.length=0}dv(e){let t=this.Ei;t.length===0&&(this.HE(),t=this.Ei);for(let i=0;i<t.length;i++){const s=t[i];if(s!==null&&s.es===e)return s}return null}HE(){if(!this.og){const e=this.og;this.og=!0;let t,i=null;const s=this.Ri,n=s instanceof Ft?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.og=e,this.Ei;i=n,t=i.findExternalLinksConnected()}else s.isTreeExpanded?t=s.findLinksConnected(this.kl.portId):t=s.findExternalTreeLinksConnected();this.Ei.length=0;let o=0;const a=this.kl.getDocumentPoint(X.TopLeft,L.l()),l=this.kl.getDocumentPoint(X.BottomRight,L.l()),h=Y.z(a.x,a.y,0,0);h.unionPoint(l),L.i(a),L.i(l);const d=L.z(h.x+h.width/2,h.y+h.height/2),f=this.kl.getDocumentAngle(),m=t.iterator;for(;m.next();){const v=m.value;if(!v.isVisible()||v.fromPort===v.toPort)continue;const S=v.fromPort===this.kl||i!==null&&v.fromNode!==null&&v.fromNode.isMemberOf(i),P=v.computeSpot(S,this.kl);if(!P.isSide())continue;let T;if(S?T=v.toPort:T=v.fromPort,T===null)continue;let A=T.part;if(A===null)continue;const C=A.findVisibleNode();C!==null&&C!==A&&(A=C,T=A.port);const O=v.computeOtherPoint(A,T);let R=d.directionPoint(O);f!==0&&(R=B.Ee(R-f));const I=this.KE(h,P,R,v.isOrthogonal);let H=0;I===0?(H=4,R>180&&(R-=360)):I===90?(H=8,R>270&&(R-=360)):I===180?H=2:(H=1,R<90&&(R+=360));let V=this.Ei[o];V===void 0?(V=new Kp(v,R,H),this.Ei[o]=V):(V.es=v,V.Xt=R,V.fi=H),V.Mk.h(O),o++}L.i(d),this.jE();const p=this.Ei.length;let b=-1,x=0;for(o=0;o<p;o++){const v=this.Ei[o];v!==void 0&&(v.fi!==b&&(b=v.fi,x=0),v.rg=x,x++)}for(b=-1,x=0,o=p-1;o>=0;o--){const v=this.Ei[o];v!==void 0&&(v.fi!==b&&(b=v.fi,x=v.rg+1),v.Kf=x)}this.qE(this.Ei),this.WE(this.Ei),this.og=e,Y.i(h)}return this.Ei}JE(e,t){return e===t?0:e===null?-1:t===null?1:e.fi<t.fi?-1:e.fi>t.fi?1:e.Xt<t.Xt?-1:e.Xt>t.Xt?1:0}jE(){this.Ei.sort(ch.prototype.JE)}qE(e){const t=this.kl,i=this.Ri.portSpreading,s=L.l(),n=L.l(),o=L.l(),a=L.l();t.getDocumentPoint(X.TopLeft,s),t.getDocumentPoint(X.TopRight,n),t.getDocumentPoint(X.BottomRight,o),t.getDocumentPoint(X.BottomLeft,a);let l=0,h=0,d=0,f=0;if(i===2)for(let T=0;T<e.length;T++){const A=e[T];if(A===null)continue;const C=A.es.computeThickness();switch(A.fi){case 8:d+=C;break;case 2:f+=C;break;case 1:l+=C;break;default:case 4:h+=C;break}}let m=0,p=0,b=1,x=n,v=o,S=0,P=0;for(let T=0;T<e.length;T++){const A=e[T];if(A===null)continue;if(m!==A.fi){switch(m=A.fi,m){case 8:x=o,v=a;break;case 2:x=a,v=s;break;case 1:x=s,v=n;break;default:case 4:x=n,v=o;break}switch(S=v.x-x.x,P=v.y-x.y,m){case 8:d>Math.abs(S)?(b=Math.abs(S)/d,d=Math.abs(S)):b=1;break;case 2:f>Math.abs(P)?(b=Math.abs(P)/f,f=Math.abs(P)):b=1;break;case 1:l>Math.abs(S)?(b=Math.abs(S)/l,l=Math.abs(S)):b=1;break;default:case 4:h>Math.abs(P)?(b=Math.abs(P)/h,h=Math.abs(P)):b=1;break}p=0}const C=A.tc;if(i===2){let O=A.es.computeThickness();switch(O*=b,C.h(x),m){case 8:C.x=x.x+S/2+d/2-p-O/2;break;case 2:C.y=x.y+P/2+f/2-p-O/2;break;case 1:C.x=x.x+S/2-l/2+p+O/2;break;default:case 4:C.y=x.y+P/2-h/2+p+O/2;break}p+=O}else{let O=.5;i===1&&(O=(A.rg+1)/(A.Kf+1)),C.x=x.x+S*O,C.y=x.y+P*O}}L.i(s),L.i(n),L.i(o),L.i(a)}WE(e){for(let t=0;t<e.length;t++){const i=e[t];i!==null&&(i.bk=this.$E(i,t))}}$E(e,t){const i=e.es,s=i.fromPort===this.kl;let n=0;switch(e.fi){case 1:n=270;break;case 2:n=180;break;case 4:n=0;break;case 8:n=90;break}const o=i.wk(this.Ri,this.kl,X.None,s,n);let a=e.rg;if(a<0)return o;const l=e.Kf;if(l<=1||!i.isOrthogonal)return o;const h=e.Mk,d=e.tc,f=e.fi===2||e.fi===8;f&&(a=l-1-a);const m=Nt.tv,p=e.fi===2||e.fi===4,b=a<=0?d:this.Ei[f?t+1:t-1].tc,x=a>=l-1?d:this.Ei[f?t-1:t+1].tc;return(p?h.y>=b.y&&h.y<=x.y:h.x>=b.x&&h.x<=x.x)?o:(p?h.y<d.y:h.x<d.x)?o+a*m:o+(l-1-a)*m}}class Kp{constructor(e,t,i){y(this,"es");y(this,"Xt");y(this,"fi");y(this,"Mk");y(this,"rg");y(this,"Kf");y(this,"tc");y(this,"bk");this.es=e,this.Xt=t,this.fi=i,this.Mk=new L,this.rg=0,this.Kf=0,this.tc=new L,this.bk=0}toString(){return this.es.toString()+" "+this.Xt.toString()+" "+this.fi.toString()+":"+this.rg.toString()+"/"+this.Kf.toString()+" "+this.tc.toString()+" "+this.bk.toString()+" "+this.Mk.toString()}}class fa{constructor(){y(this,"Dh");y(this,"vh");y(this,"Fh");y(this,"Rh");y(this,"Oh");y(this,"Ih");y(this,"c0");y(this,"a0");y(this,"f0");y(this,"h0");this.Dh=X.Default,this.vh=X.Default,this.Fh=NaN,this.Rh=NaN,this.Oh=NaN,this.Ih=NaN,this.c0=null,this.a0=null,this.f0=1/0,this.h0=1/0}copy(){const e=new fa;return e.Dh=this.Dh.N(),e.vh=this.vh.N(),e.Fh=this.Fh,e.Rh=this.Rh,e.Oh=this.Oh,e.Ih=this.Ih,e.c0=this.c0,e.a0=this.a0,e.f0=this.f0,e.h0=this.h0,e}}class xn{constructor(){y(this,"t0");y(this,"e0");y(this,"i0");y(this,"_p");y(this,"j0");y(this,"q0");this.t0=-1/0,this.e0=0,this.i0=L.gn,this._p=0,this.j0="None",this.q0="None"}copy(){const e=new xn;return e.t0=this.t0,e.e0=this.e0,e.i0=this.i0.N(),e._p=this._p,e.j0=this.j0,e.q0=this.q0,e}}class Ft extends wt{constructor(t,i){let s;t===void 0||t instanceof le||typeof t=="string"?s=t:t&&(i=t);super(s);y(this,"lg");y(this,"Dt");y(this,"Ch");y(this,"Fp");y(this,"he");y(this,"li");this.E=this.E|4608,this.lg=new F,this.Dt=null,this.li=new bi,this.li.group=this,this.Ch=new F,this.Fp=null,this.he=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),this.E=this.E&-32769;const i=t.findInVisualTree(s=>s instanceof Ui);i instanceof Ui?t.Dt=i:t.Dt=null,this.li!==null?(t.li=this.li.copy(),t.li.group=t):(t.li!==null&&(t.li.group=null),t.li=null),this.he!==null&&(t.he=this.he.copy())}jo(t){super.jo(t);const i=t.findSubGraphParts(),s=t.memberParts;for(;s.next();){const n=s.value;if(n.c(),n.invalidateLayout(8),n.clearAdornments(),n instanceof wt)n.invalidateConnectedLinks(i);else if(n instanceof Nt){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(i)}}}gf(t,i,s,n,o,a,l){if(t===3&&i==="elements"){if(o instanceof Ui)this.Dt===null?this.Dt=o:this.Dt!==o&&r.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(o instanceof Lt){const h=o.findInVisualTree(d=>d instanceof Ui);h instanceof Ui&&(this.Dt===null?this.Dt=h:this.Dt!==h&&r.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&i==="elements"&&this.Dt!==null&&(n===this.Dt?this.Dt=null:n instanceof Lt&&this.Dt.isContainedBy(n)&&(this.Dt=null));super.gf(t,i,s,n,o,a,l)}kd(t,i){if(super.kd(t,i),this.isClipping&&this.type!==Lt.Spot&&this.isSubGraphExpanded){let s=this.resizeObject;s instanceof Lt&&(s=s.findMainElement()),this.he===null&&(this.he=new Y),s.getDocumentBounds(this.he),s instanceof Xt&&this.he.inflate(-s.strokeWidth,-s.strokeWidth)}}Pa(t,i,s,n){this.hasPlaceholder()&&(this.er=this.placeholder),super.Pa(t,i,s,n)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}_r(){if(!super._r())return!1;const t=this.memberParts;for(;t.next();){const i=t.value;if(i instanceof wt){if(!i.isVisible())continue;if(i.as())return!1}else if(i instanceof Nt){if(!i.isVisible())continue;if(i.as()&&i.fromNode!==this&&i.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Dt}get computesBoundsAfterDrag(){return(this.E&2048)!==0}set computesBoundsAfterDrag(t){const i=(this.E&2048)!==0;i!==t&&(this.E=this.E^2048,this.t("computesBoundsAfterDrag",i,t))}get computesBoundsIncludingLinks(){return(this.E&4096)!==0}set computesBoundsIncludingLinks(t){const i=(this.E&4096)!==0;i!==t&&(this.E=this.E^4096,this.t("computesBoundsIncludingLinks",i,t))}get computesBoundsIncludingLocation(){return(this.E&8192)!==0}set computesBoundsIncludingLocation(t){const i=(this.E&8192)!==0;i!==t&&(this.E=this.E^8192,this.t("computesBoundsIncludingLocation",i,t))}get handlesDragDropForMembers(){return(this.E&16384)!==0}set handlesDragDropForMembers(t){const i=(this.E&16384)!==0;i!==t&&(this.E=this.E^16384,this.t("handlesDragDropForMembers",i,t))}get avoidableMembers(){return(this.E&131072)!==0}set avoidableMembers(t){const i=(this.E&131072)!==0;i!==t&&(this.E=this.E^131072,this.t("avoidableMembers",i,t))}get memberParts(){return this.lg.iterator}uC(t){if(this.lg.add(t)){t instanceof Ft&&this.Ch.add(t);const s=this.memberAdded;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.G,o.G=!0),s(this,t),o!==null&&(o.G=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!1)}if(t instanceof Nt&&!this.computesBoundsIncludingLinks)return;let i=this.Dt;i===null&&(i=this),i.c()}fC(t){if(this.lg.delete(t)){t instanceof Ft&&this.Ch.delete(t);const s=this.memberRemoved;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.G,o.G=!0),s(this,t),o!==null&&(o.G=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!0)}if(t instanceof Nt&&!this.computesBoundsIncludingLinks)return;let i=this.Dt;i===null&&(i=this),i.c()}lf(){if(this.lg.count>0){const t=this.diagram;if(t!==null){const i=this.lg.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}super.lf()}get layout(){return this.li}set layout(t){const i=this.li;if(i!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&r.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),i!==null&&(i.diagram=null,i.group=null),this.li=t;const s=this.diagram;t!==null&&(t.diagram=s,t.group=this),s!==null&&(s.$r=!0),this.t("layout",i,t),s!==null&&s.requestUpdate()}}get memberAdded(){return this.vt!==null?this.vt.Wy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(t!==null&&r.S(t,Ft,"memberAdded"),this.wl().Wy=t,this.t("memberAdded",i,t))}get memberRemoved(){return this.vt!==null?this.vt.Jy:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(t!==null&&r.S(t,Ft,"memberRemoved"),this.wl().Jy=t,this.t("memberRemoved",i,t))}get memberValidation(){return this.vt!==null?this.vt.da:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(t!==null&&r.S(t,Ft,"memberValidation"),this.wl().da=t,this.t("memberValidation",i,t))}canAddMembers(t){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.wN(t).iterator;for(;n.next();){const o=n.value;if(!s.isValidMember(this,o))return!1}return!0}addMembers(t,i){const s=this.diagram;if(s===null)return!1;const n=s.commandHandler,o=n.wN(t);let a=!0;const l=o.iterator;for(;l.next();){const h=l.value;!i||n.isValidMember(this,h)?h.containingGroup=this:a=!1}return a}get ungroupable(){return(this.E&256)!==0}set ungroupable(t){const i=(this.E&256)!==0;i!==t&&(this.E=this.E^256,this.t("ungroupable",i,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const i=t.diagram;return!(i!==null&&!i.allowUngroup)}invalidateConnectedLinks(t){const i=this.ZE();if(super.invalidateConnectedLinks(t),i)return;this.cT(!0);const s=this.findExternalLinksConnected();for(;s.next();){const n=s.value;if(t!==void 0&&t.has(n))continue;const o=n.fromNode;if(o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible())o.Ze(n.fromPort),o.Ze(n.toPort),n.$t();else{const a=n.toNode;a!==null&&a!==this&&a.isMemberOf(this)&&!a.isVisible()&&(a.Ze(n.fromPort),a.Ze(n.toPort),n.$t())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.u2;if(t&&this.Fp!==null)return this.Fp.iterator;const i=this.findSubGraphParts();i.add(this);const s=new F,n=i.iterator;for(;n.next();){const o=n.value;if(!(o instanceof wt))continue;const a=o.linksConnected;for(;a.next();){const l=a.value;i.has(l)||s.add(l)}}return t&&(this.Fp=s),s.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const i=new F,s=t.iterator;for(;s.next();){const n=s.value;if(!(n instanceof wt))continue;const o=n.linksConnected;for(;o.next();){const a=o.value,l=a.fromNode;l!==null&&(!t.has(l)||l===this)&&i.add(l);const h=a.toNode;h!==null&&(!t.has(h)||h===this)&&i.add(h)}}return i.iterator}XU(){function t(s,n){s!==null&&(n.add(s),t(s.containingGroup,n))}const i=new F;return t(this,i),i}findSubGraphParts(){const t=new F;return _t.ga(t,this,!0,0,!0),t.delete(this),t}Xe(t){super.Xe(t);const i=this.memberParts;for(;i.next();)i.value.Xe(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.xv(i,t,this),t.isCollapsingExpanding=!1}xv(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Xe(!1),o instanceof Ft&&o.isSubGraphExpanded&&(o.wasSubGraphExpanded=o.isSubGraphExpanded,o.xv(t,i,s)),o instanceof wt)o.invalidateConnectedLinks(t),i.Kc(o,s);else if(o instanceof Nt){const a=o.labelNodes;for(;a.next();)a.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.bv(i,t,this),t.isCollapsingExpanding=!1}bv(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Xe(!0),o instanceof Ft&&o.wasSubGraphExpanded&&(o.wasSubGraphExpanded=!1,o.bv(t,i,s)),o instanceof wt)o.invalidateConnectedLinks(t);else if(o instanceof Nt){const a=o.labelNodes;for(;a.next();)a.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.E&512)!==0}set isSubGraphExpanded(t){const i=(this.E&512)!==0;if(i!==t){this.E=this.E^512;const s=this.diagram;this.t("isSubGraphExpanded",i,t);const n=this.subGraphExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.G,s.G=!0),n(this),s!==null&&(s.G=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Dt!==null&&this.Dt.c(),this.memberParts.each(o=>o.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.E&1024)!==0}set wasSubGraphExpanded(t){const i=(this.E&1024)!==0;i!==t&&(this.E=this.E^1024,this.t("wasSubGraphExpanded",i,t))}get subGraphExpandedChanged(){return this.vt!==null?this.vt.$y:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(t!==null&&r.S(t,Ft,"subGraphExpandedChanged"),this.wl().$y=t,this.t("subGraphExpandedChanged",i,t))}move(t,i){i===void 0&&(i=!1);const s=i?this.location:this.position,n=s.x,o=s.y,a=t.x,l=t.y;if((n===a||isNaN(n)&&isNaN(a))&&(o===l||isNaN(o)&&isNaN(l)))return;const h=a-(isNaN(n)?0:n),d=l-(isNaN(o)?0:o),f=L.l();super.move(t,i);const m=new F,p=this.findSubGraphParts().iterator;for(;p.next();){const b=p.value;b instanceof Nt&&(b.suspendsRouting&&m.add(b),!(!b.Fi&&(b.fromNode===this||b.toNode===this))&&(b.suspendsRouting=!0))}for(p.reset();p.next();){const b=p.value;if(b.Ar()||b instanceof wt&&b.isLinkLabel)continue;const x=b.position,v=b.location;x.isReal()?(f.x=x.x+h,f.y=x.y+d,b.position=f):v.isReal()&&(f.x=v.x+h,f.y=v.y+d,b.location=f)}for(p.reset();p.next();){const b=p.value;if(!(b instanceof Nt)||(b.suspendsRouting=m.has(b),!b.Fi&&(b.fromNode===this||b.toNode===this)))continue;const x=b.position;f.x=x.x+h,f.y=x.y+d,f.isReal()?b.move(f):b.$t()}L.i(f)}ZE(){return(this.E&65536)!==0}cT(t){(this.E&65536)!==0!==t&&(this.E=this.E^65536)}get Lh(){return(this.E&32768)!==0}set Lh(t){(this.E&32768)!==0!==t&&(this.E=this.E^32768)}}class Ui extends Ht{constructor(t){super();y(this,"Qt");y(this,"ag");this.Qt=ct.im,this.ag=new Y(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Qt=this.Qt.N(),t.ag=this.ag.copy()}ka(t){if(this.background===null)return!1;const i=this.naturalBounds;return Y.contains(0,0,i.width,i.height,t.x,t.y)}bd(t,i,s,n){const o=this.part;if((o===null||!(o instanceof Ft)&&!(o instanceof Jt))&&r.o("Placeholder is not inside a Group or Adornment."),o instanceof Ft){const a=this.computeBorder(this.ag),l=this.minSize,h=isFinite(l.width)?Math.max(l.width,a.width):a.width,d=isFinite(l.height)?Math.max(l.height,a.height):a.height,f=this.Ke;f.jn(h||0,d||0),this.lo(0,0,f.width,f.height);const m=o.memberParts;let p=!1;for(;m.next();)if(m.value.isVisible()){p=!0;break}const b=o.diagram;if(p&&b!==null&&!b.animationManager.CM(o)&&!isNaN(a.x)&&!isNaN(a.y)){const x=L.l();x.setRectSpot(a,o.locationSpot),o.location=x,L.i(x)}}else{const a=o,l=this.Ke,h=this.Qt,d=h.left+h.right,f=h.top+h.bottom,m=a.adornedObject,p=m.getDocumentAngle();a.angle=p;let b=0;m instanceof Xt&&(b=m.strokeWidth);const x=m.getDocumentScale(),v=m.naturalBounds,S=(v.width+b)*x,P=(v.height+b)*x;if(a.type!==Lt.Link){const T=a.category==="Selection"?X.TopLeft:a.locationSpot,A=m.getDocumentPoint(T,L.l());a.location=A,L.i(A)}if(!isNaN(S)&&!isNaN(P))l.jn(S+d||0,P+f||0),this.lo(-h.left,-h.top,l.width,l.height);else{const T=m.getDocumentPoint(X.TopLeft,L.l()),A=Y.z(T.x,T.y,0,0);A.unionPoint(m.getDocumentPoint(X.BottomRight,T)),A.unionPoint(m.getDocumentPoint(X.TopRight,T)),A.unionPoint(m.getDocumentPoint(X.BottomLeft,T)),l.jn(A.width+d||0,A.height+f||0),this.lo(-h.left,-h.top,l.width,l.height),L.i(T),Y.i(A)}}}Pa(t,i,s,n){this.actualBounds.e(t,i,s,n)}computeBorder(t){const i=this.part,s=i.diagram;if(s===null||s.animationManager.isAnimating)return t;if(i instanceof Ft&&!i.layer.isTemporary&&i.computesBoundsAfterDrag&&this.ag.isReal()){const l=s.toolManager.findTool("Dragging");if(l===s.currentTool&&l.mR(i,this.ag,t))return t}const n=Y.l(),o=this.computeMemberBounds(n),a=this.Qt;return i instanceof Ft&&!i.isSubGraphExpanded?t.e(o.x-a.left,o.y-a.top,0,0):t.e(o.x-a.left,o.y-a.top,Math.max(o.width+a.left+a.right,0),Math.max(o.height+a.top+a.bottom,0)),Y.i(n),i instanceof Ft&&i.computesBoundsIncludingLocation&&i.location.isReal()&&t.unionPoint(i.location),t}computeMemberBounds(t){if(!(this.part instanceof Ft))return t.e(0,0,0,0),t;const i=this.part;let s=1/0,n=1/0,o=-1/0,a=-1/0;const l=i.memberParts;for(;l.next();){const h=l.value;if(!h.isVisible()||h instanceof Nt&&(!i.computesBoundsIncludingLinks||h.Go()||h.fromNode===i||h.toNode===i))continue;const d=h.actualBounds;d.left<s&&(s=d.left),d.top<n&&(n=d.top),d.right>o&&(o=d.right),d.bottom>a&&(a=d.bottom)}if(!isFinite(s)||!isFinite(n)){const h=i.location;t.e(h.x,h.y,0,0)}else t.e(s,n,o-s,a-n);return t}get padding(){return this.Qt}set padding(t){typeof t=="number"&&(t=new ct(t));const i=this.Qt;i.equals(t)||(t=t.N(),this.Qt=t,this.t("padding",i,t),this.c())}}class bi{constructor(e){y(this,"a");y(this,"Ah");y(this,"hg");y(this,"Tr");y(this,"cg");y(this,"fg");y(this,"Vo");y(this,"Pl");y(this,"ug");y(this,"dg");y(this,"Po");F.Je(this),this.a=null,this.Ah=null,this.hg=!0,this.Tr=!0,this.cg=!1,this.fg=new L(0,0),this.Vo=!0,this.Pl=null,this.ug=null,this.dg=!1,this.Po=null,e&&Object.assign(this,e)}cloneProtected(e){e.hg=this.hg,e.Tr=this.Tr,e.cg=this.cg,e.fg.h(this.fg),e.Vo=this.Vo,e.Pl=this.Pl,e.ug=this.ug,e.dg=!0}copy(){const e=new this.constructor;return this.cloneProtected(e),e}fe(e){}toString(){let e=r.Hn(this.constructor);return e+="(",this.group!==null&&(e+=" in "+this.group),this.diagram!==null&&(e+=" for "+this.diagram),e+=")",e}get diagram(){return this.a}set diagram(e){this.a=e}get group(){return this.Ah}set group(e){this.Ah!==e&&(this.Ah=e,e!==null&&(this.a=e.diagram))}get isOngoing(){return this.hg}set isOngoing(e){this.hg!==e&&(r.s(e,"boolean",bi,"isOngoing"),this.hg=e)}get isInitial(){return this.Tr}set isInitial(e){r.s(e,"boolean",bi,"isInitial"),this.Tr=e,e||(this.dg=!0)}get isViewportSized(){return this.cg}set isViewportSized(e){this.cg!==e&&(r.s(e,"boolean",bi,"isViewportSized"),this.cg=e,e&&this.p())}get isRouting(){return this.Vo}set isRouting(e){this.Vo!==e&&(r.s(e,"boolean",bi,"isRouting"),this.Vo=e)}get isRealtime(){return this.Pl}set isRealtime(e){this.Pl!==e&&(e!==null&&r.s(e,"boolean",bi,"isRealtime"),this.Pl=e)}get isValidLayout(){return this.dg}set isValidLayout(e){if(this.dg!==e&&(r.s(e,"boolean",bi,"isValidLayout"),this.dg=e,!e)){const t=this.diagram;t!==null&&(t.$r=!0)}}invalidateLayout(){if(!this.isValidLayout)return;const e=this.diagram;if(e===null||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;t.isTicking||(t.defaultAnimation.isAnimating&&t.stopAnimation(),(this.isOngoing&&e.Qa||this.isInitial&&!e.Qa)&&(this.isValidLayout=!1,e.requestUpdate()))}p(){this.invalidateLayout()}get network(){return this.Po}set network(e){this.Po!==e&&(this.Po=e,e!==null&&(e.layout=this))}createNetwork(){return new vn(this)}makeNetwork(e){const t=this.createNetwork();return e instanceof qt?(t.addParts(e.nodes,!0),t.addParts(e.links,!0)):e instanceof Ft?t.addParts(e.memberParts):t.addParts(e.iterator),t}updateParts(){this.isValidLayout=!0;let e=this.diagram;if(e===null&&this.network!==null){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value.node;if(i!==null&&(e=i.diagram,e!==null))break}}try{e!==null&&e.startTransaction("Layout"),this.commitLayout()}finally{e!==null&&e.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const e=this.network.vertexes.iterator;for(;e.next();)e.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(e){const t=new F;if(e instanceof qt?(this.Ea(t,e.nodes,!0,this.Lh,!0,!1,!0),this.Ea(t,e.parts,!0,this.Lh,!0,!1,!0)):e instanceof Ft?this.Ea(t,e.memberParts,!1,this.Lh,!0,!1,!0):t.addAll(e.iterator),t.count>0){const i=this.diagram;i!==null&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(t),i!==null&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(e){const t=e.count,i=Math.ceil(Math.sqrt(t));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,a=n,l=0,h=0;const d=e.iterator;for(;d.next();){const f=d.value;f.ensureBounds();const m=f.measuredBounds,p=m.width,b=m.height;f.moveTo(o,a),f instanceof Ft&&(f.Lh=!1),o+=Math.max(p,50)+20,h=Math.max(h,Math.max(b,50)),l>=i-1?(l=0,o=s,a+=h+20,h=0):l++}}Lh(e){return!!(!e.location.isReal()&&!e.position.isReal()||e instanceof Ft&&e.Lh)}Ea(e,t,i,s,n,o,a){const l=t.iterator;for(;l.next();){const h=l.value;if(!(i&&!h.isTopLevel)&&!(s!==null&&!s(h))&&h.canLayout())if(n&&h instanceof wt){if(h.isLinkLabel)continue;h instanceof Ft&&h.layout===null?this.Ea(e,h.memberParts,!1,s,n,o,a):(h.ensureBounds(),e.add(h))}else o&&h instanceof Nt?e.add(h):a&&h.Di()&&!(h instanceof wt)&&(h.ensureBounds(),e.add(h))}}getLayoutBounds(e,t){const i=this.boundsComputation;return i!==null?(t||(t=new Y),i(e,this,t)):!t&&e.margin.equalTo(0,0,0,0)?e.actualBounds:(t||(t=new Y),t.set(e.actualBounds),t.addMargin(e.margin),t)}get boundsComputation(){return this.ug}set boundsComputation(e){this.ug!==e&&(e!==null&&r.S(e,bi,"boundsComputation"),this.ug=e,this.p())}collectParts(e){const t=new F;return e instanceof qt?(this.Ea(t,e.nodes,!0,null,!0,!0,!0),this.Ea(t,e.links,!0,null,!0,!0,!0),this.Ea(t,e.parts,!0,null,!0,!0,!0)):e instanceof Ft?this.Ea(t,e.memberParts,!1,null,!0,!0,!0):this.Ea(t,e.iterator,!1,null,!0,!0,!0),t}get arrangementOrigin(){return this.fg}set arrangementOrigin(e){this.fg.equals(e)||(this.fg.h(e),this.p())}initialOrigin(e){const t=this.group;if(t!==null)if(t.hasPlaceholder()){const i=t.placeholder,s=i.getDocumentPoint(X.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(e);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=t.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(e),i}return e}}class vn{constructor(e){y(this,"li");y(this,"So");y(this,"In");y(this,"ew");y(this,"iw");F.Je(this),this.li=e,this.So=new F,this.In=new F,this.ew=new nt,this.iw=new nt}clear(){if(this.So){const e=this.So.iterator;for(;e.next();)e.value.clear()}if(this.In){const e=this.In.iterator;for(;e.next();)e.value.clear()}this.So=new F,this.In=new F,this.ew=new nt,this.iw=new nt}toString(e){e===void 0&&(e=0);let t="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(e<=0)return t;if(t+=" vertexes: "+this.So.count+" edges: "+this.In.count,e>1){const i=this.So.iterator;for(;i.next();){const n=i.value;t+=`
    `+n.toString(e-1)}const s=this.In.iterator;for(;s.next();){const n=s.value;t+=`
    `+n.toString(e-1)}}return t}get layout(){return this.li}set layout(e){e!==null&&(this.li=e)}get vertexes(){return this.So}get edges(){return this.In}createVertex(){return new kn(this)}createEdge(){return new ko(this)}addParts(e,t,i){if(e===null)return;t===void 0&&(t=!1),r.s(t,"boolean",vn,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof wt)return!n.isLinkLabel;if(n instanceof Nt){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const a=n.toNode;return!(a===null||a.isLinkLabel)}return!1});const s=e.iterator;for(;s.next();){const n=s.value;if(n instanceof wt&&!(t&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof Ft&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof Nt)||t&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,a=n.toNode;if(o===null||a===null||o===a)continue;const l=this.findGroupVertex(o),h=this.findGroupVertex(a);this.linkVertexes(l,h,n)}}findGroupVertex(e){const t=e.findVisibleNode();if(t===null)return null;let i=this.findVertex(t);if(i!==null)return i;let s=t.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(e){this.So.add(e);const t=e.node;t!==null&&this.ew.set(t,e),e.network=this}addNode(e){let t=this.findVertex(e);return t===null&&(t=this.createVertex(),t.node=e,this.addVertex(t)),t}deleteVertex(e){if(this.kv(e)){let t=e.nr;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}t=e.or;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}}}kv(e){const t=this.So.delete(e);if(t){const i=e.node;i!==null&&this.ew.delete(i)}return t}deleteNode(e){const t=this.findVertex(e);t!==null&&this.deleteVertex(t)}findVertex(e){return this.ew.get(e)}addEdge(e){this.UC(e);const t=e.toVertex;t!==null&&t.addSourceEdge(e);const i=e.fromVertex;i!==null&&i.addDestinationEdge(e)}UC(e){this.In.add(e);const t=e.link;t!==null&&this.findEdge(t)===null&&this.iw.set(t,e),e.network=this}addLink(e){const t=e.fromNode,i=e.toNode;let s=this.findEdge(e);return s===null?(s=this.createEdge(),s.link=e,t!==null&&(s.fromVertex=this.addNode(t)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(t!==null?s.fromVertex=this.addNode(t):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(e){const t=e.toVertex;t!==null&&t.deleteSourceEdge(e);const i=e.fromVertex;i!==null&&i.deleteDestinationEdge(e),this.VC(e)}VC(e){const t=this.In.delete(e);if(t){const i=e.link;i!==null&&this.iw.delete(i)}return t}deleteLink(e){const t=this.findEdge(e);t!==null&&this.deleteEdge(t)}findEdge(e){return this.iw.get(e)}linkVertexes(e,t,i){if(e===null||t===null)return null;if(e.network===this&&t.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=e,s.toVertex=t,this.addEdge(s),s}return null}reverseEdge(e){const t=e.fromVertex,i=e.toVertex;t===null||i===null||(t.deleteDestinationEdge(e),i.deleteSourceEdge(e),e.reverseEdge(),t.addSourceEdge(e),i.addDestinationEdge(e))}deleteSelfEdges(){const e=r.nt(),t=this.In.iterator;for(;t.next();){const s=t.value;s.fromVertex===s.toVertex&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);r.Z(e)}deleteArtificialVertexes(){const e=r.nt(),t=this.So.iterator;for(;t.next();){const o=t.value;o.node===null&&o.data===null&&e.push(o)}let i=e.length;for(let o=0;o<i;o++)this.deleteVertex(e[o]);const s=r.nt(),n=this.In.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);r.Z(e),r.Z(s)}deleteUselessEdges(){const e=r.nt(),t=this.In.iterator;for(;t.next();){const s=t.value;(s.fromVertex===null||s.toVertex===null)&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);r.Z(e)}isSingleton(e){return!(e.nr.count>0||e.or.count>0)}splitIntoSubNetworks(e){e===void 0&&(e=!0),e&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const t=new E;let i=!0;for(;i;){i=!1;const s=this.So.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();t.add(o),this.QE(o,n),i=!0;break}}return t.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),t}QE(e,t){if(t===null)return;const i=new E;for(i.add(t);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===e)continue;this.kv(s),e.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==e&&(this.VC(o),e.UC(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==e&&(this.VC(o),e.UC(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const e=new F,t=this.So.iterator;for(;t.next();){const s=t.value;s.node&&e.add(s.node)}const i=this.In.iterator;for(;i.next();){const s=i.value;s.link&&e.add(s.link)}return e}}class kn{constructor(e){y(this,"Po");y(this,"te");y(this,"Ri");y(this,"Ui");y(this,"is");y(this,"nr");y(this,"or");F.Je(this),this.Po=e,this.Ui=new Y(0,0,10,10),this.is=new L(5,5),this.te=null,this.Ri=null,this.nr=new E,this.or=new E}clear(){this.te=null,this.Ri=null,this.nr=new E,this.or=new E}toString(e){e===void 0&&(e=0);let t="LayoutVertex#"+F.xs(this);if(e>0&&(t+=this.node!==null?"("+this.node.toString()+")":"",e>1)){let i="",s=!0,n=this.nr.iterator;for(;n.next();){const a=n.value;s?s=!1:i+=",",i+=a.toString(0)}let o="";for(s=!0,n=this.or.iterator;n.next();){const a=n.value;s?s=!1:o+=",",o+=a.toString(0)}t+=" sources: "+i+" destinations: "+o}return t}get Mo(){return this.nr.AL}get rr(){return this.or.AL}get data(){return this.te}set data(e){if(this.te=e,e!==null&&e.bounds){const t=e.bounds,i=t.x,s=t.y,n=t.width,o=t.height;this.is.e(n/2,o/2),this.Ui.e(i,s,n,o)}}get node(){return this.Ri}set node(e){if(this.Ri!==e){if(this.Ri=e,e===null)return;e.ensureBounds();const t=this.network.layout,i=Y.l(),s=t.getLayoutBounds(e,i);let n=s.x,o=s.y;const a=s.width,l=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ui.e(n,o,a,l),Y.i(i),!(e instanceof Ft)){const h=e.locationObject.getDocumentPoint(X.Center);if(h.isReal()){this.is.e(h.x-n,h.y-o);return}}this.is.e(a/2,l/2)}}get bounds(){return this.Ui}set bounds(e){this.Ui.equals(e)||this.Ui.h(e)}get focus(){return this.is}set focus(e){this.is.equals(e)||this.is.h(e)}get centerX(){return this.Ui.x+this.is.x}set centerX(e){const t=this.Ui;t.x+this.is.x!==e&&(t.x=e-this.is.x)}get centerY(){return this.Ui.y+this.is.y}set centerY(e){const t=this.Ui;t.y+this.is.y!==e&&(t.y=e-this.is.y)}get focusX(){return this.is.x}set focusX(e){const t=this.is;t.x!==e&&(t.x=e)}get focusY(){return this.is.y}set focusY(e){const t=this.is;t.y!==e&&(t.y=e)}get x(){return this.Ui.x}set x(e){const t=this.Ui;t.x!==e&&(t.x=e)}get y(){return this.Ui.y}set y(e){const t=this.Ui;t.y!==e&&(t.y=e)}get width(){return this.Ui.width}set width(e){const t=this.Ui;t.width!==e&&(t.width=e)}get height(){return this.Ui.height}set height(e){const t=this.Ui;t.height!==e&&(t.height=e)}commit(){const e=this.te;if(e!==null){const i=this.bounds,s=e.bounds;r.$(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):e.bounds=i.copy();return}const t=this.node;if(t!==null){const i=this.bounds;if(!(t instanceof Ft)){const s=Y.l();t.ensureBounds();const n=this.network.layout.getLayoutBounds(t,s),o=t.locationObject.getDocumentPoint(X.Center);if(n.isReal()&&o.isReal()){t.moveTo(i.x+this.focusX-(o.x-n.x)+t.margin.left,i.y+this.focusY-(o.y-n.y+t.margin.top)),Y.i(s);return}Y.i(s)}t.moveTo(i.x+t.margin.left,i.y+t.margin.top)}}addSourceEdge(e){e!==null&&(this.nr.has(e)||this.nr.add(e))}deleteSourceEdge(e){e!==null&&this.nr.delete(e)}addDestinationEdge(e){e!==null&&(this.or.has(e)||this.or.add(e))}deleteDestinationEdge(e){e!==null&&this.or.delete(e)}get network(){return this.Po}set network(e){this.Po=e}get sourceVertexes(){const e=new F,t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}return e.iterator}get destinationVertexes(){const e=new F,t=this.destinationEdges;for(;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get vertexes(){const e=new F;let t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}for(t=this.destinationEdges;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get sourceEdges(){return this.nr.iterator}get destinationEdges(){return this.or.iterator}get edges(){const e=new E;let t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i)}for(t=this.destinationEdges;t.next();){const i=t.value;e.add(i)}return e.iterator}get edgesCount(){return this.nr.count+this.or.count}static standardComparer(e,t){const i=e.Ri,s=t.Ri;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(e,t){if(e!==null)if(t!==null){const i=e.Ri,s=t.Ri;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),a=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),l=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let h=0;for(;h<a.length;h++)if(l[h]!==""&&l[h]!==void 0){const d=parseFloat(a[h]),f=parseFloat(l[h]);if(isNaN(d))if(isNaN(f)){if(a[h].localeCompare(l[h])!==0)return a[h].localeCompare(l[h]);continue}else return 1;else{if(isNaN(f))return-1;if(d-f!==0)return d-f;continue}}else{if(a[h]==="")continue;return 1}return l[h]!==""&&l[h]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return t!==null?-1:0}}class ko{constructor(e){y(this,"Po");y(this,"te");y(this,"es");y(this,"ss");y(this,"ns");F.Je(this),this.Po=e,this.te=null,this.es=null,this.ss=null,this.ns=null}clear(){this.te=null,this.es=null,this.ss=null,this.ns=null}toString(e){e===void 0&&(e=0);let t="LayoutEdge#"+F.xs(this);return e>0&&(t+=this.es!==null?"("+this.es.toString()+")":"",e>1&&(t+=" "+(this.ss?this.ss.toString():"null")+" --> "+(this.ns?this.ns.toString():"null"))),t}reverseEdge(){const e=this.ss;this.ss=this.ns,this.ns=e}commit(){}getOtherVertex(e){return this.ns===e?this.ss:this.ss===e?this.ns:null}get network(){return this.Po}set network(e){this.Po=e}get data(){return this.te}set data(e){this.te!==e&&(this.te=e)}get link(){return this.es}set link(e){this.es!==e&&(this.es=e)}get fromVertex(){return this.ss}set fromVertex(e){this.ss!==e&&(this.ss=e)}get toVertex(){return this.ns}set toVertex(e){this.ns!==e&&(this.ns=e)}}var uh=(M=>(M[M.Position=0]="Position",M[M.Location=1]="Location",M))(uh||{}),dh=(M=>(M[M.LeftToRight=10]="LeftToRight",M[M.RightToLeft=11]="RightToLeft",M))(dh||{}),fh=(M=>(M[M.Forwards=20]="Forwards",M[M.Reverse=21]="Reverse",M[M.Ascending=22]="Ascending",M[M.Descending=23]="Descending",M))(fh||{});const Ss=class Ss extends bi{constructor(t){super();y(this,"gg");y(this,"mg");y(this,"Oo");y(this,"En");y(this,"de");y(this,"He");y(this,"Si");y(this,"Mi");this.isViewportSized=!0,this.gg=NaN,this.mg=NaN,this.Oo=new _(NaN,NaN).k(),this.En=new _(10,10).k(),this.de=1,this.He=10,this.Si=22,this.Mi=Ss.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.Oo.h(this.Oo),t.En.h(this.En),t.de=this.de,t.He=this.He,t.Si=this.Si,t.Mi=this.Mi}fe(t){t in fh?this.sorting=t:t in dh?this.arrangement=t:t in uh?this.alignment=t:super.fe(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),s=this.diagram,n=i.copy().iterator;for(;n.next();){const x=n.value;if(x.Ar()&&(x.fromNode!==null||x.toNode!==null)){i.delete(x);continue}if(x.ensureBounds(),x instanceof Ft){const v=x.memberParts;for(;v.next();){const S=v.value;i.delete(S)}}}const o=i.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let a=this.wrappingColumn;isNaN(a)&&(a=0);let l=this.wrappingWidth;if(isNaN(l)&&s!==null){const x=s.viewportBounds,v=s.padding;l=Math.max(x.width-v.left-v.right,0)}else l=Math.max(this.wrappingWidth,0);a<=0&&l<=0&&(a=1);let h=this.spacing.width;isFinite(h)||(h=0);let d=this.spacing.height;isFinite(d)||(d=0),s!==null&&s.startTransaction("Layout");const f=[];switch(this.alignment){case 0:this._E(o,l,a,h,d,f);break;case 1:this.t3(o,l,a,h,d,f);break}let m=0,p=0,b=0;for(let x=0;x<f.length;x++){const v=f[x];m=Math.min(m,v.x),p=Math.min(p,v.y),b=Math.max(b,v.x+v.width)}this.arrangement===11?this.commitLayers(f,new L(m+h/2-(b+m),p-d/2)):this.commitLayers(f,new L(m-h/2,p-d/2)),s!==null&&s.commitTransaction("Layout"),this.isValidLayout=!0}_E(t,i,s,n,o,a){const l=Y.l();let h=Math.max(this.cellSize.width,1);if(!isFinite(h)){h=0;for(let P=0;P<t.length;P++){const T=t[P],A=this.getLayoutBounds(T,l);h=Math.max(h,A.width)}}h+=n,h=Math.max(h,1);let d=Math.max(this.cellSize.height,1);if(!isFinite(d)){d=0;for(let P=0;P<t.length;P++){const T=t[P],A=this.getLayoutBounds(T,l);d=Math.max(d,A.height)}}d+=o,d=Math.max(d,1);const f=this.arrangement,m=this.arrangementOrigin.x,p=this.arrangementOrigin.y;let b=m,x=p,v=0,S=0;for(let P=0;P<t.length;P++){const T=t[P],A=this.getLayoutBounds(T,l),C=Math.ceil((A.width+n)/h),O=Math.ceil((A.height+o)/d),R=C*h,I=O*d;let H=0;switch(f){case 11:H=Math.abs(b-A.width);break;default:H=b+A.width;break}(s>0&&v>s-1||i>0&&v>0&&H-m>i)&&(a.push(new Y(0,x,i+n,S)),v=0,b=m,x+=S,S=0),S=Math.max(S,I);let V=0;switch(f){case 11:V=-A.width;break;default:V=0;break}switch(T.moveTo(b+V+T.margin.left,x+T.margin.top),f){case 11:b-=R;break;default:b+=R;break}v++}a.push(new Y(0,x,i+n,S)),Y.i(l)}t3(t,i,s,n,o,a){const l=Y.l();let h=Math.max(this.cellSize.width,1),d=0,f=0,m=0;const p=L.l();for(let V=0;V<t.length;V++){const z=t[V],K=this.getLayoutBounds(z,l),$=z.getRelativePoint(z.locationObject,z.locationSpot,p);d=Math.max(d,$.x),f=Math.max(f,K.width-$.x),m=Math.max(m,$.y)}const b=this.arrangement;switch(b){case 11:d+=n;break;default:f+=n;break}isFinite(h)?h=Math.max(h+n,1):h=Math.max(d+f,1);const x=this.arrangementOrigin.x,v=this.arrangementOrigin.y;let S=x,P=v,T=0;i>=d&&(i-=d);let A=0,C=0;const O=Math.max(this.cellSize.height,1);m=0;let R=0,I=!0;const H=L.l();for(let V=0;V<t.length;V++){const z=t[V],K=this.getLayoutBounds(z,l),$=z.getRelativePoint(z.locationObject,z.locationSpot,p);if(T>0)switch(b){case 11:{let J=(S-x-(K.width-$.x))/h;B.X(Math.round(J),J)?J=Math.round(J):J=Math.floor(J),S=J*h+x;break}default:{let J=(S-x+$.x)/h;B.X(Math.round(J),J)?J=Math.round(J):J=Math.ceil(J),S=J*h+x;break}}else switch(b){case 11:A=S+$.x+K.width;break;default:A=S-$.x;break}let q=0;switch(b){case 11:q=-(S+$.x)+A;break;default:q=S+K.width-$.x-A;break}if(s>0&&T>s-1||i>0&&T>0&&q>i){a.push(new Y(0,I?P-m:P,i+n,R+m+o));for(let J=0;J<T&&V!==T;J++){const ot=t[V-T+J],rt=ot.getRelativePoint(ot.locationObject,ot.locationSpot,H);ot.moveTo(ot.position.x,ot.position.y+m-rt.y)}R+=o,I?P+=R:P+=R+m,m=0,R=0,T=0,S=x,I=!1}switch(S===x&&(b===11?C=Math.max(C,K.width-$.x):C=Math.min(C,-$.x)),m=Math.max(m,$.y),R=Math.max(R,K.height-$.y),isFinite(O)&&(R=Math.max(R,Math.max(K.height,O)-$.y)),I?z.moveTo(S-$.x,P-$.y):z.moveTo(S-$.x,P),b){case 11:S-=$.x+n;break;default:S+=K.width-$.x+n;break}T++}if(a.push(new Y(0,P,i+n,(I?R:R+m)+o)),t.length!==T)for(let V=0;V<T;V++){const z=t[t.length-T+V],K=z.getRelativePoint(z.locationObject,z.locationSpot,p);z.moveTo(z.position.x,z.position.y+m-K.y)}if(L.i(p),L.i(H),b===11)for(let V=0;V<a.length;V++){const z=a[V];z.width+=C,z.x-=C}else for(let V=0;V<a.length;V++){const z=a[V];z.x>C&&(z.width+=z.x-C,z.x=C)}Y.i(l)}commitLayers(t,i){}get wrappingWidth(){return this.gg}set wrappingWidth(t){this.gg!==t&&(t>0||isNaN(t))&&(this.gg=t,this.isViewportSized=isNaN(t),this.p())}get wrappingColumn(){return this.mg}set wrappingColumn(t){this.mg!==t&&(t>0||isNaN(t))&&(this.mg=t,this.p())}get cellSize(){return this.Oo}set cellSize(t){this.Oo.equals(t)||(this.Oo.h(t),this.p())}get spacing(){return this.En}set spacing(t){this.En.equals(t)||(this.En.h(t),this.p())}get alignment(){return this.de}set alignment(t){this.de!==t&&(t===1||t===0)&&(this.de=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===10||t===11)&&(this.He=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(t===20||t===21||t===22||t===23)&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t,this.p())}static standardComparer(t,i){const s=t.text,n=i.text;return s<n?-1:s>n?1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const s=t.text.toLocaleLowerCase(),n=i.text.toLocaleLowerCase(),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),a=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let l=0;for(;l<o.length;l++)if(a[l]!==""&&a[l]!==void 0){const h=parseFloat(o[l]),d=parseFloat(a[l]);if(isNaN(h))if(isNaN(d)){if(o[l].localeCompare(a[l])!==0)return o[l].localeCompare(a[l]);continue}else return 1;else{if(isNaN(d))return-1;if(h-d!==0)return h-d;continue}}else{if(o[l]==="")continue;return 1}return a[l]!==""&&a[l]!==void 0?-1:0}else return 1;else return i!==null?-1:0}};y(Ss,"Position",0),y(Ss,"Location",1),y(Ss,"LeftToRight",10),y(Ss,"RightToLeft",11),y(Ss,"Forward",20),y(Ss,"Reverse",21),y(Ss,"Ascending",22),y(Ss,"Descending",23);let ga=Ss;const Ps=class Ps{constructor(){y(this,"pg");y(this,"rn");y(this,"Ct");y(this,"No");y(this,"yg");y(this,"wg");y(this,"a");y(this,"BC");this.pg=new F,this.rn=new F,this.Ct=new F,this.No=new nt,this.yg=new nt,this.wg=new nt,this.a=null,this.BC=!1}clear(){this.pg.clear(),this.rn.clear(),this.Ct.clear(),this.No.clear(),this.yg.clear(),this.wg.clear()}Eo(e){this.a=e}ch(e){if(e instanceof wt){if(this.pg.add(e),e instanceof Ft){const i=e.containingGroup;i===null?this.diagram.Zr.add(e):i.Ch.add(e);const s=e.layout;s!==null&&(s.diagram=this.diagram)}}else e instanceof Nt?(this.rn.add(e),e.isAvoiding&&(this.diagram.lp=!0)):e instanceof Jt||this.Ct.add(e);const t=e.data;t!==null&&(e instanceof Jt||(e instanceof Nt?this.Pv(t,e):this.No.set(t,e)))}ri(e){if(e.clearAdornments(),e instanceof wt){if(this.pg.delete(e),e instanceof Ft){const i=e.containingGroup;i===null?this.diagram.Zr.delete(e):i.Ch.delete(e);const s=e.layout;s!==null&&(s.diagram=null)}}else e instanceof Nt?this.rn.delete(e):e instanceof Jt||this.Ct.delete(e);const t=e.data;t!==null&&(e instanceof Jt||(e instanceof Nt?this.Sv(t,e):this.No.delete(t)))}Pv(e,t){this.yg.set(e,t)}Sv(e,t){this.yg.delete(e)}rebuildParts(){const e=this.diagram;if(e===null)return;const t=e.nodeTemplateMap.iterator;for(;t.next();){const p=t.value,b=t.key;(!p.Di()||p instanceof Ft)&&r.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${b}" must be a Node or a simple Part, not a Group or Link: ${p}`)}const i=e.groupTemplateMap.iterator;for(;i.next();){const p=i.value,b=i.key;p instanceof Ft||r.o(`Invalid group template in Diagram.groupTemplateMap: template for "${b}" must be a Group, not a normal Node or Link: ${p}`)}const s=e.linkTemplateMap.iterator;for(;s.next();){const p=s.value,b=s.key;p instanceof Nt||r.o(`Invalid link template in Diagram.linkTemplateMap: template for "${b}" must be a Link, not a normal Node or simple Part: ${p}`)}const n=r.nt(),o=e.selection.iterator;for(;o.next();){const p=o.value.data;p&&n.push(p)}const a=r.nt(),l=e.highlighteds.iterator;for(;l.next();){const p=l.value.data;p&&a.push(p)}const h=r.nt(),d=this.nodes.iterator;for(;d.next();){const p=d.value;p.data!==null&&(h.push(p.data),h.push(p.location))}const f=this.links.iterator;for(;f.next();){const p=f.value;p.data!==null&&(h.push(p.data),h.push(p.location))}const m=this.parts.iterator;for(;m.next();){const p=m.value;p.data!==null&&(h.push(p.data),h.push(p.location))}this.Mv(),this.D2();for(let p=0;p<n.length;p++){const b=this.findPartForData(n[p]);b!==null&&(b.isSelected=!0)}for(let p=0;p<a.length;p++){const b=this.findPartForData(a[p]);b!==null&&(b.isHighlighted=!0)}for(let p=0;p<h.length;p+=2){const b=this.findPartForData(h[p]);b!==null&&(b.location=h[p+1])}r.Z(n),r.Z(a),r.Z(h)}D2(){const e=this.diagram.model;this.nw(e.nodeDataArray)}nw(e,t){const i=this.diagram.model;e.forEach(s=>{i.containsNodeData(s)&&this.Nv(s,!1)}),e.forEach(s=>{i.containsNodeData(s)&&this.Nk(s)}),t!==!1&&this.diagram.c1(!1)}Nv(e,t){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.No.has(e))return null;t===void 0&&(t=!0);const i=this.e3(e);return i!==null&&t&&this.Nk(e),i}e3(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.No.has(e))return null;const t=this.i3(e),i=this.findTemplateForNodeData(e,t);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;return this.diagram.wi=!0,s._o=t,s.te=e,this.addsToTemporaryLayer&&(s.dl="Tool"),this.diagram.add(s),s.te=null,s.data=e,this.diagram.wi=n,s}}return null}insertLink(e,t,i,s){return null}Nk(e){}i3(e){return this.diagram.model.getCategoryForNodeData(e)}findTemplateForNodeData(e,t){const i=this.diagram,s=i.model,n=s.uf()&&s.isGroupForData(e);let o=null;return n?(o=i.groupTemplateMap.get(t),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(Ps.Lv||(Ps.Lv=!0,r.ne('No Group template found for category "'+t+'"'),r.ne("  Using default group template")),o=i.s2))):(o=i.nodeTemplateMap.get(t),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(Ps.Cv||(Ps.Cv=!0,r.ne('No Node template found for category "'+t+'"'),r.ne("  Using default node template")),o=i.t2))),o}getLinkCategoryForData(e){return""}setLinkCategoryForData(e,t){}setFromNodeForLink(e,t,i){}setToNodeForLink(e,t,i){}findLinkTemplateForCategory(e){const t=this.diagram;let i=t.linkTemplateMap.get(e);return i===null&&(i=t.linkTemplateMap.get(""),i===null&&(Ps.Av||(Ps.Av=!0,r.ne('No Link template found for category "'+e+'"'),r.ne("  Using default link template")),i=t.e2)),i}WI(e,t,i){e instanceof Nt?(t!==null&&this.Sv(t,e),i!==null&&this.Pv(i,e)):e instanceof _t&&(t!==null&&this.No.delete(t),i!==null&&this.No.set(i,e))}Mv(){const e=this.diagram.model;this.zC(e.nodeDataArray)}zC(e){e.forEach(t=>{this.Ck(t)})}Ck(e){const t=this.findPartForData(e);t!==null&&(this.diagram.L2(t,!1),this.XC(t))}XC(e){}AC(e){}findPartForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);return t!==null?this.No.get(t):null}findNodeForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);if(t===null)return null;const i=this.No.get(t);return i instanceof wt?i:null}findLinkForKey(e){return null}findPartForData(e){if(e===null)return null;let t=this.No.get(e);return t!==null||(t=this.yg.get(e)),t}findNodeForData(e){if(e===null)return null;const t=this.No.get(e);return t instanceof wt?t:null}findLinkForData(e,t){return e===null?null:this.yg.get(e)}findNodesByExample(...e){const t=new F,i=this.pg.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const a=arguments[o];if(r.$(a)&&this.GC(n,a)){t.add(s);break}}}return t.iterator}findLinksByExample(...e){const t=new F,i=this.rn.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const a=arguments[o];if(r.$(a)&&this.GC(n,a)){t.add(s);break}}}return t.iterator}GC(e,t){for(const i in t){const s=e[i],n=t[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,a=n;if(o.length<a.length)return!1;for(let l=0;l<o.length;l++){const h=o[l],d=a[l];if(d!==void 0&&!this.Tv(h,d))return!1}}else if(!this.Tv(s,n))return!1}return!0}Tv(e,t){if(r.st(t)){if(!t(e))return!1}else if(t instanceof RegExp){if(!e||!t.test(e.toString()))return!1}else if(r.$(e)&&r.$(t)){if(!this.GC(e,t))return!1}else if(e!==t)return!1;return!0}doModelDataChanged(e){if(e.model===this.diagram.model&&this.diagram.G){this.diagram.G=!1;try{const t=e.change;e.modelChange===""&&e.object!==null&&t===2&&this.ow(e.object,e.propertyName)}finally{this.diagram.G=!0}}}doModelChanged(e){const t=this.diagram;if(!t||e.model!==t.model)return;const i=e.change;if(t.LO(e),!!t.G){t.G=!1;try{const s=e.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=e.object;if(n!==null){const o=this.findPartForData(n),a=e.newValue;o!==null&&typeof a=="string"&&(o.category=a)}}else if(s==="nodeDataArray"){const n=e.oldValue;this.zC(n);const o=e.newValue;this.nw(o)}t.isModified=!0}else if(i===3){const n=e.newValue;s==="nodeDataArray"&&r.$(n)&&this.Nv(n),t.isModified=!0}else if(i===4){const n=e.oldValue;s==="nodeDataArray"&&r.$(n)&&this.Ck(n),t.isModified=!0}else i===1&&(s==="SourceChanged"?e.object!==null?this.ow(e.object,e.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=e.propertyName,o=e.object,a=t.model;o===a?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()):o!==null&&this.ow(o,n),t.isModified=!0}else(i===3||i===4)&&(this.s3(e,t.model),t.isModified=!0)}finally{t.G=!0}}}updateAllTargetBindings(e){e===void 0&&(e="");let t=this.parts.iterator;for(;t.next();)t.value.updateTargetBindings(e);for(t=this.nodes.iterator;t.next();)t.value.updateTargetBindings(e);for(t=this.links.iterator;t.next();)t.value.updateTargetBindings(e)}updateAllThemeBindings(){let e=this.parts.iterator;for(;e.next();)e.value.Yo();for(e=this.nodes.iterator;e.next();)e.value.Yo();for(e=this.links.iterator;e.next();)e.value.Yo()}updateAllRelationshipsFromData(){const e=this.diagram.model,t=new F,i=e.nodeDataArray;for(let o=0;o<i.length;o++){const a=i[o];t.add(a)}const s=[];this.nodes.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),s.forEach(o=>e.Dv(o,!1));for(let o=0;o<i.length;o++){const a=i[o];this.findPartForData(a)===null&&e.vv(a,!1)}this.Fv();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}Fv(){}updateRelationshipsFromData(e){}ow(e,t){if(typeof t=="string"){const i=this.findPartForData(e);if(i!==null)i.updateTargetBindings(t);else{const s=this.o3(e);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(t);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(t)}r.Z(s)}}e===this.diagram.model.modelData&&this.updateAllTargetBindings(t)}}o3(e){let t=null;const i=this.wg.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const o=s[n].findItemPanelForData(e);o!==null&&(t===null&&(t=r.nt()),t.push(o))}if(t!==null)break}return t}YC(e){return this.wg.get(e)}s3(e,t){const i=e.object;if(!Array.isArray(i))return;const s=e.change===3,n=s?e.newParam:e.oldParam,o=s?e.newValue:e.oldValue,a=this.YC(i);if(Array.isArray(a))for(let l=0;l<a.length;l++){const h=a[l];s?h.Q1(o,n,!0):h.ZI(n)}}N2(e,t){t!==null&&e.Sn(s=>t.uT(s));const i=e.Aa;if(Array.isArray(i)){const s=this.YC(i);if(s===null)this.wg.set(i,[e]);else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}}C2(e,t){e.Sn(s=>t.TO(s));const i=e.Aa;if(Array.isArray(i)){const s=this.YC(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&this.wg.delete(i);return}}}}copyParts(e,t,i){i===void 0&&(i=!1);const s=new nt;if(Array.isArray(e))for(let o=0;o<e.length;o++)this.Lk(e[o],t,s,i);else{const o=e.iterator;for(;o.next();)this.Lk(o.value,t,s,i)}if(t!==null){const o=t.model,a=t.Tp().dragsLink,l=new F,h=new nt,d=s.iterator;for(;d.next();){const f=d.value;if(f instanceof Nt)!a&&(f.fromNode===null||f.toNode===null)&&l.add(f);else if(f instanceof wt&&f.data!==null){if(o.Vm()){const m=f,p=d.key,b=p.findTreeParentNode();if(b!==null){const x=s.get(b);if(x!==null){o.setParentKeyForNodeData(m.data,o.getKeyForNodeData(x.data));const v=t.findLinkForData(m.data),S=p.findTreeParentLink();S!==null&&v!==null&&h.set(S,v)}}}else if(o.a1()){const m=f,p=d.key,b=o.isRelatedKeysPathTo?p.findNodesOutOf():p.findNodesInto();for(;b.next();){const x=b.value,v=s.get(x);if(v!==null){o.addRelatedKeyForNodeData(m.data,v.key);const S=t.partManager.findLinkForData(m.data,v.key),P=this.findLinkForData(p.data,x.key);P!==null&&S!==null&&h.set(P,S)}else o.removeRelatedKeyForNodeData(m.data,x.key)}}}}if(l.count>0&&t.removeParts(l,!1),h.count>0){const f=h.iterator;for(;f.next();){const m=f.key,p=f.value;s.set(m,p)}}}if(t!==null&&this.diagram!==null){const o=t.model,a=o.afterCopyFunction;if(a!==null){const l=new nt;s.each(d=>{d.key.data!==null&&l.set(d.key.data,d.value.data)});const h=this.diagram.model;a(l,o,h)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}Lk(e,t,i,s){if(e===null||s&&!e.canCopy())return null;if(i.has(e))return i.get(e);const n=this.KC(e,t);if(!(n instanceof _t))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(e,n),e instanceof wt){const o=e.linksConnected;for(;o.next();){const a=o.value;if(a.fromNode===e){const l=i.get(a);l!==null&&(l.fromNode=n)}if(a.toNode===e){const l=i.get(a);l!==null&&(l.toNode=n)}}if(e instanceof Ft&&n instanceof Ft){const a=e.memberParts;for(;a.next();){const l=a.value,h=this.Lk(l,t,i,s);h instanceof Nt||h!==null&&(h.containingGroup=n)}}}else if(e instanceof Nt&&n instanceof Nt){const o=e.fromNode;if(o!==null){const h=i.get(o);h!==null&&(n.fromNode=h)}const a=e.toNode;if(a!==null){const h=i.get(a);h!==null&&(n.toNode=h)}const l=e.labelNodes;for(;l.next();){const h=l.value,d=this.Lk(h,t,i,s);d!==null&&d instanceof wt&&(d.labeledLink=n)}}return n}KC(e,t){let i=null;const s=e.data;if(s!==null&&t!==null){const n=t.model;if(!(e instanceof Nt)){const o=n.copyNodeData(s);n.addNodeData(o),i=t.findPartForData(o)}}else if(e.It(),i=e.copy(),i!==null){const n=this.diagram;if(t!==null)t.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let a=null;i instanceof Nt||(a=o.copyNodeData(s)),i.data=a}}return i}get nodes(){return this.pg}get links(){return this.rn}get parts(){return this.Ct}get diagram(){return this.a}get addsToTemporaryLayer(){return this.BC}set addsToTemporaryLayer(e){this.BC=e}};y(Ps,"Cv",!1),y(Ps,"Lv",!1),y(Ps,"Av",!1);let Xn=Ps;class Gp extends Xn{D2(){const e=this.diagram.model;this.nw(e.nodeDataArray),this.Rv(e.linkDataArray)}nw(e){super.nw(e,!1);const t=this.links.iterator;for(;t.next();)t.value.Wd();this.diagram.c1(!1)}Rv(e){e.forEach(t=>{this.Ov(t)}),this.diagram.c1(!1)}Ov(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(e))return null;const t=this.getLinkCategoryForData(e),i=this.findLinkTemplateForCategory(t);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;this.diagram.wi=!0,s._o=t,s.te=e;const o=this.diagram.model,a=o.Ak(e,!0);a!==""&&(s.fromPortId=a);const l=o.Vi(e,!0);if(l!==void 0){const m=this.findNodeForKey(l);m instanceof wt&&(s.fromNode=m)}const h=o.Ak(e,!1);h!==""&&(s.toPortId=h);const d=o.Vi(e,!1);if(d!==void 0){const m=this.findNodeForKey(d);m instanceof wt&&(s.toNode=m)}const f=o.getLabelKeysForLinkData(e);return Array.isArray(f)&&f.forEach(m=>{const p=this.findNodeForKey(m);p!==null&&(p.labeledLink=s)}),this.addsToTemporaryLayer&&(s.dl="Tool"),this.diagram.add(s),s.te=null,s.data=e,this.diagram.wi=n,s}}return null}Mv(){const e=this.diagram.model;this.Iv(e.linkDataArray),this.zC(e.nodeDataArray)}Iv(e){e.forEach(t=>{this.Ck(t)})}getLinkCategoryForData(e){return this.diagram.model.getCategoryForLinkData(e)}setLinkCategoryForData(e,t){return this.diagram.model.setCategoryForLinkData(e,t)}setFromNodeForLink(e,t,i){const s=this.diagram.model,n=t!==null?t.data:null;s.setFromKeyForLinkData(e.data,s.getKeyForNodeData(n))}setToNodeForLink(e,t,i){const s=this.diagram.model,n=t!==null?t.data:null;s.setToKeyForLinkData(e.data,s.getKeyForNodeData(n))}AC(e){this.diagram.model.removeLinkData(e.data)}findPartForKey(e){const t=super.findPartForKey(e);if(t===null){const i=this.diagram.model.findLinkDataForKey(e);if(i!==null)return this.findLinkForData(i)}return t}findLinkForKey(e){if(e==null)return null;const t=this.diagram.model.findLinkDataForKey(e);return t!==null?this.findLinkForData(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.G){t.G=!1;try{const s=e.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const a=e.newValue,l=this.findNodeForKey(a);o.fromNode=l}}else if(s==="linkToKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const a=e.newValue,l=this.findNodeForKey(a);o.toNode=l}}else if(s==="linkFromPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const a=e.newValue;typeof a=="string"&&(o.fromPortId=a)}}else if(s==="linkToPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const a=e.newValue;typeof a=="string"&&(o.toPortId=a)}}else if(s==="nodeGroupKey"){const n=e.object,o=this.findPartForData(n);if(o!==null){const a=e.newValue;if(a!==void 0){const l=this.findNodeForKey(a);l instanceof Ft?o.containingGroup=l:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const a=e.oldValue,l=e.newValue;Array.isArray(a)&&a.forEach(h=>{if(l.indexOf(h)>=0)return;const d=this.findNodeForKey(h);d!==null&&(d.labeledLink=null)}),Array.isArray(l)&&l.forEach(h=>{const d=this.findNodeForKey(h);d!==null&&(d.labeledLink=o)})}}else if(s==="linkCategory"){const n=e.object,o=this.findLinkForData(n),a=e.newValue;o!==null&&typeof a=="string"&&(o.category=a)}else if(s==="linkDataArray"){const n=e.oldValue;this.Iv(n);const o=e.newValue;this.Rv(o)}t.isModified=!0}else if(i===3){const n=e.newValue;if(s==="linkDataArray"&&r.$(n))this.Ov(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=e.object,a=this.findLinkForData(o),l=this.findNodeForKey(n);a!==null&&l!==null&&(l.labeledLink=a)}t.isModified=!0}else if(i===4){const n=e.oldValue;if(s==="linkDataArray"&&r.$(n))this.Ck(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}t.isModified=!0}}else if(i===2){const n=e.propertyName,o=e.object,a=t.model;o===a&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0}}finally{t.G=!0}}}Fv(){const e=this.diagram.model,t=new Set,i=e.linkDataArray;i.forEach(n=>{t.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!t.has(n.data)&&s.push(n.data)}),s.forEach(n=>{e.Ev(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&e.Uv(n,!1)})}updateRelationshipsFromData(e){const t=e.data;if(t===null)return;const i=e.diagram;if(i===null)return;const s=i.model;if(e instanceof Nt){let n=s.Vi(t,!0),o=i.findNodeForKey(n);e.fromNode=o,n=s.Vi(t,!1),o=i.findNodeForKey(n),e.toNode=o;const a=s.getLabelKeysForLinkData(t);if(a.length>0||e.labelNodes.count>0){if(a.length===1&&e.labelNodes.count===1){const m=a[0],p=e.labelNodes.first();if(p!==null&&s.getKeyForNodeData(p.data)===m)return}const l=new F().addAll(a),h=new F;e.labelNodes.each(m=>{if(m.data!==null){const p=s.getKeyForNodeData(m.data);p!==void 0&&h.add(p)}});const d=h.copy();d.removeAll(l);const f=l.copy();if(f.removeAll(h),d.count>0||f.count>0){const m=e;d.each(p=>{const b=i.findNodeForKey(p);b!==null&&b.labeledLink===m&&(b.labeledLink=null)}),f.each(p=>{const b=i.findNodeForKey(p);b!==null&&b.labeledLink!==m&&(b.labeledLink=m)})}}}else if(!(e instanceof Jt)){const n=s.getGroupKeyForNodeData(t),o=i.findPartForKey(n);(o===null||o instanceof Ft)&&(e.containingGroup=o)}}Nk(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(i!==void 0){const s=t.lw(i),n=this.findPartForData(e);if(s!==null&&n!==null){const a=s.iterator;for(;a.next();){const l=a.value;if(t.containsNodeData(l)){if(n instanceof Ft&&t.getGroupKeyForNodeData(l)===i){const h=this.findPartForData(l);h!==null&&(h.containingGroup=n)}}else{const h=this.findLinkForData(l);if(h!==null&&n instanceof wt){t.Vi(l,!0)===i&&(h.fromNode=n),t.Vi(l,!1)===i&&(h.toNode=n);const d=t.getLabelKeysForLinkData(l);Array.isArray(d)&&d.some(f=>f===i?(n.labeledLink=h,!0):!1)}}}t.an(i)}const o=t.getGroupKeyForNodeData(e);if(o!==void 0){const a=this.findNodeForKey(o);n!==null&&a instanceof Ft&&(n.containingGroup=a)}}}XC(e){const t=this.diagram.model;if(e instanceof wt){const i=t.getKeyForNodeData(e.data);if(i!==void 0){const s=e.linksConnected;for(;s.next();){const n=s.value;t.hn(i,n.data)}if(e.isLinkLabel){const n=e.labeledLink;n!==null&&t.hn(i,n.data)}if(e instanceof Ft){const n=e.memberParts;for(;n.next();){const o=n.value.data;t.containsNodeData(o)&&t.hn(i,o)}}}}}KC(e,t){let i=super.KC(e,t);if(e instanceof Nt){const s=e.data;if(s!==null&&t!==null){const n=t.model,o=n.copyLinkData(s);n.addLinkData(o),i=t.findLinkForData(o)}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);i.data=o}}}return i}insertLink(e,t,i,s){const n=this.diagram,o=n.model,a=n.toolManager.findTool("Linking");let l="";e!==null&&(t===null&&(t=e),l=t.portId,l===null&&(l=""));let h="";i!==null&&(s===null&&(s=i),h=s.portId,h===null&&(h=""));const d=a.archetypeLinkData;if(d instanceof Nt){d.It();const f=d.copy();if(f!==null){f.fromNode=e,f.fromPortId=l,f.toNode=i,f.toPortId=h,n.add(f);const m=a.archetypeLabelNodeData;if(m instanceof wt){m.It();const p=m.copy();p!==null&&(p.labeledLink=f,n.add(p))}return f}}else if(d!==null){const f=o.copyLinkData(d);if(r.$(f)){e!==null&&o.xg(f,o.getKeyForNodeData(e.data),!0),o.bg(f,l,!0),i!==null&&o.xg(f,o.getKeyForNodeData(i.data),!1),o.bg(f,h,!1),o.addLinkData(f);const m=a.archetypeLabelNodeData;if(m!==null&&!(m instanceof wt)){const p=o.copyNodeData(m);o.addNodeData(p);const b=o.getKeyForNodeData(p);b!==void 0&&o.addLabelKeyForLinkData(f,b)}return n.findLinkForData(f)}}return null}}class $p extends Xn{constructor(){super(...arguments);y(this,"Ua",null)}Tk(t,i){if(t===null||i===null||i.findTreeParentLink()!==null)return;const s=this.diagram.toolManager.findTool("Linking");let n=t,o=i;if(this.diagram.isTreePathToChildren){if(s!==null&&s.Vu(n,o,null,!0))return}else if(n=i,o=t,s!==null&&s.Vu(n,o,null,!0))return;const a=this.getLinkCategoryForData(i.data),l=this.findLinkTemplateForCategory(a);if(l!==null){l.It();const h=l.copy();if(h!==null){const d=this.diagram.wi;this.diagram.wi=!0,h._o=a,h.te=i.data,h.fromNode=n,h.toNode=o,this.diagram.add(h),h.te=null,h.data=i.data,this.diagram.wi=d}}}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,i){this.diagram.model.setParentLinkCategoryForNodeData(t,i)}setFromNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren)n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o));else{const a=this.Ua;this.Ua=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const l=t.toNode!==null?t.toNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(l)),this.Ua=a}}setToNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren){const a=this.Ua;this.Ua=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const l=t.fromNode!==null?t.fromNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(l)),this.Ua=a}else n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o))}AC(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.findLinkForData(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const s=t.change;if(i.G){i.G=!1;try{const n=t.modelChange;if(n!==""){if(s===2){if(n==="nodeParentKey"){const o=t.object,a=o?this.findNodeForData(o):null,l=t.newValue,h=this.findNodeForKey(l);if(o&&this.Ua!==null)h!==null&&(this.Ua.data=o,this.Ua.category=this.getLinkCategoryForData(o));else if(a!==null){const d=a.findTreeParentLink();d!==null?h===null?i.remove(d):i.isTreePathToChildren?d.fromNode=h:d.toNode=h:this.Tk(h,a)}}else if(n==="parentLinkCategory"){const o=t.object,a=o?this.findNodeForData(o):null,l=t.newValue;if(a!==null&&typeof l=="string"){const h=a.findTreeParentLink();h!==null&&(h.category=l)}}i.isModified=!0}}else s===2&&(t.object===i.model&&t.propertyName==="nodeParentKeyProperty"&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0)}finally{i.G=!0}}}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const s=t.diagram;if(s===null)return;const n=s.model;if(t instanceof wt){const o=n.getParentKeyForNodeData(i),a=s.findNodeForKey(o),l=t.findTreeParentNode();if(a!==l){const h=t.findTreeParentLink();a!==null?h!==null?s.isTreePathToChildren?h.fromNode=a:h.toNode=a:this.Tk(a,t):h!==null&&s.L2(h,!1)}}}ow(t,i){if(super.ow(t,i),typeof i=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(i)}}Nk(t){const i=this.diagram.model,s=i.getKeyForNodeData(t);if(s!==void 0){const n=i.lw(s),o=this.findPartForData(t);if(n!==null&&o!==null){const l=n.iterator;for(;l.next();){const h=l.value;if(i.containsNodeData(h)&&o instanceof wt&&i.getParentKeyForNodeData(h)===s){const d=this.findNodeForData(h);this.Tk(o,d)}}i.an(s)}const a=i.getParentKeyForNodeData(t);if(a!==void 0&&o instanceof wt){const l=this.findNodeForKey(a);this.Tk(l,o)}}}XC(t){const i=this.diagram.model;if(t instanceof wt){const s=i.getKeyForNodeData(t.data),n=this.findLinkForData(t.data);if(n!==null){n.isSelected=!1,n.isHighlighted=!1;const l=n.layer;if(l!==null){const h=l.ri(-1,n,!1);h>=0&&this.diagram.raiseChangedEvent(4,"parts",l,n,null,h,null);const d=n.layerChanged;d!==null&&d(n,l,null)}}const o=this.diagram.isTreePathToChildren,a=t.linksConnected;for(;a.next();){const l=a.value,h=o?l.toNode:l.fromNode;if(h!==null){const d=h.data;i.containsNodeData(d)&&i.hn(s,d)}}}}insertLink(t,i,s,n){const o=this.diagram.model;let a=t,l=s;if(this.diagram.isTreePathToChildren||(a=s,l=t),a!==null&&l!==null){const h=a.data,d=l.data;return o.setParentKeyForNodeData(d,o.getKeyForNodeData(h)),l.findTreeParentLink()}return null}}var ma=(M=>(M[M.OneWay=1]="OneWay",M[M.TwoWay=2]="TwoWay",M))(ma||{});const Ki=class Ki{constructor(e,t,i,s){y(this,"n");y(this,"HC");y(this,"oc");y(this,"Hf");y(this,"Va");y(this,"jf");y(this,"qf");y(this,"Wf");y(this,"Dk");y(this,"Ti");y(this,"Id");y(this,"vf");F.Je(this),e===void 0?e="":r.s(e,"string",Ki,"constructor:targetprop"),t===void 0?t=e:r.s(t,"string",Ki,"constructor:sourceprop"),i===void 0?i=null:i!==null&&r.S(i,Ki,"constructor:conv"),this.HC=-1,this.Ti=null,this.oc=e,this.Id=0,this.vf=0,this.Hf=null,this.Va=t,this.jf=i,s===void 0?(this.qf=1,this.Wf=null):(this.qf=2,this.Wf=s),this.Dk=new F,this.n=2}copy(){const e=new this.constructor;return this.cloneProtected(e),e}cloneProtected(e){e.oc=this.oc,e.Id=this.Id,e.vf=this.vf,e.Hf=this.Hf,e.Va=this.Va,e.jf=this.jf,e.qf=this.qf,e.Wf=this.Wf,e.n=this.n&-2}static parseEnum(e,t){return r.S(e,Ki,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=r.$a(e,i),s===null)?t:s}}fe(e){e in ma?this.mode=e:r.dr(this,e)}static toString(e){return r.toString(e)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+ma[this.mode]+")"}k(){return this.n=this.n|1,this}get targetId(){return this.HC}set targetId(e){this.f&&r.L(this),this.HC=e}get targetProperty(){return this.oc}set targetProperty(e){this.f&&r.L(this),r.s(e,"string",Ki,"targetProperty"),this.oc=e}get sourceProperty(){return this.Va}set sourceProperty(e){this.f&&r.L(this),r.s(e,"string",Ki,"sourceProperty"),this.Va=e}get f(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get jC(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}xd(){return!1}get sourceName(){return this.Hf}set sourceName(e){this.f&&r.L(this),e!==null&&r.s(e,"string",Ki,"sourceName"),this.Hf=e,e!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.jf}set converter(e){this.f&&r.L(this),e!==null&&r.S(e,Ki,"converter"),this.jf=e}get backConverter(){return this.Wf}set backConverter(e){this.f&&r.L(this),e!==null&&r.S(e,Ki,"backConverter"),this.Wf=e}get mode(){return this.qf}set mode(e){this.f&&r.L(this),this.isToTheme&&e===2&&r.o("Theme Bindings cannot be TwoWay."),this.qf=e}makeTwoWay(e){return this.isToTheme&&r.o("Theme Bindings cannot be TwoWay."),this.mode=2,e&&(r.S(e,Ki,"makeTwoWay"),this.backConverter=e),this}ofObject(e){return this.f&&r.L(this),e===void 0&&(e=""),this.sourceName=e,this}ofModel(){return this.f&&r.L(this),this.n=this.n&-3&-5|8,this.Hf=null,this}WT(e,t){const i=this.sourceName;let s=null;return i===null||i===""?s=e:i==="/"?s=t.part:i==="."?s=t:i===".."?s=t.panel:s=e.findObject(i),s}check(e){const t=this.oc,i=this.Va,s=this.jf;(this.xd()&&s===null&&this.Ba===null&&t===""||s===null&&t==="")&&r.ne("Binding error: target property is the empty string: "+this.toString()),this.xd()&&this.jC&&i===""&&s===null&&this.Ba===null&&r.ne("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),e&&typeof t=="string"&&(!r.st(["setAttribute"])&&t.length>0&&t[0]!=="_"&&!r.jw(e,t)?r.ne("Binding error: undefined target property: "+t+" on "+e.toString()):t==="name"&&e instanceof Ht&&r.ne("Binding error: cannot modify GraphObject.name on "+e.toString()))}updateTarget(e,t,i,s){var h,d;const n=this.Va;if(i!==void 0&&n!==""&&n!==i||this.isToTheme&&e.diagram===null)return;const o=this.oc,a=this.jf;let l=t;if(n!==""&&!this.jC&&(l=Ne.St(t,n)),l!==void 0)if(a===null){if(o!==""){if(this.xd()){const f=(h=e.diagram)==null?void 0:h.themeManager;if(l=this.Vv(f,l,e,o),l===void 0)return}s?s.et(e,o,l):(t instanceof Ht||t instanceof ai)&&Ne.et(e,o,l)}}else try{if(o!==""){let f=a(l,e);if(this.xd()){const m=(d=e.diagram)==null?void 0:d.themeManager;if(f=this.Vv(m,f,e,o),f===void 0)return}s?s.et(e,o,f):(t instanceof Ht||t instanceof ai)&&Ne.et(e,o,f)}else a(l,e)}catch{}}updateSource(e,t,i,s){if(this.qf!==2)return;const n=this.oc;if(i!==void 0&&n!==i)return;const o=this.Va,a=this.Wf,l=s!==null?s.diagram:null,h=l!==null?l.model:null;let d=e;if(n!==""&&(d=Ne.St(e,n)),d!==void 0&&!this.Dk.has(e))try{if(this.Dk.add(e),a===null){if(o!=="")h!==null?h.setDataProperty(t,o,d):(t instanceof Ht||t instanceof ai)&&(t[o]=d);else if(h!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const f=s.itemIndex,m=s.panel.itemArray;h.removeArrayItem(m,f),h.insertArrayItem(m,f,d)}}else try{if(o!==""){const f=a(d,t,h);h!==null?h.setDataProperty(t,o,f):(t instanceof Ht||t instanceof ai)&&(t[o]=f)}else{const f=a(d,t,h);if(f!==void 0&&h!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const m=s.itemIndex,p=s.panel.itemArray;h.removeArrayItem(p,m),h.insertArrayItem(p,m,f)}}}catch{}}finally{this.Dk.delete(e)}}};y(Ki,"OneWay",1),y(Ki,"TwoWay",2);let Qs=Ki;class So extends Qs{constructor(t,i,s,n,o){super(t,i,n);y(this,"aw");y(this,"Ba");y(this,"rc");y(this,"r3",/var\((.*)\)/);s==null&&(s=""),o===void 0&&(o=null),this.aw=s,this.Ba=o,this.rc=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.aw=this.aw,t.Ba=this.Ba,t.rc=this.rc}xd(){return!0}get themeSource(){return this.aw}set themeSource(t){this.f&&r.L(this),t!==null&&r.s(t,"string",So,"themeSource"),this.aw=t,this.rc=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Ba}set themeConverter(t){this.f&&r.L(this),t!==null&&r.S(t,So,"themeConverter"),this.Ba=t}ofData(){return this.f&&r.L(this),this.n=this.n|2,this.Hf=null,this}Vv(t,i,s,n){if(!t||(this.jC&&(i=this.Va),!i&&i!==0))return;let o=this.themeSource;this.rc!==null?o=this.rc:typeof o=="string"&&o.includes(".")&&(this.rc=o.split("."),o=this.rc);let a=t.findValue(i,o,n);if(a===void 0&&r.ne(`Theme warning: ${i} could not be found when setting target property ${n}.`),t.readsCssVariables&&typeof a=="string"&&a.startsWith("var(")){const l=a.match(this.r3);l&&(a=getComputedStyle(c.document.documentElement).getPropertyValue(l[1]))}return r.st(this.Ba)&&(a=this.Ba(a,s)),a}}const re=class re{constructor(e,t){y(this,"Pt");y(this,"kg");y(this,"zo");y(this,"qC");y(this,"Bi");y(this,"be");y(this,"za");y(this,"Jf");y(this,"$f");y(this,"Pg");y(this,"Sg");y(this,"Mg");y(this,"Ng");y(this,"hw");y(this,"lc");y(this,"lr");y(this,"cw");y(this,"Bo");y(this,"vk");if(F.Je(this),this.Pt="",this.kg="",this.zo=!1,this.qC={},this.Bi=[],this.be=new nt,this.za="key",this.Jf=null,this.$f=null,this.Pg=!1,this.Sg=!1,this.Mg=!1,this.Ng=null,this.hw=100,this.lc="category",this.lr=new nt,this.cw=[],this.Bo=!1,this.vk=null,this.undoManager=new Gt,e!==void 0&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){e.Pt=this.Pt,e.kg=this.kg,e.zo=this.zo,e.za=this.za,e.Jf=this.Jf,e.$f=this.$f,e.Pg=this.Pg,e.Sg=this.Sg,e.Mg=this.Mg,e.Ng=this.Ng,e.hw=this.hw,e.lc=this.lc}copy(){const e=new this.constructor;return this.cloneProtected(e),e}clear(){this.Bi=[],this.be.clear(),this.lr.clear(),this.undoManager.clear()}toString(e){if(e===void 0&&(e=0),e>1)return this.toJson();{let t=(this.name!==""?this.name:"")+" Model";if(e>0){t+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+r.toString(o)}}return t}}toIncrementalData(e){e.change!==1&&r.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+e.toString());const t=e.object;if(!e.isTransactionFinished||!(t instanceof Bt))return null;const i=this.Bv(t);return this.WC(t,e.propertyName==="FinishedUndo",i)}WC(e,t,i){const s=this;let n=!1;const o=new F,a=new F,l=new F;e.changes.each(p=>{if(p.model===s){if(p.modelChange==="nodeDataArray")p.change===3?o.add(p.newValue):p.change===4&&l.add(p.oldValue);else if(s.containsNodeData(p.object))p.object!==null&&a.add(p.object);else if(p.change===2&&(s.modelData===p.object||p.propertyName==="modelData"))n=!0;else if(p.object!==null)if(i.has(p.object)){const b=i.get(p.object);b&&b.each(x=>{s.containsNodeData(x)&&a.add(x)})}else{if(p.object instanceof re||s.Wh()&&s.containsLinkData(p.object))return;s.zv(p.object).each(b=>{a.add(b)})}}});const h=new F;o.each(p=>{const b=s.getKeyForNodeData(p);b!==void 0&&h.add(b),t||a.add(p)});const d=new F;l.each(p=>{const b=s.getKeyForNodeData(p);b!==void 0&&d.add(b),t&&a.add(p)});const f=s.cloneDeep(a.toArray());let m=null;return n&&(m===null&&(m={}),m.modelData=this.cloneDeep(this.modelData)),h.count>0&&(m===null&&(m={}),t?m.removedNodeKeys=h.toArray():m.insertedNodeKeys=h.toArray()),f.length>0&&(m===null&&(m={}),m.modifiedNodeData=f),d.count>0&&(m===null&&(m={}),t?m.insertedNodeKeys=d.toArray():m.removedNodeKeys=d.toArray()),m}cloneDeep(e){return this.Cg(e,!0)}Cg(e,t,i,s){if(!r.$(e))return e;i||(i=new nt);const n=i.get(e);if(n)return n;let o;if(Array.isArray(e)){o=[],i.set(e,o);for(let a=0;a<e.length;a++){const l=e[a];o.push(this.Cg(l,!1,i,s))}}else if(e instanceof L||e instanceof _||e instanceof Y||e instanceof ct||e instanceof X)o=e.copy(),i.set(e,o);else{if(e instanceof me||e instanceof It)return e;if(e instanceof E)o=new E().addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof F)o=new F().addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof nt)o=new nt().addAll(this.Cg(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof Date)o=new Date(e),i.set(e,o);else if(e instanceof RegExp)o=new RegExp(e),i.set(e,o),o.lastIndex=e.lastIndex;else if(re.JC(null,"",e))o=e;else if(r.st(e.copy))o=e.copy(),i.set(e,o);else{o={},i.set(e,o);for(const a in e){if(a==="__gohashid")continue;const l=e[a];o[a]=this.Cg(l,!1,i,s)}}}return o}zi(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,t=>{const i="0000"+t.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}Lg(){let e="";return this.name!==""&&(e+=`,
  "name": `+this.zi(this.name)),this.dataFormat!==""&&(e+=`,
  "dataFormat": `+this.zi(this.dataFormat)),this.isReadOnly&&(e+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(e+=`,
  "nodeKeyProperty": `+this.zi(this.nodeKeyProperty)),this.copiesArrays&&(e+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(e+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(e+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(e+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(e+=`,
  "nodeCategoryProperty": `+this.zi(this.nodeCategoryProperty)),e}fw(e){e.name&&(this.name=e.name),e.dataFormat&&(this.dataFormat=e.dataFormat),e.isReadOnly&&(this.isReadOnly=!0),e.nodeKeyProperty&&(this.nodeKeyProperty=e.nodeKeyProperty),e.copiesArrays&&(this.copiesArrays=!0),e.copiesArrayObjects&&(this.copiesArrayObjects=!0),e.copiesKey!==void 0&&(this.copiesKey=e.copiesKey),e.pointsDigits!==void 0&&(this.pointsDigits=parseInt(e.pointsDigits)),e.nodeCategoryProperty&&(this.nodeCategoryProperty=e.nodeCategoryProperty)}Xv(){const e=this.modelData;return`,
  "modelData": `+this.Gv(e)}Yv(e){const t=e.modelData;r.$(t)&&(this.replaceJsonObjects(t),this.modelData=t)}$C(){const e=this.modelData;let t=!1;for(const s in e)if(!this.Fk(e,s,e[s])){t=!0;break}let i="";return t&&(i=this.Xv()),i+`,
  "nodeDataArray": `+this.Xa(this.nodeDataArray,!0)}ZC(e){this.Yv(e);const t=e.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}QC(e,t,i){if(e===t)return!0;if(typeof e!=typeof t||r.st(e)||r.st(t))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(i.get(e)===t)return!0;if(i.set(e,t),e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!this.QC(e[s],t[s],i))return!1;return!0}else if(r.$(e)&&r.$(t)){if(i.get(e)===t)return!0;i.set(e,t);for(const s in e){const n=e[s];if(this.Fk(e,s,n))continue;const o=t[s];if(o===void 0||!this.QC(n,o,i))return!1}for(const s in t){const n=t[s];if(this.Fk(t,s,n))continue;const o=e[s];if(o===void 0||!this.QC(o,n,i))return!1}return!0}return!1}Bv(e){let t=new nt;const i=(s,n)=>{const o=n.part;if(!o)return;const a=o.data;if(s===a)return;let l=t.get(s);l===null?(l=new F,l.add(a),t.set(s,l)):l.add(a)};return e.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){if(s.object!==null){const o=s.object.panel;if(o){const a=o.data;a&&i(a,o)}}}else if(n===3||n===4){const o=s.object,a=o.itemArray;a&&i(a,o)}}}),t}zv(e){const t=new F;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.Rk(e,s,s,t)}return t}Rk(e,t,i,s){if(Array.isArray(t))for(let n=0;n<t.length;n++){const o=t[n];if(o===e)return s.add(i),!0;if(this.Rk(e,o,i,s))return!0}else if(r.$(t)&&Object.getPrototypeOf(t)===Object.prototype)for(const n in t){const o=t[n];if(o===e)return s.add(i),!0;if(this.Rk(e,o,i,s))return!0}return!1}_C(e,t,i){const s=this;let n=!1;const o=new F,a=new F,l=new F;e.changes.each(m=>{if(m.model===s){if(m.modelChange==="nodeDataArray")m.change===3?o.add(m.newValue):m.change===4&&l.add(m.oldValue);else if(s.containsNodeData(m.object))m.object!==null&&a.add(m.object);else if(m.change===2&&(s.modelData===m.object||m.propertyName==="modelData"))n=!0;else if(m.object!==null)if(i.has(m.object)){const p=i.get(m.object);p&&p.each(b=>{s.containsNodeData(b)&&a.add(b)})}else{if(m.object instanceof re||s.Wh()&&s.containsLinkData(m.object))return;s.zv(m.object).each(p=>{a.add(p)})}}});const h=new F;o.each(m=>{const p=s.getKeyForNodeData(m);p!==void 0&&h.add(p),t||a.add(m)});const d=new F;l.each(m=>{const p=s.getKeyForNodeData(m);p!==void 0&&d.add(p),t&&a.add(m)});let f="";return n&&(f+=this.Xv()),h.count>0&&(f+=(t?re.Hv:re.Kv)+this.Xa(h.toArray(),!0)),a.count>0&&(f+=re.l3+this.Xa(a.toArray(),!0)),d.count>0&&(f+=(t?re.Kv:re.Hv)+this.Xa(d.toArray(),!0)),f}uw(e){(e.name!==void 0&&e.name!==this.name||e.dataFormat!==void 0&&e.dataFormat!==this.dataFormat||e.isReadOnly!==void 0&&e.isReadOnly!==this.isReadOnly||e.nodeKeyProperty!==void 0&&e.nodeKeyProperty!==this.nodeKeyProperty||e.copiesArrays!==void 0&&e.copiesArrays!==this.copiesArrays||e.copiesArrayObjects!==void 0&&e.copiesArrayObjects!==this.copiesArrayObjects||e.copiesKey!==void 0&&e.copiesKey!==this.copiesKey||e.nodeCategoryProperty!==void 0&&e.nodeCategoryProperty!==this.nodeCategoryProperty)&&r.o("applyIncrementalJson cannot change Model properties"),this.Yv(e);const t=e.insertedNodeKeys,i=e.modifiedNodeData,s=new nt;if(Array.isArray(i))for(let o=0;o<i.length;o++){const a=i[o],l=this.getKeyForNodeData(a);l!=null&&s.set(l,a)}if(Array.isArray(t)){const o=t.length;for(let a=0;a<o;a++){const l=t[a];let h=this.findNodeDataForKey(l);h===null&&(h=s.get(l)||this.copyNodeData({}),h!==null&&(this.setKeyForNodeData(h,l),this.addNodeData(h)))}}if(Array.isArray(i)){const o=i.length;for(let a=0;a<o;a++){const l=i[a],h=this.getKeyForNodeData(l),d=this.findNodeDataForKey(h);if(d!==null){for(const f in l)f==="__gohashid"||f===this.nodeKeyProperty||(this.Um()||this.a1())&&f===this.nodeIsGroupProperty||this.setDataProperty(d,f,l[f]);this.Ag(l,d)}}}const n=e.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let a=0;a<o;a++){const l=n[a],h=this.findNodeDataForKey(l);h!==null&&this.removeNodeData(h)}}}toIncrementalJson(e,t){e.change!==1&&r.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+e.toString());const i=e.object;if(!e.isTransactionFinished||!(i instanceof Bt))return'{ "incremental": 0 }';t===void 0&&(t=r.Hn(this));const s=this.Bv(i),n=this._C(i,e.propertyName==="FinishedUndo",s);return'{ "class": '+this.zi(t)+', "incremental": 1'+this.Lg()+n+"}"}toIncrementalJSON(e,t){return this.toIncrementalJson(e,t)}toJson(e){return e===void 0&&(e=r.Hn(this)),'{ "class": '+this.zi(e)+this.Lg()+this.$C()+"}"}toJSON(e){return this.toJson(e)}applyIncrementalJson(e){let t=null;if(typeof e=="string")try{t=c.JSON.parse(e)}catch{}else r.$(e)?t=e:r.o("Unable to modify a Model from: "+e);const i=t.incremental;typeof i!="number"&&r.o("Unable to apply non-incremental changes to Model: "+e),i!==0&&(this.startTransaction("applyIncrementalJson"),this.uw(t),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(e){return this.applyIncrementalJson(e)}static fromJson(e,t){t===void 0&&(t=null),t!==null&&r.se(t,re,re,"fromJson:model");let i=null;if(typeof e=="string")try{i=c.JSON.parse(e)}catch{}else r.$(e)?i=e:r.o("Unable to construct a Model from: "+e);if(t===null){const s=re.a3(i);s===null||s instanceof re?t=s:r.o("Unable to construct a Model of declared class: "+i.class)}return t===null&&(t=re.jv()),t.fw(i),t.ZC(i),t}static fromJSON(e,t){return this.fromJson(e,t)}static jv(){return new re}static a3(e){let t=null,i=e.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?s=re.tL(i.substring(3)):(s=re.tL(i),s===null&&(s=c[i])),r.st(s)&&(t=new s)}catch{}return t}replaceJsonObjects(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];r.$(s)&&this.qv(e,i,this.replaceJsonObjects(s))}}else if(r.$(e)){for(const t in e){const i=e[t];if(r.$(i)){const s=this.replaceJsonObjects(i);e[t]=s,this.replaceJsonPropertyValue(e,t,s)}}return this.h3(e)}return e}replaceJsonPropertyValue(e,t,i){if(t==="points"&&Array.isArray(i)){let s=i.length%2===0;for(let n=0;n<i.length;n++)if(typeof i[n]!="number"){s=!1;break}if(s){const n=new E;for(let o=0;o<i.length/2;o++)n.add(new L(i[o*2],i[o*2+1]));e[t]=n}}}writeJsonValue(e){return e===void 0?"undefined":e===null?"null":e===!0?"true":e===!1?"false":typeof e=="string"?this.zi(e):typeof e=="number"?e===1/0?"9e9999":e===-1/0?"-9e9999":isNaN(e)?'{"class":"NaN"}':e.toString():e instanceof Boolean?this.writeJsonValue(e.valueOf()):e instanceof String?this.writeJsonValue(e.valueOf()):e instanceof Number?this.writeJsonValue(e.valueOf()):e instanceof Date?'{"class":"Date", "value":"'+e.toJSON()+'"}':Array.isArray(e)?this.Xa(e):r.$(e)?this.Gv(e):r.st(e)?"null":'"'+e.toString()+'"'}Xa(e,t){t===void 0&&(t=!1);const i=e.length;if(i<=0)return"[]";const s=new u;s.add("["),t&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=e[n];o!==void 0&&(n>0&&(s.add(","),t&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return t&&i>1&&s.add(`
`),s.add("]"),s.toString()}Fk(e,t,i){return!!(i===void 0||t==="__gohashid"||t[0]==="_"||r.st(i))}je(e){return isNaN(e)?"NaN":e===1/0?"9e9999":e===-1/0?"-9e9999":e}Gv(e){const t=e;if(t instanceof L)e={class:"go.Point",x:this.je(t.x),y:this.je(t.y)};else if(t instanceof _)e={class:"go.Size",width:this.je(t.width),height:this.je(t.height)};else if(t instanceof Y)e={class:"go.Rect",x:this.je(t.x),y:this.je(t.y),width:this.je(t.width),height:this.je(t.height)};else if(t instanceof ct)e={class:"go.Margin",top:this.je(t.top),right:this.je(t.right),bottom:this.je(t.bottom),left:this.je(t.left)};else if(t instanceof X)t.isSpot()?e={class:"go.Spot",x:this.je(t.x),y:this.je(t.y),offsetX:this.je(t.offsetX),offsetY:this.je(t.offsetY)}:e={class:"go.Spot",enum:t.toString()};else if(t instanceof me){if(e={class:"go.Brush",type:bn[t.type]},t.type===1?e.color=t.color:(t.type===2||t.type===3)&&(e.start=t.start,e.end=t.end,t.type===3&&(t.startRadius!==0&&(e.startRadius=this.je(t.startRadius)),isNaN(t.endRadius)||(e.endRadius=this.je(t.endRadius)))),t.colorStops!==null){const n={},o=t.colorStops.iterator;for(;o.next();){const a=o.key,l=o.value;n[a]=l}e.colorStops=n}}else if(t instanceof It)e={class:"go.Geometry",type:se[t.type]},t.startX!==0&&(e.startX=this.je(t.startX)),t.startY!==0&&(e.startY=this.je(t.startY)),t.endX!==0&&(e.endX=this.je(t.endX)),t.endY!==0&&(e.endY=this.je(t.endY)),t.spot1.equals(X.TopLeft)||(e.spot1=t.spot1),t.spot2.equals(X.BottomRight)||(e.spot2=t.spot2),t.type===4&&(e.path=It.stringify(t));else if(re.JC(null,"",t))return"{}";let i="{",s=!0;for(const n in e){const o=this.St(e,n);this.Fk(e,n,o)||(s?s=!1:i+=",",i+=this.zi(n)+":"+this.writeJsonPropertyValue(n,o))}return i+="}",i}writeJsonPropertyValue(e,t){if(e==="points"&&t instanceof E){const i=t;let s="[";const n=i.iterator;for(;n.next();){const o=n.value;s.length>1&&(s+=","),s+=this.Wv(o.x),s+=",",s+=this.Wv(o.y)}return s+="]",s}else return this.writeJsonValue(t)}Wv(e){if(e===1/0)return"9e9999";if(e===-1/0)return"-9e9999";if(isNaN(e))return"0";const t=this.pointsDigits;return t>16?e.toString():e.toFixed(t)}get pointsDigits(){return this.hw}set pointsDigits(e){e<0?e=0:e>100&&(e=100),this.hw=e}qe(e){return typeof e=="number"?e:e==="NaN"?NaN:e==="9e9999"?1/0:e==="-9e9999"?-1/0:parseFloat(e)}h3(e){if(!r.$(e))return e;let t=e.class||"";if(typeof t!="string"||t==="")return e;if(t==="NaN")return NaN;if(t==="Date")return new Date(e.value);if(t.indexOf("go.")!==0)return e;t=t.substring(3);let i=e;if(t==="Point")i=new L(this.qe(e.x),this.qe(e.y));else if(t==="Size")i=new _(this.qe(e.width),this.qe(e.height));else if(t==="Rect")i=new Y(this.qe(e.x),this.qe(e.y),this.qe(e.width),this.qe(e.height));else if(t==="Margin")i=new ct(this.qe(e.top),this.qe(e.right),this.qe(e.bottom),this.qe(e.left));else if(t==="Spot")typeof e.enum=="string"?i=X.parse(e.enum):i=new X(this.qe(e.x),this.qe(e.y),this.qe(e.offsetX),this.qe(e.offsetY));else if(t==="Brush"){const s=new me;s.type=r.$a(bn,e.type)??1,typeof e.color=="string"&&(s.color=e.color),e.start instanceof X&&(s.start=e.start),e.end instanceof X&&(s.end=e.end),typeof e.startRadius=="number"&&(s.startRadius=this.qe(e.startRadius)),typeof e.endRadius=="number"&&(s.endRadius=this.qe(e.endRadius));const n=e.colorStops;if(r.$(n))for(const o in n){const a=parseFloat(o);s.addColorStop(a,n[o])}i=s}else if(t==="Geometry"){let s=null;typeof e.path=="string"?s=It.parse(e.path):s=new It,s.type=r.$a(se,e.type)??1,typeof e.startX=="number"&&(s.startX=this.qe(e.startX)),typeof e.startY=="number"&&(s.startY=this.qe(e.startY)),typeof e.endX=="number"&&(s.endX=this.qe(e.endX)),typeof e.endY=="number"&&(s.endY=this.qe(e.endY)),e.spot1 instanceof X&&(s.spot1=e.spot1),e.spot2 instanceof X&&(s.spot2=e.spot2),i=s}else if(t==="EnumValue"){let s=e.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=re.tL(s);r.st(n)&&(i=r.$a(n,e.name))}return i}get name(){return this.Pt}set name(e){const t=this.Pt;t!==e&&(r.s(e,"string",re,"name"),this.Pt=e,this.t("name",t,e))}get dataFormat(){return this.kg}set dataFormat(e){const t=this.kg;t!==e&&(r.s(e,"string",re,"dataFormat"),this.kg=e,this.t("dataFormat",t,e))}get isReadOnly(){return this.zo}set isReadOnly(e){const t=this.zo;t!==e&&(r.s(e,"boolean",re,"isReadOnly"),this.zo=e,this.t("isReadOnly",t,e))}get modelData(){return this.qC}set modelData(e){const t=this.modelData;t!==e&&(r.xc(e,re,"modelData"),this.containsNodeData(e)&&r.o("Model.modelData Object must not be used by the rest of the model: "+e),this.qC=e,this.t("modelData",t,e),this.updateTargetBindings(e))}addChangedListener(e){return r.S(e,re,"addChangedListener:listener"),this.cw.push(e),this}removeChangedListener(e){r.S(e,re,"removeChangedListener:listener");const t=this.cw.indexOf(e);t>=0&&this.cw.splice(t,1)}T2(e){this.skipsUndoManager||this.undoManager.handleChanged(e),this.Jv(e)}Jv(e){this.cw.forEach(t=>t(e))}rR(e){this.Jv(e)}raiseChangedEvent(e,t,i,s,n,o,a){this.Ft("",e,t,i,s,n,o,a)}raiseChanged(e,t,i,s,n){this.Ft("",2,e,this,t,i,s,n)}t(e,t,i,s,n){this.Ft("",2,e,this,t,i,s,n)}raiseDataChanged(e,t,i,s,n,o){this.Ft("",2,t,e,i,s,n,o)}Ft(e,t,i,s,n,o,a,l){a===void 0&&(a=null),l===void 0&&(l=null);const h=new Et;h.model=this,h.change=t,h.modelChange=e,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=a,h.newValue=o,h.newParam=l,this.T2(h)}get undoManager(){return this.vk}set undoManager(e){const t=this.vk;t!==e&&(t&&t.removeModel(this),this.vk=e,e.addModel(this))}get skipsUndoManager(){return this.Bo}set skipsUndoManager(e){r.s(e,"boolean",re,"skipsUndoManager"),this.Bo=e}changeState(e,t){if(e!==null&&e.model===this)if(e.change===2){const i=e.object,s=e.propertyName,n=e.getValue(t);if(i!==null&&s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=e.getValue(!t);o!==void 0&&this.be.delete(o),n!==void 0&&this.be.set(n,i)}this.et(i,s,n)}else if(e.change===3){const i=e.newParam;if(e.modelChange==="nodeDataArray"){const s=e.newValue;if(r.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Bi[i]===s&&this.Co(this.Bi,i),n!==void 0&&this.be.delete(n)):(this.Bi[i]!==s&&this.ar(this.Bi,i,s),n!==void 0&&this.be.set(n,s))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.St(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.newValue;t?this.Co(s,i):this.ar(s,i,n)}}else r.o("unknown ChangeType.Insert modelChange: "+e.toString())}else if(e.change===4){const i=e.oldParam;if(e.modelChange==="nodeDataArray"){const s=e.oldValue;if(r.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Bi[i]!==s&&this.ar(this.Bi,i,s),n!==void 0&&this.be.set(n,s)):(this.Bi[i]===s&&this.Co(this.Bi,i),n!==void 0&&this.be.delete(n))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.St(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.oldValue;t?this.ar(s,i,n):this.Co(s,i)}}else r.o("unknown ChangeType.Remove modelChange: "+e.toString())}else e.change===1||r.o("unknown ChangedEvent: "+e.toString())}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(e,t){t===void 0&&(t=""),this.Ft("SourceChanged",1,t,e,null,null)}get nodeKeyProperty(){return this.za}set nodeKeyProperty(e){const t=this.za;t!==e&&(this.Un(e,re,"nodeKeyProperty"),e===""&&r.o("Model.nodeKeyProperty may not be the empty string"),this.be.count>0&&r.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.za=e,this.t("nodeKeyProperty",t,e))}Un(e,t,i){}getKeyForNodeData(e){if(e===null)return;const t=this.za;if(t==="")return;const i=this.St(e,t);if(i!==void 0){if(this.isKeyType(i))return i;r.o("Key value for node data "+e+" is not a number or a string: "+i)}}setKeyForNodeData(e,t){if((t==null||!this.isKeyType(t))&&r.si(t,"number or string",re,"setKeyForNodeData:key"),e===null)return;const i=this.za;if(i==="")return;if(!this.containsNodeData(e)){this.et(e,i,t);return}const s=this.St(e,i);if(s!==t){if(this.findNodeDataForKey(t)!==null)return;this.et(e,i,t),s!==void 0&&this.be.delete(s),this.be.set(t,e),this.Ft("nodeKey",2,i,e,s,t),typeof i=="string"&&this.updateTargetBindings(e,i),this.dw(s,t)}}get makeUniqueKeyFunction(){return this.Jf}set makeUniqueKeyFunction(e){const t=this.Jf;t!==e&&(e!==null&&r.S(e,re,"makeUniqueKeyFunction"),this.Jf=e,this.t("makeUniqueKeyFunction",t,e))}isKeyType(e){return typeof e=="number"||typeof e=="string"}containsNodeData(e){if(e===null)return!1;const t=this.getKeyForNodeData(e);return t===void 0?!1:this.be.get(t)===e}findNodeDataForKey(e){return e===null&&r.o("Model.findNodeDataForKey:key must not be null"),e===void 0||!this.isKeyType(e)?null:this.be.get(e)}get nodeDataArray(){return this.Bi}set nodeDataArray(e){const t=this.Bi;if(t!==e){this.eL(e,re,"nodeDataArray"),this.be.clear(),this.iL();const i=e.length;for(let o=0;o<i;o++){const a=e[o];r.$(a)||r.o("Model.nodeDataArray must only contain Objects, not: "+a),a===this.modelData&&r.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Bi=e;const s=new E;for(let o=0;o<i;o++){const a=e[o],l=this.getKeyForNodeData(a);l===void 0||this.be.get(l)!==null?s.add(a):this.be.set(l,a)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const a=this.getKeyForNodeData(o);a!==void 0&&this.be.set(a,o)}this.Ft("nodeDataArray",2,"nodeDataArray",this,t,e);for(let o=0;o<i;o++){const a=e[o];this.Tg(a),this.Dg(a)}}}Ok(e){return e===void 0?!1:this.be.has(e)}makeNodeDataKeyUnique(e){if(e===null)return;const t=this.za;if(t==="")return;let i=this.getKeyForNodeData(e);if(i!==void 0&&!this.Ok(i))return;const s=this.Jf;if(s!==null&&(i=s(this,e),i!=null&&!this.Ok(i))){this.et(e,t,i);return}if(typeof i=="string"){let n=2;for(;this.Ok(i+n);)n++;this.et(e,t,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.be.count-1;for(;this.Ok(n);)n--;this.et(e,t,n)}}addNodeData(e){e!==null&&(e===this.modelData&&r.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(e)||this.vv(e,!0))}vv(e,t){let i=this.getKeyForNodeData(e);if(i===void 0)this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e);else{if(this.be.get(i)===e)return;this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e)}i===void 0&&r.o("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.be.set(i,e);let s=null;t&&(s=this.Bi.length,this.ar(this.Bi,s,e)),this.Ft("nodeDataArray",3,"nodeDataArray",this,null,e,null,s),this.Tg(e),this.Dg(e)}addNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.addNodeData(i)}}}removeNodeData(e){e!==null&&this.Dv(e,!0)}Dv(e,t){const i=this.getKeyForNodeData(e);i!==void 0&&this.be.delete(i);let s=null;if(t){if(s=this.Bi.indexOf(e),s<0)return;this.Co(this.Bi,s)}this.Ft("nodeDataArray",4,"nodeDataArray",this,e,null,s,null),this.gw(e)}removeNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.removeNodeData(i)}}}mergeNodeDataArray(e){if(e===this.nodeDataArray||!Array.isArray(e))return;const t=new F;t.addAll(this.be.iteratorKeys);const i=new F,s=e.length;for(let o=0;o<s;o++){const a=e[o],l=this.getKeyForNodeData(a);if(l!==void 0){i.add(l);const h=this.findNodeDataForKey(l);if(h===a)continue;if(h!==null)this.assignAllDataProperties(h,a),this.Ag(a,h);else{const d=this.cloneDeep(a);this.setKeyForNodeData(d,l),this.addNodeData(d)}}else{const h=this.cloneDeep(a);this.addNodeData(h);const d=this.getKeyForNodeData(h);d!==void 0&&i.add(d)}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const a=this.findNodeDataForKey(o);a&&this.removeNodeData(a)}}}dw(e,t){if(t===void 0)return;const i=this.lw(e);i instanceof F&&this.lr.set(t,i)}iL(){}Tg(e){}Dg(e){}gw(e){}hn(e,t){if(e===void 0)return;let i=this.lr.get(e);i===null&&(i=new F,this.lr.set(e,i)),i.add(t)}an(e,t){if(e===void 0)return;const i=this.lr.get(e);i instanceof F&&(t==null?this.lr.delete(e):(i.delete(t),i.count===0&&this.lr.delete(e)))}lw(e){if(e===void 0)return null;const t=this.lr.get(e);return t instanceof F?t:null}GU(e){e===void 0?this.lr.clear():this.lr.delete(e)}get copyNodeDataFunction(){return this.$f}set copyNodeDataFunction(e){const t=this.$f;t!==e&&(e!==null&&r.S(e,re,"copyNodeDataFunction"),this.$f=e,this.t("copyNodeDataFunction",t,e))}get copiesArrays(){return this.Pg}set copiesArrays(e){const t=this.Pg;t!==e&&(e!==null&&r.s(e,"boolean",re,"copiesArrays"),this.Pg=e,this.t("copiesArrays",t,e))}get copiesArrayObjects(){return this.Sg}set copiesArrayObjects(e){const t=this.Sg;t!==e&&(e!==null&&r.s(e,"boolean",re,"copiesArrayObjects"),this.Sg=e,this.t("copiesArrayObjects",t,e))}get copiesKey(){return this.Mg}set copiesKey(e){const t=this.Mg;t!==e&&(e!==null&&r.s(e,"boolean",re,"copiesKey"),this.Mg=e,this.t("copiesKey",t,e))}copyNodeData(e){let t=null;const i=this.$f;return i!==null?t=i(e,this):t=this.Ik(e,!0),t}Ik(e,t){if(r.$(e))if(Array.isArray(e))if(this.copiesArrays){const i=e,s=[];for(let n=0;n<i.length;n++){const o=i[n],a=this.Ik(o,this.copiesArrayObjects);s.push(a)}return s}else return e;else{if(e instanceof L||e instanceof _||e instanceof Y||e instanceof ct||e instanceof X)return e.copy();if(t){const i=e,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const a in i){if(a==="__gohashid"){n.__gohashid=void 0;continue}if(a===o){n[o]=void 0;continue}const l=this.St(i,a);if(!r.$(l))n[a]=l;else if(re.JC(i,a,l))this.et(n,a,l);else{const h=this.Ik(l,!1);this.et(n,a,h)}}return n}else return e}else return e}get afterCopyFunction(){return this.Ng}set afterCopyFunction(e){const t=this.Ng;t!==e&&(e!==null&&r.S(e,re,"afterCopyFunction"),this.Ng=e,this.t("afterCopyFunction",t,e))}static JC(e,t,i){const s=r.Hn(i);return i instanceof re||i instanceof Gt||i instanceof Bt||i instanceof Et||i instanceof Ht||i instanceof ai||i instanceof qt||i instanceof EventTarget||s==="Layer"||s==="RowColumnDefinition"||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty){this.setKeyForNodeData(e,i);return}else if(t===this.nodeCategoryProperty){this.setCategoryForNodeData(e,i);return}}else!re.$v&&e instanceof Ht&&(re.$v=!0,r.ne('Model.setDataProperty is modifying a GraphObject, "'+e.toString()+'"'),r.ne("  Is that really your intent?"));const s=this.St(e,t);s!==i&&(this.et(e,t,i),this.raiseDataChanged(e,t,s,i))}set(e,t,i){this.setDataProperty(e,t,i)}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e);for(const s in t)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(e,s,t[s]))}addArrayItem(e,t){this.insertArrayItem(e,-1,t)}insertArrayItem(e,t,i){t<0&&(t=e.length),e=this.ar(e,t,i),this.Ft("",3,"",e,null,i,null,t)}removeArrayItem(e,t){t===void 0&&(t=-1),e===this.Bi&&r.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),t===-1&&(t=e.length-1);const i=e[t];e=this.Co(e,t),this.Ft("",4,"",e,i,null,t,null)}get nodeCategoryProperty(){return this.lc}set nodeCategoryProperty(e){const t=this.lc;t!==e&&(this.Un(e,re,"nodeCategoryProperty"),this.lc=e,this.t("nodeCategoryProperty",t,e))}getCategoryForNodeData(e){if(e===null)return"";const t=this.lc;if(t==="")return"";const i=this.St(e,t);if(i===void 0)return"";if(typeof i=="string")return i;r.o("getCategoryForNodeData found a non-string category for "+e+": "+i)}setCategoryForNodeData(e,t){if(r.s(t,"string",re,"setCategoryForNodeData:cat"),e===null)return;const i=this.lc;if(i==="")return;if(!this.containsNodeData(e)){this.et(e,i,t);return}let s=this.St(e,i);s===void 0&&(s=""),s!==t&&(this.et(e,i,t),this.Ft("nodeCategory",2,i,e,s,t))}Ag(e,t){this.setCategoryForNodeData(t,this.getCategoryForNodeData(e))}get type(){return"Model"}Vm(){return!1}Um(){return!1}a1(){return!1}Wh(){return!1}Ax(){return!1}uf(){return!1}static m2(){return new re}St(e,t){return re.St(e,t)}static St(e,t){if(!e||!t)return null;let i;try{r.st(t)?i=t(e):r.st(e.getAttribute)?(i=e.getAttribute(t),i===null&&(i=void 0)):i=e[t]}catch{}return i}et(e,t,i){re.et(e,t,i)}static et(e,t,i){if(!(!e||!t)){try{r.st(t)?t(e,i):r.st(e.setAttribute)?e.setAttribute(t,i):e[t]=i}catch{}return e}}eL(e,t,i){}qv(e,t,i){return e[t]=i,e}ar(e,t,i){return t>=e.length?e.push(i):e.splice(t,0,i),e}Co(e,t){return t>=e.length?e.pop():e.splice(t,1),e}static tL(e){return re.sL[e]?re.sL[e]:c.go!==void 0&&c.go[e]?c.go[e]:null}static Sl(e,t){re.sL[t]=e}};y(re,"Kv",`,
  "insertedNodeKeys": `),y(re,"l3",`,
  "modifiedNodeData": `),y(re,"Hv",`,
  "removedNodeKeys": `),y(re,"$v",!1),y(re,"sL",{});let Ne=re;Ne.fromJSON=Ne.fromJson=Ne.fromJson,Ne.Sl(me,"Brush"),Ne.Sl(It,"Geometry"),Ne.Sl(ct,"Margin"),Ne.Sl(L,"Point"),Ne.Sl(Y,"Rect"),Ne.Sl(_,"Size"),Ne.Sl(X,"Spot"),Ne.Sl(Ne,"Model");const _e=class _e extends Ne{constructor(t,i,s){super();y(this,"Is");y(this,"hr");y(this,"Oe");y(this,"Ga");y(this,"Zf");y(this,"Qf");y(this,"Vl");y(this,"Lo");y(this,"Ao");y(this,"ac");y(this,"hc");y(this,"cc");y(this,"cn");y(this,"_f");y(this,"Vn");y(this,"vg");y(this,"Qv",`,
  "insertedLinkKeys": `);y(this,"c3",`,
  "modifiedLinkData": `);y(this,"_v",`,
  "removedLinkKeys": `);if(this.Is=[],this.hr=new F,this.Oe=new nt,this.Ga="",this.Zf=null,this.Qf=null,this.Vl=null,this.Lo="from",this.Ao="to",this.ac="",this.hc="",this.cc="category",this.cn="",this._f="isGroup",this.Vn="group",this.vg=!1,i!==void 0&&(this.linkDataArray=i),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:s=t),s){Object.assign(this,s);const n=s.Changed;n&&(delete this.Changed,this.addChangedListener(n))}}cloneProtected(t){super.cloneProtected(t),t.Ga=this.Ga,t.Zf=this.Zf,t.Qf=this.Qf,t.Lo=this.Lo,t.Ao=this.Ao,t.ac=this.ac,t.hc=this.hc,t.cc=this.cc,t.cn=this.cn,t._f=this._f,t.Vn=this.Vn,t.vg=this.vg}clear(){this.Is=[],this.Oe.clear(),this.hr.clear(),super.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){i+=`
 node data:`;let s=this.nodeDataArray,n=s.length,o=0;for(o=0;o<n;o++){const a=s[o];i+=" "+this.getKeyForNodeData(a)+":"+Qs.toString(a)}for(i+=`
 link data:`,s=this.linkDataArray,n=s.length,o=0;o<n;o++){const a=s[o];i+=" "+this.Vi(a,!0)+"-->"+this.Vi(a,!1)}}return i}}WC(t,i,s){if(this.linkKeyProperty===""){const p=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=p}let n=super.WC(t,i,s);const o=this,a=new F,l=new F,h=new F;t.changes.each(p=>{if(p.model===o){if(p.modelChange==="linkDataArray")p.change===3?a.add(p.newValue):p.change===4&&h.add(p.oldValue);else if(o.containsLinkData(p.object))p.object!==null&&l.add(p.object);else if(p.object!==null)if(p.object!==null&&s.has(p.object)){const b=s.get(p.object);b&&b.each(x=>{o.containsLinkData(x)&&l.add(x)})}else{if(p.object instanceof Ne||o.containsNodeData(p.object))return;o.Zv(p.object).each(b=>l.add(b))}}});const d=new F;a.each(p=>{const b=o.getKeyForLinkData(p);b!==void 0&&d.add(b),i||l.add(p)});const f=new F;h.each(p=>{const b=o.getKeyForLinkData(p);b!==void 0&&f.add(b),i&&l.add(p)});const m=o.cloneDeep(l.toArray());return d.count>0&&(n===null&&(n={}),i?n.removedLinkKeys=d.toArray():n.insertedLinkKeys=d.toArray()),m.length>0&&(n===null&&(n={}),n.modifiedLinkData=m),f.count>0&&(n===null&&(n={}),i?n.insertedLinkKeys=f.toArray():n.removedLinkKeys=f.toArray()),n}Lg(){const t=super.Lg();let i="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(i+=`,
  "linkCategoryProperty": `+this.zi(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(i+=`,
  "linkKeyProperty": `+this.zi(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(i+=`,
  "linkFromKeyProperty": `+this.zi(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(i+=`,
  "linkToKeyProperty": `+this.zi(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(i+=`,
  "linkFromPortIdProperty": `+this.zi(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(i+=`,
  "linkToPortIdProperty": `+this.zi(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(i+=`,
  "linkLabelKeysProperty": `+this.zi(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(i+=`,
  "nodeIsGroupProperty": `+this.zi(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(i+=`,
  "nodeGroupKeyProperty": `+this.zi(this.nodeGroupKeyProperty)),t+i}fw(t){super.fw(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}$C(){const t=super.$C(),i=`,
  "linkDataArray": `+this.Xa(this.linkDataArray,!0);return t+i}ZC(t){super.ZC(t);const i=t.linkDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.linkDataArray=i)}Zv(t){const i=new F;for(let s=0;s<this.linkDataArray.length;s++){const n=this.linkDataArray[s];this.Rk(t,n,n,i)}return i}_C(t,i,s){if(this.linkKeyProperty===""){const p=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=p}const n=super._C(t,i,s),o=this,a=new F,l=new F,h=new F;t.changes.each(p=>{if(p.model===o){if(p.modelChange==="linkDataArray")p.change===3?a.add(p.newValue):p.change===4&&h.add(p.oldValue);else if(o.containsLinkData(p.object))p.object!==null&&l.add(p.object);else if(p.object!==null)if(p.object!==null&&s.has(p.object)){const b=s.get(p.object);b&&b.each(x=>{o.containsLinkData(x)&&l.add(x)})}else{if(p.object instanceof Ne||o.containsNodeData(p.object))return;o.Zv(p.object).each(b=>l.add(b))}}});const d=new F;a.each(p=>{const b=o.getKeyForLinkData(p);b!==void 0&&d.add(b),i||l.add(p)});const f=new F;h.each(p=>{const b=o.getKeyForLinkData(p);b!==void 0&&f.add(b),i&&l.add(p)});let m=n;return d.count>0&&(m+=(i?this._v:this.Qv)+this.Xa(d.toArray(),!0)),l.count>0&&(m+=this.c3+this.Xa(l.toArray(),!0)),f.count>0&&(m+=(i?this.Qv:this._v)+this.Xa(f.toArray(),!0)),m}uw(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&r.o("applyIncrementalJson cannot change Model properties"),super.uw(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const o=i.length;for(let a=0;a<o;a++){const l=i[a];let h=this.findLinkDataForKey(l);h===null&&(h=this.copyLinkData({}),this.setKeyForLinkData(h,l),this.addLinkData(h))}}const s=t.modifiedLinkData;if(Array.isArray(s)){const o=s.length;for(let a=0;a<o;a++){const l=s[a],h=this.getKeyForLinkData(l),d=this.findLinkDataForKey(h);if(d!==null){for(const f in l)f==="__gohashid"||f===this.linkKeyProperty||this.setDataProperty(d,f,l[f]);this.tF(l,d)}}}const n=t.removedLinkKeys;if(Array.isArray(n)){const o=n.length;for(let a=0;a<o;a++){const l=n[a],h=this.findLinkDataForKey(l);h!==null&&this.removeLinkData(h)}}}changeState(t,i){if(!(t===null||t.model!==this)){if(t.change===2){const s=t.object,n=t.propertyName;if(s!==null&&n===this.linkKeyProperty&&this.containsLinkData(s)){const o=t.getValue(i),a=t.getValue(!i);a!==void 0&&this.Oe.delete(a),o!==void 0&&this.Oe.set(o,s),this.et(s,n,o);return}}else if(t.change===3){let s=t.newParam;if(t.modelChange==="linkDataArray"){const n=t.newValue;if(r.$(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.hr.delete(n),this.Is[s]===n&&this.Co(this.linkDataArray,s),o!==void 0&&this.Oe.delete(o)):(this.hr.add(n),this.Is[s]!==n&&this.ar(this.Is,s,n),o!==void 0&&this.Oe.set(o,n))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=n!==null?this.getLabelKeysForLinkData(n):null;Array.isArray(o)&&typeof s=="number"&&(i?(s=o.indexOf(t.newValue),s>=0&&this.Co(o,s)):o.indexOf(t.newValue)<0&&this.ar(o,s,t.newValue));return}}else if(t.change===4){let s=t.oldParam;if(t.modelChange==="linkDataArray"){const n=t.oldValue;if(r.$(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.hr.add(n),this.Is[s]!==n&&this.ar(this.Is,s,n),o!==void 0&&this.Oe.set(o,n)):(this.hr.delete(n),this.Is[s]===n&&this.Co(this.linkDataArray,s),o!==void 0&&this.Oe.delete(o))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=n!==null?this.getLabelKeysForLinkData(n):null;Array.isArray(o)&&typeof s=="number"&&(i?o.indexOf(t.oldValue)<0&&this.ar(o,s,t.oldValue):(s=o.indexOf(t.oldValue),s>=0&&this.Co(o,s)));return}}super.changeState(t,i)}}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){const i=this.Vl;i!==t&&(t!==null&&r.xc(t,_e,"archetypeNodeData"),this.Vl=t,this.t("archetypeNodeData",i,t))}nL(t){if(t===void 0)return;const i=this.Vl;if(i!==null){let s=this.findNodeDataForKey(t);s===null&&(s=this.copyNodeData(i),this.et(s,this.nodeKeyProperty,t),this.addNodeData(s))}return t}get linkFromKeyProperty(){return this.Lo}set linkFromKeyProperty(t){const i=this.Lo;i!==t&&(this.Un(t,_e,"linkFromKeyProperty"),this.Lo=t,this.t("linkFromKeyProperty",i,t))}getFromKeyForLinkData(t){return this.Vi(t,!0)}setFromKeyForLinkData(t,i){this.xg(t,i,!0)}get linkToKeyProperty(){return this.Ao}set linkToKeyProperty(t){const i=this.Ao;i!==t&&(this.Un(t,_e,"linkToKeyProperty"),this.Ao=t,this.t("linkToKeyProperty",i,t))}getToKeyForLinkData(t){return this.Vi(t,!1)}setToKeyForLinkData(t,i){this.xg(t,i,!1)}Vi(t,i){if(t===null)return;const s=i?this.Lo:this.Ao;if(s==="")return;const n=this.St(t,s);if(n!==void 0){if(this.isKeyType(n))return n;r.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+n)}}xg(t,i,s){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&r.si(i,"number or string",_e,s?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const n=s?this.Lo:this.Ao;if(n==="")return;if(i=this.nL(i),!this.containsLinkData(t)){this.et(t,n,i);return}const o=this.St(t,n);o!==i&&(this.an(o,t),this.et(t,n,i),this.findNodeDataForKey(i)===null&&this.hn(i,t),this.Ft(s?"linkFromKey":"linkToKey",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkFromPortIdProperty(){return this.ac}set linkFromPortIdProperty(t){const i=this.ac;i!==t&&(this.Un(t,_e,"linkFromPortIdProperty"),this.ac=t,this.t("linkFromPortIdProperty",i,t))}getFromPortIdForLinkData(t){return this.Ak(t,!0)}setFromPortIdForLinkData(t,i){this.bg(t,i,!0)}get linkToPortIdProperty(){return this.hc}set linkToPortIdProperty(t){const i=this.hc;i!==t&&(this.Un(t,_e,"linkToPortIdProperty"),this.hc=t,this.t("linkToPortIdProperty",i,t))}getToPortIdForLinkData(t){return this.Ak(t,!1)}setToPortIdForLinkData(t,i){this.bg(t,i,!1)}Ak(t,i){if(t===null)return"";const s=i?this.ac:this.hc;if(s==="")return"";const n=this.St(t,s);return n===void 0?"":n}bg(t,i,s){if(t===null)return;const n=s?this.ac:this.hc;if(n==="")return;if(!this.containsLinkData(t)){this.et(t,n,i);return}let o=this.St(t,n);o===void 0&&(o=""),o!==i&&(this.et(t,n,i),this.Ft(s?"linkFromPortId":"linkToPortId",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkLabelKeysProperty(){return this.cn}set linkLabelKeysProperty(t){const i=this.cn;i!==t&&(this.Un(t,_e,"linkLabelKeysProperty"),this.cn=t,this.t("linkLabelKeysProperty",i,t))}getLabelKeysForLinkData(t){if(t===null)return _e.EmptyArray;const i=this.cn;if(i==="")return _e.EmptyArray;const s=this.St(t,i);return s===void 0?_e.EmptyArray:s}setLabelKeysForLinkData(t,i){if(this.eL(i,_e,"setLabelKeysForLinkData:arr"),t===null)return;const s=this.cn;if(s==="")return;if(!this.containsLinkData(t)){this.et(t,s,i);return}let n=this.St(t,s);if(n===void 0&&(n=_e.EmptyArray),n!==i){if(Array.isArray(n)){const a=n.length;for(let l=0;l<a;l++){const h=n[l];this.an(h,t)}}this.et(t,s,i);const o=i.length;for(let a=0;a<o;a++){const l=i[a];this.findNodeDataForKey(l)===null&&this.hn(l,t)}this.Ft("linkLabelKeys",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}addLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||r.si(i,"number or string",_e,"addLabelKeyForLinkData:key"),t===null))return;const s=this.cn;if(s==="")return;const n=this.St(t,s);if(n===void 0){const o=[];o.push(i),this.setLabelKeysForLinkData(t,o)}else if(Array.isArray(n)){let o=n.indexOf(i);if(o>=0)return;o=n.length,n.push(i),this.containsLinkData(t)&&(this.findNodeDataForKey(i)===null&&this.hn(i,t),this.Ft("linkLabelKeys",3,s,t,null,i,null,o))}else r.o(s+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||r.si(i,"number or string",_e,"removeLabelKeyForLinkData:key"),t===null))return;const s=this.cn;if(s==="")return;const n=this.St(t,s);if(Array.isArray(n)){const o=n.indexOf(i);if(o<0)return;this.Co(n,o),this.containsLinkData(t)&&(this.an(i,t),this.Ft("linkLabelKeys",4,s,t,i,null,o,null))}else n!==void 0&&r.o(s+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Is}set linkDataArray(t){const i=this.Is;if(i!==t){this.eL(t,_e,"linkDataArray"),this.Oe.clear();const s=t.length;for(let o=0;o<s;o++){const a=t[o];r.$(a)||r.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+a)}if(this.Is=t,this.linkKeyProperty!==""){const o=new E;for(let l=0;l<s;l++){const h=t[l],d=this.getKeyForLinkData(h);d===void 0||this.Oe.get(d)!==null?o.add(h):this.Oe.set(d,h)}const a=o.iterator;for(;a.next();){const l=a.value;this.makeLinkDataKeyUnique(l);const h=this.getKeyForLinkData(l);h!==void 0&&this.Oe.set(h,l)}}const n=new F;for(let o=0;o<s;o++){const a=t[o];n.add(a)}this.hr=n,this.Ft("linkDataArray",2,"linkDataArray",this,i,t);for(let o=0;o<s;o++){const a=t[o];this.oL(a)}}}get linkKeyProperty(){return this.Ga}set linkKeyProperty(t){const i=this.Ga;if(i!==t){this.Un(t,_e,"linkKeyProperty"),this.Ga=t,this.Oe.clear();const s=this.linkDataArray.length;for(let n=0;n<s;n++){const o=this.linkDataArray[n];let a=this.getKeyForLinkData(o);a===void 0&&(this.makeLinkDataKeyUnique(o),a=this.getKeyForLinkData(o)),a!==void 0&&this.Oe.set(a,o)}this.t("linkKeyProperty",i,t)}}getKeyForLinkData(t){if(t===null)return;const i=this.Ga;if(i==="")return;const s=this.St(t,i);if(s!==void 0){if(this.isKeyType(s))return s;r.o("Key value for link data "+t+" is not a number or a string: "+s)}}setKeyForLinkData(t,i){if((i==null||!this.isKeyType(i))&&r.si(i,"number or string",_e,"setKeyForLinkData:key"),t===null)return;const s=this.Ga;if(s==="")return;if(!this.containsLinkData(t)){this.et(t,s,i);return}const n=this.St(t,s);if(n!==i){if(this.findLinkDataForKey(i)!==null)return;this.et(t,s,i),n!==void 0&&this.Oe.delete(n),this.Oe.set(i,t),this.Ft("linkKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}get makeUniqueLinkKeyFunction(){return this.Zf}set makeUniqueLinkKeyFunction(t){const i=this.Zf;i!==t&&(this.Zf=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return t===null&&r.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.Oe.get(t)}Ek(t){return t===void 0?!1:this.Oe.has(t)}makeLinkDataKeyUnique(t){if(t===null)return;const i=this.Ga;if(i==="")return;let s=this.getKeyForLinkData(t);if(s!==void 0&&!this.Ek(s))return;const n=this.Zf;if(n!==null&&(s=n(this,t),s!=null&&!this.Ek(s))){this.et(t,i,s);return}if(typeof s=="string"){let o=2;for(;this.Ek(s+o);)o++;this.et(t,i,s+o)}else if(s===void 0||typeof s=="number"){let o=-this.Oe.count-1;for(;this.Ek(o);)o--;this.et(t,i,o)}}containsLinkData(t){return t===null?!1:this.hr.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.Uv(t,!0))}Uv(t,i){if(this.linkKeyProperty!==""){let n=this.getKeyForLinkData(t);if(n===void 0)this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t);else{if(this.Oe.get(n)===t)return;this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t)}n===void 0&&r.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Oe.set(n,t)}this.hr.add(t);let s=null;i&&(s=this.Is.length,this.ar(this.Is,s,t)),this.Ft("linkDataArray",3,"linkDataArray",this,null,t,null,s),this.oL(t)}addLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.addLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.addLinkData(s)}}}removeLinkData(t){t!==null&&this.Ev(t,!0)}Ev(t,i){this.hr.delete(t);const s=this.getKeyForLinkData(t);s!==void 0&&this.Oe.delete(s);let n=null;if(i){if(n=this.Is.indexOf(t),n<0)return;this.Co(this.Is,n)}this.Ft("linkDataArray",4,"linkDataArray",this,t,null,n,null),this.f3(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.removeLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.removeLinkData(s)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&r.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const i=new F;i.addAll(this.Oe.iteratorKeys);const s=new F,n=t.length;for(let a=0;a<n;a++){const l=t[a],h=this.getKeyForLinkData(l);if(h!==void 0){s.add(h);const d=this.findLinkDataForKey(h);if(d===l)continue;if(d!==null)this.assignAllDataProperties(d,l),this.tF(l,d);else{const f=this.cloneDeep(l);this.setKeyForLinkData(f,h),this.addLinkData(f)}}else{const d=this.cloneDeep(l);this.addLinkData(d);const f=this.getKeyForLinkData(d);f!==void 0&&s.add(f)}}const o=i.iterator;for(;o.next();){const a=o.value;if(!s.has(a)){const l=this.findLinkDataForKey(a);l&&this.removeLinkData(l)}}}oL(t){let i=this.Vi(t,!0);i=this.nL(i),this.findNodeDataForKey(i)===null&&this.hn(i,t),i=this.Vi(t,!1),i=this.nL(i),this.findNodeDataForKey(i)===null&&this.hn(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.findNodeDataForKey(i)===null&&this.hn(i,t)}}f3(t){let i=this.Vi(t,!0);this.an(i,t),i=this.Vi(t,!1),this.an(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.an(i,t)}}get copyLinkDataFunction(){return this.Qf}set copyLinkDataFunction(t){const i=this.Qf;i!==t&&(this.Qf=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){let i=null;const s=this.Qf;return s!==null?i=s(t,this):i=this.Ik(t,!0),r.$(i)&&(this.Lo!==""&&this.et(i,this.Lo,void 0),this.Ao!==""&&this.et(i,this.Ao,void 0),this.cn!==""&&this.et(i,this.cn,[])),i}get nodeIsGroupProperty(){return this._f}set nodeIsGroupProperty(t){const i=this._f;i!==t&&(this.Un(t,_e,"nodeIsGroupProperty"),this._f=t,this.t("nodeIsGroupProperty",i,t))}isGroupForNodeData(t){if(t===null)return!1;const i=this._f;return i===""?!1:!!this.St(t,i)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Vn}set nodeGroupKeyProperty(t){const i=this.Vn;i!==t&&(this.Un(t,_e,"nodeGroupKeyProperty"),this.Vn=t,this.t("nodeGroupKeyProperty",i,t))}get copiesGroupKeyOfNodeData(){return this.vg}set copiesGroupKeyOfNodeData(t){this.vg!==t&&(this.vg=t)}getGroupKeyForNodeData(t){if(t===null)return;const i=this.Vn;if(i==="")return;const s=this.St(t,i);if(s!==void 0){if(this.isKeyType(s))return s;r.o("GroupKey value for node data "+t+" is not a number or a string: "+s)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&r.si(i,"number or string",_e,"setGroupKeyForNodeData:key"),t===null)return;const s=this.Vn;if(s==="")return;if(!this.containsNodeData(t)){this.et(t,s,i);return}const n=this.St(t,s);n!==i&&(this.an(n,t),this.et(t,s,i),this.findNodeDataForKey(i)===null&&this.hn(i,t),this.Ft("nodeGroupKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setGroupForData(t,i){this.setGroupKeyForNodeData(t,i)}copyNodeData(t){const i=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Vn!==""&&this.St(i,this.Vn)!==void 0&&this.et(i,this.Vn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,s);return}}else if(this.containsLinkData(t)){if(i===this.linkFromKeyProperty){this.xg(t,s,!0);return}else if(i===this.linkToKeyProperty){this.xg(t,s,!1);return}else if(i===this.linkFromPortIdProperty){this.bg(t,s,!0);return}else if(i===this.linkToPortIdProperty){this.bg(t,s,!1);return}else if(i===this.linkKeyProperty){this.setKeyForLinkData(t,s);return}else if(i===this.linkCategoryProperty){this.setCategoryForLinkData(t,s);return}else if(i===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,s);return}}const n=this.St(t,i);n!==s&&(this.et(t,i,s),this.raiseDataChanged(t,i,n,s))}assignAllDataProperties(t,i){if(!i)return;const s=this.containsNodeData(t),n=this.containsLinkData(t);for(const o in i)if(o!=="__gohashid"&&!(s&&o===this.nodeKeyProperty)){if(s&&o===this.nodeIsGroupProperty&&this.St(t,o)===i[o]||n&&o===this.linkKeyProperty)continue;this.setDataProperty(t,o,i[o])}}dw(t,i){super.dw(t,i);const s=this.be.iterator;for(;s.next();){const o=s.value;this.rL(o,t,i)}const n=this.hr.iterator;for(;n.next();){const o=n.value;this.u3(o,t,i)}}rL(t,i,s){if(this.getGroupKeyForNodeData(t)===i){const n=this.Vn;this.et(t,n,s),this.Ft("nodeGroupKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}u3(t,i,s){if(this.Vi(t,!0)===i){const o=this.Lo;this.et(t,o,s),this.Ft("linkFromKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}if(this.Vi(t,!1)===i){const o=this.Ao;this.et(t,o,s),this.Ft("linkToKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}const n=this.getLabelKeysForLinkData(t);if(Array.isArray(n)){const o=n.length,a=this.cn;for(let l=0;l<o;l++)n[l]===i&&(this.qv(n,l,s),this.Ft("linkLabelKeys",3,a,t,i,s,l,l))}}iL(){super.iL();const t=this.linkDataArray,i=t.length;for(let s=0;s<i;s++){const n=t[s];this.oL(n)}}Tg(t){super.Tg(t);const i=this.getKeyForNodeData(t),s=this.lw(i);if(s!==null){const n=r.nt(),o=s.iterator;for(;o.next();){const a=o.value;if(this.containsNodeData(a)){if(this.getGroupKeyForNodeData(a)===i){const l=this.Vn;this.Ft("nodeGroupKey",2,l,a,i,i),typeof l=="string"&&this.updateTargetBindings(a,l),n.push(a)}}else{if(this.Vi(a,!0)===i){const h=this.Lo;this.Ft("linkFromKey",2,h,a,i,i),typeof h=="string"&&this.updateTargetBindings(a,h),n.push(a)}if(this.Vi(a,!1)===i){const h=this.Ao;this.Ft("linkToKey",2,h,a,i,i),typeof h=="string"&&this.updateTargetBindings(a,h),n.push(a)}const l=this.getLabelKeysForLinkData(a);if(Array.isArray(l)){const h=l.length,d=this.cn;for(let f=0;f<h;f++)l[f]===i&&(this.Ft("linkLabelKeys",3,d,a,i,i,f,f),n.push(a))}}}for(let a=0;a<n.length;a++)this.an(i,n[a]);r.Z(n)}}Dg(t){super.Dg(t);const i=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(i)===null&&this.hn(i,t)}gw(t){super.gw(t);const i=this.getGroupKeyForNodeData(t);this.an(i,t)}get linkCategoryProperty(){return this.cc}set linkCategoryProperty(t){const i=this.cc;i!==t&&(this.Un(t,_e,"linkCategoryProperty"),this.cc=t,this.t("linkCategoryProperty",i,t))}getCategoryForLinkData(t){if(t===null)return"";const i=this.cc;if(i==="")return"";const s=this.St(t,i);if(s===void 0)return"";if(typeof s=="string")return s;r.o("getCategoryForLinkData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(t===null)return;const s=this.cc;if(s==="")return;if(!this.containsLinkData(t)){this.et(t,s,i);return}let n=this.St(t,s);n===void 0&&(n=""),n!==i&&(this.et(t,s,i),this.Ft("linkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setCategoryForLinkData(t,i)}Ag(t,i){super.Ag(t,i),this.setGroupKeyForNodeData(i,this.getGroupKeyForNodeData(t))}tF(t,i){this.setCategoryForLinkData(i,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(i,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(i,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(i,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(i,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(i,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}Um(){return!0}Wh(){return!0}Ax(){return!0}uf(){return!0}};y(_e,"EmptyArray",Object.freeze([]));let Po=_e;Ne.Sl(Po,"GraphLinksModel"),Ne.jv=()=>new Po,Ne.m2=()=>new Po;class Mo extends Ne{constructor(t,i){super();y(this,"Bn");y(this,"Fg");y(this,"fc");if(this.Bn="parent",this.Fg=!1,this.fc="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Bn=this.Bn,t.Fg=this.Fg,t.fc=this.fc}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" TreeModel";if(t>0){i+=`
 node data:`;const s=this.nodeDataArray,n=s.length;for(let o=0;o<n;o++){const a=s[o];i+=" "+this.getKeyForNodeData(a)+":"+Qs.toString(a)}}return i}}Lg(){const t=super.Lg();let i="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(i+=`,
  "nodeParentKeyProperty": `+this.zi(this.nodeParentKeyProperty)),t+i}fw(t){super.fw(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}uw(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&r.o("applyIncrementalJson cannot change Model properties"),super.uw(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Bn}set nodeParentKeyProperty(t){const i=this.Bn;i!==t&&(this.Un(t,Mo,"nodeParentKeyProperty"),this.Bn=t,this.t("nodeParentKeyProperty",i,t))}get copiesParentKeyOfNodeData(){return this.Fg}set copiesParentKeyOfNodeData(t){this.Fg!==t&&(this.Fg=t)}getParentKeyForNodeData(t){if(t===null)return;const i=this.Bn;if(i==="")return;const s=this.St(t,i);if(s!==void 0){if(this.isKeyType(s))return s;r.o("ParentKey value for node data "+t+" is not a number or a string: "+s)}}setParentKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&r.si(i,"number or string",Mo,"setParentKeyForNodeData:key"),t===null)return;const s=this.Bn;if(s==="")return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t)){this.et(t,s,i);return}const n=this.St(t,s);n!==i&&(this.an(n,t),this.et(t,s,i),this.findNodeDataForKey(i)===null&&this.hn(i,t),this.Ft("nodeParentKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get parentLinkCategoryProperty(){return this.fc}set parentLinkCategoryProperty(t){const i=this.fc;i!==t&&(this.Un(t,Mo,"parentLinkCategoryProperty"),this.fc=t,this.t("parentLinkCategoryProperty",i,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const i=this.fc;if(i==="")return"";const s=this.St(t,i);if(s===void 0)return"";if(typeof s=="string")return s;r.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(t===null)return;const s=this.fc;if(s==="")return;if(!this.containsNodeData(t)){this.et(t,s,i);return}let n=this.St(t,s);n===void 0&&(n=""),n!==i&&(this.et(t,s,i),this.Ft("parentLinkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setParentLinkCategoryForNodeData(t,i)}copyNodeData(t){const i=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Bn!==""&&this.St(i,this.Bn)!==void 0&&this.et(i,this.Bn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,s);return}else if(i===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,s);return}}const n=this.St(t,i);n!==s&&(this.et(t,i,s),this.raiseDataChanged(t,i,n,s))}dw(t,i){super.dw(t,i);const s=this.be.iterator;for(;s.next();){const n=s.value;this.rL(n,t,i)}}rL(t,i,s){if(this.getParentKeyForNodeData(t)===i){const n=this.Bn;this.et(t,n,s),this.Ft("nodeParentKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}Tg(t){super.Tg(t);const i=this.getKeyForNodeData(t),s=this.lw(i);if(s!==null){const n=r.nt(),o=s.iterator;for(;o.next();){const a=o.value;if(this.containsNodeData(a)&&this.getParentKeyForNodeData(a)===i){const l=this.Bn;this.Ft("nodeParentKey",2,l,a,i,i),typeof l=="string"&&this.updateTargetBindings(a,l),n.push(a)}}for(let a=0;a<n.length;a++)this.an(i,n[a]);r.Z(n)}}Dg(t){super.Dg(t);let i=this.getParentKeyForNodeData(t);i=this.maybeEnsureLinkReference(i),this.findNodeDataForKey(i)===null&&this.hn(i,t)}gw(t){super.gw(t);const i=this.getParentKeyForNodeData(t);this.an(i,t)}Ag(t,i){super.Ag(t,i),this.setParentLinkCategoryForNodeData(i,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(i,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}Vm(){return!0}Ax(){return!0}}Ne.Sl(Mo,"TreeModel");var gh=(M=>(M[M.ConstantSpacing=0]="ConstantSpacing",M[M.ConstantDistance=1]="ConstantDistance",M[M.ConstantAngle=2]="ConstantAngle",M[M.Packed=3]="Packed",M))(gh||{}),mh=(M=>(M[M.Clockwise=10]="Clockwise",M[M.Counterclockwise=11]="Counterclockwise",M[M.BidirectionalLeft=12]="BidirectionalLeft",M[M.BidirectionalRight=13]="BidirectionalRight",M))(mh||{}),ph=(M=>(M[M.Forwards=20]="Forwards",M[M.Reverse=21]="Reverse",M[M.Ascending=22]="Ascending",M[M.Descending=23]="Descending",M[M.Optimized=24]="Optimized",M))(ph||{}),yh=(M=>(M[M.Pythagorean=30]="Pythagorean",M[M.Circular=31]="Circular",M))(yh||{});class Ai extends bi{constructor(t){super();y(this,"gi");y(this,"tu");y(this,"Uk");y(this,"Rg");y(this,"Vk");y(this,"Ya");y(this,"lL");y(this,"aL");y(this,"hL");y(this,"Es");y(this,"mw");y(this,"pw");y(this,"uc");y(this,"yw");y(this,"eF");y(this,"Og");y(this,"Ig");y(this,"Eg");y(this,"eu");y(this,"He");y(this,"P");y(this,"Si");y(this,"Mi");y(this,"En");y(this,"Ug");this.gi=0,this.tu=0,this.Uk=0,this.Rg=360,this.Vk=0,this.Ya=0,this.lL=new L,this.aL=30,this.hL=0,this.Es=0,this.mw=0,this.pw=new Wu,this.uc=0,this.yw=0,this.eF=600,this.Og=NaN,this.Ig=1,this.Eg=0,this.eu=360,this.He=0,this.P=10,this.Si=24,this.Mi=kn.standardComparer,this.En=6,this.Ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Og=this.Og,t.Ig=this.Ig,t.Eg=this.Eg,t.eu=this.eu,t.He=this.He,t.P=this.P,t.Si=this.Si,t.Mi=this.Mi,t.En=this.En,t.Ug=this.Ug}fe(t){t in ph?this.sorting=t:t in mh?this.direction=t:t in gh?this.arrangement=t:t in yh?this.nodeDiameterFormula=t:super.fe(t)}createNetwork(){return new Ju(this)}d3(t,i,s){t=this.g3(t);let n=this.Vk,o=this.aL,a=this.gi,l=this.tu,h=this.Uk,d=this.Rg,f=this.Ya,m=this.hL,p=this.Es,b=this.mw;if(n=this.arrangement,o=this.nodeDiameterFormula,a=this.radius,(!isFinite(a)||a<=0)&&(a=NaN),l=this.aspectRatio,(!isFinite(l)||l<=0)&&(l=1),h=this.startAngle,isFinite(h)||(h=0),d=this.sweepAngle,(!isFinite(d)||d>360||d<1)&&(d=360),f=this.spacing,isFinite(f)||(f=NaN),n===3&&o===31?n=0:n===3&&o!==31&&(o=31,n=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let S=0;!(S>=t.length||(i.add(t.elt(S)),S+1>=t.length));S+=2)s.add(t.elt(S+1));this.direction===12?(this.arrangement===3&&i.reverse(),t=new E,t.addAll(i),t.addAll(s)):(this.arrangement===3&&s.reverse(),t=new E,t.addAll(s),t.addAll(i))}const x=t.length;m=0;let v=0;for(let S=0;S<t.length;S++){const P=h+d*v*(this.direction===10?1:-1)/x;let T=t.elt(S).diameter;isNaN(T)&&(T=t.elt(S).Ka(P)),d<360&&(S===0||S===t.length-1)&&(T/=2),m+=T,v++}if(isNaN(a)||n===3){if(isNaN(f)&&(f=6),n!==0&&n!==3){let S=-1/0;for(let P=0;P<x;P++){const T=t.elt(P),A=t.elt(P===x-1?0:P+1);isNaN(T.diameter)&&T.Ka(0),isNaN(A.diameter)&&A.Ka(0),S=Math.max(S,(T.diameter+A.diameter)/2)}if(b=S+f,n===2){const P=2*Math.PI/x,T=(S+f)/P;l>1?(a=T,p=a*l):(p=T,a=p)}else a=this.Bk(b*(d>=360?x:x-1),l,h*Math.PI/180,d*Math.PI/180)}else a=this.Bk(m+(d>=360?x:x-1)*(n!==3?f:f*1.6),l,h*Math.PI/180,d*Math.PI/180);p=a*l}else{p=a*l;const S=this.cL(a,p,h*Math.PI/180,d*Math.PI/180);if(isNaN(f))n===0&&(f=(S-m)/(d>=360?x:x-1));else if(n===0){const P=(S-m)/(d>=360?x:x-1);P<f?(a=this.Bk(m+f*(d>=360?x:x-1),l,h*Math.PI/180,d*Math.PI/180),p=a*l):f=P}else{let P=-1/0;for(let C=0;C<x;C++){const O=t.elt(C),R=t.elt(C===x-1?0:C+1);isNaN(O.diameter)&&O.Ka(0),isNaN(R.diameter)&&R.Ka(0),P=Math.max(P,(O.diameter+R.diameter)/2)}const T=P+f,A=this.Bk(T*(d>=360?x:x-1),l,h*Math.PI/180,d*Math.PI/180);A>a?(a=A,p=a*l,b=T):b=S/(d>=360?x:x-1)}}return this.Vk=n,this.aL=o,this.gi=a,this.tu=l,this.Uk=h,this.Rg=d,this.Ya=f,this.hL=m,this.Es=p,this.mw=b,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(i.count===1){const b=i.first();b.centerX=0,b.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let s=new E;s.addAll(i.iterator);const n=new E,o=new E;s=this.d3(s,n,o);const a=this.Vk,l=this.gi,h=this.Uk,d=this.Rg,f=this.Ya,m=this.Es,p=this.mw;if((this.direction===12||this.direction===13)&&a===3)this.iF(s,d,h-d/2,10);else if(this.direction===12||this.direction===13){let b=0;switch(a){case 1:b=this.zk(l,m,h,p)*180/Math.PI;break;case 0:{let x=0,v=0;const S=n.first();S!==null&&(x=S.Ka(Math.PI/2));const P=o.first();P!==null&&(v=P.Ka(Math.PI/2)),b=this.zk(l,m,h,f+(x+v)/2)*180/Math.PI;break}case 2:b=d/s.length;break}if(this.direction===12){switch(a){case 1:this.ww(n,d/2,h,11);break;case 0:this.xw(n,d/2,h,11);break;case 2:this.bw(n,d/2,h,11);break}switch(a){case 1:this.ww(o,d/2,h+b,10);break;case 0:this.xw(o,d/2,h+b,10);break;case 2:this.bw(o,d/2,h+b,10);break}}else{switch(a){case 1:this.ww(o,d/2,h,11);break;case 0:this.xw(o,d/2,h,11);break;case 2:this.bw(o,d/2,h,11);break}switch(a){case 1:this.ww(n,d/2,h+b,10);break;case 0:this.xw(n,d/2,h+b,10);break;case 2:this.bw(n,d/2,h+b,10);break}}}else switch(a){case 1:this.ww(s,d,h,this.direction);break;case 0:this.xw(s,d,h,this.direction);break;case 2:this.bw(s,d,h,this.direction);break;case 3:this.iF(s,d,h,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}bw(t,i,s,n){const o=this.Rg,a=this.gi,l=this.Es,h=s*Math.PI/180,d=i*Math.PI/180,f=t.length;for(let m=0;m<f;m++){const p=h+(n===10?m*d/(o>=360?f:f-1):-(m*d)/f),b=t.elt(m),x=a*Math.tan(p)/l,v=Math.sqrt((a*a+l*l*x*x)/(1+x*x));b.centerX=v*Math.cos(p),b.centerY=v*Math.sin(p),b.actualAngle=p*180/Math.PI}}xw(t,i,s,n){const o=this.gi,a=this.Es,l=this.Ya;let h=s*Math.PI/180;const d=t.length;for(let f=0;f<d;f++){const m=t.elt(f),p=t.elt(f===d-1?0:f+1),b=o*Math.cos(h),x=a*Math.sin(h);m.centerX=b,m.centerY=x,m.actualAngle=h*180/Math.PI,isNaN(m.diameter)&&m.Ka(0),isNaN(p.diameter)&&p.Ka(0);const v=(m.diameter+p.diameter)/2,S=this.zk(o,a,n===10?h:-h,v+l);h+=n===10?S:-S}}ww(t,i,s,n){const o=this.gi,a=this.Es,l=this.mw;let h=s*Math.PI/180;const d=t.length;for(let f=0;f<d;f++){const m=t.elt(f);m.centerX=o*Math.cos(h),m.centerY=a*Math.sin(h),m.actualAngle=h*180/Math.PI;const p=this.zk(o,a,n===10?h:-h,l);h+=n===10?p:-p}}iF(t,i,s,n){let o=this.yw;const a=this.Rg;if(this.uc=0,this.pw=new Wu,i<360){for(o=s+(n===10?a:-a);o<0;)o+=360;o%=360,o>180&&(o-=360),o*=Math.PI/180,this.yw=o,this.sF(t,i,s,n)}else this.nF(t,i,s,n);this.pw.commit(t)}nF(t,i,s,n){const o=this.gi,a=this.Es,l=this.Ya,h=this.tu;let d=o*Math.cos(s*Math.PI/180),f=a*Math.sin(s*Math.PI/180);const m=t.toArray();if(m.length===3){m[0].centerX=o,m[0].centerY=0,m[1].centerX=m[0].centerX-m[0].width/2-m[1].width/2-l,m[1].y=m[0].y,m[2].centerX=(m[0].centerX+m[1].centerX)/2,m[2].y=m[0].y-m[2].height-l;return}else if(m.length===4){m[0].centerX=o,m[0].centerY=0,m[2].centerX=-m[0].centerX,m[2].centerY=m[0].centerY,m[1].centerX=0,m[1].y=Math.min(m[0].y,m[2].y)-m[1].height-l,m[3].centerX=0,m[3].y=Math.max(m[0].y+m[0].height+l,m[2].y+m[2].height+l);return}const p=L.l();for(let O=0;O<m.length&&(m[O].centerX=d,m[O].centerY=f,!(O>=m.length-1));O++)this.oF(d,f,m,O,n,p)||this.rF(d,f,m,O,n,p),d=p.x,f=p.y;if(L.i(p),this.uc++,this.uc>23)return;const b=m[0].centerX,x=m[0].centerY,v=m[m.length-1].centerX,S=m[m.length-1].centerY;let P=Math.abs(b-v)-((m[0].width+m[m.length-1].width)/2+l);const T=Math.abs(x-S)-((m[0].height+m[m.length-1].height)/2+l);let A=0;if(Math.abs(T)<1){const O=Math.abs(b-v),R=(m[0].width+m[m.length-1].width)/2;O<R&&(A=0),P=O-R}else T>0?A=T:Math.abs(P)<1?A=0:A=P;let C=!1;Math.abs(v)>Math.abs(S)?C=v>0!=x>S:C=S>0!=b<v,C=n===10?C:!C,C&&(A=-Math.abs(A),A=Math.min(A,-m[m.length-1].width),A=Math.min(A,-m[m.length-1].height)),this.pw.m3(A,m),Math.abs(A)>1&&(this.uc<8?this.gi-=A/(2*Math.PI):m.length<5&&A>10?this.gi/=2:this.gi-=A>0?1.7:-2.3,this.Es=this.gi*h,this.nF(t,i,s,n))}sF(t,i,s,n){const o=this.gi,a=this.Es,l=this.tu;let h=o*Math.cos(s*Math.PI/180),d=a*Math.sin(s*Math.PI/180);const f=L.l(),m=t.toArray();for(let v=0;v<m.length&&(m[v].centerX=h,m[v].centerY=d,!(v>=m.length-1));v++)this.oF(h,d,m,v,n,f)||this.rF(h,d,m,v,n,f),h=f.x,d=f.y;if(L.i(f),this.uc++,this.uc>23)return;const p=Math.atan2(d,h);let b=n===10?this.yw-p:p-this.yw;b=Math.abs(b)<Math.abs(b-2*Math.PI)?b:b-2*Math.PI;const x=b*(o+a)/2;this.pw.p3(x,m),Math.abs(x)>1&&(this.uc<8?this.gi-=x/(2*Math.PI):this.gi-=x>0?1.7:-2.3,this.Es=this.gi*l,this.sF(t,i,s,n))}oF(t,i,s,n,o,a){const l=this.Ya,h=this.gi,d=this.Es;let f=0,m=0;const p=(s[n].width+s[n+1].width)/2+l;let b=!1;if(i>=0!=(o===10)){if(f=t+p,f>h){if(f=t-p,f<-h)return a.x=f,a.y=m,!1;b=!0}}else if(f=t-p,f<-h){if(f=t+p,f>h)return a.x=f,a.y=m,!1;b=!0}return m=Math.sqrt(1-Math.min(1,f*f/(h*h)))*d,i<0!==b&&(m=-m),Math.abs(i-m)>(s[n].height+s[n+1].height)/2?(a.x=f,a.y=m,!1):(a.x=f,a.y=m,!0)}rF(t,i,s,n,o,a){const l=this.Ya,h=this.gi,d=this.Es;let f=0,m=0;const p=(s[n].height+s[n+1].height)/2+l;let b=!1;if(t>=0!=(o===10)){if(m=i-p,m<-d){if(m=i+p,m>d)return a.x=f,a.y=m,!1;b=!0}}else if(m=i+p,m>d){if(m=i-p,m<-d)return a.x=f,a.y=m,!1;b=!0}return f=Math.sqrt(1-Math.min(1,m*m/(d*d)))*h,t<0!==b&&(f=-f),Math.abs(t-f)>(s[n].width+s[n+1].width)/2?(a.x=f,a.y=m,!1):(a.x=f,a.y=m,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let s=this.actualCenter;if(t?s=new L(0,0):(s.x=this.arrangementOrigin.x+this.gi,s.y=this.arrangementOrigin.y+this.Es),this.network!==null){const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;o.x+=s.x,o.y+=s.y,o.commit()}}if(t&&this.group&&i){this.group.ensureBounds();const n=this.group.position.copy(),o=this.group.location.copy(),a=i.subtract(o.subtract(n));this.group.move(a),this.lL=a.subtract(n)}}commitLinks(){if(this.network!==null){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}cL(t,i,s,n){const o=this.eF;if(Math.abs(this.tu-1)<.001)return s!==void 0&&n!==void 0?n*t:2*Math.PI*t;const a=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let l=0,h=0;s!==void 0&&n!==void 0?h=n/(o+1):h=Math.PI/(2*(o+1));let d=0;for(let f=0;f<=o;f++){s!==void 0&&n!==void 0?d=s+f*n/o:d=f*Math.PI/(2*o);const m=Math.sin(d);l+=Math.sqrt(1-a*a*m*m)*h}return s!==void 0&&n!==void 0?(t>i?t:i)*l:4*(t>i?t:i)*l}Bk(t,i,s,n){let o=0;return s!==void 0&&n!==void 0?o=this.cL(1,i,s,n):o=this.cL(1,i),t/o}zk(t,i,s,n){if(Math.abs(this.tu-1)<.001)return n/t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let a=0;const l=2*Math.PI/(this.network.vertexes.count*700);t>i&&(s+=Math.PI/2);for(let h=0;;h++){const d=s+h*l,f=Math.sin(d);if(a+=(t>i?t:i)*Math.sqrt(1-o*o*f*f)*l,a>=n)return h*l}}g3(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.y3(this.w3(t));default:r.o("Invalid sorting type.")}return t}w3(t){const i=[];for(let n=0;n<t.length;n++)i.push(0);const s=new E;for(let n=0;n<t.length;n++){let o=-1,a=-1;if(n===0)for(let m=0;m<t.length;m++){const p=t.elt(m).edgesCount;p>o&&(o=p,a=m)}else for(let m=0;m<t.length;m++){const p=i[m];p>o&&(o=p,a=m)}s.add(t.elt(a)),i[a]=-1;const l=t.elt(a);let h=0;const d=l.sourceEdges;for(;d.next();){const m=d.value.fromVertex;h=t.indexOf(m),!(h<0)&&i[h]>=0&&i[h]++}const f=l.destinationEdges;for(;f.next();){const m=f.value.toVertex;h=t.indexOf(m),!(h<0)&&i[h]>=0&&i[h]++}}return s}y3(t){const i=[];for(let p=0;p<t.length;p++){const b=t.elt(p);i[p]=[];let x=0;const v=b.destinationEdges;for(;v.next();){const P=v.value.toVertex;x=t.indexOf(P),x!==p&&i[p].indexOf(x)<0&&i[p].push(x)}const S=b.sourceEdges;for(;S.next();){const P=S.value.fromVertex;x=t.indexOf(P),x!==p&&i[p].indexOf(x)<0&&i[p].push(x)}}const s=[];for(let p=0;p<i.length;p++)s[p]=0;const n=[],o=[],a=[],l=[],h=new E;let d=0;for(let p=0;p<i.length;p++){const b=i[p].length;if(b===1){l.push(p);continue}if(b===0){h.add(t.elt(p));continue}if(d===0){n.push(p),d++;continue}let x=1/0,v=1/0,S=-1;const P=[];for(let T=0;T<n.length;T++)i[n[T]].indexOf(n[T===n.length-1?0:T+1])<0&&P.push(T===n.length-1?0:T+1);if(P.length===0)for(let T=0;T<n.length;T++)P.push(T);for(let T=0;T<P.length;T++){const A=P[T],C=this.x3(i[p],o,a,s,A,n);let O=0;for(let R=0;R<i[p].length;R++){const I=i[p][R],H=n.indexOf(I);if(H>=0){const V=Math.abs(A-(H>=A?H+1:H));O+=V<n.length+1-V?V:n.length+1-V}}for(let R=0;R<o.length;R++){let I=s[o[R]],H=s[a[R]];if(I>=A&&I++,H>=A&&H++,I>H){const V=H;H=I,I=V}H-I<(n.length+2)/2==(I<A&&A<=H)&&O++}(C<x||C===x&&O<v)&&(x=C,v=O,S=A)}n.splice(S,0,p);for(let T=0;T<n.length;T++)s[n[T]]=T;for(let T=0;T<i[p].length;T++){const A=i[p][T];n.indexOf(A)>=0&&(o.push(p),a.push(A))}d++}let f=!1;const m=n.length;for(;;){f=!0;for(let p=0;p<l.length;p++){const b=l[p],x=i[b][0],v=n.indexOf(x);if(v>=0){let S=0;for(let P=0;P<i[x].length;P++){const T=i[x][P],A=n.indexOf(T);if(A<0||A===v)continue;const C=A>v?A-v:v-A,O=m-C;S+=A<v!=C>O?1:-1}n.splice(S<0?v:v+1,0,b),l.splice(p,1),p--}else f=!1}if(f)break;n.push(l[0]),l.splice(0,1)}for(let p=0;p<n.length;p++){const b=n[p];h.add(t.elt(b))}return h}x3(t,i,s,n,o,a){let l=0;for(let h=0;h<i.length;h++){const d=i[h],f=s[h],m=n[d],p=n[f];let b=0,x=0;if(m<p?(b=m,x=p):(b=p,x=m),b<o&&o<=x)for(let v=0;v<t.length;v++){const S=t[v];a.indexOf(S)<0||b<n[S]&&n[S]<x||b===n[S]||x===n[S]||l++}else for(let v=0;v<t.length;v++){const S=t[v];a.indexOf(S)<0||!(b<n[S]&&n[S]<x)||b===n[S]||x===n[S]||l++}}return l}get radius(){return this.Og}set radius(t){this.Og!==t&&(t>0||isNaN(t))&&(this.Og=t,this.p())}get aspectRatio(){return this.Ig}set aspectRatio(t){this.Ig!==t&&t>0&&(this.Ig=t,this.p())}get startAngle(){return this.Eg}set startAngle(t){this.Eg!==t&&(this.Eg=t,this.p())}get sweepAngle(){return this.eu}set sweepAngle(t){this.eu!==t&&(t>0&&t<=360?this.eu=t:this.eu=360,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===3||t===0||t===1||t===2)&&(this.He=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(t===10||t===11||t===12||t===13)&&(this.P=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t,this.p())}get spacing(){return this.En}set spacing(t){this.En!==t&&(this.En=t,this.p())}get nodeDiameterFormula(){return this.Ug}set nodeDiameterFormula(t){this.Ug!==t&&(t===30||t===31)&&(this.Ug=t,this.p())}get actualXRadius(){return this.gi}get actualYRadius(){return this.Es}get actualSpacing(){return this.Ya}get actualCenter(){return this.lL}}y(Ai,"ConstantSpacing",0),y(Ai,"ConstantDistance",1),y(Ai,"ConstantAngle",2),y(Ai,"Packed",3),y(Ai,"Clockwise",10),y(Ai,"Counterclockwise",11),y(Ai,"BidirectionalLeft",12),y(Ai,"BidirectionalRight",13),y(Ai,"Forwards",20),y(Ai,"Reverse",21),y(Ai,"Ascending",22),y(Ai,"Descending",23),y(Ai,"Optimized",24),y(Ai,"Pythagorean",30),y(Ai,"Circular",31);class Wu{constructor(){y(this,"iu");y(this,"dc");y(this,"su");this.iu=-1/0,this.dc=null,this.su=null}m3(e,t){if(e>0&&this.iu<0||Math.abs(e)<Math.abs(this.iu)&&!(e<0&&this.iu>0)){this.iu=e,this.dc=[],this.su=[];for(let i=0;i<t.length;i++)this.dc[i]=t[i].bounds.x,this.su[i]=t[i].bounds.y}}p3(e,t){if(Math.abs(e)<Math.abs(this.iu)){this.iu=e,this.dc=[],this.su=[];for(let i=0;i<t.length;i++)this.dc[i]=t[i].bounds.x,this.su[i]=t[i].bounds.y}}commit(e){if(!(this.dc===null||this.su===null))for(let t=0;t<this.dc.length;t++){const i=e.elt(t);i.x=this.dc[t],i.y=this.su[t]}}}class Ju extends vn{constructor(e){super(e)}createVertex(){return new Zu(this)}createEdge(){return new Qu(this)}}class Zu extends kn{constructor(t){super(t);y(this,"To");y(this,"Xk");this.To=NaN,this.Xk=NaN}Ka(t){const i=this.network;if(i===null)return NaN;const s=i.layout;if(s===null)return NaN;if(s.arrangement===3){if(s.nodeDiameterFormula===31)return this.To=Math.max(this.width,this.height),this.To;{const n=Math.abs(Math.sin(t)),o=Math.abs(Math.cos(t));return n===0?this.width:o===0?this.height:(this.To=Math.min(this.height/n,this.width/o),this.To)}}else return s.nodeDiameterFormula===31?(this.To=Math.max(this.width,this.height),this.To):(this.To=Math.sqrt(this.width*this.width+this.height*this.height),this.To)}get diameter(){return this.To}set diameter(t){this.To!==t&&(this.To=t)}get actualAngle(){return this.Xk}set actualAngle(t){this.Xk!==t&&(this.Xk=t)}}class Qu extends ko{constructor(e){super(e)}}class Hp extends bi{constructor(t){super();y(this,"kw");y(this,"Ha");y(this,"Us");y(this,"Vg");y(this,"zn");y(this,"Xi");y(this,"Bg");y(this,"zg");y(this,"Xg");y(this,"nu");y(this,"Gg");y(this,"Yg");y(this,"ou");y(this,"ru");y(this,"lu");y(this,"au");y(this,"Kg");y(this,"Hg");y(this,"hu");y(this,"gc");this.kw=0,this.Ha=0,this.Us=new _(100,100).k(),this.Vg=!1,this.zn=!0,this.Xi=!1,this.Bg=100,this.zg=300,this.Xg=1,this.nu=1e3,this.Gg=10,this.Yg=Math,this.ou=.05,this.ru=50,this.lu=150,this.au=0,this.Kg=10,this.Hg=5,this.hu=NaN,this.gc=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Us.h(this.Us),t.Vg=this.Vg,t.zn=this.zn,t.Xi=this.Xi,t.Bg=this.Bg,t.zg=this.zg,t.Xg=this.Xg,t.nu=this.nu,t.Gg=this.Gg,t.Yg=this.Yg,t.ou=this.ou,t.ru=this.ru,t.lu=this.lu,t.au=this.au,t.Kg=this.Kg,t.Hg=this.Hg,t.hu=this.hu,t.gc=this.gc}createNetwork(){return new _u(this)}doLayout(t){this.network=this.makeNetwork(t);let i=this.network.vertexes.iterator;const s=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),i=this.network.vertexes.iterator;i.next();){const o=i.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const n=this.network.edges.iterator;for(;n.next();){const o=n.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.fL(),this.Ha=0,this.needsPrelayout()){const o=this.network,a=o.splitIntoSubNetworks(!1);let l=a.iterator;for(;l.next();){const h=l.value;this.doConnectedSubnetLayout(h)}for(l=a.iterator,this.b3(l,o),l=a.iterator;l.next();){const h=l.value,d=h.vertexes.iterator;for(;d.next();){const m=d.value;o.addVertex(m)}const f=h.edges.iterator;for(;f.next();){const m=f.value;o.addEdge(m)}}}else this.lF(this.network,this.maxIterations);this.updateParts()}this.maxIterations=s,this.isValidLayout=!0}needsPrelayout(){if(this.network===null||this.network.vertexes.count<3)return!1;let t=0,i=0;const s=this.network.vertexes.first().bounds,n=this.network.vertexes.iterator;for(;n.next();){const o=n.value,a=o.bounds;if(isNaN(o.x)||isNaN(o.y)||a.intersectsRect(s)&&(t++,t>2))return!0;if(i>10)return!1;i++}return!1}doConnectedSubnetLayout(t){let i=t.vertexes.iterator;for(;i.next();){const h=i.value;h.hierarchicalVertexes.add(h)}let s=t,n=this.hu;if(isNaN(n)&&(n=t.edges.count/t.vertexes.count),n<t.vertexes.count)for(;s.vertexes.count>Math.max(100,Math.sqrt(n*t.vertexes.count));)s=this.coarsenNetwork(s);let o=0;i=s.vertexes.iterator;let a=this.randomNumberGenerator;for(a===null&&(this.randomNumberGenerator=a=new id(0));i.next();){i.value.idInCluster=o++;const h=10*(a.random()-.5),d=10*(a.random()-.5);this.isFixed(i.value)||(i.value.x=h,i.value.y=d);const f=i.value.hierarchicalVertexes.iterator;for(;f.next();)this.isFixed(f.value)||(f.value.x=h,f.value.y=d)}const l=this.computePairwiseDistances(s);this.k3(s,l,this.maxPrelayoutIterations,t.vertexes.count),this.lF(t,this.maxIterations)}computePairwiseDistances(t){const i=t.vertexes.count,s=new Array(i);for(let l=0;l<i;l++)s[l]=new Array(i).fill(-1),s[l][l]=0;const n=t.vertexes.iterator;let o=new Map,a=[];for(;n.next();){const l=n.value;for(a=[l],o=new Map,o.set(l.idInCluster,0);a.length>0;){const h=a.shift(),d=h.vertexes.iterator;for(;d.next();){const f=d.value;o.has(f.idInCluster)||(o.set(f.idInCluster,o.get(h.idInCluster)+1),a.push(f))}}for(let h=0;h<i;h++){const d=Math.min(s[l.idInCluster][h],s[h][l.idInCluster]),f=o.get(h);(d<0||f<d)&&(s[l.idInCluster][h]=f,s[h][l.idInCluster]=f)}}return s}coarsenNetwork(t){const i=this.createNetwork(),s=new Map;let n=0,o=t.vertexes.iterator;for(;o.next();)o.value.idInCluster=n++;for(o=t.vertexes.iterator;o.next();){const l=o.value;if(s.has(l.idInCluster))continue;let h=Number.MAX_SAFE_INTEGER,d=null;const f=l.vertexes.iterator;for(;f.next();){const p=f.value;s.has(p.idInCluster)||p.hierarchicalVertexes.length<h&&(h=p.hierarchicalVertexes.length,d=p)}const m=i.createVertex();m.hierarchicalVertexes.addAll(l.hierarchicalVertexes),d!=null&&m.hierarchicalVertexes.addAll(d.hierarchicalVertexes),s.set(l.idInCluster,m),d!=null&&s.set(d.idInCluster,m),i.addVertex(m)}const a=t.edges.iterator;for(;a.next();){const l=a.value,h=s.get(l.fromVertex.idInCluster),d=s.get(l.toVertex.idInCluster);if(h===d)continue;const f=i.createEdge();f.fromVertex=h||null,f.toVertex=d||null,i.addEdge(f)}return i}cx(t,i){let s=!0;const n=t.vertexes.iterator;for(;n.next();){const o=n.value;s?(s=!1,i.set(o.bounds)):i.unionRect(o.bounds)}return i}b3(t,i){const s=this.arrangementSpacing,n=t.count;let o=!0,a=0,l=0;const h=r.nt();for(let p=0;p<n+i.vertexes.count+2;p++)h[p]=null;let d=0;t.reset();const f=Y.l();let m;for(;t.next();){const p=t.value;if(this.cx(p,f),o)o=!1,a=f.x+f.width/2,l=f.y+f.height/2,h[0]=new L(f.x+f.width+s.width,f.y),h[1]=new L(f.x,f.y+f.height+s.height),d=2;else{const b=this.aF(h,d,a,l,f.width,f.height,s),x=h[b],v=new L(x.x+f.width+s.width,x.y),S=new L(x.x,x.y+f.height+s.height);b+1<d&&h.splice(b+1,0,null),h[b]=v,h[b+1]=S,d++;const P=x.x-f.x,T=x.y-f.y;for(m=p.vertexes.iterator;m.next();){const A=m.value;this.isFixed(A)||(A.centerX+=P,A.centerY+=T)}}}for(Y.i(f),m=i.vertexes.iterator;m.next();){const p=m.value,b=p.bounds;if(d<2){a=b.x+b.width/2,l=b.y+b.height/2,h[0]=new L(b.x+b.width+s.width,b.y),h[1]=new L(b.x,b.y+b.height+s.height),d=2;continue}const x=this.aF(h,d,a,l,b.width,b.height,s),v=h[x],S=new L(v.x+b.width+s.width,v.y),P=new L(v.x,v.y+b.height+s.height);x+1<d&&h.splice(x+1,0,null),h[x]=S,h[x+1]=P,d++,this.isFixed(p)||(p.centerX=v.x+p.width/2,p.centerY=v.y+p.height/2)}r.Z(h)}aF(t,i,s,n,o,a,l){let h=9e19,d=-1;t:for(let f=0;f<i;f++){const m=t[f],p=m.x-s,b=m.y-n,x=p*p+b*b;if(x<h){for(let v=f-1;v>=0;v--)if(t[v].y>m.y&&t[v].x-m.x<o+l.width)continue t;for(let v=f+1;v<i;v++)if(t[v].x>m.x&&t[v].y-m.y<a+l.height)continue t;d=f,h=x}}return d}fL(){if(this.network===null||!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){if(this.network===null)return;const i=t.node;if(i!==null){const s=i.findNodesConnected();for(;s.next();){const n=s.value;if(n.category!=="Comment"||!n.isVisible())continue;let o=this.network.findVertex(n);o===null&&(o=this.network.addNode(n)),o.charge=this.defaultCommentElectricalCharge;let a=null;const l=o.destinationEdges;for(;l.next();){const h=l.value;if(h.toVertex===t){a=h;break}}if(a===null){const h=o.sourceEdges;for(;h.next();){const d=h.value;if(d.fromVertex===t){a=d;break}}}a===null&&(a=this.network.linkVertexes(t,o,null)),a.length=this.defaultCommentSpringLength}}}hF(t,i){const s=t.bounds,n=s.x,o=s.y,a=s.width,l=s.height,h=i.bounds,d=h.x,f=h.y,m=h.width,p=h.height;if(n+a<d)if(o>f+p){const b=n+a-d,x=o-f-p;return B.ix(b*b+x*x)}else if(o+l<f){const b=n+a-d,x=o+l-f;return B.ix(b*b+x*x)}else return d-(n+a);else if(n>d+m)if(o>f+p){const b=n-d-m,x=o-f-p;return B.ix(b*b+x*x)}else if(o+l<f){const b=n-d-m,x=o+l-f;return B.ix(b*b+x*x)}else return n-(d+m);else return o>f+p?o-(f+p):o+l<f?f-(o+l):.1}lF(t,i){const s=this.Ha+i;for(;this.Ha<s&&(this.Ha++,!!this.P3(t)););}P3(t){const i=t.vertexes.toArray();if(i.length<=0)return!1;const s=i[0];s.forceX=0,s.forceY=0;let n=s.centerX,o=n,a=s.centerY,l=a;for(let v=1;v<i.length;v++){const S=i[v];S.forceX=0,S.forceY=0;const P=S.centerX,T=S.centerY;n=Math.min(n,P),o=Math.max(o,P),a=Math.min(a,T),l=Math.max(l,T)}const h=o-n>l-a;h?i.sort((v,S)=>v===null||S===null||v===S?0:v.centerX-S.centerX):i.sort((v,S)=>v===null||S===null||v===S?0:v.centerY-S.centerY);const d=this.nu;let f=0,m=0,p=0;for(let v=0;v<i.length;v++){const S=i[v],P=S.bounds,T=S.focus,A=P.x+T.x,C=P.y+T.y;m=S.charge*this.electricalFieldX(A,C),p=S.charge*this.electricalFieldY(A,C),m+=S.mass*this.gravitationalFieldX(A,C),p+=S.mass*this.gravitationalFieldY(A,C),S.forceX+=m,S.forceY+=p;for(let O=v+1;O<i.length;O++){const R=i[O];if(!this.shouldInteract(S,R)||O===v)continue;const I=R.bounds,H=R.focus,V=I.x+H.x,z=I.y+H.y;if(A-V>d||V-A>d){if(h)break;continue}if(C-z>d||z-C>d){if(!h)break;continue}const K=this.hF(S,R),$=2*S.charge,q=2*R.charge;if(K>1)f=$*q/(K*K),m=f*(A-V)/K,p=f*(C-z)/K;else{let J=this.randomNumberGenerator;J===null&&(this.randomNumberGenerator=J=new id(0));const ot=J.random(),rt=J.random();if(A>V)m=Math.abs(R.bounds.right-S.bounds.x),m=$*q*(1+m)*ot;else if(A<V)m=Math.abs(R.bounds.x-S.bounds.right),m=-($*q)*(1+m)*ot;else{const st=Math.max(R.width,S.width);m=$*q*((1+st)*ot-st/2)}if(C>z)p=Math.abs(R.bounds.bottom-S.bounds.y),p=$*q*(1+p)*rt;else if(A<V)p=Math.abs(R.bounds.y-S.bounds.bottom),p=-($*q)*(1+p)*rt;else{const st=Math.max(R.height,S.height);p=$*q*((1+st)*rt-st/2)}}S.forceX+=m,S.forceY+=p,R.forceX-=m,R.forceY-=p}}const b=t.edges.iterator;for(;b.next();){const v=b.value,S=v.fromVertex,P=v.toVertex,T=S.bounds,A=S.focus,C=T.x+A.x,O=T.y+A.y,R=P.bounds,I=P.focus,H=R.x+I.x,V=R.y+I.y,z=this.hF(S,P);z>1&&(f=.1*v.stiffness*(z-v.length),m=f*.5*(S.width+P.height)*(C-H)/z,p=f*.5*(S.width+P.height)*(O-V)/z),S.forceX-=m,S.forceY-=p,P.forceX+=m,P.forceY+=p}let x=0;for(let v=0;v<i.length;v++){const S=i[v];this.isFixed(S)?this.moveFixedVertex(S):x=Math.max(x,this.moveVertex(S)||0)}return x>this.epsilonDistance*this.epsilonDistance}k3(t,i,s,n){const o=this.Ha+s,a=Math.sqrt(n);this.kw=this.gc*t.vertexes.count;const l=t.vertexes.toArray();let h=0,d=0,f=0;for(;this.Ha<o;){this.Ha++,d=h,h=0;for(let m=0;m<l.length;m++){l[m].forceX=0,l[m].forceY=0;for(let b=0;b<l.length;b++){if(m===b)continue;const x=Math.sqrt((l[m].centerX-l[b].centerX)**2+(l[m].centerY-l[b].centerY)**2),v=i[l[m].idInCluster][l[b].idInCluster],S=(x-this.gc*a*v)/x;l[m].forceX+=S*(l[b].x-l[m].x),l[m].forceY+=S*(l[b].y-l[m].y)}const p=Math.sqrt(l[m].forceX*l[m].forceX+l[m].forceY*l[m].forceY);if(p>0){l[m].forceX=this.kw*l[m].forceX/p,l[m].forceY=this.kw*l[m].forceY/p,this.isFixed(l[m])||(l[m].x+=l[m].forceX,l[m].y+=l[m].forceY);const b=l[m].hierarchicalVertexes.iterator;for(;b.next();){const x=b.value;this.isFixed(x)||(x.centerX+=l[m].forceX,x.centerY+=l[m].forceY)}}h+=p*p}if(h>=d){if(f++,f>=5)break}else f=0;this.kw*=.95}}moveVertex(t){let i=t.forceX,s=t.forceY;const n=this.moveLimit;return i<-n?i=-n:i>n&&(i=n),s<-n?s=-n:s>n&&(s=n),t.centerX+=i,t.centerY+=s,i*i+s*s}shouldInteract(t,i){return!0}moveFixedVertex(t){}commitLayout(){this.Pw(),this.commitNodes(),this.isRouting&&this.commitLinks()}Pw(){if(this.network===null||!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const i=t.value.link;i!==null&&(i.fromSpot=X.Default,i.toSpot=X.Default)}}commitNodes(){if(!this.network)return;let t=0,i=0;if(this.arrangesToOrigin){const o=Y.l();this.cx(this.network,o);const a=this.arrangementOrigin;t=a.x-o.x,i=a.y-o.y,Y.i(o)}const s=Y.l(),n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;(t!==0||i!==0)&&(s.h(o.bounds),s.x+=t,s.y+=i,o.bounds=s),o.commit()}Y.i(s)}commitLinks(){if(!this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const i=t.stiffness;return isNaN(i)?this.ou:i}springLength(t){const i=t.length;return isNaN(i)?this.ru:i}electricalCharge(t){const i=t.charge;return isNaN(i)?this.lu:i}electricalFieldX(t,i){return 0}electricalFieldY(t,i){return 0}gravitationalMass(t){const i=t.mass;return isNaN(i)?this.au:i}gravitationalFieldX(t,i){return 0}gravitationalFieldY(t,i){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Ha}get arrangementSpacing(){return this.Us}set arrangementSpacing(t){this.Us.equals(t)||(this.Us.h(t),this.p())}get arrangesToOrigin(){return this.Vg}set arrangesToOrigin(t){this.Vg!==t&&(this.Vg=t,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(this.zn=t,this.p())}get comments(){return this.Xi}set comments(t){this.Xi!==t&&(this.Xi=t,this.p())}get maxPrelayoutIterations(){return this.Bg}set maxPrelayoutIterations(t){this.Bg!==t&&t>=0&&(this.Bg=t,this.p())}get maxIterations(){return this.zg}set maxIterations(t){this.zg!==t&&t>=0&&(this.zg=t,this.p())}get epsilonDistance(){return this.Xg}set epsilonDistance(t){this.Xg!==t&&t>0&&(this.Xg=t,this.p())}get infinityDistance(){return this.nu}set infinityDistance(t){this.nu!==t&&t>1&&(this.nu=t,this.p())}get moveLimit(){return this.Gg}set moveLimit(t){this.Gg!==t&&(this.Gg=t,this.p())}get randomNumberGenerator(){return this.Yg}set randomNumberGenerator(t){this.Yg!==t&&(t!==null&&!r.st(t.random)&&r.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Yg=t)}get defaultSpringStiffness(){return this.ou}set defaultSpringStiffness(t){this.ou!==t&&(this.ou=t,this.p())}get defaultSpringLength(){return this.ru}set defaultSpringLength(t){this.ru!==t&&(this.ru=t,this.p())}get defaultElectricalCharge(){return this.lu}set defaultElectricalCharge(t){this.lu!==t&&(this.lu=t,this.p())}get defaultGravitationalMass(){return this.au}set defaultGravitationalMass(t){this.au!==t&&(this.au=t,this.p())}get defaultCommentSpringLength(){return this.Kg}set defaultCommentSpringLength(t){this.Kg!==t&&(this.Kg=t,this.p())}get defaultCommentElectricalCharge(){return this.Hg}set defaultCommentElectricalCharge(t){this.Hg!==t&&(this.Hg=t,this.p())}get prelayoutQuality(){return this.hu}set prelayoutQuality(t){this.hu!==t&&(this.hu=t,this.p())}get prelayoutSpread(){return this.gc}set prelayoutSpread(t){this.gc!==t&&(this.gc=t,this.p())}}class _u extends vn{constructor(e){super(e)}createVertex(){return new td(this)}createEdge(){return new ed(this)}}class td extends kn{constructor(t){super(t);y(this,"Gk");y(this,"Yk");y(this,"Kk");y(this,"Hk");y(this,"jk");y(this,"hierarchicalVertexes");y(this,"idInCluster");this.Gk=!1,this.Yk=NaN,this.Kk=NaN,this.Hk=0,this.jk=0,this.hierarchicalVertexes=new E,this.idInCluster=-1}get isFixed(){return this.Gk}set isFixed(t){this.Gk!==t&&(this.Gk=t)}get charge(){return this.Yk}set charge(t){this.Yk!==t&&(this.Yk=t)}get mass(){return this.Kk}set mass(t){this.Kk!==t&&(this.Kk=t)}get forceX(){return this.Hk}set forceX(t){this.Hk!==t&&(this.Hk=t)}get forceY(){return this.jk}set forceY(t){this.jk!==t&&(this.jk=t)}}class ed extends ko{constructor(t){super(t);y(this,"qk");y(this,"Wk");this.qk=NaN,this.Wk=NaN}get stiffness(){return this.qk}set stiffness(t){this.qk!==t&&(this.qk=t)}get length(){return this.Wk}set length(t){this.Wk!==t&&(this.Wk=t)}}class id{constructor(e){y(this,"I");y(this,"R");y(this,"Q");y(this,"M");y(this,"A");y(this,"seed");e===void 0&&(e=42),this.seed=e,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const e=this.seed/this.Q,t=this.seed%this.Q,i=this.A*t-this.R*e;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var wh=(M=>(M[M.DepthFirst=0]="DepthFirst",M[M.Greedy=1]="Greedy",M[M.FromLayers=2]="FromLayers",M))(wh||{}),bh=(M=>(M[M.OptimalLinkLength=10]="OptimalLinkLength",M[M.LongestPathSink=11]="LongestPathSink",M[M.LongestPathSource=12]="LongestPathSource",M))(bh||{}),xh=(M=>(M[M.DepthFirstOut=20]="DepthFirstOut",M[M.DepthFirstIn=21]="DepthFirstIn",M[M.Naive=22]="Naive",M))(xh||{}),vh=(M=>(M[M.None=30]="None",M[M.Less=31]="Less",M[M.More=32]="More",M))(vh||{}),sd=(M=>(M[M.None=0]="None",M[M.Expand=1]="Expand",M[M.Straighten=2]="Straighten",M[M.Median=4]="Median",M[M.MaybeExpand=8]="MaybeExpand",M[M.All=15]="All",M))(sd||{}),nd=(M=>(M[M.None=0]="None",M[M.UpperLeft=1]="UpperLeft",M[M.UpperRight=2]="UpperRight",M[M.LowerLeft=4]="LowerLeft",M[M.LowerRight=8]="LowerRight",M[M.All=15]="All",M))(nd||{});class Je extends bi{constructor(t){super();y(this,"Vs");y(this,"ti");y(this,"P");y(this,"cu");y(this,"fu");y(this,"uu");y(this,"mc");y(this,"du");y(this,"cr");y(this,"gu");y(this,"zn");y(this,"_");y(this,"Sw");y(this,"Bt");y(this,"jg");y(this,"Bs");y(this,"ie");y(this,"zs");y(this,"ms");y(this,"ps");y(this,"Rt");y(this,"qg");y(this,"Wg");y(this,"Jk");y(this,"fn");y(this,"mu");y(this,"fr");y(this,"Xn");y(this,"Gn");y(this,"uL");y(this,"ja");this.Vs=25,this.ti=25,this.P=0,this.cu=0,this.fu=10,this.uu=20,this.mc=4,this.du=31,this.cr=15,this.gu=10,this.zn=!0,this._=-1,this.Sw=-1,this.Bt=-1,this.jg=0,this.Bs=0,this.ie=new Int16Array(0),this.zs=new Float32Array(0),this.ms=new Float32Array(0),this.ps=new Float32Array(0),this.Rt=new Float32Array(0),this.qg=0,this.Wg=new Int16Array(0),this.Jk=new Int16Array(0),this.fn=0,this.mu=null,this.fr=new L,this.Xn=[],this.Xn.length=100,this.Gn=15,this.uL=0,this.ja=!0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Vs=this.Vs,t.ti=this.ti,t.P=this.P,t.cu=this.cu,t.fu=this.fu,t.uu=this.uu,t.mc=this.mc,t.du=this.du,t.cr=this.cr,t.gu=this.gu,t.zn=this.zn,t.Gn=this.Gn,t.ja=this.ja}fe(t){t in vh?this.aggressiveOption=t:t in wh?this.cycleRemoveOption=t:t in xh?this.initializeOption=t:t in bh?this.layeringOption=t:super.fe(t)}createNetwork(){return new od(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.S3(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.M3(),this.cycleRemoveOption===2&&this.removeCycles(),this.N3(),this.C3(),this.L3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,s=t.toVertex.node||t.toVertex.data;return i===null&&s===null?8:i===null||s===null?4:1}nodeMinLayerSpace(t,i){return t.node===null&&t.data===null?0:this.P===90||this.P===270?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(t.node===null&&t.data===null)return 0;const s=i?t.$k:t.Zk;if(s!==null)return s;const n=this.P;return n===90||n===270?i?t.$k=t.focus.x/this.ti+1|0:t.Zk=(t.bounds.width-t.focus.x)/this.ti+1|0:i?t.$k=t.focus.y/this.ti+1|0:t.Zk=(t.bounds.height-t.focus.y)/this.ti+1|0}ei(){const t=this.network.vertexes.count;this.Wg.length<t*2&&(this.Wg=new Int16Array(t*2));let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;this.Wg[i]=n.column,i++,this.Wg[i]=n.index,i++}return this.Wg}os(t){let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.column=t[i],i++,n.index=t[i],i++}}cF(t,i){const s=this.qa(t),n=this.ie[t];this.Jk.length<n*n&&(this.Jk=new Int16Array(n*n));const o=this.Jk;for(let a=0;a<n;a++){let l=0;const h=s[a],d=h.near;let f=0;d!==null&&d!==h&&d.layer===h.layer&&(l+=Math.max(0,Math.abs(d.index-h.index)-1));let m,p=0,b,x=0,v=0,S=0,P,T=0,A,C=0,O=0,R=0,I;if(i>=0){for(m=s[a].Mo,p=0;p<m.length;p++)if(b=m[p],b.valid&&b.fromVertex.layer!==t)for(x=b.fromVertex.index,v=b.portToPos,S=b.portFromPos,T=p+1;T<m.length;T++)A=m[T],A.valid&&A.fromVertex.layer!==t&&(C=A.fromVertex.index,O=A.portToPos,R=A.portFromPos,v<O&&(x>C||x===C&&S>R)&&l++,O<v&&(C>x||C===x&&R>S)&&l++)}if(i<=0){for(m=s[a].rr,p=0;p<m.length;p++)if(b=m[p],b.valid&&b.toVertex.layer!==t)for(x=b.toVertex.index,v=b.portToPos,S=b.portFromPos,T=p+1;T<m.length;T++)A=m[T],A.valid&&A.toVertex.layer!==t&&(C=A.toVertex.index,O=A.portToPos,R=A.portFromPos,S<R&&(x>C||x===C&&v>O)&&l++,R<S&&(C>x||C===x&&O>v)&&l++)}for(o[a*n+a]=l,f=a+1;f<n;f++){let H=0,V=0;if(i>=0){for(P=s[a].Mo,I=s[f].Mo,p=0;p<P.length;p++)if(b=P[p],b.valid&&b.fromVertex.layer!==t)for(x=b.fromVertex.index,v=b.portToPos,S=b.portFromPos,T=0;T<I.length;T++)A=I[T],A.valid&&A.fromVertex.layer!==t&&(C=A.fromVertex.index,O=A.portToPos,R=A.portFromPos,(x<C||x===C&&S<R)&&V++,(C<x||C===x&&R<S)&&H++)}if(i<=0){for(P=s[a].rr,I=s[f].rr,p=0;p<P.length;p++)if(b=P[p],b.valid&&b.toVertex.layer!==t)for(x=b.toVertex.index,v=b.portToPos,S=b.portFromPos,T=0;T<I.length;T++)A=I[T],A.valid&&A.toVertex.layer!==t&&(C=A.toVertex.index,O=A.portToPos,R=A.portFromPos,(x<C||x===C&&v<O)&&V++,(C<x||C===x&&O<v)&&H++)}o[a*n+f]=H,o[f*n+a]=V}}return this.Wa(t,s),o}countCrossings(){let t=0;for(let i=0;i<=this._;i++){const s=this.cF(i,1),n=this.ie[i];for(let o=0;o<n;o++)for(let a=o;a<n;a++)t+=s[o*n+a]}return t}A3(t,i,s){const n=this.qa(t),o=this.ie[t];let a=0;for(let l=0;l<o;l++){let h=null;i<=0&&(h=n[l].Mo);let d=null;i>=0&&(d=n[l].rr);let f,m=0,p=0;if(h!==null)for(let b=0;b<h.length;b++)f=h[b],f.valid&&f.fromVertex.layer!==t&&(m=f.fromVertex.column+f.portFromColOffset,p=f.toVertex.column+f.portToColOffset,s?a+=Math.abs(m-p)*this.linkStraightenWeight(f):a+=Math.abs(m-p));if(d!==null)for(let b=0;b<d.length;b++)f=d[b],f.valid&&f.toVertex.layer!==t&&(m=f.fromVertex.column+f.portFromColOffset,p=f.toVertex.column+f.portToColOffset,s?a+=(Math.abs(m-p)+1)*this.linkStraightenWeight(f):a+=Math.abs(m-p))}return this.Wa(t,n),a}Qk(t){let i=0;for(let s=0;s<=this._;s++)i+=this.A3(s,1,t);return i}Mw(){let t=1/0;this.Bt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=Math.min(t,s.column-this.nodeMinColumnSpace(s,!0)),this.Bt=Math.max(this.Bt,s.column+this.nodeMinColumnSpace(s,!1))}for(i.reset();i.next();){const s=i.value;s.column-=t}this.Bt-=t}Nw(t,i){const s=this.qa(t),n=this.ie[t],o=new Float32Array(n);for(let a=0;a<n;a++){const l=s[a];let h=null;i<=0&&(h=l.Mo);let d=null;i>=0&&(d=l.rr);let f=0,m=0;const p=l.near;p!==null&&p.layer===l.layer&&(f+=p.column-1,m++);let b;if(h!==null)for(let x=0;x<h.length;x++){b=h[x];const v=b.fromVertex;b.valid&&!b.rev&&v.layer!==t&&(f+=v.column,m++)}if(d!==null)for(let x=0;x<d.length;x++){b=d[x];const v=b.toVertex;b.valid&&!b.rev&&v.layer!==t&&(f+=v.column,m++)}m===0?o[a]=-1:o[a]=f/m}return this.Wa(t,s),o}fF(t,i){const s=this.qa(t),n=this.ie[t],o=new Int16Array(n);for(let a=0;a<n;a++){const l=s[a];let h=null;i<=0&&(h=l.Mo);let d=null;i>=0&&(d=l.rr);let f=0;const m=[],p=l.near;p!==null&&p.layer===l.layer&&(m[f]=p.column-1,f++);let b;if(h!==null)for(let x=0;x<h.length;x++){b=h[x];const v=b.fromVertex;b.valid&&!b.rev&&v.layer!==t&&(m[f]=v.column+b.portFromColOffset,f++)}if(d!==null)for(let x=0;x<d.length;x++){b=d[x];const v=b.toVertex;b.valid&&!b.rev&&v.layer!==t&&(m[f]=v.column+b.portToColOffset,f++)}if(f===0)o[a]=-1;else{m.sort((v,S)=>v-S);const x=f>>1;(f&1)!==0?o[a]=m[x]:o[a]=m[x-1]+m[x]>>1}}return this.Wa(t,s),o}Cw(t,i,s,n,o){if(t.component===s){t.component=i;let a=0,l=0;if(n){const h=t.destinationEdges;for(;h.next();){const d=h.value,f=d.toVertex;a=t.layer-f.layer,l=this.linkMinLength(d),a===l&&this.Cw(f,i,s,n,o)}}if(o){const h=t.sourceEdges;for(;h.next();){const d=h.value,f=d.fromVertex;a=f.layer-t.layer,l=this.linkMinLength(d),a===l&&this.Cw(f,i,s,n,o)}}}}dL(t,i,s,n,o){if(t.component===s){if(t.component=i,n){const a=t.destinationEdges;for(;a.next();){const l=a.value.toVertex;this.dL(l,i,s,n,o)}}if(o){const a=t.sourceEdges;for(;a.next();){const l=a.value.fromVertex;this.dL(l,i,s,n,o)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const i=t.value;i.rev=!1}switch(this.cu){default:case 1:this.T3();break;case 0:this.D3();break;case 2:this.v3();break}}v3(){const t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();){const n=i.value;s=Math.min(s,n.layer)}if(s<1/0){if(s<0)for(i.reset();i.next();){const l=i.value;l.layer-=s}const n=[];for(i.reset();i.next();){const l=i.value,h=n[l.layer];h===void 0?n[l.layer]=[l]:h.push(l)}let o=0;for(let l=0;l<n.length;l++){const h=n[l];if(!h||h.length===0)o++;else if(l>0)for(let d=0;d<h.length;d++){const f=h[d];f.layer-=o}}const a=t.edges.iterator;for(;a.next();){const l=a.value,h=l.fromVertex,d=l.toVertex;h.layer<d.layer&&(t.reverseEdge(l),l.rev=!0)}}}T3(){const t=this.network;let i=0,s=t.vertexes.count-1;const n=[];n.length=s+1;const o=t.vertexes.iterator;for(;o.next();){const l=o.value;l.ii=!0}for(;this.F3(t)!==null;){let l;for(l=this.uF(t);l!==null;)n[s]=l,s--,l.ii=!1,l=this.uF(t);for(l=this.dF(t);l!==null;)n[i]=l,i++,l.ii=!1,l=this.dF(t);l=this.R3(t),l!==null&&(n[i]=l,i++,l.ii=!1)}for(let l=0;l<t.vertexes.count;l++)n[l].index=l;const a=t.edges.iterator;for(;a.next();){const l=a.value,h=l.fromVertex,d=l.toVertex;h.index>d.index&&(t.reverseEdge(l),l.rev=!0)}}F3(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii)return s}return null}uF(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii){let n=!0;const o=s.destinationEdges;for(;o.next();)if(o.value.toVertex.ii){n=!1;break}if(n)return s}}return null}dF(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.ii){let n=!0;const o=s.sourceEdges;for(;o.next();)if(o.value.fromVertex.ii){n=!1;break}if(n)return s}}return null}R3(t){let i=null,s=0;const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;if(o.ii){let a=0;const l=o.destinationEdges;for(;l.next();)l.value.toVertex.ii&&a++;let h=0;const d=o.sourceEdges;for(;d.next();)d.value.fromVertex.ii&&h++;(i===null||s<a-h)&&(i=o,s=a-h)}}return i}D3(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.pu=-1,s.to=-1}const i=this.network.edges.iterator;for(;i.next();){const s=i.value;s.forest=!1}for(this.qg=0,t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.gL(s)}for(t.reset();t.next();){const s=t.value;s.pu===-1&&this.gL(s)}for(i.reset();i.next();){const s=i.value;if(!s.forest){const n=s.fromVertex,o=n.pu,a=n.to,l=s.toVertex,h=l.pu,d=l.to;h<o&&a<d&&(this.network.reverseEdge(s),s.rev=!0)}}}gL(t){t.pu=this.qg,this.qg++;const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex;n.pu===-1&&(s.forest=!0,this.gL(n))}t.to=this.qg,this.qg++}M3(){const t=this.network.vertexes.iterator;for(;t.next();){const n=t.value;n.layer=-1}for(this._=-1,this.assignLayers(),t.reset();t.next();){const n=t.value;this._=Math.max(this._,n.layer)}this._>=9999&&r.o("LayeredDigraphLayout, too many layers: "+this._);const i=this.direction==0||this.direction==180,s=[];for(const n=this.network.vertexes.iterator;n.next();){const o=n.value;if(o.node===null||o.centered)continue;const a=o.layer;let l=s[a];l===void 0&&(l=0);const h=i?o.width:o.height;h>l&&(s[a]=h)}for(const n=this.network.vertexes.iterator;n.next();){const o=n.value;if(o.node===null||o.centered)continue;const a=s[o.layer];i?(o.focusX=a/2,o.focusY=o.focus.y,o.width=a):(o.focusX=o.focus.x,o.focusY=a/2,o.height=a)}}assignLayers(){switch(this.fu){case 11:this.gF();break;case 12:this.O3();break;default:case 10:this.I3();break}}gF(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value,s=this.mF(i);this._=Math.max(s,this._)}}mF(t){let i=0;if(t.layer===-1){const s=t.destinationEdges;for(;s.next();){const n=s.value,o=n.toVertex,a=this.linkMinLength(n);i=Math.max(i,this.mF(o)+a)}t.layer=i}else i=t.layer;return i}O3(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=this.pF(s),this._=Math.max(t,this._)}for(i.reset();i.next();){const s=i.value;s.layer=this._-s.layer}}pF(t){let i=0;if(t.layer===-1){const s=t.sourceEdges;for(;s.next();){const n=s.value,o=n.fromVertex,a=this.linkMinLength(n);i=Math.max(i,this.pF(o)+a)}t.layer=i}else i=t.layer;return i}I3(){this.gF();const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.ii=!1}for(t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.yF(s)}let i=1/0;for(t.reset();t.next();){const s=t.value;i=Math.min(i,s.layer)}for(this._=-1,t.reset();t.next();){const s=t.value;s.layer-=i,this._=Math.max(this._,s.layer)}}yF(t){if(!t.ii){t.ii=!0;const i=t.destinationEdges;for(;i.next();){const s=i.value.toVertex;this.yF(s)}this.E3(t),this.U3(t)}}E3(t){const i=this.network.vertexes.iterator;for(;i.next();){const l=i.value;l.component=-1}const s=0,n=1,o=t.Mo;let a=o.length;for(let l=0;l<a;l++){const h=o[l],d=h.fromVertex,f=h.toVertex,m=this.linkMinLength(h);d.layer-f.layer>m&&this.Cw(d,s,-1,!0,!1)}for(this.Cw(t,n,-1,!0,!0);t.component!==s;){let l=0,h=1/0,d=0,f=null;const m=this.network.vertexes.iterator;for(;m.next();){const p=m.value;if(p.component===n){let b=0,x=!1;const v=p.Mo;a=v.length;for(let P=0;P<a;P++){const T=v[P],A=T.fromVertex;if(b+=this.linkLengthWeight(T),A.component!==n){l+=this.linkLengthWeight(T);const C=A.layer-p.layer,O=this.linkMinLength(T);h=Math.min(h,C-O)}}const S=p.rr;a=S.length;for(let P=0;P<a;P++){const T=S[P],A=T.toVertex;b-=this.linkLengthWeight(T),A.component!==n?l-=this.linkLengthWeight(T):x=!0}(f===null||b<d)&&!x&&(f=p,d=b)}}if(l>0){for(i.reset();i.next();){const p=i.value;p.component===n&&(p.layer+=h)}t.component=s}else f.component=s}}U3(t){const i=this.network.vertexes.iterator;for(;i.next();){const o=i.value;o.component=-1}const s=0,n=1;for(this.Cw(t,n,-1,!0,!1);t.component!==s;){let o=0,a=1/0,l=0,h=null;const d=this.network.vertexes.iterator;for(;d.next();){const f=d.value;if(f.component===n){let m=0,p=!1;const b=f.Mo;let x=b.length;for(let S=0;S<x;S++){const P=b[S],T=P.fromVertex;m+=this.linkLengthWeight(P),T.component!==n?o+=this.linkLengthWeight(P):p=!0}const v=f.rr;x=v.length;for(let S=0;S<x;S++){const P=v[S],T=P.toVertex;if(m-=this.linkLengthWeight(P),T.component!==n){o-=this.linkLengthWeight(P);const A=f.layer-T.layer,C=this.linkMinLength(P);a=Math.min(a,A-C)}}(h===null||m>l)&&!p&&(h=f,l=m)}}if(o<0){for(i.reset();i.next();){const f=i.value;f.component===n&&(f.layer-=a)}t.component=s}else h.component=s}}N3(){const t=this.network,i=[],s=t.edges.iterator;for(;s.next();){const n=s.value;n.valid=!1,i.push(n)}for(let n=0;n<i.length;n++){const o=i[n];let a=o.fromVertex;const l=o.toVertex;if(o.valid||(a.node===null&&a.data===null||l.node===null&&l.data===null)&&a.layer===l.layer)continue;let h=0,d=0,f=0,m=0;if(o.link!==null){const R=o.link;if(R===null)continue;const I=a.node,H=l.node;if(I===null||H===null)continue;let V=R.fromNode,z=R.toNode,K=R.fromPort;for(;K!==null&&!K.isVisibleObject();)K=K.panel;let $=R.toPort;for(;$!==null&&!$.isVisibleObject();)$=$.panel;if(o.rev){const pt=V,zt=K;V=z,K=$,z=pt,$=zt}const q=a.focus,J=l.focus,ot=o.rev?l.bounds:a.bounds,rt=L.l();I!==V?ot.isReal()&&V.isVisible()?V.actualBounds.isReal()?(V.getRelativePoint(K,X.Center,rt),rt.x+=V.actualBounds.x-ot.x,rt.y+=V.actualBounds.y-ot.y):(V.getRelativePoint(K,X.Center,rt),rt.isReal()||rt.h(q)):rt.h(q):ot.isReal()?(V.getRelativePoint(K,X.Center,rt),rt.isReal()||rt.h(q)):rt.h(q);const st=o.rev?a.bounds:l.bounds,ht=L.l();H!==z?st.isReal()&&z.isVisible()?z.actualBounds.isReal()?(z.getRelativePoint($,X.Center,ht),ht.x+=z.actualBounds.x-st.x,ht.y+=z.actualBounds.y-st.y):(z.getRelativePoint($,X.Center,ht),ht.isReal()||ht.h(J)):ht.h(J):st.isReal()?(z.getRelativePoint($,X.Center,ht),ht.isReal()||ht.h(J)):ht.h(J),this.P===90||this.P===270?(h=Math.round((rt.x-q.x)/this.ti),f=rt.x,d=Math.round((ht.x-J.x)/this.ti),m=ht.x):(h=Math.round((rt.y-q.y)/this.ti),f=rt.y,d=Math.round((ht.y-J.y)/this.ti),m=ht.y),L.i(rt),L.i(ht),o.portFromColOffset=h,o.portFromPos=f,o.portToColOffset=d,o.portToPos=m}else o.portFromColOffset=0,o.portFromPos=0,o.portToColOffset=0,o.portToPos=0;let p=a.layer;const b=l.layer,x=this.V3(o),v=x===1||x===3,S=x===2||x===3;let P,T,A=null,C;S&&(A=this.B3(a,l),C=1,T=t.createVertex(),T.node=null,T._k=1,T.layer=p,T.near=a,t.addVertex(T),P=t.linkVertexes(a,T,o.link),P.valid=!1,P.rev=o.rev,P.portFromColOffset=h,P.portToColOffset=0,P.portFromPos=f,P.portToPos=0,a=T);let O=1;if(v&&O--,p-b>O&&p>0){for(o.valid=!1,T=t.createVertex(),T.node=null,T._k=2,T.layer=p-1,A&&C<A.length&&T.layer===A[C].layer&&(T.near=A[C++]),t.addVertex(T),P=t.linkVertexes(a,T,o.link),P.valid=!0,P.rev=o.rev,P.portFromColOffset=S?0:h,P.portToColOffset=0,P.portFromPos=S?0:f,P.portToPos=0,a=T,p--;p-b>O&&p>0;)T=t.createVertex(),T.node=null,T._k=3,T.layer=p-1,A&&C<A.length&&T.layer===A[C].layer&&(T.near=A[C++]),t.addVertex(T),P=t.linkVertexes(a,T,o.link),P.valid=!0,P.rev=o.rev,P.portFromColOffset=0,P.portToColOffset=0,P.portFromPos=0,P.portToPos=0,a=T,p--;P=t.linkVertexes(T,l,o.link),P.valid=!v,v&&(T.near=l),P.rev=o.rev,P.portFromColOffset=0,P.portToColOffset=d,P.portFromPos=0,P.portToPos=m}else o.valid=!0}}V3(t){let i=0;const s=t.link;if(s!==null){const n=s.fromPort,o=s.toPort;if(n!==null&&o!==null){const a=s.fromNode,l=s.toNode;if(a!==null&&l!==null){const h=this.tP(!0),d=this.tP(!1),f=this.setsPortSpots?h:s.computeSpot(!0,n),m=this.setsPortSpots?d:s.computeSpot(!1,o),p=s.isOrthogonal;if(f.isSide()&&f.includesSide(d)&&m.isSide()&&m.includesSide(h))return 0;const b=s.getLinkPoint(a,n,f,!0,p,l,o,L.l()),x=s.getLinkDirection(a,n,b,f,!0,p,l,o);L.i(b),(!f.isNone()&&x===this.wF(t,!0)||this.setsPortSpots&&a!==null&&a.ports.count===1&&t.rev)&&(i+=1);const v=s.getLinkPoint(l,o,m,!1,p,a,n,L.l()),S=s.getLinkDirection(l,o,v,m,!1,p,a,n);L.i(v),(!m.isNone()&&S===this.wF(t,!1)||this.setsPortSpots&&l!==null&&l.ports.count===1&&t.rev)&&(i+=2)}}}return i}wF(t,i){return this.P===90?i&&!t.rev||!i&&t.rev?270:90:this.P===180?i&&!t.rev||!i&&t.rev?0:180:this.P===270?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}B3(t,i){const s=[];return s.push(i),this.xF(t,s)?s.reverse():[]}xF(t,i){const s=i[i.length-1].sourceEdges.iterator;for(;s.next();){const n=s.value;if(n.rev||!n.valid)continue;const o=n.fromVertex;if(i.push(o),o===t||this.xF(t,i))return!0;i.pop()}return!1}C3(){this.ie.length!==this._+1&&(this.ie=new Int16Array(this._+1));const t=this.ie;for(let s=0;s<=this._;s++)t[s]=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.index=-1}this.initializeIndices(),this.Sw=-1,this.jg=0,this.Bs=0;for(let s=0;s<=this._;s++)t[s]>t[this.Bs]&&(this.Sw=t[s]-1,this.Bs=s),t[s]<t[this.jg]&&(this.jg=s);this.mu=[];for(let s=0;s<t.length;s++)this.mu[s]=[];for(i.reset();i.next();){const s=i.value,n=s.layer,o=this.mu[n];o[s.index]=s}}initializeIndices(){switch(this.uu){default:case 22:this.z3();break;case 20:this.X3();break;case 21:this.G3();break}}z3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(i.reset();i.next();){const s=i.value;if(s.near)continue;const n=s.layer;if(s.index=this.ie[n],this.ie[n]++,!t)continue;const o=t.get(s);Array.isArray(o)&&o.forEach(a=>{a.index=this.ie[n],this.ie[n]++})}}X3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=this._;s>=0;s--)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.bF(n,t)}}bF(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ie[s],this.ie[s]++,i){const a=i.get(t);Array.isArray(a)&&a.forEach(l=>{l.index=this.ie[s],this.ie[s]++})}const n=t.rr;let o=!0;for(;o;){o=!1;for(let a=0;a<n.length-1;a++){const l=n[a],h=n[a+1];l.portFromColOffset>h.portFromColOffset&&(o=!0,n[a]=h,n[a+1]=l)}}for(let a=0;a<n.length;a++){const l=n[a];if(l.valid){const h=l.toVertex;h.index===-1&&this.bF(h,i)}}}G3(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=0;s<=this._;s++)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.kF(n,t)}}kF(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ie[s],this.ie[s]++,i){const d=i.get(t);Array.isArray(d)&&d.forEach(f=>{f.index=this.ie[s],this.ie[s]++})}const n=t.Mo;let o=!0,a=0;for(;o;)for(o=!1,a=0;a<n.length-1;a++){const d=n[a],f=n[a+1];d.portToColOffset>f.portToColOffset&&(o=!0,n[a]=f,n[a+1]=d)}let l,h;for(a=0;a<n.length;a++)h=n[a],h.valid&&(l=h.fromVertex,l.index===-1&&this.kF(l,i))}L3(){this.Bt=-1;for(let t=0;t<=this._;t++){const i=this.qa(t);let s=0;const n=this.ie[t];for(let o=0;o<n;o++){const a=i[o];s+=this.nodeMinColumnSpace(a,!0),a.column=s,s+=1,s+=this.nodeMinColumnSpace(a,!1)}this.Bt=Math.max(this.Bt,s-1),this.Wa(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.ei(),s=0,n=0,o=0;for(s=0;s<this.mc;s++){for(n=0;n<=this._;n++)this.eP(n,1),this.ys(n,1,!1,1);for(o=this.countCrossings(),o<t&&(t=o,i=this.ei()),n=this._;n>=0;n--)this.eP(n,-1),this.ys(n,-1,!1,-1);o=this.countCrossings(),o<t&&(t=o,i=this.ei())}for(this.os(i),s=0;s<this.mc;s++){for(n=0;n<=this._;n++)this.eP(n,0),this.ys(n,0,!1,0);for(o=this.countCrossings(),o<t&&(t=o,i=this.ei()),n=this._;n>=0;n--)this.eP(n,0),this.ys(n,0,!1,0);o=this.countCrossings(),o<t&&(t=o,i=this.ei())}this.os(i);let a=!1,l=0,h=0,d=0,f=0;switch(this.du){case 30:break;case 32:for(d=t+1;(f=this.countCrossings())<d;)for(d=f,l=this._;l>=0;l--)for(h=0;h<=l;h++){for(a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,-1,!1,-1)||a;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,1,!1,1)||a;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,1,!1,1)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,-1,!1,-1)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,0,!1,0)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,0,!1,0)||a;o>=t?this.os(i):(t=o,i=this.ei())}break;default:case 31:for(l=this._,h=0,d=t+1;(f=this.countCrossings())<d;){for(d=f,a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,-1,!1,-1)||a;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,1,!1,1)||a;for(o=this.countCrossings(),o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,1,!1,1)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,-1,!1,-1)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=l;n>=h;n--)a=this.ys(n,0,!1,0)||a;for(o>=t?this.os(i):(t=o,i=this.ei()),a=!0;a;)for(a=!1,n=h;n<=l;n++)a=this.ys(n,0,!1,0)||a;o>=t?this.os(i):(t=o,i=this.ei())}break}this.os(i)}eP(t,i){let s=0,n=!1;const o=this.qa(t),a=this.ie[t],l=this.fF(t,i),h=this.Nw(t,i);for(s=0;s<a;s++)h[s]===-1&&(h[s]=o[s].column),l[s]===-1&&(l[s]=o[s].column);let d=!0,f;for(;d;)for(d=!1,s=0;s<a-1;s++)if(l[s+1]<l[s]||l[s+1]===l[s]&&h[s+1]<h[s]){n=!0,d=!0;const p=l[s];l[s]=l[s+1],l[s+1]=p;const b=h[s];h[s]=h[s+1],h[s+1]=b,f=o[s],o[s]=o[s+1],o[s+1]=f}let m=0;for(s=0;s<a;s++)f=o[s],f.index=s,m+=this.nodeMinColumnSpace(f,!0),f.column=m,m+=1,m+=this.nodeMinColumnSpace(f,!1);return this.Wa(t,o),n}ys(t,i,s,n){const o=this.qa(t),a=this.ie[t],l=this.cF(t,i);let h=0,d;if(!s||n>0)for(d=new Float32Array(a),h=0;h<a;h++)d[h]=-1;else d=this.Nw(t,-1);let f;if(!s||n<0)for(f=new Float32Array(a),h=0;h<a;h++)f[h]=-1;else f=this.Nw(t,1);let m=!1,p=!0;for(;p;)for(p=!1,h=0;h<a-1;h++){const b=l[o[h].index*a+o[h+1].index],x=l[o[h+1].index*a+o[h].index];let v=0,S=0;const P=o[h].column,T=o[h+1].column,A=this.nodeMinColumnSpace(o[h],!0),C=this.nodeMinColumnSpace(o[h],!1),O=this.nodeMinColumnSpace(o[h+1],!0),R=this.nodeMinColumnSpace(o[h+1],!1),I=P-A+O,H=T-C+R;let V=0,z=0,K=0,$=0,q=0,J=0,ot=0,rt,st=0,ht,pt=0;const zt=o[h].sourceEdges.iterator;if(s&&n<=0)for(;zt.next();){const te=zt.value;rt=te.fromVertex,te.valid&&rt.layer!==t&&(K=this.linkStraightenWeight(te),$=te.portFromColOffset,q=te.portToColOffset,J=rt.column,V+=(Math.abs(P+q-(J+$))+1)*K,z+=(Math.abs(H+q-(J+$))+1)*K)}for(zt.reset();zt.next();){const te=zt.value;if(rt=te.fromVertex,te.valid&&rt.layer===t){for(st=0;st<o.length&&o[st]!==rt;)st++;st<h&&(v+=2*(h-st),S+=2*(h+1-st)),st===h+1&&(v+=1),st>h+1&&(v+=4*(st-h),S+=4*(st-(h+1)))}}const kt=o[h].destinationEdges.iterator;if(s&&n>=0)for(;kt.next();){const te=kt.value;ht=te.toVertex,te.valid&&ht.layer!==t&&(K=this.linkStraightenWeight(te),$=te.portFromColOffset,q=te.portToColOffset,ot=ht.column,V+=(Math.abs(P+$-(ot+q))+1)*K,z+=(Math.abs(H+$-(ot+q))+1)*K)}for(kt.reset();kt.next();){const te=kt.value;if(ht=te.toVertex,te.valid&&ht.layer===t){for(pt=0;pt<o.length&&o[pt]!==ht;)pt++;pt===h+1&&(S+=1)}}const Mt=o[h+1].sourceEdges.iterator;if(s&&n<=0)for(;Mt.next();){const te=Mt.value;rt=te.fromVertex,te.valid&&rt.layer!==t&&(K=this.linkStraightenWeight(te),$=te.portFromColOffset,q=te.portToColOffset,J=rt.column,V+=(Math.abs(T+q-(J+$))+1)*K,z+=(Math.abs(I+q-(J+$))+1)*K)}for(Mt.reset();Mt.next();){const te=Mt.value;if(rt=te.fromVertex,te.valid&&rt.layer===t){for(st=0;st<o.length&&o[st]!==rt;)st++;st<h&&(v+=2*(h+1-st),S+=2*(h-st)),st===h&&(S+=1),st>h+1&&(v+=4*(st-(h+1)),S+=4*(st-h))}}const St=o[h+1].destinationEdges.iterator;if(s&&n>=0)for(;St.next();){const te=St.value;ht=te.toVertex,te.valid&&ht.layer!==t&&(K=this.linkStraightenWeight(te),$=te.portFromColOffset,q=te.portToColOffset,ot=ht.column,V+=(Math.abs(T+$-(ot+q))+1)*K,z+=(Math.abs(I+$-(ot+q))+1)*K)}for(St.reset();St.next();){const te=St.value;if(ht=te.toVertex,te.valid&&ht.layer===t){for(pt=0;pt<o.length&&o[pt]!==ht;)pt++;pt===h&&(v+=1)}}let Ct=0,Qt=0;const Wt=d[o[h].index],xt=f[o[h].index],Ot=d[o[h+1].index],Le=f[o[h+1].index];if(Wt!==-1&&(Ct+=Math.abs(Wt-P),Qt+=Math.abs(Wt-H)),xt!==-1&&(Ct+=Math.abs(xt-P),Qt+=Math.abs(xt-H)),Ot!==-1&&(Ct+=Math.abs(Ot-T),Qt+=Math.abs(Ot-I)),Le!==-1&&(Ct+=Math.abs(Le-T),Qt+=Math.abs(Le-I)),S<v-.5||S===v&&x<b-.5||S===v&&x===b&&z<V-.5||S===v&&x===b&&z===V&&Qt<Ct-.5){m=!0,p=!0,o[h].column=H,o[h+1].column=I;const te=o[h];o[h]=o[h+1],o[h+1]=te}}for(h=0;h<a;h++)o[h].index=h;return this.Wa(t,o),m}straightenAndPack(){if(this.Gn!==0){this.Y3();return}let t=0,i=!1,s=(this.cr&1)!==0;const n=(this.cr&8)!==0;if(this.network.edges.count>1e3&&n&&(s=!1),s){const o=[];let a=0;for(a=0;a<=this._;a++)o[a]=0;let l=0;const h=this.network.vertexes.iterator;for(;h.next();){const f=h.value;t=f.layer,l=f.column;const m=this.nodeMinColumnSpace(f,!1);o[t]=Math.max(o[t],l+m)}const d=8;for(h.reset();h.next();){const f=h.value;t=f.layer,l=f.column,f.column=((this.Bt-o[t])*d>>1)+l*d}this.Bt*=d}if((this.cr&2)!==0){i=!0;let o=0;for(;i&&o<this.gu;){for(i=!1,t=this.Bs+1;t<=this._;t++)i=this.Jg(t,1)||i;for(t=this.Bs-1;t>=0;t--)i=this.Jg(t,-1)||i;i=this.Jg(this.Bs,0)||i,o++}}if((this.cr&4)!==0){for(t=this.Bs+1;t<=this._;t++)this.mL(t,1);for(t=this.Bs-1;t>=0;t--)this.mL(t,-1);this.mL(this.Bs,0)}if(s&&(this.PF(-1),this.PF(1)),(this.cr&2)!==0){i=!0;let o=0;for(;i&&o<this.gu;){for(i=!1,i=this.Jg(this.Bs,0)||i,t=this.Bs+1;t<=this._;t++)i=this.Jg(t,0)||i;for(t=this.Bs-1;t>=0;t--)i=this.Jg(t,0)||i;o++}}}Jg(t,i){let s=!1;for(;this.K3(t,i);)s=!0;return s}K3(t,i){let s=0;const n=this.qa(t),o=this.ie[t],a=this.Nw(t,-1);if(i>0)for(s=0;s<o;s++)a[s]=-1;const l=this.Nw(t,1);if(i<0)for(s=0;s<o;s++)l[s]=-1;let h=!1,d=!0;for(;d;)for(d=!1,s=0;s<o;s++){const f=n[s].column,m=this.nodeMinColumnSpace(n[s],!0),p=this.nodeMinColumnSpace(n[s],!1);let b=0;s-1<0||f-n[s-1].column-1>m+this.nodeMinColumnSpace(n[s-1],!1)?b=f-1:b=f;let x=0;s+1>=o||n[s+1].column-f-1>p+this.nodeMinColumnSpace(n[s+1],!0)?x=f+1:x=f;let v=0,S=0,P=0,T=0,A=0,C=0;if(i<=0){const z=n[s].sourceEdges.iterator;for(;z.next();){const K=z.value,$=K.fromVertex;if(K.valid&&$.layer!==t){T=this.linkStraightenWeight(K),A=K.portFromColOffset,C=K.portToColOffset;const q=$.column;v+=(Math.abs(f+C-(q+A))+1)*T,S+=(Math.abs(b+C-(q+A))+1)*T,P+=(Math.abs(x+C-(q+A))+1)*T}}}if(i>=0){const z=n[s].destinationEdges.iterator;for(;z.next();){const K=z.value,$=K.toVertex;if(K.valid&&$.layer!==t){T=this.linkStraightenWeight(K),A=K.portFromColOffset,C=K.portToColOffset;const q=$.column;v+=(Math.abs(f+A-(q+C))+1)*T,S+=(Math.abs(b+A-(q+C))+1)*T,P+=(Math.abs(x+A-(q+C))+1)*T}}}let O=0,R=0,I=0;const H=a[n[s].index],V=l[n[s].index];H!==-1&&(O+=Math.abs(H-f),R+=Math.abs(H-b),I+=Math.abs(H-x)),V!==-1&&(O+=Math.abs(V-f),R+=Math.abs(V-b),I+=Math.abs(V-x)),S<v||S===v&&R<O?(h=!0,d=!0,n[s].column=b):(P<v||P===v&&I<O)&&(h=!0,d=!0,n[s].column=x)}return this.Wa(t,n),this.Mw(),h}mL(t,i){let s=0;const n=this.qa(t),o=this.ie[t],a=this.fF(t,i),l=new Int16Array(a);let h=!1,d=!0;for(;d;)for(d=!1,s=0;s<o;s++){const f=n[s].column,m=this.nodeMinColumnSpace(n[s],!0),p=this.nodeMinColumnSpace(n[s],!1);let b=0,x=0,v=0,S=0,P=0;l[s]===-1?s===0&&s===o-1?b=f:s===0?(x=n[s+1].column,x-f===p+this.nodeMinColumnSpace(n[s+1],!0)?b=f-1:b=f):s===o-1?(v=n[s-1].column,f-v===m+this.nodeMinColumnSpace(n[s-1],!1)?b=f+1:b=f):(v=n[s-1].column,P=v+this.nodeMinColumnSpace(n[s-1],!1)+m+1,x=n[s+1].column,S=x-this.nodeMinColumnSpace(n[s+1],!0)-p-1,b=(P+S)/2|0):s===0&&s===o-1?b=l[s]:s===0?(x=n[s+1].column,S=x-this.nodeMinColumnSpace(n[s+1],!0)-p-1,b=Math.min(l[s],S)):s===o-1?(v=n[s-1].column,P=v+this.nodeMinColumnSpace(n[s-1],!1)+m+1,b=Math.max(l[s],P)):(v=n[s-1].column,P=v+this.nodeMinColumnSpace(n[s-1],!1)+m+1,x=n[s+1].column,S=x-this.nodeMinColumnSpace(n[s+1],!0)-p-1,P<l[s]&&l[s]<S?b=l[s]:P>=l[s]?b=P:S<=l[s]&&(b=S)),b!==f&&(h=!0,d=!0,n[s].column=b)}return this.Wa(t,n),this.Mw(),h}H3(){for(let t=0;t<=this.Bt;t++)for(;this.j3(t,1););this.Mw()}j3(t,i){let s=!0;const n=this.network.vertexes.iterator;for(;n.next();){const a=n.value,l=this.nodeMinColumnSpace(a,!0),h=this.nodeMinColumnSpace(a,!1);if(a.column-l<=t&&a.column+h>=t){s=!1;break}}let o=!1;if(s){if(i>0)for(n.reset();n.next();){const a=n.value;a.column>t&&(a.column-=1,o=!0)}if(i<0)for(n.reset();n.next();){const a=n.value;a.column<t&&(a.column+=1,o=!0)}}return o}q3(){this.H3();for(let t=0;t<this.Bt;t++)for(;this.W3(t,1););this.Mw()}W3(t,i){let s=t;i>0&&(s=t+1),i<0&&(s=t-1);let n=0;const o=[],a=[];for(n=0;n<=this._;n++)o[n]=!1,a[n]=!1;const l=this.network.vertexes.iterator;for(;l.next();){const f=l.value,m=f.column-this.nodeMinColumnSpace(f,!0),p=f.column+this.nodeMinColumnSpace(f,!1);m<=t&&p>=t&&(o[f.layer]=!0),m<=s&&p>=s&&(a[f.layer]=!0)}let h=!0,d=!1;for(n=0;n<=this._;n++)h=h&&!(o[n]&&a[n]);if(h){if(i>0)for(l.reset();l.next();){const f=l.value;f.column>t&&(f.column-=1,d=!0)}if(i<0)for(l.reset();l.next();){const f=l.value;f.column<t&&(f.column+=1,d=!0)}}return d}PF(t){this.q3();let i=0,s,n=0,o=0,a=0;if(t>0)for(i=0;i<=this.Bt;i++)for(s=this.ei(),n=this.Qk(!0),o=n+1;n<o;)o=n,this.SF(i,1),a=this.Qk(!0),a>n?this.os(s):a<n&&(n=a,s=this.ei());if(t<0)for(i=this.Bt;i>=0;i--)for(s=this.ei(),n=this.Qk(!0),o=n+1;n<o;)o=n,this.SF(i,-1),a=this.Qk(!0),a>n?this.os(s):a<n&&(n=a,s=this.ei());this.Mw()}SF(t,i){this.fn=0;const s=this.network.vertexes.iterator;for(;s.next();){const m=s.value;m.component=-1}if(i>0)for(s.reset();s.next();){const m=s.value;m.column-this.nodeMinColumnSpace(m,!0)<=t&&(m.component=this.fn)}if(i<0)for(s.reset();s.next();){const m=s.value;m.column+this.nodeMinColumnSpace(m,!1)>=t&&(m.component=this.fn)}for(this.fn++,s.reset();s.next();){const m=s.value;m.component===-1&&(this.dL(m,this.fn,-1,!0,!0),this.fn++)}let n=0;const o=[];for(n=0;n<this.fn*this.fn;n++)o[n]=!1;const a=[];for(n=0;n<(this._+1)*(this.Bt+1);n++)a[n]=-1;for(s.reset();s.next();){const m=s.value,p=m.layer,b=Math.max(0,m.column-this.nodeMinColumnSpace(m,!0)),x=Math.min(this.Bt,m.column+this.nodeMinColumnSpace(m,!1));for(let v=b;v<=x;v++)a[p*(this.Bt+1)+v]=m.component}for(let m=0;m<=this._;m++){if(i>0)for(let p=0;p<this.Bt;p++)a[m*(this.Bt+1)+p]!==-1&&a[m*(this.Bt+1)+p+1]!==-1&&a[m*(this.Bt+1)+p]!==a[m*(this.Bt+1)+p+1]&&(o[a[m*(this.Bt+1)+p]*this.fn+a[m*(this.Bt+1)+p+1]]=!0);if(i<0)for(let p=this.Bt;p>0;p--)a[m*(this.Bt+1)+p]!==-1&&a[m*(this.Bt+1)+p-1]!==-1&&a[m*(this.Bt+1)+p]!==a[m*(this.Bt+1)+p-1]&&(o[a[m*(this.Bt+1)+p]*this.fn+a[m*(this.Bt+1)+p-1]]=!0)}const l=[];for(n=0;n<this.fn;n++)l[n]=!0;const h=[];h.push(0);let d=0;for(;h.length!==0;)if(d=h[h.length-1],h.pop(),l[d])for(l[d]=!1,n=0;n<this.fn;n++)o[d*this.fn+n]&&h.splice(0,0,n);let f=!1;if(i>0)for(s.reset();s.next();){const m=s.value;l[m.component]&&(m.column-=1,f=!0)}if(i<0)for(s.reset();s.next();){const m=s.value;l[m.component]&&(m.column+=1,f=!0)}return f}Y3(){const t=r.nt(),i=this.mu.length;for(let b=0;b<=i;b++)t[b]=[];const s=this.network.vertexes.iterator;for(;s.next();){const b=s.value,x=i-b.layer,v=t[x];v[b.index]=b}const n=new F;this.J3(t,n);let o=null,a=null,l=null,h=null;const d=(this.Gn&1)!==0,f=(this.Gn&2)!==0,m=(this.Gn&4)!==0,p=(this.Gn&8)!==0;d&&(this.hl(t,n,!0),o=this.iP(t,!0,!1)),t.reverse(),m&&(this.hl(t,n,!1),l=this.iP(t,!1,!1));for(const b of t)b.reverse();p&&(this.hl(t,n,!1),h=this.iP(t,!1,!0)),t.reverse(),f&&(this.hl(t,n,!0),a=this.iP(t,!0,!0)),r.Z(t),this.$3(o,a,l,h),this.network.vertexes.each(b=>{const x=b,v=r.nt();d&&v.push(o.get(x)),f&&v.push(a.get(x)),m&&v.push(l.get(x)),p&&v.push(h.get(x)),v.sort((C,O)=>C-O);const S=v.length,P=Math.floor((S-1)/2),T=Math.ceil((S-1)/2),A=(v[P]+v[T])/2;r.Z(v),x.mi=A})}J3(t,i){const s=t.length;for(let n=1;n<s-1;n++){let o=0,a=0;const l=t[n],h=t[n+1];for(let d=0;a<h.length;d++){const f=h[d],m=this.Z3(f);if(d===h.length-1||m){let p=l.length-1;for(m&&(p=f.getProperSourceVertexes()[0].index);a<=d;){const b=h[a].getProperSourceEdges();for(const x of b){const v=x.fromVertex.index;(v<o||v>p)&&i.add(x)}a++}o=p}}}}Z3(t){if(t.node===null){const i=t.getProperSourceVertexes();if(i.length>0)return i[0].node===null}return!1}hl(t,i,s){this.Q3(t);for(const n of t){let o=-1;for(const a of n){const l=s?a.getProperSourceVertexes():a.getProperDestinationVertexes(),h=l.length;if(h>0){l.sort((f,m)=>f.Ja-m.Ja);const d=(h-1)/2;for(let f=Math.floor(d),m=Math.ceil(d);f<=m;f++)if(a.Yn===a){const p=l[f];let b;s?b=p.getDestinationEdge(a):b=a.getDestinationEdge(p),!i.has(b)&&o<p.Ja&&(p.Yn=a,a.pc=p.pc,a.Yn=p.pc,o=p.Ja)}}}}}Q3(t){for(let i=0;i<t.length;i++){const s=t[i];for(let n=0;n<s.length;n++){const o=s[n];o.pc=o,o.Yn=o,o.MF=i,o.Ja=n}}}iP(t,i,s){const n=this.P===90||this.P===270;for(const a of t)for(const l of a)l.rs=l,l.yu=1/0,l.mi=NaN,l.Kn=0;this._3(t,i,s);for(const a of t)for(const l of a)l.pc===l&&this.NF(l,t);for(let a=0;a<t.length;a++){if(t[a].length<=0)continue;const l=t[a][0];if(l.rs===l){l.rs.yu===1/0&&(l.rs.yu=0);let h=a,d=0,f;do{for(f=t[h][d];f.Yn!==f.pc;)if(f=f.Yn,h++,f.Ja>0){const m=this.CF(f,t),p=n?m.width:m.height,b=f.rs.yu+f.mi+f.Kn-(m.mi+m.Kn+p+this.columnSpacing);m.rs.yu=Math.min(m.rs.yu,b)}d=f.Ja+1}while(h<t.length&&d<t[h].length&&f.rs===t[h][d].rs)}}const o=new nt;for(const a of t)for(const l of a){l.mi=l.mi+l.rs.yu+l.Kn;const h=n?l.width:l.height;o.set(l,s?-l.mi-h:l.mi)}return o}_3(t,i,s){const n=this.P===90||this.P===270;for(const o of t)for(const a of o)if(a.pc===a){let l=0,h=a;for(;h.Yn!==a;){const d=h.Yn,f=n?h.width:h.height,m=n?d.width:d.height;let p,b,x,v;i?(x=h.getDestinationEdge(d),p=x.portFromPos,b=x.portToPos,x.link!==null&&(h.node&&h.node!==x.link.fromNode&&(p=n?h.focusX:h.focusY),d.node&&d.node!==x.link.toNode&&(b=n?d.focusX:d.focusY)),s?v=h.Kn+(f-p)-(m-b):v=h.Kn+p-b):(x=d.getDestinationEdge(h),p=x.portToPos,b=x.portFromPos,x.link!==null&&(h.node&&h.node!==x.link.toNode&&(p=n?h.focusX:h.focusY),d.node&&d.node!==x.link.fromNode&&(b=n?d.focusX:d.focusY)),s?v=h.Kn+(f-p)-(m-b):v=h.Kn+p-b),d.Kn=v,l=Math.min(l,v),h=h.Yn}h=a;do h.Kn=h.Kn-l,h=h.Yn;while(h!==a)}}NF(t,i){if(!isNaN(t.mi))return;t.mi=0;let s=t;do{if(s.Ja>0){const n=this.CF(s,i),o=n.pc;this.NF(o,i),t.rs===t&&(t.rs=o.rs);const a=this.P===90||this.P===270?n.width:n.height;if(t.rs===o.rs){const l=o.mi+n.Kn+a-s.Kn+this.columnSpacing;t.mi=Math.max(t.mi,l)}}s=s.Yn}while(s!==t);for(;s.Yn!==t;)s=s.Yn,s.mi=t.mi,s.rs=t.rs}CF(t,i){const s=t.MF,n=t.Ja;return n<1&&r.o("Could not determine previous vertex in layer"),i[s][n-1]}$3(...t){let i=-1;const s=r.nt(),n=r.nt();let o=1/0;for(let a=0;a<4;a++){if(!t[a])continue;const l=this.tU(t[a],s,n,a);l<o&&(i=a,o=l)}for(let a=0;a<4;a++){const l=t[a];if(!l)continue;const h=a===0||a===2?s[i]-s[a]:n[i]-n[a];h!==0&&l.each(d=>{l.set(d.key,d.value+h)})}r.Z(s),r.Z(n)}tU(t,i,s,n){if(!t||t.count===0)return i[n]=0,s[n]=0,1/0;let o=1/0,a=-1/0;return t.each(l=>{const h=l.key,d=l.value,f=this.P===90||this.P===270?h.width:h.height;d<o&&(o=d),d+f>a&&(a=d+f)}),i[n]=o,s[n]=a,a-o}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}Pw(){if(!this.setsPortSpots)return;const t=this.tP(!0),i=this.tP(!1),s=this.network.edges.iterator;for(;s.next();){const n=s.value.link;n!==null&&(n.fromSpot=t,n.toSpot=i)}}tP(t){return this.P===270?t?X.MiddleTop:X.MiddleBottom:this.P===90?t?X.MiddleBottom:X.MiddleTop:this.P===180?t?X.MiddleLeft:X.MiddleRight:t?X.MiddleRight:X.MiddleLeft}commitNodes(){this.zs.length!==this._+1&&(this.zs=new Float32Array(this._+1)),this.ms.length!==this._+1&&(this.ms=new Float32Array(this._+1)),this.ps.length!==this._+1&&(this.ps=new Float32Array(this._+1)),this.Rt.length!==this._+1&&(this.Rt=new Float32Array(this._+1));for(let x=0;x<=this._;x++)this.zs[x]=0,this.ms[x]=0,this.ps[x]=0,this.Rt[x]=0;const t=this.network.vertexes.iterator;for(;t.next();){const x=t.value,v=x.layer;this.zs[v]=Math.max(this.zs[v],this.nodeMinLayerSpace(x,!0)),this.ms[v]=Math.max(this.ms[v],this.nodeMinLayerSpace(x,!1))}let i=0;const s=this.Vs;for(let x=0;x<=this._;x++){let v=s;this.zs[x]+this.ms[x]<=0&&(v=0),x>0&&(i+=v/2),this.P===90||this.P===0?(i+=this.ms[x],this.ps[x]=i,i+=this.zs[x]):(i+=this.zs[x],this.ps[x]=i,i+=this.ms[x]),x<this._&&(i+=v/2),this.Rt[x]=i}const n=i,o=this.arrangementOrigin;for(let x=0;x<=this._;x++)this.P===270?this.ps[x]=o.y+this.ps[x]:this.P===90?(this.ps[x]=o.y+n-this.ps[x],this.Rt[x]=n-this.Rt[x]):this.P===180?this.ps[x]=o.x+this.ps[x]:(this.ps[x]=o.x+n-this.ps[x],this.Rt[x]=n-this.Rt[x]);const a=this.Gn!==0;t.reset();const l=this.P===270||this.P===90;let h=1/0,d=1/0,f=1/0,m=-1/0;for(;t.next();){const x=t.value,v=x.layer,S=x.column|0;let P=0,T=0;l?(P=o.x+this.ti*S,T=this.ps[v]):(P=this.ps[v],T=o.y+this.ti*S),x.centerX=P,x.centerY=T,a&&isFinite(x.mi)&&(l?x.node?x.x=o.x+x.mi:x.centerX=o.x+x.mi:x.node?x.y=o.y+x.mi:x.centerY=o.y+x.mi),h=Math.min(x.x,h),d=Math.min(x.y,d),l?(f=h,m=Math.max(m,x.bounds.right)):(f=d,m=Math.max(m,x.bounds.bottom))}this.uL=m-f;const p=o.x-h,b=o.y-d;for(this.fr=new L(a&&l?0:p,a&&!l?0:b),t.reset();t.next();){const x=t.value;x.x+=p,x.y+=b,x.commit()}}pL(){let t=0;const i=this.Vs;for(let o=0;o<=this._;o++)t+=this.zs[o],t+=this.ms[o];t+=this._*i;const s=[],n=this.Gn!==0?this.uL:this.ti*this.Bt;for(let o=this.maxLayer;o>=0;o--)this.P===270?o===0?s.push(new Y(0,0,n,Math.abs(this.Rt[0]))):s.push(new Y(0,this.Rt[o-1],n,Math.abs(this.Rt[o-1]-this.Rt[o]))):this.P===90?o===0?s.push(new Y(0,this.Rt[0],n,Math.abs(this.Rt[0]-t))):s.push(new Y(0,this.Rt[o],n,Math.abs(this.Rt[o-1]-this.Rt[o]))):this.P===180?o===0?s.push(new Y(0,0,Math.abs(this.Rt[0]),n)):s.push(new Y(this.Rt[o-1],0,Math.abs(this.Rt[o-1]-this.Rt[o]),n)):o===0?s.push(new Y(this.Rt[0],0,Math.abs(this.Rt[0]-t),n)):s.push(new Y(this.Rt[o],0,Math.abs(this.Rt[o-1]-this.Rt[o]),n));this.commitLayers(s,this.fr)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i=null;for(;t.next();)i=t.value.link,i!==null&&i.pointsCount>0&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,i!==null&&i.updateRoute();for(t.reset();t.next();){const s=t.value;if(i=s.link,i===null||i.pointsCount===0)continue;i.startRoute();const n=i;let o=n.fromNode,a=n.toNode,l=n.fromPort,h=n.toPort;if(o!==null){const K=o.findVisibleNode();K!==null&&K!==o&&(o=K,l=K.port)}if(a!==null){const K=a.findVisibleNode();K!==null&&K!==a&&(a=K,h=K.port)}const d=i.computeSpot(!0,l),f=i.computeSpot(!1,h);let m=s.fromVertex,p=s.toVertex;if(s.valid){if(i.curve===9&&i.pointsCount===4)if(m.column===p.column&&this.alignOption===0){const K=i.getLinkPoint(o,l,d,!0,!1,a,h),$=i.getLinkPoint(a,h,f,!1,!1,o,l);K.isReal()||K.set(o.actualBounds.center),$.isReal()||$.set(a.actualBounds.center),i.clearPoints(),i.addPointAt(K.x,K.y),i.addPointAt((2*K.x+$.x)/3,(2*K.y+$.y)/3),i.addPointAt((K.x+2*$.x)/3,(K.y+2*$.y)/3),i.addPointAt($.x,$.y)}else{let K=!1,$=!1;if(l!==null&&i.bl(d)&&(K=!0),h!==null&&i.bl(f)&&($=!0),K||$){let q=null;K&&(q=i.getLinkPointFromPoint(o,l,l.getDocumentPoint(X.Center),i.getPoint(3),!0),q.isReal()||q.set(o.actualBounds.center),i.setPointAt(0,q.x,q.y));let J=null;if($&&(J=i.getLinkPointFromPoint(a,h,h.getDocumentPoint(X.Center),i.getPoint(0),!1),J.isReal()||J.set(a.actualBounds.center),i.setPointAt(3,J.x,J.y)),q){const ot=i.getPoint(2);i.setPointAt(1,(q.x*2+ot.x)/3,(q.y*2+ot.y)/3)}if(J){const ot=i.getPoint(1);i.setPointAt(2,(J.x*2+ot.x)/3,(J.y*2+ot.y)/3)}}}i.commitRoute();continue}if(m.layer===p.layer){i.commitRoute();continue}let b=!1,x=!1;const v=this.Vs;let S=0,P=i.firstPickIndex+1;if(i.isOrthogonal)x=!0,S=i.pointsCount,S>4&&i.points.removeRange(2,S-3);else if(i.curve===9)b=!0,S=i.pointsCount,S>4&&i.points.removeRange(2,S-3),S===4&&(P=2);else{S=i.pointsCount;const K=d===X.None,$=f===X.None;S>2&&K&&$?i.points.removeRange(1,S-2):S>3&&K&&!$?i.points.removeRange(1,S-3):S>3&&!K&&$?i.points.removeRange(2,S-2):S>4&&!K&&!$&&i.points.removeRange(2,S-3)}let T,A,C=0,O=0,R=0,I=0,H=0,V=0,z=0;if(s.rev){let K=0;for(;p!==null&&m!==p;){T=null,A=null;const $=p.sourceEdges.iterator;for(;$.next();){const q=$.value;if(q.link===s.link&&(T=q.fromVertex,A=q.toVertex,T.node===null))break}if(T===null)break;if(T!==m)if(C=i.getPoint(P-1).x,O=i.getPoint(P-1).y,R=T.centerX,I=T.centerY,x)this.P===180||this.P===0?P===i.firstPickIndex+1?(i.insertPointAt(P++,C,O),i.insertPointAt(P++,C,I)):(A!==null?A.centerY:O)!==I&&(H=this.Rt[T.layer-1]+this.fr.x,i.insertPointAt(P++,H,O),i.insertPointAt(P++,H,I)):P===i.firstPickIndex+1?(i.insertPointAt(P++,C,O),i.insertPointAt(P++,R,O)):(A!==null?A.centerX:C)!==R&&(H=this.Rt[T.layer-1]+this.fr.y,i.insertPointAt(P++,C,H),i.insertPointAt(P++,R,H));else if(P===i.firstPickIndex+1)if(V=Math.max(10,this.zs[p.layer]),z=Math.max(10,this.ms[p.layer]),b)this.P===180?R<=p.bounds.x?(K=p.bounds.x,i.insertPointAt(P++,K-V,I),i.insertPointAt(P++,K,I),i.insertPointAt(P++,K+z,I)):(i.insertPointAt(P++,R-V,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R+z,I)):this.P===90?I>=p.bounds.bottom?(K=p.bounds.y+p.bounds.height,i.insertPointAt(P++,R,K+z),i.insertPointAt(P++,R,K),i.insertPointAt(P++,R,K-V)):(i.insertPointAt(P++,R,I+z),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I-V)):this.P===270?I<=p.bounds.y?(K=p.bounds.y,i.insertPointAt(P++,R,K-V),i.insertPointAt(P++,R,K),i.insertPointAt(P++,R,K+z)):(i.insertPointAt(P++,R,I-V),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I+z)):this.P===0&&(R>=p.bounds.right?(K=p.bounds.x+p.bounds.width,i.insertPointAt(P++,K+z,I),i.insertPointAt(P++,K,I),i.insertPointAt(P++,K-V,I)):(i.insertPointAt(P++,R+z,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R-V,I)));else{i.insertPointAt(P++,C,O);let q=0;this.P===180||this.P===0?((this.P===180?R>=p.bounds.right:R<=p.bounds.x)&&(q=(this.P===0?-V:z)/2),i.insertPointAt(P++,C+q,I)):((this.P===270?I>=p.bounds.bottom:I<=p.bounds.y)&&(q=(this.P===90?-V:z)/2),i.insertPointAt(P++,R,O+q)),i.insertPointAt(P++,R,I)}else V=Math.max(10,this.zs[T.layer]),z=Math.max(10,this.ms[T.layer]),b?this.P===180?(i.insertPointAt(P++,R-V-Math.max(10,v),I),i.insertPointAt(P++,Math.min(R-V+v/2,R),I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,Math.max(R+z-v/2,R),I),i.insertPointAt(P++,R+z+v,I)):this.P===90?(i.insertPointAt(P++,R,I+z+Math.max(10,v)),i.insertPointAt(P++,R,Math.max(I+z-v/2,I)),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,Math.min(I-V+v/2,I)),i.insertPointAt(P++,R,I-V-v)):this.P===270?(i.insertPointAt(P++,R,I-V-Math.max(10,v)),i.insertPointAt(P++,R,Math.min(I-V+v/2,I)),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,Math.max(I+z-v/2,I)),i.insertPointAt(P++,R,I+z+v)):(i.insertPointAt(P++,R+z+Math.max(10,v),I),i.insertPointAt(P++,Math.max(R+z-v/2,R),I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,Math.min(R-V+v/2,R),I),i.insertPointAt(P++,R-V-v,I)):(this.P===180||this.P===90||this.P,i.insertPointAt(P++,R,I));p=T}if(h===null||d!==X.None||x)if(C=i.getPoint(P-1).x,O=i.getPoint(P-1).y,R=i.getPoint(P).x,I=i.getPoint(P).y,x){const $=this.ms[m.layer];let q=0;this.P===180||this.P===0?(q=O,q>=m.bounds.y&&q<=m.bounds.bottom&&(this.P===180?R>=m.bounds.x:R<=m.bounds.right)&&(K=m.centerX+(this.P===180?-$:$),q<m.bounds.y+m.bounds.height/2?q=m.bounds.y-this.ti/2:q=m.bounds.bottom+this.ti/2,i.insertPointAt(P++,K,O),i.insertPointAt(P++,K,q)),i.insertPointAt(P++,R,q),i.insertPointAt(P++,R,I)):(q=C,q>=m.bounds.x&&q<=m.bounds.right&&(this.P===270?I>=m.bounds.y:I<=m.bounds.bottom)&&(K=m.centerY+(this.P===270?-$:$),q<m.bounds.x+m.bounds.width/2?q=m.bounds.x-this.ti/2:q=m.bounds.right+this.ti/2,i.insertPointAt(P++,C,K),i.insertPointAt(P++,q,K)),i.insertPointAt(P++,q,I),i.insertPointAt(P++,R,I))}else if(b)V=Math.max(10,this.zs[m.layer]),z=Math.max(10,this.ms[m.layer]),this.P===180&&R>=m.bounds.x?(K=m.bounds.x+m.bounds.width,i.setPointAt(P-2,K,O),i.setPointAt(P-1,K+z,O)):this.P===90&&I<=m.bounds.bottom?(K=m.bounds.y,i.setPointAt(P-2,C,K),i.setPointAt(P-1,C,K-V)):this.P===270&&I>=m.bounds.y?(K=m.bounds.y+m.bounds.height,i.setPointAt(P-2,C,K),i.setPointAt(P-1,C,K+z)):this.P===0&&R<=m.bounds.right&&(K=m.bounds.x,i.setPointAt(P-2,K,O),i.setPointAt(P-1,K-V,O));else{V=Math.max(10,this.zs[m.layer]),z=Math.max(10,this.ms[m.layer]);let $=0;this.P===180||this.P===0?((this.P===180?R<=m.bounds.x:R>=m.bounds.right)&&($=(this.P===0?z:-V)/2),i.insertPointAt(P++,R+$,O)):((this.P===270?I<=m.bounds.y:I>=m.bounds.bottom)&&($=(this.P===90?z:-V)/2),i.insertPointAt(P++,C,I+$)),i.insertPointAt(P++,R,I)}}else{for(;m!==null&&m!==p;){T=null,A=null;const K=m.destinationEdges.iterator;for(;K.next();){const $=K.value;if($.link===s.link&&(T=$.toVertex,A=$.fromVertex,A.node!==null&&(A=null),T.node===null))break}if(T===null)break;T!==p&&(C=i.getPoint(P-1).x,O=i.getPoint(P-1).y,R=T.centerX,I=T.centerY,x?this.P===180||this.P===0?(A!==null?A.centerY:O)!==I&&(H=this.Rt[T.layer]+this.fr.x,P===i.firstPickIndex+1&&(this.P===0?H=Math.max(H,C):H=Math.min(H,C)),i.insertPointAt(P++,H,O),i.insertPointAt(P++,H,I)):(A!==null?A.centerX:C)!==R&&(H=this.Rt[T.layer]+this.fr.y,P===i.firstPickIndex+1&&(this.P===90?H=Math.max(H,O):H=Math.min(H,O)),i.insertPointAt(P++,C,H),i.insertPointAt(P++,R,H)):(V=Math.max(10,this.zs[T.layer]),z=Math.max(10,this.ms[T.layer]),b?this.P===180?(i.insertPointAt(P++,R+z+Math.max(10,v),I),i.insertPointAt(P++,Math.max(R+z-v/2,R),I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,Math.min(R-V+v/2,R),I),i.insertPointAt(P++,R-V-v,I)):this.P===90?(i.insertPointAt(P++,R,I-V-Math.max(10,v)),i.insertPointAt(P++,R,Math.min(I-V+v/2,I)),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,Math.max(I+z-v/2,I)),i.insertPointAt(P++,R,I+z+v)):this.P===270?(i.insertPointAt(P++,R,I+z+Math.max(10,v)),i.insertPointAt(P++,R,Math.max(I+z-v/2,I)),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,Math.min(I-V+v/2,I)),i.insertPointAt(P++,R,I-V-v)):(i.insertPointAt(P++,R-V-Math.max(10,v),I),i.insertPointAt(P++,Math.min(R-V+v/2,R),I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,R,I),i.insertPointAt(P++,Math.max(R+z-v/2,R),I),i.insertPointAt(P++,R+z+v,I)):this.P===180?(i.insertPointAt(P++,R+z,I),i.insertPointAt(P++,R-V,I)):this.P===90?(i.insertPointAt(P++,R,I-V),i.insertPointAt(P++,R,I+z)):this.P===270?(i.insertPointAt(P++,R,I+z),i.insertPointAt(P++,R,I-V)):(i.insertPointAt(P++,R-V,I),i.insertPointAt(P++,R+z,I)))),m=T}x&&(C=i.getPoint(P-1).x,O=i.getPoint(P-1).y,R=i.getPoint(P).x,I=i.getPoint(P).y,this.P===180||this.P===0?O!==I&&(this.P===0?H=Math.min(Math.max((R+C)/2,this.Rt[p.layer]+this.fr.x),R):H=Math.max(Math.min((R+C)/2,this.Rt[p.layer]+this.fr.x),R),i.insertPointAt(P++,H,O),i.insertPointAt(P++,H,I)):C!==R&&(this.P===90?H=Math.min(Math.max((I+O)/2,this.Rt[p.layer]+this.fr.y),I):H=Math.max(Math.min((I+O)/2,this.Rt[p.layer]+this.fr.y),I),i.insertPointAt(P++,C,H),i.insertPointAt(P++,R,H)))}if(n!==null&&b&&i.pointsCount>=4){if(o!==null&&l!==null&&n.bl(d)){const K=l.getDocumentPoint(X.Center);K.isReal()||K.setTo(o.actualBounds.centerX,o.actualBounds.centerY);const $=i.getPoint(3),q=i.getPoint(2);this.direction===90||this.direction===270?(i.setPointAt(1,$.x,(q.y+$.y)/2),i.setPointAt(2,$.x,(q.y+$.y)/2)):(i.setPointAt(1,(q.x+$.x)/2,$.y),i.setPointAt(2,(q.x+$.x)/2,$.y));const J=i.getLinkPointFromPoint(o,l,K,i.getPoint(1),!0);i.setPointAt(0,J.x,J.y)}if(a!==null&&h!==null&&n.bl(f)){const K=h.getDocumentPoint(X.Center);K.isReal()||K.setTo(a.actualBounds.centerX,a.actualBounds.centerY);const $=i.getPoint(i.pointsCount-4),q=i.getLinkPointFromPoint(a,h,K,$,!1),J=i.getPoint(i.pointsCount-3);this.direction===90||this.direction===270?(i.setPointAt(i.pointsCount-2,$.x,(J.y+q.y)/2),i.setPointAt(i.pointsCount-3,$.x,(J.y+q.y)/2)):(i.setPointAt(i.pointsCount-2,(J.x+q.x)/2,$.y),i.setPointAt(i.pointsCount-3,(J.x+q.x)/2,$.y));const ot=i.getLinkPointFromPoint(a,h,K,i.getPoint(i.pointsCount-2),!1);i.setPointAt(i.pointsCount-1,ot.x,ot.y)}}i.commitRoute(),s.commit()}}S3(){this.Sw=-1,this.jg=0,this.Bs=0,this.mu=null;for(let t=0;t<this.Xn.length;t++)this.Xn[t]=null}qa(t){let i;const s=this.ie[t];if(s>=this.Xn.length){const o=[];for(let a=0;a<this.Xn.length;a++)o[a]=this.Xn[a];this.Xn=o}this.Xn[s]===void 0||this.Xn[s]===null?i=[]:(i=this.Xn[s],this.Xn[s]=null);const n=this.mu[t];for(let o=0;o<n.length;o++){const a=n[o];i[a.index]=a}return i}Wa(t,i){this.Xn[this.ie[t]]=i}get layerSpacing(){return this.Vs}set layerSpacing(t){this.Vs!==t&&t>=0&&(this.Vs=t,this.p())}get columnSpacing(){return this.ti}set columnSpacing(t){this.ti!==t&&t>0&&(this.ti=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(t===0||t===90||t===180||t===270?(this.P=t,this.p()):r.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.cu}set cycleRemoveOption(t){this.cu!==t&&(t===1||t===0||t===2)&&(this.cu=t,this.p())}get layeringOption(){return this.fu}set layeringOption(t){this.fu!==t&&(t===10||t===11||t===12)&&(this.fu=t,this.p())}get initializeOption(){return this.uu}set initializeOption(t){this.uu!==t&&(t===20||t===21||t===22)&&(this.uu=t,this.p())}get iterations(){return this.mc}set iterations(t){this.mc!==t&&t>=0&&(this.mc=t,this.p())}get aggressiveOption(){return this.du}set aggressiveOption(t){this.du!==t&&(t===30||t===31||t===32)&&(this.du=t,this.p())}get packOption(){return this.cr}set packOption(t){this.cr!==t&&t>=0&&t<8&&(this.cr=t,this.p())}get packIterations(){return this.gu}set packIterations(t){this.gu=t}get alignOption(){return this.Gn}set alignOption(t){this.Gn!==t&&t>=0&&t<16&&(this.Gn=t,this.p())}get centered(){return this.ja}set centered(t){this.centered!==t&&(this.ja=t,this.p())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(this.zn=t,this.p())}get maxLayer(){return this._}get maxIndex(){return this.Sw}get maxColumn(){return this.Bt}get minIndexLayer(){return this.jg}get maxIndexLayer(){return this.Bs}}y(Je,"CycleDepthFirst",0),y(Je,"CycleGreedy",1),y(Je,"CycleFromLayers",2),y(Je,"LayerOptimalLinkLength",10),y(Je,"LayerLongestPathSink",11),y(Je,"LayerLongestPathSource",12),y(Je,"InitDepthFirstOut",20),y(Je,"InitDepthFirstIn",21),y(Je,"InitNaive",22),y(Je,"AggressiveNone",30),y(Je,"AggressiveLess",31),y(Je,"AggressiveMore",32),y(Je,"PackNone",0),y(Je,"PackExpand",1),y(Je,"PackStraighten",2),y(Je,"PackMedian",4),y(Je,"PackAll",15),y(Je,"AlignNone",0),y(Je,"AlignUpperLeft",1),y(Je,"AlignUpperRight",2),y(Je,"AlignLowerLeft",4),y(Je,"AlignLowerRight",8),y(Je,"AlignAll",15);class od extends vn{constructor(e){super(e)}createVertex(){const e=new pr(this);return e.centered=this.layout.centered,e}createEdge(){return new rd(this)}}class pr extends kn{constructor(t){super(t);y(this,"pl");y(this,"pa");y(this,"Tt");y(this,"sP");y(this,"nP");y(this,"ja");y(this,"ii");y(this,"pu");y(this,"to");y(this,"_k");y(this,"$k");y(this,"Zk");y(this,"pc");y(this,"Yn");y(this,"MF");y(this,"Ja");y(this,"rs");y(this,"yu");y(this,"mi");y(this,"Kn");y(this,"Lw",null);y(this,"Aw",null);y(this,"Tw",null);y(this,"Dw",null);this.pl=-1,this.pa=-1,this.Tt=-1,this.sP=NaN,this.nP=null,this.ja=!0,this.ii=!1,this.pu=NaN,this.to=NaN,this._k=0,this.$k=null,this.Zk=null}static LF(t,i){return t.index-i.index}getProperSourceEdges(){if(!this.Tw){const t=[];for(const i of this.Mo){const s=i;s.valid&&t.push(s)}this.Tw=t}return this.Tw}getProperDestinationEdges(){if(!this.Dw){const t=[];for(const i of this.rr){const s=i;s.valid&&t.push(s)}this.Dw=t}return this.Dw}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const s of i)if(s.toVertex===t)return s;r.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Lw){const t=[];for(const i of this.Mo){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.fromVertex)}t.sort(pr.LF),this.Lw=t}return this.Lw}getProperDestinationVertexes(){if(!this.Aw){const t=[];for(const i of this.rr){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.toVertex)}t.sort(pr.LF),this.Aw=t}return this.Aw}addSourceEdge(t){super.addSourceEdge(t),this.Lw=null,this.Tw=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Lw=null,this.Tw=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Aw=null,this.Dw=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Aw=null,this.Dw=null}commit(){if(this.centered)super.commit();else{const t=this.node;if(t!==null){const i=this.network.layout;if(!i)return;i.direction===180||i.direction===270?t.moveTo(this.bounds.right-t.actualBounds.width,this.bounds.bottom-t.actualBounds.height):t.moveTo(this.bounds.x,this.bounds.y)}}}get layer(){return this.pl}set layer(t){this.pl=t}get column(){return this.pa}set column(t){this.pa=t}get index(){return this.Tt}set index(t){this.Tt=t}get component(){return this.sP}set component(t){this.sP!==t&&(this.sP=t)}get near(){return this.nP}set near(t){this.nP!==t&&(this.nP=t)}get centered(){return this.ja}set centered(t){this.ja=t}}class rd extends ko{constructor(t){super(t);y(this,"ii");y(this,"oP");y(this,"rP");y(this,"lP");y(this,"aP");y(this,"hP");y(this,"cP");this.ii=!1,this.oP=!1,this.rP=!1,this.lP=NaN,this.aP=NaN,this.hP=0,this.cP=0}get fromVertex(){return this.ss}set fromVertex(t){this.ss!==t&&(this.ss=t)}get toVertex(){return this.ns}set toVertex(t){this.ns!==t&&(this.ns=t)}get valid(){return this.ii}set valid(t){this.ii!==t&&(this.ii=t)}get rev(){return this.oP}set rev(t){this.oP!==t&&(this.oP=t)}get forest(){return this.rP}set forest(t){this.rP!==t&&(this.rP=t)}get portFromPos(){return this.lP}set portFromPos(t){this.lP!==t&&(this.lP=t)}get portToPos(){return this.aP}set portToPos(t){this.aP!==t&&(this.aP=t)}get portFromColOffset(){return this.hP}set portFromColOffset(t){this.hP!==t&&(this.hP=t)}get portToColOffset(){return this.cP}set portToColOffset(t){this.cP!==t&&(this.cP=t)}}var kh=(M=>(M[M.Default=0]="Default",M[M.Destination=1]="Destination",M[M.Source=2]="Source",M))(kh||{}),Sh=(M=>(M[M.Forwards=10]="Forwards",M[M.Reverse=11]="Reverse",M[M.Ascending=12]="Ascending",M[M.Descending=13]="Descending",M))(Sh||{}),Ph=(M=>(M[M.CenterSubtrees=20]="CenterSubtrees",M[M.CenterChildren=21]="CenterChildren",M[M.Start=22]="Start",M[M.End=23]="End",M[M.Bus=24]="Bus",M[M.BusBranching=25]="BusBranching",M[M.TopLeftBus=26]="TopLeftBus",M[M.BottomRightBus=27]="BottomRightBus",M[M.Custom=28]="Custom",M))(Ph||{}),Mh=(M=>(M[M.None=30]="None",M[M.Block=31]="Block",M))(Mh||{}),Ch=(M=>(M[M.Layered=40]="Layered",M[M.LastParents=41]="LastParents",M[M.Alternating=42]="Alternating",M[M.RootOnly=43]="RootOnly",M))(Ch||{}),Nh=(M=>(M[M.Vertical=50]="Vertical",M[M.Horizontal=51]="Horizontal",M[M.FixedRoots=52]="FixedRoots",M))(Nh||{}),ad=(M=>(M[M.Individual=60]="Individual",M[M.Siblings=61]="Siblings",M[M.Uniform=62]="Uniform",M))(ad||{});class ze extends bi{constructor(t){super();y(this,"Ie");y(this,"Fe");y(this,"wu");y(this,"$g");y(this,"yL");y(this,"Xi");y(this,"He");y(this,"Us");y(this,"V");y(this,"B");y(this,"fP");y(this,"ws");this.Ie=new F,this.Fe=0,this.ws=1,this.wu=40,this.$g=60,this.yL=[],this.Xi=!0,this.He=50,this.Us=new _(10,10).k();const i=new Ah(this);this.V=new us(i),this.B=new us(i),this.fP=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Fe=this.Fe,t.wu=this.wu,t.$g=this.$g,t.Xi=this.Xi,t.He=this.He,t.Us.h(this.Us),t.V.copyInheritedPropertiesFrom(this.V),t.B.copyInheritedPropertiesFrom(this.B)}fe(t){t in Ph?this.alignment=t:t in Nh?this.arrangement=t:t in Mh?this.compaction=t:t in kh?this.path=t:t in Sh?this.sorting=t:t in Ch?this.treeStyle=t:super.fe(t)}createNetwork(){return new Ah(this)}makeNetwork(t){const i=this.createNetwork(),s=n=>{if(n instanceof wt)return!n.isLinkLabel&&n.category!=="Comment";if(n instanceof Nt){const o=n.fromNode;if(o===null||o.isLinkLabel||o.category==="Comment")return!1;const a=n.toNode;return!(a===null||a.isLinkLabel||a.category==="Comment")}return!1};return t instanceof qt?(i.addParts(t.nodes,!0,s),i.addParts(t.links,!0,s)):t instanceof Ft?i.addParts(t.memberParts,!1,s):i.addParts(t.iterator,!1,s),i}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;i===null&&t instanceof qt&&(i=t),this.path===0&&i!==null?this.ws=i.isTreePathToChildren?1:2:this.ws=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.oU(),this.rU(),this.lU(),this.aU(),this.fL(),this.hU(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ie=new F,this.isValidLayout=!0}oU(){if(this.network===null)return;this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const o=t.value;o.initialized=!1,o.level=0,o.parent=null,o.children=[]}if(this.Ie.count>0){const o=new F,a=this.Ie.iterator;for(;a.next();){const l=a.value;if(l instanceof wt){const h=this.network.findVertex(l);h!==null&&o.add(h)}else l instanceof us&&o.add(l)}this.Ie=o}this.Ie.count===0&&this.findRoots();const i=this.Ie.copy().iterator;for(;i.next();){const o=i.value;o.initialized||(o.initialized=!0,this.wL(o))}let s=this.network.vertexes,n=null;for(;n=this.cU(s),n.count>0;){const o=this.AF(n);o!==null&&(this.Ie.add(o),o.initialized=!0,this.wL(o)),s=n}}cU(t){const i=new F,s=t.iterator;for(;s.next();){const n=s.value;n.initialized||i.add(n)}return i}findRoots(){if(this.network===null)return;const t=this.network.vertexes,i=t.iterator;for(;i.next();){const s=i.value;switch(this.ws){case 1:s.sourceEdges.count===0&&this.Ie.add(s);break;case 2:s.destinationEdges.count===0&&this.Ie.add(s);break;default:r.o("Unhandled path value "+this.ws.toString())}}if(this.Ie.count===0){const s=this.AF(t);s!==null&&this.Ie.add(s)}}AF(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const o=n.value;switch(this.ws){case 1:o.sourceEdges.count<i&&(i=o.sourceEdges.count,s=o);break;case 2:o.destinationEdges.count<i&&(i=o.destinationEdges.count,s=o);break;default:r.o("Unhandled path value "+this.ws.toString())}}return s}wL(t){if(t===null)return;switch(this.ws){case 1:if(t.destinationEdges.count>0){const n=new E,o=t.destinationVertexes;for(;o.next();){const a=o.value;this.TF(t,a)&&n.add(a)}n.count>0&&(t.children=n.toArray())}break;case 2:if(t.sourceEdges.count>0){const n=new E,o=t.sourceVertexes;for(;o.next();){const a=o.value;this.TF(t,a)&&n.add(a)}n.count>0&&(t.children=n.toArray())}break;default:r.o("Unhandled path value"+this.ws.toString())}const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.initialized=!0,o.level=t.level+1,o.parent=t,this.Ie.delete(o)}for(let n=0;n<s;n++){const o=i[n];this.wL(o)}}TF(t,i){return i.initialized?this.fU(i,t)||i.level>t.level?!1:(this.uU(i.parent,i),!0):!0}fU(t,i){if(i===null)return!1;let s=i.parent;for(;s!==null&&s!==t;)s=s.parent;return s===t}uU(t,i){if(t===null||i===null)return;const s=t.children;let n=0;for(let o=0;o<s.length;o++)s[o]===i&&n++;if(n>0){const o=new Array(s.length-n);let a=0;for(let l=0;l<s.length;l++)s[l]!==i&&(o[a++]=s[l]);t.children=o}}rU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof us&&this.DF(i)}}DF(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let i=0,s=t.childrenCount,n=0;const o=t.children,a=o.length;for(let l=0;l<a;l++){const h=o[l];this.DF(h),i+=h.descendantCount+1,s=Math.max(s,h.maxChildrenCount),n=Math.max(n,h.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=s,t.maxGenerationCount=s>0?n+1:0}dU(t){switch(this.wu){default:case 40:return t.parent!==null?t.parent:this.V;case 43:return t.parent===null?this.V:t.parent.parent===null?this.B:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.B:this.V;case 41:{let i=!0;if(t.childrenCount===0)i=!1;else{const s=t.children,n=s.length;for(let o=0;o<n;o++)if(s[o].childrenCount>0){i=!1;break}}return i&&t.parent!==null?this.B:t.parent!==null?t.parent:this.V}}}initializeTreeVertexValues(t){const i=this.dU(t);if(t.copyInheritedPropertiesFrom(i),t.parent!==null&&t.parent.alignment===25){let s=t.angle;const n=t.parent.children;let o=0;for(;o<n.length&&t!==n[o];)o++;o%2===0?o!==n.length-1&&(s===90?s=180:s===180?s=270:s===270?s=180:s=270):s===90?s=0:s===180?s=90:s===270?s=0:s=90,t.angle=s}t.initialized=!0}lU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof us&&this.vF(i)}}vF(t){if(t===null)return;this.assignTreeVertexValues(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.vF(o)}}assignTreeVertexValues(t){}aU(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof us&&this.FF(i)}}FF(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.FF(o)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}fL(){if(!this.comments||this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.angle,s=t.parent;let n=0,o=21,a=!1;s!==null&&(n=s.angle,o=s.alignment,a=this.isBusAlignment(o));const l=i===90||i===270,h=n===90||n===270,d=t.childrenCount===0;let f=0,m=0,p=0;const b=t.commentSpacing;if(t.node!==null){const x=t.node.findNodesConnected();for(;x.next();){const v=x.value;if(v.category!=="Comment"||!v.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(v),v.ensureBounds();const S=v.measuredBounds;l&&!d||!a&&!h&&d||a&&h&&d?(f=Math.max(f,S.width),m+=S.height+Math.abs(p)):(f+=S.width+Math.abs(p),m=Math.max(m,S.height)),p=b}}if(t.comments!==null){l&&!d||!a&&!h&&d||a&&h&&d?(f+=Math.abs(t.commentMargin),m=Math.max(0,m-t.height)):(m+=Math.abs(t.commentMargin),f=Math.max(0,f-t.width));const x=Y.z(0,0,t.bounds.width+f,t.bounds.height+m);t.bounds=x,Y.i(x)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}vw(t){return t===24||t===25}xL(t){const i=t.parent;if(i!==null){const s=i.alignment;if(this.isBusAlignment(s))if(this.vw(s)){const n=i.children;let o=0;for(;o<n.length&&t!==n[o];)o++;return o%2===0}else return s===26}return!1}layoutComments(t){if(t.comments!==null){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,a=21,l=!1;s!==null&&(o=s.angle,a=s.alignment,l=this.isBusAlignment(a));const h=n===90||n===270,d=o===90||o===270,f=t.childrenCount===0,m=this.xL(t);let p=0;const b=t.comments,x=b.length,v=L.l();for(let P=0;P<x;P++){const T=b[P],A=T.measuredBounds;if(h&&!f||!l&&!d&&f||l&&d&&f){if(o>135&&!l||d&&m)if(t.commentMargin>=0){v.e(t.bounds.x-t.commentMargin-A.width,t.bounds.y+p),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleLeft,O.toSpot=X.MiddleRight}}else{v.e(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+p),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleRight,O.toSpot=X.MiddleLeft}}else if(t.commentMargin>=0){v.e(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+p),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleRight,O.toSpot=X.MiddleLeft}}else{v.e(t.bounds.x+t.commentMargin-A.width,t.bounds.y+p),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleLeft,O.toSpot=X.MiddleRight}}t.commentSpacing>=0?p+=A.height+t.commentSpacing:p+=t.commentSpacing-A.height}else{if(o>135&&!l||!d&&m)if(t.commentMargin>=0){v.e(t.bounds.x+p,t.bounds.y-t.commentMargin-A.height),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleTop,O.toSpot=X.MiddleBottom}}else{v.e(t.bounds.x+p,t.bounds.y+t.focus.y*2-t.commentMargin),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleBottom,O.toSpot=X.MiddleTop}}else if(t.commentMargin>=0){v.e(t.bounds.x+p,t.bounds.y+t.focus.y*2+t.commentMargin),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleBottom,O.toSpot=X.MiddleTop}}else{v.e(t.bounds.x+p,t.bounds.y+t.commentMargin-A.height),T.move(v);const C=T.findLinksInto();for(;C.next();){const O=C.value;O.fromSpot=X.MiddleTop,O.toSpot=X.MiddleBottom}}t.commentSpacing>=0?p+=A.width+t.commentSpacing:p+=t.commentSpacing-A.width}}L.i(v);const S=p-t.commentSpacing-(h?i.height:i.width);if(this.ws===1){const P=t.destinationEdges;for(;P.next();){const T=P.value.link;T!==null&&!T.isAvoiding&&(T.fromEndSegmentLength=S>0?S:NaN)}}else{const P=t.sourceEdges;for(;P.next();){const T=P.value.link;T!==null&&!T.isAvoiding&&(T.toEndSegmentLength=S>0?S:NaN)}}}}hU(){if(this.network===null)return;if(this.layerStyle===62){const i=[];let s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n);const a=o.angle===0||o.angle===180;let l=i[n.level];l===void 0&&(l=0),i[n.level]=Math.max(l,a?n.width:n.height)}for(let n=0;n<i.length;n++)i[n]===void 0&&(i[n]=0);for(this.yL=i,s=this.network.vertexes.iterator;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n),o.angle===0||o.angle===180?(o.angle===180&&(n.focusX+=i[n.level]-n.width),n.width=i[n.level]):(o.angle===270&&(n.focusY+=i[n.level]-n.height),n.height=i[n.level])}}else if(this.layerStyle===61){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value,n=s.angle===0||s.angle===180;let o=-1;for(let a=0;a<s.children.length;a++){const l=s.children[a];o=Math.max(o,n?l.width:l.height)}if(o>=0)for(let a=0;a<s.children.length;a++){const l=s.children[a];n?(s.angle===180&&(l.focusX+=o-l.width),l.width=o):(s.angle===270&&(l.focusY+=o-l.height),l.height=o)}}}const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof us&&this.layoutTree(i)}}layoutTree(t){if(t===null)return;const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.layoutTree(o)}switch(t.compaction){case 30:this.RF(t);break;default:case 31:t.alignment===25?this.RF(t):this.gU(t);break}}RF(t){if(t.childrenCount===0){let rt=!1,st=0,ht=21;t.parent!==null&&(st=t.parent.angle,ht=t.parent.alignment,rt=this.isBusAlignment(ht));const pt=this.xL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((st===180||st===270)&&!rt||pt)?st===180&&!rt||(st===90||st===270)&&pt?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0);return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,a=o.length;for(let rt=0;rt<a;rt++){const st=o[rt];n=Math.max(n,s?st.dt.width:st.dt.height)}const l=t.alignment,h=l===22,d=l===23,f=this.isBusAlignment(l),m=Math.max(0,t.breadthLimit),p=this.computeLayerSpacing(t),b=t.nodeSpacing,x=this.computeNodeIndent(t),v=h||d?0:x/2,S=t.rowSpacing;let P=0;(h||d)&&(P=Math.max(0,t.rowIndent));const T=t.width,A=t.height;let C=0,O=0,R=0,I=0,H=0,V=0,z=0,K=0,$=0,q=0;if(f&&!this.vw(l)&&i>135&&o.reverse(),this.vw(l))if(a>1)for(let rt=0;rt<a;rt++){const st=o[rt],ht=st.dt;rt%2===0&&rt!==a-1?$=Math.max($,(s?ht.width:ht.height)+this.computeBusNodeSpacing(st)-b):rt%2!==0&&(q=Math.max(q,(s?ht.width:ht.height)+this.computeBusNodeSpacing(st)-b))}else a===1&&($=s?o[0].dt.width:o[0].dt.height);if(f)switch(l){case 24:case 25:const rt=Y.l();i<135?this.OF(t,o,$,q,C,O,rt):this.IF(t,o,$,q,C,O,rt),$=rt.x,C=rt.width,O=rt.height,Y.i(rt);break;case 26:for(let st=0;st<a;st++){const ht=o[st],pt=ht.dt,zt=z===0?0:S;s?(ht.U.e(n-pt.width,H+zt),C=Math.max(C,pt.width),O=Math.max(O,H+zt+pt.height),H+=zt+pt.height):(ht.U.e(I+zt,n-pt.height),C=Math.max(C,I+zt+pt.width),O=Math.max(O,pt.height),I+=zt+pt.width),z++}break;case 27:for(let st=0;st<a;st++){const ht=o[st],pt=ht.dt,zt=z===0?0:S;s?(ht.U.e(b/2+t.focus.x,H+zt),C=Math.max(C,pt.width),O=Math.max(O,H+zt+pt.height),H+=zt+pt.height):(ht.U.e(I+zt,b/2+t.focus.y),C=Math.max(C,I+zt+pt.width),O=Math.max(O,pt.height),I+=zt+pt.width),z++}break}else for(let rt=0;rt<a;rt++){const st=o[rt],ht=st.dt;if(s){m>0&&z>0&&I+b+ht.width>m&&(I<n&&this.yc(t,l,n-I,0,K,rt-1),V++,z=0,K=rt,R=O,I=0,H=i>135?-O-S:O+S);const pt=z===0?v:b;this.uP(st,0,H),st.U.e(I+pt,H),C=Math.max(C,I+pt+ht.width),O=Math.max(O,R+(V===0?0:S)+ht.height),I+=pt+ht.width}else{m>0&&z>0&&H+b+ht.height>m&&(H<n&&this.yc(t,l,0,n-H,K,rt-1),V++,z=0,K=rt,R=C,H=0,I=i>135?-C-S:C+S);const pt=z===0?v:b;this.uP(st,I,0),st.U.e(I,H+pt),O=Math.max(O,H+pt+ht.height),C=Math.max(C,R+(V===0?0:S)+ht.width),H+=pt+ht.height}z++}V>0&&(s?(O+=Math.max(0,p),I<C&&this.yc(t,l,C-I,0,K,a-1),P>0&&(d||this.xu(t,P,0,0,a-1),C+=P)):(C+=Math.max(0,p),H<O&&this.yc(t,l,0,O-H,K,a-1),P>0&&(d||this.xu(t,0,P,0,a-1),O+=P)));let J=0,ot=0;switch(l){case 20:s?J+=C/2-t.focus.x-x/2:ot+=O/2-t.focus.y-x/2;break;default:case 21:if(V>0)s?J+=C/2-t.focus.x-x/2:ot+=O/2-t.focus.y-x/2;else{const st=a;if(s){const ht=o[0].U.x+o[0].at.x,pt=o[st-1].U.x+o[st-1].at.x+o[st-1].focus.x*2;J+=ht+(pt-ht)/2-t.focus.x-x/2}else{const ht=o[0].U.y+o[0].at.y,pt=o[st-1].U.y+o[st-1].at.y+o[st-1].focus.y*2;ot+=ht+(pt-ht)/2-t.focus.y-x/2}}break;case 22:s?(J-=x,C+=x):(ot-=x,O+=x);break;case 23:s?(J+=C-t.width+x,C+=x):(ot+=O-t.height+x,O+=x);break;case 24:case 25:s?a>1?J+=$+b/2-t.focus.x:J+=o[0].focus.x-t.focus.x+o[0].at.x:a>1?ot+=$+b/2-t.focus.y:ot+=o[0].focus.y-t.focus.y+o[0].at.y;break;case 26:s?J+=C+b/2-t.focus.x:ot+=O+b/2-t.focus.y;break;case 27:break;case 28:const rt=this.customAlignment(t,J,ot,C,O);J=rt[0],ot=rt[1],C=rt[2],O=rt[3];break}for(let rt=0;rt<a;rt++){const st=o[rt];s?st.U.e(st.U.x+st.at.x-J,st.U.y+(i>135?(f?-O:-st.dt.height)+st.at.y-p:A+p+st.at.y)):st.U.e(st.U.x+(i>135?(f?-C:-st.dt.width)+st.at.x-p:T+p+st.at.x),st.U.y+st.at.y-ot)}s?(C=this.bL(t,C,J),J<0&&(J=0),i>135&&(ot+=O+p),O=Math.max(Math.max(O,A),O+A+p)):(i>135&&(J+=C+p),C=Math.max(Math.max(C,T),C+T+p),O=this.kL(t,O,ot),ot<0&&(ot=0)),t.at.e(J,ot),t.dt.e(C,O)}customAlignment(t,i,s,n,o){return[i,s,n,o]}OF(t,i,s,n,o,a,l){const h=i.length;if(h===0)return l.e(s,0,o,a),l;if(h===1){const P=i[0];return o=P.dt.width,a=P.dt.height,l.e(s,0,o,a),l}const d=t.nodeSpacing,f=t.rowSpacing,m=this.orthoAngle(t)===90;let p=0,b=0,x=0;for(let P=0;P<h;P++){if(P%2!==0||h>1&&P===h-1)continue;const T=i[P],A=T.dt,C=p===0?0:f;if(m){const O=this.computeBusNodeSpacing(T)-d;T.U.e(s-(A.width+O),x+C),o=Math.max(o,A.width+O),a=Math.max(a,x+C+A.height),x+=C+A.height}else{const O=this.computeBusNodeSpacing(T)-d;T.U.e(b+C,s-(A.height+O)),a=Math.max(a,A.height+O),o=Math.max(o,b+C+A.width),b+=C+A.width}p++}p=0;const v=b,S=x;m?(b=s+d,x=0):(b=0,x=s+d);for(let P=0;P<h;P++){if(P%2===0)continue;const T=i[P],A=T.dt,C=p===0?0:f;if(m){const O=this.computeBusNodeSpacing(T)-d;T.U.e(b+O,x+C),o=Math.max(o,b+A.width+O),a=Math.max(a,x+C+A.height),x+=C+A.height}else{const O=this.computeBusNodeSpacing(T)-d;T.U.e(b+C,x+O),o=Math.max(o,b+C+A.width),a=Math.max(a,x+A.height+O),b+=C+A.width}p++}if(h>1&&h%2===1){const P=i[h-1],T=P.dt,A=this.computeBusLastRowSpacing(P,m?Math.max(Math.abs(S),Math.abs(x)):Math.max(Math.abs(v),Math.abs(b)));if(m){P.U.e(s+d/2-P.focus.x-P.at.x,a+A);const C=s+d/2-P.focus.x-P.at.x;o=Math.max(o,C+T.width),C<0&&(o-=C),a=Math.max(a,Math.max(S,x)+A+T.height),P.U.x<0&&(s=this.dP(t,P.U.x,!1,s,d))}else{P.U.e(o+A,s+d/2-P.focus.y-P.at.y),o=Math.max(o,Math.max(v,b)+A+T.width);const C=s+d/2-P.focus.y-P.at.y;a=Math.max(a,C+T.height),C<0&&(a-=C),P.U.y<0&&(s=this.dP(t,P.U.y,!0,s,d))}}return l.e(s,0,o,a),l}IF(t,i,s,n,o,a,l){const h=i.length;if(h===0)return l.e(s,0,o,a),l;if(h===1){const P=i[0];return o=P.dt.width,a=P.dt.height,l.e(s,0,o,a),l}const d=t.nodeSpacing,f=t.rowSpacing,m=this.orthoAngle(t)===270;let p=0,b=0,x=0;for(let P=0;P<h;P++){if(P%2!==0||h>1&&P===h-1)continue;const T=i[P],A=T.dt,C=p===0?0:f;if(m){const O=this.computeBusNodeSpacing(T)-d;x-=C+A.height,T.U.e(s-(A.width+O),x),o=Math.max(o,A.width+O),a=Math.max(a,Math.abs(x))}else{const O=this.computeBusNodeSpacing(T)-d;b-=C+A.width,T.U.e(b,s-(A.height+O)),a=Math.max(a,A.height+O),o=Math.max(o,Math.abs(b))}p++}p=0;const v=b,S=x;m?(b=s+d,x=0):(b=0,x=s+d);for(let P=0;P<h;P++){if(P%2===0)continue;const T=i[P],A=T.dt,C=p===0?0:f;if(m){const O=this.computeBusNodeSpacing(T)-d;x-=C+A.height,T.U.e(b+O,x),o=Math.max(o,b+A.width+O),a=Math.max(a,Math.abs(x))}else{const O=this.computeBusNodeSpacing(T)-d;b-=C+A.width,T.U.e(b,x+O),a=Math.max(a,x+A.height+O),o=Math.max(o,Math.abs(b))}p++}if(h>1&&h%2===1){const P=i[h-1],T=P.dt,A=this.computeBusLastRowSpacing(P,m?Math.max(Math.abs(S),Math.abs(x)):Math.max(Math.abs(v),Math.abs(b)));if(m){P.U.e(s+d/2-P.focus.x-P.at.x,-a-T.height-A);const C=s+d/2-P.focus.x-P.at.x;o=Math.max(o,C+T.width),C<0&&(o-=C),a=Math.max(a,Math.abs(Math.min(S,x))+A+T.height),P.U.x<0&&(s=this.dP(t,P.U.x,!1,s,d))}else{P.U.e(-o-T.width-A,s+d/2-P.focus.y-P.at.y),o=Math.max(o,Math.abs(Math.min(v,b))+A+T.width);const C=s+d/2-P.focus.y-P.at.y;a=Math.max(a,C+T.height),C<0&&(a-=C),P.U.y<0&&(s=this.dP(t,P.U.y,!0,s,d))}}for(let P=0;P<h;P++){const T=i[P];m?T.U.e(T.U.x,T.U.y+a):T.U.e(T.U.x+o,T.U.y)}return l.e(s,0,o,a),l}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return t.parent===null?0:t.parent.rowSpacing}dP(t,i,s,n,o){const a=t.children,l=a.length;for(let d=0;d<l;d++)s?a[d].U.e(a[d].U.x,a[d].U.y-i):a[d].U.e(a[d].U.x-i,a[d].U.y);const h=a[l-1];return Math.max(n,s?h.at.y+h.focus.y-o/2:h.at.x+h.focus.x-o/2)}bL(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.width>n&&(n=s+t.width),s<0&&(n-=s),n;case 22:return t.width>i?t.width:i;case 23:return t.focus.x*2>i?t.width:i+t.width-t.focus.x*2;case 24:case 25:const o=Math.min(0,s),a=Math.max(i,s+t.width);return Math.max(t.width,a-o);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}kL(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.height>n&&(n=s+t.height),s<0&&(n-=s),n;case 22:return t.height>i?t.height:i;case 23:return t.focus.y*2>i?t.height:i+t.height-t.focus.y*2;case 24:case 25:const o=Math.min(0,s),a=Math.max(i,s+t.height);return Math.max(t.height,a-o);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}PL(t,i,s){switch(t){case 20:i/=2,s/=2;break;case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:r.o("Unhandled alignment value "+t.toString())}return new L(i,s)}yc(t,i,s,n,o,a){const l=this.PL(i,s,n);this.xu(t,l.x,l.y,o,a)}xu(t,i,s,n,o){if(i===0&&s===0)return;const a=t.children;for(let l=n;l<=o;l++){const h=a[l].U;h.x+=i,h.y+=s}}uP(t,i,s){const n=t.parent;switch(this.ws){case 1:{const o=t.sourceEdges;for(;o.next();){const a=o.value;a.fromVertex===n&&a.relativePoint.e(i,s)}break}case 2:{const o=t.destinationEdges;for(;o.next();){const a=o.value;a.toVertex===n&&a.relativePoint.e(i,s)}break}default:r.o("Unhandled path value "+this.ws.toString())}}gU(t){if(t.childrenCount===0){const St=t.parent;let Ct=!1,Qt=0,Wt=21;St!==null&&(Qt=St.angle,Wt=St.alignment,Ct=this.isBusAlignment(Wt));const xt=this.xL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((Qt===180||Qt===270)&&!Ct||xt)?Qt===180&&!Ct||(Qt===90||Qt===270)&&xt?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0),t.Zg=null,t.Qg=null;return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,a=o.length;for(let St=0;St<a;St++){const Ct=o[St];n=Math.max(n,s?Ct.dt.width:Ct.dt.height)}const l=t.alignment,h=l===22,d=l===23,f=this.isBusAlignment(l),m=Math.max(0,t.breadthLimit),p=this.computeLayerSpacing(t),b=t.nodeSpacing,x=this.computeNodeIndent(t),v=t.rowSpacing;let S=0;(h||d)&&(S=Math.max(0,t.rowIndent));const P=t.width,T=t.height;let A=0,C=0,O=0,R=null,I=null,H=0,V=0,z=0,K=0,$=0,q=0,J=0,ot=0,rt=0;if(f&&!this.vw(l)&&i>135&&o.reverse(),this.vw(l))if(a>1)for(let St=0;St<a;St++)St%2===0&&St!==a-1?ot=Math.max(ot,s?o[St].dt.width:o[St].dt.height):St%2!==0&&(rt=Math.max(rt,s?o[St].dt.width:o[St].dt.height));else a===1&&(ot=s?o[0].dt.width:o[0].dt.height);if(f){switch(l){case 24:const St=Y.l();i<135?this.OF(t,o,ot,rt,A,C,St):this.IF(t,o,ot,rt,A,C,St),ot=St.x,A=St.width,C=St.height,Y.i(St);break;case 26:for(let Ct=0;Ct<a;Ct++){const Qt=o[Ct],Wt=Qt.dt,xt=q===0?0:v;s?(Qt.U.e(n-Wt.width,K+xt),A=Math.max(A,Wt.width),C=Math.max(C,K+xt+Wt.height),K+=xt+Wt.height):(Qt.U.e(z+xt,n-Wt.height),A=Math.max(A,z+xt+Wt.width),C=Math.max(C,Wt.height),z+=xt+Wt.width),q++}break;case 27:for(let Ct=0;Ct<a;Ct++){const Qt=o[Ct],Wt=Qt.dt,xt=q===0?0:v;s?(Qt.U.e(b/2+t.focus.x,K+xt),A=Math.max(A,Wt.width),C=Math.max(C,K+xt+Wt.height),K+=xt+Wt.height):(Qt.U.e(z+xt,b/2+t.focus.y),A=Math.max(A,z+xt+Wt.width),C=Math.max(C,Wt.height),z+=xt+Wt.width),q++}break}R=this.pi(2),I=this.pi(2),s?(R[0].e(0,0),R[1].e(0,C),I[0].e(A,0),I[1].e(A,C)):(R[0].e(0,0),R[1].e(A,0),I[0].e(0,C),I[1].e(A,C))}else for(let St=0;St<a;St++){const Ct=o[St],Qt=Ct.dt;if(s){m>0&&q>0&&z+b+Qt.width>m&&(z<n&&this.yc(t,l,n-z,0,J,St-1),$++,q=0,J=St,O=C,z=0,K=i>135?-C-v:C+v),this.uP(Ct,0,K);let Wt=0;if(q===0)R=Ct.Zg,I=Ct.Qg,H=Qt.width,V=Qt.height,(R===null||I===null||i!==this.orthoAngle(Ct))&&(R=this.pi(2),I=this.pi(2),R[0].e(0,0),R[1].e(0,V),I[0].e(H,0),I[1].e(H,V));else{const xt=r.nt(),Ot=Y.l();this.EF(t,Ct,R,I,H,V,xt,Ot),Wt=Ot.x,R=xt[0],I=xt[1],H=Ot.width,V=Ot.height,r.Z(xt),z<Qt.width&&Wt<0&&(this.xu(t,-Wt,0,J,St-1),this.gP(R,-Wt,0),this.gP(I,-Wt,0),Wt=0),Y.i(Ot)}Ct.U.e(Wt,K),A=Math.max(A,H),C=Math.max(C,O+($===0?0:v)+Qt.height),z=H}else{m>0&&q>0&&K+b+Qt.height>m&&(K<n&&this.yc(t,l,0,n-K,J,St-1),$++,q=0,J=St,O=A,K=0,z=i>135?-A-v:A+v),this.uP(Ct,z,0);let Wt=0;if(q===0)R=Ct.Zg,I=Ct.Qg,H=Qt.width,V=Qt.height,(R===null||I===null||i!==this.orthoAngle(Ct))&&(R=this.pi(2),I=this.pi(2),R[0].e(0,0),R[1].e(H,0),I[0].e(0,V),I[1].e(H,V));else{const xt=r.nt(),Ot=Y.l();this.EF(t,Ct,R,I,H,V,xt,Ot),Wt=Ot.x,R=xt[0],I=xt[1],H=Ot.width,V=Ot.height,r.Z(xt),K<Qt.height&&Wt<0&&(this.xu(t,0,-Wt,J,St-1),this.gP(R,0,-Wt),this.gP(I,0,-Wt),Wt=0),Y.i(Ot)}Ct.U.e(z,Wt),C=Math.max(C,V),A=Math.max(A,O+($===0?0:v)+Qt.width),K=V}q++}$>0&&(s?(C+=Math.max(0,p),z<A&&this.yc(t,l,A-z,0,J,a-1),S>0&&(d||this.xu(t,S,0,0,a-1),A+=S)):(A+=Math.max(0,p),K<C&&this.yc(t,l,0,C-K,J,a-1),S>0&&(d||this.xu(t,0,S,0,a-1),C+=S)));let st=0,ht=0;switch(l){case 20:s?st+=A/2-t.focus.x-x/2:ht+=C/2-t.focus.y-x/2;break;default:case 21:if($>0)s?st+=A/2-t.focus.x-x/2:ht+=C/2-t.focus.y-x/2;else{const Ct=a;if(s){const Qt=o[0].U.x+o[0].at.x,Wt=o[Ct-1].U.x+o[Ct-1].at.x+o[Ct-1].focus.x*2;st+=Qt+(Wt-Qt)/2-t.focus.x-x/2}else{const Qt=o[0].U.y+o[0].at.y,Wt=o[Ct-1].U.y+o[Ct-1].at.y+o[Ct-1].focus.y*2;ht+=Qt+(Wt-Qt)/2-t.focus.y-x/2}}break;case 22:s?(st-=x,A+=x):(ht-=x,C+=x);break;case 23:s?(st+=A-t.width+x,A+=x):(ht+=C-t.height+x,C+=x);break;case 24:s?a>1?st+=ot+b/2-t.focus.x:st+=o[0].focus.x-t.focus.x+o[0].at.x:a>1?ht+=ot+b/2-t.focus.y:ht+=o[0].focus.y-t.focus.y+o[0].at.y;break;case 26:s?st+=A+b/2-t.focus.x:ht+=C+b/2-t.focus.y;break;case 27:break;case 28:const St=this.customAlignment(t,st,ht,A,C);st=St[0],ht=St[1],A=St[2],C=St[3];break}for(let St=0;St<a;St++){const Ct=o[St];s?Ct.U.e(Ct.U.x+Ct.at.x-st,Ct.U.y+(i>135?(f?-C:-Ct.dt.height)+Ct.at.y-p:T+p+Ct.at.y)):Ct.U.e(Ct.U.x+(i>135?(f?-A:-Ct.dt.width)+Ct.at.x-p:P+p+Ct.at.x),Ct.U.y+Ct.at.y-ht)}let pt=0,zt=0;if(f)s?(A=this.bL(t,A,st),st<0&&(st=0),i>135&&(ht+=C+p),C+=T+p,l===27&&(pt+=b/2+t.focus.x),zt+=T+p):(i>135&&(st+=A+p),A+=P+p,C=this.kL(t,C,ht),ht<0&&(ht=0),l===27&&(zt+=b/2+t.focus.y),pt+=P+p);else if(s){if(t.comments===null){if(P>A){const St=this.PL(l,P-A,0);pt=St.x,zt=St.y,A=P,st=0}}else A=this.bL(t,A,st);st<0&&(pt-=st,st=0),i>135&&(ht+=C+p),C=Math.max(Math.max(C,T),C+T+p),zt+=T+p}else{if(i>135&&(st+=A+p),A=Math.max(Math.max(A,P),A+P+p),t.comments===null){if(T>C){const St=this.PL(l,0,T-C);pt=St.x,zt=St.y,C=T,ht=0}}else C=this.kL(t,C,ht);ht<0&&(zt-=ht,ht=0),pt+=P+p}let kt,Mt;if($>0)kt=this.pi(4),Mt=this.pi(4),s?(kt[2].e(0,T+p),kt[3].e(kt[2].x,C),Mt[2].e(A,kt[2].y),Mt[3].e(Mt[2].x,kt[3].y)):(kt[2].e(P+p,0),kt[3].e(A,kt[2].y),Mt[2].e(kt[2].x,C),Mt[3].e(kt[3].x,Mt[2].y));else{kt=this.pi(R.length+2),Mt=this.pi(I.length+2);for(let St=0;St<R.length;St++){const Ct=R[St];kt[St+2].e(Ct.x+pt,Ct.y+zt)}for(let St=0;St<I.length;St++){const Ct=I[St];Mt[St+2].e(Ct.x+pt,Ct.y+zt)}}s?(kt[0].e(st,0),kt[1].e(kt[0].x,T),kt[2].y<kt[1].y&&(kt[2].x>kt[0].x?kt[2].h(kt[1]):kt[1].h(kt[2])),kt[3].y<kt[2].y&&(kt[3].x>kt[0].x?kt[3].h(kt[2]):kt[2].h(kt[3])),Mt[0].e(st+P,0),Mt[1].e(Mt[0].x,T),Mt[2].y<Mt[1].y&&(Mt[2].x<Mt[0].x?Mt[2].h(Mt[1]):Mt[1].h(Mt[2])),Mt[3].y<Mt[2].y&&(Mt[3].x<Mt[0].x?Mt[3].h(Mt[2]):Mt[2].h(Mt[3])),kt[2].y-=p/2,Mt[2].y-=p/2):(kt[0].e(0,ht),kt[1].e(P,kt[0].y),kt[2].x<kt[1].x&&(kt[2].y>kt[0].y?kt[2].h(kt[1]):kt[1].h(kt[2])),kt[3].x<kt[2].x&&(kt[3].y>kt[0].y?kt[3].h(kt[2]):kt[2].h(kt[3])),Mt[0].e(0,ht+T),Mt[1].e(P,Mt[0].y),Mt[2].x<Mt[1].x&&(Mt[2].y<Mt[0].y?Mt[2].h(Mt[1]):Mt[1].h(Mt[2])),Mt[3].x<Mt[2].x&&(Mt[3].y<Mt[0].y?Mt[3].h(Mt[2]):Mt[2].h(Mt[3])),kt[2].x-=p/2,Mt[2].x-=p/2),this.un(R),this.un(I),t.Zg=kt,t.Qg=Mt,t.at.e(st,ht),t.dt.e(A,C)}gP(t,i,s){for(let n=0;n<t.length;n++){const o=t[n];o.x+=i,o.y+=s}}EF(t,i,s,n,o,a,l,h){const d=this.orthoAngle(t),f=d===90||d===270,m=t.nodeSpacing,p=s,b=n,x=o,v=a;let S=i.Zg,P=i.Qg;const T=i.dt,A=f?Math.max(v,T.height):Math.max(x,T.width);if((S===null||d!==this.orthoAngle(i))&&(S=this.pi(2),P=this.pi(2),f?(S[0].e(0,0),S[1].e(0,T.height),P[0].e(T.width,0),P[1].e(P[0].x,S[1].y)):(S[0].e(0,0),S[1].e(T.width,0),P[0].e(0,T.height),P[1].e(S[1].x,P[0].y))),f){const C=x;let O=C-this.mU(b,S,C);return O+=m,s=this.pU(p,S,O),n=this.yU(b,P,O),o=Math.max(0,O)+T.width,a=A,this.un(p),this.un(S),this.un(b),this.un(P),l[0]=s,l[1]=n,h.e(O,0,o,a),h}else{const C=v;let O=C-this.wU(b,S,C);return O+=m,s=this.xU(p,S,O),n=this.bU(b,P,O),o=A,a=Math.max(0,O)+T.height,this.un(p),this.un(S),this.un(b),this.un(P),l[0]=s,l[1]=n,h.e(O,0,o,a),h}}xU(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,a=0,l=0;for(;a<i.length&&i[a].x<t[0].x;){const f=i[a++];n[l++].e(f.x,f.y+s)}for(;o<t.length;){const f=t[o++];n[l++].e(f.x,f.y)}const h=t[t.length-1].x;for(;a<i.length&&i[a].x<=h;)a++;for(;a<i.length&&i[a].x>h;){const f=i[a++];n[l++].e(f.x,f.y+s)}const d=this.pi(l);for(o=0;o<l;o++)d[o].h(n[o]);return this.un(n),d}pU(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,a=0,l=0;for(;a<i.length&&i[a].y<t[0].y;){const f=i[a++];n[l++].e(f.x+s,f.y)}for(;o<t.length;){const f=t[o++];n[l++].e(f.x,f.y)}const h=t[t.length-1].y;for(;a<i.length&&i[a].y<=h;)a++;for(;a<i.length&&i[a].y>h;){const f=i[a++];n[l++].e(f.x+s,f.y)}const d=this.pi(l);for(o=0;o<l;o++)d[o].h(n[o]);return this.un(n),d}bU(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,a=0,l=0;for(;o<t.length&&t[o].x<i[0].x;){const f=t[o++];n[l++].e(f.x,f.y)}for(;a<i.length;){const f=i[a++];n[l++].e(f.x,f.y+s)}const h=i[i.length-1].x;for(;o<t.length&&t[o].x<=h;)o++;for(;o<t.length&&t[o].x>h;){const f=t[o++];n[l++].e(f.x,f.y)}const d=this.pi(l);for(o=0;o<l;o++)d[o].h(n[o]);return this.un(n),d}yU(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.pi(t.length+i.length);let o=0,a=0,l=0;for(;o<t.length&&t[o].y<i[0].y;){const f=t[o++];n[l++].e(f.x,f.y)}for(;a<i.length;){const f=i[a++];n[l++].e(f.x+s,f.y)}const h=i[i.length-1].y;for(;o<t.length&&t[o].y<=h;)o++;for(;o<t.length&&t[o].y>h;){const f=t[o++];n[l++].e(f.x,f.y)}const d=this.pi(l);for(o=0;o<l;o++)d[o].h(n[o]);return this.un(n),d}wU(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,a=0;for(;o<t.length&&a<i.length;){const l=t[o],h=i[a],d=h.x;let f=h.y;f+=s;let m=l;o+1<t.length&&(m=t[o+1]);let p=h,b=p.x,x=p.y;a+1<i.length&&(p=i[a+1],b=p.x,x=p.y,x+=s);let v=n;l.x===d?v=f-l.y:l.x>d&&l.x<b?v=f+(l.x-d)/(b-d)*(x-f)-l.y:d>l.x&&d<m.x&&(v=f-(l.y+(d-l.x)/(m.x-l.x)*(m.y-l.y))),v<n&&(n=v),m.x<=l.x?o++:b<=d?a++:(m.x<=b&&o++,b<=m.x&&a++)}return n}mU(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,a=0;for(;o<t.length&&a<i.length;){const l=t[o],h=i[a];let d=h.x;const f=h.y;d+=s;let m=l;o+1<t.length&&(m=t[o+1]);let p=h,b=p.x,x=p.y;a+1<i.length&&(p=i[a+1],b=p.x,x=p.y,b+=s);let v=n;l.y===f?v=d-l.x:l.y>f&&l.y<x?v=d+(l.y-f)/(x-f)*(b-d)-l.x:f>l.y&&f<m.y&&(v=d-(l.x+(f-l.y)/(m.y-l.y)*(m.x-l.x))),v<n&&(n=v),m.y<=l.y?o++:x<=f?a++:(m.y<=x&&o++,x<=m.y&&a++)}return n}pi(t){const i=this.fP[t];if(i!==void 0){const n=i.pop();if(n!==void 0)return n}const s=[];for(let n=0;n<t;n++)s[n]=new L;return s}un(t){if(!t)return;const i=t.length;let s=this.fP[i];s===void 0&&(s=[],this.fP[i]=s),s.push(t)}arrangeTrees(){if(this.He===52){const t=this.Ie.iterator;for(;t.next();){const i=t.value;if(!(i instanceof us))continue;const s=i.node;if(s===null)continue;const n=s.position;let o=n.x,a=n.y;isFinite(o)||(o=0),isFinite(a)||(a=0),this.SL(i,o,a)}}else{const t=[],i=this.Ie.iterator;for(;i.next();){const a=i.value;a instanceof us&&t.push(a)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const s=this.arrangementOrigin;let n=s.x,o=s.y;for(let a=0;a<t.length;a++){const l=t[a];switch(this.SL(l,n+l.at.x,o+l.at.y),this.He){case 50:o+=l.dt.height+this.Us.height;break;default:case 51:n+=l.dt.width+this.Us.width;break}}}}SL(t,i,s){if(t===null)return;t.x=i,t.y=s;const n=t.children,o=n.length;for(let a=0;a<o;a++){const l=n[a];this.SL(l,i+l.U.x,s+l.U.y)}}commitLayout(){this.Pw(),this.commitNodes(),this.pL(),this.isRouting&&this.commitLinks()}commitNodes(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const i=t.value;this.layoutComments(i)}}pL(){if(this.network===null||this.layerStyle!==62)return;const t=this.yL,i=[];let s;const n=this.network.vertexes.iterator;for(;n.next();){const d=n.value;s===void 0?s=d.bounds.copy():s.unionRect(d.bounds);let f=i[d.level];f===void 0?f=this.computeLayerSpacing(d):f=Math.max(f,this.computeLayerSpacing(d)),i[d.level]=f}if(!s)return;for(let d=0;d<i.length;d++)i[d]===void 0&&(i[d]=0);let o;this.angle===90||this.angle===270?(s.inflate(this.nodeSpacing/2,this.layerSpacing),o=new L(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),o=new L(-this.layerSpacing/2,-this.nodeSpacing/2));const a=[],l=this.angle===90||this.angle===270?s.width:s.height;let h=0;if(this.angle===180||this.angle===270)for(let d=0;d<t.length;d++)h+=t[d]+i[d];for(let d=0;d<t.length;d++){const f=t[d]+i[d];this.angle===270?(h-=f,a.push(new Y(0,h,l,f))):this.angle===90?(a.push(new Y(0,h,l,f)),h+=f):this.angle===180?(h-=f,a.push(new Y(h,0,f,l))):(a.push(new Y(h,0,f,l)),h+=f)}this.commitLayers(a,o)}commitLayers(t,i){}commitLinks(){if(this.network===null)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Pw(){const t=this.Ie.iterator;for(;t.next();){const i=t.value;i instanceof us&&this.UF(i)}}UF(t){if(t===null)return;this.setPortSpots(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.UF(o)}}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.kU(t,i);else{const s=this.orthoAngle(t);if(this.ws===1){const n=t.destinationEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.fromSpot=X.MiddleRight;break;case 90:o.fromSpot=X.MiddleBottom;break;case 180:o.fromSpot=X.MiddleLeft;break;default:o.fromSpot=X.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.toSpot=X.MiddleLeft;break;case 90:o.toSpot=X.MiddleTop;break;case 180:o.toSpot=X.MiddleRight;break;default:o.toSpot=X.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const n=t.sourceEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.toSpot=X.MiddleRight;break;case 90:o.toSpot=X.MiddleBottom;break;case 180:o.toSpot=X.MiddleLeft;break;default:o.toSpot=X.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.fromSpot=X.MiddleLeft;break;case 90:o.fromSpot=X.MiddleTop;break;case 180:o.fromSpot=X.MiddleRight;break;default:o.fromSpot=X.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}kU(t,i){const s=this.ws===1,n=this.orthoAngle(t);let o;switch(n){case 0:o=X.MiddleRight;break;case 90:o=X.MiddleBottom;break;case 180:o=X.MiddleLeft;break;default:o=X.MiddleTop;break}const a=t.children,l=a.length;switch(i){case 24:case 25:{for(let h=0;h<l;h++){const d=a[h],f=(s?d.sourceEdges:d.destinationEdges).first();if(f===null)continue;const m=f.link;if(m!==null){let p=n===90||n===270?X.MiddleLeft:X.MiddleTop;if(l===1||h===l-1&&l%2===1)switch(n){case 0:p=X.MiddleLeft;break;case 90:p=X.MiddleTop;break;case 180:p=X.MiddleRight;break;default:p=X.MiddleBottom;break}else h%2===0&&(p=n===90||n===270?X.MiddleRight:X.MiddleBottom);s?(t.setsPortSpot&&(m.fromSpot=o),t.setsChildPortSpot&&(m.toSpot=p)):(t.setsPortSpot&&(m.fromSpot=p),t.setsChildPortSpot&&(m.toSpot=o))}}break}case 26:{const h=n===90||n===270?X.MiddleRight:X.MiddleBottom,d=s?t.destinationEdges:t.sourceEdges;for(;d.next();){const f=d.value.link;f!==null&&(s?(t.setsPortSpot&&(f.fromSpot=o),t.setsChildPortSpot&&(f.toSpot=h)):(t.setsPortSpot&&(f.fromSpot=h),t.setsChildPortSpot&&(f.toSpot=o)))}break}case 27:{const h=n===90||n===270?X.MiddleLeft:X.MiddleTop,d=s?t.destinationEdges:t.sourceEdges;for(;d.next();){const f=d.value.link;f!==null&&(s?(t.setsPortSpot&&(f.fromSpot=o),t.setsChildPortSpot&&(f.toSpot=h)):(t.setsPortSpot&&(f.fromSpot=h),t.setsChildPortSpot&&(f.toSpot=o)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const o=Math.min(1,t.layerSpacingParentOverlap);n-=s?t.height*o:t.width*o}return n<(s?-t.height:-t.width)&&(n=s?-t.height:-t.width),n}computeNodeIndent(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.nodeIndent;if(t.nodeIndentPastParent>0){const o=Math.min(1,t.nodeIndentPastParent);n+=s?t.width*o:t.height*o}return n=Math.max(0,n),n}get roots(){return this.Ie}set roots(t){this.Ie!==t&&(this.Ie=t,this.p())}get path(){return this.Fe}set path(t){this.Fe!==t&&(this.Fe=t,this.p())}get treeStyle(){return this.wu}set treeStyle(t){this.wu!==t&&(t===40||t===42||t===41||t===43)&&(this.wu=t,this.p())}get layerStyle(){return this.$g}set layerStyle(t){this.$g!==t&&(t===60||t===61||t===62)&&(this.$g=t,this.p())}get comments(){return this.Xi}set comments(t){this.Xi!==t&&(this.Xi=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===50||t===51||t===52)&&(this.He=t,this.p())}get arrangementSpacing(){return this.Us}set arrangementSpacing(t){this.Us.equals(t)||(this.Us.h(t),this.p())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.p())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.p())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.p())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(this.V.comparer=t,this.p())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(t===0||t===90||t===180||t===270?(this.V.angle=t,this.p()):r.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.p())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&t>=0&&(this.V.nodeIndent=t,this.p())}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.p())}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(this.V.nodeSpacing=t,this.p())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(this.V.layerSpacing=t,this.p())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.p())}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(t===30||t===31)&&(this.V.compaction=t,this.p())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&t>=0&&(this.V.breadthLimit=t,this.p())}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(this.V.rowSpacing=t,this.p())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&t>=0&&(this.V.rowIndent=t,this.p())}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(this.V.commentSpacing=t,this.p())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(this.V.commentMargin=t,this.p())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(this.V.setsPortSpot=t,this.p())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.p())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(this.V.setsChildPortSpot=t,this.p())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.p())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.p())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(this.B.comparer=t,this.p())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(t===0||t===90||t===180||t===270)&&(this.B.angle=t,this.p())}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.p())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&t>=0&&(this.B.nodeIndent=t,this.p())}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.p())}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(this.B.nodeSpacing=t,this.p())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(this.B.layerSpacing=t,this.p())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.p())}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(t===30||t===31)&&(this.B.compaction=t,this.p())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&t>=0&&(this.B.breadthLimit=t,this.p())}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(this.B.rowSpacing=t,this.p())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&t>=0&&(this.B.rowIndent=t,this.p())}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(this.B.commentSpacing=t,this.p())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(this.B.commentMargin=t,this.p())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(this.B.setsPortSpot=t,this.p())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.p())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(this.B.setsChildPortSpot=t,this.p())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.p())}}y(ze,"PathDefault",0),y(ze,"PathDestination",1),y(ze,"PathSource",2),y(ze,"SortingForwards",10),y(ze,"SortingReverse",11),y(ze,"SortingAscending",12),y(ze,"SortingDescending",13),y(ze,"AlignmentCenterSubtrees",20),y(ze,"AlignmentCenterChildren",21),y(ze,"AlignmentStart",22),y(ze,"AlignmentEnd",23),y(ze,"AlignmentBus",24),y(ze,"AlignmentBusBranching",25),y(ze,"AlignmentTopLeftBus",26),y(ze,"AlignmentBottomRightBus",27),y(ze,"CompactionNone",30),y(ze,"CompactionBlock",31),y(ze,"StyleLayered",40),y(ze,"StyleLastParents",41),y(ze,"StyleAlternating",42),y(ze,"StyleRootOnly",43),y(ze,"ArrangementVertical",50),y(ze,"ArrangementHorizontal",51),y(ze,"ArrangementFixedRoots",52),y(ze,"LayerIndividual",60),y(ze,"LayerSiblings",61),y(ze,"LayerUniform",62);class Ah extends vn{constructor(e){super(e)}createVertex(){return new us(this)}createEdge(){return new ld(this)}}class us extends kn{constructor(t){super(t);y(this,"U");y(this,"dt");y(this,"at");y(this,"mP");y(this,"pP");y(this,"yP");y(this,"wP");y(this,"xP");y(this,"bP");y(this,"kP");y(this,"Xi");y(this,"Zg");y(this,"Qg");y(this,"Si");y(this,"Mi");y(this,"Xt");y(this,"de");y(this,"Fw");y(this,"Rw");y(this,"Ow");y(this,"Vs");y(this,"Iw");y(this,"Ew");y(this,"Uw");y(this,"Vw");y(this,"Bw");y(this,"zw");y(this,"Xw");y(this,"Gw");y(this,"Yw");y(this,"Kw");y(this,"Hw");this.mP=!1,this.pP=null,this.yP=[],this.wP=0,this.xP=0,this.bP=0,this.kP=0,this.Xi=null,this.U=new L(0,0),this.dt=new _(0,0),this.at=new L(0,0),this.Zg=null,this.Qg=null,this.Si=10,this.Mi=kn.standardComparer,this.Xt=0,this.de=21,this.Fw=0,this.Rw=0,this.Ow=20,this.Vs=50,this.Iw=0,this.Ew=31,this.Uw=0,this.Vw=25,this.Bw=10,this.zw=10,this.Xw=20,this.Gw=!0,this.Yw=X.Default,this.Kw=!0,this.Hw=X.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.Si=t.sorting,this.Mi=t.comparer,this.Xt=t.angle,this.de=t.alignment,this.Fw=t.nodeIndent,this.Rw=t.nodeIndentPastParent,this.Ow=t.nodeSpacing,this.Vs=t.layerSpacing,this.Iw=t.layerSpacingParentOverlap,this.Ew=t.compaction,this.Uw=t.breadthLimit,this.Vw=t.rowSpacing,this.Bw=t.rowIndent,this.zw=t.commentSpacing,this.Xw=t.commentMargin,this.Gw=t.setsPortSpot,this.Yw=t.portSpot,this.Kw=t.setsChildPortSpot,this.Hw=t.childPortSpot)}get initialized(){return this.mP}set initialized(t){this.mP!==t&&(this.mP=t)}get parent(){return this.pP}set parent(t){this.pP!==t&&(this.pP=t)}get children(){return this.yP}set children(t){if(this.yP!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.yP=t}}get level(){return this.wP}set level(t){this.wP!==t&&(this.wP=t)}get descendantCount(){return this.xP}set descendantCount(t){this.xP!==t&&(this.xP=t)}get maxChildrenCount(){return this.bP}set maxChildrenCount(t){this.bP!==t&&(this.bP=t)}get maxGenerationCount(){return this.kP}set maxGenerationCount(t){this.kP!==t&&(this.kP=t)}get comments(){return this.Xi}set comments(t){if(this.Xi!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Xi=t}}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t)}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(this.Mi=t)}get angle(){return this.Xt}set angle(t){this.Xt!==t&&(this.Xt=t)}get alignment(){return this.de}set alignment(t){this.de!==t&&(this.de=t)}get nodeIndent(){return this.Fw}set nodeIndent(t){this.Fw!==t&&(this.Fw=t)}get nodeIndentPastParent(){return this.Rw}set nodeIndentPastParent(t){this.Rw!==t&&(this.Rw=t)}get nodeSpacing(){return this.Ow}set nodeSpacing(t){this.Ow!==t&&(this.Ow=t)}get layerSpacing(){return this.Vs}set layerSpacing(t){this.Vs!==t&&(this.Vs=t)}get layerSpacingParentOverlap(){return this.Iw}set layerSpacingParentOverlap(t){this.Iw!==t&&(this.Iw=t)}get compaction(){return this.Ew}set compaction(t){this.Ew!==t&&(this.Ew=t)}get breadthLimit(){return this.Uw}set breadthLimit(t){this.Uw!==t&&(this.Uw=t)}get rowSpacing(){return this.Vw}set rowSpacing(t){this.Vw!==t&&(this.Vw=t)}get rowIndent(){return this.Bw}set rowIndent(t){this.Bw!==t&&(this.Bw=t)}get commentSpacing(){return this.zw}set commentSpacing(t){this.zw!==t&&(this.zw=t)}get commentMargin(){return this.Xw}set commentMargin(t){this.Xw!==t&&(this.Xw=t)}get setsPortSpot(){return this.Gw}set setsPortSpot(t){this.Gw!==t&&(this.Gw=t)}get portSpot(){return this.Yw}set portSpot(t){this.Yw.equals(t)||(this.Yw=t)}get setsChildPortSpot(){return this.Kw}set setsChildPortSpot(t){this.Kw!==t&&(this.Kw=t)}get childPortSpot(){return this.Hw}set childPortSpot(t){this.Hw.equals(t)||(this.Hw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.U}set relativePosition(t){this.U.set(t)}get subtreeSize(){return this.dt}set subtreeSize(t){this.dt.set(t)}get subtreeOffset(){return this.at}set subtreeOffset(t){this.at.set(t)}}class ld extends ko{constructor(t){super(t);y(this,"PP");this.PP=new L(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const i=this.network.layout;let s=null,n=null;switch(i.ws){case 1:s=this.fromVertex,n=this.toVertex;break;case 2:s=this.toVertex,n=this.fromVertex;break;default:r.o("Unhandled path value "+i.ws.toString())}if(s===null||n===null)return;const o=this.PP;if(o.x===0&&o.y===0){this.PU(s,n);return}const a=s.bounds,l=i.orthoAngle(s),h=i.computeLayerSpacing(s),d=s.rowSpacing;t.updateRoute();const f=t.curve===9,m=t.isOrthogonal;let p=0,b,x;if(t.startRoute(),m||f){for(p=2;t.pointsCount>4;)t.removePoint(2);b=t.getPoint(1),x=t.getPoint(2)}else{for(p=1;t.pointsCount>3;)t.removePoint(1);b=t.getPoint(0),x=t.getPoint(t.pointsCount-1)}const v=t.getPoint(t.pointsCount-1);let S=0;l===0?(s.alignment===23?(S=a.bottom+o.y,o.y===0&&b.y>v.y+s.rowIndent&&(S=Math.min(S,Math.max(b.y,S-i.computeNodeIndent(s))))):s.alignment===22?(S=a.top+o.y,o.y===0&&b.y<v.y-s.rowIndent&&(S=Math.max(S,Math.min(b.y,S+i.computeNodeIndent(s))))):S=a.y+a.height/2+o.y,f?(t.insertPointAt(p,b.x,S),p++,t.insertPointAt(p,a.right+h,S),p++,t.insertPointAt(p,a.right+h+(o.x-d)/3,S),p++,t.insertPointAt(p,a.right+h+(o.x-d)*2/3,S),p++,t.insertPointAt(p,a.right+h+(o.x-d),S),p++,t.insertPointAt(p,x.x,S),p++):(m&&(t.insertPointAt(p,a.right+h/2,b.y),p++),t.insertPointAt(p,a.right+h/2,S),p++,t.insertPointAt(p,a.right+h+o.x-(m?d/2:d),S),p++,m&&(t.insertPointAt(p,t.getPoint(p-1).x,x.y),p++))):l===90?(s.alignment===23?(S=a.right+o.x,o.x===0&&b.x>v.x+s.rowIndent&&(S=Math.min(S,Math.max(b.x,S-i.computeNodeIndent(s))))):s.alignment===22?(S=a.left+o.x,o.x===0&&b.x<v.x-s.rowIndent&&(S=Math.max(S,Math.min(b.x,S+i.computeNodeIndent(s))))):S=a.x+a.width/2+o.x,f?(t.insertPointAt(p,S,b.y),p++,t.insertPointAt(p,S,a.bottom+h),p++,t.insertPointAt(p,S,a.bottom+h+(o.y-d)/3),p++,t.insertPointAt(p,S,a.bottom+h+(o.y-d)*2/3),p++,t.insertPointAt(p,S,a.bottom+h+(o.y-d)),p++,t.insertPointAt(p,S,x.y),p++):(m&&(t.insertPointAt(p,b.x,a.bottom+h/2),p++),t.insertPointAt(p,S,a.bottom+h/2),p++,t.insertPointAt(p,S,a.bottom+h+o.y-(m?d/2:d)),p++,m&&(t.insertPointAt(p,x.x,t.getPoint(p-1).y),p++))):l===180?(s.alignment===23?(S=a.bottom+o.y,o.y===0&&b.y>v.y+s.rowIndent&&(S=Math.min(S,Math.max(b.y,S-i.computeNodeIndent(s))))):s.alignment===22?(S=a.top+o.y,o.y===0&&b.y<v.y-s.rowIndent&&(S=Math.max(S,Math.min(b.y,S+i.computeNodeIndent(s))))):S=a.y+a.height/2+o.y,f?(t.insertPointAt(p,b.x,S),p++,t.insertPointAt(p,a.left-h,S),p++,t.insertPointAt(p,a.left-h+(o.x+d)/3,S),p++,t.insertPointAt(p,a.left-h+(o.x+d)*2/3,S),p++,t.insertPointAt(p,a.left-h+(o.x+d),S),p++,t.insertPointAt(p,x.x,S),p++):(m&&(t.insertPointAt(p,a.left-h/2,b.y),p++),t.insertPointAt(p,a.left-h/2,S),p++,t.insertPointAt(p,a.left-h+o.x+(m?d/2:d),S),p++,m&&(t.insertPointAt(p,t.getPoint(p-1).x,x.y),p++))):l===270?(s.alignment===23?(S=a.right+o.x,o.x===0&&b.x>v.x+s.rowIndent&&(S=Math.min(S,Math.max(b.x,S-i.computeNodeIndent(s))))):s.alignment===22?(S=a.left+o.x,o.x===0&&b.x<v.x-s.rowIndent&&(S=Math.max(S,Math.min(b.x,S+i.computeNodeIndent(s))))):S=a.x+a.width/2+o.x,f?(t.insertPointAt(p,S,b.y),p++,t.insertPointAt(p,S,a.top-h),p++,t.insertPointAt(p,S,a.top-h+(o.y+d)/3),p++,t.insertPointAt(p,S,a.top-h+(o.y+d)*2/3),p++,t.insertPointAt(p,S,a.top-h+(o.y+d)),p++,t.insertPointAt(p,S,x.y),p++):(m&&(t.insertPointAt(p,b.x,a.top-h/2),p++),t.insertPointAt(p,S,a.top-h/2),p++,t.insertPointAt(p,S,a.top-h+o.y+(m?d/2:d)),p++,m&&(t.insertPointAt(p,x.x,t.getPoint(p-1).y),p++))):r.o("Invalid angle "+l),t.commitRoute()}PU(t,i){const s=this.link;if(s===null)return;const n=this.network.layout,o=n.orthoAngle(t),a=n.orthoAngle(i);if(o===a)return;const l=n.computeLayerSpacing(t),h=t.bounds,d=i.bounds;if(o===0&&d.left-h.right<l+1||o===90&&d.top-h.bottom<l+1||o===180&&h.left-d.right<l+1||o===270&&h.top-d.bottom<l+1)return;s.updateRoute();const f=s.curve===9,m=s.isOrthogonal,p=this.fromVertex,b=n.isBusAlignment(p.alignment);if(s.startRoute(),o===0){const x=h.right+l/2;if(f){if(s.pointsCount===4){const v=s.getPoint(3).y;s.setPointAt(1,x-20,s.getPoint(1).y),s.insertPointAt(2,x-20,v),s.insertPointAt(3,x,v),s.insertPointAt(4,x+20,v),s.setPointAt(5,s.getPoint(5).x,v)}}else m?b?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,x,s.getPoint(2).y),s.setPointAt(3,x,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,x,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,x,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,x,s.getPoint(1).y)}else if(o===90){const x=h.bottom+l/2;if(f){if(s.pointsCount===4){const v=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,x-20),s.insertPointAt(2,v,x-20),s.insertPointAt(3,v,x),s.insertPointAt(4,v,x+20),s.setPointAt(5,v,s.getPoint(5).y)}}else m?b?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,x),s.setPointAt(3,s.getPoint(3).x,x)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,x):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,x):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,x)}else if(o===180){const x=h.left-l/2;if(f){if(s.pointsCount===4){const v=s.getPoint(3).y;s.setPointAt(1,x+20,s.getPoint(1).y),s.insertPointAt(2,x+20,v),s.insertPointAt(3,x,v),s.insertPointAt(4,x-20,v),s.setPointAt(5,s.getPoint(5).x,v)}}else m?b?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,x,s.getPoint(2).y),s.setPointAt(3,x,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,x,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,x,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,x,s.getPoint(1).y)}else if(o===270){const x=h.top-l/2;if(f){if(s.pointsCount===4){const v=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,x+20),s.insertPointAt(2,v,x+20),s.insertPointAt(3,v,x),s.insertPointAt(4,v,x-20),s.setPointAt(5,v,s.getPoint(5).y)}}else m?b?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,x),s.setPointAt(3,s.getPoint(3).x,x)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,x):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,x):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,x)}s.commitRoute()}get fromVertex(){return this.ss}set fromVertex(t){this.ss!==t&&(this.ss=t)}get toVertex(){return this.ns}set toVertex(t){this.ns!==t&&(this.ns=t)}get relativePoint(){return this.PP}set relativePoint(t){this.PP.set(t)}}class Qi{constructor(){}}y(Qi,"Light",{colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new ct(5)},arrowheads:{toArrow:"Standard"}}),y(Qi,"Dark",{colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new ct(5)},arrowheads:{toArrow:"Standard"}});const No=class No{constructor(e){y(this,"hs",new Set);y(this,"bu",new nt);y(this,"SP","light");y(this,"MP","light");y(this,"NP",!1);y(this,"ML",!0);y(this,"_g","light");y(this,"VF",e=>{const t=e.matches?"dark":"light";t!==this._g&&(this._g=t,this.MP==="system"&&this.updateDiagrams())});e&&Object.assign(this,e),e!=null&&e.themeMap||(this.bu.set("light",{colors:{...Qi.Light.colors},fonts:{...Qi.Light.fonts},numbers:{...Qi.Light.numbers},margins:{...Qi.Light.margins},arrowheads:{...Qi.Light.arrowheads}}),this.bu.set("dark",{colors:{...Qi.Dark.colors},fonts:{...Qi.Dark.fonts},numbers:{...Qi.Dark.numbers},margins:{...Qi.Dark.margins},arrowheads:{...Qi.Dark.arrowheads}})),c.matchMedia&&(this._g=c.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.bu}set themeMap(e){this.bu!==e&&(this.bu=e,this.updateDiagrams())}get defaultTheme(){return this.SP}set defaultTheme(e){this.SP!==e&&(r.s(e,"string",No,"defaultTheme"),this.SP=e,this.updateDiagrams())}get currentTheme(){return this.MP}set currentTheme(e){this.MP!==e&&(r.s(e,"string",No,"currentTheme"),this.MP=e,this.updateDiagrams())}get changesDivBackground(){return this.NP}set changesDivBackground(e){if(this.NP!==e&&(this.NP=e,e))for(const t of this.hs)t.setDivBackground(this.findValue("div","","fill")),t.T("ThemeChanged",this)}get readsCssVariables(){return this.ML}set readsCssVariables(e){this.ML!==e&&(this.ML=e,this.updateDiagrams())}get preferredColorScheme(){return this._g}addDiagram(e){return this.hs.add(e),this.NL(e),this}removeDiagram(e){return this.hs.delete(e),this.NL(e),this}tO(){var e;this.hs.size===0&&c.matchMedia&&((e=c.matchMedia("(prefers-color-scheme: dark)"))==null||e.addEventListener("change",this.VF))}eO(){var e;this.hs.size===0&&c.matchMedia&&((e=c.matchMedia("(prefers-color-scheme: dark)"))==null||e.removeEventListener("change",this.VF))}set(e,t){e===""&&(e=this.SP),e==="system"&&(e=this._g);let i=this.bu.get(e);return i?i=this.BF(i,t):i=t,this.bu.set(e,i),this.updateDiagrams(),this}findValue(e,t,i){return this.getValue(this.findTheme(this.currentTheme),e,t,i)||this.getValue(this.findTheme(this.defaultTheme),e,t,i)}getValue(e,t,i,s){var l;if(!e)return;i==null&&(i="");let n=e;const o=h=>{if(n===void 0||h==="")return;if(typeof h=="number"||!(Array.isArray(h)||h.includes(".")))return n[h];const d=Array.isArray(h)?h:h.split(".");for(let f=0;f<d.length;f++){const m=d[f];if(m!==""&&(n=n[m],n===void 0))return}return n},a=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof t=="number"?n=n[t%n.length]:n=o(t),n};if(n=a(),n===void 0&&typeof s=="string"&&s.length>0){let h=(l=e.targetPropertyMap)==null?void 0:l.get(s);if(h?n=e[h]:(h=No.SU.get(s),n=h?e[h]:e.colors),n=a(),n!==void 0)return n}return n}findTheme(e){return this.themeMap.get(e==="system"?this._g:e)}updateDiagrams(){for(const e of this.hs)this.NL(e)}NL(e){const t=e.skipsUndoManager;e.skipsUndoManager=!0,e.updateAllThemeBindings(),this.NP&&e.setDivBackground(this.findValue("div","","fill")),e.skipsUndoManager=t,e.T("ThemeChanged",this)}BF(e,t){var i;for(const s in t)if(r.jw(t,s))try{((i=t[s])==null?void 0:i.constructor)===Object?e[s]=this.BF(e[s]??{},t[s]):e[s]=t[s]}catch{delete e[s]}return e}};y(No,"SU",new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]]));let yr=No;class hd{constructor(){y(this,"Pt");y(this,"a");y(this,"Be");y(this,"Pl");this.a=qt.Om(),this.Pt="",this.Be=!0,this.Pl=!0}get name(){return this.Pt}set name(e){this.Pt=e}get isEnabled(){return this.Be}set isEnabled(e){this.Be=e}get isRealtime(){return this.Pl}set isRealtime(e){this.Pl=e}get diagram(){return this.a}set diagram(e){this.a!==e&&(this.a=e,e.Fl=!0,e.requestUpdate())}invalidateRouter(){this.a!==null&&(this.a.Fl=!0,this.a.requestUpdate())}canRoute(e){if(!this.isEnabled)return!1;const t=this.diagram;return!(t&&(!this.isRealtime&&t.Iu||t.animationManager.isTicking))}isRoutable(e,t){return!0}routeLinks(e,t){}toString(){return this.name!==""?this.name+" Router":r.Hn(this.constructor)}}class qp extends hd{constructor(e){super(),this.name="AvoidsNodes",e&&Object.assign(this,e)}canRoute(e){var t;return(e instanceof qt?e.lp:(t=e.diagram)!=null&&t.lp)?super.canRoute(e):!1}isRoutable(e,t){return!(!e.isAvoiding||e.containingGroup!==(t instanceof Ft?t:null)||e.toNode===null||e.fromNode===null||e.pointsCount<4)}routeLinks(e,t){const i=t instanceof qt?null:t,s=e.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const o=s.value;if(!this.isRoutable(o,t))continue;o.startRoute();const a=o.pointsCount,l=o.getPoint(1),h=o.getPoint(a-2),d=o.fromNode.actualBounds.copy();d.inflate(Nt.Fa,Nt.Fa),d.unionPoint(o.getPoint(0));const f=o.toNode.actualBounds.copy();f.inflate(Nt.Fa,Nt.Fa),f.unionPoint(o.getPoint(a-1)),this.MU(o,d,f,n)&&this.NU(o,l,o.PC,h,o.SC,d,f,n),o.commitRoute()}}MU(e,t,i,s){const n=e.diagram,o=e.pointsCount;if(n===null||!e.fromNode||!e.toNode||e.fromNode===e.toNode||!e.layer||e.layer.isTemporary||t.containsPoint(e.getPoint(o-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(e.segmentIndex===17)return!0;const a=e.getPoint(1),l=e.getPoint(o-2),h=e.getPoint(2);if(!s.isUnoccupied(Math.min(a.x,h.x),Math.min(a.y,h.y),Math.abs(a.x-h.x),Math.abs(a.y-h.y)))return!0;for(let f=2;f<o-3;f++){const m=e.getPoint(f),p=e.getPoint(f+1);if(!s.isUnoccupied(Math.min(m.x,p.x),Math.min(m.y,p.y),Math.abs(m.x-p.x),Math.abs(m.y-p.y)))return!0}const d=e.getPoint(o-3);return!s.isUnoccupied(Math.min(d.x,l.x),Math.min(d.y,l.y),Math.abs(d.x-l.x),Math.abs(d.y-l.y))}NU(e,t,i,s,n,o,a,l){const h=e.diagram;if(h===null)return;const d=t,f=s;let m=L.mn,p=L.mn;if(h.isVirtualized){const v=l.bounds.copy(),S=e.getPoint(2),P=e.getPoint(e.pointsCount-3);v.inflate(-l.cellWidth,-l.cellHeight);const T=L.l();l.ng(t.x,t.y)||(B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,t.x,t.y,S.x,S.y,T)?(m=t=T.copy(),i=T.directionPoint(S)):B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,S.x,S.y,P.x,P.y,T)?(m=t=T.copy(),i=T.directionPoint(P)):B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,P.x,P.y,s.x,s.y,T)&&(m=t=T.copy(),i=T.directionPoint(s))),l.ng(s.x,s.y)||(B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,s.x,s.y,P.x,P.y,T)?(p=s=T.copy(),n=P.directionPoint(T)):B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,P.x,P.y,S.x,S.y,T)?(p=s=T.copy(),n=S.directionPoint(T)):B.Cl(v.x,v.y,v.x+v.width,v.y+v.height,S.x,S.y,t.x,t.y,T)&&(p=s=T.copy(),n=t.directionPoint(T))),L.i(T)}const b=o.copy().unionRect(a);b.inflate(l.cellWidth*l.hf,l.cellHeight*l.hf),l.yv(t,i,s,n,b,!0);let x=l.bo(s.x,s.y);if(!l.tw&&x>=Zs.sg&&(l.TT(),b.inflate(l.cellWidth*l.E2,l.cellHeight*l.U2),l.yv(t,i,s,n,b,!1),x=l.bo(s.x,s.y)),!l.tw&&x<Zs.sg&&!l.GE(s.x,s.y)){e.points.removeRange(2,e.pointsCount-3),this.CL(e,l,s.x,s.y,n,!0);const v=0,S=90,P=180,T=270,A=e.getPoint(2);if(e.pointsCount<4)i===v||i===P?(A.x=t.x,A.y=s.y):(A.x=s.x,A.y=t.y),e.setPointAt(2,A.x,A.y),e.insertPointAt(3,A.x,A.y);else{const C=e.getPoint(3);if(i===v||i===P)if(B.u(A.x,C.x)){const O=i===v?Math.max(A.x,t.x):Math.min(A.x,t.x);e.setPointAt(2,O,t.y),e.setPointAt(3,O,C.y)}else B.u(A.y,C.y)?(Math.abs(t.y-A.y)<=l.cellHeight/2&&(e.setPointAt(2,A.x,t.y),e.setPointAt(3,C.x,t.y)),e.insertPointAt(2,A.x,t.y)):e.setPointAt(2,t.x,A.y);else if(i===S||i===T)if(B.u(A.y,C.y)){const O=i===S?Math.max(A.y,t.y):Math.min(A.y,t.y);e.setPointAt(2,t.x,O),e.setPointAt(3,C.x,O)}else B.u(A.x,C.x)?(Math.abs(t.x-A.x)<=l.cellWidth/2&&(e.setPointAt(2,t.x,A.y),e.setPointAt(3,t.x,C.y)),e.insertPointAt(2,t.x,A.y)):e.setPointAt(2,A.x,t.y)}if(m.isReal()){const C=e.getPoint(1),O=e.getPoint(2);C.x!==O.x&&C.y!==O.y?i===v||i===P?e.insertPointAt(2,C.x,O.y):e.insertPointAt(2,O.x,C.y):i===v||i===P?e.insertPointAt(2,d.x,m.y):e.insertPointAt(2,m.x,d.y)}p.isReal()&&(n===v||n===P?e.insertPointAt(e.pointsCount-2,f.x,p.y):e.insertPointAt(e.pointsCount-2,p.x,f.y))}}CL(e,t,i,s,n,o){const a=t.cellWidth,l=t.cellHeight;let h=t.bo(i,s),d=i,f=s,m=d,p=f;for(n===0?m+=a:n===90?p+=l:n===180?m-=a:p-=l,e.TC&&h>Zs.nc&&t.bo(m,p)!==h-1&&(t.bo(d-a,f)===h-1?(n=180,m=d-a,p=f):t.bo(d+a,f)===h-1?(n=0,m=d+a,p=f):t.bo(d,f-l)===h-1?(n=270,m=d,p=f-l):t.bo(d,f+l)===h-1&&(n=90,m=d,p=f+l));h>Zs.nc&&t.bo(m,p)===h-1;)d=m,f=p,n===0?m+=a:n===90?p+=l:n===180?m-=a:p-=l,h-=1;if(o?h>Zs.nc&&(n===180||n===0?d=Math.floor(d/a)*a+a/2:(n===90||n===270)&&(f=Math.floor(f/l)*l+l/2)):(d=Math.floor(d/a)*a+a/2,f=Math.floor(f/l)*l+l/2),h>Zs.nc){let b=n,x=d,v=f;if(n===0?(b=90,v+=l):n===90?(b=180,x-=a):n===180?(b=270,v-=l):n===270&&(b=0,x+=a),t.bo(x,v)===h-1)this.CL(e,t,x,v,b,!1);else{let S=d,P=f;n===0?(b=270,P-=l):n===90?(b=0,S+=a):n===180?(b=90,P+=l):n===270&&(b=180,S-=a),t.bo(S,P)===h-1&&this.CL(e,t,S,P,b,!1)}}e.insertPointAt(e.pointsCount-2,d,f)}}ge.prototype.initializeStandardTools=function(){return this.Jt("Action",new Pi,this.mouseDownTools),this.Jt("Relinking",new ye,this.mouseDownTools),this.Jt("LinkReshaping",new ve,this.mouseDownTools),this.Jt("Rotating",new Ve,this.mouseDownTools),this.Jt("Resizing",new De,this.mouseDownTools),this.Jt("Linking",new Re,this.mouseMoveTools),this.Jt("Dragging",new ae,this.mouseMoveTools),this.Jt("DragSelecting",new Fu,this.mouseMoveTools),this.Jt("Panning",new Ou,this.mouseMoveTools),this.Jt("ContextMenu",new yn,this.mouseUpTools),this.Jt("TextEditing",new ha,this.mouseUpTools),this.Jt("ClickCreating",new Ci,this.mouseUpTools),this.Jt("ClickSelecting",new Ie,this.mouseUpTools),this},qt.g2("GraphLinksModel",Gp),qt.g2("TreeModel",$p);const pa=c.go,wr={get version(){return qt.version},Group:Ft,List:E,Set:F,Map:nt,Point:L,Size:_,Rect:Y,Margin:ct,Spot:X,Geometry:It,PathFigure:Z,PathSegment:et,InputEvent:Dt,DiagramEvent:Rt,ChangedEvent:Et,Model:Ne,GraphLinksModel:Po,TreeModel:Mo,Binding:Qs,ThemeBinding:So,Transaction:Bt,UndoManager:Gt,CommandHandler:ua,Tool:Zt,DraggingTool:ae,DraggingInfo:jn,DraggingOptions:ca,LinkingBaseTool:Ce,LinkingTool:Re,RelinkingTool:ye,LinkReshapingTool:ve,ResizingTool:De,RotatingTool:Ve,ClickSelectingTool:Ie,ActionTool:Pi,ClickCreatingTool:Ci,HTMLInfo:pn,ContextMenuTool:yn,DragSelectingTool:Fu,PanningTool:Ou,TextEditingTool:ha,ToolManager:ge,Animation:wo,AnimationManager:Rs,AnimationTrigger:ur,Layer:Oi,Diagram:qt,Palette:Ap,Overview:dr,Brush:me,GraphObject:Ht,Panel:Lt,RowColumnDefinition:ai,Shape:Xt,TextBlock:Se,Picture:cs,Part:_t,Adornment:Jt,Node:wt,Link:Nt,Placeholder:Ui,Layout:bi,LayoutNetwork:vn,LayoutVertex:kn,LayoutEdge:ko,GridLayout:ga,PanelLayout:le,CircularLayout:Ai,CircularNetwork:Ju,CircularVertex:Zu,CircularEdge:Qu,ForceDirectedLayout:Hp,ForceDirectedNetwork:_u,ForceDirectedVertex:td,ForceDirectedEdge:ed,LayeredDigraphLayout:Je,LayeredDigraphNetwork:od,LayeredDigraphVertex:pr,LayeredDigraphEdge:rd,TreeLayout:ze,TreeNetwork:Ah,TreeVertex:us,TreeEdge:ld,Themes:Qi,ThemeManager:yr,Router:hd,AnimationStyle:Vu,AutoScale:Wl,CycleMode:ju,Flip:Yu,TextFormat:ih,ImageStretch:nh,LayoutConditions:Hu,LinkAdjusting:ah,Curve:hh,Routing:lh,Orientation:Zl,TextOverflow:$u,PortSpreading:qu,ScrollMode:Uu,CollapsePolicy:Xu,Sizing:_l,TriggerStart:zu,Stretch:Jl,ViewboxStretch:Gu,Wrap:eh,BrushType:bn,ColorSpace:Ku,GeometryStretch:Yt,GeometryType:se,SegmentType:Pt,BindingMode:ma,ChangeType:bt,CircularArrangement:gh,CircularDirection:mh,CircularNodeDiameterFormula:yh,CircularSorting:ph,GridAlignment:uh,GridArrangement:dh,GridSorting:fh,LayeredDigraphAggressive:vh,LayeredDigraphAlign:nd,LayeredDigraphCycleRemove:wh,LayeredDigraphInit:xh,LayeredDigraphLayering:bh,LayeredDigraphPack:sd,TreeAlignment:Ph,TreeArrangement:Nh,TreeCompaction:Mh,TreeLayerStyle:ad,TreePath:kh,TreeSorting:Sh,TreeStyle:Ch,GestureMode:ie,LinkingDirection:Be,ReshapingBehavior:Ee,TextEditingAccept:Ru,TextEditingStarting:Iu,TextEditingState:Bu,WheelMode:he};for(const M in wr){const e=wr[M];r.st(e)&&e!==ih&&(e.className=M)}r.$(pa)&&pa.version&&r.ne("WARNING: a `go` object on the root object is already defined.  "+("Debug"in pa?"debug ":"")+"version: "+pa.version+", replaced with version: "+wr.version),qt.prototype.go=wr,c.go=wr})();const pe=typeof global<"u"?global.go:self.go,dt=typeof global<"u"?global.go:self.go;dt.Group;dt.List;dt.Set;dt.Map;dt.Point;dt.Size;dt.Rect;dt.Margin;dt.Spot;dt.Geometry;dt.PathFigure;dt.PathSegment;dt.InputEvent;dt.DiagramEvent;dt.ChangedEvent;dt.Model;dt.GraphLinksModel;dt.TreeModel;dt.Binding;dt.ThemeBinding;dt.Transaction;dt.UndoManager;dt.CommandHandler;dt.Tool;dt.DraggingTool;dt.DraggingInfo;dt.DraggingOptions;dt.LinkingBaseTool;dt.LinkingTool;dt.RelinkingTool;dt.LinkReshapingTool;dt.ResizingTool;dt.RotatingTool;dt.ClickSelectingTool;dt.ActionTool;dt.ClickCreatingTool;dt.HTMLInfo;dt.ContextMenuTool;dt.DragSelectingTool;dt.PanningTool;dt.TextEditingTool;dt.ToolManager;dt.Animation;dt.AnimationManager;dt.AnimationTrigger;dt.Layer;dt.Diagram;dt.Palette;dt.Overview;dt.Brush;dt.GraphObject;dt.Panel;dt.RowColumnDefinition;dt.Shape;dt.TextBlock;dt.Picture;dt.Part;dt.Adornment;dt.Node;dt.Link;dt.Placeholder;dt.Layout;dt.LayoutNetwork;dt.LayoutVertex;dt.LayoutEdge;dt.GridLayout;dt.PanelLayout;dt.CircularLayout;dt.CircularNetwork;dt.CircularVertex;dt.CircularEdge;dt.ForceDirectedLayout;dt.ForceDirectedNetwork;dt.ForceDirectedVertex;dt.ForceDirectedEdge;dt.LayeredDigraphLayout;dt.LayeredDigraphNetwork;dt.LayeredDigraphVertex;dt.LayeredDigraphEdge;dt.TreeLayout;dt.TreeNetwork;dt.TreeVertex;dt.TreeEdge;dt.Themes;dt.ThemeManager;dt.Router;dt.version;dt.AnimationStyle;dt.AutoScale;dt.Curve;dt.CycleMode;dt.Flip;dt.ImageStretch;dt.LayoutConditions;dt.LinkAdjusting;dt.Orientation;dt.PortSpreading;dt.Routing;dt.ScrollMode;dt.CollapsePolicy;dt.Sizing;dt.TriggerStart;dt.Stretch;dt.TextFormat;dt.TextOverflow;dt.ViewboxStretch;dt.Wrap;dt.BrushType;dt.ColorSpace;dt.GeometryStretch;dt.GeometryType;dt.SegmentType;dt.BindingMode;dt.ChangeType;dt.CircularArrangement;dt.CircularDirection;dt.CircularNodeDiameterFormula;dt.CircularSorting;dt.GridAlignment;dt.GridArrangement;dt.GridSorting;dt.LayeredDigraphAggressive;dt.LayeredDigraphAlign;dt.LayeredDigraphCycleRemove;dt.LayeredDigraphInit;dt.LayeredDigraphLayering;dt.LayeredDigraphPack;dt.TreeAlignment;dt.TreeArrangement;dt.TreeCompaction;dt.TreeLayerStyle;dt.TreePath;dt.TreeSorting;dt.TreeStyle;dt.GestureMode;dt.LinkingDirection;dt.ReshapingBehavior;dt.TextEditingAccept;dt.TextEditingStarting;dt.TextEditingState;dt.WheelMode;/*!
* sweetalert2 v11.26.17
* Released under the MIT License.
*/function kf(c,r,u){if(typeof c=="function"?c===r:c.has(r))return arguments.length<3?r:u;throw new TypeError("Private element is not present on this object")}function Zp(c,r){if(r.has(c))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ud(c,r){return c.get(kf(c,r))}function Qp(c,r,u){Zp(c,r),r.set(c,u)}function _p(c,r,u){return c.set(kf(c,r),u),u}const t0=100,ee={},e0=()=>{ee.previousActiveElement instanceof HTMLElement?(ee.previousActiveElement.focus(),ee.previousActiveElement=null):document.body&&document.body.focus()},i0=c=>new Promise(r=>{if(!c)return r();const u=window.scrollX,g=window.scrollY;ee.restoreFocusTimeout=setTimeout(()=>{e0(),r()},t0),window.scrollTo(u,g)}),Sf="swal2-",s0=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"],gt=s0.reduce((c,r)=>(c[r]=Sf+r,c),{}),n0=["success","warning","info","question","error"],Qa=n0.reduce((c,r)=>(c[r]=Sf+r,c),{}),Pf="SweetAlert2:",Ic=c=>c.charAt(0).toUpperCase()+c.slice(1),zi=c=>{console.warn(`${Pf} ${typeof c=="object"?c.join(" "):c}`)},ho=c=>{console.error(`${Pf} ${c}`)},dd=[],o0=c=>{dd.includes(c)||(dd.push(c),zi(c))},Mf=(c,r=null)=>{o0(`"${c}" is deprecated and will be removed in the next major release.${r?` Use "${r}" instead.`:""}`)},Al=c=>typeof c=="function"?c():c,Bc=c=>c&&typeof c.toPromise=="function",Wr=c=>Bc(c)?c.toPromise():Promise.resolve(c),Vc=c=>c&&Promise.resolve(c)===c,ji=()=>document.body.querySelector(`.${gt.container}`),Jr=c=>{const r=ji();return r?r.querySelector(c):null},ls=c=>Jr(`.${c}`),Oe=()=>ls(gt.popup),ir=()=>ls(gt.icon),r0=()=>ls(gt["icon-content"]),Cf=()=>ls(gt.title),zc=()=>ls(gt["html-container"]),Nf=()=>ls(gt.image),jc=()=>ls(gt["progress-steps"]),Tl=()=>ls(gt["validation-message"]),$s=()=>Jr(`.${gt.actions} .${gt.confirm}`),sr=()=>Jr(`.${gt.actions} .${gt.cancel}`),co=()=>Jr(`.${gt.actions} .${gt.deny}`),a0=()=>ls(gt["input-label"]),nr=()=>Jr(`.${gt.loader}`),Zr=()=>ls(gt.actions),Af=()=>ls(gt.footer),Dl=()=>ls(gt["timer-progress-bar"]),Uc=()=>ls(gt.close),l0=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Xc=()=>{const c=Oe();if(!c)return[];const r=c.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),u=Array.from(r).sort((k,N)=>{const D=parseInt(k.getAttribute("tabindex")||"0"),E=parseInt(N.getAttribute("tabindex")||"0");return D>E?1:D<E?-1:0}),g=c.querySelectorAll(l0),w=Array.from(g).filter(k=>k.getAttribute("tabindex")!=="-1");return[...new Set(u.concat(w))].filter(k=>Wi(k))},Yc=()=>an(document.body,gt.shown)&&!an(document.body,gt["toast-shown"])&&!an(document.body,gt["no-backdrop"]),Ll=()=>{const c=Oe();return c?an(c,gt.toast):!1},h0=()=>{const c=Oe();return c?c.hasAttribute("data-loading"):!1},hs=(c,r)=>{if(c.textContent="",r){const g=new DOMParser().parseFromString(r,"text/html"),w=g.querySelector("head");w&&Array.from(w.childNodes).forEach(N=>{c.appendChild(N)});const k=g.querySelector("body");k&&Array.from(k.childNodes).forEach(N=>{N instanceof HTMLVideoElement||N instanceof HTMLAudioElement?c.appendChild(N.cloneNode(!0)):c.appendChild(N)})}},an=(c,r)=>{if(!r)return!1;const u=r.split(/\s+/);for(let g=0;g<u.length;g++)if(!c.classList.contains(u[g]))return!1;return!0},c0=(c,r)=>{Array.from(c.classList).forEach(u=>{!Object.values(gt).includes(u)&&!Object.values(Qa).includes(u)&&!Object.values(r.showClass||{}).includes(u)&&c.classList.remove(u)})},as=(c,r,u)=>{if(c0(c,r),!r.customClass)return;const g=r.customClass[u];if(g){if(typeof g!="string"&&!g.forEach){zi(`Invalid type of customClass.${u}! Expected string or iterable object, got "${typeof g}"`);return}Fe(c,g)}},El=(c,r)=>{if(!r)return null;switch(r){case"select":case"textarea":case"file":return c.querySelector(`.${gt.popup} > .${gt[r]}`);case"checkbox":return c.querySelector(`.${gt.popup} > .${gt.checkbox} input`);case"radio":return c.querySelector(`.${gt.popup} > .${gt.radio} input:checked`)||c.querySelector(`.${gt.popup} > .${gt.radio} input:first-child`);case"range":return c.querySelector(`.${gt.popup} > .${gt.range} input`);default:return c.querySelector(`.${gt.popup} > .${gt.input}`)}},Tf=c=>{if(c.focus(),c.type!=="file"){const r=c.value;c.value="",c.value=r}},Df=(c,r,u)=>{!c||!r||(typeof r=="string"&&(r=r.split(/\s+/).filter(Boolean)),r.forEach(g=>{Array.isArray(c)?c.forEach(w=>{u?w.classList.add(g):w.classList.remove(g)}):u?c.classList.add(g):c.classList.remove(g)}))},Fe=(c,r)=>{Df(c,r,!0)},bs=(c,r)=>{Df(c,r,!1)},On=(c,r)=>{const u=Array.from(c.children);for(let g=0;g<u.length;g++){const w=u[g];if(w instanceof HTMLElement&&an(w,r))return w}},eo=(c,r,u)=>{u===`${parseInt(`${u}`)}`&&(u=parseInt(u)),u||parseInt(`${u}`)===0?c.style.setProperty(r,typeof u=="number"?`${u}px`:u):c.style.removeProperty(r)},ki=(c,r="flex")=>{c&&(c.style.display=r)},Ei=c=>{c&&(c.style.display="none")},Kc=(c,r="block")=>{c&&new MutationObserver(()=>{Qr(c,c.innerHTML,r)}).observe(c,{childList:!0,subtree:!0})},fd=(c,r,u,g)=>{const w=c.querySelector(r);w&&w.style.setProperty(u,g)},Qr=(c,r,u="flex")=>{r?ki(c,u):Ei(c)},Wi=c=>!!(c&&(c.offsetWidth||c.offsetHeight||c.getClientRects().length)),u0=()=>!Wi($s())&&!Wi(co())&&!Wi(sr()),ic=c=>c.scrollHeight>c.clientHeight,d0=(c,r)=>{let u=c;for(;u&&u!==r;){if(ic(u))return!0;u=u.parentElement}return!1},Lf=c=>{const r=window.getComputedStyle(c),u=parseFloat(r.getPropertyValue("animation-duration")||"0"),g=parseFloat(r.getPropertyValue("transition-duration")||"0");return u>0||g>0},Gc=(c,r=!1)=>{const u=Dl();u&&Wi(u)&&(r&&(u.style.transition="none",u.style.width="100%"),setTimeout(()=>{u.style.transition=`width ${c/1e3}s linear`,u.style.width="0%"},10))},f0=()=>{const c=Dl();if(!c)return;const r=parseInt(window.getComputedStyle(c).width);c.style.removeProperty("transition"),c.style.width="100%";const u=parseInt(window.getComputedStyle(c).width),g=r/u*100;c.style.width=`${g}%`},g0=()=>typeof window>"u"||typeof document>"u",m0=`
 <div aria-labelledby="${gt.title}" aria-describedby="${gt["html-container"]}" class="${gt.popup}" tabindex="-1">
   <button type="button" class="${gt.close}"></button>
   <ul class="${gt["progress-steps"]}"></ul>
   <div class="${gt.icon}"></div>
   <img class="${gt.image}" />
   <h2 class="${gt.title}" id="${gt.title}"></h2>
   <div class="${gt["html-container"]}" id="${gt["html-container"]}"></div>
   <input class="${gt.input}" id="${gt.input}" />
   <input type="file" class="${gt.file}" />
   <div class="${gt.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${gt.select}" id="${gt.select}"></select>
   <div class="${gt.radio}"></div>
   <label class="${gt.checkbox}">
     <input type="checkbox" id="${gt.checkbox}" />
     <span class="${gt.label}"></span>
   </label>
   <textarea class="${gt.textarea}" id="${gt.textarea}"></textarea>
   <div class="${gt["validation-message"]}" id="${gt["validation-message"]}"></div>
   <div class="${gt.actions}">
     <div class="${gt.loader}"></div>
     <button type="button" class="${gt.confirm}"></button>
     <button type="button" class="${gt.deny}"></button>
     <button type="button" class="${gt.cancel}"></button>
   </div>
   <div class="${gt.footer}"></div>
   <div class="${gt["timer-progress-bar-container"]}">
     <div class="${gt["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),p0=()=>{const c=ji();return c?(c.remove(),bs([document.documentElement,document.body],[gt["no-backdrop"],gt["toast-shown"],gt["has-column"]]),!0):!1},$n=()=>{ee.currentInstance&&ee.currentInstance.resetValidationMessage()},y0=()=>{const c=Oe();if(!c)return;const r=On(c,gt.input),u=On(c,gt.file),g=c.querySelector(`.${gt.range} input`),w=c.querySelector(`.${gt.range} output`),k=On(c,gt.select),N=c.querySelector(`.${gt.checkbox} input`),D=On(c,gt.textarea);r&&(r.oninput=$n),u&&(u.onchange=$n),k&&(k.onchange=$n),N&&(N.onchange=$n),D&&(D.oninput=$n),g&&w&&(g.oninput=()=>{$n(),w.value=g.value},g.onchange=()=>{$n(),w.value=g.value})},w0=c=>{if(typeof c=="string"){const r=document.querySelector(c);if(!r)throw new Error(`Target element "${c}" not found`);return r}return c},b0=c=>{const r=Oe();r&&(r.setAttribute("role",c.toast?"alert":"dialog"),r.setAttribute("aria-live",c.toast?"polite":"assertive"),c.toast||r.setAttribute("aria-modal","true"))},x0=c=>{window.getComputedStyle(c).direction==="rtl"&&(Fe(ji(),gt.rtl),ee.isRTL=!0)},v0=c=>{const r=p0();if(g0()){ho("SweetAlert2 requires document to initialize");return}const u=document.createElement("div");u.className=gt.container,r&&Fe(u,gt["no-transition"]),hs(u,m0),u.dataset.swal2Theme=c.theme;const g=w0(c.target||"body");g.appendChild(u),c.topLayer&&(u.setAttribute("popover",""),u.showPopover()),b0(c),x0(g),y0()},$c=(c,r)=>{c instanceof HTMLElement?r.appendChild(c):typeof c=="object"?k0(c,r):c&&hs(r,c)},k0=(c,r)=>{"jquery"in c?S0(r,c):hs(r,c.toString())},S0=(c,r)=>{if(c.textContent="",0 in r)for(let u=0;u in r;u++)c.appendChild(r[u].cloneNode(!0));else c.appendChild(r.cloneNode(!0))},P0=(c,r)=>{const u=Zr(),g=nr();!u||!g||(!r.showConfirmButton&&!r.showDenyButton&&!r.showCancelButton?Ei(u):ki(u),as(u,r,"actions"),M0(u,g,r),hs(g,r.loaderHtml||""),as(g,r,"loader"))};function M0(c,r,u){const g=$s(),w=co(),k=sr();!g||!w||!k||(Eh(g,"confirm",u),Eh(w,"deny",u),Eh(k,"cancel",u),C0(g,w,k,u),u.reverseButtons&&(u.toast?(c.insertBefore(k,g),c.insertBefore(w,g)):(c.insertBefore(k,r),c.insertBefore(w,r),c.insertBefore(g,r))))}function C0(c,r,u,g){if(!g.buttonsStyling){bs([c,r,u],gt.styled);return}Fe([c,r,u],gt.styled),g.confirmButtonColor&&c.style.setProperty("--swal2-confirm-button-background-color",g.confirmButtonColor),g.denyButtonColor&&r.style.setProperty("--swal2-deny-button-background-color",g.denyButtonColor),g.cancelButtonColor&&u.style.setProperty("--swal2-cancel-button-background-color",g.cancelButtonColor),Lh(c),Lh(r),Lh(u)}function Lh(c){const r=window.getComputedStyle(c);if(r.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const u=r.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");c.style.setProperty("--swal2-action-button-focus-box-shadow",r.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${u}`))}function Eh(c,r,u){const g=Ic(r);Qr(c,u[`show${g}Button`],"inline-block"),hs(c,u[`${r}ButtonText`]||""),c.setAttribute("aria-label",u[`${r}ButtonAriaLabel`]||""),c.className=gt[r],as(c,u,`${r}Button`)}const N0=(c,r)=>{const u=Uc();u&&(hs(u,r.closeButtonHtml||""),as(u,r,"closeButton"),Qr(u,r.showCloseButton),u.setAttribute("aria-label",r.closeButtonAriaLabel||""))},A0=(c,r)=>{const u=ji();u&&(T0(u,r.backdrop),D0(u,r.position),L0(u,r.grow),as(u,r,"container"))};function T0(c,r){typeof r=="string"?c.style.background=r:r||Fe([document.documentElement,document.body],gt["no-backdrop"])}function D0(c,r){r&&(r in gt?Fe(c,gt[r]):(zi('The "position" parameter is not valid, defaulting to "center"'),Fe(c,gt.center)))}function L0(c,r){r&&Fe(c,gt[`grow-${r}`])}var Ge={innerParams:new WeakMap,domCache:new WeakMap};const E0=["input","file","range","select","radio","checkbox","textarea"],F0=(c,r)=>{const u=Oe();if(!u)return;const g=Ge.innerParams.get(c),w=!g||r.input!==g.input;E0.forEach(k=>{const N=On(u,gt[k]);N&&(I0(k,r.inputAttributes),N.className=gt[k],w&&Ei(N))}),r.input&&(w&&O0(r),B0(r))},O0=c=>{if(!c.input)return;if(!li[c.input]){ho(`Unexpected type of input! Expected ${Object.keys(li).join(" | ")}, got "${c.input}"`);return}const r=Ef(c.input);if(!r)return;const u=li[c.input](r,c);ki(r),c.inputAutoFocus&&setTimeout(()=>{Tf(u)})},R0=c=>{for(let r=0;r<c.attributes.length;r++){const u=c.attributes[r].name;["id","type","value","style"].includes(u)||c.removeAttribute(u)}},I0=(c,r)=>{const u=Oe();if(!u)return;const g=El(u,c);if(g){R0(g);for(const w in r)g.setAttribute(w,r[w])}},B0=c=>{if(!c.input)return;const r=Ef(c.input);r&&as(r,c,"input")},Hc=(c,r)=>{!c.placeholder&&r.inputPlaceholder&&(c.placeholder=r.inputPlaceholder)},_r=(c,r,u)=>{if(u.inputLabel){const g=document.createElement("label"),w=gt["input-label"];g.setAttribute("for",c.id),g.className=w,typeof u.customClass=="object"&&Fe(g,u.customClass.inputLabel),g.innerText=u.inputLabel,r.insertAdjacentElement("beforebegin",g)}},Ef=c=>{const r=Oe();if(r)return On(r,gt[c]||gt.input)},_a=(c,r)=>{["string","number"].includes(typeof r)?c.value=`${r}`:Vc(r)||zi(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof r}"`)},li={};li.text=li.email=li.password=li.number=li.tel=li.url=li.search=li.date=li["datetime-local"]=li.time=li.week=li.month=(c,r)=>{const u=c;return _a(u,r.inputValue),_r(u,u,r),Hc(u,r),u.type=r.input,u};li.file=(c,r)=>{const u=c;return _r(u,u,r),Hc(u,r),u};li.range=(c,r)=>{const u=c,g=u.querySelector("input"),w=u.querySelector("output");return g&&(_a(g,r.inputValue),g.type=r.input,_r(g,c,r)),w&&_a(w,r.inputValue),c};li.select=(c,r)=>{const u=c;if(u.textContent="",r.inputPlaceholder){const g=document.createElement("option");hs(g,r.inputPlaceholder),g.value="",g.disabled=!0,g.selected=!0,u.appendChild(g)}return _r(u,u,r),u};li.radio=c=>{const r=c;return r.textContent="",c};li.checkbox=(c,r)=>{const u=Oe();if(!u)throw new Error("Popup not found");const g=El(u,"checkbox");if(!g)throw new Error("Checkbox input not found");g.value="1",g.checked=!!r.inputValue;const k=c.querySelector("span");if(k){const N=r.inputPlaceholder||r.inputLabel;N&&hs(k,N)}return g};li.textarea=(c,r)=>{const u=c;_a(u,r.inputValue),Hc(u,r),_r(u,u,r);const g=w=>parseInt(window.getComputedStyle(w).marginLeft)+parseInt(window.getComputedStyle(w).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const w=Oe();if(!w)return;const k=parseInt(window.getComputedStyle(w).width),N=()=>{if(!document.body.contains(u))return;const D=u.offsetWidth+g(u),E=Oe();E&&(D>k?E.style.width=`${D}px`:eo(E,"width",r.width))};new MutationObserver(N).observe(u,{attributes:!0,attributeFilter:["style"]})}}),u};const V0=(c,r)=>{const u=zc();u&&(Kc(u),as(u,r,"htmlContainer"),r.html?($c(r.html,u),ki(u,"block")):r.text?(u.textContent=r.text,ki(u,"block")):Ei(u),F0(c,r))},z0=(c,r)=>{const u=Af();u&&(Kc(u),Qr(u,!!r.footer,"block"),r.footer&&$c(r.footer,u),as(u,r,"footer"))},j0=(c,r)=>{const u=Ge.innerParams.get(c),g=ir();if(!g)return;if(u&&r.icon===u.icon){md(g,r),gd(g,r);return}if(!r.icon&&!r.iconHtml){Ei(g);return}if(r.icon&&Object.keys(Qa).indexOf(r.icon)===-1){ho(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${r.icon}"`),Ei(g);return}ki(g),md(g,r),gd(g,r),Fe(g,r.showClass&&r.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Ff)},gd=(c,r)=>{for(const[u,g]of Object.entries(Qa))r.icon!==u&&bs(c,g);Fe(c,r.icon&&Qa[r.icon]),Y0(c,r),Ff(),as(c,r,"icon")},Ff=()=>{const c=Oe();if(!c)return;const r=window.getComputedStyle(c).getPropertyValue("background-color"),u=c.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let g=0;g<u.length;g++)u[g].style.backgroundColor=r},U0=c=>`
  ${c.animation?'<div class="swal2-success-circular-line-left"></div>':""}
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div>
  ${c.animation?'<div class="swal2-success-fix"></div>':""}
  ${c.animation?'<div class="swal2-success-circular-line-right"></div>':""}
`,X0=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,md=(c,r)=>{if(!r.icon&&!r.iconHtml)return;let u=c.innerHTML,g="";r.iconHtml?g=pd(r.iconHtml):r.icon==="success"?(g=U0(r),u=u.replace(/ style=".*?"/g,"")):r.icon==="error"?g=X0:r.icon&&(g=pd({question:"?",warning:"!",info:"i"}[r.icon])),u.trim()!==g.trim()&&hs(c,g)},Y0=(c,r)=>{if(r.iconColor){c.style.color=r.iconColor,c.style.borderColor=r.iconColor;for(const u of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])fd(c,u,"background-color",r.iconColor);fd(c,".swal2-success-ring","border-color",r.iconColor)}},pd=c=>`<div class="${gt["icon-content"]}">${c}</div>`,K0=(c,r)=>{const u=Nf();if(u){if(!r.imageUrl){Ei(u);return}ki(u,""),u.setAttribute("src",r.imageUrl),u.setAttribute("alt",r.imageAlt||""),eo(u,"width",r.imageWidth),eo(u,"height",r.imageHeight),u.className=gt.image,as(u,r,"image")}};let qc=!1,Of=0,Rf=0,If=0,Bf=0;const G0=c=>{c.addEventListener("mousedown",tl),document.body.addEventListener("mousemove",el),c.addEventListener("mouseup",il),c.addEventListener("touchstart",tl),document.body.addEventListener("touchmove",el),c.addEventListener("touchend",il)},$0=c=>{c.removeEventListener("mousedown",tl),document.body.removeEventListener("mousemove",el),c.removeEventListener("mouseup",il),c.removeEventListener("touchstart",tl),document.body.removeEventListener("touchmove",el),c.removeEventListener("touchend",il)},tl=c=>{const r=Oe();if(!r)return;const u=ir();if(c.target===r||u&&u.contains(c.target)){qc=!0;const g=Vf(c);Of=g.clientX,Rf=g.clientY,If=parseInt(r.style.insetInlineStart)||0,Bf=parseInt(r.style.insetBlockStart)||0,Fe(r,"swal2-dragging")}},el=c=>{const r=Oe();if(r&&qc){let{clientX:u,clientY:g}=Vf(c);const w=u-Of;r.style.insetInlineStart=`${If+(ee.isRTL?-w:w)}px`,r.style.insetBlockStart=`${Bf+(g-Rf)}px`}},il=()=>{const c=Oe();qc=!1,bs(c,"swal2-dragging")},Vf=c=>{let r=0,u=0;return c.type.startsWith("mouse")?(r=c.clientX,u=c.clientY):c.type.startsWith("touch")&&(r=c.touches[0].clientX,u=c.touches[0].clientY),{clientX:r,clientY:u}},H0=(c,r)=>{const u=ji(),g=Oe();if(!(!u||!g)){if(r.toast){eo(u,"width",r.width),g.style.width="100%";const w=nr();w&&g.insertBefore(w,ir())}else eo(g,"width",r.width);eo(g,"padding",r.padding),r.color&&(g.style.color=r.color),r.background&&(g.style.background=r.background),Ei(Tl()),q0(g,r),r.draggable&&!r.toast?(Fe(g,gt.draggable),G0(g)):(bs(g,gt.draggable),$0(g))}},q0=(c,r)=>{const u=r.showClass||{};c.className=`${gt.popup} ${Wi(c)?u.popup:""}`,r.toast?(Fe([document.documentElement,document.body],gt["toast-shown"]),Fe(c,gt.toast)):Fe(c,gt.modal),as(c,r,"popup"),typeof r.customClass=="string"&&Fe(c,r.customClass),r.icon&&Fe(c,gt[`icon-${r.icon}`])},W0=(c,r)=>{const u=jc();if(!u)return;const{progressSteps:g,currentProgressStep:w}=r;if(!g||g.length===0||w===void 0){Ei(u);return}ki(u),u.textContent="",w>=g.length&&zi("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),g.forEach((k,N)=>{const D=J0(k);if(u.appendChild(D),N===w&&Fe(D,gt["active-progress-step"]),N!==g.length-1){const E=Z0(r);u.appendChild(E)}})},J0=c=>{const r=document.createElement("li");return Fe(r,gt["progress-step"]),hs(r,c),r},Z0=c=>{const r=document.createElement("li");return Fe(r,gt["progress-step-line"]),c.progressStepsDistance&&eo(r,"width",c.progressStepsDistance),r},Q0=(c,r)=>{const u=Cf();u&&(Kc(u),Qr(u,!!(r.title||r.titleText),"block"),r.title&&$c(r.title,u),r.titleText&&(u.innerText=r.titleText),as(u,r,"title"))},zf=(c,r)=>{var u;H0(c,r),A0(c,r),W0(c,r),j0(c,r),K0(c,r),Q0(c,r),N0(c,r),V0(c,r),P0(c,r),z0(c,r);const g=Oe();typeof r.didRender=="function"&&g&&r.didRender(g),(u=ee.eventEmitter)===null||u===void 0||u.emit("didRender",g)},_0=()=>Wi(Oe()),jf=()=>{var c;return(c=$s())===null||c===void 0?void 0:c.click()},ty=()=>{var c;return(c=co())===null||c===void 0?void 0:c.click()},ey=()=>{var c;return(c=sr())===null||c===void 0?void 0:c.click()},or=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Uf=c=>{if(c.keydownTarget&&c.keydownHandlerAdded&&c.keydownHandler){const r=c.keydownHandler;c.keydownTarget.removeEventListener("keydown",r,{capture:c.keydownListenerCapture}),c.keydownHandlerAdded=!1}},iy=(c,r,u)=>{if(Uf(c),!r.toast){const g=k=>ny(r,k,u);c.keydownHandler=g;const w=r.keydownListenerCapture?window:Oe();if(w){c.keydownTarget=w,c.keydownListenerCapture=r.keydownListenerCapture;const k=g;c.keydownTarget.addEventListener("keydown",k,{capture:c.keydownListenerCapture}),c.keydownHandlerAdded=!0}}},sc=(c,r)=>{var u;const g=Xc();if(g.length){c=c+r,c===-2&&(c=g.length-1),c===g.length?c=0:c===-1&&(c=g.length-1),g[c].focus();return}(u=Oe())===null||u===void 0||u.focus()},Xf=["ArrowRight","ArrowDown"],sy=["ArrowLeft","ArrowUp"],ny=(c,r,u)=>{c&&(r.isComposing||r.keyCode===229||(c.stopKeydownPropagation&&r.stopPropagation(),r.key==="Enter"?oy(r,c):r.key==="Tab"?ry(r):[...Xf,...sy].includes(r.key)?ay(r.key):r.key==="Escape"&&ly(r,c,u)))},oy=(c,r)=>{if(!Al(r.allowEnterKey))return;const u=Oe();if(!u||!r.input)return;const g=El(u,r.input);if(c.target&&g&&c.target instanceof HTMLElement&&c.target.outerHTML===g.outerHTML){if(["textarea","file"].includes(r.input))return;jf(),c.preventDefault()}},ry=c=>{const r=c.target,u=Xc();let g=-1;for(let w=0;w<u.length;w++)if(r===u[w]){g=w;break}c.shiftKey?sc(g,-1):sc(g,1),c.stopPropagation(),c.preventDefault()},ay=c=>{const r=Zr(),u=$s(),g=co(),w=sr();if(!r||!u||!g||!w)return;const k=[u,g,w];if(document.activeElement instanceof HTMLElement&&!k.includes(document.activeElement))return;const N=Xf.includes(c)?"nextElementSibling":"previousElementSibling";let D=document.activeElement;if(D){for(let E=0;E<r.children.length;E++){if(D=D[N],!D)return;if(D instanceof HTMLButtonElement&&Wi(D))break}D instanceof HTMLButtonElement&&D.focus()}},ly=(c,r,u)=>{c.preventDefault(),Al(r.allowEscapeKey)&&u(or.esc)};var $o={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const hy=()=>{const c=ji();Array.from(document.body.children).forEach(u=>{u.contains(c)||(u.hasAttribute("aria-hidden")&&u.setAttribute("data-previous-aria-hidden",u.getAttribute("aria-hidden")||""),u.setAttribute("aria-hidden","true"))})},Yf=()=>{Array.from(document.body.children).forEach(r=>{r.hasAttribute("data-previous-aria-hidden")?(r.setAttribute("aria-hidden",r.getAttribute("data-previous-aria-hidden")||""),r.removeAttribute("data-previous-aria-hidden")):r.removeAttribute("aria-hidden")})},Kf=typeof window<"u"&&!!window.GestureEvent,cy=()=>{if(Kf&&!an(document.body,gt.iosfix)){const c=document.body.scrollTop;document.body.style.top=`${c*-1}px`,Fe(document.body,gt.iosfix),uy()}},uy=()=>{const c=ji();if(!c)return;let r;c.ontouchstart=u=>{r=dy(u)},c.ontouchmove=u=>{r&&(u.preventDefault(),u.stopPropagation())}},dy=c=>{const r=c.target,u=ji(),g=zc();return!u||!g||fy(c)||gy(c)?!1:r===u||!ic(u)&&r instanceof HTMLElement&&!d0(r,g)&&r.tagName!=="INPUT"&&r.tagName!=="TEXTAREA"&&!(ic(g)&&g.contains(r))},fy=c=>!!(c.touches&&c.touches.length&&c.touches[0].touchType==="stylus"),gy=c=>c.touches&&c.touches.length>1,my=()=>{if(an(document.body,gt.iosfix)){const c=parseInt(document.body.style.top,10);bs(document.body,gt.iosfix),document.body.style.top="",document.body.scrollTop=c*-1}},py=()=>{const c=document.createElement("div");c.className=gt["scrollbar-measure"],document.body.appendChild(c);const r=c.getBoundingClientRect().width-c.clientWidth;return document.body.removeChild(c),r};let Bo=null;const yy=c=>{Bo===null&&(document.body.scrollHeight>window.innerHeight||c==="scroll")&&(Bo=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Bo+py()}px`)},wy=()=>{Bo!==null&&(document.body.style.paddingRight=`${Bo}px`,Bo=null)};function Gf(c,r,u,g){Ll()?yd(c,g):(i0(u).then(()=>yd(c,g)),Uf(ee)),Kf?(r.setAttribute("style","display:none !important"),r.removeAttribute("class"),r.innerHTML=""):r.remove(),Yc()&&(wy(),my(),Yf()),by()}function by(){bs([document.documentElement,document.body],[gt.shown,gt["height-auto"],gt["no-backdrop"],gt["toast-shown"]])}function Rn(c){c=vy(c);const r=$o.swalPromiseResolve.get(this),u=xy(this);this.isAwaitingPromise?c.isDismissed||(ta(this),r(c)):u&&r(c)}const xy=c=>{const r=Oe();if(!r)return!1;const u=Ge.innerParams.get(c);if(!u||an(r,u.hideClass.popup))return!1;bs(r,u.showClass.popup),Fe(r,u.hideClass.popup);const g=ji();return bs(g,u.showClass.backdrop),Fe(g,u.hideClass.backdrop),ky(c,r,u),!0};function $f(c){const r=$o.swalPromiseReject.get(this);ta(this),r&&r(c)}const ta=c=>{c.isAwaitingPromise&&(delete c.isAwaitingPromise,Ge.innerParams.get(c)||c._destroy())},vy=c=>typeof c>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},c),ky=(c,r,u)=>{var g;const w=ji(),k=Lf(r);typeof u.willClose=="function"&&u.willClose(r),(g=ee.eventEmitter)===null||g===void 0||g.emit("willClose",r),k&&w?Sy(c,r,w,!!u.returnFocus,u.didClose):w&&Gf(c,w,!!u.returnFocus,u.didClose)},Sy=(c,r,u,g,w)=>{ee.swalCloseEventFinishedCallback=Gf.bind(null,c,u,g,w);const k=function(N){if(N.target===r){var D;(D=ee.swalCloseEventFinishedCallback)===null||D===void 0||D.call(ee),delete ee.swalCloseEventFinishedCallback,r.removeEventListener("animationend",k),r.removeEventListener("transitionend",k)}};r.addEventListener("animationend",k),r.addEventListener("transitionend",k)},yd=(c,r)=>{setTimeout(()=>{var u;typeof r=="function"&&r.bind(c.params)(),(u=ee.eventEmitter)===null||u===void 0||u.emit("didClose"),c._destroy&&c._destroy()})},Ho=c=>{let r=Oe();if(r||new Vi,r=Oe(),!r)return;const u=nr();Ll()?Ei(ir()):Py(r,c),ki(u),r.setAttribute("data-loading","true"),r.setAttribute("aria-busy","true"),r.focus()},Py=(c,r)=>{const u=Zr(),g=nr();!u||!g||(!r&&Wi($s())&&(r=$s()),ki(u),r&&(Ei(r),g.setAttribute("data-button-to-replace",r.className),u.insertBefore(g,r)),Fe([c,u],gt.loading))},My=(c,r)=>{r.input==="select"||r.input==="radio"?Dy(c,r):["text","email","number","tel","textarea"].some(u=>u===r.input)&&(Bc(r.inputValue)||Vc(r.inputValue))&&(Ho($s()),Ly(c,r))},Cy=(c,r)=>{const u=c.getInput();if(!u)return null;switch(r.input){case"checkbox":return Ny(u);case"radio":return Ay(u);case"file":return Ty(u);default:return r.inputAutoTrim?u.value.trim():u.value}},Ny=c=>c.checked?1:0,Ay=c=>c.checked?c.value:null,Ty=c=>c.files&&c.files.length?c.getAttribute("multiple")!==null?c.files:c.files[0]:null,Dy=(c,r)=>{const u=Oe();if(!u)return;const g=w=>{r.input==="select"?Ey(u,sl(w),r):r.input==="radio"&&Fy(u,sl(w),r)};Bc(r.inputOptions)||Vc(r.inputOptions)?(Ho($s()),Wr(r.inputOptions).then(w=>{c.hideLoading(),g(w)})):typeof r.inputOptions=="object"?g(r.inputOptions):ho(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof r.inputOptions}`)},Ly=(c,r)=>{const u=c.getInput();u&&(Ei(u),Wr(r.inputValue).then(g=>{u.value=r.input==="number"?`${parseFloat(g)||0}`:`${g}`,ki(u),u.focus(),c.hideLoading()}).catch(g=>{ho(`Error in inputValue promise: ${g}`),u.value="",ki(u),u.focus(),c.hideLoading()}))};function Ey(c,r,u){const g=On(c,gt.select);if(!g)return;const w=(k,N,D)=>{const E=document.createElement("option");E.value=D,hs(E,N),E.selected=Hf(D,u.inputValue),k.appendChild(E)};r.forEach(k=>{const N=k[0],D=k[1];if(Array.isArray(D)){const E=document.createElement("optgroup");E.label=N,E.disabled=!1,g.appendChild(E),D.forEach(U=>w(E,U[1],U[0]))}else w(g,D,N)}),g.focus()}function Fy(c,r,u){const g=On(c,gt.radio);if(!g)return;r.forEach(k=>{const N=k[0],D=k[1],E=document.createElement("input"),U=document.createElement("label");E.type="radio",E.name=gt.radio,E.value=N,Hf(N,u.inputValue)&&(E.checked=!0);const F=document.createElement("span");hs(F,D),F.className=gt.label,U.appendChild(E),U.appendChild(F),g.appendChild(U)});const w=g.querySelectorAll("input");w.length&&w[0].focus()}const sl=c=>{const r=[];return c instanceof Map?c.forEach((u,g)=>{let w=u;typeof w=="object"&&(w=sl(w)),r.push([g,w])}):Object.keys(c).forEach(u=>{let g=c[u];typeof g=="object"&&(g=sl(g)),r.push([u,g])}),r},Hf=(c,r)=>!!r&&r!==null&&r!==void 0&&r.toString()===c.toString(),Oy=c=>{const r=Ge.innerParams.get(c);c.disableButtons(),r.input?qf(c,"confirm"):Jc(c,!0)},Ry=c=>{const r=Ge.innerParams.get(c);c.disableButtons(),r.returnInputValueOnDeny?qf(c,"deny"):Wc(c,!1)},Iy=(c,r)=>{c.disableButtons(),r(or.cancel)},qf=(c,r)=>{const u=Ge.innerParams.get(c);if(!u.input){ho(`The "input" parameter is needed to be set when using returnInputValueOn${Ic(r)}`);return}const g=c.getInput(),w=Cy(c,u);u.inputValidator?By(c,w,r):g&&!g.checkValidity()?(c.enableButtons(),c.showValidationMessage(u.validationMessage||g.validationMessage)):r==="deny"?Wc(c,w):Jc(c,w)},By=(c,r,u)=>{const g=Ge.innerParams.get(c);c.disableInput(),Promise.resolve().then(()=>Wr(g.inputValidator(r,g.validationMessage))).then(k=>{c.enableButtons(),c.enableInput(),k?c.showValidationMessage(k):u==="deny"?Wc(c,r):Jc(c,r)})},Wc=(c,r)=>{const u=Ge.innerParams.get(c);u.showLoaderOnDeny&&Ho(co()),u.preDeny?(c.isAwaitingPromise=!0,Promise.resolve().then(()=>Wr(u.preDeny(r,u.validationMessage))).then(w=>{w===!1?(c.hideLoading(),ta(c)):c.close({isDenied:!0,value:typeof w>"u"?r:w})}).catch(w=>Wf(c,w))):c.close({isDenied:!0,value:r})},wd=(c,r)=>{c.close({isConfirmed:!0,value:r})},Wf=(c,r)=>{c.rejectPromise(r)},Jc=(c,r)=>{const u=Ge.innerParams.get(c);u.showLoaderOnConfirm&&Ho(),u.preConfirm?(c.resetValidationMessage(),c.isAwaitingPromise=!0,Promise.resolve().then(()=>Wr(u.preConfirm(r,u.validationMessage))).then(w=>{Wi(Tl())||w===!1?(c.hideLoading(),ta(c)):wd(c,typeof w>"u"?r:w)}).catch(w=>Wf(c,w))):wd(c,r)};function nl(){const c=Ge.innerParams.get(this);if(!c)return;const r=Ge.domCache.get(this);Ei(r.loader),Ll()?c.icon&&ki(ir()):Vy(r),bs([r.popup,r.actions],gt.loading),r.popup.removeAttribute("aria-busy"),r.popup.removeAttribute("data-loading"),r.confirmButton.disabled=!1,r.denyButton.disabled=!1,r.cancelButton.disabled=!1}const Vy=c=>{const r=c.loader.getAttribute("data-button-to-replace"),u=r?c.popup.getElementsByClassName(r):[];u.length?ki(u[0],"inline-block"):u0()&&Ei(c.actions)};function Jf(){const c=Ge.innerParams.get(this),r=Ge.domCache.get(this);return r?El(r.popup,c.input):null}function Zf(c,r,u){const g=Ge.domCache.get(c);r.forEach(w=>{g[w].disabled=u})}function Qf(c,r){const u=Oe();if(!(!u||!c))if(c.type==="radio"){const g=u.querySelectorAll(`[name="${gt.radio}"]`);for(let w=0;w<g.length;w++)g[w].disabled=r}else c.disabled=r}function _f(){Zf(this,["confirmButton","denyButton","cancelButton"],!1)}function tg(){Zf(this,["confirmButton","denyButton","cancelButton"],!0)}function eg(){Qf(this.getInput(),!1)}function ig(){Qf(this.getInput(),!0)}function sg(c){const r=Ge.domCache.get(this),u=Ge.innerParams.get(this);hs(r.validationMessage,c),r.validationMessage.className=gt["validation-message"],u.customClass&&u.customClass.validationMessage&&Fe(r.validationMessage,u.customClass.validationMessage),ki(r.validationMessage);const g=this.getInput();g&&(g.setAttribute("aria-invalid","true"),g.setAttribute("aria-describedby",gt["validation-message"]),Tf(g),Fe(g,gt.inputerror))}function ng(){const c=Ge.domCache.get(this);c.validationMessage&&Ei(c.validationMessage);const r=this.getInput();r&&(r.removeAttribute("aria-invalid"),r.removeAttribute("aria-describedby"),bs(r,gt.inputerror))}const In={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},zy=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],jy={allowEnterKey:void 0},Uy=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],og=c=>Object.prototype.hasOwnProperty.call(In,c),rg=c=>zy.indexOf(c)!==-1,ag=c=>jy[c],Xy=c=>{og(c)||zi(`Unknown parameter "${c}"`)},Yy=c=>{Uy.includes(c)&&zi(`The parameter "${c}" is incompatible with toasts`)},Ky=c=>{const r=ag(c);r&&Mf(c,r)},lg=c=>{c.backdrop===!1&&c.allowOutsideClick&&zi('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),c.theme&&!["light","dark","auto","minimal","borderless","bootstrap-4","bootstrap-4-light","bootstrap-4-dark","bootstrap-5","bootstrap-5-light","bootstrap-5-dark","material-ui","material-ui-light","material-ui-dark","embed-iframe","bulma","bulma-light","bulma-dark"].includes(c.theme)&&zi(`Invalid theme "${c.theme}"`);for(const r in c)Xy(r),c.toast&&Yy(r),Ky(r)};function hg(c){const r=ji(),u=Oe(),g=Ge.innerParams.get(this);if(!u||an(u,g.hideClass.popup)){zi("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const w=Gy(c),k=Object.assign({},g,w);lg(k),r&&(r.dataset.swal2Theme=k.theme),zf(this,k),Ge.innerParams.set(this,k),Object.defineProperties(this,{params:{value:Object.assign({},this.params,c),writable:!1,enumerable:!0}})}const Gy=c=>{const r={};return Object.keys(c).forEach(u=>{if(rg(u)){const g=c;r[u]=g[u]}else zi(`Invalid parameter to update: ${u}`)}),r};function cg(){var c;const r=Ge.domCache.get(this),u=Ge.innerParams.get(this);if(!u){ug(this);return}r.popup&&ee.swalCloseEventFinishedCallback&&(ee.swalCloseEventFinishedCallback(),delete ee.swalCloseEventFinishedCallback),typeof u.didDestroy=="function"&&u.didDestroy(),(c=ee.eventEmitter)===null||c===void 0||c.emit("didDestroy"),$y(this)}const $y=c=>{ug(c),delete c.params,delete ee.keydownHandler,delete ee.keydownTarget,delete ee.currentInstance},ug=c=>{c.isAwaitingPromise?(Fh(Ge,c),c.isAwaitingPromise=!0):(Fh($o,c),Fh(Ge,c),delete c.isAwaitingPromise,delete c.disableButtons,delete c.enableButtons,delete c.getInput,delete c.disableInput,delete c.enableInput,delete c.hideLoading,delete c.disableLoading,delete c.showValidationMessage,delete c.resetValidationMessage,delete c.close,delete c.closePopup,delete c.closeModal,delete c.closeToast,delete c.rejectPromise,delete c.update,delete c._destroy)},Fh=(c,r)=>{for(const u in c)c[u].delete(r)};var Hy=Object.freeze({__proto__:null,_destroy:cg,close:Rn,closeModal:Rn,closePopup:Rn,closeToast:Rn,disableButtons:tg,disableInput:ig,disableLoading:nl,enableButtons:_f,enableInput:eg,getInput:Jf,handleAwaitingPromise:ta,hideLoading:nl,rejectPromise:$f,resetValidationMessage:ng,showValidationMessage:sg,update:hg});const qy=(c,r,u)=>{c.toast?Wy(c,r,u):(Zy(r),Qy(r),_y(c,r,u))},Wy=(c,r,u)=>{r.popup.onclick=()=>{c&&(Jy(c)||c.timer||c.input)||u(or.close)}},Jy=c=>!!(c.showConfirmButton||c.showDenyButton||c.showCancelButton||c.showCloseButton);let ol=!1;const Zy=c=>{c.popup.onmousedown=()=>{c.container.onmouseup=function(r){c.container.onmouseup=()=>{},r.target===c.container&&(ol=!0)}}},Qy=c=>{c.container.onmousedown=r=>{r.target===c.container&&r.preventDefault(),c.popup.onmouseup=function(u){c.popup.onmouseup=()=>{},(u.target===c.popup||u.target instanceof HTMLElement&&c.popup.contains(u.target))&&(ol=!0)}}},_y=(c,r,u)=>{r.container.onclick=g=>{if(ol){ol=!1;return}g.target===r.container&&Al(c.allowOutsideClick)&&u(or.backdrop)}},tw=c=>typeof c=="object"&&c.jquery,bd=c=>c instanceof Element||tw(c),ew=c=>{const r={};return typeof c[0]=="object"&&!bd(c[0])?Object.assign(r,c[0]):["title","html","icon"].forEach((u,g)=>{const w=c[g];typeof w=="string"||bd(w)?r[u]=w:w!==void 0&&ho(`Unexpected type of ${u}! Expected "string" or "Element", got ${typeof w}`)}),r};function iw(...c){return new this(...c)}function sw(c){class r extends this{_main(g,w){return super._main(g,Object.assign({},c,w))}}return r}const nw=()=>ee.timeout&&ee.timeout.getTimerLeft(),dg=()=>{if(ee.timeout)return f0(),ee.timeout.stop()},fg=()=>{if(ee.timeout){const c=ee.timeout.start();return Gc(c),c}},ow=()=>{const c=ee.timeout;return c&&(c.running?dg():fg())},rw=c=>{if(ee.timeout){const r=ee.timeout.increase(c);return Gc(r,!0),r}},aw=()=>!!(ee.timeout&&ee.timeout.isRunning());let xd=!1;const nc={};function lw(c="data-swal-template"){nc[c]=this,xd||(document.body.addEventListener("click",hw),xd=!0)}const hw=c=>{for(let r=c.target;r&&r!==document;r=r.parentNode)for(const u in nc){const g=r.getAttribute&&r.getAttribute(u);if(g){nc[u].fire({template:g});return}}};class cw{constructor(){this.events={}}_getHandlersByEventName(r){return typeof this.events[r]>"u"&&(this.events[r]=[]),this.events[r]}on(r,u){const g=this._getHandlersByEventName(r);g.includes(u)||g.push(u)}once(r,u){const g=(...w)=>{this.removeListener(r,g),u.apply(this,w)};this.on(r,g)}emit(r,...u){this._getHandlersByEventName(r).forEach(g=>{try{g.apply(this,u)}catch(w){console.error(w)}})}removeListener(r,u){const g=this._getHandlersByEventName(r),w=g.indexOf(u);w>-1&&g.splice(w,1)}removeAllListeners(r){this.events[r]!==void 0&&(this.events[r].length=0)}reset(){this.events={}}}ee.eventEmitter=new cw;const uw=(c,r)=>{ee.eventEmitter&&ee.eventEmitter.on(c,r)},dw=(c,r)=>{ee.eventEmitter&&ee.eventEmitter.once(c,r)},fw=(c,r)=>{if(ee.eventEmitter){if(!c){ee.eventEmitter.reset();return}r?ee.eventEmitter.removeListener(c,r):ee.eventEmitter.removeAllListeners(c)}};var gw=Object.freeze({__proto__:null,argsToParams:ew,bindClickHandler:lw,clickCancel:ey,clickConfirm:jf,clickDeny:ty,enableLoading:Ho,fire:iw,getActions:Zr,getCancelButton:sr,getCloseButton:Uc,getConfirmButton:$s,getContainer:ji,getDenyButton:co,getFocusableElements:Xc,getFooter:Af,getHtmlContainer:zc,getIcon:ir,getIconContent:r0,getImage:Nf,getInputLabel:a0,getLoader:nr,getPopup:Oe,getProgressSteps:jc,getTimerLeft:nw,getTimerProgressBar:Dl,getTitle:Cf,getValidationMessage:Tl,increaseTimer:rw,isDeprecatedParameter:ag,isLoading:h0,isTimerRunning:aw,isUpdatableParameter:rg,isValidParameter:og,isVisible:_0,mixin:sw,off:fw,on:uw,once:dw,resumeTimer:fg,showLoading:Ho,stopTimer:dg,toggleTimer:ow});class mw{constructor(r,u){this.callback=r,this.remaining=u,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(r){const u=this.running;return u&&this.stop(),this.remaining+=r,u&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const gg=["swal-title","swal-html","swal-footer"],pw=c=>{const r=typeof c.template=="string"?document.querySelector(c.template):c.template;if(!r)return{};const u=r.content;return Pw(u),Object.assign(yw(u),ww(u),bw(u),xw(u),vw(u),kw(u),Sw(u,gg))},yw=c=>{const r={};return Array.from(c.querySelectorAll("swal-param")).forEach(g=>{no(g,["name","value"]);const w=g.getAttribute("name"),k=g.getAttribute("value");!w||!k||(w in In&&typeof In[w]=="boolean"?r[w]=k!=="false":w in In&&typeof In[w]=="object"?r[w]=JSON.parse(k):r[w]=k)}),r},ww=c=>{const r={};return Array.from(c.querySelectorAll("swal-function-param")).forEach(g=>{const w=g.getAttribute("name"),k=g.getAttribute("value");!w||!k||(r[w]=new Function(`return ${k}`)())}),r},bw=c=>{const r={};return Array.from(c.querySelectorAll("swal-button")).forEach(g=>{no(g,["type","color","aria-label"]);const w=g.getAttribute("type");if(!(!w||!["confirm","cancel","deny"].includes(w))){if(r[`${w}ButtonText`]=g.innerHTML,r[`show${Ic(w)}Button`]=!0,g.hasAttribute("color")){const k=g.getAttribute("color");k!==null&&(r[`${w}ButtonColor`]=k)}if(g.hasAttribute("aria-label")){const k=g.getAttribute("aria-label");k!==null&&(r[`${w}ButtonAriaLabel`]=k)}}}),r},xw=c=>{const r={},u=c.querySelector("swal-image");return u&&(no(u,["src","width","height","alt"]),u.hasAttribute("src")&&(r.imageUrl=u.getAttribute("src")||void 0),u.hasAttribute("width")&&(r.imageWidth=u.getAttribute("width")||void 0),u.hasAttribute("height")&&(r.imageHeight=u.getAttribute("height")||void 0),u.hasAttribute("alt")&&(r.imageAlt=u.getAttribute("alt")||void 0)),r},vw=c=>{const r={},u=c.querySelector("swal-icon");return u&&(no(u,["type","color"]),u.hasAttribute("type")&&(r.icon=u.getAttribute("type")),u.hasAttribute("color")&&(r.iconColor=u.getAttribute("color")),r.iconHtml=u.innerHTML),r},kw=c=>{const r={},u=c.querySelector("swal-input");u&&(no(u,["type","label","placeholder","value"]),r.input=u.getAttribute("type")||"text",u.hasAttribute("label")&&(r.inputLabel=u.getAttribute("label")),u.hasAttribute("placeholder")&&(r.inputPlaceholder=u.getAttribute("placeholder")),u.hasAttribute("value")&&(r.inputValue=u.getAttribute("value")));const g=Array.from(c.querySelectorAll("swal-input-option"));return g.length&&(r.inputOptions={},g.forEach(w=>{no(w,["value"]);const k=w.getAttribute("value");if(!k)return;const N=w.innerHTML;r.inputOptions[k]=N})),r},Sw=(c,r)=>{const u={};for(const g in r){const w=r[g],k=c.querySelector(w);k&&(no(k,[]),u[w.replace(/^swal-/,"")]=k.innerHTML.trim())}return u},Pw=c=>{const r=gg.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(c.children).forEach(u=>{const g=u.tagName.toLowerCase();r.includes(g)||zi(`Unrecognized element <${g}>`)})},no=(c,r)=>{Array.from(c.attributes).forEach(u=>{r.indexOf(u.name)===-1&&zi([`Unrecognized attribute "${u.name}" on <${c.tagName.toLowerCase()}>.`,`${r.length?`Allowed attributes are: ${r.join(", ")}`:"To set the value, use HTML within the element."}`])})},mg=10,Mw=c=>{var r,u;const g=ji(),w=Oe();if(!g||!w)return;typeof c.willOpen=="function"&&c.willOpen(w),(r=ee.eventEmitter)===null||r===void 0||r.emit("willOpen",w);const N=window.getComputedStyle(document.body).overflowY;if(Aw(g,w,c),setTimeout(()=>{Cw(g,w)},mg),Yc()&&(Nw(g,c.scrollbarPadding!==void 0?c.scrollbarPadding:!1,N),hy()),!Ll()&&!ee.previousActiveElement&&(ee.previousActiveElement=document.activeElement),typeof c.didOpen=="function"){const D=c.didOpen;setTimeout(()=>D(w))}(u=ee.eventEmitter)===null||u===void 0||u.emit("didOpen",w)},rl=c=>{const r=Oe();if(!r||c.target!==r)return;const u=ji();u&&(r.removeEventListener("animationend",rl),r.removeEventListener("transitionend",rl),u.style.overflowY="auto",bs(u,gt["no-transition"]))},Cw=(c,r)=>{Lf(r)?(c.style.overflowY="hidden",r.addEventListener("animationend",rl),r.addEventListener("transitionend",rl)):c.style.overflowY="auto"},Nw=(c,r,u)=>{cy(),r&&u!=="hidden"&&yy(u),setTimeout(()=>{c.scrollTop=0})},Aw=(c,r,u)=>{var g;(g=u.showClass)!==null&&g!==void 0&&g.backdrop&&Fe(c,u.showClass.backdrop),u.animation?(r.style.setProperty("opacity","0","important"),ki(r,"grid"),setTimeout(()=>{var w;(w=u.showClass)!==null&&w!==void 0&&w.popup&&Fe(r,u.showClass.popup),r.style.removeProperty("opacity")},mg)):ki(r,"grid"),Fe([document.documentElement,document.body],gt.shown),u.heightAuto&&u.backdrop&&!u.toast&&Fe([document.documentElement,document.body],gt["height-auto"])};var vd={email:(c,r)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(c)?Promise.resolve():Promise.resolve(r||"Invalid email address"),url:(c,r)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(c)?Promise.resolve():Promise.resolve(r||"Invalid URL")};function Tw(c){c.inputValidator||(c.input==="email"&&(c.inputValidator=vd.email),c.input==="url"&&(c.inputValidator=vd.url))}function Dw(c){(!c.target||typeof c.target=="string"&&!document.querySelector(c.target)||typeof c.target!="string"&&!c.target.appendChild)&&(zi('Target parameter is not valid, defaulting to "body"'),c.target="body")}function Lw(c){Tw(c),c.showLoaderOnConfirm&&!c.preConfirm&&zi(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),Dw(c),typeof c.title=="string"&&(c.title=c.title.split(`
`).join("<br />")),v0(c)}let js;var xa=new WeakMap;class hi{constructor(...r){if(Qp(this,xa,Promise.resolve({isConfirmed:!1,isDenied:!1,isDismissed:!0})),typeof window>"u")return;js=this;const u=Object.freeze(this.constructor.argsToParams(r));this.params=u,this.isAwaitingPromise=!1,_p(xa,this,this._main(js.params))}_main(r,u={}){if(lg(Object.assign({},u,r)),ee.currentInstance){const k=$o.swalPromiseResolve.get(ee.currentInstance),{isAwaitingPromise:N}=ee.currentInstance;ee.currentInstance._destroy(),N||k({isDismissed:!0}),Yc()&&Yf()}ee.currentInstance=js;const g=Fw(r,u);Lw(g),Object.freeze(g),ee.timeout&&(ee.timeout.stop(),delete ee.timeout),clearTimeout(ee.restoreFocusTimeout);const w=Ow(js);return zf(js,g),Ge.innerParams.set(js,g),Ew(js,w,g)}then(r){return ud(xa,this).then(r)}finally(r){return ud(xa,this).finally(r)}}const Ew=(c,r,u)=>new Promise((g,w)=>{const k=N=>{c.close({isDismissed:!0,dismiss:N,isConfirmed:!1,isDenied:!1})};$o.swalPromiseResolve.set(c,g),$o.swalPromiseReject.set(c,w),r.confirmButton.onclick=()=>{Oy(c)},r.denyButton.onclick=()=>{Ry(c)},r.cancelButton.onclick=()=>{Iy(c,k)},r.closeButton.onclick=()=>{k(or.close)},qy(u,r,k),iy(ee,u,k),My(c,u),Mw(u),Rw(ee,u,k),Iw(r,u),setTimeout(()=>{r.container.scrollTop=0})}),Fw=(c,r)=>{const u=pw(c),g=Object.assign({},In,r,u,c);return g.showClass=Object.assign({},In.showClass,g.showClass),g.hideClass=Object.assign({},In.hideClass,g.hideClass),g.animation===!1&&(g.showClass={backdrop:"swal2-noanimation"},g.hideClass={}),g},Ow=c=>{const r={popup:Oe(),container:ji(),actions:Zr(),confirmButton:$s(),denyButton:co(),cancelButton:sr(),loader:nr(),closeButton:Uc(),validationMessage:Tl(),progressSteps:jc()};return Ge.domCache.set(c,r),r},Rw=(c,r,u)=>{const g=Dl();Ei(g),r.timer&&(c.timeout=new mw(()=>{u("timer"),delete c.timeout},r.timer),r.timerProgressBar&&g&&(ki(g),as(g,r,"timerProgressBar"),setTimeout(()=>{c.timeout&&c.timeout.running&&Gc(r.timer)})))},Iw=(c,r)=>{if(!r.toast){if(!Al(r.allowEnterKey)){Mf("allowEnterKey"),zw();return}Bw(c)||Vw(c,r)||sc(-1,1)}},Bw=c=>{const r=Array.from(c.popup.querySelectorAll("[autofocus]"));for(const u of r)if(u instanceof HTMLElement&&Wi(u))return u.focus(),!0;return!1},Vw=(c,r)=>r.focusDeny&&Wi(c.denyButton)?(c.denyButton.focus(),!0):r.focusCancel&&Wi(c.cancelButton)?(c.cancelButton.focus(),!0):r.focusConfirm&&Wi(c.confirmButton)?(c.confirmButton.focus(),!0):!1,zw=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};hi.prototype.disableButtons=tg;hi.prototype.enableButtons=_f;hi.prototype.getInput=Jf;hi.prototype.disableInput=ig;hi.prototype.enableInput=eg;hi.prototype.hideLoading=nl;hi.prototype.disableLoading=nl;hi.prototype.showValidationMessage=sg;hi.prototype.resetValidationMessage=ng;hi.prototype.close=Rn;hi.prototype.closePopup=Rn;hi.prototype.closeModal=Rn;hi.prototype.closeToast=Rn;hi.prototype.rejectPromise=$f;hi.prototype.update=hg;hi.prototype._destroy=cg;Object.assign(hi,gw);Object.keys(Hy).forEach(c=>{hi[c]=function(...r){if(js&&js[c])return js[c](...r)}});hi.DismissReason=or;hi.version="11.26.17";const Vi=hi;Vi.default=Vi;typeof document<"u"&&(function(c,r){var u=c.createElement("style");if(c.getElementsByTagName("head")[0].appendChild(u),u.styleSheet)u.styleSheet.disabled||(u.styleSheet.cssText=r);else try{u.innerHTML=r}catch{u.innerText=r}})(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.15s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-timer-progress-bar-background: rgba(0, 0, 0, 0.3);--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;overflow-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:var(--swal2-timer-progress-bar-background)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;overflow-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}100%{transform:translate3d(0, 0, 0) scale(1);opacity:1}}@keyframes swal2-hide{0%{transform:translate3d(0, 0, 0) scale(1);opacity:1}100%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const pg="TODO: program header",va="func-planner-drag-over";function Zc(c){if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(c).then();else{let r=document.createElement("textarea");r.value=c,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}}function jw(c,r=80,u=4){r=r-u,u=" ".repeat(u),c=c.replace(new RegExp(`(?![^\\n]{1,${r}}$)([^\\n]{1,${r}})\\s`,"g"),u+`$1
`);let g=c.lastIndexOf(`
`);return g===-1?`${u}${c}`:(c=c.slice(0,g)+`
`+u+c.slice(g+1),c)}function yg(c,r=4){return r=" ".repeat(r),c.split(`
`).map(u=>r+u).join(`
`)}function Uw(c){let r=[];for(let u=0;u<c.length;u++){const g=c[u];if(g==="(")r.push(u);else if(g===")"&&r.pop()===0)return[c.slice(1,u).trim(),c.slice(u+1).trim()]}return[null,c]}function Xw(c){const r=[];let u="",g=0;for(let w=0;w<c.length;w++){const k=c[w];k==="("?(g++,u+=k):k===")"?(g--,u+=k):k===","&&g===0?(r.push(u.trim()),u=""):u+=k}return u&&r.push(u.trim()),r}function Yw(c){if(c=c.trim(),c.startsWith("(")&&c.endsWith(")")){let[r,u]=Uw(c);if(u==="")return r}return c}function Qc(c){return Yw(c.trim().replace(/\s+/g," "))}function al(c,r){return c=Qc(c),c=c.replace(/, ?and\b/,",").replace(/ and\b/,", "),Xw(c).map(u=>r(u.trim(),!0)).join(", ")}function wg(c,r){c=c.slice(10);let[u,g]=c.split(" associated with ");return u.startsWith("keys of ")&&(u=u.slice(8)),g.startsWith("values of ")&&(g=g.slice(10)),[r(u,!0),r(g,!0)]}function bg(c){let r=c.split(" ");return r[0].endsWith("s")&&(r[0]=r[0].slice(0,-1)),r.join(" ")}const kd={int:"0",str:'""',float:"0.0",bool:"False",list:"[]",tuple:"()",dict:"{}",set:"set()"};function Mn(c,r=!1){return c=Qc(c),r&&(c=bg(c)),kd[c]?kd[c]:c.startsWith("list of ")?`[${Mn(c.slice(8),!0)}]`:c.startsWith("list with ")?`[${al(c.slice(10),Mn)}]`:c.startsWith("tuple of ")?`(${Mn(c.slice(9),!0)},)`:c.startsWith("tuple with ")?`(${al(c.slice(11),Mn)})`:c.startsWith("dict of ")?`{"": ${Mn(c.slice(8),!0)}}`:c.startsWith("dict with ")?`{${wg(c,Mn).join(": ")}}`:c.startsWith("set of ")?`{${Mn(c.slice(7),!0)}}`:"None"}function on(c,r=!1){return c=Qc(c),r&&(c=bg(c)),c.startsWith("list of ")?`list[${on(c.slice(8),!0)}]`:c.startsWith("list with ")?`list[${al(c.slice(10),on)}]`:c.startsWith("tuple of ")?`tuple[${on(c.slice(9),!0)}, ...]`:c.startsWith("tuple with ")?`tuple[${al(c.slice(11),on)}]`:c.startsWith("dict of ")?`dict[str, ${on(c.slice(8),!0)}]`:c.startsWith("dict with ")?`dict[${wg(c,on).join(", ")}]`:c.startsWith("set of ")?`set[${on(c.slice(7),!0)}]`:c}const Sd="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function xg(c){return Sd.charAt(c%Sd.length)}function Kw(c,r,u=!0){let g=(c.name||xg(r)).trim();return!u||!c.type?g:`${g}: ${on(c.type)}`}function vg(c,r,u,g=!0,w=!1){const k=r.map((E,U)=>Kw(E,U,g));let N="";if(g&&u.length>0){const E=u.map(U=>U.type?on(U.type):"object");N=" -> "+(u.length===1?E[0]:`tuple[${E.join(", ")}]`)}const D=`${c}(${k.join(", ")})${N}`;return w?D:`def ${D}:`}function Pd(c,r,u){let g="";if(r.length===1)g=`    ${c}: ${u(r[0],0)}
`;else if(r.length>1){g=`    ${c}s:
`;for(let[w,k]of r.entries())g+=`        ${u(k,w)}
`}return g}function Gw(c,r,u){let g=`    """
${jw(c)}

`;return g+=Pd("Parameter",r,(w,k)=>`${w.name||xg(k)} (${w.type}): ${w.desc}`),g+=Pd("Return",u,(w,k)=>`${w.type}: ${w.desc}`),g+=`    """
`,g}function $w(c,r=!0){var k,N,D,E,U,F;const u=c.modelData.toJSON();let g=`"""
${u.documentation||pg}

By: ${u.authors||"TODO"}
"""

`;u.globalCode&&(g+=`${u.globalCode}

`);let w=null;for(const[j,G]of c.functions.entries()){const W=((k=G.get("name"))==null?void 0:k.toString())||`function${j}`,tt=((N=G.get("params"))==null?void 0:N.toJSON())||[],it=((D=G.get("returns"))==null?void 0:D.toJSON())||[];let nt=vg(W,tt,it,r)+`
`;const L=((E=G.get("desc"))==null?void 0:E.toString())||"";L&&(nt+=Gw(L,tt,it));const _=((U=G.get("code"))==null?void 0:U.toString())||"";if(_)nt+=yg(_,4);else{nt+=`    # TODO: implement this function
`;const Y=(F=c.calledFunctions[j])==null?void 0:F.map(X=>{var lt,B;return((B=(lt=c.functions.get(X))==null?void 0:lt.get("name"))==null?void 0:B.toString())||`function${X}`});(Y==null?void 0:Y.length)>0&&(nt+=`    # Calls ${Y.map(X=>X+"()").join(", ")}
`);const ct=G.get("io")||"none";ct==="validation"?nt+=`    # Has direct user input that requires validation
`:ct==="input"?nt+=`    # Has direct user input
`:ct==="output"&&(nt+=`    # Has direct user output
`),it.length>0?nt+=`    return ${it.map(X=>Mn(X.type)).join(", ")}`:nt+="    pass"}W==="main"?w=nt:g+=nt+`


`}return w&&(g+=w+`


if __name__ == "__main__":
    main()
`),g}function Hw(c,r,u=!0){const g=$w(c,u);Zc(g),Vi.fire({theme:r.theme,imageUrl:"images/python.svg",imageWidth:"6em",title:"Python Template Copied",html:'Python template copied to clipboard.<br>Paste it into a Python file.<br><a href="data:text/plain;charset=utf-8,'+encodeURIComponent(g)+'" download="'+c.id+'.py">Click here to download it.</a>',showCloseButton:!0})}function qw(c){var g;const r=c.modelData.toJSON();let u=`"""
${r.testDocumentation||"Tests for the "+c.id+" module"}

By: ${r.authors||"TODO"}
"""

import pytest

import `+c.id+`

`;for(const[w,k]of c.functions.entries())if(k.get("testable")){const N=((g=k.get("name"))==null?void 0:g.toString())||`function${w}`;u+=`def test_${N}():
`,u+=k.testCode?yg(k.testCode,4):`    # TODO: write tests for ${N}()
    pass`,u+=`

`}return u+=`if __name__ == '__main__':
    pytest.main(["--no-header", "--tb=short"])
`,u}function Ww(c,r={}){const u=qw(c);Zc(u),Vi.fire({theme:r.theme,imageUrl:"images/unit-tests.svg",imageWidth:"6em",title:"Python Unit Tests Copied",html:'Python unit tests copied to clipboard.<br>Paste it into a Python file that ends with <code>_test.py</code>.<br><a href="data:text/plain;charset=utf-8,'+encodeURIComponent(u)+'" download="'+c.id+'_test.py">Click here to download it.</a>',showCloseButton:!0})}function Jw(c,r,u,g="auto"){Vi.fire({title:c,text:r,icon:"warning",theme:g,showCancelButton:!0,showCloseButton:!0,focusConfirm:!1}).then(w=>{w&&u()})}function Zw(c,r){const u=Array.from(c.functions).reduce((g,w)=>Math.max(g,parseInt(w.key)),-1);r.model.transact(()=>{r.functions.forEach(g=>{const w=(parseInt(g.key)+u).toString();g={...g},delete g.key,c.functions.set(w,c.convertFuncData(g))}),r.calls.forEach(g=>{const w=(parseInt(g.from)+u).toString(),k=(parseInt(g.to)+u).toString();c.calls.set(`${w}-${k}`,!0)})})}function kg(c,r,u=!0){u?Jw("Reset to Default?","Are you sure you want to load the default functions for this plan? This will clear the current plan.",()=>{kg(c,r,!1)},r.theme):c.resetModel()}function Qw(c,r={}){const u=c.exportModel(),g=JSON.stringify(u,null,2);Zc(g),Vi.fire({theme:r.theme,imageUrl:"images/save.svg",imageWidth:"6em",title:"JSON Copied",html:'JSON version copied to clipboard.<br>Save to a file so it can be reloaded later.<br><a href="data:application/json;charset=utf-8,'+encodeURIComponent(g)+'" download="'+c.id+'-plan.json">Click here to download it.</a>',showCloseButton:!0})}function _w(c,r={}){Vi.fire({theme:r.theme,title:"Load JSON",html:"Paste the JSON data below.<br>This will <em>overwrite</em> the current plan.",input:"textarea",showCancelButton:!0,showCloseButton:!0,inputValidator:u=>{if(!u)return"JSON data is required.";try{const g=JSON.parse(u);if(!g.functions||!g.calls)return"Invalid JSON format. Expected 'functions' and 'calls' keys at a minimum."}catch{return"Invalid JSON format"}return null}}).then(u=>{u.isConfirmed&&_c(c,r,u.value,!1)})}function _c(c,r={},u,g=!1){try{const w=JSON.parse(u);if(!w.functions||!w.calls)throw new Error("Invalid JSON format. Expected 'functions' and 'calls' keys at a minimum.");g?Zw(c,w):c.importModel(w)}catch(w){console.error("Invalid JSON data:",w),Vi.fire({theme:r.theme,title:"Invalid JSON",text:"The JSON data is invalid.",icon:"error",showCloseButton:!0})}}function Md(c,r={},u){const g=new FileReader;g.onload=()=>{_c(c,r,g.result)},g.onerror=()=>{Vi.fire({theme:r.theme,title:"File Error",text:"Error reading the file. Please try again.",icon:"error",showCloseButton:!0})},g.readAsText(u)}function tb(c,r={},u){u.addEventListener("drop",g=>{if(g.preventDefault(),u.classList.remove(va),g.dataTransfer.items){const w=g.dataTransfer.items[0];w.kind==="file"?Md(c,r,w.getAsFile()):w.kind==="string"&&w.getAsString(k=>{k.startsWith("{")&&_c(c,r,k)})}else g.dataTransfer.files&&Md(c,r,g.dataTransfer.files[0])}),u.addEventListener("dragenter",g=>{g.preventDefault(),u.classList.add(va)}),u.addEventListener("dragover",g=>{g.preventDefault(),u.classList.add(va)}),u.addEventListener("dragleave",g=>{u.classList.remove(va)})}const tu=localStorage.getItem("func-planner-show-collapse-button")==="true",eu=localStorage.getItem("func-planner-allow-recursive")==="true";function eb(c,r){c===tu&&r===eu||(localStorage.setItem("func-planner-show-collapse-button",c?"true":"false"),localStorage.setItem("func-planner-allow-recursive",r?"true":"false"),location.reload())}function oc(c,r){return c===r?!0:typeof c!=typeof r||c===null||r===null||typeof c!="object"?!1:Array.isArray(c)&&Array.isArray(r)&&c.length==r.length&&c.every((u,g)=>oc(u,r[g]))?!0:Object.keys(c).length!==Object.keys(r).length?!1:Object.keys(c).every(u=>u in r&&oc(c[u],r[u]))}function Sg(c){return JSON.parse(JSON.stringify(c))}function Fl(c,r,u=""){fetch(c).then(g=>g.text()).then(g=>{r.innerHTML=g}).catch(g=>{console.error(`Error loading SVG from ${c}:`,g),r.textContent=u})}function io(c,r){let u=document.createElement("option");return u.value=c,u.text=r||c,u}function Pg(c){const r=document.createElement("div");return r.innerHTML=c,r.firstElementChild}function ib(){var r,u;return(((u=(r=window.navigator)==null?void 0:r.userAgentData)==null?void 0:u.platform)||window.navigator.platform).toLowerCase().indexOf("mac")!==-1}const sb="func-planner-info-box",Cd="func-planner-main-check",Nd="func-planner-count",Ad="func-planner-testable";function nb(c,r,u={}){const g=c.div.parentNode;ab(g,u),rb(g,u,c),lb(g),ob(g,c,r,u),hb(g,r,u)}function ob(c,r,u,g={}){const w=ib(),k=w?"":"CTRL+",N=document.createElement("div");N.className="func-planner-widgets",c.appendChild(N);const D=document.createElement("div");D.className="button-holder",N.appendChild(D);function E(){u.undoManager.canUndo()&&u.undoManager.undo()}function U(){u.undoManager.canRedo()&&u.undoManager.redo()}document.addEventListener("keydown",tt=>{if((w?tt.metaKey:tt.ctrlKey)&&!tt.altKey){const it=tt.key.toLowerCase();it==="r"&&!tt.shiftKey?(tt.preventDefault(),r.zoomToFit()):it==="f"&&!tt.shiftKey?(tt.preventDefault(),u.addFunc()):it==="z"&&(tt.preventDefault(),tt.shiftKey?U():E())}},!0),u.addListener("synced",()=>{setTimeout(()=>{r.zoomToFit()},0)}),en(D,"magnifier.svg","",`Zoom to Fit (${k}R)`,()=>{r.zoomToFit()}),en(D,"add.svg","no-outline",`Add Function (${k}F)`,()=>{u.addFunc()});const F=en(D,"undo.svg","no-outline",`Undo (${k}Z)`,E),j=en(D,"redo.svg","no-outline",`Redo (${k}Z)`,U);function G(){F.disabled=!u.undoManager.canUndo(),j.disabled=!u.undoManager.canRedo()}u.undoManager.on("stack-item-added",G),u.undoManager.on("stack-item-popped",G),u.undoManager.on("stack-cleared",G),G(),en(D,"reset.svg","no-outline","Reset",()=>{kg(u,g)}),en(D,"python.svg","","Create Python Template",()=>{Hw(u,g)});const W=en(D,"unit-tests.svg","","Generate Python Unit Tests",()=>{Ww(u,g)});u.addFuncListener("testable",()=>{W.disabled=Array.from(u.functions.values()).every(tt=>!tt.get("testable"))}),W.disabled=Array.from(u.functions.values()).every(tt=>!tt.get("testable")),en(D,"save.svg","no-outline","Save as JSON",()=>{Qw(u,g)}),en(D,"load.svg","no-outline","Load from JSON",()=>{_w(u,g)})}function en(c,r,u,g,w){const k=document.createElement("button");let N;r.toLowerCase().endsWith(".svg")?(N=document.createElement("div"),Fl(`images/${r}`,N,"")):(N=document.createElement("img"),N.src=`images/${r}`),N.classList=u+" func-planner-icon",k.appendChild(N);const D=document.createElement("span");return D.innerText=g,k.appendChild(D),k.addEventListener("click",w),c.appendChild(k),k}function rb(c,r,u){const g=document.createElement("link");g.type="text/css",g.rel="stylesheet",g.href="https://cdn.jsdelivr.net/npm/theme-toggles@4.10.1/css/within.min.css",document.head.appendChild(g);const w=r.theme==="dark",k=Pg(`
<label class="func-planner-fab theme-toggle" title="Toggle theme">
  <input type="checkbox" ${w?"checked":""} />
  <span class="theme-toggle-sr">Toggle theme</span>
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="theme-toggle__within" height="1em" width="1em" viewBox="0 0 32 32" fill="currentColor">
    <clipPath id="theme-toggle__within__clip"><path d="M0 0h32v32h-32ZM6 16A1 1 0 0026 16 1 1 0 006 16" /></clipPath>
    <g clip-path="url(#theme-toggle__within__clip)">
      <path d="M30.7 21.3 27.1 16l3.7-5.3c.4-.5.1-1.3-.6-1.4l-6.3-1.1-1.1-6.3c-.1-.6-.8-.9-1.4-.6L16 5l-5.4-3.7c-.5-.4-1.3-.1-1.4.6l-1 6.3-6.4 1.1c-.6.1-.9.9-.6 1.3L4.9 16l-3.7 5.3c-.4.5-.1 1.3.6 1.4l6.3 1.1 1.1 6.3c.1.6.8.9 1.4.6l5.3-3.7 5.3 3.7c.5.4 1.3.1 1.4-.6l1.1-6.3 6.3-1.1c.8-.1 1.1-.8.7-1.4zM16 25.1c-5.1 0-9.1-4.1-9.1-9.1 0-5.1 4.1-9.1 9.1-9.1s9.1 4.1 9.1 9.1c0 5.1-4 9.1-9.1 9.1z" />
    </g>
    <path
      class="theme-toggle__within__circle"
      d="M16 7.7c-4.6 0-8.2 3.7-8.2 8.2s3.6 8.4 8.2 8.4 8.2-3.7 8.2-8.2-3.6-8.4-8.2-8.4zm0 14.4c-3.4 0-6.1-2.9-6.1-6.2s2.7-6.1 6.1-6.1c3.4 0 6.1 2.9 6.1 6.2s-2.7 6.1-6.1 6.1z"
    />
    <path
      class="theme-toggle__within__inner"
      d="M16 9.5c-3.6 0-6.4 2.9-6.4 6.4s2.8 6.5 6.4 6.5 6.4-2.9 6.4-6.4-2.8-6.5-6.4-6.5z"
    />
  </svg>
</label>`);c.appendChild(k);const N=k.querySelector('input[type="checkbox"]');u.themeManager.currentTheme=w?"dark":"light",c.classList.toggle("dark-mode",w),N.addEventListener("change",D=>{const E=D.target.checked?"dark":"light";localStorage.setItem("func-planner-theme",E),u.themeManager.currentTheme=E,c.classList.toggle("dark-mode",D.target.checked),r.theme=E})}function ab(c,r){const u=document.createElement("div");u.className="func-planner-fab func-planner-settings-button",u.title="Settings",Fl("images/settings.svg",u,""),c.appendChild(u),u.addEventListener("click",()=>{Vi.fire({theme:r.theme,title:"Function Planner Settings",html:`<div class="func-planner-settings">
  <label><span>Show Collapse Button:</span><input type="checkbox" class="show-collapse-button" ${tu?"checked":""}></label><br>
  <label><span>Allow Recursive Calls:</span><input type="checkbox" class="allow-recursive" ${eu?"checked":""}></label>
</div>`,showCancelButton:!0}).then(g=>{if(g.isConfirmed){const w=Vi.getPopup(),k=w.getElementsByClassName("show-collapse-button")[0].checked,N=w.getElementsByClassName("allow-recursive")[0].checked;eb(k,N)}})})}function lb(c){const r=document.createElement("div");r.className="func-planner-fab func-planner-instructions-button",r.title="Instructions",Fl("images/help.svg",r,""),c.appendChild(r),c.appendChild(Pg(`<div class="func-planner-instructions"><h2>Instructions</h2>
<p>The diagram shows the functions and who they call. Clicking on a function
shows details and allows you to edit it.</p>
<p>As you edit the functions, any problems will be shown.
Errors are shown with a <span class="stroke-error">red</span> outline and less
serious warnings with a <span class="stroke-warning">yellow</span> outline.</p>
<p>The color of a function indicates its user I/O type:</p>
<ul>
    <li><span class="bg-testable">Testable</span> - can be tested with a test case</li>
    <li><span class="bg-validation">Validated Input</span> - has user input with validation</li>
    <li><span class="bg-input">Basic Input</span> - has basic user input</li>
    <li><span class="bg-output">Output Only</span> - has user output but no direct user input</li>
    <li><span class="bg-none">None / Indirect</span> - no user I/O itself, but may call functions which do</li>
</ul>
<p>The buttons on the left allow you to add functions, generate a Python
template, and other actions.</p>
<p>To add a new function call, drag from the edge of one function to another.
They can be reconnected as needed. Double-clicking a call will reverse its
direction.</p>
<p>To remove functions or calls, select them and press the delete key.</p></div>`))}function hb(c,r,u){const g=u.minFunctions??1,w=u.minTestable??0,k=document.createElement("div");k.className=sb,k.innerHTML=`<table><tr class="${Nd}"><td>Functions:</td><td>0</td><td>/</td><td>${g}</td></td></tr><tr class="${Ad}"><td>Testable:</td><td>0</td><td>/</td><td>${w}</td></tr></table><span class="${Cd} value-hidden value-error">Need a main function</span>`,c.getElementsByClassName("func-planner-widgets")[0].appendChild(k);const N=k.getElementsByClassName(Nd)[0],D=k.getElementsByClassName(Ad)[0],E=k.getElementsByClassName(Cd)[0];g<=1&&N.classList.add("value-hidden"),w<=0&&D.classList.add("value-hidden");function U(){const F=Array.from(r.functions.values()),j=F.some(W=>{var tt;return((tt=W.get("name"))==null?void 0:tt.toString())==="main"});E.classList.toggle("value-hidden",j),r.clearModelDataProblem(null,"main"),j||r.recordModelDataProblem("error","main","There must be a main() function."),N.cells[1].textContent=F.length,N.classList.toggle("value-error",F.length<g),r.clearModelDataProblem(null,"functions"),F.length<g&&r.recordModelDataProblem("error","functions",`There must be at least ${g} functions.`);const G=F.filter(W=>W.get("testable")).length;D.cells[1].textContent=G,D.classList.toggle("value-error",G<w),r.clearModelDataProblem(null,"testable"),G<w&&r.recordModelDataProblem("error","testable",`There must be at least ${w} testable functions.`)}r.addFuncAddListener(U),r.addFuncRemoveListener(U),r.addFuncListener("name",U),r.addFuncListener("testable",U),U()}const Ji=()=>new Map,rc=c=>{const r=Ji();return c.forEach((u,g)=>{r.set(g,u)}),r},dn=(c,r,u)=>{let g=c.get(r);return g===void 0&&c.set(r,g=u()),g},cb=(c,r)=>{const u=[];for(const[g,w]of c)u.push(r(w,g));return u},ub=(c,r)=>{for(const[u,g]of c)if(r(g,u))return!0;return!1},oo=()=>new Set,Oh=c=>c[c.length-1],db=(c,r)=>{for(let u=0;u<r.length;u++)c.push(r[u])},zn=Array.from,iu=(c,r)=>{for(let u=0;u<c.length;u++)if(!r(c[u],u,c))return!1;return!0},su=(c,r)=>{for(let u=0;u<c.length;u++)if(r(c[u],u,c))return!0;return!1},fb=(c,r)=>{const u=new Array(c);for(let g=0;g<c;g++)u[g]=r(g,u);return u},qo=Array.isArray;class Mg{constructor(){this._observers=Ji()}on(r,u){return dn(this._observers,r,oo).add(u),u}once(r,u){const g=(...w)=>{this.off(r,g),u(...w)};this.on(r,g)}off(r,u){const g=this._observers.get(r);g!==void 0&&(g.delete(u),g.size===0&&this._observers.delete(r))}emit(r,u){return zn((this._observers.get(r)||Ji()).values()).forEach(g=>g(...u))}destroy(){this._observers=Ji()}}class gb{constructor(){this._observers=Ji()}on(r,u){dn(this._observers,r,oo).add(u)}once(r,u){const g=(...w)=>{this.off(r,g),u(...w)};this.on(r,g)}off(r,u){const g=this._observers.get(r);g!==void 0&&(g.delete(u),g.size===0&&this._observers.delete(r))}emit(r,u){return zn((this._observers.get(r)||Ji()).values()).forEach(g=>g(...u))}destroy(){this._observers=Ji()}}const Hs=Math.floor,Ta=Math.abs,Cg=(c,r)=>c<r?c:r,uo=(c,r)=>c>r?c:r,Ng=c=>c!==0?c<0:1/c<0,Td=1,Dd=2,Rh=4,Ih=8,Rr=32,ln=64,rs=128,Ol=31,ac=63,so=127,mb=2147483647,ll=Number.MAX_SAFE_INTEGER,Ld=Number.MIN_SAFE_INTEGER,pb=Number.isInteger||(c=>typeof c=="number"&&isFinite(c)&&Hs(c)===c),yb=String.fromCharCode,wb=c=>c.toLowerCase(),bb=/^\s*/g,xb=c=>c.replace(bb,""),vb=/([A-Z])/g,Ed=(c,r)=>xb(c.replace(vb,u=>`${r}${wb(u)}`)),kb=c=>{const r=unescape(encodeURIComponent(c)),u=r.length,g=new Uint8Array(u);for(let w=0;w<u;w++)g[w]=r.codePointAt(w);return g},Ir=typeof TextEncoder<"u"?new TextEncoder:null,Sb=c=>Ir.encode(c),Pb=Ir?Sb:kb;let Tr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Tr&&Tr.decode(new Uint8Array).length===1&&(Tr=null);const Mb=(c,r)=>fb(r,()=>c).join("");class ea{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Rl=()=>new ea,Cb=c=>{let r=c.cpos;for(let u=0;u<c.bufs.length;u++)r+=c.bufs[u].length;return r},Xs=c=>{const r=new Uint8Array(Cb(c));let u=0;for(let g=0;g<c.bufs.length;g++){const w=c.bufs[g];r.set(w,u),u+=w.length}return r.set(new Uint8Array(c.cbuf.buffer,0,c.cpos),u),r},Nb=(c,r)=>{const u=c.cbuf.length;u-c.cpos<r&&(c.bufs.push(new Uint8Array(c.cbuf.buffer,0,c.cpos)),c.cbuf=new Uint8Array(uo(u,r)*2),c.cpos=0)},xi=(c,r)=>{const u=c.cbuf.length;c.cpos===u&&(c.bufs.push(c.cbuf),c.cbuf=new Uint8Array(u*2),c.cpos=0),c.cbuf[c.cpos++]=r},lc=xi,Te=(c,r)=>{for(;r>so;)xi(c,rs|so&r),r=Hs(r/128);xi(c,so&r)},nu=(c,r)=>{const u=Ng(r);for(u&&(r=-r),xi(c,(r>ac?rs:0)|(u?ln:0)|ac&r),r=Hs(r/64);r>0;)xi(c,(r>so?rs:0)|so&r),r=Hs(r/128)},hc=new Uint8Array(3e4),Ab=hc.length/3,Tb=(c,r)=>{if(r.length<Ab){const u=Ir.encodeInto(r,hc).written||0;Te(c,u);for(let g=0;g<u;g++)xi(c,hc[g])}else ss(c,Pb(r))},Db=(c,r)=>{const u=unescape(encodeURIComponent(r)),g=u.length;Te(c,g);for(let w=0;w<g;w++)xi(c,u.codePointAt(w))},Vo=Ir&&Ir.encodeInto?Tb:Db,Il=(c,r)=>{const u=c.cbuf.length,g=c.cpos,w=Cg(u-g,r.length),k=r.length-w;c.cbuf.set(r.subarray(0,w),g),c.cpos+=w,k>0&&(c.bufs.push(c.cbuf),c.cbuf=new Uint8Array(uo(u*2,k)),c.cbuf.set(r.subarray(w)),c.cpos=k)},ss=(c,r)=>{Te(c,r.byteLength),Il(c,r)},ou=(c,r)=>{Nb(c,r);const u=new DataView(c.cbuf.buffer,c.cpos,r);return c.cpos+=r,u},Lb=(c,r)=>ou(c,4).setFloat32(0,r,!1),Eb=(c,r)=>ou(c,8).setFloat64(0,r,!1),Fb=(c,r)=>ou(c,8).setBigInt64(0,r,!1),Fd=new DataView(new ArrayBuffer(4)),Ob=c=>(Fd.setFloat32(0,c),Fd.getFloat32(0)===c),Br=(c,r)=>{switch(typeof r){case"string":xi(c,119),Vo(c,r);break;case"number":pb(r)&&Ta(r)<=mb?(xi(c,125),nu(c,r)):Ob(r)?(xi(c,124),Lb(c,r)):(xi(c,123),Eb(c,r));break;case"bigint":xi(c,122),Fb(c,r);break;case"object":if(r===null)xi(c,126);else if(qo(r)){xi(c,117),Te(c,r.length);for(let u=0;u<r.length;u++)Br(c,r[u])}else if(r instanceof Uint8Array)xi(c,116),ss(c,r);else{xi(c,118);const u=Object.keys(r);Te(c,u.length);for(let g=0;g<u.length;g++){const w=u[g];Vo(c,w),Br(c,r[w])}}break;case"boolean":xi(c,r?120:121);break;default:xi(c,127)}};class Od extends ea{constructor(r){super(),this.w=r,this.s=null,this.count=0}write(r){this.s===r?this.count++:(this.count>0&&Te(this,this.count-1),this.count=1,this.w(this,r),this.s=r)}}const Rd=c=>{c.count>0&&(nu(c.encoder,c.count===1?c.s:-c.s),c.count>1&&Te(c.encoder,c.count-2))};class Da{constructor(){this.encoder=new ea,this.s=0,this.count=0}write(r){this.s===r?this.count++:(Rd(this),this.count=1,this.s=r)}toUint8Array(){return Rd(this),Xs(this.encoder)}}const Id=c=>{if(c.count>0){const r=c.diff*2+(c.count===1?0:1);nu(c.encoder,r),c.count>1&&Te(c.encoder,c.count-2)}};class Bh{constructor(){this.encoder=new ea,this.s=0,this.count=0,this.diff=0}write(r){this.diff===r-this.s?(this.s=r,this.count++):(Id(this),this.count=1,this.diff=r-this.s,this.s=r)}toUint8Array(){return Id(this),Xs(this.encoder)}}class Rb{constructor(){this.sarr=[],this.s="",this.lensE=new Da}write(r){this.s+=r,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(r.length)}toUint8Array(){const r=new ea;return this.sarr.push(this.s),this.s="",Vo(r,this.sarr.join("")),Il(r,this.lensE.toUint8Array()),Xs(r)}}const Os=c=>new Error(c),Fs=()=>{throw Os("Method unimplemented")},xs=()=>{throw Os("Unexpected case")},Ag=Os("Unexpected end of array"),Tg=Os("Integer out of Range");class Bl{constructor(r){this.arr=r,this.pos=0}}const rr=c=>new Bl(c),Ib=c=>c.pos!==c.arr.length,Bb=(c,r)=>{const u=new Uint8Array(c.arr.buffer,c.pos+c.arr.byteOffset,r);return c.pos+=r,u},ns=c=>Bb(c,be(c)),Wo=c=>c.arr[c.pos++],be=c=>{let r=0,u=1;const g=c.arr.length;for(;c.pos<g;){const w=c.arr[c.pos++];if(r=r+(w&so)*u,u*=128,w<rs)return r;if(r>ll)throw Tg}throw Ag},ru=c=>{let r=c.arr[c.pos++],u=r&ac,g=64;const w=(r&ln)>0?-1:1;if((r&rs)===0)return w*u;const k=c.arr.length;for(;c.pos<k;){if(r=c.arr[c.pos++],u=u+(r&so)*g,g*=128,r<rs)return w*u;if(u>ll)throw Tg}throw Ag},Vb=c=>{let r=be(c);if(r===0)return"";{let u=String.fromCodePoint(Wo(c));if(--r<100)for(;r--;)u+=String.fromCodePoint(Wo(c));else for(;r>0;){const g=r<1e4?r:1e4,w=c.arr.subarray(c.pos,c.pos+g);c.pos+=g,u+=String.fromCodePoint.apply(null,w),r-=g}return decodeURIComponent(escape(u))}},zb=c=>Tr.decode(ns(c)),zo=Tr?zb:Vb,au=(c,r)=>{const u=new DataView(c.arr.buffer,c.arr.byteOffset+c.pos,r);return c.pos+=r,u},jb=c=>au(c,4).getFloat32(0,!1),Ub=c=>au(c,8).getFloat64(0,!1),Xb=c=>au(c,8).getBigInt64(0,!1),Yb=[c=>{},c=>null,ru,jb,Ub,Xb,c=>!1,c=>!0,zo,c=>{const r=be(c),u={};for(let g=0;g<r;g++){const w=zo(c);u[w]=Vr(c)}return u},c=>{const r=be(c),u=[];for(let g=0;g<r;g++)u.push(Vr(c));return u},ns],Vr=c=>Yb[127-Wo(c)](c);class Bd extends Bl{constructor(r,u){super(r),this.reader=u,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ib(this)?this.count=be(this)+1:this.count=-1),this.count--,this.s}}class La extends Bl{constructor(r){super(r),this.s=0,this.count=0}read(){if(this.count===0){this.s=ru(this);const r=Ng(this.s);this.count=1,r&&(this.s=-this.s,this.count=be(this)+2)}return this.count--,this.s}}class Vh extends Bl{constructor(r){super(r),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const r=ru(this),u=r&1;this.diff=Hs(r/2),this.count=1,u&&(this.count=be(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Kb{constructor(r){this.decoder=new La(r),this.str=zo(this.decoder),this.spos=0}read(){const r=this.spos+this.decoder.read(),u=this.str.slice(this.spos,r);return this.spos=r,u}}const Gb=crypto.getRandomValues.bind(crypto),Dg=()=>Gb(new Uint32Array(1))[0],$b="10000000-1000-4000-8000"+-1e11,Hb=()=>$b.replace(/[018]/g,c=>(c^Dg()&15>>c/4).toString(16)),qb=Date.now,Jo=c=>new Promise(c);Promise.all.bind(Promise);const Vd=c=>c===void 0?null:c;class Wb{constructor(){this.map=new Map}setItem(r,u){this.map.set(r,u)}getItem(r){return this.map.get(r)}}let Lg=new Wb,Jb=!0;try{typeof localStorage<"u"&&localStorage&&(Lg=localStorage,Jb=!1)}catch{}const Zb=Lg,zr=Symbol("Equality"),Eg=(c,r)=>{var u;return c===r||!!((u=c==null?void 0:c[zr])!=null&&u.call(c,r))||!1},Qb=c=>typeof c=="object",_b=Object.assign,tx=Object.keys,ex=(c,r)=>{for(const u in c)r(c[u],u)},hl=c=>tx(c).length,ix=c=>{for(const r in c)return!1;return!0},ia=(c,r)=>{for(const u in c)if(!r(c[u],u))return!1;return!0},lu=(c,r)=>Object.prototype.hasOwnProperty.call(c,r),sx=(c,r)=>c===r||hl(c)===hl(r)&&ia(c,(u,g)=>(u!==void 0||lu(r,g))&&Eg(r[g],u)),nx=Object.freeze,Fg=c=>{for(const r in c){const u=c[r];(typeof u=="object"||typeof u=="function")&&Fg(c[r])}return nx(c)},hu=(c,r,u=0)=>{try{for(;u<c.length;u++)c[u](...r)}finally{u<c.length&&hu(c,r,u+1)}},ox=c=>c,Ea=(c,r)=>{if(c===r)return!0;if(c==null||r==null||c.constructor!==r.constructor&&(c.constructor||Object)!==(r.constructor||Object))return!1;if(c[zr]!=null)return c[zr](r);switch(c.constructor){case ArrayBuffer:c=new Uint8Array(c),r=new Uint8Array(r);case Uint8Array:{if(c.byteLength!==r.byteLength)return!1;for(let u=0;u<c.length;u++)if(c[u]!==r[u])return!1;break}case Set:{if(c.size!==r.size)return!1;for(const u of c)if(!r.has(u))return!1;break}case Map:{if(c.size!==r.size)return!1;for(const u of c.keys())if(!r.has(u)||!Ea(c.get(u),r.get(u)))return!1;break}case void 0:case Object:if(hl(c)!==hl(r))return!1;for(const u in c)if(!lu(c,u)||!Ea(c[u],r[u]))return!1;break;case Array:if(c.length!==r.length)return!1;for(let u=0;u<c.length;u++)if(!Ea(c[u],r[u]))return!1;break;default:return!1}return!0},rx=(c,r)=>r.includes(c);var Og={};const jr=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Vs;const ax=()=>{if(Vs===void 0)if(jr){Vs=Ji();const c=process.argv;let r=null;for(let u=0;u<c.length;u++){const g=c[u];g[0]==="-"?(r!==null&&Vs.set(r,""),r=g):r!==null&&(Vs.set(r,g),r=null)}r!==null&&Vs.set(r,"")}else typeof location=="object"?(Vs=Ji(),(location.search||"?").slice(1).split("&").forEach(c=>{if(c.length!==0){const[r,u]=c.split("=");Vs.set(`--${Ed(r,"-")}`,u),Vs.set(`-${Ed(r,"-")}`,u)}})):Vs=Ji();return Vs},cc=c=>ax().has(c),cl=c=>Vd(jr?Og[c.toUpperCase().replaceAll("-","_")]:Zb.getItem(c)),Rg=c=>cc("--"+c)||cl(c)!==null,lx=Rg("production"),hx=jr&&rx(Og.FORCE_COLOR,["true","1","2"]),cx=hx||!cc("--no-colors")&&!Rg("no-color")&&(!jr||process.stdout.isTTY)&&(!jr||cc("--color")||cl("COLORTERM")!==null||(cl("TERM")||"").includes("color")),ux=c=>new Uint8Array(c),dx=c=>{const r=ux(c.byteLength);return r.set(c),r};class fx{constructor(r,u){this.left=r,this.right=u}}const sn=(c,r)=>new fx(c,r),zd=c=>c.next()>=.5,zh=(c,r,u)=>Hs(c.next()*(u+1-r)+r),Ig=(c,r,u)=>Hs(c.next()*(u+1-r)+r),cu=(c,r,u)=>Ig(c,r,u),gx=c=>yb(cu(c,97,122)),mx=(c,r=0,u=20)=>{const g=cu(c,r,u);let w="";for(let k=0;k<g;k++)w+=gx(c);return w},jh=(c,r)=>r[cu(c,0,r.length-1)],px=Symbol("0schema");class yx{constructor(){this._rerrs=[]}extend(r,u,g,w=null){this._rerrs.push({path:r,expected:u,has:g,message:w})}toString(){const r=[];for(let u=this._rerrs.length-1;u>0;u--){const g=this._rerrs[u];r.push(Mb(" ",(this._rerrs.length-u)*2)+`${g.path!=null?`[${g.path}] `:""}${g.has} doesn't match ${g.expected}. ${g.message}`)}return r.join(`
`)}}const uc=(c,r)=>c===r?!0:c==null||r==null||c.constructor!==r.constructor?!1:c[zr]?Eg(c,r):qo(c)?iu(c,u=>su(r,g=>uc(u,g))):Qb(c)?ia(c,(u,g)=>uc(u,r[g])):!1;class Fi{extends(r){let[u,g]=[this.shape,r.shape];return this.constructor._dilutes&&([g,u]=[u,g]),uc(u,g)}equals(r){return this.constructor===r.constructor&&Ea(this.shape,r.shape)}[px](){return!0}[zr](r){return this.equals(r)}validate(r){return this.check(r)}check(r,u){Fs()}get nullable(){return ar(this,Xl)}get optional(){return new zg(this)}cast(r){return jd(r,this),r}expect(r){return jd(r,this),r}}y(Fi,"_dilutes",!1);class uu extends Fi{constructor(r,u){super(),this.shape=r,this._c=u}check(r,u=void 0){const g=(r==null?void 0:r.constructor)===this.shape&&(this._c==null||this._c(r));return!g&&(u==null||u.extend(null,this.shape.name,r==null?void 0:r.constructor.name,(r==null?void 0:r.constructor)!==this.shape?"Constructor match failed":"Check failed")),g}}const fi=(c,r=null)=>new uu(c,r);fi(uu);class du extends Fi{constructor(r){super(),this.shape=r}check(r,u){const g=this.shape(r);return!g&&(u==null||u.extend(null,"custom prop",r==null?void 0:r.constructor.name,"failed to check custom prop")),g}}const Si=c=>new du(c);fi(du);class Vl extends Fi{constructor(r){super(),this.shape=r}check(r,u){const g=this.shape.some(w=>w===r);return!g&&(u==null||u.extend(null,this.shape.join(" | "),r.toString())),g}}const zl=(...c)=>new Vl(c),Bg=fi(Vl),wx=RegExp.escape||(c=>c.replace(/[().|&,$^[\]]/g,r=>"\\"+r)),Vg=c=>{if(Zo.check(c))return[wx(c)];if(Bg.check(c))return c.shape.map(r=>r+"");if(qg.check(c))return["[+-]?\\d+.?\\d*"];if(Wg.check(c))return[".*"];if(dl.check(c))return c.shape.map(Vg).flat(1);xs()};class bx extends Fi{constructor(r){super(),this.shape=r,this._r=new RegExp("^"+r.map(Vg).map(u=>`(${u.join("|")})`).join("")+"$")}check(r,u){const g=this._r.exec(r)!=null;return!g&&(u==null||u.extend(null,this._r.toString(),r.toString(),"String doesn't match string template.")),g}}fi(bx);const xx=Symbol("optional");class zg extends Fi{constructor(r){super(),this.shape=r}check(r,u){const g=r===void 0||this.shape.check(r);return!g&&(u==null||u.extend(null,"undefined (optional)","()")),g}get[xx](){return!0}}const vx=fi(zg);class kx extends Fi{check(r,u){return u==null||u.extend(null,"never",typeof r),!1}}fi(kx);const Nl=class Nl extends Fi{constructor(r,u=!1){super(),this.shape=r,this._isPartial=u}get partial(){return new Nl(this.shape,!0)}check(r,u){return r==null?(u==null||u.extend(null,"object","null"),!1):ia(this.shape,(g,w)=>{const k=this._isPartial&&!lu(r,w)||g.check(r[w],u);return!k&&(u==null||u.extend(w.toString(),g.toString(),typeof r[w],"Object property does not match")),k})}};y(Nl,"_dilutes",!0);let ul=Nl;const Sx=c=>new ul(c),Px=fi(ul),Mx=Si(c=>c!=null&&(c.constructor===Object||c.constructor==null));class jg extends Fi{constructor(r,u){super(),this.shape={keys:r,values:u}}check(r,u){return r!=null&&ia(r,(g,w)=>{const k=this.shape.keys.check(w,u);return!k&&(u==null||u.extend(w+"","Record",typeof r,k?"Key doesn't match schema":"Value doesn't match value")),k&&this.shape.values.check(g,u)})}}const Ug=(c,r)=>new jg(c,r),Cx=fi(jg);class Xg extends Fi{constructor(r){super(),this.shape=r}check(r,u){return r!=null&&ia(this.shape,(g,w)=>{const k=g.check(r[w],u);return!k&&(u==null||u.extend(w.toString(),"Tuple",typeof g)),k})}}const Nx=(...c)=>new Xg(c);fi(Xg);class Yg extends Fi{constructor(r){super(),this.shape=r.length===1?r[0]:new jl(r)}check(r,u){const g=qo(r)&&iu(r,w=>this.shape.check(w));return!g&&(u==null||u.extend(null,"Array","")),g}}const Kg=(...c)=>new Yg(c),Ax=fi(Yg),Tx=Si(c=>qo(c));class Gg extends Fi{constructor(r,u){super(),this.shape=r,this._c=u}check(r,u){const g=r instanceof this.shape&&(this._c==null||this._c(r));return!g&&(u==null||u.extend(null,this.shape.name,r==null?void 0:r.constructor.name)),g}}const Dx=(c,r=null)=>new Gg(c,r);fi(Gg);const Lx=Dx(Fi);class Ex extends Fi{constructor(r){super(),this.len=r.length-1,this.args=Nx(...r.slice(-1)),this.res=r[this.len]}check(r,u){const g=r.constructor===Function&&r.length<=this.len;return!g&&(u==null||u.extend(null,"function",typeof r)),g}}const Fx=fi(Ex),Ox=Si(c=>typeof c=="function");class Rx extends Fi{constructor(r){super(),this.shape=r}check(r,u){const g=iu(this.shape,w=>w.check(r,u));return!g&&(u==null||u.extend(null,"Intersectinon",typeof r)),g}}fi(Rx,c=>c.shape.length>0);class jl extends Fi{constructor(r){super(),this.shape=r}check(r,u){const g=su(this.shape,w=>w.check(r,u));return u==null||u.extend(null,"Union",typeof r),g}}y(jl,"_dilutes",!0);const ar=(...c)=>c.findIndex(r=>dl.check(r))>=0?ar(...c.map(r=>Ur(r)).map(r=>dl.check(r)?r.shape:[r]).flat(1)):c.length===1?c[0]:new jl(c),dl=fi(jl),$g=()=>!0,fl=Si($g),Ix=fi(du,c=>c.shape===$g),fu=Si(c=>typeof c=="bigint"),Bx=Si(c=>c===fu),Hg=Si(c=>typeof c=="symbol");Si(c=>c===Hg);const jo=Si(c=>typeof c=="number"),qg=Si(c=>c===jo),Zo=Si(c=>typeof c=="string"),Wg=Si(c=>c===Zo),Ul=Si(c=>typeof c=="boolean"),Vx=Si(c=>c===Ul),Jg=zl(void 0);fi(Vl,c=>c.shape.length===1&&c.shape[0]===void 0);zl(void 0);const Xl=zl(null),zx=fi(Vl,c=>c.shape.length===1&&c.shape[0]===null);fi(Uint8Array);fi(uu,c=>c.shape===Uint8Array);const jx=ar(jo,Zo,Xl,Jg,fu,Ul,Hg);(()=>{const c=Kg(fl),r=Ug(Zo,fl),u=ar(jo,Zo,Xl,Ul,c,r);return c.shape=u,r.shape.values=u,u})();const Ur=c=>{if(Lx.check(c))return c;if(Mx.check(c)){const r={};for(const u in c)r[u]=Ur(c[u]);return Sx(r)}else{if(Tx.check(c))return ar(...c.map(Ur));if(jx.check(c))return zl(c);if(Ox.check(c))return fi(c)}xs()},jd=lx?()=>{}:(c,r)=>{const u=new yx;if(!r.check(c,u))throw Os(`Expected value to be of type ${r.constructor.name}.
${u.toString()}`)};class Ux{constructor(r){this.patterns=[],this.$state=r}if(r,u){return this.patterns.push({if:Ur(r),h:u}),this}else(r){return this.if(fl,r)}done(){return(r,u)=>{for(let g=0;g<this.patterns.length;g++){const w=this.patterns[g];if(w.if.check(r))return w.h(r,u)}throw Os("Unhandled pattern")}}}const Xx=c=>new Ux(c),Zg=Xx(fl).if(qg,(c,r)=>zh(r,Ld,ll)).if(Wg,(c,r)=>mx(r)).if(Vx,(c,r)=>zd(r)).if(Bx,(c,r)=>BigInt(zh(r,Ld,ll))).if(dl,(c,r)=>Ao(r,jh(r,c.shape))).if(Px,(c,r)=>{const u={};for(const g in c.shape){let w=c.shape[g];if(vx.check(w)){if(zd(r))continue;w=w.shape}u[g]=Zg(w,r)}return u}).if(Ax,(c,r)=>{const u=[],g=Ig(r,0,42);for(let w=0;w<g;w++)u.push(Ao(r,c.shape));return u}).if(Bg,(c,r)=>jh(r,c.shape)).if(zx,(c,r)=>null).if(Fx,(c,r)=>{const u=Ao(r,c.res);return()=>u}).if(Ix,(c,r)=>Ao(r,jh(r,[jo,Zo,Xl,Jg,fu,Ul,Kg(jo),Ug(ar("a","b","c"),jo)]))).if(Cx,(c,r)=>{const u={},g=zh(r,0,3);for(let w=0;w<g;w++){const k=Ao(r,c.shape.keys),N=Ao(r,c.shape.values);u[k]=N}return u}).done(),Ao=(c,r)=>Zg(Ur(r),c),Yl=typeof document<"u"?document:{};Si(c=>c.nodeType===Hx);typeof DOMParser<"u"&&new DOMParser;Si(c=>c.nodeType===Kx);Si(c=>c.nodeType===Gx);const Yx=c=>cb(c,(r,u)=>`${u}:${r};`).join(""),Kx=Yl.ELEMENT_NODE,Gx=Yl.TEXT_NODE,$x=Yl.DOCUMENT_NODE,Hx=Yl.DOCUMENT_FRAGMENT_NODE;Si(c=>c.nodeType===$x);const fn=Symbol,Qg=fn(),_g=fn(),qx=fn(),Wx=fn(),Jx=fn(),tm=fn(),Zx=fn(),gu=fn(),Qx=fn(),_x=c=>{var w;c.length===1&&((w=c[0])==null?void 0:w.constructor)===Function&&(c=c[0]());const r=[],u=[];let g=0;for(;g<c.length;g++){const k=c[g];if(k===void 0)break;if(k.constructor===String||k.constructor===Number)r.push(k);else if(k.constructor===Object)break}for(g>0&&u.push(r.join(""));g<c.length;g++){const k=c[g];k instanceof Symbol||u.push(k)}return u},tv={[Qg]:sn("font-weight","bold"),[_g]:sn("font-weight","normal"),[qx]:sn("color","blue"),[Jx]:sn("color","green"),[Wx]:sn("color","grey"),[tm]:sn("color","red"),[Zx]:sn("color","purple"),[gu]:sn("color","orange"),[Qx]:sn("color","black")},ev=c=>{var N;c.length===1&&((N=c[0])==null?void 0:N.constructor)===Function&&(c=c[0]());const r=[],u=[],g=Ji();let w=[],k=0;for(;k<c.length;k++){const D=c[k],E=tv[D];if(E!==void 0)g.set(E.left,E.right);else{if(D===void 0)break;if(D.constructor===String||D.constructor===Number){const U=Yx(g);k>0||U.length>0?(r.push("%c"+D),u.push(U)):r.push(D)}else break}}for(k>0&&(w=u,w.unshift(r.join("")));k<c.length;k++){const D=c[k];D instanceof Symbol||w.push(D)}return w},em=cx?ev:_x,iv=(...c)=>{console.log(...em(c)),sm.forEach(r=>r.print(c))},im=(...c)=>{console.warn(...em(c)),c.unshift(gu),sm.forEach(r=>r.print(c))},sm=oo(),nm=c=>({[Symbol.iterator](){return this},next:c}),sv=(c,r)=>nm(()=>{let u;do u=c.next();while(!u.done&&!r(u.value));return u}),Uh=(c,r)=>nm(()=>{const{done:u,value:g}=c.next();return{done:u,value:u?void 0:r(g)}});class mu{constructor(r,u){this.clock=r,this.len=u}}class lr{constructor(){this.clients=new Map}}const Qo=(c,r,u)=>r.clients.forEach((g,w)=>{const k=c.doc.store.clients.get(w);if(k!=null){const N=k[k.length-1],D=N.id.clock+N.length;for(let E=0,U=g[E];E<g.length&&U.clock<D;U=g[++E])gm(c,k,U.clock,U.len,u)}}),nv=(c,r)=>{let u=0,g=c.length-1;for(;u<=g;){const w=Hs((u+g)/2),k=c[w],N=k.clock;if(N<=r){if(r<N+k.len)return w;u=w+1}else g=w-1}return null},sa=(c,r)=>{const u=c.clients.get(r.client);return u!==void 0&&nv(u,r.clock)!==null},pu=c=>{c.clients.forEach(r=>{r.sort((w,k)=>w.clock-k.clock);let u,g;for(u=1,g=1;u<r.length;u++){const w=r[g-1],k=r[u];w.clock+w.len>=k.clock?w.len=uo(w.len,k.clock+k.len-w.clock):(g<u&&(r[g]=k),g++)}r.length=g})},dc=c=>{const r=new lr;for(let u=0;u<c.length;u++)c[u].clients.forEach((g,w)=>{if(!r.clients.has(w)){const k=g.slice();for(let N=u+1;N<c.length;N++)db(k,c[N].clients.get(w)||[]);r.clients.set(w,k)}});return pu(r),r},Xr=(c,r,u,g)=>{dn(c.clients,r,()=>[]).push(new mu(u,g))},ov=()=>new lr,rv=c=>{const r=ov();return c.clients.forEach((u,g)=>{const w=[];for(let k=0;k<u.length;k++){const N=u[k];if(N.deleted){const D=N.id.clock;let E=N.length;if(k+1<u.length)for(let U=u[k+1];k+1<u.length&&U.deleted;U=u[++k+1])E+=U.length;w.push(new mu(D,E))}}w.length>0&&r.clients.set(g,w)}),r},hr=(c,r)=>{Te(c.restEncoder,r.clients.size),zn(r.clients.entries()).sort((u,g)=>g[0]-u[0]).forEach(([u,g])=>{c.resetDsCurVal(),Te(c.restEncoder,u);const w=g.length;Te(c.restEncoder,w);for(let k=0;k<w;k++){const N=g[k];c.writeDsClock(N.clock),c.writeDsLen(N.len)}})},yu=c=>{const r=new lr,u=be(c.restDecoder);for(let g=0;g<u;g++){c.resetDsCurVal();const w=be(c.restDecoder),k=be(c.restDecoder);if(k>0){const N=dn(r.clients,w,()=>[]);for(let D=0;D<k;D++)N.push(new mu(c.readDsClock(),c.readDsLen()))}}return r},Ud=(c,r,u)=>{const g=new lr,w=be(c.restDecoder);for(let k=0;k<w;k++){c.resetDsCurVal();const N=be(c.restDecoder),D=be(c.restDecoder),E=u.clients.get(N)||[],U=yi(u,N);for(let F=0;F<D;F++){const j=c.readDsClock(),G=j+c.readDsLen();if(j<U){U<G&&Xr(g,N,U,G-U);let W=qs(E,j),tt=E[W];for(!tt.deleted&&tt.id.clock<j&&(E.splice(W+1,0,vl(r,tt,j-tt.id.clock)),W++);W<E.length&&(tt=E[W++],tt.id.clock<G);)tt.deleted||(G<tt.id.clock+tt.length&&E.splice(W,0,vl(r,tt,G-tt.id.clock)),tt.delete(r))}else Xr(g,N,j,G-j)}}if(g.clients.size>0){const k=new ro;return Te(k.restEncoder,0),hr(k,g),k.toUint8Array()}return null},om=Dg;class fo extends Mg{constructor({guid:r=Hb(),collectionid:u=null,gc:g=!0,gcFilter:w=()=>!0,meta:k=null,autoLoad:N=!1,shouldLoad:D=!0}={}){super(),this.gc=g,this.gcFilter=w,this.clientID=om(),this.guid=r,this.collectionid=u,this.share=new Map,this.store=new dm,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=D,this.autoLoad=N,this.meta=k,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Jo(U=>{this.on("load",()=>{this.isLoaded=!0,U(this)})});const E=()=>Jo(U=>{const F=j=>{(j===void 0||j===!0)&&(this.off("sync",F),U())};this.on("sync",F)});this.on("sync",U=>{U===!1&&this.isSynced&&(this.whenSynced=E()),this.isSynced=U===void 0||U===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=E()}load(){const r=this._item;r!==null&&!this.shouldLoad&&Xe(r.parent.doc,u=>{u.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(zn(this.subdocs).map(r=>r.guid))}transact(r,u=null){return Xe(this,r,u)}get(r,u=vi){const g=dn(this.share,r,()=>{const k=new u;return k._integrate(this,null),k}),w=g.constructor;if(u!==vi&&w!==u)if(w===vi){const k=new u;k._map=g._map,g._map.forEach(N=>{for(;N!==null;N=N.left)N.parent=k}),k._start=g._start;for(let N=k._start;N!==null;N=N.right)N.parent=k;return k._length=g._length,this.share.set(r,k),k._integrate(this,null),k}else throw new Error(`Type with the name ${r} has already been defined with a different constructor`);return g}getArray(r=""){return this.get(r,Ys)}getText(r=""){return this.get(r,cn)}getMap(r=""){return this.get(r,Ks)}getXmlElement(r=""){return this.get(r,tr)}getXmlFragment(r=""){return this.get(r,ao)}toJSON(){const r={};return this.share.forEach((u,g)=>{r[g]=u.toJSON()}),r}destroy(){this.isDestroyed=!0,zn(this.subdocs).forEach(u=>u.destroy());const r=this._item;if(r!==null){this._item=null;const u=r.content;u.doc=new fo({guid:this.guid,...u.opts,shouldLoad:!1}),u.doc._item=r,Xe(r.parent.doc,g=>{const w=u.doc;r.deleted||g.subdocsAdded.add(w),g.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class rm{constructor(r){this.restDecoder=r}resetDsCurVal(){}readDsClock(){return be(this.restDecoder)}readDsLen(){return be(this.restDecoder)}}class am extends rm{readLeftID(){return xe(be(this.restDecoder),be(this.restDecoder))}readRightID(){return xe(be(this.restDecoder),be(this.restDecoder))}readClient(){return be(this.restDecoder)}readInfo(){return Wo(this.restDecoder)}readString(){return zo(this.restDecoder)}readParentInfo(){return be(this.restDecoder)===1}readTypeRef(){return be(this.restDecoder)}readLen(){return be(this.restDecoder)}readAny(){return Vr(this.restDecoder)}readBuf(){return dx(ns(this.restDecoder))}readJSON(){return JSON.parse(zo(this.restDecoder))}readKey(){return zo(this.restDecoder)}}class av{constructor(r){this.dsCurrVal=0,this.restDecoder=r}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=be(this.restDecoder),this.dsCurrVal}readDsLen(){const r=be(this.restDecoder)+1;return this.dsCurrVal+=r,r}}class _o extends av{constructor(r){super(r),this.keys=[],be(r),this.keyClockDecoder=new Vh(ns(r)),this.clientDecoder=new La(ns(r)),this.leftClockDecoder=new Vh(ns(r)),this.rightClockDecoder=new Vh(ns(r)),this.infoDecoder=new Bd(ns(r),Wo),this.stringDecoder=new Kb(ns(r)),this.parentInfoDecoder=new Bd(ns(r),Wo),this.typeRefDecoder=new La(ns(r)),this.lenDecoder=new La(ns(r))}readLeftID(){return new Uo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Uo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Vr(this.restDecoder)}readBuf(){return ns(this.restDecoder)}readJSON(){return Vr(this.restDecoder)}readKey(){const r=this.keyClockDecoder.read();if(r<this.keys.length)return this.keys[r];{const u=this.stringDecoder.read();return this.keys.push(u),u}}}class lv{constructor(){this.restEncoder=Rl()}toUint8Array(){return Xs(this.restEncoder)}resetDsCurVal(){}writeDsClock(r){Te(this.restEncoder,r)}writeDsLen(r){Te(this.restEncoder,r)}}class na extends lv{writeLeftID(r){Te(this.restEncoder,r.client),Te(this.restEncoder,r.clock)}writeRightID(r){Te(this.restEncoder,r.client),Te(this.restEncoder,r.clock)}writeClient(r){Te(this.restEncoder,r)}writeInfo(r){lc(this.restEncoder,r)}writeString(r){Vo(this.restEncoder,r)}writeParentInfo(r){Te(this.restEncoder,r?1:0)}writeTypeRef(r){Te(this.restEncoder,r)}writeLen(r){Te(this.restEncoder,r)}writeAny(r){Br(this.restEncoder,r)}writeBuf(r){ss(this.restEncoder,r)}writeJSON(r){Vo(this.restEncoder,JSON.stringify(r))}writeKey(r){Vo(this.restEncoder,r)}}class hv{constructor(){this.restEncoder=Rl(),this.dsCurrVal=0}toUint8Array(){return Xs(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(r){const u=r-this.dsCurrVal;this.dsCurrVal=r,Te(this.restEncoder,u)}writeDsLen(r){r===0&&xs(),Te(this.restEncoder,r-1),this.dsCurrVal+=r}}class ro extends hv{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Bh,this.clientEncoder=new Da,this.leftClockEncoder=new Bh,this.rightClockEncoder=new Bh,this.infoEncoder=new Od(lc),this.stringEncoder=new Rb,this.parentInfoEncoder=new Od(lc),this.typeRefEncoder=new Da,this.lenEncoder=new Da}toUint8Array(){const r=Rl();return Te(r,0),ss(r,this.keyClockEncoder.toUint8Array()),ss(r,this.clientEncoder.toUint8Array()),ss(r,this.leftClockEncoder.toUint8Array()),ss(r,this.rightClockEncoder.toUint8Array()),ss(r,Xs(this.infoEncoder)),ss(r,this.stringEncoder.toUint8Array()),ss(r,Xs(this.parentInfoEncoder)),ss(r,this.typeRefEncoder.toUint8Array()),ss(r,this.lenEncoder.toUint8Array()),Il(r,Xs(this.restEncoder)),Xs(r)}writeLeftID(r){this.clientEncoder.write(r.client),this.leftClockEncoder.write(r.clock)}writeRightID(r){this.clientEncoder.write(r.client),this.rightClockEncoder.write(r.clock)}writeClient(r){this.clientEncoder.write(r)}writeInfo(r){this.infoEncoder.write(r)}writeString(r){this.stringEncoder.write(r)}writeParentInfo(r){this.parentInfoEncoder.write(r?1:0)}writeTypeRef(r){this.typeRefEncoder.write(r)}writeLen(r){this.lenEncoder.write(r)}writeAny(r){Br(this.restEncoder,r)}writeBuf(r){ss(this.restEncoder,r)}writeJSON(r){Br(this.restEncoder,r)}writeKey(r){const u=this.keyMap.get(r);u===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(r)):this.keyClockEncoder.write(u)}}const cv=(c,r,u,g)=>{g=uo(g,r[0].id.clock);const w=qs(r,g);Te(c.restEncoder,r.length-w),c.writeClient(u),Te(c.restEncoder,g);const k=r[w];k.write(c,g-k.id.clock);for(let N=w+1;N<r.length;N++)r[N].write(c,0)},wu=(c,r,u)=>{const g=new Map;u.forEach((w,k)=>{yi(r,k)>w&&g.set(k,w)}),bu(r).forEach((w,k)=>{u.has(k)||g.set(k,0)}),Te(c.restEncoder,g.size),zn(g.entries()).sort((w,k)=>k[0]-w[0]).forEach(([w,k])=>{cv(c,r.clients.get(w),w,k)})},uv=(c,r)=>{const u=Ji(),g=be(c.restDecoder);for(let w=0;w<g;w++){const k=be(c.restDecoder),N=new Array(k),D=c.readClient();let E=be(c.restDecoder);u.set(D,{i:0,refs:N});for(let U=0;U<k;U++){const F=c.readInfo();switch(Ol&F){case 0:{const j=c.readLen();N[U]=new ys(xe(D,E),j),E+=j;break}case 10:{const j=be(c.restDecoder);N[U]=new ws(xe(D,E),j),E+=j;break}default:{const j=(F&(ln|rs))===0,G=new We(xe(D,E),null,(F&rs)===rs?c.readLeftID():null,null,(F&ln)===ln?c.readRightID():null,j?c.readParentInfo()?r.get(c.readString()):c.readLeftID():null,j&&(F&Rr)===Rr?c.readString():null,Om(c,F));N[U]=G,E+=G.length}}}}return u},dv=(c,r,u)=>{const g=[];let w=zn(u.keys()).sort((W,tt)=>W-tt);if(w.length===0)return null;const k=()=>{if(w.length===0)return null;let W=u.get(w[w.length-1]);for(;W.refs.length===W.i;)if(w.pop(),w.length>0)W=u.get(w[w.length-1]);else return null;return W};let N=k();if(N===null)return null;const D=new dm,E=new Map,U=(W,tt)=>{const it=E.get(W);(it==null||it>tt)&&E.set(W,tt)};let F=N.refs[N.i++];const j=new Map,G=()=>{for(const W of g){const tt=W.id.client,it=u.get(tt);it?(it.i--,D.clients.set(tt,it.refs.slice(it.i)),u.delete(tt),it.i=0,it.refs=[]):D.clients.set(tt,[W]),w=w.filter(nt=>nt!==tt)}g.length=0};for(;;){if(F.constructor!==ws){const tt=dn(j,F.id.client,()=>yi(r,F.id.client))-F.id.clock;if(tt<0)g.push(F),U(F.id.client,F.id.clock-1),G();else{const it=F.getMissing(c,r);if(it!==null){g.push(F);const nt=u.get(it)||{refs:[],i:0};if(nt.refs.length===nt.i)U(it,yi(r,it)),G();else{F=nt.refs[nt.i++];continue}}else(tt===0||tt<F.length)&&(F.integrate(c,tt),j.set(F.id.client,F.id.clock+F.length))}}if(g.length>0)F=g.pop();else if(N!==null&&N.i<N.refs.length)F=N.refs[N.i++];else{if(N=k(),N===null)break;F=N.refs[N.i++]}}if(D.clients.size>0){const W=new ro;return wu(W,D,new Map),Te(W.restEncoder,0),{missing:E,update:W.toUint8Array()}}return null},fv=(c,r)=>wu(c,r.doc.store,r.beforeState),gv=(c,r,u,g=new _o(c))=>Xe(r,w=>{w.local=!1;let k=!1;const N=w.doc,D=N.store,E=uv(g,N),U=dv(w,D,E),F=D.pendingStructs;if(F){for(const[G,W]of F.missing)if(W<yi(D,G)){k=!0;break}if(U){for(const[G,W]of U.missing){const tt=F.missing.get(G);(tt==null||tt>W)&&F.missing.set(G,W)}F.update=ml([F.update,U.update])}}else D.pendingStructs=U;const j=Ud(g,w,D);if(D.pendingDs){const G=new _o(rr(D.pendingDs));be(G.restDecoder);const W=Ud(G,w,D);j&&W?D.pendingDs=ml([j,W]):D.pendingDs=j||W}else D.pendingDs=j;if(k){const G=D.pendingStructs.update;D.pendingStructs=null,lm(w.doc,G)}},u,!1),lm=(c,r,u,g=_o)=>{const w=rr(r);gv(w,c,u,new g(w))},mv=(c,r,u)=>lm(c,r,u,am),pv=(c,r,u=new Map)=>{wu(c,r.store,u),hr(c,rv(r.store))},yv=(c,r=new Uint8Array([0]),u=new ro)=>{const g=cm(r);pv(u,c,g);const w=[u.toUint8Array()];if(c.store.pendingDs&&w.push(c.store.pendingDs),c.store.pendingStructs&&w.push(Lv(c.store.pendingStructs.update,r)),w.length>1){if(u.constructor===na)return Tv(w.map((k,N)=>N===0?k:Fv(k)));if(u.constructor===ro)return ml(w)}return w[0]},hm=(c,r)=>yv(c,r,new na),wv=c=>{const r=new Map,u=be(c.restDecoder);for(let g=0;g<u;g++){const w=be(c.restDecoder),k=be(c.restDecoder);r.set(w,k)}return r},cm=c=>wv(new rm(rr(c)));class bv{constructor(){this.l=[]}}const Xd=()=>new bv,Yd=(c,r)=>c.l.push(r),Kd=(c,r)=>{const u=c.l,g=u.length;c.l=u.filter(w=>r!==w),g===c.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},um=(c,r,u)=>hu(c.l,[r,u]);class Uo{constructor(r,u){this.client=r,this.clock=u}}const ka=(c,r)=>c===r||c!==null&&r!==null&&c.client===r.client&&c.clock===r.clock,xe=(c,r)=>new Uo(c,r),xv=c=>{for(const[r,u]of c.doc.share.entries())if(u===c)return r;throw xs()},gl=(c,r)=>{for(;r!==null;){if(r.parent===c)return!0;r=r.parent._item}return!1},Eo=(c,r)=>r===void 0?!c.deleted:r.sv.has(c.id.client)&&(r.sv.get(c.id.client)||0)>c.id.clock&&!sa(r.ds,c.id),fc=(c,r)=>{const u=dn(c.meta,fc,oo),g=c.doc.store;u.has(r)||(r.sv.forEach((w,k)=>{w<yi(g,k)&&Hi(c,xe(k,w))}),Qo(c,r.ds,w=>{}),u.add(r))};class dm{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const bu=c=>{const r=new Map;return c.clients.forEach((u,g)=>{const w=u[u.length-1];r.set(g,w.id.clock+w.length)}),r},yi=(c,r)=>{const u=c.clients.get(r);if(u===void 0)return 0;const g=u[u.length-1];return g.id.clock+g.length},fm=(c,r)=>{let u=c.clients.get(r.id.client);if(u===void 0)u=[],c.clients.set(r.id.client,u);else{const g=u[u.length-1];if(g.id.clock+g.length!==r.id.clock)throw xs()}u.push(r)},qs=(c,r)=>{let u=0,g=c.length-1,w=c[g],k=w.id.clock;if(k===r)return g;let N=Hs(r/(k+w.length-1)*g);for(;u<=g;){if(w=c[N],k=w.id.clock,k<=r){if(r<k+w.length)return N;u=N+1}else g=N-1;N=Hs((u+g)/2)}throw xs()},vv=(c,r)=>{const u=c.clients.get(r.client);return u[qs(u,r.clock)]},Fa=vv,gc=(c,r,u)=>{const g=qs(r,u),w=r[g];return w.id.clock<u&&w instanceof We?(r.splice(g+1,0,vl(c,w,u-w.id.clock)),g+1):g},Hi=(c,r)=>{const u=c.doc.store.clients.get(r.client);return u[gc(c,u,r.clock)]},Gd=(c,r,u)=>{const g=r.clients.get(u.client),w=qs(g,u.clock),k=g[w];return u.clock!==k.id.clock+k.length-1&&k.constructor!==ys&&g.splice(w+1,0,vl(c,k,u.clock-k.id.clock+1)),k},kv=(c,r,u)=>{const g=c.clients.get(r.id.client);g[qs(g,r.id.clock)]=u},gm=(c,r,u,g,w)=>{if(g===0)return;const k=u+g;let N=gc(c,r,u),D;do D=r[N++],k<D.id.clock+D.length&&gc(c,r,k),w(D);while(N<r.length&&r[N].id.clock<k)};class Sv{constructor(r,u,g){this.doc=r,this.deleteSet=new lr,this.beforeState=bu(r.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=u,this.meta=new Map,this.local=g,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const $d=(c,r)=>r.deleteSet.clients.size===0&&!ub(r.afterState,(u,g)=>r.beforeState.get(g)!==u)?!1:(pu(r.deleteSet),fv(c,r),hr(c,r.deleteSet),!0),Hd=(c,r,u)=>{const g=r._item;(g===null||g.id.clock<(c.beforeState.get(g.id.client)||0)&&!g.deleted)&&dn(c.changed,r,oo).add(u)},Oa=(c,r)=>{let u=c[r],g=c[r-1],w=r;for(;w>0;u=g,g=c[--w-1]){if(g.deleted===u.deleted&&g.constructor===u.constructor&&g.mergeWith(u)){u instanceof We&&u.parentSub!==null&&u.parent._map.get(u.parentSub)===u&&u.parent._map.set(u.parentSub,g);continue}break}const k=r-w;return k&&c.splice(r+1-k,k),k},Pv=(c,r,u)=>{for(const[g,w]of c.clients.entries()){const k=r.clients.get(g);for(let N=w.length-1;N>=0;N--){const D=w[N],E=D.clock+D.len;for(let U=qs(k,D.clock),F=k[U];U<k.length&&F.id.clock<E;F=k[++U]){const j=k[U];if(D.clock+D.len<=j.id.clock)break;j instanceof We&&j.deleted&&!j.keep&&u(j)&&j.gc(r,!1)}}}},Mv=(c,r)=>{c.clients.forEach((u,g)=>{const w=r.clients.get(g);for(let k=u.length-1;k>=0;k--){const N=u[k],D=Cg(w.length-1,1+qs(w,N.clock+N.len-1));for(let E=D,U=w[E];E>0&&U.id.clock>=N.clock;U=w[E])E-=1+Oa(w,E)}})},mm=(c,r)=>{if(r<c.length){const u=c[r],g=u.doc,w=g.store,k=u.deleteSet,N=u._mergeStructs;try{pu(k),u.afterState=bu(u.doc.store),g.emit("beforeObserverCalls",[u,g]);const D=[];u.changed.forEach((E,U)=>D.push(()=>{(U._item===null||!U._item.deleted)&&U._callObserver(u,E)})),D.push(()=>{u.changedParentTypes.forEach((E,U)=>{U._dEH.l.length>0&&(U._item===null||!U._item.deleted)&&(E=E.filter(F=>F.target._item===null||!F.target._item.deleted),E.forEach(F=>{F.currentTarget=U,F._path=null}),E.sort((F,j)=>F.path.length-j.path.length),um(U._dEH,E,u))})}),D.push(()=>g.emit("afterTransaction",[u,g])),hu(D,[]),u._needFormattingCleanup&&Hv(u)}finally{g.gc&&Pv(k,w,g.gcFilter),Mv(k,w),u.afterState.forEach((F,j)=>{const G=u.beforeState.get(j)||0;if(G!==F){const W=w.clients.get(j),tt=uo(qs(W,G),1);for(let it=W.length-1;it>=tt;)it-=1+Oa(W,it)}});for(let F=N.length-1;F>=0;F--){const{client:j,clock:G}=N[F].id,W=w.clients.get(j),tt=qs(W,G);tt+1<W.length&&Oa(W,tt+1)>1||tt>0&&Oa(W,tt)}if(!u.local&&u.afterState.get(g.clientID)!==u.beforeState.get(g.clientID)&&(iv(gu,Qg,"[yjs] ",_g,tm,"Changed the client-id because another client seems to be using it."),g.clientID=om()),g.emit("afterTransactionCleanup",[u,g]),g._observers.has("update")){const F=new na;$d(F,u)&&g.emit("update",[F.toUint8Array(),u.origin,g,u])}if(g._observers.has("updateV2")){const F=new ro;$d(F,u)&&g.emit("updateV2",[F.toUint8Array(),u.origin,g,u])}const{subdocsAdded:D,subdocsLoaded:E,subdocsRemoved:U}=u;(D.size>0||U.size>0||E.size>0)&&(D.forEach(F=>{F.clientID=g.clientID,F.collectionid==null&&(F.collectionid=g.collectionid),g.subdocs.add(F)}),U.forEach(F=>g.subdocs.delete(F)),g.emit("subdocs",[{loaded:E,added:D,removed:U},g,u]),U.forEach(F=>F.destroy())),c.length<=r+1?(g._transactionCleanups=[],g.emit("afterAllTransactions",[g,c])):mm(c,r+1)}}},Xe=(c,r,u=null,g=!0)=>{const w=c._transactionCleanups;let k=!1,N=null;c._transaction===null&&(k=!0,c._transaction=new Sv(c,u,g),w.push(c._transaction),w.length===1&&c.emit("beforeAllTransactions",[c]),c.emit("beforeTransaction",[c._transaction,c]));try{N=r(c._transaction)}finally{if(k){const D=c._transaction===w[0];c._transaction=null,D&&mm(w,0)}}return N};class Cv{constructor(r,u){this.insertions=u,this.deletions=r,this.meta=new Map}}const qd=(c,r,u)=>{Qo(c,u.deletions,g=>{g instanceof We&&r.scope.some(w=>w===c.doc||gl(w,g))&&Nu(g,!1)})},Wd=(c,r,u)=>{let g=null;const w=c.doc,k=c.scope;Xe(w,D=>{for(;r.length>0&&c.currStackItem===null;){const E=w.store,U=r.pop(),F=new Set,j=[];let G=!1;Qo(D,U.insertions,W=>{if(W instanceof We){if(W.redone!==null){let{item:tt,diff:it}=x1(E,W.id);it>0&&(tt=Hi(D,xe(tt.id.client,tt.id.clock+it))),W=tt}!W.deleted&&k.some(tt=>tt===D.doc||gl(tt,W))&&j.push(W)}}),Qo(D,U.deletions,W=>{W instanceof We&&k.some(tt=>tt===D.doc||gl(tt,W))&&!sa(U.insertions,W.id)&&F.add(W)}),F.forEach(W=>{G=Fm(D,W,F,U.insertions,c.ignoreRemoteMapChanges,c)!==null||G});for(let W=j.length-1;W>=0;W--){const tt=j[W];c.deleteFilter(tt)&&(tt.delete(D),G=!0)}c.currStackItem=G?U:null}D.changed.forEach((E,U)=>{E.has(null)&&U._searchMarker&&(U._searchMarker.length=0)}),g=D},c);const N=c.currStackItem;if(N!=null){const D=g.changedParentTypes;c.emit("stack-item-popped",[{stackItem:N,type:u,changedParentTypes:D,origin:c},c]),c.currStackItem=null}return N};class Nv extends Mg{constructor(r,{captureTimeout:u=500,captureTransaction:g=E=>!0,deleteFilter:w=()=>!0,trackedOrigins:k=new Set([null]),ignoreRemoteMapChanges:N=!1,doc:D=qo(r)?r[0].doc:r instanceof fo?r:r.doc}={}){super(),this.scope=[],this.doc=D,this.addToScope(r),this.deleteFilter=w,k.add(this),this.trackedOrigins=k,this.captureTransaction=g,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=N,this.captureTimeout=u,this.afterTransactionHandler=E=>{if(!this.captureTransaction(E)||!this.scope.some(nt=>E.changedParentTypes.has(nt)||nt===this.doc)||!this.trackedOrigins.has(E.origin)&&(!E.origin||!this.trackedOrigins.has(E.origin.constructor)))return;const U=this.undoing,F=this.redoing,j=U?this.redoStack:this.undoStack;U?this.stopCapturing():F||this.clear(!1,!0);const G=new lr;E.afterState.forEach((nt,L)=>{const _=E.beforeState.get(L)||0,Y=nt-_;Y>0&&Xr(G,L,_,Y)});const W=qb();let tt=!1;if(this.lastChange>0&&W-this.lastChange<this.captureTimeout&&j.length>0&&!U&&!F){const nt=j[j.length-1];nt.deletions=dc([nt.deletions,E.deleteSet]),nt.insertions=dc([nt.insertions,G])}else j.push(new Cv(E.deleteSet,G)),tt=!0;!U&&!F&&(this.lastChange=W),Qo(E,E.deleteSet,nt=>{nt instanceof We&&this.scope.some(L=>L===E.doc||gl(L,nt))&&Nu(nt,!0)});const it=[{stackItem:j[j.length-1],origin:E.origin,type:U?"redo":"undo",changedParentTypes:E.changedParentTypes},this];tt?this.emit("stack-item-added",it):this.emit("stack-item-updated",it)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(r){const u=new Set(this.scope);r=qo(r)?r:[r],r.forEach(g=>{u.has(g)||(u.add(g),(g instanceof vi?g.doc!==this.doc:g!==this.doc)&&im("[yjs#509] Not same Y.Doc"),this.scope.push(g))})}addTrackedOrigin(r){this.trackedOrigins.add(r)}removeTrackedOrigin(r){this.trackedOrigins.delete(r)}clear(r=!0,u=!0){(r&&this.canUndo()||u&&this.canRedo())&&this.doc.transact(g=>{r&&(this.undoStack.forEach(w=>qd(g,this,w)),this.undoStack=[]),u&&(this.redoStack.forEach(w=>qd(g,this,w)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:r,redoStackCleared:u}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let r;try{r=Wd(this,this.undoStack,"undo")}finally{this.undoing=!1}return r}redo(){this.redoing=!0;let r;try{r=Wd(this,this.redoStack,"redo")}finally{this.redoing=!1}return r}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Av(c){const r=be(c.restDecoder);for(let u=0;u<r;u++){const g=be(c.restDecoder),w=c.readClient();let k=be(c.restDecoder);for(let N=0;N<g;N++){const D=c.readInfo();if(D===10){const E=be(c.restDecoder);yield new ws(xe(w,k),E),k+=E}else if((Ol&D)!==0){const E=(D&(ln|rs))===0,U=new We(xe(w,k),null,(D&rs)===rs?c.readLeftID():null,null,(D&ln)===ln?c.readRightID():null,E?c.readParentInfo()?c.readString():c.readLeftID():null,E&&(D&Rr)===Rr?c.readString():null,Om(c,D));yield U,k+=U.length}else{const E=c.readLen();yield new ys(xe(w,k),E),k+=E}}}}class xu{constructor(r,u){this.gen=Av(r),this.curr=null,this.done=!1,this.filterSkips=u,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ws);return this.curr}}class vu{constructor(r){this.currClient=0,this.startClock=0,this.written=0,this.encoder=r,this.clientStructs=[]}}const Tv=c=>ml(c,am,na),Dv=(c,r)=>{if(c.constructor===ys){const{client:u,clock:g}=c.id;return new ys(xe(u,g+r),c.length-r)}else if(c.constructor===ws){const{client:u,clock:g}=c.id;return new ws(xe(u,g+r),c.length-r)}else{const u=c,{client:g,clock:w}=u.id;return new We(xe(g,w+r),null,xe(g,w+r-1),null,u.rightOrigin,u.parent,u.parentSub,u.content.splice(r))}},ml=(c,r=_o,u=ro)=>{if(c.length===1)return c[0];const g=c.map(F=>new r(rr(F)));let w=g.map(F=>new xu(F,!0)),k=null;const N=new u,D=new vu(N);for(;w=w.filter(G=>G.curr!==null),w.sort((G,W)=>{if(G.curr.id.client===W.curr.id.client){const tt=G.curr.id.clock-W.curr.id.clock;return tt===0?G.curr.constructor===W.curr.constructor?0:G.curr.constructor===ws?1:-1:tt}else return W.curr.id.client-G.curr.id.client}),w.length!==0;){const F=w[0],j=F.curr.id.client;if(k!==null){let G=F.curr,W=!1;for(;G!==null&&G.id.clock+G.length<=k.struct.id.clock+k.struct.length&&G.id.client>=k.struct.id.client;)G=F.next(),W=!0;if(G===null||G.id.client!==j||W&&G.id.clock>k.struct.id.clock+k.struct.length)continue;if(j!==k.struct.id.client)Nn(D,k.struct,k.offset),k={struct:G,offset:0},F.next();else if(k.struct.id.clock+k.struct.length<G.id.clock)if(k.struct.constructor===ws)k.struct.length=G.id.clock+G.length-k.struct.id.clock;else{Nn(D,k.struct,k.offset);const tt=G.id.clock-k.struct.id.clock-k.struct.length;k={struct:new ws(xe(j,k.struct.id.clock+k.struct.length),tt),offset:0}}else{const tt=k.struct.id.clock+k.struct.length-G.id.clock;tt>0&&(k.struct.constructor===ws?k.struct.length-=tt:G=Dv(G,tt)),k.struct.mergeWith(G)||(Nn(D,k.struct,k.offset),k={struct:G,offset:0},F.next())}}else k={struct:F.curr,offset:0},F.next();for(let G=F.curr;G!==null&&G.id.client===j&&G.id.clock===k.struct.id.clock+k.struct.length&&G.constructor!==ws;G=F.next())Nn(D,k.struct,k.offset),k={struct:G,offset:0}}k!==null&&(Nn(D,k.struct,k.offset),k=null),ku(D);const E=g.map(F=>yu(F)),U=dc(E);return hr(N,U),N.toUint8Array()},Lv=(c,r,u=_o,g=ro)=>{const w=cm(r),k=new g,N=new vu(k),D=new u(rr(c)),E=new xu(D,!1);for(;E.curr;){const F=E.curr,j=F.id.client,G=w.get(j)||0;if(E.curr.constructor===ws){E.next();continue}if(F.id.clock+F.length>G)for(Nn(N,F,uo(G-F.id.clock,0)),E.next();E.curr&&E.curr.id.client===j;)Nn(N,E.curr,0),E.next();else for(;E.curr&&E.curr.id.client===j&&E.curr.id.clock+E.curr.length<=G;)E.next()}ku(N);const U=yu(D);return hr(k,U),k.toUint8Array()},pm=c=>{c.written>0&&(c.clientStructs.push({written:c.written,restEncoder:Xs(c.encoder.restEncoder)}),c.encoder.restEncoder=Rl(),c.written=0)},Nn=(c,r,u)=>{c.written>0&&c.currClient!==r.id.client&&pm(c),c.written===0&&(c.currClient=r.id.client,c.encoder.writeClient(r.id.client),Te(c.encoder.restEncoder,r.id.clock+u)),r.write(c.encoder,u),c.written++},ku=c=>{pm(c);const r=c.encoder.restEncoder;Te(r,c.clientStructs.length);for(let u=0;u<c.clientStructs.length;u++){const g=c.clientStructs[u];Te(r,g.written),Il(r,g.restEncoder)}},Ev=(c,r,u,g)=>{const w=new u(rr(c)),k=new xu(w,!1),N=new g,D=new vu(N);for(let U=k.curr;U!==null;U=k.next())Nn(D,r(U),0);ku(D);const E=yu(w);return hr(N,E),N.toUint8Array()},Fv=c=>Ev(c,ox,_o,na),Jd="You must not compute changes after the event-handler fired.";class Kl{constructor(r,u){this.target=r,this.currentTarget=r,this.transaction=u,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ov(this.currentTarget,this.target))}deletes(r){return sa(this.transaction.deleteSet,r.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Os(Jd);const r=new Map,u=this.target;this.transaction.changed.get(u).forEach(w=>{if(w!==null){const k=u._map.get(w);let N,D;if(this.adds(k)){let E=k.left;for(;E!==null&&this.adds(E);)E=E.left;if(this.deletes(k))if(E!==null&&this.deletes(E))N="delete",D=Oh(E.content.getContent());else return;else E!==null&&this.deletes(E)?(N="update",D=Oh(E.content.getContent())):(N="add",D=void 0)}else if(this.deletes(k))N="delete",D=Oh(k.content.getContent());else return;r.set(w,{action:N,oldValue:D})}}),this._keys=r}return this._keys}get delta(){return this.changes.delta}adds(r){return r.id.clock>=(this.transaction.beforeState.get(r.id.client)||0)}get changes(){let r=this._changes;if(r===null){if(this.transaction.doc._transactionCleanups.length===0)throw Os(Jd);const u=this.target,g=oo(),w=oo(),k=[];if(r={added:g,deleted:w,delta:k,keys:this.keys},this.transaction.changed.get(u).has(null)){let D=null;const E=()=>{D&&k.push(D)};for(let U=u._start;U!==null;U=U.right)U.deleted?this.deletes(U)&&!this.adds(U)&&((D===null||D.delete===void 0)&&(E(),D={delete:0}),D.delete+=U.length,w.add(U)):this.adds(U)?((D===null||D.insert===void 0)&&(E(),D={insert:[]}),D.insert=D.insert.concat(U.content.getContent()),g.add(U)):((D===null||D.retain===void 0)&&(E(),D={retain:0}),D.retain+=U.length);D!==null&&D.retain===void 0&&E()}this._changes=r}return r}}const Ov=(c,r)=>{const u=[];for(;r._item!==null&&r!==c;){if(r._item.parentSub!==null)u.unshift(r._item.parentSub);else{let g=0,w=r._item.parent._start;for(;w!==r._item&&w!==null;)!w.deleted&&w.countable&&(g+=w.length),w=w.right;u.unshift(g)}r=r._item.parent}return u},Li=()=>{im("Invalid access: Add Yjs type to a document before reading data.")},ym=80;let Su=0;class Rv{constructor(r,u){r.marker=!0,this.p=r,this.index=u,this.timestamp=Su++}}const Iv=c=>{c.timestamp=Su++},wm=(c,r,u)=>{c.p.marker=!1,c.p=r,r.marker=!0,c.index=u,c.timestamp=Su++},Bv=(c,r,u)=>{if(c.length>=ym){const g=c.reduce((w,k)=>w.timestamp<k.timestamp?w:k);return wm(g,r,u),g}else{const g=new Rv(r,u);return c.push(g),g}},Gl=(c,r)=>{if(c._start===null||r===0||c._searchMarker===null)return null;const u=c._searchMarker.length===0?null:c._searchMarker.reduce((k,N)=>Ta(r-k.index)<Ta(r-N.index)?k:N);let g=c._start,w=0;for(u!==null&&(g=u.p,w=u.index,Iv(u));g.right!==null&&w<r;){if(!g.deleted&&g.countable){if(r<w+g.length)break;w+=g.length}g=g.right}for(;g.left!==null&&w>r;)g=g.left,!g.deleted&&g.countable&&(w-=g.length);for(;g.left!==null&&g.left.id.client===g.id.client&&g.left.id.clock+g.left.length===g.id.clock;)g=g.left,!g.deleted&&g.countable&&(w-=g.length);return u!==null&&Ta(u.index-w)<g.parent.length/ym?(wm(u,g,w),u):Bv(c._searchMarker,g,w)},Yr=(c,r,u)=>{for(let g=c.length-1;g>=0;g--){const w=c[g];if(u>0){let k=w.p;for(k.marker=!1;k&&(k.deleted||!k.countable);)k=k.left,k&&!k.deleted&&k.countable&&(w.index-=k.length);if(k===null||k.marker===!0){c.splice(g,1);continue}w.p=k,k.marker=!0}(r<w.index||u>0&&r===w.index)&&(w.index=uo(r,w.index+u))}},$l=(c,r,u)=>{const g=c,w=r.changedParentTypes;for(;dn(w,c,()=>[]).push(u),c._item!==null;)c=c._item.parent;um(g._eH,u,r)};class vi{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xd(),this._dEH=Xd(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(r,u){this.doc=r,this._item=u}_copy(){throw Fs()}clone(){throw Fs()}_write(r){}get _first(){let r=this._start;for(;r!==null&&r.deleted;)r=r.right;return r}_callObserver(r,u){!r.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(r){Yd(this._eH,r)}observeDeep(r){Yd(this._dEH,r)}unobserve(r){Kd(this._eH,r)}unobserveDeep(r){Kd(this._dEH,r)}toJSON(){}}const bm=(c,r,u)=>{c.doc??Li(),r<0&&(r=c._length+r),u<0&&(u=c._length+u);let g=u-r;const w=[];let k=c._start;for(;k!==null&&g>0;){if(k.countable&&!k.deleted){const N=k.content.getContent();if(N.length<=r)r-=N.length;else{for(let D=r;D<N.length&&g>0;D++)w.push(N[D]),g--;r=0}}k=k.right}return w},xm=c=>{c.doc??Li();const r=[];let u=c._start;for(;u!==null;){if(u.countable&&!u.deleted){const g=u.content.getContent();for(let w=0;w<g.length;w++)r.push(g[w])}u=u.right}return r},Kr=(c,r)=>{let u=0,g=c._start;for(c.doc??Li();g!==null;){if(g.countable&&!g.deleted){const w=g.content.getContent();for(let k=0;k<w.length;k++)r(w[k],u++,c)}g=g.right}},vm=(c,r)=>{const u=[];return Kr(c,(g,w)=>{u.push(r(g,w,c))}),u},Vv=c=>{let r=c._start,u=null,g=0;return{[Symbol.iterator](){return this},next:()=>{if(u===null){for(;r!==null&&r.deleted;)r=r.right;if(r===null)return{done:!0,value:void 0};u=r.content.getContent(),g=0,r=r.right}const w=u[g++];return u.length<=g&&(u=null),{done:!1,value:w}}}},km=(c,r)=>{c.doc??Li();const u=Gl(c,r);let g=c._start;for(u!==null&&(g=u.p,r-=u.index);g!==null;g=g.right)if(!g.deleted&&g.countable){if(r<g.length)return g.content.getContent()[r];r-=g.length}},pl=(c,r,u,g)=>{let w=u;const k=c.doc,N=k.clientID,D=k.store,E=u===null?r._start:u.right;let U=[];const F=()=>{U.length>0&&(w=new We(xe(N,yi(D,N)),w,w&&w.lastId,E,E&&E.id,r,null,new lo(U)),w.integrate(c,0),U=[])};g.forEach(j=>{if(j===null)U.push(j);else switch(j.constructor){case Number:case Object:case Boolean:case Array:case String:U.push(j);break;default:switch(F(),j.constructor){case Uint8Array:case ArrayBuffer:w=new We(xe(N,yi(D,N)),w,w&&w.lastId,E,E&&E.id,r,null,new oa(new Uint8Array(j))),w.integrate(c,0);break;case fo:w=new We(xe(N,yi(D,N)),w,w&&w.lastId,E,E&&E.id,r,null,new ra(j)),w.integrate(c,0);break;default:if(j instanceof vi)w=new We(xe(N,yi(D,N)),w,w&&w.lastId,E,E&&E.id,r,null,new gn(j)),w.integrate(c,0);else throw new Error("Unexpected content type in insert operation")}}}),F()},Sm=()=>Os("Length exceeded!"),Pm=(c,r,u,g)=>{if(u>r._length)throw Sm();if(u===0)return r._searchMarker&&Yr(r._searchMarker,u,g.length),pl(c,r,null,g);const w=u,k=Gl(r,u);let N=r._start;for(k!==null&&(N=k.p,u-=k.index,u===0&&(N=N.prev,u+=N&&N.countable&&!N.deleted?N.length:0));N!==null;N=N.right)if(!N.deleted&&N.countable){if(u<=N.length){u<N.length&&Hi(c,xe(N.id.client,N.id.clock+u));break}u-=N.length}return r._searchMarker&&Yr(r._searchMarker,w,g.length),pl(c,r,N,g)},zv=(c,r,u)=>{let w=(r._searchMarker||[]).reduce((k,N)=>N.index>k.index?N:k,{index:0,p:r._start}).p;if(w)for(;w.right;)w=w.right;return pl(c,r,w,u)},Mm=(c,r,u,g)=>{if(g===0)return;const w=u,k=g,N=Gl(r,u);let D=r._start;for(N!==null&&(D=N.p,u-=N.index);D!==null&&u>0;D=D.right)!D.deleted&&D.countable&&(u<D.length&&Hi(c,xe(D.id.client,D.id.clock+u)),u-=D.length);for(;g>0&&D!==null;)D.deleted||(g<D.length&&Hi(c,xe(D.id.client,D.id.clock+g)),D.delete(c),g-=D.length),D=D.right;if(g>0)throw Sm();r._searchMarker&&Yr(r._searchMarker,w,-k+g)},yl=(c,r,u)=>{const g=r._map.get(u);g!==void 0&&g.delete(c)},Pu=(c,r,u,g)=>{const w=r._map.get(u)||null,k=c.doc,N=k.clientID;let D;if(g==null)D=new lo([g]);else switch(g.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:D=new lo([g]);break;case Uint8Array:D=new oa(g);break;case fo:D=new ra(g);break;default:if(g instanceof vi)D=new gn(g);else throw new Error("Unexpected content type")}new We(xe(N,yi(k.store,N)),w,w&&w.lastId,null,null,r,u,D).integrate(c,0)},Mu=(c,r)=>{c.doc??Li();const u=c._map.get(r);return u!==void 0&&!u.deleted?u.content.getContent()[u.length-1]:void 0},Cm=c=>{const r={};return c.doc??Li(),c._map.forEach((u,g)=>{u.deleted||(r[g]=u.content.getContent()[u.length-1])}),r},Nm=(c,r)=>{c.doc??Li();const u=c._map.get(r);return u!==void 0&&!u.deleted},jv=(c,r)=>{const u={};return c._map.forEach((g,w)=>{let k=g;for(;k!==null&&(!r.sv.has(k.id.client)||k.id.clock>=(r.sv.get(k.id.client)||0));)k=k.left;k!==null&&Eo(k,r)&&(u[w]=k.content.getContent()[k.length-1])}),u},Sa=c=>(c.doc??Li(),sv(c._map.entries(),r=>!r[1].deleted));class Uv extends Kl{}class Ys extends vi{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(r){const u=new Ys;return u.push(r),u}_integrate(r,u){super._integrate(r,u),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ys}clone(){const r=new Ys;return r.insert(0,this.toArray().map(u=>u instanceof vi?u.clone():u)),r}get length(){return this.doc??Li(),this._length}_callObserver(r,u){super._callObserver(r,u),$l(this,r,new Uv(this,r))}insert(r,u){this.doc!==null?Xe(this.doc,g=>{Pm(g,this,r,u)}):this._prelimContent.splice(r,0,...u)}push(r){this.doc!==null?Xe(this.doc,u=>{zv(u,this,r)}):this._prelimContent.push(...r)}unshift(r){this.insert(0,r)}delete(r,u=1){this.doc!==null?Xe(this.doc,g=>{Mm(g,this,r,u)}):this._prelimContent.splice(r,u)}get(r){return km(this,r)}toArray(){return xm(this)}slice(r=0,u=this.length){return bm(this,r,u)}toJSON(){return this.map(r=>r instanceof vi?r.toJSON():r)}map(r){return vm(this,r)}forEach(r){Kr(this,r)}[Symbol.iterator](){return Vv(this)}_write(r){r.writeTypeRef(d1)}}const Xv=c=>new Ys;class Yv extends Kl{constructor(r,u,g){super(r,u),this.keysChanged=g}}class Ks extends vi{constructor(r){super(),this._prelimContent=null,r===void 0?this._prelimContent=new Map:this._prelimContent=new Map(r)}_integrate(r,u){super._integrate(r,u),this._prelimContent.forEach((g,w)=>{this.set(w,g)}),this._prelimContent=null}_copy(){return new Ks}clone(){const r=new Ks;return this.forEach((u,g)=>{r.set(g,u instanceof vi?u.clone():u)}),r}_callObserver(r,u){$l(this,r,new Yv(this,r,u))}toJSON(){this.doc??Li();const r={};return this._map.forEach((u,g)=>{if(!u.deleted){const w=u.content.getContent()[u.length-1];r[g]=w instanceof vi?w.toJSON():w}}),r}get size(){return[...Sa(this)].length}keys(){return Uh(Sa(this),r=>r[0])}values(){return Uh(Sa(this),r=>r[1].content.getContent()[r[1].length-1])}entries(){return Uh(Sa(this),r=>[r[0],r[1].content.getContent()[r[1].length-1]])}forEach(r){this.doc??Li(),this._map.forEach((u,g)=>{u.deleted||r(u.content.getContent()[u.length-1],g,this)})}[Symbol.iterator](){return this.entries()}delete(r){this.doc!==null?Xe(this.doc,u=>{yl(u,this,r)}):this._prelimContent.delete(r)}set(r,u){return this.doc!==null?Xe(this.doc,g=>{Pu(g,this,r,u)}):this._prelimContent.set(r,u),u}get(r){return Mu(this,r)}has(r){return Nm(this,r)}clear(){this.doc!==null?Xe(this.doc,r=>{this.forEach(function(u,g,w){yl(r,w,g)})}):this._prelimContent.clear()}_write(r){r.writeTypeRef(f1)}}const Kv=c=>new Ks,Bn=(c,r)=>c===r||typeof c=="object"&&typeof r=="object"&&c&&r&&sx(c,r);class mc{constructor(r,u,g,w){this.left=r,this.right=u,this.index=g,this.currentAttributes=w}forward(){switch(this.right===null&&xs(),this.right.content.constructor){case wi:this.right.deleted||cr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Zd=(c,r,u)=>{for(;r.right!==null&&u>0;){switch(r.right.content.constructor){case wi:r.right.deleted||cr(r.currentAttributes,r.right.content);break;default:r.right.deleted||(u<r.right.length&&Hi(c,xe(r.right.id.client,r.right.id.clock+u)),r.index+=r.right.length,u-=r.right.length);break}r.left=r.right,r.right=r.right.right}return r},Pa=(c,r,u,g)=>{const w=new Map,k=g?Gl(r,u):null;if(k){const N=new mc(k.p.left,k.p,k.index,w);return Zd(c,N,u-k.index)}else{const N=new mc(null,r._start,0,w);return Zd(c,N,u)}},Am=(c,r,u,g)=>{for(;u.right!==null&&(u.right.deleted===!0||u.right.content.constructor===wi&&Bn(g.get(u.right.content.key),u.right.content.value));)u.right.deleted||g.delete(u.right.content.key),u.forward();const w=c.doc,k=w.clientID;g.forEach((N,D)=>{const E=u.left,U=u.right,F=new We(xe(k,yi(w.store,k)),E,E&&E.lastId,U,U&&U.id,r,null,new wi(D,N));F.integrate(c,0),u.right=F,u.forward()})},cr=(c,r)=>{const{key:u,value:g}=r;g===null?c.delete(u):c.set(u,g)},Tm=(c,r)=>{for(;c.right!==null;){if(!(c.right.deleted||c.right.content.constructor===wi&&Bn(r[c.right.content.key]??null,c.right.content.value)))break;c.forward()}},Dm=(c,r,u,g)=>{const w=c.doc,k=w.clientID,N=new Map;for(const D in g){const E=g[D],U=u.currentAttributes.get(D)??null;if(!Bn(U,E)){N.set(D,U);const{left:F,right:j}=u;u.right=new We(xe(k,yi(w.store,k)),F,F&&F.lastId,j,j&&j.id,r,null,new wi(D,E)),u.right.integrate(c,0),u.forward()}}return N},Xh=(c,r,u,g,w)=>{u.currentAttributes.forEach((G,W)=>{w[W]===void 0&&(w[W]=null)});const k=c.doc,N=k.clientID;Tm(u,w);const D=Dm(c,r,u,w),E=g.constructor===String?new Ws(g):g instanceof vi?new gn(g):new mo(g);let{left:U,right:F,index:j}=u;r._searchMarker&&Yr(r._searchMarker,u.index,E.getLength()),F=new We(xe(N,yi(k.store,N)),U,U&&U.lastId,F,F&&F.id,r,null,E),F.integrate(c,0),u.right=F,u.index=j,u.forward(),Am(c,r,u,D)},Qd=(c,r,u,g,w)=>{const k=c.doc,N=k.clientID;Tm(u,w);const D=Dm(c,r,u,w);t:for(;u.right!==null&&(g>0||D.size>0&&(u.right.deleted||u.right.content.constructor===wi));){if(!u.right.deleted)switch(u.right.content.constructor){case wi:{const{key:E,value:U}=u.right.content,F=w[E];if(F!==void 0){if(Bn(F,U))D.delete(E);else{if(g===0)break t;D.set(E,U)}u.right.delete(c)}else u.currentAttributes.set(E,U);break}default:g<u.right.length&&Hi(c,xe(u.right.id.client,u.right.id.clock+g)),g-=u.right.length;break}u.forward()}if(g>0){let E="";for(;g>0;g--)E+=`
`;u.right=new We(xe(N,yi(k.store,N)),u.left,u.left&&u.left.lastId,u.right,u.right&&u.right.id,r,null,new Ws(E)),u.right.integrate(c,0),u.forward()}Am(c,r,u,D)},Lm=(c,r,u,g,w)=>{let k=r;const N=Ji();for(;k&&(!k.countable||k.deleted);){if(!k.deleted&&k.content.constructor===wi){const U=k.content;N.set(U.key,U)}k=k.right}let D=0,E=!1;for(;r!==k;){if(u===r&&(E=!0),!r.deleted){const U=r.content;switch(U.constructor){case wi:{const{key:F,value:j}=U,G=g.get(F)??null;(N.get(F)!==U||G===j)&&(r.delete(c),D++,!E&&(w.get(F)??null)===j&&G!==j&&(G===null?w.delete(F):w.set(F,G))),!E&&!r.deleted&&cr(w,U);break}}}r=r.right}return D},Gv=(c,r)=>{for(;r&&r.right&&(r.right.deleted||!r.right.countable);)r=r.right;const u=new Set;for(;r&&(r.deleted||!r.countable);){if(!r.deleted&&r.content.constructor===wi){const g=r.content.key;u.has(g)?r.delete(c):u.add(g)}r=r.left}},$v=c=>{let r=0;return Xe(c.doc,u=>{let g=c._start,w=c._start,k=Ji();const N=rc(k);for(;w;){if(w.deleted===!1)switch(w.content.constructor){case wi:cr(N,w.content);break;default:r+=Lm(u,g,w,k,N),k=rc(N),g=w;break}w=w.right}}),r},Hv=c=>{const r=new Set,u=c.doc;for(const[g,w]of c.afterState.entries()){const k=c.beforeState.get(g)||0;w!==k&&gm(c,u.store.clients.get(g),k,w,N=>{!N.deleted&&N.content.constructor===wi&&N.constructor!==ys&&r.add(N.parent)})}Xe(u,g=>{Qo(c,c.deleteSet,w=>{if(w instanceof ys||!w.parent._hasFormatting||r.has(w.parent))return;const k=w.parent;w.content.constructor===wi?r.add(k):Gv(g,w)});for(const w of r)$v(w)})},_d=(c,r,u)=>{const g=u,w=rc(r.currentAttributes),k=r.right;for(;u>0&&r.right!==null;){if(r.right.deleted===!1)switch(r.right.content.constructor){case gn:case mo:case Ws:u<r.right.length&&Hi(c,xe(r.right.id.client,r.right.id.clock+u)),u-=r.right.length,r.right.delete(c);break}r.forward()}k&&Lm(c,k,r.right,w,r.currentAttributes);const N=(r.left||r.right).parent;return N._searchMarker&&Yr(N._searchMarker,r.index,-g+u),r};class qv extends Kl{constructor(r,u,g){super(r,u),this.childListChanged=!1,this.keysChanged=new Set,g.forEach(w=>{w===null?this.childListChanged=!0:this.keysChanged.add(w)})}get changes(){if(this._changes===null){const r={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=r}return this._changes}get delta(){if(this._delta===null){const r=this.target.doc,u=[];Xe(r,g=>{const w=new Map,k=new Map;let N=this.target._start,D=null;const E={};let U="",F=0,j=0;const G=()=>{if(D!==null){let W=null;switch(D){case"delete":j>0&&(W={delete:j}),j=0;break;case"insert":(typeof U=="object"||U.length>0)&&(W={insert:U},w.size>0&&(W.attributes={},w.forEach((tt,it)=>{tt!==null&&(W.attributes[it]=tt)}))),U="";break;case"retain":F>0&&(W={retain:F},ix(E)||(W.attributes=_b({},E))),F=0;break}W&&u.push(W),D=null}};for(;N!==null;){switch(N.content.constructor){case gn:case mo:this.adds(N)?this.deletes(N)||(G(),D="insert",U=N.content.getContent()[0],G()):this.deletes(N)?(D!=="delete"&&(G(),D="delete"),j+=1):N.deleted||(D!=="retain"&&(G(),D="retain"),F+=1);break;case Ws:this.adds(N)?this.deletes(N)||(D!=="insert"&&(G(),D="insert"),U+=N.content.str):this.deletes(N)?(D!=="delete"&&(G(),D="delete"),j+=N.length):N.deleted||(D!=="retain"&&(G(),D="retain"),F+=N.length);break;case wi:{const{key:W,value:tt}=N.content;if(this.adds(N)){if(!this.deletes(N)){const it=w.get(W)??null;Bn(it,tt)?tt!==null&&N.delete(g):(D==="retain"&&G(),Bn(tt,k.get(W)??null)?delete E[W]:E[W]=tt)}}else if(this.deletes(N)){k.set(W,tt);const it=w.get(W)??null;Bn(it,tt)||(D==="retain"&&G(),E[W]=it)}else if(!N.deleted){k.set(W,tt);const it=E[W];it!==void 0&&(Bn(it,tt)?it!==null&&N.delete(g):(D==="retain"&&G(),tt===null?delete E[W]:E[W]=tt))}N.deleted||(D==="insert"&&G(),cr(w,N.content));break}}N=N.right}for(G();u.length>0;){const W=u[u.length-1];if(W.retain!==void 0&&W.attributes===void 0)u.pop();else break}}),this._delta=u}return this._delta}}class cn extends vi{constructor(r){super(),this._pending=r!==void 0?[()=>this.insert(0,r)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Li(),this._length}_integrate(r,u){super._integrate(r,u);try{this._pending.forEach(g=>g())}catch(g){console.error(g)}this._pending=null}_copy(){return new cn}clone(){const r=new cn;return r.applyDelta(this.toDelta()),r}_callObserver(r,u){super._callObserver(r,u);const g=new qv(this,r,u);$l(this,r,g),!r.local&&this._hasFormatting&&(r._needFormattingCleanup=!0)}toString(){this.doc??Li();let r="",u=this._start;for(;u!==null;)!u.deleted&&u.countable&&u.content.constructor===Ws&&(r+=u.content.str),u=u.right;return r}toJSON(){return this.toString()}applyDelta(r,{sanitize:u=!0}={}){this.doc!==null?Xe(this.doc,g=>{const w=new mc(null,this._start,0,new Map);for(let k=0;k<r.length;k++){const N=r[k];if(N.insert!==void 0){const D=!u&&typeof N.insert=="string"&&k===r.length-1&&w.right===null&&N.insert.slice(-1)===`
`?N.insert.slice(0,-1):N.insert;(typeof D!="string"||D.length>0)&&Xh(g,this,w,D,N.attributes||{})}else N.retain!==void 0?Qd(g,this,w,N.retain,N.attributes||{}):N.delete!==void 0&&_d(g,w,N.delete)}}):this._pending.push(()=>this.applyDelta(r))}toDelta(r,u,g){this.doc??Li();const w=[],k=new Map,N=this.doc;let D="",E=this._start;function U(){if(D.length>0){const j={};let G=!1;k.forEach((tt,it)=>{G=!0,j[it]=tt});const W={insert:D};G&&(W.attributes=j),w.push(W),D=""}}const F=()=>{for(;E!==null;){if(Eo(E,r)||u!==void 0&&Eo(E,u))switch(E.content.constructor){case Ws:{const j=k.get("ychange");r!==void 0&&!Eo(E,r)?(j===void 0||j.user!==E.id.client||j.type!=="removed")&&(U(),k.set("ychange",g?g("removed",E.id):{type:"removed"})):u!==void 0&&!Eo(E,u)?(j===void 0||j.user!==E.id.client||j.type!=="added")&&(U(),k.set("ychange",g?g("added",E.id):{type:"added"})):j!==void 0&&(U(),k.delete("ychange")),D+=E.content.str;break}case gn:case mo:{U();const j={insert:E.content.getContent()[0]};if(k.size>0){const G={};j.attributes=G,k.forEach((W,tt)=>{G[tt]=W})}w.push(j);break}case wi:Eo(E,r)&&(U(),cr(k,E.content));break}E=E.right}U()};return r||u?Xe(N,j=>{r&&fc(j,r),u&&fc(j,u),F()},"cleanup"):F(),w}insert(r,u,g){if(u.length<=0)return;const w=this.doc;w!==null?Xe(w,k=>{const N=Pa(k,this,r,!g);g||(g={},N.currentAttributes.forEach((D,E)=>{g[E]=D})),Xh(k,this,N,u,g)}):this._pending.push(()=>this.insert(r,u,g))}insertEmbed(r,u,g){const w=this.doc;w!==null?Xe(w,k=>{const N=Pa(k,this,r,!g);Xh(k,this,N,u,g||{})}):this._pending.push(()=>this.insertEmbed(r,u,g||{}))}delete(r,u){if(u===0)return;const g=this.doc;g!==null?Xe(g,w=>{_d(w,Pa(w,this,r,!0),u)}):this._pending.push(()=>this.delete(r,u))}format(r,u,g){if(u===0)return;const w=this.doc;w!==null?Xe(w,k=>{const N=Pa(k,this,r,!1);N.right!==null&&Qd(k,this,N,u,g)}):this._pending.push(()=>this.format(r,u,g))}removeAttribute(r){this.doc!==null?Xe(this.doc,u=>{yl(u,this,r)}):this._pending.push(()=>this.removeAttribute(r))}setAttribute(r,u){this.doc!==null?Xe(this.doc,g=>{Pu(g,this,r,u)}):this._pending.push(()=>this.setAttribute(r,u))}getAttribute(r){return Mu(this,r)}getAttributes(){return Cm(this)}_write(r){r.writeTypeRef(g1)}}const Wv=c=>new cn;class Yh{constructor(r,u=()=>!0){this._filter=u,this._root=r,this._currentNode=r._start,this._firstCall=!0,r.doc??Li()}[Symbol.iterator](){return this}next(){let r=this._currentNode,u=r&&r.content&&r.content.type;if(r!==null&&(!this._firstCall||r.deleted||!this._filter(u)))do if(u=r.content.type,!r.deleted&&(u.constructor===tr||u.constructor===ao)&&u._start!==null)r=u._start;else for(;r!==null;){const g=r.next;if(g!==null){r=g;break}else r.parent===this._root?r=null:r=r.parent._item}while(r!==null&&(r.deleted||!this._filter(r.content.type)));return this._firstCall=!1,r===null?{value:void 0,done:!0}:(this._currentNode=r,{value:r.content.type,done:!1})}}class ao extends vi{constructor(){super(),this._prelimContent=[]}get firstChild(){const r=this._first;return r?r.content.getContent()[0]:null}_integrate(r,u){super._integrate(r,u),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ao}clone(){const r=new ao;return r.insert(0,this.toArray().map(u=>u instanceof vi?u.clone():u)),r}get length(){return this.doc??Li(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(r){return new Yh(this,r)}querySelector(r){r=r.toUpperCase();const g=new Yh(this,w=>w.nodeName&&w.nodeName.toUpperCase()===r).next();return g.done?null:g.value}querySelectorAll(r){return r=r.toUpperCase(),zn(new Yh(this,u=>u.nodeName&&u.nodeName.toUpperCase()===r))}_callObserver(r,u){$l(this,r,new Qv(this,u,r))}toString(){return vm(this,r=>r.toString()).join("")}toJSON(){return this.toString()}toDOM(r=document,u={},g){const w=r.createDocumentFragment();return g!==void 0&&g._createAssociation(w,this),Kr(this,k=>{w.insertBefore(k.toDOM(r,u,g),null)}),w}insert(r,u){this.doc!==null?Xe(this.doc,g=>{Pm(g,this,r,u)}):this._prelimContent.splice(r,0,...u)}insertAfter(r,u){if(this.doc!==null)Xe(this.doc,g=>{const w=r&&r instanceof vi?r._item:r;pl(g,this,w,u)});else{const g=this._prelimContent,w=r===null?0:g.findIndex(k=>k===r)+1;if(w===0&&r!==null)throw Os("Reference item not found");g.splice(w,0,...u)}}delete(r,u=1){this.doc!==null?Xe(this.doc,g=>{Mm(g,this,r,u)}):this._prelimContent.splice(r,u)}toArray(){return xm(this)}push(r){this.insert(this.length,r)}unshift(r){this.insert(0,r)}get(r){return km(this,r)}slice(r=0,u=this.length){return bm(this,r,u)}forEach(r){Kr(this,r)}_write(r){r.writeTypeRef(p1)}}const Jv=c=>new ao;class tr extends ao{constructor(r="UNDEFINED"){super(),this.nodeName=r,this._prelimAttrs=new Map}get nextSibling(){const r=this._item?this._item.next:null;return r?r.content.type:null}get prevSibling(){const r=this._item?this._item.prev:null;return r?r.content.type:null}_integrate(r,u){super._integrate(r,u),this._prelimAttrs.forEach((g,w)=>{this.setAttribute(w,g)}),this._prelimAttrs=null}_copy(){return new tr(this.nodeName)}clone(){const r=new tr(this.nodeName),u=this.getAttributes();return ex(u,(g,w)=>{r.setAttribute(w,g)}),r.insert(0,this.toArray().map(g=>g instanceof vi?g.clone():g)),r}toString(){const r=this.getAttributes(),u=[],g=[];for(const D in r)g.push(D);g.sort();const w=g.length;for(let D=0;D<w;D++){const E=g[D];u.push(E+'="'+r[E]+'"')}const k=this.nodeName.toLocaleLowerCase(),N=u.length>0?" "+u.join(" "):"";return`<${k}${N}>${super.toString()}</${k}>`}removeAttribute(r){this.doc!==null?Xe(this.doc,u=>{yl(u,this,r)}):this._prelimAttrs.delete(r)}setAttribute(r,u){this.doc!==null?Xe(this.doc,g=>{Pu(g,this,r,u)}):this._prelimAttrs.set(r,u)}getAttribute(r){return Mu(this,r)}hasAttribute(r){return Nm(this,r)}getAttributes(r){return r?jv(this,r):Cm(this)}toDOM(r=document,u={},g){const w=r.createElement(this.nodeName),k=this.getAttributes();for(const N in k){const D=k[N];typeof D=="string"&&w.setAttribute(N,D)}return Kr(this,N=>{w.appendChild(N.toDOM(r,u,g))}),g!==void 0&&g._createAssociation(w,this),w}_write(r){r.writeTypeRef(m1),r.writeKey(this.nodeName)}}const Zv=c=>new tr(c.readKey());class Qv extends Kl{constructor(r,u,g){super(r,g),this.childListChanged=!1,this.attributesChanged=new Set,u.forEach(w=>{w===null?this.childListChanged=!0:this.attributesChanged.add(w)})}}class wl extends Ks{constructor(r){super(),this.hookName=r}_copy(){return new wl(this.hookName)}clone(){const r=new wl(this.hookName);return this.forEach((u,g)=>{r.set(g,u)}),r}toDOM(r=document,u={},g){const w=u[this.hookName];let k;return w!==void 0?k=w.createDom(this):k=document.createElement(this.hookName),k.setAttribute("data-yjs-hook",this.hookName),g!==void 0&&g._createAssociation(k,this),k}_write(r){r.writeTypeRef(y1),r.writeKey(this.hookName)}}const _v=c=>new wl(c.readKey());class bl extends cn{get nextSibling(){const r=this._item?this._item.next:null;return r?r.content.type:null}get prevSibling(){const r=this._item?this._item.prev:null;return r?r.content.type:null}_copy(){return new bl}clone(){const r=new bl;return r.applyDelta(this.toDelta()),r}toDOM(r=document,u,g){const w=r.createTextNode(this.toString());return g!==void 0&&g._createAssociation(w,this),w}toString(){return this.toDelta().map(r=>{const u=[];for(const w in r.attributes){const k=[];for(const N in r.attributes[w])k.push({key:N,value:r.attributes[w][N]});k.sort((N,D)=>N.key<D.key?-1:1),u.push({nodeName:w,attrs:k})}u.sort((w,k)=>w.nodeName<k.nodeName?-1:1);let g="";for(let w=0;w<u.length;w++){const k=u[w];g+=`<${k.nodeName}`;for(let N=0;N<k.attrs.length;N++){const D=k.attrs[N];g+=` ${D.key}="${D.value}"`}g+=">"}g+=r.insert;for(let w=u.length-1;w>=0;w--)g+=`</${u[w].nodeName}>`;return g}).join("")}toJSON(){return this.toString()}_write(r){r.writeTypeRef(w1)}}const t1=c=>new bl;class Cu{constructor(r,u){this.id=r,this.length=u}get deleted(){throw Fs()}mergeWith(r){return!1}write(r,u,g){throw Fs()}integrate(r,u){throw Fs()}}const e1=0;class ys extends Cu{get deleted(){return!0}delete(){}mergeWith(r){return this.constructor!==r.constructor?!1:(this.length+=r.length,!0)}integrate(r,u){u>0&&(this.id.clock+=u,this.length-=u),fm(r.doc.store,this)}write(r,u){r.writeInfo(e1),r.writeLen(this.length-u)}getMissing(r,u){return null}}class oa{constructor(r){this.content=r}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new oa(this.content)}splice(r){throw Fs()}mergeWith(r){return!1}integrate(r,u){}delete(r){}gc(r){}write(r,u){r.writeBuf(this.content)}getRef(){return 3}}const i1=c=>new oa(c.readBuf());class Gr{constructor(r){this.len=r}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Gr(this.len)}splice(r){const u=new Gr(this.len-r);return this.len=r,u}mergeWith(r){return this.len+=r.len,!0}integrate(r,u){Xr(r.deleteSet,u.id.client,u.id.clock,this.len),u.markDeleted()}delete(r){}gc(r){}write(r,u){r.writeLen(this.len-u)}getRef(){return 1}}const s1=c=>new Gr(c.readLen()),Em=(c,r)=>new fo({guid:c,...r,shouldLoad:r.shouldLoad||r.autoLoad||!1});class ra{constructor(r){r._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=r;const u={};this.opts=u,r.gc||(u.gc=!1),r.autoLoad&&(u.autoLoad=!0),r.meta!==null&&(u.meta=r.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ra(Em(this.doc.guid,this.opts))}splice(r){throw Fs()}mergeWith(r){return!1}integrate(r,u){this.doc._item=u,r.subdocsAdded.add(this.doc),this.doc.shouldLoad&&r.subdocsLoaded.add(this.doc)}delete(r){r.subdocsAdded.has(this.doc)?r.subdocsAdded.delete(this.doc):r.subdocsRemoved.add(this.doc)}gc(r){}write(r,u){r.writeString(this.doc.guid),r.writeAny(this.opts)}getRef(){return 9}}const n1=c=>new ra(Em(c.readString(),c.readAny()));class mo{constructor(r){this.embed=r}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new mo(this.embed)}splice(r){throw Fs()}mergeWith(r){return!1}integrate(r,u){}delete(r){}gc(r){}write(r,u){r.writeJSON(this.embed)}getRef(){return 5}}const o1=c=>new mo(c.readJSON());class wi{constructor(r,u){this.key=r,this.value=u}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new wi(this.key,this.value)}splice(r){throw Fs()}mergeWith(r){return!1}integrate(r,u){const g=u.parent;g._searchMarker=null,g._hasFormatting=!0}delete(r){}gc(r){}write(r,u){r.writeKey(this.key),r.writeJSON(this.value)}getRef(){return 6}}const r1=c=>new wi(c.readKey(),c.readJSON());class xl{constructor(r){this.arr=r}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xl(this.arr)}splice(r){const u=new xl(this.arr.slice(r));return this.arr=this.arr.slice(0,r),u}mergeWith(r){return this.arr=this.arr.concat(r.arr),!0}integrate(r,u){}delete(r){}gc(r){}write(r,u){const g=this.arr.length;r.writeLen(g-u);for(let w=u;w<g;w++){const k=this.arr[w];r.writeString(k===void 0?"undefined":JSON.stringify(k))}}getRef(){return 2}}const a1=c=>{const r=c.readLen(),u=[];for(let g=0;g<r;g++){const w=c.readString();w==="undefined"?u.push(void 0):u.push(JSON.parse(w))}return new xl(u)},l1=cl("node_env")==="development";class lo{constructor(r){this.arr=r,l1&&Fg(r)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new lo(this.arr)}splice(r){const u=new lo(this.arr.slice(r));return this.arr=this.arr.slice(0,r),u}mergeWith(r){return this.arr=this.arr.concat(r.arr),!0}integrate(r,u){}delete(r){}gc(r){}write(r,u){const g=this.arr.length;r.writeLen(g-u);for(let w=u;w<g;w++){const k=this.arr[w];r.writeAny(k)}}getRef(){return 8}}const h1=c=>{const r=c.readLen(),u=[];for(let g=0;g<r;g++)u.push(c.readAny());return new lo(u)};class Ws{constructor(r){this.str=r}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ws(this.str)}splice(r){const u=new Ws(this.str.slice(r));this.str=this.str.slice(0,r);const g=this.str.charCodeAt(r-1);return g>=55296&&g<=56319&&(this.str=this.str.slice(0,r-1)+"",u.str=""+u.str.slice(1)),u}mergeWith(r){return this.str+=r.str,!0}integrate(r,u){}delete(r){}gc(r){}write(r,u){r.writeString(u===0?this.str:this.str.slice(u))}getRef(){return 4}}const c1=c=>new Ws(c.readString()),u1=[Xv,Kv,Wv,Zv,Jv,_v,t1],d1=0,f1=1,g1=2,m1=3,p1=4,y1=5,w1=6;class gn{constructor(r){this.type=r}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gn(this.type._copy())}splice(r){throw Fs()}mergeWith(r){return!1}integrate(r,u){this.type._integrate(r.doc,u)}delete(r){let u=this.type._start;for(;u!==null;)u.deleted?u.id.clock<(r.beforeState.get(u.id.client)||0)&&r._mergeStructs.push(u):u.delete(r),u=u.right;this.type._map.forEach(g=>{g.deleted?g.id.clock<(r.beforeState.get(g.id.client)||0)&&r._mergeStructs.push(g):g.delete(r)}),r.changed.delete(this.type)}gc(r){let u=this.type._start;for(;u!==null;)u.gc(r,!0),u=u.right;this.type._start=null,this.type._map.forEach(g=>{for(;g!==null;)g.gc(r,!0),g=g.left}),this.type._map=new Map}write(r,u){this.type._write(r)}getRef(){return 7}}const b1=c=>new gn(u1[c.readTypeRef()](c)),x1=(c,r)=>{let u=r,g=0,w;do g>0&&(u=xe(u.client,u.clock+g)),w=Fa(c,u),g=u.clock-w.id.clock,u=w.redone;while(u!==null&&w instanceof We);return{item:w,diff:g}},Nu=(c,r)=>{for(;c!==null&&c.keep!==r;)c.keep=r,c=c.parent._item},vl=(c,r,u)=>{const{client:g,clock:w}=r.id,k=new We(xe(g,w+u),r,xe(g,w+u-1),r.right,r.rightOrigin,r.parent,r.parentSub,r.content.splice(u));return r.deleted&&k.markDeleted(),r.keep&&(k.keep=!0),r.redone!==null&&(k.redone=xe(r.redone.client,r.redone.clock+u)),r.right=k,k.right!==null&&(k.right.left=k),c._mergeStructs.push(k),k.parentSub!==null&&k.right===null&&k.parent._map.set(k.parentSub,k),r.length=u,k},tf=(c,r)=>su(c,u=>sa(u.deletions,r)),Fm=(c,r,u,g,w,k)=>{const N=c.doc,D=N.store,E=N.clientID,U=r.redone;if(U!==null)return Hi(c,U);let F=r.parent._item,j=null,G;if(F!==null&&F.deleted===!0){if(F.redone===null&&(!u.has(F)||Fm(c,F,u,g,w,k)===null))return null;for(;F.redone!==null;)F=Hi(c,F.redone)}const W=F===null?r.parent:F.content.type;if(r.parentSub===null){for(j=r.left,G=r;j!==null;){let L=j;for(;L!==null&&L.parent._item!==F;)L=L.redone===null?null:Hi(c,L.redone);if(L!==null&&L.parent._item===F){j=L;break}j=j.left}for(;G!==null;){let L=G;for(;L!==null&&L.parent._item!==F;)L=L.redone===null?null:Hi(c,L.redone);if(L!==null&&L.parent._item===F){G=L;break}G=G.right}}else if(G=null,r.right&&!w){for(j=r;j!==null&&j.right!==null&&(j.right.redone||sa(g,j.right.id)||tf(k.undoStack,j.right.id)||tf(k.redoStack,j.right.id));)for(j=j.right;j.redone;)j=Hi(c,j.redone);if(j&&j.right!==null)return null}else j=W._map.get(r.parentSub)||null;const tt=yi(D,E),it=xe(E,tt),nt=new We(it,j,j&&j.lastId,G,G&&G.id,W,r.parentSub,r.content.copy());return r.redone=it,Nu(nt,!0),nt.integrate(c,0),nt};class We extends Cu{constructor(r,u,g,w,k,N,D,E){super(r,E.getLength()),this.origin=g,this.left=u,this.right=w,this.rightOrigin=k,this.parent=N,this.parentSub=D,this.redone=null,this.content=E,this.info=this.content.isCountable()?Dd:0}set marker(r){(this.info&Ih)>0!==r&&(this.info^=Ih)}get marker(){return(this.info&Ih)>0}get keep(){return(this.info&Td)>0}set keep(r){this.keep!==r&&(this.info^=Td)}get countable(){return(this.info&Dd)>0}get deleted(){return(this.info&Rh)>0}set deleted(r){this.deleted!==r&&(this.info^=Rh)}markDeleted(){this.info|=Rh}getMissing(r,u){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=yi(u,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=yi(u,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Uo&&this.id.client!==this.parent.client&&this.parent.clock>=yi(u,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Gd(r,u,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Hi(r,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ys||this.right&&this.right.constructor===ys)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===We?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===We&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Uo){const g=Fa(u,this.parent);g.constructor===ys?this.parent=null:this.parent=g.content.type}return null}integrate(r,u){if(u>0&&(this.id.clock+=u,this.left=Gd(r,r.doc.store,xe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(u),this.length-=u),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let g=this.left,w;if(g!==null)w=g.right;else if(this.parentSub!==null)for(w=this.parent._map.get(this.parentSub)||null;w!==null&&w.left!==null;)w=w.left;else w=this.parent._start;const k=new Set,N=new Set;for(;w!==null&&w!==this.right;){if(N.add(w),k.add(w),ka(this.origin,w.origin)){if(w.id.client<this.id.client)g=w,k.clear();else if(ka(this.rightOrigin,w.rightOrigin))break}else if(w.origin!==null&&N.has(Fa(r.doc.store,w.origin)))k.has(Fa(r.doc.store,w.origin))||(g=w,k.clear());else break;w=w.right}this.left=g}if(this.left!==null){const g=this.left.right;this.right=g,this.left.right=this}else{let g;if(this.parentSub!==null)for(g=this.parent._map.get(this.parentSub)||null;g!==null&&g.left!==null;)g=g.left;else g=this.parent._start,this.parent._start=this;this.right=g}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(r)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),fm(r.doc.store,this),this.content.integrate(r,this),Hd(r,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(r)}else new ys(this.id,this.length).integrate(r,0)}get next(){let r=this.right;for(;r!==null&&r.deleted;)r=r.right;return r}get prev(){let r=this.left;for(;r!==null&&r.deleted;)r=r.left;return r}get lastId(){return this.length===1?this.id:xe(this.id.client,this.id.clock+this.length-1)}mergeWith(r){if(this.constructor===r.constructor&&ka(r.origin,this.lastId)&&this.right===r&&ka(this.rightOrigin,r.rightOrigin)&&this.id.client===r.id.client&&this.id.clock+this.length===r.id.clock&&this.deleted===r.deleted&&this.redone===null&&r.redone===null&&this.content.constructor===r.content.constructor&&this.content.mergeWith(r.content)){const u=this.parent._searchMarker;return u&&u.forEach(g=>{g.p===r&&(g.p=this,!this.deleted&&this.countable&&(g.index-=this.length))}),r.keep&&(this.keep=!0),this.right=r.right,this.right!==null&&(this.right.left=this),this.length+=r.length,!0}return!1}delete(r){if(!this.deleted){const u=this.parent;this.countable&&this.parentSub===null&&(u._length-=this.length),this.markDeleted(),Xr(r.deleteSet,this.id.client,this.id.clock,this.length),Hd(r,u,this.parentSub),this.content.delete(r)}}gc(r,u){if(!this.deleted)throw xs();this.content.gc(r),u?kv(r,this,new ys(this.id,this.length)):this.content=new Gr(this.length)}write(r,u){const g=u>0?xe(this.id.client,this.id.clock+u-1):this.origin,w=this.rightOrigin,k=this.parentSub,N=this.content.getRef()&Ol|(g===null?0:rs)|(w===null?0:ln)|(k===null?0:Rr);if(r.writeInfo(N),g!==null&&r.writeLeftID(g),w!==null&&r.writeRightID(w),g===null&&w===null){const D=this.parent;if(D._item!==void 0){const E=D._item;if(E===null){const U=xv(D);r.writeParentInfo(!0),r.writeString(U)}else r.writeParentInfo(!1),r.writeLeftID(E.id)}else D.constructor===String?(r.writeParentInfo(!0),r.writeString(D)):D.constructor===Uo?(r.writeParentInfo(!1),r.writeLeftID(D)):xs();k!==null&&r.writeString(k)}this.content.write(r,u)}}const Om=(c,r)=>v1[r&Ol](c),v1=[()=>{xs()},s1,a1,i1,c1,o1,r1,b1,h1,n1,()=>{xs()}],k1=10;class ws extends Cu{get deleted(){return!0}delete(){}mergeWith(r){return this.constructor!==r.constructor?!1:(this.length+=r.length,!0)}integrate(r,u){xs()}write(r,u){r.writeInfo(k1),Te(r.restEncoder,this.length-u)}getMissing(r,u){return null}}const Rm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Im="__ $YJS$ __";Rm[Im]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Rm[Im]=!0;const po=c=>Jo((r,u)=>{c.onerror=g=>u(new Error(g.target.error)),c.onsuccess=g=>r(g.target.result)}),S1=(c,r)=>Jo((u,g)=>{const w=indexedDB.open(c);w.onupgradeneeded=k=>r(k.target.result),w.onerror=k=>g(Os(k.target.error)),w.onsuccess=k=>{const N=k.target.result;N.onversionchange=()=>{N.close()},u(N)}}),P1=c=>po(indexedDB.deleteDatabase(c)),M1=(c,r)=>r.forEach(u=>c.createObjectStore.apply(c,u)),vr=(c,r,u="readwrite")=>{const g=c.transaction(r,u);return r.map(w=>F1(g,w))},Bm=(c,r)=>po(c.count(r)),C1=(c,r)=>po(c.get(r)),Vm=(c,r)=>po(c.delete(r)),N1=(c,r,u)=>po(c.put(r,u)),pc=(c,r)=>po(c.add(r)),A1=(c,r,u)=>po(c.getAll(r,u)),T1=(c,r,u)=>{let g=null;return E1(c,r,w=>(g=w,!1),u).then(()=>g)},D1=(c,r=null)=>T1(c,r,"prev"),L1=(c,r)=>Jo((u,g)=>{c.onerror=g,c.onsuccess=async w=>{const k=w.target.result;if(k===null||await r(k)===!1)return u();k.continue()}}),E1=(c,r,u,g="next")=>L1(c.openKeyCursor(r,g),w=>u(w.key)),F1=(c,r)=>c.objectStore(r),O1=(c,r)=>IDBKeyRange.upperBound(c,r),R1=(c,r)=>IDBKeyRange.lowerBound(c,r),Kh="custom",zm="updates",jm=500,Um=(c,r=()=>{},u=()=>{})=>{const[g]=vr(c.db,[zm]);return A1(g,R1(c._dbref,!1)).then(w=>{c._destroyed||(r(g),Xe(c.doc,()=>{w.forEach(k=>mv(c.doc,k))},c,!1),u(g))}).then(()=>D1(g).then(w=>{c._dbref=w+1})).then(()=>Bm(g).then(w=>{c._dbsize=w})).then(()=>g)},I1=(c,r=!0)=>Um(c).then(u=>{(r||c._dbsize>=jm)&&pc(u,hm(c.doc)).then(()=>Vm(u,O1(c._dbref,!0))).then(()=>Bm(u).then(g=>{c._dbsize=g}))});class B1 extends gb{constructor(r,u){super(),this.doc=u,this.name=r,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=S1(r,g=>M1(g,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Jo(g=>this.on("synced",()=>g(this))),this._db.then(g=>{this.db=g,Um(this,N=>pc(N,hm(u)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(g,w)=>{if(this.db&&w!==this){const[k]=vr(this.db,[zm]);pc(k,g),++this._dbsize>=jm&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{I1(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},u.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),u.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(r=>{r.close()})}clearData(){return this.destroy().then(()=>{P1(this.name)})}get(r){return this._db.then(u=>{const[g]=vr(u,[Kh],"readonly");return C1(g,r)})}set(r,u){return this._db.then(g=>{const[w]=vr(g,[Kh]);return N1(w,u,r)})}del(r){return this._db.then(u=>{const[g]=vr(u,[Kh]);return Vm(g,r)})}}var ef=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xm(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Gh,sf;function V1(){if(sf)return Gh;sf=1;var c=-1,r=1,u=0;function g(Z,Pt,et,Dt,Rt){if(Z===Pt)return Z?[[u,Z]]:[];if(et!=null){var bt=Yt(Z,Pt,et);if(bt)return bt}var Et=D(Z,Pt),Bt=Z.substring(0,Et);Z=Z.substring(Et),Pt=Pt.substring(Et),Et=U(Z,Pt);var Gt=Z.substring(Z.length-Et);Z=Z.substring(0,Z.length-Et),Pt=Pt.substring(0,Pt.length-Et);var Zt=w(Z,Pt);return Bt&&Zt.unshift([u,Bt]),Gt&&Zt.push([u,Gt]),_(Zt,Rt),Dt&&j(Zt),Zt}function w(Z,Pt){var et;if(!Z)return[[r,Pt]];if(!Pt)return[[c,Z]];var Dt=Z.length>Pt.length?Z:Pt,Rt=Z.length>Pt.length?Pt:Z,bt=Dt.indexOf(Rt);if(bt!==-1)return et=[[r,Dt.substring(0,bt)],[u,Rt],[r,Dt.substring(bt+Rt.length)]],Z.length>Pt.length&&(et[0][0]=et[2][0]=c),et;if(Rt.length===1)return[[c,Z],[r,Pt]];var Et=F(Z,Pt);if(Et){var Bt=Et[0],Gt=Et[1],Zt=Et[2],he=Et[3],ie=Et[4],ge=g(Bt,Zt),ae=g(Gt,he);return ge.concat([[u,ie]],ae)}return k(Z,Pt)}function k(Z,Pt){for(var et=Z.length,Dt=Pt.length,Rt=Math.ceil((et+Dt)/2),bt=Rt,Et=2*Rt,Bt=new Array(Et),Gt=new Array(Et),Zt=0;Zt<Et;Zt++)Bt[Zt]=-1,Gt[Zt]=-1;Bt[bt+1]=0,Gt[bt+1]=0;for(var he=et-Dt,ie=he%2!==0,ge=0,ae=0,Ce=0,Be=0,Re=0;Re<Rt;Re++){for(var ye=-Re+ge;ye<=Re-ae;ye+=2){var Ee=bt+ye,ve;ye===-Re||ye!==Re&&Bt[Ee-1]<Bt[Ee+1]?ve=Bt[Ee+1]:ve=Bt[Ee-1]+1;for(var De=ve-ye;ve<et&&De<Dt&&Z.charAt(ve)===Pt.charAt(De);)ve++,De++;if(Bt[Ee]=ve,ve>et)ae+=2;else if(De>Dt)ge+=2;else if(ie){var Ve=bt+he-ye;if(Ve>=0&&Ve<Et&&Gt[Ve]!==-1){var Ie=et-Gt[Ve];if(ve>=Ie)return N(Z,Pt,ve,De)}}}for(var Pi=-Re+Ce;Pi<=Re-Be;Pi+=2){var Ve=bt+Pi,Ie;Pi===-Re||Pi!==Re&&Gt[Ve-1]<Gt[Ve+1]?Ie=Gt[Ve+1]:Ie=Gt[Ve-1]+1;for(var Ci=Ie-Pi;Ie<et&&Ci<Dt&&Z.charAt(et-Ie-1)===Pt.charAt(Dt-Ci-1);)Ie++,Ci++;if(Gt[Ve]=Ie,Ie>et)Be+=2;else if(Ci>Dt)Ce+=2;else if(!ie){var Ee=bt+he-Pi;if(Ee>=0&&Ee<Et&&Bt[Ee]!==-1){var ve=Bt[Ee],De=bt+ve-Ee;if(Ie=et-Ie,ve>=Ie)return N(Z,Pt,ve,De)}}}}return[[c,Z],[r,Pt]]}function N(Z,Pt,et,Dt){var Rt=Z.substring(0,et),bt=Pt.substring(0,Dt),Et=Z.substring(et),Bt=Pt.substring(Dt),Gt=g(Rt,bt),Zt=g(Et,Bt);return Gt.concat(Zt)}function D(Z,Pt){if(!Z||!Pt||Z.charAt(0)!==Pt.charAt(0))return 0;for(var et=0,Dt=Math.min(Z.length,Pt.length),Rt=Dt,bt=0;et<Rt;)Z.substring(bt,Rt)==Pt.substring(bt,Rt)?(et=Rt,bt=et):Dt=Rt,Rt=Math.floor((Dt-et)/2+et);return Y(Z.charCodeAt(Rt-1))&&Rt--,Rt}function E(Z,Pt){var et=Z.length,Dt=Pt.length;if(et==0||Dt==0)return 0;et>Dt?Z=Z.substring(et-Dt):et<Dt&&(Pt=Pt.substring(0,et));var Rt=Math.min(et,Dt);if(Z==Pt)return Rt;for(var bt=0,Et=1;;){var Bt=Z.substring(Rt-Et),Gt=Pt.indexOf(Bt);if(Gt==-1)return bt;Et+=Gt,(Gt==0||Z.substring(Rt-Et)==Pt.substring(0,Et))&&(bt=Et,Et++)}}function U(Z,Pt){if(!Z||!Pt||Z.slice(-1)!==Pt.slice(-1))return 0;for(var et=0,Dt=Math.min(Z.length,Pt.length),Rt=Dt,bt=0;et<Rt;)Z.substring(Z.length-Rt,Z.length-bt)==Pt.substring(Pt.length-Rt,Pt.length-bt)?(et=Rt,bt=et):Dt=Rt,Rt=Math.floor((Dt-et)/2+et);return ct(Z.charCodeAt(Z.length-Rt))&&Rt--,Rt}function F(Z,Pt){var et=Z.length>Pt.length?Z:Pt,Dt=Z.length>Pt.length?Pt:Z;if(et.length<4||Dt.length*2<et.length)return null;function Rt(ae,Ce,Be){for(var Re=ae.substring(Be,Be+Math.floor(ae.length/4)),ye=-1,Ee="",ve,De,Ve,Ie;(ye=Ce.indexOf(Re,ye+1))!==-1;){var Pi=D(ae.substring(Be),Ce.substring(ye)),Ci=U(ae.substring(0,Be),Ce.substring(0,ye));Ee.length<Ci+Pi&&(Ee=Ce.substring(ye-Ci,ye)+Ce.substring(ye,ye+Pi),ve=ae.substring(0,Be-Ci),De=ae.substring(Be+Pi),Ve=Ce.substring(0,ye-Ci),Ie=Ce.substring(ye+Pi))}return Ee.length*2>=ae.length?[ve,De,Ve,Ie,Ee]:null}var bt=Rt(et,Dt,Math.ceil(et.length/4)),Et=Rt(et,Dt,Math.ceil(et.length/2)),Bt;if(!bt&&!Et)return null;Et?bt?Bt=bt[4].length>Et[4].length?bt:Et:Bt=Et:Bt=bt;var Gt,Zt,he,ie;Z.length>Pt.length?(Gt=Bt[0],Zt=Bt[1],he=Bt[2],ie=Bt[3]):(he=Bt[0],ie=Bt[1],Gt=Bt[2],Zt=Bt[3]);var ge=Bt[4];return[Gt,Zt,he,ie,ge]}function j(Z){for(var Pt=!1,et=[],Dt=0,Rt=null,bt=0,Et=0,Bt=0,Gt=0,Zt=0;bt<Z.length;)Z[bt][0]==u?(et[Dt++]=bt,Et=Gt,Bt=Zt,Gt=0,Zt=0,Rt=Z[bt][1]):(Z[bt][0]==r?Gt+=Z[bt][1].length:Zt+=Z[bt][1].length,Rt&&Rt.length<=Math.max(Et,Bt)&&Rt.length<=Math.max(Gt,Zt)&&(Z.splice(et[Dt-1],0,[c,Rt]),Z[et[Dt-1]+1][0]=r,Dt--,Dt--,bt=Dt>0?et[Dt-1]:-1,Et=0,Bt=0,Gt=0,Zt=0,Rt=null,Pt=!0)),bt++;for(Pt&&_(Z),L(Z),bt=1;bt<Z.length;){if(Z[bt-1][0]==c&&Z[bt][0]==r){var he=Z[bt-1][1],ie=Z[bt][1],ge=E(he,ie),ae=E(ie,he);ge>=ae?(ge>=he.length/2||ge>=ie.length/2)&&(Z.splice(bt,0,[u,ie.substring(0,ge)]),Z[bt-1][1]=he.substring(0,he.length-ge),Z[bt+1][1]=ie.substring(ge),bt++):(ae>=he.length/2||ae>=ie.length/2)&&(Z.splice(bt,0,[u,he.substring(0,ae)]),Z[bt-1][0]=r,Z[bt-1][1]=ie.substring(0,ie.length-ae),Z[bt+1][0]=c,Z[bt+1][1]=he.substring(ae),bt++),bt++}bt++}}var G=/[^a-zA-Z0-9]/,W=/\s/,tt=/[\r\n]/,it=/\n\r?\n$/,nt=/^\r?\n\r?\n/;function L(Z){function Pt(ae,Ce){if(!ae||!Ce)return 6;var Be=ae.charAt(ae.length-1),Re=Ce.charAt(0),ye=Be.match(G),Ee=Re.match(G),ve=ye&&Be.match(W),De=Ee&&Re.match(W),Ve=ve&&Be.match(tt),Ie=De&&Re.match(tt),Pi=Ve&&ae.match(it),Ci=Ie&&Ce.match(nt);return Pi||Ci?5:Ve||Ie?4:ye&&!ve&&De?3:ve||De?2:ye||Ee?1:0}for(var et=1;et<Z.length-1;){if(Z[et-1][0]==u&&Z[et+1][0]==u){var Dt=Z[et-1][1],Rt=Z[et][1],bt=Z[et+1][1],Et=U(Dt,Rt);if(Et){var Bt=Rt.substring(Rt.length-Et);Dt=Dt.substring(0,Dt.length-Et),Rt=Bt+Rt.substring(0,Rt.length-Et),bt=Bt+bt}for(var Gt=Dt,Zt=Rt,he=bt,ie=Pt(Dt,Rt)+Pt(Rt,bt);Rt.charAt(0)===bt.charAt(0);){Dt+=Rt.charAt(0),Rt=Rt.substring(1)+bt.charAt(0),bt=bt.substring(1);var ge=Pt(Dt,Rt)+Pt(Rt,bt);ge>=ie&&(ie=ge,Gt=Dt,Zt=Rt,he=bt)}Z[et-1][1]!=Gt&&(Gt?Z[et-1][1]=Gt:(Z.splice(et-1,1),et--),Z[et][1]=Zt,he?Z[et+1][1]=he:(Z.splice(et+1,1),et--))}et++}}function _(Z,Pt){Z.push([u,""]);for(var et=0,Dt=0,Rt=0,bt="",Et="",Bt;et<Z.length;){if(et<Z.length-1&&!Z[et][1]){Z.splice(et,1);continue}switch(Z[et][0]){case r:Rt++,Et+=Z[et][1],et++;break;case c:Dt++,bt+=Z[et][1],et++;break;case u:var Gt=et-Rt-Dt-1;if(Pt){if(Gt>=0&&lt(Z[Gt][1])){var Zt=Z[Gt][1].slice(-1);if(Z[Gt][1]=Z[Gt][1].slice(0,-1),bt=Zt+bt,Et=Zt+Et,!Z[Gt][1]){Z.splice(Gt,1),et--;var he=Gt-1;Z[he]&&Z[he][0]===r&&(Rt++,Et=Z[he][1]+Et,he--),Z[he]&&Z[he][0]===c&&(Dt++,bt=Z[he][1]+bt,he--),Gt=he}}if(X(Z[et][1])){var Zt=Z[et][1].charAt(0);Z[et][1]=Z[et][1].slice(1),bt+=Zt,Et+=Zt}}if(et<Z.length-1&&!Z[et][1]){Z.splice(et,1);break}if(bt.length>0||Et.length>0){bt.length>0&&Et.length>0&&(Bt=D(Et,bt),Bt!==0&&(Gt>=0?Z[Gt][1]+=Et.substring(0,Bt):(Z.splice(0,0,[u,Et.substring(0,Bt)]),et++),Et=Et.substring(Bt),bt=bt.substring(Bt)),Bt=U(Et,bt),Bt!==0&&(Z[et][1]=Et.substring(Et.length-Bt)+Z[et][1],Et=Et.substring(0,Et.length-Bt),bt=bt.substring(0,bt.length-Bt)));var ie=Rt+Dt;bt.length===0&&Et.length===0?(Z.splice(et-ie,ie),et=et-ie):bt.length===0?(Z.splice(et-ie,ie,[r,Et]),et=et-ie+1):Et.length===0?(Z.splice(et-ie,ie,[c,bt]),et=et-ie+1):(Z.splice(et-ie,ie,[c,bt],[r,Et]),et=et-ie+2)}et!==0&&Z[et-1][0]===u?(Z[et-1][1]+=Z[et][1],Z.splice(et,1)):et++,Rt=0,Dt=0,bt="",Et="";break}}Z[Z.length-1][1]===""&&Z.pop();var ge=!1;for(et=1;et<Z.length-1;)Z[et-1][0]===u&&Z[et+1][0]===u&&(Z[et][1].substring(Z[et][1].length-Z[et-1][1].length)===Z[et-1][1]?(Z[et][1]=Z[et-1][1]+Z[et][1].substring(0,Z[et][1].length-Z[et-1][1].length),Z[et+1][1]=Z[et-1][1]+Z[et+1][1],Z.splice(et-1,1),ge=!0):Z[et][1].substring(0,Z[et+1][1].length)==Z[et+1][1]&&(Z[et-1][1]+=Z[et+1][1],Z[et][1]=Z[et][1].substring(Z[et+1][1].length)+Z[et+1][1],Z.splice(et+1,1),ge=!0)),et++;ge&&_(Z,Pt)}function Y(Z){return Z>=55296&&Z<=56319}function ct(Z){return Z>=56320&&Z<=57343}function X(Z){return ct(Z.charCodeAt(0))}function lt(Z){return Y(Z.charCodeAt(Z.length-1))}function B(Z){for(var Pt=[],et=0;et<Z.length;et++)Z[et][1].length>0&&Pt.push(Z[et]);return Pt}function se(Z,Pt,et,Dt){return lt(Z)||X(Dt)?null:B([[u,Z],[c,Pt],[r,et],[u,Dt]])}function Yt(Z,Pt,et){var Dt=typeof et=="number"?{index:et,length:0}:et.oldRange,Rt=typeof et=="number"?null:et.newRange,bt=Z.length,Et=Pt.length;if(Dt.length===0&&(Rt===null||Rt.length===0)){var Bt=Dt.index,Gt=Z.slice(0,Bt),Zt=Z.slice(Bt),he=Rt?Rt.index:null;t:{var ie=Bt+Et-bt;if(he!==null&&he!==ie||ie<0||ie>Et)break t;var ge=Pt.slice(0,ie),ae=Pt.slice(ie);if(ae!==Zt)break t;var Ce=Math.min(Bt,ie),Be=Gt.slice(0,Ce),Re=ge.slice(0,Ce);if(Be!==Re)break t;var ye=Gt.slice(Ce),Ee=ge.slice(Ce);return se(Be,ye,Ee,Zt)}t:{if(he!==null&&he!==Bt)break t;var ve=Bt,ge=Pt.slice(0,ve),ae=Pt.slice(ve);if(ge!==Gt)break t;var De=Math.min(bt-ve,Et-ve),Ve=Zt.slice(Zt.length-De),Ie=ae.slice(ae.length-De);if(Ve!==Ie)break t;var ye=Zt.slice(0,Zt.length-De),Ee=ae.slice(0,ae.length-De);return se(Gt,ye,Ee,Ve)}}if(Dt.length>0&&Rt&&Rt.length===0)t:{var Be=Z.slice(0,Dt.index),Ve=Z.slice(Dt.index+Dt.length),Ce=Be.length,De=Ve.length;if(Et<Ce+De)break t;var Re=Pt.slice(0,Ce),Ie=Pt.slice(Et-De);if(Be!==Re||Ve!==Ie)break t;var ye=Z.slice(Ce,bt-De),Ee=Pt.slice(Ce,Et-De);return se(Be,ye,Ee,Ve)}return null}function It(Z,Pt,et,Dt){return g(Z,Pt,et,Dt,!0)}return It.INSERT=r,It.DELETE=c,It.EQUAL=u,Gh=It,Gh}var z1=V1();const Ra=Xm(z1),j1=["documentation","authors","testDocumentation","globalCode"],nf=["name","desc","code","testCode"],of=["params","returns"];var to,Ut,Ii,yc,Us,Ia,Ba,Ym,Tn,os,Va,wc,bc,xc,Hr,vc,qr,kc,Km,kr,Dn,Ln,Yo,za,Ko,Gm,Sr,Pr,$m,Sc,Hm,qm;class U1{constructor(r,u={}){pi(this,Ut);pi(this,to,{});pi(this,Us,{});pi(this,Tn,[]);pi(this,os,{});pi(this,Hr,[]);pi(this,qr,[]);pi(this,Dn,{});pi(this,Ln,{});y(this,"calledFunctions",{});y(this,"callingFunctions",{});pi(this,Yo,[]);pi(this,Ko,{});this.synced=!1,this.id=r,this.initialData=u,this.model=new fo,this.modelData=this.model.getMap("modelData"),this.modelData.observeDeep(g=>{ft(this,Ut,Ym).call(this,g)}),this.functions=this.model.getMap("functions"),this.functions.observeDeep(g=>{ft(this,Ut,Km).call(this,g)}),this.calls=this.model.getMap("calls"),this.calls.observe(g=>{ft(this,Ut,qm).call(this,g)}),this.indexeddb=new B1(this.id,this.model),this.indexeddb.on("synced",()=>{this.functions.size===0&&this.calls.size===0&&this.importModel(this.initialData),ft(this,Ut,Ii).call(this,$t(this,to).synced),this.synced=!0}),this.undoManager=new Nv([this.modelData,this.functions,this.calls],{untrackedOrigins:new Set([this.indexeddb])})}exportModel(){return{...this.modelData.toJSON(),functions:Array.from(this.functions.entries()).map(([r,u])=>{const g=u.toJSON();return g.key=r,g}),calls:Array.from(this.calls.keys()).map(r=>r.split("-")).map(([r,u])=>({from:r,to:u}))}}importModel(r){this.model.transact(()=>{this.modelData.clear();for(const[u,g]of Object.entries(r||{}))["functions","calls"].includes(u)||this.modelData.set(u,g);this.functions.clear();for(let u of r.functions||[]){const g=u.key.toString();u={...u},delete u.key,this.functions.set(g,this.convertFuncData(u))}this.calls.clear();for(const{from:u,to:g}of r.calls||[]){const w=`${u}-${g}`;this.calls.set(w,!0)}})}resetModel(){this.importModel(this.initialData)}addListener(r,u){$t(this,to)[r]||($t(this,to)[r]=[]),$t(this,to)[r].push(u)}fireModelDataListeners(){for(const r of Object.keys($t(this,Us)))r==="problems"?ft(this,Ut,Ba).call(this):r!==""&&ft(this,Ut,Ia).call(this,r)}addModelDataListener(r,u){$t(this,Us)[r]||($t(this,Us)[r]=[]),$t(this,Us)[r].push(u)}updateModelData(r,u,g=null){j1.includes(r)?rf(this.modelData,r,u,g):this.modelData.set(r,u)}recordModelDataProblem(r,u,g){ft(this,Ut,yc).call(this,$t(this,Tn),r,u,g)===-1&&($t(this,Tn).push([r,u,g]),ft(this,Ut,Ba).call(this))}clearModelDataProblem(r=null,u=null,g=null){const w=ft(this,Ut,yc).call(this,$t(this,Tn),r,u,g);w!==-1&&($t(this,Tn).splice(w,1),ft(this,Ut,Ba).call(this))}fireFuncListeners(r){for(const u of Object.keys($t(this,os)))u==="problems"?ft(this,Ut,bc).call(this,r):u==="linkProblems"?ft(this,Ut,xc).call(this,r):u!==""&&ft(this,Ut,Va).call(this,r,u)}addFuncListener(r,u){$t(this,os)[r]||($t(this,os)[r]=[]),$t(this,os)[r].push(u)}addFuncAddListener(r){$t(this,Hr).push(r)}addFuncRemoveListener(r){$t(this,qr).push(r)}addFunc(r={}){const u=Array.from(this.functions.keys()).map(w=>parseInt(w)),g=(Math.max(-1,...u)+1).toString();this.functions.set(g,this.convertFuncData(r))}convertFuncData(r){return r instanceof Ks?r:(r instanceof Map&&(r=Object.fromEntries(r)),new Ks(Object.entries(r).map(([u,g])=>(g=nf.includes(u)?new cn(g):of.includes(u)?new Ys(g.map(this.convertFuncData)):g,[u,g]))))}removeFunc(r){this.model.transact(()=>{for(const u of this.calledFunctions[r]||[])this.calls.delete(`${r}-${u}`);for(const u of this.callingFunctions[r]||[])this.calls.delete(`${u}-${r}`);this.functions.delete(r)})}removeFuncs(r){this.model.transact(()=>{this.calls.forEach((u,g)=>{const[w,k]=g.split("-");(r.includes(w)||r.includes(k))&&this.calls.delete(g)});for(const u of r)this.functions.delete(u)})}updateFunc(r,u,g,w=null){const k=this.functions.get(r);if(!k){console.error(`Function with key ${r} does not exist`);return}if(of.some(N=>u.startsWith(N))){const[N,D,E]=this.parseFuncProperty(u);D==null?k.set(N,new Ys(g.map(this.convertFuncData))):this.model.transact(()=>{const U=!k.has(N),F=k.get(N)??new Ys;if(U&&k.set(N,F),!U&&D<F.length){const j=F.get(D);if(E==null){for(const[G,W]of Object.entries(g))ft(this,Ut,kr).call(this,j,G,W);for(const G of j.keys())G in g||j.delete(G)}else ft(this,Ut,kr).call(this,j,E,g,w)}else if(E==null)F.insert(D,[this.convertFuncData(g)]);else{const j=new Ks;F.insert(D,[j]),ft(this,Ut,kr).call(this,j,E,g,w)}})}else ft(this,Ut,kr).call(this,k,u,g,w)}parseFuncProperty(r){const u=/(params|returns)(\[(\d+)\](\.(name|desc|type))?)?/.exec(r);if(u){const[,g,,w,,k]=u;return[g,w?parseInt(w):null,k??null]}return[r,null,null]}addFuncItem(r,u,g=-1){const w=this.functions.get(r);if(!w){console.error(`Function with key ${r} does not exist`);return}const k=!w.has(u),N=w.get(u)??new Ys;this.model.transact(()=>{k&&w.set(u,N),g===-1&&(g=k?0:N.length),N.insert(g,[new Ks])})}removeFuncItem(r,u,g){const w=this.functions.get(r).get(u);w&&g<w.length&&w.delete(g,1)}moveFuncItem(r,u,g,w){const k=this.functions.get(r).get(u);if(k&&g<k.length){const N=k.get(g).clone();this.model.transact(()=>{k.delete(g,1),k.insert(w,[N])})}}setFuncProblems(r,u){$t(this,Dn)[r]||($t(this,Dn)[r]=[]),$t(this,Dn)[r]=[...u],ft(this,Ut,bc).call(this,r)}getFuncProblems(r){return $t(this,Dn)[r]||[]}setFuncLinkProblems(r,u){$t(this,Ln)[r]||($t(this,Ln)[r]=[]),$t(this,Ln)[r]=[...u],ft(this,Ut,xc).call(this,r)}getFuncLinkProblems(r){return $t(this,Ln)[r]||[]}addFuncCallListener(r){$t(this,Yo).push(r)}addFuncCall(r,u){this.calls.set(`${r}-${u}`,!0)}removeFuncCall(r,u){this.calls.delete(`${r}-${u}`)}removeFuncCalls(r){this.model.transact(()=>{for(const{from:u,to:g}of r)this.calls.delete(`${u}-${g}`)})}updateFuncCall(r,u,g,w){g=g??r,w=w??u,!(g===r&&w===u)&&this.model.transact(()=>{this.calls.delete(`${r}-${u}`),this.calls.set(`${g}-${w}`,!0)})}getFuncCallProblems(r,u){return $t(this,Ko)[`${r}-${u}`]||[]}setFuncCallProblems(r,u,g){$t(this,Ko)[`${r}-${u}`]=[...g],ft(this,Ut,Gm).call(this,r,u)}}to=new WeakMap,Ut=new WeakSet,Ii=function(r,...u){if(r)for(const g of r)g(...u)},yc=function(r,u=null,g=null,w=null){for(let k=0;k<r.length;k++){const[N,D,E]=r[k];if((u==null||N===u)&&(g==null||D===g)&&(w==null||E===w))return k}return-1},Us=new WeakMap,Ia=function(r){const u=this.modelData.get(r),g=u!=null&&u.toJSON?u.toJSON():u;ft(this,Ut,Ii).call(this,$t(this,Us)[r],r,g),ft(this,Ut,Ii).call(this,$t(this,Us)[""],r,g)},Ba=function(){ft(this,Ut,Ii).call(this,$t(this,Us).problems,"problems",$t(this,Tn))},Ym=function(r){for(const u of r)if(u.target===this.modelData)for(const g of u.changes.keys.keys())ft(this,Ut,Ia).call(this,g);else{const g=u.path[0];ft(this,Ut,Ia).call(this,g)}},Tn=new WeakMap,os=new WeakMap,Va=function(r,u){var k,N;const g=this.functions.get(r).get(u),w=g!=null&&g.toJSON?g.toJSON():g;ft(this,Ut,Ii).call(this,(k=$t(this,os))==null?void 0:k[u],r,u,w),ft(this,Ut,Ii).call(this,(N=$t(this,os))==null?void 0:N[""],r,u,w)},wc=function(r,u,g,w){var D,E;let k=this.functions.get(r).get(w[0]);for(let U=1;U<w.length;U++)k=k.get(w[U]);const N=k!=null&&k.toJSON?k.toJSON():k;ft(this,Ut,Ii).call(this,(D=$t(this,os))==null?void 0:D[u],r,g,N),ft(this,Ut,Ii).call(this,(E=$t(this,os))==null?void 0:E[""],r,g,N)},bc=function(r){const u=$t(this,Dn)[r]??[];ft(this,Ut,Ii).call(this,$t(this,os).problems,r,"problems",u)},xc=function(r){const u=$t(this,Ln)[r]??[];ft(this,Ut,Ii).call(this,$t(this,os).linkProblems,r,"linkProblems",u)},Hr=new WeakMap,vc=function(r){const u=this.functions.get(r).toJSON();delete u.isTrusted,ft(this,Ut,Ii).call(this,$t(this,Hr),r,u)},qr=new WeakMap,kc=function(r){ft(this,Ut,Ii).call(this,$t(this,qr),r)},Km=function(r){for(const u of r)if(u.target===this.functions)for(const[g,{action:w}]of u.changes.keys)w==="add"?ft(this,Ut,vc).call(this,g):w==="delete"?ft(this,Ut,kc).call(this,g):w==="update"&&(console.warn("Unexpected update action on Yjs functions map"),ft(this,Ut,kc).call(this,g),ft(this,Ut,vc).call(this,g));else if(u.path.length===1){const g=u.path[0];for(const w of u.changes.keys.keys())ft(this,Ut,Va).call(this,g,w)}else if(u.path.length===2){const[g,w]=u.path;ft(this,Ut,Va).call(this,g,w)}else if(u.path.length===3){const[g,w,k]=u.path;ft(this,Ut,wc).call(this,g,w,`${w}[${k}]`,[w,k])}else if(u.path.length===4){const[g,w,k,N]=u.path;ft(this,Ut,wc).call(this,g,w,`${w}[${k}].${N}`,[w,k,N])}else console.error("Unexpected event path length in Yjs functions observer:",u.path)},kr=function(r,u,g,w=null){nf.includes(u)?rf(r,u,g,w):r.set(u,g)},Dn=new WeakMap,Ln=new WeakMap,Yo=new WeakMap,za=function(r,u,g,w,k){ft(this,Ut,Ii).call(this,$t(this,Yo),r,u,g,w,k)},Ko=new WeakMap,Gm=function(r,u){const g=$t(this,Ko)[`${r}-${u}`]??[];ft(this,Ut,Ii).call(this,$t(this,Yo),"problems",r,u,g)},Sr=function(r,u,g){r[u]||(r[u]=[]),r[u].push(g)},Pr=function(r,u,g){r[u]&&(r[u]=r[u].filter(w=>w!==g))},$m=function(r){const[u,g]=r.split("-");ft(this,Ut,Sr).call(this,this.calledFunctions,u,g),ft(this,Ut,Sr).call(this,this.callingFunctions,g,u),ft(this,Ut,za).call(this,"add",null,null,u,g)},Sc=function(r){const[u,g]=r.split("-");ft(this,Ut,Pr).call(this,this.calledFunctions,u,g),ft(this,Ut,Pr).call(this,this.callingFunctions,g,u),ft(this,Ut,za).call(this,"delete",u,g,null,null)},Hm=function(r,u){const[g,w]=r.split("-"),[k,N]=u.split("-");ft(this,Ut,Pr).call(this,this.calledFunctions,g,w),ft(this,Ut,Pr).call(this,this.callingFunctions,w,g),ft(this,Ut,Sr).call(this,this.calledFunctions,k,N),ft(this,Ut,Sr).call(this,this.callingFunctions,N,k),ft(this,Ut,za).call(this,"update",g,w,k,N)},qm=function(r){let u=null;for(const[g,{action:w}]of r.changes.keys)w==="add"?u!==null?(ft(this,Ut,Hm).call(this,u,g),u=null):ft(this,Ut,$m).call(this,g):w==="delete"?(u!==null&&ft(this,Ut,Sc).call(this,u),u=g):w==="update"&&console.warn("Unexpected update action on Yjs calls map");u!==null&&ft(this,Ut,Sc).call(this,u)};function rf(c,r,u,g=null){if(typeof u=="string"){const w=c.get(r);if(w&&w instanceof cn){const k=w.toString();if(k===u)return;w.applyDelta(X1(Ra(k,u,g)))}else c.set(r,new cn(u))}}function X1(c){return c.map(([r,u])=>r===Ra.INSERT?{insert:u}:r===Ra.EQUAL?{retain:u.length}:r===Ra.DELETE?{delete:u.length}:null)}class Y1 extends go.Router{constructor(r){super(),this.name="AvoidsLinksRouter",this._linkSpacing=4,this._allsegs=new go.List,this._gridlines=new go.List,this._segs=new go.List,this._avoidsNodes=!0,this._epsilonDistance=.5,this._iterations=1,this._ignoreContainingGroups=!1,r&&Object.assign(this,r)}get linkSpacing(){return this._linkSpacing}set linkSpacing(r){if(r!==this._linkSpacing){if(typeof r!="number")throw new Error("AvoidsLinksRouter.linkSpacing must be a number");this._linkSpacing=r,this.invalidateRouter()}}get avoidsNodes(){return this._avoidsNodes}set avoidsNodes(r){r=!!r,r!==this._avoidsNodes&&(this._avoidsNodes=r,this.invalidateRouter())}get epsilonDistance(){return this._epsilonDistance}set epsilonDistance(r){if(r!==this._epsilonDistance){if(typeof r!="number")throw new Error("AvoidsLinksRouter.epsilonDistance must be a number");this._epsilonDistance=r,this.invalidateRouter()}}get iterations(){return this._iterations}set iterations(r){if(r!==this._iterations){if(typeof r!="number")throw new Error("AvoidsLinksRouter.iterations must be a number");this._iterations=r,this.invalidateRouter()}}get ignoreContainingGroups(){return this._ignoreContainingGroups}set ignoreContainingGroups(r){r=!!r,r!==this._ignoreContainingGroups&&(this._ignoreContainingGroups=r,this.invalidateRouter())}canRoute(r){return this._ignoreContainingGroups&&r instanceof go.Group?!1:super.canRoute(r)}routeLinks(r,u){const g=this.diagram;if(g!==null)for(let w=0;w<this.iterations;w++){this._allsegs=new go.List,this._gridlines=new go.List,this.collectSegments(r,u);let k=null;this._avoidsNodes&&(k=g.getPositions(!0,null,null)),this.adjustOverlaps(k);for(const N of this._allsegs)for(const D of N)this._freeSegInfo(D);for(const N of this._gridlines)for(const D of N)this._freeSegInfo(D)}}_allocSegInfo(){const r=this._segs.pop();return r||new K1}_freeSegInfo(r){r.link=null,this._segs.push(r)}_coord(r){return r.vertical?r.link.getPoint(r.indexStart).x:r.link.getPoint(r.indexStart).y}_columnStart(r){return r.vertical?r.link.getPoint(r.indexStart).y:r.link.getPoint(r.indexStart).x}_columnEnd(r){return r.vertical?r.link.getPoint(r.indexEnd).y:r.link.getPoint(r.indexEnd).x}nextOrthoBend(r,u){let g=r.getPoint(u),w=r.getPoint(u+1),k=u;const N=this.isApprox(g.x,w.x)&&!this.isApprox(g.y,w.y);for(;k<r.pointsCount-2;)if(k++,g=r.getPoint(k),w=r.getPoint(k+1),N!==(this.isApprox(g.x,w.x)&&!this.isApprox(g.y,w.y)))return k;return r.pointsCount-1}collectSegments(r,u){this._allsegs.clear(),this._gridlines.clear();const g=u instanceof go.Diagram;let w,k,N,D,E,U=this._allocSegInfo(),F=null;const j=u instanceof go.Diagram&&r.count===u.links.count;for(const G of r)if(!(!this._ignoreContainingGroups&&!(g&&G.containingGroup===null||G.containingGroup===u))&&G.isOrthogonal)for(j||(F===null?F=G.getDocumentBounds():F.unionRect(G.getDocumentBounds())),D=this.nextOrthoBend(G,0);D<G.pointsCount-1&&(E=this.nextOrthoBend(G,D),E!==G.pointsCount-1);){w=G.getPoint(D),k=G.getPoint(E);const W=this.isApprox(w.x,k.x)&&!this.isApprox(w.y,k.y),tt=this._allocSegInfo();tt.indexStart=D,tt.indexEnd=E,tt.link=G,tt.vertical=W,tt._computeGeo(),N=!1;for(const it of this._allsegs)if(Math.abs(this._coord(it.first())-this._coord(tt))<this._epsilonDistance&&it.first().vertical===W){N=!0,it.add(tt);break}N||this._allsegs.add(new go.List([tt])),D=E}if(u&&F!==null&&!j){for(const G of this.diagram.findPartsIn(F,!0))if(G instanceof go.Link&&G.isOrthogonal&&!r.has(G))for(D=this.nextOrthoBend(G,0);D<G.pointsCount-1&&(E=this.nextOrthoBend(G,D),E!==G.pointsCount-1);){w=G.getPoint(D),k=G.getPoint(E);const W=this.isApprox(w.x,k.x)&&!this.isApprox(w.y,k.y),tt=W?w.x:w.y;for(const it of this._allsegs)if(Math.abs(this._coord(it.first())-tt)<this._epsilonDistance&&it.first().vertical===W){const nt=this._allocSegInfo();nt.indexStart=D,nt.indexEnd=E,nt.link=G,nt.vertical=W,nt._computeGeo(),it.add(nt);break}D=E}}for(const G of this._allsegs)for(;G.count>0;){U=G.pop();const W=new go.List([U]);for(N=!0;N;){N=!1;for(const tt of W)for(const it of G){const nt=Math.min(this._columnStart(it),this._columnEnd(it)),L=Math.max(this._columnStart(it),this._columnEnd(it)),_=Math.min(this._columnStart(tt),this._columnEnd(tt)),Y=Math.max(this._columnStart(tt),this._columnEnd(tt));if(_<=L&&nt<=Y&&it.link!==tt.link){G.remove(it),W.push(it),N=!0;break}}}this._gridlines.add(W)}}adjustOverlaps(r){const u=this._gridlines;for(const g of u){if(g.size<2)continue;const w=g.toArray();this.sortGridline(w);const k=w[0].vertical,N=w.length-1;let D=this._linkSpacing;if(this._avoidsNodes&&N>0){let E=Math.min(this._columnStart(w[0]),this._columnEnd(w[0])),U=Math.max(this._columnStart(w[0]),this._columnEnd(w[0]));const F=this._coord(w[0])-N*this._linkSpacing/2,j=this._coord(w[0])+N*this._linkSpacing/2;for(let G=1;G<w.length;G++){const W=w[G];E=Math.min(E,Math.min(this._columnStart(W),this._columnEnd(W))),U=Math.max(U,Math.max(this._columnStart(W),this._columnEnd(W)))}if(k){if(!r.isUnoccupied(F,E,j-F,U-E)){const G=r.maxAvoidsLinksSpaceV(E,U,this._coord(w[0]),j-F);D=Math.min(this._linkSpacing,2*G/(1+N))}}else if(!r.isUnoccupied(E,F,U-E,j-F)){const G=r.maxAvoidsLinksSpaceH(E,U,this._coord(w[0]),j-F);D=Math.min(this._linkSpacing,2*G/(1+N))}D===0&&(D=this._linkSpacing)}for(let E=0;E<w.length;E++){const U=w[E];if(U.link===null)continue;const F=this._coord(U)+(E-N/2)*D;U.link.startRoute();for(let j=U.indexStart;j<=U.indexEnd;j++)k?U.link.setPoint(j,new go.Point(F,U.link.getPoint(j).y)):U.link.setPoint(j,new go.Point(U.link.getPoint(j).x,F));U.link.commitRoute()}}}partialSort(r,u,g,w){const k=r.slice(0,u),N=r.slice(g),D=r.slice(u,g).sort(w);return r.length=0,r.push.apply(r,k.concat(D).concat(N)),r}endpointComparer(r,u){const g=Math.min(this._columnStart(r),this._columnEnd(r)),w=Math.max(this._columnStart(r),this._columnEnd(r)),k=Math.min(this._columnStart(u),this._columnEnd(u)),N=Math.max(this._columnStart(u),this._columnEnd(u)),D=this.isApprox(g,k),E=this.isApprox(w,N),U=r.geo;let F=0;return k<=g&&w<=N?U===0&&D?F=1:U===0&&E||U===1&&D?F=-1:U===1&&E||U===2?F=1:U===3&&(F=-1):g<=k&&N<=w?U===0&&D?F=-1:U===0&&E||U===1&&D?F=1:U===1&&E||U===2?F=-1:U===3&&(F=1):k<=g&&N<=w?U===0?F=-1:U===1&&(F=1):g<=k&&w<=N&&(U===0?F=1:U===1&&(F=-1)),F}sortGridline(r){r.sort((F,j)=>j.geo-F.geo);let u=0,g=0,w=0,k=0;for(let F=0;F<r.length;F++)switch(r[F].geo){case 0:u++;break;case 1:g++;break;case 2:w++;break;case 3:k++;break}const N=u,D=u+g,E=u+g+w,U=u+g+w+k;u>1&&this.partialSort(r,0,N,(F,j)=>this.endpointComparer(F,j)),g>1&&this.partialSort(r,N,D,(F,j)=>this.endpointComparer(F,j)),w>1&&this.partialSort(r,D,E,(F,j)=>this.endpointComparer(F,j)),k>1&&this.partialSort(r,E,U,(F,j)=>this.endpointComparer(F,j))}isApprox(r,u){const g=r-u;return g>-.5&&g<.5}}class K1{constructor(){this.vertical=!1,this.indexStart=NaN,this.indexEnd=NaN,this.link=null,this.geo=0}_computeGeo(){this.vertical?this._computeGeoV():this._computeGeoH()}_computeGeoH(){if(this.link===null)return;let r=this.indexStart-1,u=this.indexEnd+1;for(;r>0&&Math.abs(this.link.getPoint(r).x-this.link.getPoint(r-1).x)<.5;)r--;for(;u<this.link.pointsCount-1&&Math.abs(this.link.getPoint(u).x-this.link.getPoint(u+1).x)<.5;)u++;const g=this.link.getPoint(r).y,w=this.link.getPoint(u).y,k=this.link.getPoint(this.indexStart).y,N=this.link.getPoint(this.indexStart).x,D=this.link.getPoint(this.indexEnd+1).x;N<D?g<k&&w>k?this.geo=0:g>k&&w<k?this.geo=1:g>k&&w>k?this.geo=2:g<k&&w<k&&(this.geo=3):w<k&&g>k?this.geo=0:w>k&&g<k?this.geo=1:w>k&&g>k?this.geo=2:w<k&&g<k&&(this.geo=3)}_computeGeoV(){if(this.link===null)return;let r=this.indexStart-1,u=this.indexEnd+1;for(;r>0&&Math.abs(this.link.getPoint(r).y-this.link.getPoint(r-1).y)<.5;)r--;for(;u<this.link.pointsCount-1&&Math.abs(this.link.getPoint(u).y-this.link.getPoint(u+1).y)<.5;)u++;const g=this.link.getPoint(r).x,w=this.link.getPoint(u).x,k=this.link.getPoint(this.indexStart).x,N=this.link.getPoint(this.indexStart).y,D=this.link.getPoint(this.indexEnd+1).y;N<D?g<k&&w>k?this.geo=0:g>k&&w<k?this.geo=1:g>k&&w>k?this.geo=2:g<k&&w<k&&(this.geo=3):w<k&&g>k?this.geo=0:w>k&&g<k?this.geo=1:w>k&&g>k?this.geo=2:w<k&&g<k&&(this.geo=3)}}function G1(c,r){Wm(c,r);function u(w){c.setFuncLinkProblems(w,Xa(c,w))}function g(w,k,N,D){Mr(c,N,r),(w??N)!==N&&Mr(c,w,r),u(N),u(D),(w??N)!==N&&u(w),(k??D)!==D&&u(k),c.setFuncCallProblems(N,D,Ua(c,N,D)),ja(c)}c.addFuncAddListener((w,k)=>{c.setFuncProblems(w,Ya(c,w,r,!0)),c.setFuncLinkProblems(w,Xa(c,w))}),c.addFuncListener("",(w,k,N)=>{if(!(k==="problems"||k==="linkProblems"))if(c.setFuncProblems(w,Ya(c,w,r,!1)),k==="name"){c.setFuncLinkProblems(w,Xa(c,w));for(const U of c.calledFunctions[w]||[])c.setFuncCallProblems(w,U,Ua(c,w,U));for(const U of c.callingFunctions[w]||[])c.setFuncCallProblems(U,w,Ua(c,U,w));const D=(N||"").toString().trim();Array.from(c.functions).filter(U=>{var F,j;return U[0]!==w&&((j=(F=U[1].get("name"))==null?void 0:F.toString())==null?void 0:j.trim())===D}).forEach(U=>{c.setFuncProblems(U[0],Ya(c,U[0],r,!1))}),ja(c)}else k==="io"&&Mr(c,w,r)}),c.addFuncCallListener((w,k,N,D,E)=>{w!=="problems"&&(w==="add"||w==="update"?g(k,N,D,E):w==="delete"&&(k&&c.functions.has(k)&&(Mr(c,k,r),u(k)),N&&N!==k&&c.functions.has(N)&&u(N),ja(c)))}),r.callGraphOnly||(c.addModelDataListener("documentation",()=>{Pc(c,r)}),c.addModelDataListener("authors",()=>{Mc(c,r)}),Pc(c,r),Mc(c,r))}function Wm(c,r={}){for(const u of c.functions.keys()){c.setFuncProblems(u,Ya(c,u,r)),c.setFuncLinkProblems(u,Xa(c,u));for(const g of c.calledFunctions[u]||[])c.setFuncCallProblems(u,g,Ua(c,u,g))}r.callGraphOnly||(Pc(c,r),Mc(c,r)),ja(c)}function Pc(c,r={}){var g;const u=(((g=c.modelData.get("documentation"))==null?void 0:g.toString())||"").trim().length;c.clearModelDataProblem(null,"documentation"),u===0?c.recordModelDataProblem("error","documentation","Module documentation is missing."):u<(r.minModuleDescLength??25)&&c.recordModelDataProblem("warning","documentation","Module documentation is too short.")}function Mc(c,r={}){var g;const u=(((g=c.modelData.get("authors"))==null?void 0:g.toString())||"").trim().length;c.clearModelDataProblem(null,"authors"),u===0?c.recordModelDataProblem("error","authors","Author name(s) are required."):u<3&&c.recordModelDataProblem("warning","authors","Author name(s) seem too short.")}function ja(c,r=null){const u=$1(c,r).filter(w=>w.length>1),g=H1(u);for(const w of c.calls.keys()){const[k,N]=w.split("-"),D=c.getFuncCallProblems(k,N),E=D.some(U=>U[2].includes("cycle"));g.has(k)&&g.get(k).includes(N)?E||c.setFuncCallProblems(k,N,D.concat([["warning","link","Part of a recursive cycle. Recursive functions are tricky, be careful if this is what you intended."]])):E&&c.setFuncCallProblems(k,N,D.filter(U=>!U[2].includes("cycle")))}for(const[w,k]of c.functions){const N=c.getFuncLinkProblems(w),D=N.some(E=>E[2].includes("cycle"));g.has(w)?D||c.setFuncLinkProblems(w,N.concat([["warning","callsInto","Part of a recursive cycle. Recursive functions are tricky, be careful if this is what you intended."]])):D&&c.setFuncLinkProblems(w,N.filter(E=>!E[2].includes("cycle")))}}function $1(c,r=null){let u=[];const g=Sg(c.calledFunctions),w=new Set(c.functions.keys()),k=[],N=function(D){if(w.has(D)){w.delete(D),k.push(D);for(const E of g[D]||[])k.includes(E)?u.push(k.slice(k.lastIndexOf(E))):N(E);k.pop()}};if(r)N(r),u=u.filter(D=>D.includes(r));else for(;w.size>0;)N(w.values().next().value);return u}function H1(c){const r=new Map;for(const u of c)for(let g=0;g<u.length;g++){const w=u[g],k=u[(g+1)%u.length];r.has(w)||r.set(w,[]),r.get(w).push(k)}return r}function q1(c,r,u){if(r===u)return!0;const g=Sg(c.calledFunctions);g[r]||(g[r]=[]),g[r].push(u);const w=new Set,k=[],N=function(D){w.add(D),k.push(D);for(const E of g[D]||[])if(E===r||!k.includes(E)&&N(E))return!0;return k.pop(),!1};return N(u)}function Ua(c,r,u){var k,N;const g=[];return((N=(k=c.functions.get(u).get("name"))==null?void 0:k.toString())==null?void 0:N.trim())==="main"?g.push(["error","link","Main function should not be called by other functions."]):u===r&&g.push(["warning","link","Recursive functions are tricky, be careful if this is what you intended."]),g}function Xa(c,r){var N,D;const u=[],g=((D=(N=c.functions.get(r).get("name"))==null?void 0:N.toString())==null?void 0:D.trim())==="main",w=c.callingFunctions[r]||[],k=c.calledFunctions[r]||[];return g?(w.length!==0&&u.push(["error","callsInto","Main function should not be called by other functions."]),k.length===0&&u.push(["warning","callsOutOf","Main function should call at least one other function."])):w.length===0?u.push(["error","callsInto","Non-main functions must be called by at least one other function."]):w.includes(r)&&u.push(["warning","callsInto","Recursive functions are tricky, be careful if this is what you intended."]),u}function Jm(c,r,u){var k;const g=[],w=u.io||"none";if(((k=u.name)==null?void 0:k.trim())==="main"&&(["none","indirect"].includes(w)||g.push(["warning","io","Main function should not have any direct user input or output."])),u.testable&&w!=="none"&&g.push(["error","testable,io","We cannot test functions that have direct or indirect user input or output."]),w==="indirect"||w==="none"){const N=Zm(c,r);w==="indirect"?N||g.push(["error","io","Function is marked as having indirect user I/O but no function it calls has user input/output."]):N&&g.push(["error","io","Function is marked as having no user input/output but calls another function with user input/output; it should be marked as 'indirect'."])}return g}function Zm(c,r,u=new Set){var w;if(u.has(r))return!1;u.add(r);const g=(w=c.functions.get(r))==null?void 0:w.get("io");return g&&["validation","input","output"].includes(g)?!0:Array.from(c.calledFunctions[r]||[]).some(k=>Zm(c,k,u))}function W1(c,r){const u=c.functions.get(r).toJSON(),g=c.getFuncProblems(r),w=Jm(c,r,u),k=g.filter(N=>!N[1].split(",").includes("io")).concat(w);oc(g,k)||c.setFuncProblems(r,k)}function Mr(c,r,u={},g=new Set){if(!u.callGraphOnly&&!g.has(r)){g.add(r),W1(c,r);for(const w of c.callingFunctions[r]||[])Mr(c,w,u,g)}}const J1=new Set(["and","as","assert","async","await","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","nonlocal","not","or","pass","raise","return","try","while","with","yield"]),Z1=new Set(["abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"]);function Cc(c,r="Function",u="name"){return c?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(c)?J1.has(c)?["error",u,`${r} name cannot be a Python keyword.`]:Z1.has(c)?["error",u,`${r} name cannot be a Python built-in function or type.`]:c.startsWith("_")||c.endsWith("_")?["warning",u,`${r} name should not start or end with an underscore.`]:/^[a-z_][a-z0-9_]*$/.test(c)?null:["warning",u,`${r} names should be in lowercase with underscores separating words.`]:["error",u,`${r} name must start with a letter or underscore and contain only letters, numbers, and underscores.`]:["error",u,`${r} name is required.`]}function Qm(c,r,u){return!u||!c?!1:Array.from(c.functions).some(w=>{var k,N;return w[0]!==r&&((N=(k=w[1].get("name"))==null?void 0:k.toString())==null?void 0:N.trim())===u})}function Ya(c,r,u={},g=!1){const w=[],k=c.functions.get(r).toJSON(),N=(k.name||"").trim(),D=Cc(N,"Function","name");if(D&&w.push(D),Qm(c,r,N)&&w.push(["error","name","Function name must be unique."]),u.callGraphOnly)return w;const E=N==="main",U=(k.desc||"").trim(),F=k.params||[],j=k.returns||[];k.io;const G=k.testable||!1;if(E)g?(U.length>0||F.length>0||j.length>0)&&c.model.transact(()=>{c.updateFunc(r,"desc",""),c.updateFunc(r,"params",[]),c.updateFunc(r,"returns",[])},"fixing main function properties"):(U.length>0&&w.push(["warning","desc","Main function does not need a description."]),F.length>0&&w.push(["error","params","Main function should not have parameters."]),j.length>0&&w.push(["error","returns","Main function should not return values."]));else{U.length===0?w.push(["warning","desc","Function description is required."]):U.length<(u.minFuncDescLength??20)&&w.push(["warning","desc","Function description is too short - be more descriptive!"]);const W=[];for(let tt=0;tt<F.length;tt++){const it=F[tt],nt=Cc(it.name,"Parameter",`params[${tt}].name`);if(nt&&w.push(nt),W.includes(it.name)){const L=W.indexOf(it.name);w.push(["error",`params[${L}].name`,"Parameter name must be unique within a function."]),w.push(["error",`params[${tt}].name`,"Parameter name must be unique within a function."])}W.push(it.name),it.type||w.push(["error",`params[${tt}].type`,"Parameter type is required."]),it.desc?it.desc.length<(u.minParamDescLength??20)&&w.push(["warning",`params[${tt}].desc`,"Parameter description is too short - be more descriptive!"]):w.push(["error",`params[${tt}].desc`,"Parameter description is required."])}for(let tt=0;tt<j.length;tt++){const it=j[tt];it.type||w.push(["error",`returns[${tt}].type`,"Return value type is required."]),it.desc?it.desc.length<(u.minReturnDescLength??20)&&w.push(["warning",`returns[${tt}].desc`,"Return value description is too short - be more descriptive!"]):w.push(["error",`returns[${tt}].desc`,"Return value description is required."])}}return G&&F.length===0&&w.push(["warning","testable,params","Testable functions should have at least one parameter."]),G&&j.length===0&&w.push(["warning","testable,returns","Testable functions should have at least one return value."]),w.push(...Jm(c,r,k)),w}var $h={exports:{}},af;function Q1(){return af||(af=1,(function(c){var r=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var u=(function(g){var w=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,k=0,N={},D={manual:g.Prism&&g.Prism.manual,disableWorkerMessageHandler:g.Prism&&g.Prism.disableWorkerMessageHandler,util:{encode:function _(Y){return Y instanceof E?new E(Y.type,_(Y.content),Y.alias):Array.isArray(Y)?Y.map(_):Y.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(_){return Object.prototype.toString.call(_).slice(8,-1)},objId:function(_){return _.__id||Object.defineProperty(_,"__id",{value:++k}),_.__id},clone:function _(Y,ct){ct=ct||{};var X,lt;switch(D.util.type(Y)){case"Object":if(lt=D.util.objId(Y),ct[lt])return ct[lt];X={},ct[lt]=X;for(var B in Y)Y.hasOwnProperty(B)&&(X[B]=_(Y[B],ct));return X;case"Array":return lt=D.util.objId(Y),ct[lt]?ct[lt]:(X=[],ct[lt]=X,Y.forEach(function(se,Yt){X[Yt]=_(se,ct)}),X);default:return Y}},getLanguage:function(_){for(;_;){var Y=w.exec(_.className);if(Y)return Y[1].toLowerCase();_=_.parentElement}return"none"},setLanguage:function(_,Y){_.className=_.className.replace(RegExp(w,"gi"),""),_.classList.add("language-"+Y)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(X){var _=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(X.stack)||[])[1];if(_){var Y=document.getElementsByTagName("script");for(var ct in Y)if(Y[ct].src==_)return Y[ct]}return null}},isActive:function(_,Y,ct){for(var X="no-"+Y;_;){var lt=_.classList;if(lt.contains(Y))return!0;if(lt.contains(X))return!1;_=_.parentElement}return!!ct}},languages:{plain:N,plaintext:N,text:N,txt:N,extend:function(_,Y){var ct=D.util.clone(D.languages[_]);for(var X in Y)ct[X]=Y[X];return ct},insertBefore:function(_,Y,ct,X){X=X||D.languages;var lt=X[_],B={};for(var se in lt)if(lt.hasOwnProperty(se)){if(se==Y)for(var Yt in ct)ct.hasOwnProperty(Yt)&&(B[Yt]=ct[Yt]);ct.hasOwnProperty(se)||(B[se]=lt[se])}var It=X[_];return X[_]=B,D.languages.DFS(D.languages,function(Z,Pt){Pt===It&&Z!=_&&(this[Z]=B)}),B},DFS:function _(Y,ct,X,lt){lt=lt||{};var B=D.util.objId;for(var se in Y)if(Y.hasOwnProperty(se)){ct.call(Y,se,Y[se],X||se);var Yt=Y[se],It=D.util.type(Yt);It==="Object"&&!lt[B(Yt)]?(lt[B(Yt)]=!0,_(Yt,ct,null,lt)):It==="Array"&&!lt[B(Yt)]&&(lt[B(Yt)]=!0,_(Yt,ct,se,lt))}}},plugins:{},highlightAll:function(_,Y){D.highlightAllUnder(document,_,Y)},highlightAllUnder:function(_,Y,ct){var X={callback:ct,container:_,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};D.hooks.run("before-highlightall",X),X.elements=Array.prototype.slice.apply(X.container.querySelectorAll(X.selector)),D.hooks.run("before-all-elements-highlight",X);for(var lt=0,B;B=X.elements[lt++];)D.highlightElement(B,Y===!0,X.callback)},highlightElement:function(_,Y,ct){var X=D.util.getLanguage(_),lt=D.languages[X];D.util.setLanguage(_,X);var B=_.parentElement;B&&B.nodeName.toLowerCase()==="pre"&&D.util.setLanguage(B,X);var se=_.textContent,Yt={element:_,language:X,grammar:lt,code:se};function It(Pt){Yt.highlightedCode=Pt,D.hooks.run("before-insert",Yt),Yt.element.innerHTML=Yt.highlightedCode,D.hooks.run("after-highlight",Yt),D.hooks.run("complete",Yt),ct&&ct.call(Yt.element)}if(D.hooks.run("before-sanity-check",Yt),B=Yt.element.parentElement,B&&B.nodeName.toLowerCase()==="pre"&&!B.hasAttribute("tabindex")&&B.setAttribute("tabindex","0"),!Yt.code){D.hooks.run("complete",Yt),ct&&ct.call(Yt.element);return}if(D.hooks.run("before-highlight",Yt),!Yt.grammar){It(D.util.encode(Yt.code));return}if(Y&&g.Worker){var Z=new Worker(D.filename);Z.onmessage=function(Pt){It(Pt.data)},Z.postMessage(JSON.stringify({language:Yt.language,code:Yt.code,immediateClose:!0}))}else It(D.highlight(Yt.code,Yt.grammar,Yt.language))},highlight:function(_,Y,ct){var X={code:_,grammar:Y,language:ct};if(D.hooks.run("before-tokenize",X),!X.grammar)throw new Error('The language "'+X.language+'" has no grammar.');return X.tokens=D.tokenize(X.code,X.grammar),D.hooks.run("after-tokenize",X),E.stringify(D.util.encode(X.tokens),X.language)},tokenize:function(_,Y){var ct=Y.rest;if(ct){for(var X in ct)Y[X]=ct[X];delete Y.rest}var lt=new j;return G(lt,lt.head,_),F(_,lt,Y,lt.head,0),tt(lt)},hooks:{all:{},add:function(_,Y){var ct=D.hooks.all;ct[_]=ct[_]||[],ct[_].push(Y)},run:function(_,Y){var ct=D.hooks.all[_];if(!(!ct||!ct.length))for(var X=0,lt;lt=ct[X++];)lt(Y)}},Token:E};g.Prism=D;function E(_,Y,ct,X){this.type=_,this.content=Y,this.alias=ct,this.length=(X||"").length|0}E.stringify=function _(Y,ct){if(typeof Y=="string")return Y;if(Array.isArray(Y)){var X="";return Y.forEach(function(It){X+=_(It,ct)}),X}var lt={type:Y.type,content:_(Y.content,ct),tag:"span",classes:["token",Y.type],attributes:{},language:ct},B=Y.alias;B&&(Array.isArray(B)?Array.prototype.push.apply(lt.classes,B):lt.classes.push(B)),D.hooks.run("wrap",lt);var se="";for(var Yt in lt.attributes)se+=" "+Yt+'="'+(lt.attributes[Yt]||"").replace(/"/g,"&quot;")+'"';return"<"+lt.tag+' class="'+lt.classes.join(" ")+'"'+se+">"+lt.content+"</"+lt.tag+">"};function U(_,Y,ct,X){_.lastIndex=Y;var lt=_.exec(ct);if(lt&&X&&lt[1]){var B=lt[1].length;lt.index+=B,lt[0]=lt[0].slice(B)}return lt}function F(_,Y,ct,X,lt,B){for(var se in ct)if(!(!ct.hasOwnProperty(se)||!ct[se])){var Yt=ct[se];Yt=Array.isArray(Yt)?Yt:[Yt];for(var It=0;It<Yt.length;++It){if(B&&B.cause==se+","+It)return;var Z=Yt[It],Pt=Z.inside,et=!!Z.lookbehind,Dt=!!Z.greedy,Rt=Z.alias;if(Dt&&!Z.pattern.global){var bt=Z.pattern.toString().match(/[imsuy]*$/)[0];Z.pattern=RegExp(Z.pattern.source,bt+"g")}for(var Et=Z.pattern||Z,Bt=X.next,Gt=lt;Bt!==Y.tail&&!(B&&Gt>=B.reach);Gt+=Bt.value.length,Bt=Bt.next){var Zt=Bt.value;if(Y.length>_.length)return;if(!(Zt instanceof E)){var he=1,ie;if(Dt){if(ie=U(Et,Gt,_,et),!ie||ie.index>=_.length)break;var Be=ie.index,ge=ie.index+ie[0].length,ae=Gt;for(ae+=Bt.value.length;Be>=ae;)Bt=Bt.next,ae+=Bt.value.length;if(ae-=Bt.value.length,Gt=ae,Bt.value instanceof E)continue;for(var Ce=Bt;Ce!==Y.tail&&(ae<ge||typeof Ce.value=="string");Ce=Ce.next)he++,ae+=Ce.value.length;he--,Zt=_.slice(Gt,ae),ie.index-=Gt}else if(ie=U(Et,0,Zt,et),!ie)continue;var Be=ie.index,Re=ie[0],ye=Zt.slice(0,Be),Ee=Zt.slice(Be+Re.length),ve=Gt+Zt.length;B&&ve>B.reach&&(B.reach=ve);var De=Bt.prev;ye&&(De=G(Y,De,ye),Gt+=ye.length),W(Y,De,he);var Ve=new E(se,Pt?D.tokenize(Re,Pt):Re,Rt,Re);if(Bt=G(Y,De,Ve),Ee&&G(Y,Bt,Ee),he>1){var Ie={cause:se+","+It,reach:ve};F(_,Y,ct,Bt.prev,Gt,Ie),B&&Ie.reach>B.reach&&(B.reach=Ie.reach)}}}}}}function j(){var _={value:null,prev:null,next:null},Y={value:null,prev:_,next:null};_.next=Y,this.head=_,this.tail=Y,this.length=0}function G(_,Y,ct){var X=Y.next,lt={value:ct,prev:Y,next:X};return Y.next=lt,X.prev=lt,_.length++,lt}function W(_,Y,ct){for(var X=Y.next,lt=0;lt<ct&&X!==_.tail;lt++)X=X.next;Y.next=X,X.prev=Y,_.length-=lt}function tt(_){for(var Y=[],ct=_.head.next;ct!==_.tail;)Y.push(ct.value),ct=ct.next;return Y}if(!g.document)return g.addEventListener&&(D.disableWorkerMessageHandler||g.addEventListener("message",function(_){var Y=JSON.parse(_.data),ct=Y.language,X=Y.code,lt=Y.immediateClose;g.postMessage(D.highlight(X,D.languages[ct],ct)),lt&&g.close()},!1)),D;var it=D.util.currentScript();it&&(D.filename=it.src,it.hasAttribute("data-manual")&&(D.manual=!0));function nt(){D.manual||D.highlightAll()}if(!D.manual){var L=document.readyState;L==="loading"||L==="interactive"&&it&&it.defer?document.addEventListener("DOMContentLoaded",nt):window.requestAnimationFrame?window.requestAnimationFrame(nt):window.setTimeout(nt,16)}return D})(r);c.exports&&(c.exports=u),typeof ef<"u"&&(ef.Prism=u),u.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},u.languages.markup.tag.inside["attr-value"].inside.entity=u.languages.markup.entity,u.languages.markup.doctype.inside["internal-subset"].inside=u.languages.markup,u.hooks.add("wrap",function(g){g.type==="entity"&&(g.attributes.title=g.content.replace(/&amp;/,"&"))}),Object.defineProperty(u.languages.markup.tag,"addInlined",{value:function(w,k){var N={};N["language-"+k]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:u.languages[k]},N.cdata=/^<!\[CDATA\[|\]\]>$/i;var D={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:N}};D["language-"+k]={pattern:/[\s\S]+/,inside:u.languages[k]};var E={};E[w]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return w}),"i"),lookbehind:!0,greedy:!0,inside:D},u.languages.insertBefore("markup","cdata",E)}}),Object.defineProperty(u.languages.markup.tag,"addAttribute",{value:function(g,w){u.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+g+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[w,"language-"+w],inside:u.languages[w]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),u.languages.html=u.languages.markup,u.languages.mathml=u.languages.markup,u.languages.svg=u.languages.markup,u.languages.xml=u.languages.extend("markup",{}),u.languages.ssml=u.languages.xml,u.languages.atom=u.languages.xml,u.languages.rss=u.languages.xml,(function(g){var w=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;g.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+w.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+w.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+w.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+w.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:w,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},g.languages.css.atrule.inside.rest=g.languages.css;var k=g.languages.markup;k&&(k.tag.addInlined("style","css"),k.tag.addAttribute("style","css"))})(u),u.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},u.languages.javascript=u.languages.extend("clike",{"class-name":[u.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),u.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,u.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:u.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:u.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:u.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:u.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:u.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),u.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:u.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),u.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),u.languages.markup&&(u.languages.markup.tag.addInlined("script","javascript"),u.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),u.languages.js=u.languages.javascript,(function(){if(typeof u>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var g="Loading",w=function(it,nt){return" Error "+it+" while fetching file: "+nt},k=" Error: File does not exist or is empty",N={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},D="data-src-status",E="loading",U="loaded",F="failed",j="pre[data-src]:not(["+D+'="'+U+'"]):not(['+D+'="'+E+'"])';function G(it,nt,L){var _=new XMLHttpRequest;_.open("GET",it,!0),_.onreadystatechange=function(){_.readyState==4&&(_.status<400&&_.responseText?nt(_.responseText):_.status>=400?L(w(_.status,_.statusText)):L(k))},_.send(null)}function W(it){var nt=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(it||"");if(nt){var L=Number(nt[1]),_=nt[2],Y=nt[3];return _?Y?[L,Number(Y)]:[L,void 0]:[L,L]}}u.hooks.add("before-highlightall",function(it){it.selector+=", "+j}),u.hooks.add("before-sanity-check",function(it){var nt=it.element;if(nt.matches(j)){it.code="",nt.setAttribute(D,E);var L=nt.appendChild(document.createElement("CODE"));L.textContent=g;var _=nt.getAttribute("data-src"),Y=it.language;if(Y==="none"){var ct=(/\.(\w+)$/.exec(_)||[,"none"])[1];Y=N[ct]||ct}u.util.setLanguage(L,Y),u.util.setLanguage(nt,Y);var X=u.plugins.autoloader;X&&X.loadLanguages(Y),G(_,function(lt){nt.setAttribute(D,U);var B=W(nt.getAttribute("data-range"));if(B){var se=lt.split(/\r\n?|\n/g),Yt=B[0],It=B[1]==null?se.length:B[1];Yt<0&&(Yt+=se.length),Yt=Math.max(0,Math.min(Yt-1,se.length)),It<0&&(It+=se.length),It=Math.max(0,Math.min(It,se.length)),lt=se.slice(Yt,It).join(`
`),nt.hasAttribute("data-start")||nt.setAttribute("data-start",String(Yt+1))}L.textContent=lt,u.highlightElement(L)},function(lt){nt.setAttribute(D,F),L.textContent=lt})}}),u.plugins.fileHighlight={highlight:function(nt){for(var L=(nt||document).querySelectorAll(j),_=0,Y;Y=L[_++];)u.highlightElement(Y)}};var tt=!1;u.fileHighlight=function(){tt||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),tt=!0),u.plugins.fileHighlight.highlight.apply(this,arguments)}})()})($h)),$h.exports}var _1=Q1();const lf=Xm(_1);var hf={},cf;function tk(){return cf||(cf=1,Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python,Prism.languages.py=Prism.languages.python),hf}tk();function ek(c){const r=c.parentNode,u=document.createElement("div");u.className="inspector-resizer";const g=document.createElement("div");g.className="inspector",r.append(u,g);const w=r.clientWidth,k=Math.min(w-300,w*.8);c.style.width=`${k}px`,u.style.left=`${k}px`,g.style.left=`${k+u.clientWidth}px`;function N(U){c.style.width=`${U}px`,u.style.left=`${U}px`,g.style.left=`${U+u.clientWidth}px`}u.addEventListener("mousedown",U=>{U.preventDefault();const F=G=>{const W=r.getBoundingClientRect().left;N(Math.max(200,Math.min(G.clientX-W,r.clientWidth-200)))},j=()=>{r.removeEventListener("mousemove",F),r.removeEventListener("mouseup",j)};r.addEventListener("mousemove",F),r.addEventListener("mouseup",j)});let D=w;return new ResizeObserver(U=>{for(const F of U){let j=F.contentRect.width;if(j!==D){const G=parseFloat(c.style.width);N(Math.max(200,Math.min(j-200,j*G/D))),D=j}}}).observe(r),g}function _m(c){const r=document.createElement("div");return r.className="problems",c((u,g)=>{ik(r.parentNode,g)}),r}function ik(c,r){var g;for(const w of Array.from(c.getElementsByClassName("error")))w.classList.remove("error"),w.title="";for(const w of Array.from(c.getElementsByClassName("warning")))w.classList.remove("warning"),w.title="";for(const[w,k,N]of r)for(const D of k.split(",")){let E;if(D.includes("[")){const[U,F]=D.split("["),[j,G]=F.split("]"),W=G.slice(1);E=(g=c.getElementsByClassName(`func-${U}`)[0])==null?void 0:g.getElementsByClassName(`func-var-${W}`)[j]}else E=c.getElementsByClassName(`func-${D}`)[0];E&&(E.classList.add(w),E.title=N)}const u=c.querySelector("div.problems");r.length>0?u.innerHTML='<h3>Problems</h3><ul class="problems">'+r.map(w=>`<li class="${w[0]}">${w[2]}</li>`).join("")+"</ul>":u.innerHTML=""}function yo(c,r){const u=document.createElement("label"),g=document.createElement("span");return g.textContent=r,u.append(g,c),u}function Au(c,r){const u=document.createElement("input");return u.type="checkbox",u.className=`func-${c}`,u.addEventListener("change",g=>{r.set(c,g.target.checked)}),r.listen(c,g=>{u.checked=g}),r.listenRO(c,g=>{u.disabled=g}),u}function Hl(c,r,u={}){const g=document.createElement("textarea");CSS.supports("field-sizing: content")||(g.addEventListener("input",w=>{w.target.style.height="",w.target.style.height=w.target.scrollHeight+5+"px"}),setTimeout(()=>{g.style.height=g.scrollHeight+5+"px"},0)),g.className=`func-${c}`;for(const[w,k]of Object.entries(u))g[w]=k;return g.addEventListener("input",w=>{r.set(c,w.target.value,w.target.selectionStart)}),r.listen(c,w=>{w=(w==null?void 0:w.toString())||"",g.value!==w&&(g.value=w,g.rows=w.trim().split(`
`).length+2)}),r.listenRO(c,w=>{g.readOnly=w}),g}function sk(c,r,u="Function Code",g=`# Write your function code here
`){const w=document.createElement("div");w.className="func-code-box";const k=document.createElement("label");k.textContent=u;const N=Hl(c,r,{placeholder:g});N.classList.add("code-box"),w.append(k,N);const D=document.createElement("div");return D.className=`func-${c} language-python code-box`,r.listen(c,E=>{E=(E==null?void 0:E.toString())||" ",D.innerHTML=lf.highlight(E,lf.languages.python,"python")}),r.listenRO(c,E=>{N.style.display=E?"none":"",D.style.display=E?"":"none"}),w.appendChild(D),w}function Nc(c,r,u,g,w){const k=`show${r.charAt(0).toUpperCase()+r.slice(1)}`,N=sk(r,u,g,w);if(c.adminMode)N.appendChild(yo(Au(k,u),`Show ${g}:`));else{let j=function(){N.style.display=E&&(U||!F)?"":"none"};var D=j;let E=!1,U="",F=!1;u.listen(k,G=>{E=G,j()}),u.listen(r,G=>{U=(G==null?void 0:G.toString())||"",j()}),u.listenRO(r,G=>{F=G,j()})}return N}function tp(c,r){let u=document.createElement("div");u.className="func-readonly";const g=document.createElement("select");g.append(io("all"),io("none"),io("custom")),u.appendChild(yo(g,"Readonly:"));const w=[];for(const N of r){const D=document.createElement("input");D.type="checkbox",D.name=`readonly-${N}`,D.value=N;const E=document.createElement("label"),U=document.createElement("span");U.textContent=N,E.append(D,U),u.appendChild(E),w.push(D)}function k(){c.set("readOnly",g.value!=="custom"?g.value==="all":w.filter(N=>N.checked).map(N=>N.value))}return g.addEventListener("change",k),w.forEach(N=>N.addEventListener("change",k)),c.listen("readOnly",N=>{if(N=N??!1,N===!0||N===!1){g.value=N?"all":"none";for(const D of w)D.checked=N}else{g.value="custom";for(const D of w)D.checked=N.includes(D.value)}}),u}function ms(c,r,u={}){if(u.adminMode)return!1;const g=c.get?c.get("readOnly"):c.readOnly!==void 0?c.readOnly:c;return g===!0||Array.isArray(g)&&g.includes(r)}function nk(c,r){return new pe.Panel("Horizontal",{type:pe.Panel.Horizontal,margin:new pe.Margin(10,6,6,6)}).add(new pe.TextBlock("",{isMultiline:!1,cursor:"pointer",editable:!0,textEditor:rk(c),textEdited:(u,g,w)=>ok(c,u,g,w)}).theme("stroke","stroke").theme("font","text").bindTwoWay("text","name",(u,g)=>u||"function",(u,g,w)=>(u=u.trim().replace(/[^a-zA-Z0-9_]/g,"_"),$r(u)?"":u)),new pe.TextBlock("",{isMultiline:!1,editable:!1,text:"()"}).theme("stroke","stroke").theme("font","text"))}function ok(c,r,u,g){const w=r.part.data;$r(u)&&$r(g)&&(r.diagram.model.setDataProperty(w,"name","<temporary>"),r.diagram.model.setDataProperty(w,"name","")),c.updateFunc(w.key,"name",g)}function $r(c){return!c||c.trim()===""||c.trim()==="function"}function rk(c,r){const u=new pe.HTMLInfo,g=document.createElement("div");g.className="function-name-editor";const w=document.createElement("input");g.appendChild(w);const k=document.createElement("span");k.className="ghost",g.appendChild(k);let N=null,D=null,E=null;function U(){g.classList.remove("error","warning"),g.title="";const j=N.part.data.key,G=w.value,W=Cc(G);W?(g.classList.add(W[0]),g.title=W[2]):Qm(c,j,G)&&(g.classList.add("error"),g.title="Function name must be unique."),k.textContent=G||w.placeholder}w.addEventListener("input",U),w.addEventListener("keydown",j=>{if(!E||j.isComposing)return;const G=j.code;G==="Enter"?E.acceptText(pe.TextEditingAccept.Enter):G==="Tab"?(E.acceptText(pe.TextEditingAccept.Tab),j.preventDefault()):G==="Escape"&&(E.doCancel(),E.diagram&&E.diagram.focus())},!1),w.addEventListener("blur",j=>{E&&E.acceptText(pe.TextEditingAccept.LostFocus)});function F(){if(D&&D.div!==null&&g.parentElement===D.div){const j=N.part.getDocumentPoint(pe.Spot.TopLeft),G=D.transformDocToView(j);g.style.transform="scale("+D.scale+")",g.style.left=G.x+"px",g.style.top=G.y+"px",g.style.minWidth=N.panel.actualBounds.width+3+"px"}}return u.show=(j,G,W)=>{if(!(j instanceof pe.TextBlock))return;const tt=j.part.data;N=j,D=G,E=W,w.readOnly=ms(tt.readOnly??!1,"name"),w.placeholder="function",w.value=$r(tt.name)?"":tt.name,g.style.backgroundColor=`color-mix(in srgb, var(--bg-${tt.testable?"testable":tt.io||"none"}-color) 70%, var(--text-color))`,U(),G.div!==null&&(G.div.appendChild(g),G.addDiagramListener("ViewportBoundsChanged",F),F()),w.focus(),w.select()},u.hide=(j,G)=>{j.div!==null&&(j.div.removeChild(g),j.removeDiagramListener("ViewportBoundsChanged",F)),N=null,D=null,E=null},u.valueFunction=()=>w.value.trim().replace(/[^a-zA-Z0-9_]/g,"_"),u}const ak={name:"",params:[],returns:[],description:"",code:"",io:"none",testable:!1,readOnly:!1};function lk(c,r,u={}){const g=document.createElement("div");g.className="diagram",c.appendChild(g);let w=!1;const k=new pe.Diagram(g,{allowCopy:!1,allowMove:!1,allowSelect:!0,allowDelete:!0,initialAutoScale:pe.AutoScale.Uniform,defaultScale:1.5,padding:125,maxSelectionCount:1,layout:new pe.LayeredDigraphLayout({direction:90,layerSpacing:50,columnSpacing:30}),"toolManager.hoverDelay":200,"toolManager.toolTipDuration":1e10});k.themeManager.set("light",{colors:{text:"#111827",link:"#111827",stroke:"#111827","stroke-error":"#dc2626","stroke-warning":"#f59e0b",shadow:"#9ca3af",selection:"#0ea5e9","selection-trans":"rgba(14, 165, 233, 0.5)",tempLink:"#309e70",tempPort:"#309e70","bg-testable":"#090","bg-validation":"#f60","bg-input":"#f90","bg-output":"#09f","bg-indirect":"#d1d5db","bg-none":"#d1d5db","bg-undefined":"#ff0000"},fonts:{text:"14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",normal:"14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",bold:"bold 14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",title:"2.5rem InterVariable, sans-serif"},numbers:{selection:2}}),k.themeManager.set("dark",{colors:{text:"#f3f4f6",link:"#f3f4f6",stroke:"#f3f4f6",shadow:"#6b7280",tempLink:"#61ca9e",tempPort:"#61ca9e","bg-indirect":"#374151","bg-none":"#374151"}});function N(j){return j.some(G=>G[0]==="error")?"stroke-error":j.length>0?"stroke-warning":"stroke"}function D(j,G){return N((G.part.data.problems||[]).concat(G.part.data.linkProblems||[]))}k.nodeTemplate=new pe.Node("Spot",{locationSpot:pe.Spot.Center,isShadowed:!0,shadowOffset:new pe.Point(0,2),selectionObjectName:"BODY",toolTip:hk(c),mouseEnter:(j,G)=>(G.findObject("BUTTON_EXPAND")??{}).opacity=1,mouseLeave:(j,G)=>(G.findObject("BUTTON_EXPAND")??{}).opacity=G.isSelected?1:0}).add(new pe.Panel("Auto",{name:"BODY"}).add(new pe.Shape("RoundedRectangle",{name:"SHAPE",strokeWidth:2,cursor:"crosshair",portId:"",fromLinkable:!0,fromLinkableSelfNode:!0,fromLinkableDuplicates:!1,toLinkable:!0,toLinkableSelfNode:!0,toLinkableDuplicates:!1}).theme("fill","bg-none").themeData("fill","testable",null,(j,G)=>j?"bg-testable":`bg-${G.part.data.io||"none"}`).themeData("fill","io",null,(j,G)=>G.part.data.testable?"bg-testable":`bg-${j||"none"}`).themeData("stroke","problems",null,D).themeData("stroke","linkProblems",null,D).bind("fromLinkable","readOnly",j=>!Hn(j)).bind("cursor","readOnly",j=>Hn(j)?"pointer":"crosshair").bind("toLinkable","readOnly",j=>!To(j)),nk(r))).theme("shadowColor","shadow").bindObject("layerName","isSelected",j=>j?"Foreground":"").bind("deletable","readOnly",j=>!j),tu&&k.nodeTemplate.add(pe.GraphObject.build("TreeExpanderButton",{alignment:pe.Spot.Bottom,alignmentFocus:pe.Spot.Center,_treeExpandedFigure:"LineUp",_treeCollapsedFigure:"LineDown",name:"BUTTON_EXPAND",opacity:0}).bindObject("opacity","isSelected",j=>j?1:0)),k.linkTemplate=new pe.Link({toShortLength:3,relinkableFrom:!0,relinkableTo:!0,deletable:!0,routing:pe.Routing.Orthogonal,corner:10,layerName:"Background",doubleClick:(j,G)=>{const W=G.fromNode,tt=G.toNode;if(To(W.data.readOnly)||Hn(tt.data.readOnly)||To(tt.data.readOnly)||Hn(W.data.readOnly)||r.calls.has(`${tt.data.key}-${W.data.key}`))return!1;w=!0,r.updateFuncCall(W.data.key,tt.data.key,tt.data.key,W.data.key),w=!1,Wm(r,u)}}).add(new pe.Shape({strokeWidth:2}).themeData("stroke","problems",null,N),new pe.Shape({toArrow:"Standard",scale:1.4,stroke:null}).themeData("fill","problems",null,N));const E=new Y1;E.linkSpacing=10,k.routers.add(E),k.toolManager.relinkingTool.fromHandleArchetype=new pe.Shape("Diamond",{width:12,height:12,segmentIndex:0,cursor:"pointer"}).theme("fill","selection-trans"),k.toolManager.relinkingTool.toHandleArchetype=new pe.Shape("Diamond",{width:12,height:12,segmentIndex:-1,cursor:"pointer"}).theme("fill","selection-trans");function U(j,G,W,tt,it){return!(To(W.data.readOnly)||Hn(j.data.readOnly)||it&&it.fromNode!==j&&To(it.fromNode.data.readOnly)||it&&it.toNode!==W&&Hn(it.toNode.data.readOnly)||!eu&&q1(r,j.data.key,W.data.key))}k.toolManager.linkingTool.linkValidation=U,k.toolManager.relinkingTool.linkValidation=U,k.commandHandler.canDeleteSelection=()=>u.adminMode||!k.selection.any(j=>j instanceof pe.Link&&(Hn(j.fromNode.data.readOnly)||To(j.toNode.data.readOnly))),u.title&&k.add(new pe.Part({layerName:"ViewportBackground",alignment:pe.Spot.Top}).add(new pe.TextBlock(u.title,{margin:20}).theme("font","title").theme("stroke","text"))),k.commandHandler.deleteSelection=function(){const j=[],G=[];k.selection.each(W=>{W instanceof pe.Node?j.push(W.data.key):W instanceof pe.Link&&G.push(W.data)}),k.clearSelection(),r.removeFuncs(j),r.removeFuncCalls(G)};function F(j){if(j.change===pe.ChangeType.Insert&&j.propertyName==="linkDataArray"){const{from:G,to:W}=j.newValue;r.addFuncCall(G,W)}else if(j.change===pe.ChangeType.Remove&&j.propertyName==="linkDataArray"){const{from:G,to:W}=j.oldValue;r.removeFuncCall(G,W)}else if(j.change===pe.ChangeType.Property){if(j.modelChange==="linkToKey"){const G=j.object.from,W=j.oldValue,tt=j.newValue;r.updateFuncCall(G,W,null,tt)}else if(j.modelChange==="linkFromKey"){const G=j.oldValue,W=j.newValue,tt=j.object.to;r.updateFuncCall(G,tt,W,null)}}}return k.addModelChangedListener(j=>{if(!w)if(k.undoManager.isEnabled){if(!j.isTransactionFinished||j.object==null||j.object.name!=="Linking"&&j.object.name!=="Relinking")return;for(const G of j.object.changes)F(G)}else r.synced&&F(j)}),r.addFuncAddListener((j,G)=>{(!("name"in G)||$r(G.name))&&(G.name="function"),k.model.addNodeData({...G,key:j}),r.synced&&k.select(k.findNodeForKey(j))}),r.addFuncRemoveListener(j=>{const G=k.findNodeForKey(j);G&&(k.selection.contains(G)&&k.clearSelection(),k.model.removeNodeData(G.data))}),r.addFuncListener("",(j,G,W)=>{var it;const tt=k.findNodeForKey(j);tt&&(W=W??ak[G],G==="name"&&(W=(it=W==null?void 0:W.toString())==null?void 0:it.trim(),W===""&&(W="function")),k.model.setDataProperty(tt.data,G,W))}),r.addFuncListener("problems",(j,G,W)=>{const tt=k.findNodeForKey(j);tt&&k.model.setDataProperty(tt.data,"problems",W)}),r.addFuncListener("linkProblems",(j,G,W)=>{const tt=k.findNodeForKey(j);tt&&k.model.setDataProperty(tt.data,"linkProblems",W)}),r.addFuncCallListener((j,G,W,tt,it)=>{if(j==="add")k.findLinksByExample({from:tt,to:it}).count===0&&k.model.addLinkData({from:tt,to:it});else{const nt=k.findLinksByExample({from:G,to:W}).first();nt&&(j==="problems"?k.model.setDataProperty(nt.data,"problems",[...tt]):j==="delete"?k.model.removeLinkData(nt.data):j==="update"&&(tt!==G&&k.model.setDataProperty(nt.data,"from",tt),it!==W&&k.model.setDataProperty(nt.data,"to",it)))}}),k}function hk(c){function r(g){let w="<code>"+vg(g.name||"function",g.params||[],g.returns||[],!0,!0)+"</code>";const k=(g.problems||[]).concat(g.linkProblems||[]);if(k.length>0){w+="<ul class='problems'>";for(const[N,D,E]of k)w+=`<li class="${N}">${E}</li>`;w+="</ul>"}return w}const u=document.createElement("div");return u.className="tooltip-content",u.style.display="none",c.appendChild(u),new pe.HTMLInfo({mainElement:u,show:(g,w,k)=>{const N=w.transformDocToView(g.part.findObject("SHAPE").getDocumentPoint(pe.Spot.BottomLeft));u.style.left=`${N.x}px`,u.style.top=`${N.y+10}px`;const D=r(g.part.data);return u.innerHTML=D,u.style.display="block",u},hide:(g,w)=>{u.style.display="none"}})}function To(c){return c===!0||Array.isArray(c)&&(c.includes("callsInto")||c.includes("calls"))}function Hn(c){return c===!0||Array.isArray(c)&&(c.includes("callsOutOf")||c.includes("calls"))}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function uf(c,r){var u=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);r&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),u.push.apply(u,g)}return u}function Js(c){for(var r=1;r<arguments.length;r++){var u=arguments[r]!=null?arguments[r]:{};r%2?uf(Object(u),!0).forEach(function(g){ck(c,g,u[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):uf(Object(u)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(u,g))})}return c}function Ka(c){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ka=function(r){return typeof r}:Ka=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ka(c)}function ck(c,r,u){return r in c?Object.defineProperty(c,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[r]=u,c}function un(){return un=Object.assign||function(c){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&(c[g]=u[g])}return c},un.apply(this,arguments)}function uk(c,r){if(c==null)return{};var u={},g=Object.keys(c),w,k;for(k=0;k<g.length;k++)w=g[k],!(r.indexOf(w)>=0)&&(u[w]=c[w]);return u}function dk(c,r){if(c==null)return{};var u=uk(c,r),g,w;if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(c);for(w=0;w<k.length;w++)g=k[w],!(r.indexOf(g)>=0)&&Object.prototype.propertyIsEnumerable.call(c,g)&&(u[g]=c[g])}return u}var fk="1.15.6";function hn(c){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(c)}var mn=hn(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),aa=hn(/Edge/i),df=hn(/firefox/i),Dr=hn(/safari/i)&&!hn(/chrome/i)&&!hn(/android/i),Tu=hn(/iP(ad|od|hone)/i),ep=hn(/chrome/i)&&hn(/android/i),ip={capture:!1,passive:!1};function Me(c,r,u){c.addEventListener(r,u,!mn&&ip)}function ke(c,r,u){c.removeEventListener(r,u,!mn&&ip)}function kl(c,r){if(r){if(r[0]===">"&&(r=r.substring(1)),c)try{if(c.matches)return c.matches(r);if(c.msMatchesSelector)return c.msMatchesSelector(r);if(c.webkitMatchesSelector)return c.webkitMatchesSelector(r)}catch{return!1}return!1}}function sp(c){return c.host&&c!==document&&c.host.nodeType?c.host:c.parentNode}function Es(c,r,u,g){if(c){u=u||document;do{if(r!=null&&(r[0]===">"?c.parentNode===u&&kl(c,r):kl(c,r))||g&&c===u)return c;if(c===u)break}while(c=sp(c))}return null}var ff=/\s+/g;function es(c,r,u){if(c&&r)if(c.classList)c.classList[u?"add":"remove"](r);else{var g=(" "+c.className+" ").replace(ff," ").replace(" "+r+" "," ");c.className=(g+(u?" "+r:"")).replace(ff," ")}}function ce(c,r,u){var g=c&&c.style;if(g){if(u===void 0)return document.defaultView&&document.defaultView.getComputedStyle?u=document.defaultView.getComputedStyle(c,""):c.currentStyle&&(u=c.currentStyle),r===void 0?u:u[r];!(r in g)&&r.indexOf("webkit")===-1&&(r="-webkit-"+r),g[r]=u+(typeof u=="string"?"":"px")}}function Xo(c,r){var u="";if(typeof c=="string")u=c;else do{var g=ce(c,"transform");g&&g!=="none"&&(u=g+" "+u)}while(!r&&(c=c.parentNode));var w=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return w&&new w(u)}function np(c,r,u){if(c){var g=c.getElementsByTagName(r),w=0,k=g.length;if(u)for(;w<k;w++)u(g[w],w);return g}return[]}function Gs(){var c=document.scrollingElement;return c||document.documentElement}function di(c,r,u,g,w){if(!(!c.getBoundingClientRect&&c!==window)){var k,N,D,E,U,F,j;if(c!==window&&c.parentNode&&c!==Gs()?(k=c.getBoundingClientRect(),N=k.top,D=k.left,E=k.bottom,U=k.right,F=k.height,j=k.width):(N=0,D=0,E=window.innerHeight,U=window.innerWidth,F=window.innerHeight,j=window.innerWidth),(r||u)&&c!==window&&(w=w||c.parentNode,!mn))do if(w&&w.getBoundingClientRect&&(ce(w,"transform")!=="none"||u&&ce(w,"position")!=="static")){var G=w.getBoundingClientRect();N-=G.top+parseInt(ce(w,"border-top-width")),D-=G.left+parseInt(ce(w,"border-left-width")),E=N+k.height,U=D+k.width;break}while(w=w.parentNode);if(g&&c!==window){var W=Xo(w||c),tt=W&&W.a,it=W&&W.d;W&&(N/=it,D/=tt,j/=tt,F/=it,E=N+F,U=D+j)}return{top:N,left:D,bottom:E,right:U,width:j,height:F}}}function gf(c,r,u){for(var g=Vn(c,!0),w=di(c)[r];g;){var k=di(g)[u],N=void 0;if(N=w>=k,!N)return g;if(g===Gs())break;g=Vn(g,!1)}return!1}function er(c,r,u,g){for(var w=0,k=0,N=c.children;k<N.length;){if(N[k].style.display!=="none"&&N[k]!==ue.ghost&&(g||N[k]!==ue.dragged)&&Es(N[k],u.draggable,c,!1)){if(w===r)return N[k];w++}k++}return null}function Du(c,r){for(var u=c.lastElementChild;u&&(u===ue.ghost||ce(u,"display")==="none"||r&&!kl(u,r));)u=u.previousElementSibling;return u||null}function ps(c,r){var u=0;if(!c||!c.parentNode)return-1;for(;c=c.previousElementSibling;)c.nodeName.toUpperCase()!=="TEMPLATE"&&c!==ue.clone&&(!r||kl(c,r))&&u++;return u}function mf(c){var r=0,u=0,g=Gs();if(c)do{var w=Xo(c),k=w.a,N=w.d;r+=c.scrollLeft*k,u+=c.scrollTop*N}while(c!==g&&(c=c.parentNode));return[r,u]}function gk(c,r){for(var u in c)if(c.hasOwnProperty(u)){for(var g in r)if(r.hasOwnProperty(g)&&r[g]===c[u][g])return Number(u)}return-1}function Vn(c,r){if(!c||!c.getBoundingClientRect)return Gs();var u=c,g=!1;do if(u.clientWidth<u.scrollWidth||u.clientHeight<u.scrollHeight){var w=ce(u);if(u.clientWidth<u.scrollWidth&&(w.overflowX=="auto"||w.overflowX=="scroll")||u.clientHeight<u.scrollHeight&&(w.overflowY=="auto"||w.overflowY=="scroll")){if(!u.getBoundingClientRect||u===document.body)return Gs();if(g||r)return u;g=!0}}while(u=u.parentNode);return Gs()}function mk(c,r){if(c&&r)for(var u in r)r.hasOwnProperty(u)&&(c[u]=r[u]);return c}function Hh(c,r){return Math.round(c.top)===Math.round(r.top)&&Math.round(c.left)===Math.round(r.left)&&Math.round(c.height)===Math.round(r.height)&&Math.round(c.width)===Math.round(r.width)}var Lr;function op(c,r){return function(){if(!Lr){var u=arguments,g=this;u.length===1?c.call(g,u[0]):c.apply(g,u),Lr=setTimeout(function(){Lr=void 0},r)}}}function pk(){clearTimeout(Lr),Lr=void 0}function rp(c,r,u){c.scrollLeft+=r,c.scrollTop+=u}function ap(c){var r=window.Polymer,u=window.jQuery||window.Zepto;return r&&r.dom?r.dom(c).cloneNode(!0):u?u(c).clone(!0)[0]:c.cloneNode(!0)}function lp(c,r,u){var g={};return Array.from(c.children).forEach(function(w){var k,N,D,E;if(!(!Es(w,r.draggable,c,!1)||w.animated||w===u)){var U=di(w);g.left=Math.min((k=g.left)!==null&&k!==void 0?k:1/0,U.left),g.top=Math.min((N=g.top)!==null&&N!==void 0?N:1/0,U.top),g.right=Math.max((D=g.right)!==null&&D!==void 0?D:-1/0,U.right),g.bottom=Math.max((E=g.bottom)!==null&&E!==void 0?E:-1/0,U.bottom)}}),g.width=g.right-g.left,g.height=g.bottom-g.top,g.x=g.left,g.y=g.top,g}var qi="Sortable"+new Date().getTime();function yk(){var c=[],r;return{captureAnimationState:function(){if(c=[],!!this.options.animation){var g=[].slice.call(this.el.children);g.forEach(function(w){if(!(ce(w,"display")==="none"||w===ue.ghost)){c.push({target:w,rect:di(w)});var k=Js({},c[c.length-1].rect);if(w.thisAnimationDuration){var N=Xo(w,!0);N&&(k.top-=N.f,k.left-=N.e)}w.fromRect=k}})}},addAnimationState:function(g){c.push(g)},removeAnimationState:function(g){c.splice(gk(c,{target:g}),1)},animateAll:function(g){var w=this;if(!this.options.animation){clearTimeout(r),typeof g=="function"&&g();return}var k=!1,N=0;c.forEach(function(D){var E=0,U=D.target,F=U.fromRect,j=di(U),G=U.prevFromRect,W=U.prevToRect,tt=D.rect,it=Xo(U,!0);it&&(j.top-=it.f,j.left-=it.e),U.toRect=j,U.thisAnimationDuration&&Hh(G,j)&&!Hh(F,j)&&(tt.top-j.top)/(tt.left-j.left)===(F.top-j.top)/(F.left-j.left)&&(E=bk(tt,G,W,w.options)),Hh(j,F)||(U.prevFromRect=F,U.prevToRect=j,E||(E=w.options.animation),w.animate(U,tt,j,E)),E&&(k=!0,N=Math.max(N,E),clearTimeout(U.animationResetTimer),U.animationResetTimer=setTimeout(function(){U.animationTime=0,U.prevFromRect=null,U.fromRect=null,U.prevToRect=null,U.thisAnimationDuration=null},E),U.thisAnimationDuration=E)}),clearTimeout(r),k?r=setTimeout(function(){typeof g=="function"&&g()},N):typeof g=="function"&&g(),c=[]},animate:function(g,w,k,N){if(N){ce(g,"transition",""),ce(g,"transform","");var D=Xo(this.el),E=D&&D.a,U=D&&D.d,F=(w.left-k.left)/(E||1),j=(w.top-k.top)/(U||1);g.animatingX=!!F,g.animatingY=!!j,ce(g,"transform","translate3d("+F+"px,"+j+"px,0)"),this.forRepaintDummy=wk(g),ce(g,"transition","transform "+N+"ms"+(this.options.easing?" "+this.options.easing:"")),ce(g,"transform","translate3d(0,0,0)"),typeof g.animated=="number"&&clearTimeout(g.animated),g.animated=setTimeout(function(){ce(g,"transition",""),ce(g,"transform",""),g.animated=!1,g.animatingX=!1,g.animatingY=!1},N)}}}}function wk(c){return c.offsetWidth}function bk(c,r,u,g){return Math.sqrt(Math.pow(r.top-c.top,2)+Math.pow(r.left-c.left,2))/Math.sqrt(Math.pow(r.top-u.top,2)+Math.pow(r.left-u.left,2))*g.animation}var Do=[],qh={initializeByDefault:!0},la={mount:function(r){for(var u in qh)qh.hasOwnProperty(u)&&!(u in r)&&(r[u]=qh[u]);Do.forEach(function(g){if(g.pluginName===r.pluginName)throw"Sortable: Cannot mount plugin ".concat(r.pluginName," more than once")}),Do.push(r)},pluginEvent:function(r,u,g){var w=this;this.eventCanceled=!1,g.cancel=function(){w.eventCanceled=!0};var k=r+"Global";Do.forEach(function(N){u[N.pluginName]&&(u[N.pluginName][k]&&u[N.pluginName][k](Js({sortable:u},g)),u.options[N.pluginName]&&u[N.pluginName][r]&&u[N.pluginName][r](Js({sortable:u},g)))})},initializePlugins:function(r,u,g,w){Do.forEach(function(D){var E=D.pluginName;if(!(!r.options[E]&&!D.initializeByDefault)){var U=new D(r,u,r.options);U.sortable=r,U.options=r.options,r[E]=U,un(g,U.defaults)}});for(var k in r.options)if(r.options.hasOwnProperty(k)){var N=this.modifyOption(r,k,r.options[k]);typeof N<"u"&&(r.options[k]=N)}},getEventProperties:function(r,u){var g={};return Do.forEach(function(w){typeof w.eventProperties=="function"&&un(g,w.eventProperties.call(u[w.pluginName],r))}),g},modifyOption:function(r,u,g){var w;return Do.forEach(function(k){r[k.pluginName]&&k.optionListeners&&typeof k.optionListeners[u]=="function"&&(w=k.optionListeners[u].call(r[k.pluginName],g))}),w}};function xk(c){var r=c.sortable,u=c.rootEl,g=c.name,w=c.targetEl,k=c.cloneEl,N=c.toEl,D=c.fromEl,E=c.oldIndex,U=c.newIndex,F=c.oldDraggableIndex,j=c.newDraggableIndex,G=c.originalEvent,W=c.putSortable,tt=c.extraEventProperties;if(r=r||u&&u[qi],!!r){var it,nt=r.options,L="on"+g.charAt(0).toUpperCase()+g.substr(1);window.CustomEvent&&!mn&&!aa?it=new CustomEvent(g,{bubbles:!0,cancelable:!0}):(it=document.createEvent("Event"),it.initEvent(g,!0,!0)),it.to=N||u,it.from=D||u,it.item=w||u,it.clone=k,it.oldIndex=E,it.newIndex=U,it.oldDraggableIndex=F,it.newDraggableIndex=j,it.originalEvent=G,it.pullMode=W?W.lastPutMode:void 0;var _=Js(Js({},tt),la.getEventProperties(g,r));for(var Y in _)it[Y]=_[Y];u&&u.dispatchEvent(it),nt[L]&&nt[L].call(r,it)}}var vk=["evt"],$i=function(r,u){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=g.evt,k=dk(g,vk);la.pluginEvent.bind(ue)(r,u,Js({dragEl:jt,parentEl:ri,ghostEl:fe,rootEl:ei,nextEl:Jn,lastDownEl:Ga,cloneEl:ni,cloneHidden:An,dragStarted:Cr,putSortable:Mi,activeSortable:ue.active,originalEvent:w,oldIndex:Io,oldDraggableIndex:Er,newIndex:is,newDraggableIndex:Cn,hideGhostForTarget:dp,unhideGhostForTarget:fp,cloneNowHidden:function(){An=!0},cloneNowShown:function(){An=!1},dispatchSortableEvent:function(D){Bi({sortable:u,name:D,originalEvent:w})}},k))};function Bi(c){xk(Js({putSortable:Mi,cloneEl:ni,targetEl:jt,rootEl:ei,oldIndex:Io,oldDraggableIndex:Er,newIndex:is,newDraggableIndex:Cn},c))}var jt,ri,fe,ei,Jn,Ga,ni,An,Io,is,Er,Cn,Ma,Mi,Fo=!1,Sl=!1,Pl=[],qn,As,Wh,Jh,pf,yf,Cr,Lo,Fr,Or=!1,Ca=!1,$a,Di,Zh=[],Ac=!1,Ml=[],ql=typeof document<"u",Na=Tu,wf=aa||mn?"cssFloat":"float",kk=ql&&!ep&&!Tu&&"draggable"in document.createElement("div"),hp=(function(){if(ql){if(mn)return!1;var c=document.createElement("x");return c.style.cssText="pointer-events:auto",c.style.pointerEvents==="auto"}})(),cp=function(r,u){var g=ce(r),w=parseInt(g.width)-parseInt(g.paddingLeft)-parseInt(g.paddingRight)-parseInt(g.borderLeftWidth)-parseInt(g.borderRightWidth),k=er(r,0,u),N=er(r,1,u),D=k&&ce(k),E=N&&ce(N),U=D&&parseInt(D.marginLeft)+parseInt(D.marginRight)+di(k).width,F=E&&parseInt(E.marginLeft)+parseInt(E.marginRight)+di(N).width;if(g.display==="flex")return g.flexDirection==="column"||g.flexDirection==="column-reverse"?"vertical":"horizontal";if(g.display==="grid")return g.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(k&&D.float&&D.float!=="none"){var j=D.float==="left"?"left":"right";return N&&(E.clear==="both"||E.clear===j)?"vertical":"horizontal"}return k&&(D.display==="block"||D.display==="flex"||D.display==="table"||D.display==="grid"||U>=w&&g[wf]==="none"||N&&g[wf]==="none"&&U+F>w)?"vertical":"horizontal"},Sk=function(r,u,g){var w=g?r.left:r.top,k=g?r.right:r.bottom,N=g?r.width:r.height,D=g?u.left:u.top,E=g?u.right:u.bottom,U=g?u.width:u.height;return w===D||k===E||w+N/2===D+U/2},Pk=function(r,u){var g;return Pl.some(function(w){var k=w[qi].options.emptyInsertThreshold;if(!(!k||Du(w))){var N=di(w),D=r>=N.left-k&&r<=N.right+k,E=u>=N.top-k&&u<=N.bottom+k;if(D&&E)return g=w}}),g},up=function(r){function u(k,N){return function(D,E,U,F){var j=D.options.group.name&&E.options.group.name&&D.options.group.name===E.options.group.name;if(k==null&&(N||j))return!0;if(k==null||k===!1)return!1;if(N&&k==="clone")return k;if(typeof k=="function")return u(k(D,E,U,F),N)(D,E,U,F);var G=(N?D:E).options.group.name;return k===!0||typeof k=="string"&&k===G||k.join&&k.indexOf(G)>-1}}var g={},w=r.group;(!w||Ka(w)!="object")&&(w={name:w}),g.name=w.name,g.checkPull=u(w.pull,!0),g.checkPut=u(w.put),g.revertClone=w.revertClone,r.group=g},dp=function(){!hp&&fe&&ce(fe,"display","none")},fp=function(){!hp&&fe&&ce(fe,"display","")};ql&&!ep&&document.addEventListener("click",function(c){if(Sl)return c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.stopImmediatePropagation&&c.stopImmediatePropagation(),Sl=!1,!1},!0);var Wn=function(r){if(jt){r=r.touches?r.touches[0]:r;var u=Pk(r.clientX,r.clientY);if(u){var g={};for(var w in r)r.hasOwnProperty(w)&&(g[w]=r[w]);g.target=g.rootEl=u,g.preventDefault=void 0,g.stopPropagation=void 0,u[qi]._onDragOver(g)}}},Mk=function(r){jt&&jt.parentNode[qi]._isOutsideThisEl(r.target)};function ue(c,r){if(!(c&&c.nodeType&&c.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(c));this.el=c,this.options=r=un({},r),c[qi]=this;var u={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(c.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return cp(c,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(N,D){N.setData("Text",D.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ue.supportPointer!==!1&&"PointerEvent"in window&&(!Dr||Tu),emptyInsertThreshold:5};la.initializePlugins(this,c,u);for(var g in u)!(g in r)&&(r[g]=u[g]);up(r);for(var w in this)w.charAt(0)==="_"&&typeof this[w]=="function"&&(this[w]=this[w].bind(this));this.nativeDraggable=r.forceFallback?!1:kk,this.nativeDraggable&&(this.options.touchStartThreshold=1),r.supportPointer?Me(c,"pointerdown",this._onTapStart):(Me(c,"mousedown",this._onTapStart),Me(c,"touchstart",this._onTapStart)),this.nativeDraggable&&(Me(c,"dragover",this),Me(c,"dragenter",this)),Pl.push(this.el),r.store&&r.store.get&&this.sort(r.store.get(this)||[]),un(this,yk())}ue.prototype={constructor:ue,_isOutsideThisEl:function(r){!this.el.contains(r)&&r!==this.el&&(Lo=null)},_getDirection:function(r,u){return typeof this.options.direction=="function"?this.options.direction.call(this,r,u,jt):this.options.direction},_onTapStart:function(r){if(r.cancelable){var u=this,g=this.el,w=this.options,k=w.preventOnFilter,N=r.type,D=r.touches&&r.touches[0]||r.pointerType&&r.pointerType==="touch"&&r,E=(D||r).target,U=r.target.shadowRoot&&(r.path&&r.path[0]||r.composedPath&&r.composedPath()[0])||E,F=w.filter;if(Fk(g),!jt&&!(/mousedown|pointerdown/.test(N)&&r.button!==0||w.disabled)&&!U.isContentEditable&&!(!this.nativeDraggable&&Dr&&E&&E.tagName.toUpperCase()==="SELECT")&&(E=Es(E,w.draggable,g,!1),!(E&&E.animated)&&Ga!==E)){if(Io=ps(E),Er=ps(E,w.draggable),typeof F=="function"){if(F.call(this,r,E,this)){Bi({sortable:u,rootEl:U,name:"filter",targetEl:E,toEl:g,fromEl:g}),$i("filter",u,{evt:r}),k&&r.preventDefault();return}}else if(F&&(F=F.split(",").some(function(j){if(j=Es(U,j.trim(),g,!1),j)return Bi({sortable:u,rootEl:j,name:"filter",targetEl:E,fromEl:g,toEl:g}),$i("filter",u,{evt:r}),!0}),F)){k&&r.preventDefault();return}w.handle&&!Es(U,w.handle,g,!1)||this._prepareDragStart(r,D,E)}}},_prepareDragStart:function(r,u,g){var w=this,k=w.el,N=w.options,D=k.ownerDocument,E;if(g&&!jt&&g.parentNode===k){var U=di(g);if(ei=k,jt=g,ri=jt.parentNode,Jn=jt.nextSibling,Ga=g,Ma=N.group,ue.dragged=jt,qn={target:jt,clientX:(u||r).clientX,clientY:(u||r).clientY},pf=qn.clientX-U.left,yf=qn.clientY-U.top,this._lastX=(u||r).clientX,this._lastY=(u||r).clientY,jt.style["will-change"]="all",E=function(){if($i("delayEnded",w,{evt:r}),ue.eventCanceled){w._onDrop();return}w._disableDelayedDragEvents(),!df&&w.nativeDraggable&&(jt.draggable=!0),w._triggerDragStart(r,u),Bi({sortable:w,name:"choose",originalEvent:r}),es(jt,N.chosenClass,!0)},N.ignore.split(",").forEach(function(F){np(jt,F.trim(),Qh)}),Me(D,"dragover",Wn),Me(D,"mousemove",Wn),Me(D,"touchmove",Wn),N.supportPointer?(Me(D,"pointerup",w._onDrop),!this.nativeDraggable&&Me(D,"pointercancel",w._onDrop)):(Me(D,"mouseup",w._onDrop),Me(D,"touchend",w._onDrop),Me(D,"touchcancel",w._onDrop)),df&&this.nativeDraggable&&(this.options.touchStartThreshold=4,jt.draggable=!0),$i("delayStart",this,{evt:r}),N.delay&&(!N.delayOnTouchOnly||u)&&(!this.nativeDraggable||!(aa||mn))){if(ue.eventCanceled){this._onDrop();return}N.supportPointer?(Me(D,"pointerup",w._disableDelayedDrag),Me(D,"pointercancel",w._disableDelayedDrag)):(Me(D,"mouseup",w._disableDelayedDrag),Me(D,"touchend",w._disableDelayedDrag),Me(D,"touchcancel",w._disableDelayedDrag)),Me(D,"mousemove",w._delayedDragTouchMoveHandler),Me(D,"touchmove",w._delayedDragTouchMoveHandler),N.supportPointer&&Me(D,"pointermove",w._delayedDragTouchMoveHandler),w._dragStartTimer=setTimeout(E,N.delay)}else E()}},_delayedDragTouchMoveHandler:function(r){var u=r.touches?r.touches[0]:r;Math.max(Math.abs(u.clientX-this._lastX),Math.abs(u.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){jt&&Qh(jt),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var r=this.el.ownerDocument;ke(r,"mouseup",this._disableDelayedDrag),ke(r,"touchend",this._disableDelayedDrag),ke(r,"touchcancel",this._disableDelayedDrag),ke(r,"pointerup",this._disableDelayedDrag),ke(r,"pointercancel",this._disableDelayedDrag),ke(r,"mousemove",this._delayedDragTouchMoveHandler),ke(r,"touchmove",this._delayedDragTouchMoveHandler),ke(r,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(r,u){u=u||r.pointerType=="touch"&&r,!this.nativeDraggable||u?this.options.supportPointer?Me(document,"pointermove",this._onTouchMove):u?Me(document,"touchmove",this._onTouchMove):Me(document,"mousemove",this._onTouchMove):(Me(jt,"dragend",this),Me(ei,"dragstart",this._onDragStart));try{document.selection?Ha(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(r,u){if(Fo=!1,ei&&jt){$i("dragStarted",this,{evt:u}),this.nativeDraggable&&Me(document,"dragover",Mk);var g=this.options;!r&&es(jt,g.dragClass,!1),es(jt,g.ghostClass,!0),ue.active=this,r&&this._appendGhost(),Bi({sortable:this,name:"start",originalEvent:u})}else this._nulling()},_emulateDragOver:function(){if(As){this._lastX=As.clientX,this._lastY=As.clientY,dp();for(var r=document.elementFromPoint(As.clientX,As.clientY),u=r;r&&r.shadowRoot&&(r=r.shadowRoot.elementFromPoint(As.clientX,As.clientY),r!==u);)u=r;if(jt.parentNode[qi]._isOutsideThisEl(r),u)do{if(u[qi]){var g=void 0;if(g=u[qi]._onDragOver({clientX:As.clientX,clientY:As.clientY,target:r,rootEl:u}),g&&!this.options.dragoverBubble)break}r=u}while(u=sp(u));fp()}},_onTouchMove:function(r){if(qn){var u=this.options,g=u.fallbackTolerance,w=u.fallbackOffset,k=r.touches?r.touches[0]:r,N=fe&&Xo(fe,!0),D=fe&&N&&N.a,E=fe&&N&&N.d,U=Na&&Di&&mf(Di),F=(k.clientX-qn.clientX+w.x)/(D||1)+(U?U[0]-Zh[0]:0)/(D||1),j=(k.clientY-qn.clientY+w.y)/(E||1)+(U?U[1]-Zh[1]:0)/(E||1);if(!ue.active&&!Fo){if(g&&Math.max(Math.abs(k.clientX-this._lastX),Math.abs(k.clientY-this._lastY))<g)return;this._onDragStart(r,!0)}if(fe){N?(N.e+=F-(Wh||0),N.f+=j-(Jh||0)):N={a:1,b:0,c:0,d:1,e:F,f:j};var G="matrix(".concat(N.a,",").concat(N.b,",").concat(N.c,",").concat(N.d,",").concat(N.e,",").concat(N.f,")");ce(fe,"webkitTransform",G),ce(fe,"mozTransform",G),ce(fe,"msTransform",G),ce(fe,"transform",G),Wh=F,Jh=j,As=k}r.cancelable&&r.preventDefault()}},_appendGhost:function(){if(!fe){var r=this.options.fallbackOnBody?document.body:ei,u=di(jt,!0,Na,!0,r),g=this.options;if(Na){for(Di=r;ce(Di,"position")==="static"&&ce(Di,"transform")==="none"&&Di!==document;)Di=Di.parentNode;Di!==document.body&&Di!==document.documentElement?(Di===document&&(Di=Gs()),u.top+=Di.scrollTop,u.left+=Di.scrollLeft):Di=Gs(),Zh=mf(Di)}fe=jt.cloneNode(!0),es(fe,g.ghostClass,!1),es(fe,g.fallbackClass,!0),es(fe,g.dragClass,!0),ce(fe,"transition",""),ce(fe,"transform",""),ce(fe,"box-sizing","border-box"),ce(fe,"margin",0),ce(fe,"top",u.top),ce(fe,"left",u.left),ce(fe,"width",u.width),ce(fe,"height",u.height),ce(fe,"opacity","0.8"),ce(fe,"position",Na?"absolute":"fixed"),ce(fe,"zIndex","100000"),ce(fe,"pointerEvents","none"),ue.ghost=fe,r.appendChild(fe),ce(fe,"transform-origin",pf/parseInt(fe.style.width)*100+"% "+yf/parseInt(fe.style.height)*100+"%")}},_onDragStart:function(r,u){var g=this,w=r.dataTransfer,k=g.options;if($i("dragStart",this,{evt:r}),ue.eventCanceled){this._onDrop();return}$i("setupClone",this),ue.eventCanceled||(ni=ap(jt),ni.removeAttribute("id"),ni.draggable=!1,ni.style["will-change"]="",this._hideClone(),es(ni,this.options.chosenClass,!1),ue.clone=ni),g.cloneId=Ha(function(){$i("clone",g),!ue.eventCanceled&&(g.options.removeCloneOnHide||ei.insertBefore(ni,jt),g._hideClone(),Bi({sortable:g,name:"clone"}))}),!u&&es(jt,k.dragClass,!0),u?(Sl=!0,g._loopId=setInterval(g._emulateDragOver,50)):(ke(document,"mouseup",g._onDrop),ke(document,"touchend",g._onDrop),ke(document,"touchcancel",g._onDrop),w&&(w.effectAllowed="move",k.setData&&k.setData.call(g,w,jt)),Me(document,"drop",g),ce(jt,"transform","translateZ(0)")),Fo=!0,g._dragStartId=Ha(g._dragStarted.bind(g,u,r)),Me(document,"selectstart",g),Cr=!0,window.getSelection().removeAllRanges(),Dr&&ce(document.body,"user-select","none")},_onDragOver:function(r){var u=this.el,g=r.target,w,k,N,D=this.options,E=D.group,U=ue.active,F=Ma===E,j=D.sort,G=Mi||U,W,tt=this,it=!1;if(Ac)return;function nt(Bt,Gt){$i(Bt,tt,Js({evt:r,isOwner:F,axis:W?"vertical":"horizontal",revert:N,dragRect:w,targetRect:k,canSort:j,fromSortable:G,target:g,completed:_,onMove:function(he,ie){return Aa(ei,u,jt,w,he,di(he),r,ie)},changed:Y},Gt))}function L(){nt("dragOverAnimationCapture"),tt.captureAnimationState(),tt!==G&&G.captureAnimationState()}function _(Bt){return nt("dragOverCompleted",{insertion:Bt}),Bt&&(F?U._hideClone():U._showClone(tt),tt!==G&&(es(jt,Mi?Mi.options.ghostClass:U.options.ghostClass,!1),es(jt,D.ghostClass,!0)),Mi!==tt&&tt!==ue.active?Mi=tt:tt===ue.active&&Mi&&(Mi=null),G===tt&&(tt._ignoreWhileAnimating=g),tt.animateAll(function(){nt("dragOverAnimationComplete"),tt._ignoreWhileAnimating=null}),tt!==G&&(G.animateAll(),G._ignoreWhileAnimating=null)),(g===jt&&!jt.animated||g===u&&!g.animated)&&(Lo=null),!D.dragoverBubble&&!r.rootEl&&g!==document&&(jt.parentNode[qi]._isOutsideThisEl(r.target),!Bt&&Wn(r)),!D.dragoverBubble&&r.stopPropagation&&r.stopPropagation(),it=!0}function Y(){is=ps(jt),Cn=ps(jt,D.draggable),Bi({sortable:tt,name:"change",toEl:u,newIndex:is,newDraggableIndex:Cn,originalEvent:r})}if(r.preventDefault!==void 0&&r.cancelable&&r.preventDefault(),g=Es(g,D.draggable,u,!0),nt("dragOver"),ue.eventCanceled)return it;if(jt.contains(r.target)||g.animated&&g.animatingX&&g.animatingY||tt._ignoreWhileAnimating===g)return _(!1);if(Sl=!1,U&&!D.disabled&&(F?j||(N=ri!==ei):Mi===this||(this.lastPutMode=Ma.checkPull(this,U,jt,r))&&E.checkPut(this,U,jt,r))){if(W=this._getDirection(r,g)==="vertical",w=di(jt),nt("dragOverValid"),ue.eventCanceled)return it;if(N)return ri=ei,L(),this._hideClone(),nt("revert"),ue.eventCanceled||(Jn?ei.insertBefore(jt,Jn):ei.appendChild(jt)),_(!0);var ct=Du(u,D.draggable);if(!ct||Tk(r,W,this)&&!ct.animated){if(ct===jt)return _(!1);if(ct&&u===r.target&&(g=ct),g&&(k=di(g)),Aa(ei,u,jt,w,g,k,r,!!g)!==!1)return L(),ct&&ct.nextSibling?u.insertBefore(jt,ct.nextSibling):u.appendChild(jt),ri=u,Y(),_(!0)}else if(ct&&Ak(r,W,this)){var X=er(u,0,D,!0);if(X===jt)return _(!1);if(g=X,k=di(g),Aa(ei,u,jt,w,g,k,r,!1)!==!1)return L(),u.insertBefore(jt,X),ri=u,Y(),_(!0)}else if(g.parentNode===u){k=di(g);var lt=0,B,se=jt.parentNode!==u,Yt=!Sk(jt.animated&&jt.toRect||w,g.animated&&g.toRect||k,W),It=W?"top":"left",Z=gf(g,"top","top")||gf(jt,"top","top"),Pt=Z?Z.scrollTop:void 0;Lo!==g&&(B=k[It],Or=!1,Ca=!Yt&&D.invertSwap||se),lt=Dk(r,g,k,W,Yt?1:D.swapThreshold,D.invertedSwapThreshold==null?D.swapThreshold:D.invertedSwapThreshold,Ca,Lo===g);var et;if(lt!==0){var Dt=ps(jt);do Dt-=lt,et=ri.children[Dt];while(et&&(ce(et,"display")==="none"||et===fe))}if(lt===0||et===g)return _(!1);Lo=g,Fr=lt;var Rt=g.nextElementSibling,bt=!1;bt=lt===1;var Et=Aa(ei,u,jt,w,g,k,r,bt);if(Et!==!1)return(Et===1||Et===-1)&&(bt=Et===1),Ac=!0,setTimeout(Nk,30),L(),bt&&!Rt?u.appendChild(jt):g.parentNode.insertBefore(jt,bt?Rt:g),Z&&rp(Z,0,Pt-Z.scrollTop),ri=jt.parentNode,B!==void 0&&!Ca&&($a=Math.abs(B-di(g)[It])),Y(),_(!0)}if(u.contains(jt))return _(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){ke(document,"mousemove",this._onTouchMove),ke(document,"touchmove",this._onTouchMove),ke(document,"pointermove",this._onTouchMove),ke(document,"dragover",Wn),ke(document,"mousemove",Wn),ke(document,"touchmove",Wn)},_offUpEvents:function(){var r=this.el.ownerDocument;ke(r,"mouseup",this._onDrop),ke(r,"touchend",this._onDrop),ke(r,"pointerup",this._onDrop),ke(r,"pointercancel",this._onDrop),ke(r,"touchcancel",this._onDrop),ke(document,"selectstart",this)},_onDrop:function(r){var u=this.el,g=this.options;if(is=ps(jt),Cn=ps(jt,g.draggable),$i("drop",this,{evt:r}),ri=jt&&jt.parentNode,is=ps(jt),Cn=ps(jt,g.draggable),ue.eventCanceled){this._nulling();return}Fo=!1,Ca=!1,Or=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Tc(this.cloneId),Tc(this._dragStartId),this.nativeDraggable&&(ke(document,"drop",this),ke(u,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Dr&&ce(document.body,"user-select",""),ce(jt,"transform",""),r&&(Cr&&(r.cancelable&&r.preventDefault(),!g.dropBubble&&r.stopPropagation()),fe&&fe.parentNode&&fe.parentNode.removeChild(fe),(ei===ri||Mi&&Mi.lastPutMode!=="clone")&&ni&&ni.parentNode&&ni.parentNode.removeChild(ni),jt&&(this.nativeDraggable&&ke(jt,"dragend",this),Qh(jt),jt.style["will-change"]="",Cr&&!Fo&&es(jt,Mi?Mi.options.ghostClass:this.options.ghostClass,!1),es(jt,this.options.chosenClass,!1),Bi({sortable:this,name:"unchoose",toEl:ri,newIndex:null,newDraggableIndex:null,originalEvent:r}),ei!==ri?(is>=0&&(Bi({rootEl:ri,name:"add",toEl:ri,fromEl:ei,originalEvent:r}),Bi({sortable:this,name:"remove",toEl:ri,originalEvent:r}),Bi({rootEl:ri,name:"sort",toEl:ri,fromEl:ei,originalEvent:r}),Bi({sortable:this,name:"sort",toEl:ri,originalEvent:r})),Mi&&Mi.save()):is!==Io&&is>=0&&(Bi({sortable:this,name:"update",toEl:ri,originalEvent:r}),Bi({sortable:this,name:"sort",toEl:ri,originalEvent:r})),ue.active&&((is==null||is===-1)&&(is=Io,Cn=Er),Bi({sortable:this,name:"end",toEl:ri,originalEvent:r}),this.save()))),this._nulling()},_nulling:function(){$i("nulling",this),ei=jt=ri=fe=Jn=ni=Ga=An=qn=As=Cr=is=Cn=Io=Er=Lo=Fr=Mi=Ma=ue.dragged=ue.ghost=ue.clone=ue.active=null,Ml.forEach(function(r){r.checked=!0}),Ml.length=Wh=Jh=0},handleEvent:function(r){switch(r.type){case"drop":case"dragend":this._onDrop(r);break;case"dragenter":case"dragover":jt&&(this._onDragOver(r),Ck(r));break;case"selectstart":r.preventDefault();break}},toArray:function(){for(var r=[],u,g=this.el.children,w=0,k=g.length,N=this.options;w<k;w++)u=g[w],Es(u,N.draggable,this.el,!1)&&r.push(u.getAttribute(N.dataIdAttr)||Ek(u));return r},sort:function(r,u){var g={},w=this.el;this.toArray().forEach(function(k,N){var D=w.children[N];Es(D,this.options.draggable,w,!1)&&(g[k]=D)},this),u&&this.captureAnimationState(),r.forEach(function(k){g[k]&&(w.removeChild(g[k]),w.appendChild(g[k]))}),u&&this.animateAll()},save:function(){var r=this.options.store;r&&r.set&&r.set(this)},closest:function(r,u){return Es(r,u||this.options.draggable,this.el,!1)},option:function(r,u){var g=this.options;if(u===void 0)return g[r];var w=la.modifyOption(this,r,u);typeof w<"u"?g[r]=w:g[r]=u,r==="group"&&up(g)},destroy:function(){$i("destroy",this);var r=this.el;r[qi]=null,ke(r,"mousedown",this._onTapStart),ke(r,"touchstart",this._onTapStart),ke(r,"pointerdown",this._onTapStart),this.nativeDraggable&&(ke(r,"dragover",this),ke(r,"dragenter",this)),Array.prototype.forEach.call(r.querySelectorAll("[draggable]"),function(u){u.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Pl.splice(Pl.indexOf(this.el),1),this.el=r=null},_hideClone:function(){if(!An){if($i("hideClone",this),ue.eventCanceled)return;ce(ni,"display","none"),this.options.removeCloneOnHide&&ni.parentNode&&ni.parentNode.removeChild(ni),An=!0}},_showClone:function(r){if(r.lastPutMode!=="clone"){this._hideClone();return}if(An){if($i("showClone",this),ue.eventCanceled)return;jt.parentNode==ei&&!this.options.group.revertClone?ei.insertBefore(ni,jt):Jn?ei.insertBefore(ni,Jn):ei.appendChild(ni),this.options.group.revertClone&&this.animate(jt,ni),ce(ni,"display",""),An=!1}}};function Ck(c){c.dataTransfer&&(c.dataTransfer.dropEffect="move"),c.cancelable&&c.preventDefault()}function Aa(c,r,u,g,w,k,N,D){var E,U=c[qi],F=U.options.onMove,j;return window.CustomEvent&&!mn&&!aa?E=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(E=document.createEvent("Event"),E.initEvent("move",!0,!0)),E.to=r,E.from=c,E.dragged=u,E.draggedRect=g,E.related=w||r,E.relatedRect=k||di(r),E.willInsertAfter=D,E.originalEvent=N,c.dispatchEvent(E),F&&(j=F.call(U,E,N)),j}function Qh(c){c.draggable=!1}function Nk(){Ac=!1}function Ak(c,r,u){var g=di(er(u.el,0,u.options,!0)),w=lp(u.el,u.options,fe),k=10;return r?c.clientX<w.left-k||c.clientY<g.top&&c.clientX<g.right:c.clientY<w.top-k||c.clientY<g.bottom&&c.clientX<g.left}function Tk(c,r,u){var g=di(Du(u.el,u.options.draggable)),w=lp(u.el,u.options,fe),k=10;return r?c.clientX>w.right+k||c.clientY>g.bottom&&c.clientX>g.left:c.clientY>w.bottom+k||c.clientX>g.right&&c.clientY>g.top}function Dk(c,r,u,g,w,k,N,D){var E=g?c.clientY:c.clientX,U=g?u.height:u.width,F=g?u.top:u.left,j=g?u.bottom:u.right,G=!1;if(!N){if(D&&$a<U*w){if(!Or&&(Fr===1?E>F+U*k/2:E<j-U*k/2)&&(Or=!0),Or)G=!0;else if(Fr===1?E<F+$a:E>j-$a)return-Fr}else if(E>F+U*(1-w)/2&&E<j-U*(1-w)/2)return Lk(r)}return G=G||N,G&&(E<F+U*k/2||E>j-U*k/2)?E>F+U/2?1:-1:0}function Lk(c){return ps(jt)<ps(c)?1:-1}function Ek(c){for(var r=c.tagName+c.className+c.src+c.href+c.textContent,u=r.length,g=0;u--;)g+=r.charCodeAt(u);return g.toString(36)}function Fk(c){Ml.length=0;for(var r=c.getElementsByTagName("input"),u=r.length;u--;){var g=r[u];g.checked&&Ml.push(g)}}function Ha(c){return setTimeout(c,0)}function Tc(c){return clearTimeout(c)}ql&&Me(document,"touchmove",function(c){(ue.active||Fo)&&c.cancelable&&c.preventDefault()});ue.utils={on:Me,off:ke,css:ce,find:np,is:function(r,u){return!!Es(r,u,r,!1)},extend:mk,throttle:op,closest:Es,toggleClass:es,clone:ap,index:ps,nextTick:Ha,cancelNextTick:Tc,detectDirection:cp,getChild:er,expando:qi};ue.get=function(c){return c[qi]};ue.mount=function(){for(var c=arguments.length,r=new Array(c),u=0;u<c;u++)r[u]=arguments[u];r[0].constructor===Array&&(r=r[0]),r.forEach(function(g){if(!g.prototype||!g.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(g));g.utils&&(ue.utils=Js(Js({},ue.utils),g.utils)),la.mount(g)})};ue.create=function(c,r){return new ue(c,r)};ue.version=fk;var ui=[],Nr,Dc,Lc=!1,_h,tc,Cl,Ar;function Ok(){function c(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this))}return c.prototype={dragStarted:function(u){var g=u.originalEvent;this.sortable.nativeDraggable?Me(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Me(document,"pointermove",this._handleFallbackAutoScroll):g.touches?Me(document,"touchmove",this._handleFallbackAutoScroll):Me(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(u){var g=u.originalEvent;!this.options.dragOverBubble&&!g.rootEl&&this._handleAutoScroll(g)},drop:function(){this.sortable.nativeDraggable?ke(document,"dragover",this._handleAutoScroll):(ke(document,"pointermove",this._handleFallbackAutoScroll),ke(document,"touchmove",this._handleFallbackAutoScroll),ke(document,"mousemove",this._handleFallbackAutoScroll)),bf(),qa(),pk()},nulling:function(){Cl=Dc=Nr=Lc=Ar=_h=tc=null,ui.length=0},_handleFallbackAutoScroll:function(u){this._handleAutoScroll(u,!0)},_handleAutoScroll:function(u,g){var w=this,k=(u.touches?u.touches[0]:u).clientX,N=(u.touches?u.touches[0]:u).clientY,D=document.elementFromPoint(k,N);if(Cl=u,g||this.options.forceAutoScrollFallback||aa||mn||Dr){ec(u,this.options,D,g);var E=Vn(D,!0);Lc&&(!Ar||k!==_h||N!==tc)&&(Ar&&bf(),Ar=setInterval(function(){var U=Vn(document.elementFromPoint(k,N),!0);U!==E&&(E=U,qa()),ec(u,w.options,U,g)},10),_h=k,tc=N)}else{if(!this.options.bubbleScroll||Vn(D,!0)===Gs()){qa();return}ec(u,this.options,Vn(D,!1),!1)}}},un(c,{pluginName:"scroll",initializeByDefault:!0})}function qa(){ui.forEach(function(c){clearInterval(c.pid)}),ui=[]}function bf(){clearInterval(Ar)}var ec=op(function(c,r,u,g){if(r.scroll){var w=(c.touches?c.touches[0]:c).clientX,k=(c.touches?c.touches[0]:c).clientY,N=r.scrollSensitivity,D=r.scrollSpeed,E=Gs(),U=!1,F;Dc!==u&&(Dc=u,qa(),Nr=r.scroll,F=r.scrollFn,Nr===!0&&(Nr=Vn(u,!0)));var j=0,G=Nr;do{var W=G,tt=di(W),it=tt.top,nt=tt.bottom,L=tt.left,_=tt.right,Y=tt.width,ct=tt.height,X=void 0,lt=void 0,B=W.scrollWidth,se=W.scrollHeight,Yt=ce(W),It=W.scrollLeft,Z=W.scrollTop;W===E?(X=Y<B&&(Yt.overflowX==="auto"||Yt.overflowX==="scroll"||Yt.overflowX==="visible"),lt=ct<se&&(Yt.overflowY==="auto"||Yt.overflowY==="scroll"||Yt.overflowY==="visible")):(X=Y<B&&(Yt.overflowX==="auto"||Yt.overflowX==="scroll"),lt=ct<se&&(Yt.overflowY==="auto"||Yt.overflowY==="scroll"));var Pt=X&&(Math.abs(_-w)<=N&&It+Y<B)-(Math.abs(L-w)<=N&&!!It),et=lt&&(Math.abs(nt-k)<=N&&Z+ct<se)-(Math.abs(it-k)<=N&&!!Z);if(!ui[j])for(var Dt=0;Dt<=j;Dt++)ui[Dt]||(ui[Dt]={});(ui[j].vx!=Pt||ui[j].vy!=et||ui[j].el!==W)&&(ui[j].el=W,ui[j].vx=Pt,ui[j].vy=et,clearInterval(ui[j].pid),(Pt!=0||et!=0)&&(U=!0,ui[j].pid=setInterval((function(){g&&this.layer===0&&ue.active._onTouchMove(Cl);var Rt=ui[this.layer].vy?ui[this.layer].vy*D:0,bt=ui[this.layer].vx?ui[this.layer].vx*D:0;typeof F=="function"&&F.call(ue.dragged.parentNode[qi],bt,Rt,c,Cl,ui[this.layer].el)!=="continue"||rp(ui[this.layer].el,bt,Rt)}).bind({layer:j}),24))),j++}while(r.bubbleScroll&&G!==E&&(G=Vn(G,!1)));Lc=U}},30),gp=function(r){var u=r.originalEvent,g=r.putSortable,w=r.dragEl,k=r.activeSortable,N=r.dispatchSortableEvent,D=r.hideGhostForTarget,E=r.unhideGhostForTarget;if(u){var U=g||k;D();var F=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:u,j=document.elementFromPoint(F.clientX,F.clientY);E(),U&&!U.el.contains(j)&&(N("spill"),this.onSpill({dragEl:w,putSortable:g}))}};function Lu(){}Lu.prototype={startIndex:null,dragStart:function(r){var u=r.oldDraggableIndex;this.startIndex=u},onSpill:function(r){var u=r.dragEl,g=r.putSortable;this.sortable.captureAnimationState(),g&&g.captureAnimationState();var w=er(this.sortable.el,this.startIndex,this.options);w?this.sortable.el.insertBefore(u,w):this.sortable.el.appendChild(u),this.sortable.animateAll(),g&&g.animateAll()},drop:gp};un(Lu,{pluginName:"revertOnSpill"});function Eu(){}Eu.prototype={onSpill:function(r){var u=r.dragEl,g=r.putSortable,w=g||this.sortable;w.captureAnimationState(),u.parentNode&&u.parentNode.removeChild(u),w.animateAll()},drop:gp};un(Eu,{pluginName:"removeOnSpill"});ue.mount(new Ok);ue.mount(Eu,Lu);var Ds,En,Go,Ls,Fn,rn,At,nn,Wa,mp,Ec,Zn,Fc,Oc,pp,yp,Rc,Ja,Za,Qn,Oo,wp,Ro,Ts,zs,bp,_n;class Rk{constructor(r,u={}){pi(this,At);pi(this,Ds);pi(this,En);pi(this,Go);pi(this,Ls);pi(this,Fn);pi(this,rn);ts(this,Ds,r),$t(this,Ds).classList.add("type-editor"),ts(this,En,0),ts(this,Go,u.onChange||null);const g=["int","float","str","bool"],w=["list","tuple","set","dict"],k=[...g,...w];if(u.allowedTypes?(ts(this,rn,[...u.allowedTypes]),ts(this,Ls,u.allowedTypes.filter(N=>g.includes(N))),ts(this,Fn,u.allowedTypes.filter(N=>w.includes(N)))):(ts(this,Ls,g),ts(this,Fn,w),ts(this,rn,k)),u.initialType)try{this.setTypeString(u.initialType)}catch(N){console.warn("Failed to parse initialType:",N.message),this.clear()}else this.clear()}getTypeString(){const r=$t(this,Ds).querySelector(".type-container");return r?ft(this,At,Ro).call(this,r):""}isValid(){const r=$t(this,Ds).querySelectorAll(".type-container select");for(const u of r){if(!u.value||u.value==="")return!1;if(u.value==="custom"){const w=u.closest(".type-container").querySelector(".custom-type-input");if(!w||!ft(this,At,Wa).call(this,w.value))return!1}}return!0}setTypeString(r){try{const u=ft(this,At,Ts).call(this,r);$t(this,Ds).innerHTML="",ts(this,En,0),ft(this,At,_n).call(this,u,$t(this,Ds)),ft(this,At,nn).call(this)}catch(u){throw new Error("Error parsing type string: "+u.message)}}clear(){$t(this,Ds).innerHTML="",ts(this,En,0),ft(this,At,Zn).call(this,$t(this,Ds),!0)}}Ds=new WeakMap,En=new WeakMap,Go=new WeakMap,Ls=new WeakMap,Fn=new WeakMap,rn=new WeakMap,At=new WeakSet,nn=function(){$t(this,Go)&&$t(this,Go).call(this,this.getTypeString())},Wa=function(r){if(!r||typeof r!="string")return!1;const u=r.trim();return/^[a-zA-Z][a-zA-Z0-9_]*$/.test(u)?!$t(this,rn).includes(u):!1},mp=function(r){let u=r;for(;u;){if(u.classList&&u.classList.contains("type-container")){const g=u.querySelector(":scope > select");if(g&&g.value==="set")return!0;if(g&&g.value==="dict"){let w=r;for(;w&&w!==u;){if(w.classList&&w.classList.contains("indented-nested")){const k=w.querySelector(".dict-label");if(k&&k.textContent==="keys of")return!0}w=w.parentElement}}if(g&&g.value==="tuple"){u=u.parentElement;continue}}u=u.parentElement}return!1},Ec=function(r){return ft(this,At,mp).call(this,r)},Zn=function(r,u=!1){const g=document.createElement("span");g.className="type-container";const w=Dh(this,En)._++;g.dataset.id=w;const k=document.createElement("select"),N=document.createElement("option");N.value="",N.textContent="type",k.appendChild(N);const D=ft(this,At,Ec).call(this,r),E=[...$t(this,Ls),"tuple"];return(D?E:$t(this,rn)).forEach(F=>{const j=document.createElement("option");j.value=F,j.textContent=F,k.appendChild(j)}),k.selectedIndex=0,k.addEventListener("change",F=>{F.target.value?ft(this,At,Fc).call(this,F,g,w):(g.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector").forEach(G=>G.remove()),ft(this,At,nn).call(this))}),g.appendChild(k),r.appendChild(g),g},Fc=function(r,u,g){const w=r.target.value;u.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector, .custom-type-input").forEach(N=>N.remove()),w==="custom"?ft(this,At,Oc).call(this,u):$t(this,Fn).includes(w)&&(w==="list"?ft(this,At,Rc).call(this,u,"of"):w==="set"?ft(this,At,pp).call(this,u):w==="tuple"?ft(this,At,Rc).call(this,u,"with"):w==="dict"&&ft(this,At,yp).call(this,u)),ft(this,At,nn).call(this)},Oc=function(r){const u=document.createElement("input");u.type="text",u.className="custom-type-input",u.placeholder="Enter custom type",u.addEventListener("input",()=>{ft(this,At,nn).call(this)}),r.appendChild(u)},pp=function(r){const u=document.createElement("span");u.className="connector",u.textContent="of",r.appendChild(u);const g=document.createElement("div");g.className="indented-nested",r.appendChild(g),ft(this,At,Zn).call(this,g)},yp=function(r){const u=document.createElement("span");u.className="connector",u.textContent="with",r.appendChild(u);const g=document.createElement("div");g.className="indented-nested",r.appendChild(g);const w=document.createElement("span");w.className="dict-label",w.textContent="keys of",g.appendChild(w),ft(this,At,Zn).call(this,g);const k=document.createElement("div");k.className="dict-connector",k.textContent="associated with",r.appendChild(k);const N=document.createElement("div");N.className="indented-nested",r.appendChild(N);const D=document.createElement("span");D.className="dict-label",D.textContent="values of",N.appendChild(D),ft(this,At,Zn).call(this,N)},Rc=function(r,u){const g=document.createElement("select");g.className="mode-select";const w=document.createElement("option");w.value="of",w.textContent="of",w.title="Contains an arbitrary number of elements, all of the same type",g.appendChild(w);const k=document.createElement("option");k.value="with",k.textContent="with",k.title="Contains a fixed number of elements, each of a possiblydifferent type",g.appendChild(k),g.value=u,r.appendChild(g),g.addEventListener("change",N=>ft(this,At,Ja).call(this,r,N.target.value)),ft(this,At,Ja).call(this,r,u)},Ja=function(r,u){const g=r.querySelectorAll(".type-container:not(:first-child)"),w=r.querySelectorAll(".add-type-btn, .remove-type-btn"),k=r.querySelectorAll(".indented-nested");if(g.forEach(N=>N.remove()),w.forEach(N=>N.remove()),k.forEach(N=>N.remove()),u==="of"){const N=document.createElement("div");N.className="indented-nested",r.appendChild(N),ft(this,At,Zn).call(this,N)}else ft(this,At,Za).call(this,r,!0);ft(this,At,nn).call(this)},Za=function(r,u=!1){const g=document.createElement("div");g.className="indented-nested",r.appendChild(g);const w=document.createElement("span");w.className="nested-leader-container",g.appendChild(w);const k=document.createElement("button");k.className="add-type-btn",k.textContent="+",k.addEventListener("click",()=>{ft(this,At,Za).call(this,r,!1),ft(this,At,Qn).call(this,r)}),w.appendChild(k);const N=document.createElement("button");N.className="remove-type-btn",N.textContent="",N.addEventListener("click",()=>{g.remove(),ft(this,At,Qn).call(this,r),ft(this,At,nn).call(this)}),w.appendChild(N);const D=ft(this,At,Zn).call(this,g);return ft(this,At,Qn).call(this,r),D},Qn=function(r){const u=Array.from(r.children).filter(g=>g.classList&&g.classList.contains("indented-nested"));u.forEach(g=>{const w=g.querySelector(".remove-type-btn");w&&(w.disabled=u.length<=1)})},Oo=function(r){return r.includes(" of ")||r.includes(" with ")},wp=function(r){return r.length===0?"":r.length===1?r[0]:r.length===2?`${r[0]} and ${r[1]}`:`${r.slice(0,-1).join(", ")}, and ${r[r.length-1]}`},Ro=function(r){const g=r.querySelector("select").value;if(!g)return"?";if(g==="custom"){const w=r.querySelector(".custom-type-input");return w&&ft(this,At,Wa).call(this,w.value)?w.value.trim():"?"}if($t(this,Ls).includes(g))return g;if(g==="set"){const w=r.querySelector(".indented-nested");if(w){const k=w.querySelector(".type-container");if(k){const N=ft(this,At,Ro).call(this,k);return`set of ${ft(this,At,Oo).call(this,N)?`(${N})`:N}`}}return"set of ?"}if(g==="dict"){const w=Array.from(r.children).filter(U=>U.classList&&U.classList.contains("indented-nested"));let k="?",N="?";w.forEach(U=>{const F=U.querySelector(".dict-label"),j=U.querySelector(".type-container");if(F&&j){const G=ft(this,At,Ro).call(this,j);F.textContent==="keys of"?k=G:F.textContent==="values of"&&(N=G)}});const D=ft(this,At,Oo).call(this,k)?`(${k})`:k,E=ft(this,At,Oo).call(this,N)?`(${N})`:N;return`dict with keys of ${D} associated with values of ${E}`}if(g==="list"||g==="tuple"){const w=r.querySelector(".mode-select");if((w?w.value:"of")==="of"){const N=r.querySelector(".indented-nested");if(N){const D=N.querySelector(".type-container");if(D){const E=ft(this,At,Ro).call(this,D),U=ft(this,At,Oo).call(this,E)?`(${E})`:E;return`${g} of ${U}`}}return`${g} of ?`}else{const N=Array.from(r.children).filter(D=>D.classList&&D.classList.contains("indented-nested"));if(N.length>0){const D=N.map(E=>{const U=E.querySelector(".type-container");if(!U)return"?";const F=ft(this,At,Ro).call(this,U);return ft(this,At,Oo).call(this,F)?`(${F})`:F});return`${g} with ${ft(this,At,wp).call(this,D)}`}return`${g} with ?`}}return g},Ts=function(r){if(r=r.trim(),$t(this,Ls).includes(r))return{type:r};if($t(this,Fn).includes(r)){if($t(this,Ls).length>0&&$t(this,Ls)[0],r==="list")return{type:"list",mode:"of",nested:{type:""}};if(r==="tuple")return{type:"tuple",mode:"with",types:[{type:""}]};if(r==="set")return{type:"set",mode:"of",nested:{type:""}};if(r==="dict")return{type:"dict",keyType:{type:""},valueType:{type:""}}}for(const u of $t(this,Fn))if(r.startsWith(u+" ")){const g=r.substring(u.length+1).trim();if(u==="set"){if(g.startsWith("of ")){const w=g.substring(3).trim();return{type:"set",mode:"of",nested:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,w))}}}else if(u==="dict"){if(g.startsWith("with ")){const w=g.substring(5).trim();if(w.startsWith("values of ")){const k=w.substring(10).trim();return{type:"dict",keyType:{type:"str"},valueType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,k))}}if(w.startsWith("keys of ")){const k=w.substring(8);let N=0,D=-1,E=null;const U=["associated with values of ","and values of "];for(const F of U){N=0;for(let j=0;j<k.length;j++){const G=k[j];if(G==="("?N++:G===")"&&N--,N===0&&k.substring(j,j+F.length)===F){D=j,E=F;break}}if(D!==-1)break}if(D!==-1&&E){const F=k.substring(0,D).trim(),j=k.substring(D+E.length).trim();return{type:"dict",keyType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,F)),valueType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,j))}}}}else if(g.startsWith("of ")){const w=g.substring(3).trim();let k=0,N=-1;const D=" to ";for(let E=0;E<w.length;E++){const U=w[E];if(U==="("?k++:U===")"&&k--,k===0&&w.substring(E,E+D.length)===D){N=E;break}}if(N!==-1){const E=w.substring(0,N).trim(),U=w.substring(N+D.length).trim();return{type:"dict",keyType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,E)),valueType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,U))}}else return{type:"dict",keyType:{type:"str"},valueType:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,w))}}}else if(u==="list"||u==="tuple"){if(g.startsWith("of ")){const w=g.substring(3).trim();return{type:u,mode:"of",nested:ft(this,At,Ts).call(this,ft(this,At,zs).call(this,w))}}else if(g.startsWith("with ")){const w=g.substring(5).trim(),k=ft(this,At,bp).call(this,w);return{type:u,mode:"with",types:k.map(N=>ft(this,At,Ts).call(this,ft(this,At,zs).call(this,N)))}}}}if($t(this,rn).includes("custom")&&(ft(this,At,Wa).call(this,r)||r==="custom"))return{type:"custom",customValue:r==="custom"?"":r.trim()};throw new Error(`Unable to parse type: ${r}`)},zs=function(r){if(r=r.trim(),r.startsWith("(")&&r.endsWith(")")){let u=0;for(let g=0;g<r.length;g++)if(r[g]==="("&&u++,r[g]===")"&&u--,u===0&&g<r.length-1)return r;return r.substring(1,r.length-1).trim()}return r},bp=function(r){const u=[];let g="",w=0,k=0;for(;k<r.length;){const N=r[k];if(N==="(")w++,g+=N,k++;else if(N===")")w--,g+=N,k++;else if(w===0){if(N===","){g.trim()&&u.push(g.trim()),g="",k++;continue}if(r.substring(k,k+5)===" and "){g.trim()&&u.push(g.trim()),g="",k+=5;continue}if(g.trim()===""&&r.substring(k,k+4)==="and "){k+=4;continue}g+=N,k++}else g+=N,k++}return g.trim()&&u.push(g.trim()),u},_n=function(r,u){const g=document.createElement("span");g.className="type-container";const w=Dh(this,En)._++;g.dataset.id=w;const k=document.createElement("select"),N=document.createElement("option");N.value="",N.textContent="type",k.appendChild(N);const D=ft(this,At,Ec).call(this,u),E=[...$t(this,Ls),"tuple"];if((D?E:$t(this,rn)).forEach(F=>{const j=document.createElement("option");j.value=F,j.textContent=F,k.appendChild(j)}),k.value=r.type,k.addEventListener("change",F=>{F.target.value?ft(this,At,Fc).call(this,F,g,w):(g.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector, .custom-type-input").forEach(G=>G.remove()),ft(this,At,nn).call(this))}),g.appendChild(k),u.appendChild(g),r.type==="custom"){ft(this,At,Oc).call(this,g);const F=g.querySelector(".custom-type-input");F&&r.customValue&&(F.value=r.customValue)}else if(r.type==="set"){const F=document.createElement("span");F.className="connector",F.textContent="of",g.appendChild(F);const j=document.createElement("div");j.className="indented-nested",g.appendChild(j),ft(this,At,_n).call(this,r.nested,j)}else if(r.type==="dict"){const F=document.createElement("span");F.className="connector",F.textContent="with",g.appendChild(F);const j=document.createElement("div");j.className="indented-nested",g.appendChild(j);const G=document.createElement("span");G.className="dict-label",G.textContent="keys of",j.appendChild(G),ft(this,At,_n).call(this,r.keyType,j);const W=document.createElement("div");W.className="dict-connector",W.textContent="associated with",g.appendChild(W);const tt=document.createElement("div");tt.className="indented-nested",g.appendChild(tt);const it=document.createElement("span");it.className="dict-label",it.textContent="values of",tt.appendChild(it),ft(this,At,_n).call(this,r.valueType,tt)}else if(r.type==="list"||r.type==="tuple"){const F=document.createElement("select");F.className="mode-select";const j=document.createElement("option");j.value="of",j.textContent="of",j.title="Contains an arbitrary number of elements, all of the same type",F.appendChild(j);const G=document.createElement("option");if(G.value="with",G.textContent="with",G.title="Contains a fixed number of elements, each of a possiblydifferent type",F.appendChild(G),F.value=r.mode,F.addEventListener("change",W=>ft(this,At,Ja).call(this,g,W.target.value)),g.appendChild(F),r.mode==="of"){const W=document.createElement("div");W.className="indented-nested",g.appendChild(W),ft(this,At,_n).call(this,r.nested,W)}else r.types.forEach((W,tt)=>{const it=document.createElement("div");it.className="indented-nested",g.appendChild(it);const nt=document.createElement("span");nt.className="nested-leader-container",it.appendChild(nt);const L=document.createElement("button");L.className="add-type-btn",L.textContent="+",L.addEventListener("click",()=>{ft(this,At,Za).call(this,g,!1),ft(this,At,Qn).call(this,g)}),nt.appendChild(L);const _=document.createElement("button");_.className="remove-type-btn",_.textContent="",_.addEventListener("click",()=>{it.remove(),ft(this,At,Qn).call(this,g),ft(this,At,nn).call(this)}),nt.appendChild(_),ft(this,At,_n).call(this,W,it)}),ft(this,At,Qn).call(this,g)}return g};function Ik(c,r){const u=document.createElement("div");let g=null;function w(G,W,tt=null){c.updateFunc(g,G,W,tt)}function k(G,W=-1){c.addFuncItem(g,G,W)}function N(G,W){c.removeFuncItem(g,G,W)}function D(G,W,tt){c.moveFuncItem(g,G,W,tt)}function E(G,W){c.addFuncListener(G,(tt,it,nt)=>{tt===g&&W(nt,it,g)})}function U(G,W){r.adminMode?W(!1):c.addFuncListener("readOnly",(tt,it,nt)=>{tt===g&&W(ms(nt??!1,G))})}const F={set:w,add:k,remove:N,move:D,listen:E,listenRO:U};function j(G){g!==G&&(g=G,c.fireFuncListeners(g))}return u.append(Bk(F),zk(F),Xk(c,r,F),Yk(c,r,F),jk(F),Uk(F),_m(G=>{c.addFuncListener("problems",(W,tt,it)=>{W===g&&G(null,(it||[]).concat(c.getFuncLinkProblems(g)))}),c.addFuncListener("linkProblems",(W,tt,it)=>{W===g&&G(null,c.getFuncProblems(g).concat(it||[]))})}),Nc(r,"code",F,"Function Code",`# Write your function code here
`),Nc(r,"testCode",F,"Test Code",`# Write your test code here
`)),r.adminMode&&u.appendChild(tp(F,["name","params","returns","desc","io","testable","code","testCode","calls","callsInto","callsOutOf"])),[u,j]}function Bk(c){const r=document.createElement("input");r.type="text",r.className="func-name",r.placeholder="function",r.required=!0,r.pattern="[a-zA-Z_][a-zA-Z0-9_]*";const u=document.createElement("h2");u.appendChild(r);const g=()=>{u.parentElement.classList.toggle("is-main",r.value.trim()==="main")};let w=()=>{g()};return CSS.supports("field-sizing: content")||(w=()=>{g(),r.size=(r.value||r.placeholder).length}),r.addEventListener("input",k=>{c.set("name",Vk(k.target.value),k.target.selectionStart),w()}),c.listen("name",k=>{k=(k==null?void 0:k.toString())||"",r.value!==k&&(r.value=k),w()}),c.listenRO("name",k=>{r.readOnly=k}),u}function Vk(c){return c.includes("(")&&(c=c.split("(")[0]),c.trim().replace(/[^a-zA-Z0-9_]/g,"_")}function zk(c){return Hl("desc",c,{placeholder:"Description",required:!0})}function jk(c){const r=document.createElement("select");return r.className="func-io",[{value:"none",text:"None"},{value:"indirect",text:"Indirect I/O"},{value:"output",text:"Output Only"},{value:"input",text:"Basic Input"},{value:"validation",text:"Validated Input"}].forEach(u=>r.appendChild(io(u.value,u.text))),r.addEventListener("change",u=>{c.set("io",u.target.value)}),c.listen("io",u=>{r.value=(u==null?void 0:u.toString())||"none"}),c.listenRO("io",u=>{r.disabled=u}),yo(r,"User I/O: ")}function Uk(c){return yo(Au("testable",c),"Testable: ")}function Xk(c,r,u){return xp(c,r,"Parameter","params",!0,u)}function Yk(c,r,u){return xp(c,r,"Return","returns",!1,u)}function xp(c,r,u,g,w,k){const N=document.createElement("div");N.className=`func-${g} func-vars`;const D=document.createElement("h3");D.textContent=u+"(s)";const E=document.createElement("div");N.append(D,E);const U=Pp();N.appendChild(U);function F(it,nt,L,_=null){k.set(`${g}[${it}].${nt}`,L,_)}function j(it){return Array.prototype.indexOf.call(E.children,it.target.closest(".func-var"))}E.addEventListener("input",it=>{if(!(it.target.closest(".sortable-ghost")||it.target.closest(".sortable-drag"))){for(const nt of it.target.classList)if(nt.startsWith("func-var-")){const[,,L]=nt.split("-");F(j(it),L,it.target.value,it.target.selectionStart)}}}),E.addEventListener("change",async it=>{if(!(it.target.closest(".sortable-ghost")||it.target.closest(".sortable-drag"))&&it.target.selectedOptions)if(it.target.selectedOptions[0].text.endsWith("...")){const nt=await vf(r,it.target.value);if(nt===null){it.target.value=it.target.lastSelected;return}F(j(it),"type",nt)}else F(j(it),"type",it.target.value)}),N.addEventListener("click",async it=>{if(it.target.closest(".sortable-ghost")||it.target.closest(".sortable-drag"))return;const nt=it.target.closest(".func-var-type-edit");if(nt){const L=await vf(r,nt.parentElement.querySelector(".func-var-type").value);L!==null&&F(j(it),"type",L)}else{const L=it.target.closest(".func-var-button");if(!L)return;L.classList.contains("func-var-button-add")?k.add(g,L===U?-1:j(it)):L.classList.contains("func-var-button-remove")&&k.remove(g,j(it))}}),ue.create(E,{group:g,handle:".func-var-drag-handle",filter:".func-var-drag-disabled",direction:"vertical",onUpdate:it=>{k.move(g,it.oldIndex,it.newIndex)}});function G(it,nt,L=null){return ms(it,g)||ms(it,`${g}[${nt}]`)||L&&ms(it,`${g}.${L}`)}function W(it,nt,L,_=null){return ms(it,g)||ms(it,`${g}[${nt}]`)||ms(it,`${g}[${nt}].${L}`)||_&&(ms(it,`${g}.${_}`)||ms(it,`${g}.${_}.${L}`))}function tt(it,nt,L){var It;const _=w?it.querySelector(".func-var-name"):null,Y=it.querySelector(".func-var-type"),ct=it.querySelector(".func-var-desc"),X=it.querySelector(".func-var-button-add"),lt=it.querySelector(".func-var-button-remove"),B=it.querySelector(".func-var-drag-handle"),se=(It=_==null?void 0:_.value)==null?void 0:It.trim();_&&(_.readOnly=W(L,nt,"name",se)),Y.disabled=W(L,nt,"type",se),ct.readOnly=W(L,nt,"desc",se);const Yt=G(L,nt,se);it.classList.toggle("func-var-readonly",Yt),X.classList.toggle("func-var-button-disabled",Yt),lt.classList.toggle("func-var-button-disabled",Yt),B.classList.toggle("func-var-drag-disabled",Yt)}return k.listen(g,(it,nt,L)=>{const[_,Y,ct]=c.parseFuncProperty(nt);if(Y==null)if(it==null||it.length===0)E.innerHTML="";else{if(it.length>E.children.length)for(let X=E.children.length;X<it.length;X++){const lt=Kk(c,r,w);E.appendChild(lt),r.adminMode||tt(lt,X,c.functions.get(L).get("readOnly")??!1)}else if(it.length<E.children.length)for(let X=it.length;X<E.children.length;X++)E.children[X].remove();for(const[X,lt]of it.entries())xf(E,X,lt,w)}else if(ct==null)xf(E,Y,it,w);else{const X=E.children[Y].querySelector(`.func-var-${ct}`);if(X){const lt=(it==null?void 0:it.toString())??"";ct==="type"?kp(X,lt):X.value!==lt&&(X.value=lt)}}}),r.adminMode||k.listen("readOnly",it=>{const nt=it??!1,L=ms(nt,g);N.classList.toggle("func-vars-readonly",L),U.classList.toggle("func-var-button-disabled",L);for(let _=0;_<E.children.length;_++)tt(E.children[_],_,nt)}),N}function xf(c,r,u,g){var U,F,j;const w=c.children[r];if(g){const G=((U=u.name)==null?void 0:U.toString())??"",W=w.querySelector(".func-var-name");W.value!==G&&(W.value=G)}const k=((F=u.type)==null?void 0:F.toString())??"",N=w.querySelector(".func-var-type");kp(N,k);const D=((j=u.desc)==null?void 0:j.toString())??"",E=w.querySelector(".func-var-desc");E.value!==D&&(E.value=D)}function Kk(c,r,u){const g=document.createElement("div");return g.className="func-var",g.append(Wk(),Pp(),Qk()),u&&g.append(Jk(),document.createElement("span")," : "),g.append(qk(c,r),Zk()),g}function Gk(c){return c==="list"?"list of ...":c==="tuple"?"tuple with ...":c==="dict"?"dict with ...":c==="set"?"set of ...":c==="custom"?"custom...":c}function vp(c,r){const u=io(r);u.customType=!0,u.setAttribute("data-custom-type","true"),c.options.add(u)}function $k(c,r){const u=c.closest(".inspector"),g=u?u.querySelectorAll("select.func-var-type"):[c];for(const w of g)vp(w,r)}function kp(c,r){if(c.selectedOptions[0].text.endsWith("...")||(c.lastSelected=c.value),r===""){c.value="";return}[...c.options].filter(g=>g.value===r).length===0&&$k(c,r),c.value=r}function Hk(c,r){var g,w;const u=new Set;for(const k of c.functions.values()){const N=((g=k.get("returns"))==null?void 0:g.toJSON())||[],D=((w=k.get("params"))==null?void 0:w.toJSON())||[],E=N.concat(D).map(U=>U.type).filter(U=>U&&!r.allowedTypes.includes(U));for(const U of E)u.add(U)}return u}function qk(c,r){const u=document.createElement("span");u.className="func-var-type-holder";const g=document.createElement("select");g.className="func-var-type",g.appendChild(io("","type"));for(const k of r.allowedTypes)g.appendChild(io(k,Gk(k)));for(const k of Hk(c,r))vp(g,k);const w=document.createElement("button");return w.type="button",w.className="func-var-type-edit",w.title="Edit Type...",w.innerHTML="&#9998;",u.append(g,w),u}async function vf(c,r){let u=null;return(await Vi.fire({theme:c.theme,title:"Create Type",html:"<div class='func-planner-type-builder'></div>",showCancelButton:!0,willOpen:w=>{const k=w.querySelector(".func-planner-type-builder");function N(D){D.includes("?")?Vi.getConfirmButton().disabled=!0:(u=D,Vi.getConfirmButton().disabled=!1)}new Rk(k,{onChange:N,allowedTypes:c.allowedTypes,initialType:r.trim()})}})).isConfirmed?u:null}function Wk(){const c=document.createElement("div");return c.className="func-var-drag-handle",c}function Jk(){const c=document.createElement("input");return c.type="text",c.className="func-var-name",c.placeholder="name",c.required=!0,c.pattern="[a-zA-Z_][a-zA-Z0-9_]*",c}function Zk(){const c=document.createElement("input");return c.type="text",c.className="func-var-desc",c.placeholder="description",c.required=!0,c}function Sp(c){const r=document.createElement("div");return r.className="func-var-button func-var-button-"+c,Fl(`images/${c}.svg`,r,c==="remove"?"x":"+"),r}function Pp(){return Sp("add")}function Qk(){return Sp("remove")}function _k(c,r){const u=document.createElement("div");function g(D,E,U=null){c.updateModelData(D,E,U)}function w(D,E){c.addModelDataListener(D,(U,F)=>E(F))}function k(D,E){r.adminMode?E(!1):c.addModelDataListener("readOnly",(U,F)=>{E(ms(F??!1,D))})}const N={set:g,listen:w,listenRO:k};return u.append(...tS(c),eS(N),iS(N),sS(c,r,N)),r.adminMode&&u.appendChild(nS(N)),u.appendChild(oS(r,N)),r.adminMode&&u.appendChild(tp(N,["documentation","testDocumentation","globalCode"])),u.appendChild(_m(D=>c.addModelDataListener("problems",D))),c.fireModelDataListeners(),u}function tS(c){const r=document.createElement("h2");r.textContent=c.id||"Module";const u=document.createElement("p");return u.textContent=`Select a function to edit it.
Edit program-wide settings here.`,[r,u]}function eS(c){return Hl("documentation",c,{placeholder:pg,required:!0})}function iS(c){const r=document.createElement("input");return r.type="text",r.className="func-authors",r.placeholder="Authors...",r.required=!0,r.addEventListener("input",u=>{c.set("authors",u.target.value,u.target.selectionStart)}),c.listen("authors",u=>{u=u??"",r.value!==u&&(r.value=u)}),c.listenRO("authors",u=>{r.readOnly=u}),yo(r,"By:")}function sS(c,r,u){const g=Hl("testDocumentation",u,{placeholder:`Tests for the "${c.id}" module`}),w=yo(g,"Test Documentation");if(!r.adminMode){let N=function(){const D=Array.from(c.functions.values()).some(E=>E.get("testable"));w.style.display=D&&c.modelData.get("showTestDocumentation")?"":"none"};var k=N;u.listen("showTestDocumentation",N),c.addFuncListener("testable",N)}return w}function nS(c){return yo(Au("showTestDocumentation",c),"Show Test Documentation: ")}function oS(c,r){return Nc(c,"globalCode",r,"Global Code",`# Write your module-level code here (e.g. imports)
`)}const rS={functions:[{key:"1",name:"main"}],calls:[]},aS=["int","float","str","bool","list","tuple","dict","set"];function lS(c,r,u={}){c=typeof c=="string"?document.getElementById(c):c,c.classList.add("func-planner"),u={...u},u.title=u.title||null,u.initialModel=u.initialModel??rS,u.allowedTypes=u.allowedTypes??aS,u.adminMode=u.adminMode??!1,u.callGraphOnly=u.callGraphOnly??!1,u.theme=localStorage.getItem("func-planner-theme")==="dark"?"dark":"light";const g=new U1(r,u.initialModel),w=lk(c,g,u);if(nb(w,g,u),tb(g,u,w.div),G1(g,u),!u.callGraphOnly){const k=ek(w.div),N=_k(g,u),[D,E]=Ik(g,u);k.append(N,D),D.style.display="none",w.addDiagramListener("ChangedSelection",U=>{let F=U.subject.first();if(!F)N.style.display="",D.style.display="none";else{if(F instanceof pe.Link)return;E(F.data.key),N.style.display="none",D.style.display=""}})}}window.addEventListener("DOMContentLoaded",()=>{lS("planner","default",{allowedTypes:["int","float","str","bool","list","tuple","dict","set","custom"],minFunctions:5,minTestable:2,adminMode:!0})});
