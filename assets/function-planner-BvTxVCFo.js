var an=Object.defineProperty;var lt=s=>{throw TypeError(s)};var ln=(s,e,t)=>e in s?an(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Fe=(s,e,t)=>ln(s,typeof e!="symbol"?e+"":e,t),Ae=(s,e,t)=>e.has(s)||lt("Cannot "+t);var v=(s,e,t)=>(Ae(s,e,"read from private field"),t?t.call(s):e.get(s)),S=(s,e,t)=>e.has(s)?lt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),T=(s,e,t,n)=>(Ae(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),f=(s,e,t)=>(Ae(s,e,"access private method"),t);var Ie=(s,e,t,n)=>({set _(i){T(s,e,i,t)},get _(){return v(s,e,n)}});import{S as M,r as cn,a as un}from"./ui-BFtFxnTg.js";import{g as St,r as dn,D as hn,I as fn,U as pn,Y as ye,a as Be,b as be}from"./yjs-AbTu9oK0.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const Lt=""+new URL("python-BgkpLXkY.svg",import.meta.url).href,Et=""+new URL("unit-tests--DQ2f1F5.svg",import.meta.url).href,Tt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='currentColor'%20fill-rule='evenodd'%20d='M14,9%20C14.5523,9%2015,9.44772%2015,10%20L15,13%20C15,14.1046%2014.1046,15%2013,15%20L3,15%20C1.89543,15%201,14.1046%201,13%20L1,10%20C1,9.44772%201.44772,9%202,9%20C2.55228,9%203,9.44771%203,10%20L3,13%20L13,13%20L13,10%20C13,9.44771%2013.4477,9%2014,9%20Z%20M8,1%20C8.55228,1%209,1.44772%209,2%20L9,6.58579%20L10.2929,5.29289%20C10.6834,4.90237%2011.3166,4.90237%2011.7071,5.29289%20C12.0976,5.68342%2012.0976,6.31658%2011.7071,6.70711%20L8,10.4142%20L4.29289,6.70711%20C3.90237,6.31658%203.90237,5.68342%204.29289,5.29289%20C4.68342,4.90237%205.31658,4.90237%205.70711,5.29289%20L7,6.58579%20L7,2%20C7,1.44772%207.44772,1%208,1%20Z'/%3e%3c/svg%3e",Pt="TODO: program header",ve="func-planner-drag-over";function tt(s){if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(s).then();else{let e=document.createElement("textarea");e.value=s,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}}function mn(s,e=80,t=4){e=e-t,t=" ".repeat(t),s=s.replace(new RegExp(`(?![^\\n]{1,${e}}$)([^\\n]{1,${e}})\\s`,"g"),t+`$1
`);let n=s.lastIndexOf(`
`);return n===-1?`${t}${s}`:(s=s.slice(0,n)+`
`+t+s.slice(n+1),s)}function Ot(s,e=4){return e=" ".repeat(e),s.split(`
`).map(t=>e+t).join(`
`)}function gn(s){let e=[];for(let t=0;t<s.length;t++){const n=s[t];if(n==="(")e.push(t);else if(n===")"&&e.pop()===0)return[s.slice(1,t).trim(),s.slice(t+1).trim()]}return[null,s]}function yn(s){const e=[];let t="",n=0;for(let i=0;i<s.length;i++){const o=s[i];o==="("?(n++,t+=o):o===")"?(n--,t+=o):o===","&&n===0?(e.push(t.trim()),t=""):t+=o}return t&&e.push(t.trim()),e}function bn(s){if(s=s.trim(),s.startsWith("(")&&s.endsWith(")")){let[e,t]=gn(s);if(t==="")return e}return s}function nt(s){return bn(s.trim().replace(/\s+/g," "))}function Ne(s,e){return s=nt(s),s=s.replace(/, ?and\b/,",").replace(/ and\b/,", "),yn(s).map(t=>e(t.trim(),!0)).join(", ")}function _t(s,e){s=s.slice(10);let[t,n]=s.split(" associated with ");return t.startsWith("keys of ")&&(t=t.slice(8)),n.startsWith("values of ")&&(n=n.slice(10)),[e(t,!0),e(n,!0)]}function Mt(s){let e=s.split(" ");return e[0].endsWith("s")&&(e[0]=e[0].slice(0,-1)),e.join(" ")}const ct={int:"0",str:'""',float:"0.0",bool:"False",list:"[]",tuple:"()",dict:"{}",set:"set()"};function j(s,e=!1){return s=nt(s),e&&(s=Mt(s)),ct[s]?ct[s]:s.startsWith("list of ")?`[${j(s.slice(8),!0)}]`:s.startsWith("list with ")?`[${Ne(s.slice(10),j)}]`:s.startsWith("tuple of ")?`(${j(s.slice(9),!0)},)`:s.startsWith("tuple with ")?`(${Ne(s.slice(11),j)})`:s.startsWith("dict of ")?`{"": ${j(s.slice(8),!0)}}`:s.startsWith("dict with ")?`{${_t(s,j).join(": ")}}`:s.startsWith("set of ")?`{${j(s.slice(7),!0)}}`:"None"}function W(s,e=!1){return s=nt(s),e&&(s=Mt(s)),s.startsWith("list of ")?`list[${W(s.slice(8),!0)}]`:s.startsWith("list with ")?`list[${Ne(s.slice(10),W)}]`:s.startsWith("tuple of ")?`tuple[${W(s.slice(9),!0)}, ...]`:s.startsWith("tuple with ")?`tuple[${Ne(s.slice(11),W)}]`:s.startsWith("dict of ")?`dict[str, ${W(s.slice(8),!0)}]`:s.startsWith("dict with ")?`dict[${_t(s,W).join(", ")}]`:s.startsWith("set of ")?`set[${W(s.slice(7),!0)}]`:s}const ut="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Nt(s){return ut.charAt(s%ut.length)}function vn(s,e,t=!0){let n=(s.name||Nt(e)).trim();return!t||!s.type?n:`${n}: ${W(s.type)}`}function Dt(s,e,t,n=!0,i=!1){const o=e.map((c,h)=>vn(c,h,n));let r="";if(n&&t.length>0){const c=t.map(h=>h.type?W(h.type):"object");r=" -> "+(t.length===1?c[0]:`tuple[${c.join(", ")}]`)}const a=`${s}(${o.join(", ")})${r}`;return i?a:`def ${a}:`}function dt(s,e,t){let n="";if(e.length===1)n=`    ${s}: ${t(e[0],0)}
`;else if(e.length>1){n=`    ${s}s:
`;for(let[i,o]of e.entries())n+=`        ${t(o,i)}
`}return n}function wn(s,e,t){let n=`    """
${mn(s)}

`;return n+=dt("Parameter",e,(i,o)=>`${i.name||Nt(o)} (${i.type}): ${i.desc}`),n+=dt("Return",t,(i,o)=>`${i.type}: ${i.desc}`),n+=`    """
`,n}function xn(s,e=!0){var o,r,a,c,h,d;const t=s.modelData.toJSON();let n=`"""
${t.documentation||Pt}

By: ${t.authors||"TODO"}
"""

`;t.globalCode&&(n+=`${t.globalCode}

`);let i=null;for(const[l,u]of s.functions.entries()){const m=((o=u.get("name"))==null?void 0:o.toString())||`function${l}`,g=((r=u.get("params"))==null?void 0:r.toJSON())||[],p=((a=u.get("returns"))==null?void 0:a.toJSON())||[];let w=Dt(m,g,p,e)+`
`;const x=((c=u.get("desc"))==null?void 0:c.toString())||"";x&&(w+=wn(x,g,p));const C=((h=u.get("code"))==null?void 0:h.toString())||"";if(C)w+=Ot(C,4);else{w+=`    # TODO: implement this function
`;const O=(d=s.calledFunctions[l])==null?void 0:d.map(k=>{var E,pe;return((pe=(E=s.functions.get(k))==null?void 0:E.get("name"))==null?void 0:pe.toString())||`function${k}`});(O==null?void 0:O.length)>0&&(w+=`    # Calls ${O.map(k=>k+"()").join(", ")}
`);const I=u.get("io")||"none";I==="validation"?w+=`    # Has direct user input that requires validation
`:I==="input"?w+=`    # Has direct user input
`:I==="output"&&(w+=`    # Has direct user output
`),p.length>0?w+=`    return ${p.map(k=>j(k.type)).join(", ")}`:w+="    pass"}m==="main"?i=w:n+=w+`


`}return i&&(n+=i+`


if __name__ == "__main__":
    main()
`),n}function Cn(s,e,t=!0){const n=xn(s,t);tt(n),M.fire({theme:e.theme,imageUrl:Lt,imageWidth:"6em",title:"Python Template Copied",html:'Python template copied to clipboard.<br>Paste it into a Python file.<br><a href="data:text/plain;charset=utf-8,'+encodeURIComponent(n)+'" download="'+s.id+'.py">Click here to download it.</a>',showCloseButton:!0})}function kn(s){var n;const e=s.modelData.toJSON();let t=`"""
${e.testDocumentation||"Tests for the "+s.id+" module"}

By: ${e.authors||"TODO"}
"""

import pytest

import `+s.id+`

`;for(const[i,o]of s.functions.entries())if(o.get("testable")){const r=((n=o.get("name"))==null?void 0:n.toString())||`function${i}`;t+=`def test_${r}():
`,t+=o.testCode?Ot(o.testCode,4):`    # TODO: write tests for ${r}()
    pass`,t+=`

`}return t+=`if __name__ == '__main__':
    pytest.main(["--no-header", "--tb=short"])
`,t}function Sn(s,e={}){const t=kn(s);tt(t),M.fire({theme:e.theme,imageUrl:Et,imageWidth:"6em",title:"Python Unit Tests Copied",html:'Python unit tests copied to clipboard.<br>Paste it into a Python file that ends with <code>_test.py</code>.<br><a href="data:text/plain;charset=utf-8,'+encodeURIComponent(t)+'" download="'+s.id+'_test.py">Click here to download it.</a>',showCloseButton:!0})}function Ln(s,e,t,n="auto"){M.fire({title:s,text:e,icon:"warning",theme:n,showCancelButton:!0,showCloseButton:!0,focusConfirm:!1}).then(i=>{i&&t()})}function En(s,e){const t=Array.from(s.functions).reduce((n,i)=>Math.max(n,parseInt(i.key)),-1);e.model.transact(()=>{e.functions.forEach(n=>{const i=(parseInt(n.key)+t).toString();n={...n},delete n.key,s.functions.set(i,s.convertFuncData(n))}),e.calls.forEach(n=>{const i=(parseInt(n.from)+t).toString(),o=(parseInt(n.to)+t).toString();s.calls.set(`${i}-${o}`,!0)})})}function $t(s,e,t=!0){t?Ln("Reset to Default?","Are you sure you want to load the default functions for this plan? This will clear the current plan.",()=>{$t(s,e,!1)},e.theme):s.resetModel()}function Tn(s,e={}){const t=s.exportModel(),n=JSON.stringify(t,null,2);tt(n),M.fire({theme:e.theme,imageUrl:Tt,imageWidth:"6em",title:"JSON Copied",html:'JSON version copied to clipboard.<br>Save to a file so it can be reloaded later.<br><a href="data:application/json;charset=utf-8,'+encodeURIComponent(n)+'" download="'+s.id+'-plan.json">Click here to download it.</a>',showCloseButton:!0})}function Pn(s,e={}){M.fire({theme:e.theme,title:"Load JSON",html:"Paste the JSON data below.<br>This will <em>overwrite</em> the current plan.",input:"textarea",showCancelButton:!0,showCloseButton:!0,inputValidator:t=>{if(!t)return"JSON data is required.";try{const n=JSON.parse(t);if(!n.functions||!n.calls)return"Invalid JSON format. Expected 'functions' and 'calls' keys at a minimum."}catch{return"Invalid JSON format"}return null}}).then(t=>{t.isConfirmed&&st(s,e,t.value,!1)})}function st(s,e={},t,n=!1){try{const i=JSON.parse(t);if(!i.functions||!i.calls)throw new Error("Invalid JSON format. Expected 'functions' and 'calls' keys at a minimum.");n?En(s,i):s.importModel(i)}catch(i){console.error("Invalid JSON data:",i),M.fire({theme:e.theme,title:"Invalid JSON",text:"The JSON data is invalid.",icon:"error",showCloseButton:!0})}}function ht(s,e={},t){const n=new FileReader;n.onload=()=>{st(s,e,n.result)},n.onerror=()=>{M.fire({theme:e.theme,title:"File Error",text:"Error reading the file. Please try again.",icon:"error",showCloseButton:!0})},n.readAsText(t)}function On(s,e={},t){t.addEventListener("drop",n=>{if(n.preventDefault(),t.classList.remove(ve),n.dataTransfer.items){const i=n.dataTransfer.items[0];i.kind==="file"?ht(s,e,i.getAsFile()):i.kind==="string"&&i.getAsString(o=>{o.startsWith("{")&&st(s,e,o)})}else n.dataTransfer.files&&ht(s,e,n.dataTransfer.files[0])}),t.addEventListener("dragenter",n=>{n.preventDefault(),t.classList.add(ve)}),t.addEventListener("dragover",n=>{n.preventDefault(),t.classList.add(ve)}),t.addEventListener("dragleave",n=>{t.classList.remove(ve)})}const it=localStorage.getItem("func-planner-show-collapse-button")==="true",ot=localStorage.getItem("func-planner-allow-recursive")==="true";function _n(s,e){s===it&&e===ot||(localStorage.setItem("func-planner-show-collapse-button",s?"true":"false"),localStorage.setItem("func-planner-allow-recursive",e?"true":"false"),location.reload())}function Re(s,e){return s===e?!0:typeof s!=typeof e||s===null||e===null||typeof s!="object"?!1:Array.isArray(s)&&Array.isArray(e)&&s.length==e.length&&s.every((t,n)=>Re(t,e[n]))?!0:Object.keys(s).length!==Object.keys(e).length?!1:Object.keys(s).every(t=>t in e&&Re(s[t],e[t]))}function Ft(s){return JSON.parse(JSON.stringify(s))}function De(s,e,t=""){fetch(s).then(n=>n.text()).then(n=>{e.innerHTML=n}).catch(n=>{console.error(`Error loading SVG from ${s}:`,n),e.textContent=t})}function Q(s,e){let t=document.createElement("option");return t.value=s,t.text=e||s,t}function At(s){const e=document.createElement("div");return e.innerHTML=s,e.firstElementChild}function Mn(){var e,t;return(((t=(e=window.navigator)==null?void 0:e.userAgentData)==null?void 0:t.platform)||window.navigator.platform).toLowerCase().indexOf("mac")!==-1}const Nn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20version='1.1'%20width='256'%20height='256'%20viewBox='0%200%20256%20256'%20xml:space='preserve'%3e%3cg%20style='stroke:%20none;%20stroke-width:%200;%20stroke-dasharray:%20none;%20stroke-linecap:%20butt;%20stroke-linejoin:%20miter;%20stroke-miterlimit:%2010;%20fill:%20none;%20fill-rule:%20nonzero;%20opacity:%201;'%20transform='translate(1.4065934065934016%201.4065934065934016)%20scale(2.81%202.81)'%3e%3ccircle%20cx='36.531000000000006'%20cy='36.521'%20r='32.081'%20style='stroke:%20none;%20stroke-width:%201;%20stroke-dasharray:%20none;%20stroke-linecap:%20butt;%20stroke-linejoin:%20miter;%20stroke-miterlimit:%2010;%20fill:%20rgb(206,226,242);%20fill-rule:%20nonzero;%20opacity:%201;'%20transform='%20matrix(1%200%200%201%200%200)%20'/%3e%3cpath%20d='M%2088.696%2082.394%20L%2065.313%2059.011%20c%205.019%20-6.397%207.75%20-14.231%207.75%20-22.488%20c%200%20-9.758%20-3.8%20-18.932%20-10.7%20-25.832%20c%20-14.241%20-14.243%20-37.419%20-14.242%20-51.663%200%20C%203.8%2017.591%200%2026.765%200%2036.523%20s%203.8%2018.932%2010.699%2025.831%20c%206.9%206.901%2016.074%2010.7%2025.832%2010.7%20c%208.258%200%2016.092%20-2.731%2022.488%20-7.75%20l%2023.383%2023.383%20c%200.868%200.869%202.008%201.304%203.147%201.304%20c%201.139%200%202.278%20-0.435%203.147%20-1.304%20C%2090.435%2086.95%2090.435%2084.132%2088.696%2082.394%20z%20M%2016.994%2056.061%20c%20-5.219%20-5.218%20-8.093%20-12.157%20-8.093%20-19.538%20s%202.874%20-14.319%208.093%20-19.538%20c%205.386%20-5.386%2012.462%20-8.08%2019.537%20-8.08%20c%207.076%200%2014.152%202.693%2019.538%208.08%20c%205.218%205.219%208.093%2012.157%208.093%2019.538%20s%20-2.874%2014.319%20-8.093%2019.538%20s%20-12.157%208.093%20-19.538%208.093%20S%2022.213%2061.279%2016.994%2056.061%20z'%20style='stroke:%20none;%20stroke-width:%201;%20stroke-dasharray:%20none;%20stroke-linecap:%20butt;%20stroke-linejoin:%20miter;%20stroke-miterlimit:%2010;%20fill:%20rgb(50,71,92);%20fill-rule:%20nonzero;%20opacity:%201;'%20transform='%20matrix(1%200%200%201%200%200)%20'%20stroke-linecap='round'/%3e%3ccircle%20cx='23.267'%20cy='23.257'%20r='5.977'%20style='stroke:%20none;%20stroke-width:%201;%20stroke-dasharray:%20none;%20stroke-linecap:%20butt;%20stroke-linejoin:%20miter;%20stroke-miterlimit:%2010;%20fill:%20rgb(227,238,247);%20fill-rule:%20nonzero;%20opacity:%201;'%20transform='%20matrix(1%200%200%201%200%200)%20'/%3e%3ccircle%20cx='33.677'%20cy='33.667'%20r='3.357'%20style='stroke:%20none;%20stroke-width:%201;%20stroke-dasharray:%20none;%20stroke-linecap:%20butt;%20stroke-linejoin:%20miter;%20stroke-miterlimit:%2010;%20fill:%20rgb(227,238,247);%20fill-rule:%20nonzero;%20opacity:%201;'%20transform='%20matrix(1%200%200%201%200%200)%20'/%3e%3c/g%3e%3c/svg%3e",It="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3csvg%20height='800px'%20width='800px'%20version='1.1'%20id='Capa_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20309.059%20309.059'%20xml:space='preserve'%3e%3cg%3e%3cg%3e%3cpath%20style='fill:currentColor;'%20d='M280.71,126.181h-97.822V28.338C182.889,12.711,170.172,0,154.529,0S126.17,12.711,126.17,28.338%20v97.843H28.359C12.722,126.181,0,138.903,0,154.529c0,15.621,12.717,28.338,28.359,28.338h97.811v97.843%20c0,15.632,12.711,28.348,28.359,28.348c15.643,0,28.359-12.717,28.359-28.348v-97.843h97.822%20c15.632,0,28.348-12.717,28.348-28.338C309.059,138.903,296.342,126.181,280.71,126.181z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Dn="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%20512%20512'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cg%20id='Page-1'%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%3e%3cg%20id='Combined-Shape'%20fill='currentColor'%20transform='translate(74.806872,%2064.000000)'%3e%3cpath%20d='M351.859794,42.6666667%20L351.859794,85.3333333%20L283.193855,85.3303853%20C319.271288,116.988529%20341.381875,163.321355%20341.339886,213.803851%20C341.27474,291.98295%20288.098183,360.121539%20212.277591,379.179704%20C136.456999,398.237869%2057.3818117,363.341907%2020.3580507,294.485411%20C-16.6657103,225.628916%20-2.17003698,140.420413%2055.5397943,87.68%20C63.6931909,100.652227%2075.1888658,111.189929%2088.8197943,118.186667%20C59.4998648,141.873553%2042.4797783,177.560832%2042.5264609,215.253333%20C43.5757012,285.194843%20100.577082,341.341203%20170.526461,341.333333%20C234.598174,342.388718%20289.235113,295.138227%20297.4321,231.584253%20C303.556287,184.101393%20282.297007,138.84385%20245.195596,112.637083%20L245.193128,192%20L202.526461,192%20L202.526461,42.6666667%20L351.859794,42.6666667%20Z%20M127.859794,-1.42108547e-14%20C151.423944,-1.42108547e-14%20170.526461,19.1025173%20170.526461,42.6666667%20C170.526461,66.230816%20151.423944,85.3333333%20127.859794,85.3333333%20C104.295645,85.3333333%2085.1931276,66.230816%2085.1931276,42.6666667%20C85.1931276,19.1025173%20104.295645,-1.42108547e-14%20127.859794,-1.42108547e-14%20Z'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/svg%3e",$n="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20122.04%20122.88'%20style='enable-background:new%200%200%20122.04%20122.88'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0%20{%20fill-rule:%20evenodd;%20clip-rule:%20evenodd;%20fill:%20currentColor;%20}%20%3c/style%3e%3cg%3e%3cpath%20class='st0'%20d='M4.73,9.3v39.28h39.28l4.63,0l-3.27-3.28L33.91,33.85c0.76-0.73,1.54-1.44,2.36-2.11%20c1.08-0.88,2.22-1.72,3.38-2.48l0,0c6.02-3.92,13.21-6.21,20.94-6.21l0.01,0v-0.01c10.59,0,20.18,4.3,27.12,11.24%20c6.94,6.94,11.24,16.53,11.24,27.11h-0.01v0.05h0.01c0,10.59-4.3,20.19-11.24,27.12c-6.94,6.94-16.53,11.24-27.11,11.24v-0.01%20l-0.08,0v0.01c-3.7,0-7.39-0.54-10.93-1.59v0c-1.95-0.58-3.87-1.33-5.71-2.22c-9.39-4.54-16.65-12.8-19.87-22.87l-0.43-1.33%20L0,71.82l0.47,2.3l0.01,0.06v0.01c0.8,3.84,2,7.62,3.53,11.24v0.01c1.51,3.55,3.38,6.98,5.53,10.19%20c11.03,16.43,29.78,27.25,51.05,27.25l0.01,0v-0.01c16.96,0,32.33-6.88,43.43-17.99v-0.01c11.1-11.11,17.98-26.45,17.98-43.4%20l0.01,0v-0.05h-0.01c0-16.96-6.88-32.32-18-43.43l0,0C92.93,6.89,77.58,0.02,60.63,0.01V0l-0.06,0v0.01%20c-8.71,0-17.01,1.82-24.51,5.1c-1.21,0.53-2.42,1.11-3.6,1.71c-5.48,2.83-10.47,6.46-14.83,10.74L8,7.95L4.73,4.67V9.3L4.73,9.3%20L4.73,9.3z'%20/%3e%3c/g%3e%3c/svg%3e",Fn="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20122.04%20122.88'%20style='enable-background:new%200%200%20122.04%20122.88;transform:%20scale(-1,1)'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0%20{%20fill-rule:%20evenodd;%20clip-rule:%20evenodd;%20fill:%20currentColor;%20}%20%3c/style%3e%3cg%3e%3cpath%20class='st0'%20d='M4.73,9.3v39.28h39.28l4.63,0l-3.27-3.28L33.91,33.85c0.76-0.73,1.54-1.44,2.36-2.11%20c1.08-0.88,2.22-1.72,3.38-2.48l0,0c6.02-3.92,13.21-6.21,20.94-6.21l0.01,0v-0.01c10.59,0,20.18,4.3,27.12,11.24%20c6.94,6.94,11.24,16.53,11.24,27.11h-0.01v0.05h0.01c0,10.59-4.3,20.19-11.24,27.12c-6.94,6.94-16.53,11.24-27.11,11.24v-0.01%20l-0.08,0v0.01c-3.7,0-7.39-0.54-10.93-1.59v0c-1.95-0.58-3.87-1.33-5.71-2.22c-9.39-4.54-16.65-12.8-19.87-22.87l-0.43-1.33%20L0,71.82l0.47,2.3l0.01,0.06v0.01c0.8,3.84,2,7.62,3.53,11.24v0.01c1.51,3.55,3.38,6.98,5.53,10.19%20c11.03,16.43,29.78,27.25,51.05,27.25l0.01,0v-0.01c16.96,0,32.33-6.88,43.43-17.99v-0.01c11.1-11.11,17.98-26.45,17.98-43.4%20l0.01,0v-0.05h-0.01c0-16.96-6.88-32.32-18-43.43l0,0C92.93,6.89,77.58,0.02,60.63,0.01V0l-0.06,0v0.01%20c-8.71,0-17.01,1.82-24.51,5.1c-1.21,0.53-2.42,1.11-3.6,1.71c-5.48,2.83-10.47,6.46-14.83,10.74L8,7.95L4.73,4.67V9.3L4.73,9.3%20L4.73,9.3z'%20/%3e%3c/g%3e%3c/svg%3e",An="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2016%2016'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cpath%20d='m%208,10.4142%20c%200.55228,0%201,-0.44772%201,-1%20V%204.82841%20l%201.2929,1.2929%20c%200.3905,0.39052%201.0237,0.39052%201.4142,0%200.3905,-0.39053%200.3905,-1.02369%200,-1.41422%20L%208,1%204.29289,4.70709%20c%20-0.39052,0.39053%20-0.39052,1.02369%200,1.41422%200.39053,0.39052%201.02369,0.39052%201.41422,0%20L%207,4.82841%20V%209.4142%20c%200,0.55228%200.44772,1%201,1%20z'%20id='path943'%20/%3e%3cpath%20d='m%2014,9%20c%200.5523,0%201,0.44772%201,1%20v%203%20c%200,1.1046%20-0.8954,2%20-2,2%20H%203%20C%201.89543,15%201,14.1046%201,13%20V%2010%20C%201,9.44772%201.44772,9%202,9%202.55228,9%203,9.44771%203,10%20v%203%20h%2010%20v%20-3%20c%200,-0.55229%200.4477,-1%201,-1%20z'%20id='path2'%20/%3e%3c/svg%3e",In="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2048%2048'%3e%3cpath%20d='M38.86%2025.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98%202.01c-1.03-.79-2.16-1.46-3.38-1.97l-.75-5.3c-.09-.47-.5-.84-1-.84h-8c-.5%200-.91.37-.99.84l-.75%205.3c-1.22.51-2.35%201.17-3.38%201.97l-4.98-2.01c-.45-.17-.97%200-1.22.43l-4%206.93c-.25.43-.14.97.24%201.28l4.22%203.31c-.08.64-.14%201.29-.14%201.95s.06%201.31.14%201.95l-4.22%203.31c-.38.3-.49.84-.24%201.28l4%206.93c.25.43.77.61%201.22.43l4.98-2.01c1.03.79%202.16%201.46%203.38%201.97l.75%205.3c.08.47.49.84.99.84h8c.5%200%20.91-.37.99-.84l.75-5.3c1.22-.51%202.35-1.17%203.38-1.97l4.98%202.01c.45.17.97%200%201.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zm-14.86%205.05c-3.87%200-7-3.13-7-7s3.13-7%207-7%207%203.13%207%207-3.13%207-7%207z'/%3e%3c/svg%3e",Bn="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns:dc='http://purl.org/dc/elements/1.1/'%20xmlns:cc='http://creativecommons.org/ns%23'%20xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23'%20xmlns:svg='http://www.w3.org/2000/svg'%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2064%2064'%20version='1.1'%3e%3cg%20id='layer1'%3e%3cpath%20d='m%2029.191588,39.791319%20c%20-1.06334,-0.882165%20-1.32499,-1.498527%20-1.34729,-3.173687%20-0.037,-2.776797%201.52601,-5.152147%205.678992,-8.630675%205.33259,-4.466575%206.47416,-8.564501%203.27186,-11.745039%20-1.18764,-1.179564%20-1.76451,-1.372444%20-4.14809,-1.386933%20-3.415152,-0.02075%20-4.874892,0.960552%20-6.752782,4.539549%20-1.6751,3.192528%20-3.05188,4.181224%20-5.23199,3.757233%20-5.754639,-1.119178%20-2.913869,-10.115689%204.41803,-13.9915503%201.669,-0.882289%203.09519,-1.170497%206.45082,-1.303607%207.530772,-0.29873%2012.283352,2.012027%2014.866732,7.2283733%201.14469,2.311347%201.3024,3.11896%201.16013,5.941025%20-0.21059,4.177607%20-1.49939,6.168229%20-6.95257,10.738659%20-2.83149,2.373136%20-4.27783,3.97627%20-4.98858,5.529385%20-1.69628,3.706674%20-3.923882,4.57246%20-6.425262,2.497267%20l%200,0%20z'/%3e%3cpath%20d='m%2027.938158,52.10286%20c%20-2.05979,-2.285886%20-2.15553,-4.889987%20-0.25783,-7.012744%202.73307,-3.057201%207.615992,-1.593986%208.372552,2.508922%200.87511,4.745715%20-4.972332,7.991152%20-8.114722,4.503822%20z'/%3e%3c/g%3e%3c/svg%3e",Rn="func-planner-info-box",ft="func-planner-main-check",pt="func-planner-count",mt="func-planner-testable";function Wn(s,e,t={}){const n=s.div.parentNode;zn(n,t),jn(n,t,s),Un(n),qn(n,s,e,t),Jn(n,e,t)}function qn(s,e,t,n={}){const i=Mn(),o=i?"⌘":"CTRL+",r=document.createElement("div");r.className="func-planner-widgets",s.appendChild(r);const a=document.createElement("div");a.className="button-holder",r.appendChild(a);function c(){t.undoManager.canUndo()&&t.undoManager.undo()}function h(){t.undoManager.canRedo()&&t.undoManager.redo()}document.addEventListener("keydown",g=>{if((i?g.metaKey:g.ctrlKey)&&!g.altKey){const p=g.key.toLowerCase();p==="r"&&!g.shiftKey?(g.preventDefault(),e.zoomToFit()):p==="f"&&!g.shiftKey?(g.preventDefault(),t.addFunc()):p==="z"&&(g.preventDefault(),g.shiftKey?h():c())}},!0),t.addListener("synced",()=>{setTimeout(()=>{e.zoomToFit()},0)}),B(a,Nn,"",`Zoom to Fit (${o}R)`,()=>{e.zoomToFit()}),B(a,It,"no-outline",`Add Function (${o}F)`,()=>{t.addFunc()});const d=B(a,$n,"no-outline",`Undo (${o}Z)`,c),l=B(a,Fn,"no-outline",`Redo (⇧${o}Z)`,h);function u(){d.disabled=!t.undoManager.canUndo(),l.disabled=!t.undoManager.canRedo()}t.undoManager.on("stack-item-added",u),t.undoManager.on("stack-item-popped",u),t.undoManager.on("stack-cleared",u),u(),B(a,Dn,"no-outline","Reset",()=>{$t(t,n)}),B(a,Lt,"","Create Python Template",()=>{Cn(t,n)});const m=B(a,Et,"","Generate Python Unit Tests",()=>{Sn(t,n)});t.addFuncListener("testable",()=>{m.disabled=Array.from(t.functions.values()).every(g=>!g.get("testable"))}),m.disabled=Array.from(t.functions.values()).every(g=>!g.get("testable")),B(a,Tt,"no-outline","Save as JSON",()=>{Tn(t,n)}),B(a,An,"no-outline","Load from JSON",()=>{Pn(t,n)})}function B(s,e,t,n,i){const o=document.createElement("button");let r;e.toLowerCase().startsWith("data:image/svg+xml")||e.toLowerCase().endsWith(".svg")?(r=document.createElement("div"),De(e,r,"")):(r=document.createElement("img"),r.src=e),r.classList=t+" func-planner-icon",o.appendChild(r);const a=document.createElement("span");return a.innerText=n,o.appendChild(a),o.addEventListener("click",i),s.appendChild(o),o}function jn(s,e,t){const n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href="https://cdn.jsdelivr.net/npm/theme-toggles@4.10.1/css/within.min.css",document.head.appendChild(n);const i=e.theme==="dark",o=At(`
<label class="func-planner-fab theme-toggle" title="Toggle theme">
  <input type="checkbox" ${i?"checked":""} />
  <span class="theme-toggle-sr">Toggle theme</span>
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="theme-toggle__within" height="1em" width="1em" viewBox="0 0 32 32" fill="currentColor">
    <clipPath id="theme-toggle__within__clip"><path d="M0 0h32v32h-32ZM6 16A1 1 0 0026 16 1 1 0 006 16" /></clipPath>
    <g clip-path="url(#theme-toggle__within__clip)">
      <path d="M30.7 21.3 27.1 16l3.7-5.3c.4-.5.1-1.3-.6-1.4l-6.3-1.1-1.1-6.3c-.1-.6-.8-.9-1.4-.6L16 5l-5.4-3.7c-.5-.4-1.3-.1-1.4.6l-1 6.3-6.4 1.1c-.6.1-.9.9-.6 1.3L4.9 16l-3.7 5.3c-.4.5-.1 1.3.6 1.4l6.3 1.1 1.1 6.3c.1.6.8.9 1.4.6l5.3-3.7 5.3 3.7c.5.4 1.3.1 1.4-.6l1.1-6.3 6.3-1.1c.8-.1 1.1-.8.7-1.4zM16 25.1c-5.1 0-9.1-4.1-9.1-9.1 0-5.1 4.1-9.1 9.1-9.1s9.1 4.1 9.1 9.1c0 5.1-4 9.1-9.1 9.1z" />
    </g>
    <path
      class="theme-toggle__within__circle"
      d="M16 7.7c-4.6 0-8.2 3.7-8.2 8.2s3.6 8.4 8.2 8.4 8.2-3.7 8.2-8.2-3.6-8.4-8.2-8.4zm0 14.4c-3.4 0-6.1-2.9-6.1-6.2s2.7-6.1 6.1-6.1c3.4 0 6.1 2.9 6.1 6.2s-2.7 6.1-6.1 6.1z"
    />
    <path
      class="theme-toggle__within__inner"
      d="M16 9.5c-3.6 0-6.4 2.9-6.4 6.4s2.8 6.5 6.4 6.5 6.4-2.9 6.4-6.4-2.8-6.5-6.4-6.5z"
    />
  </svg>
</label>`);s.appendChild(o);const r=o.querySelector('input[type="checkbox"]');t.themeManager.currentTheme=i?"dark":"light",s.classList.toggle("dark-mode",i),r.addEventListener("change",a=>{const c=a.target.checked?"dark":"light";localStorage.setItem("func-planner-theme",c),t.themeManager.currentTheme=c,s.classList.toggle("dark-mode",a.target.checked),e.theme=c})}function zn(s,e){const t=document.createElement("div");t.className="func-planner-fab func-planner-settings-button",t.title="Settings",De(In,t,"⚙️"),s.appendChild(t),t.addEventListener("click",()=>{M.fire({theme:e.theme,title:"Function Planner Settings",html:`<div class="func-planner-settings">
  <label><span>Show Collapse Button:</span><input type="checkbox" class="show-collapse-button" ${it?"checked":""}></label><br>
  <label><span>Allow Recursive Calls:</span><input type="checkbox" class="allow-recursive" ${ot?"checked":""}></label>
</div>`,showCancelButton:!0}).then(n=>{if(n.isConfirmed){const i=M.getPopup(),o=i.getElementsByClassName("show-collapse-button")[0].checked,r=i.getElementsByClassName("allow-recursive")[0].checked;_n(o,r)}})})}function Un(s){const e=document.createElement("div");e.className="func-planner-fab func-planner-instructions-button",e.title="Instructions",De(Bn,e,"ℹ️"),s.appendChild(e),s.appendChild(At(`<div class="func-planner-instructions"><h2>Instructions</h2>
<p>The diagram shows the functions and who they call. Clicking on a function
shows details and allows you to edit it.</p>
<p>As you edit the functions, any problems will be shown.
Errors are shown with a <span class="stroke-error">red</span> outline and less
serious warnings with a <span class="stroke-warning">yellow</span> outline.</p>
<p>The color of a function indicates its user I/O type:</p>
<ul>
    <li><span class="bg-testable">Testable</span> - can be tested with a test case</li>
    <li><span class="bg-validation">Validated Input</span> - has user input with validation</li>
    <li><span class="bg-input">Basic Input</span> - has basic user input</li>
    <li><span class="bg-output">Output Only</span> - has user output but no direct user input</li>
    <li><span class="bg-none">None / Indirect</span> - no user I/O itself, but may call functions which do</li>
</ul>
<p>The buttons on the left allow you to add functions, generate a Python
template, and other actions.</p>
<p>To add a new function call, drag from the edge of one function to another.
They can be reconnected as needed. Double-clicking a call will reverse its
direction.</p>
<p>To remove functions or calls, select them and press the delete key.</p></div>`))}function Jn(s,e,t){const n=t.minFunctions??1,i=t.minTestable??0,o=document.createElement("div");o.className=Rn,o.innerHTML=`<table><tr class="${pt}"><td>Functions:</td><td>0</td><td>/</td><td>${n}</td></td></tr><tr class="${mt}"><td>Testable:</td><td>0</td><td>/</td><td>${i}</td></tr></table><span class="${ft} value-hidden value-error">Need a main function</span>`,s.getElementsByClassName("func-planner-widgets")[0].appendChild(o);const r=o.getElementsByClassName(pt)[0],a=o.getElementsByClassName(mt)[0],c=o.getElementsByClassName(ft)[0];n<=1&&r.classList.add("value-hidden"),i<=0&&a.classList.add("value-hidden");function h(){const d=Array.from(e.functions.values()),l=d.some(m=>{var g;return((g=m.get("name"))==null?void 0:g.toString())==="main"});c.classList.toggle("value-hidden",l),e.clearModelDataProblem(null,"main"),l||e.recordModelDataProblem("error","main","There must be a main() function."),r.cells[1].textContent=d.length,r.classList.toggle("value-error",d.length<n),e.clearModelDataProblem(null,"functions"),d.length<n&&e.recordModelDataProblem("error","functions",`There must be at least ${n} functions.`);const u=d.filter(m=>m.get("testable")).length;a.cells[1].textContent=u,a.classList.toggle("value-error",u<i),e.clearModelDataProblem(null,"testable"),u<i&&e.recordModelDataProblem("error","testable",`There must be at least ${i} testable functions.`)}e.addFuncAddListener(h),e.addFuncRemoveListener(h),e.addFuncListener("name",h),e.addFuncListener("testable",h),h()}var Hn=dn();const we=St(Hn),Gn=["documentation","authors","testDocumentation","globalCode"],gt=["name","desc","code","testCode"],yt=["params","returns"];var X,b,L,We,A,xe,Ce,Bt,z,P,ke,qe,je,ze,he,Ue,fe,Je,Rt,ae,U,J,ie,Se,oe,Wt,le,ce,qt,He,jt,zt;class Vn{constructor(e,t={}){S(this,b);S(this,X,{});S(this,A,{});S(this,z,[]);S(this,P,{});S(this,he,[]);S(this,fe,[]);S(this,U,{});S(this,J,{});Fe(this,"calledFunctions",{});Fe(this,"callingFunctions",{});S(this,ie,[]);S(this,oe,{});this.synced=!1,this.id=e,this.initialData=t,this.model=new hn,this.modelData=this.model.getMap("modelData"),this.modelData.observeDeep(n=>{f(this,b,Bt).call(this,n)}),this.functions=this.model.getMap("functions"),this.functions.observeDeep(n=>{f(this,b,Rt).call(this,n)}),this.calls=this.model.getMap("calls"),this.calls.observe(n=>{f(this,b,zt).call(this,n)}),this.indexeddb=new fn(this.id,this.model),this.indexeddb.on("synced",()=>{this.functions.size===0&&this.calls.size===0&&this.importModel(this.initialData),f(this,b,L).call(this,v(this,X).synced),this.synced=!0}),this.undoManager=new pn([this.modelData,this.functions,this.calls],{untrackedOrigins:new Set([this.indexeddb])})}exportModel(){return{...this.modelData.toJSON(),functions:Array.from(this.functions.entries()).map(([e,t])=>{const n=t.toJSON();return n.key=e,n}),calls:Array.from(this.calls.keys()).map(e=>e.split("-")).map(([e,t])=>({from:e,to:t}))}}importModel(e){this.model.transact(()=>{this.modelData.clear(),this.functions.clear(),this.calls.clear();for(const[t,n]of Object.entries(e||{}))["functions","calls"].includes(t)||this.modelData.set(t,n);for(let t of e.functions||[]){const n=t.key.toString();t={...t},delete t.key,this.functions.set(n,this.convertFuncData(t))}for(const{from:t,to:n}of e.calls||[]){const i=`${t}-${n}`;this.calls.set(i,!0)}})}resetModel(){this.importModel(this.initialData)}addListener(e,t){v(this,X)[e]||(v(this,X)[e]=[]),v(this,X)[e].push(t)}fireModelDataListeners(){for(const e of Object.keys(v(this,A)))e==="problems"?f(this,b,Ce).call(this):e!==""&&f(this,b,xe).call(this,e)}addModelDataListener(e,t){v(this,A)[e]||(v(this,A)[e]=[]),v(this,A)[e].push(t)}updateModelData(e,t,n=null){Gn.includes(e)?bt(this.modelData,e,t,n):this.modelData.set(e,t)}recordModelDataProblem(e,t,n){f(this,b,We).call(this,v(this,z),e,t,n)===-1&&(v(this,z).push([e,t,n]),f(this,b,Ce).call(this))}clearModelDataProblem(e=null,t=null,n=null){const i=f(this,b,We).call(this,v(this,z),e,t,n);i!==-1&&(v(this,z).splice(i,1),f(this,b,Ce).call(this))}fireFuncListeners(e){for(const t of Object.keys(v(this,P)))t==="problems"?f(this,b,je).call(this,e):t==="linkProblems"?f(this,b,ze).call(this,e):t!==""&&f(this,b,ke).call(this,e,t)}addFuncListener(e,t){v(this,P)[e]||(v(this,P)[e]=[]),v(this,P)[e].push(t)}addFuncAddListener(e){v(this,he).push(e)}addFuncRemoveListener(e){v(this,fe).push(e)}addFunc(e={}){const t=Array.from(this.functions.keys()).map(i=>parseInt(i)),n=(Math.max(-1,...t)+1).toString();this.functions.set(n,this.convertFuncData(e))}convertFuncData(e){return e instanceof ye?e:(e instanceof Map&&(e=Object.fromEntries(e)),new ye(Object.entries(e).map(([t,n])=>{const i=gt.includes(t)?new Be(n):yt.includes(t)?be.from(n.map(this.convertFuncData)):n;return[t,i]})))}removeFunc(e){this.model.transact(()=>{for(const t of this.calledFunctions[e]||[])this.calls.delete(`${e}-${t}`);for(const t of this.callingFunctions[e]||[])this.calls.delete(`${t}-${e}`);this.functions.delete(e)})}removeFuncs(e){this.model.transact(()=>{this.calls.forEach((t,n)=>{const[i,o]=n.split("-");(e.includes(i)||e.includes(o))&&this.calls.delete(n)});for(const t of e)this.functions.delete(t)})}updateFunc(e,t,n,i=null){const o=this.functions.get(e);if(!o){console.error(`Function with key ${e} does not exist`);return}if(yt.some(r=>t.startsWith(r))){const[r,a,c]=this.parseFuncProperty(t);a==null?o.set(r,new be(n.map(this.convertFuncData))):this.model.transact(()=>{const h=!o.has(r),d=o.get(r)??new be;if(h&&o.set(r,d),!h&&a<d.length){const l=d.get(a);if(c==null){for(const[u,m]of Object.entries(n))f(this,b,ae).call(this,l,u,m);for(const u of l.keys())u in n||l.delete(u)}else f(this,b,ae).call(this,l,c,n,i)}else if(c==null)d.insert(a,[this.convertFuncData(n)]);else{const l=new ye;d.insert(a,[l]),f(this,b,ae).call(this,l,c,n,i)}})}else f(this,b,ae).call(this,o,t,n,i)}parseFuncProperty(e){const t=/(params|returns)(\[(\d+)\](\.(name|desc|type))?)?/.exec(e);if(t){const[,n,,i,,o]=t;return[n,i?parseInt(i):null,o??null]}return[e,null,null]}addFuncItem(e,t,n=-1){const i=this.functions.get(e);if(!i){console.error(`Function with key ${e} does not exist`);return}const o=!i.has(t),r=i.get(t)??new be;this.model.transact(()=>{o&&i.set(t,r),n===-1&&(n=o?0:r.length),r.insert(n,[new ye])})}removeFuncItem(e,t,n){const i=this.functions.get(e).get(t);i&&n<i.length&&i.delete(n,1)}moveFuncItem(e,t,n,i){const o=this.functions.get(e).get(t);if(o&&n<o.length){const r=o.get(n).clone();this.model.transact(()=>{o.delete(n,1),o.insert(i,[r])})}}setFuncProblems(e,t){v(this,U)[e]||(v(this,U)[e]=[]),v(this,U)[e]=[...t],f(this,b,je).call(this,e)}getFuncProblems(e){return v(this,U)[e]||[]}setFuncLinkProblems(e,t){v(this,J)[e]||(v(this,J)[e]=[]),v(this,J)[e]=[...t],f(this,b,ze).call(this,e)}getFuncLinkProblems(e){return v(this,J)[e]||[]}addFuncCallListener(e){v(this,ie).push(e)}addFuncCall(e,t){this.calls.set(`${e}-${t}`,!0)}removeFuncCall(e,t){this.calls.delete(`${e}-${t}`)}removeFuncCalls(e){this.model.transact(()=>{for(const{from:t,to:n}of e)this.calls.delete(`${t}-${n}`)})}updateFuncCall(e,t,n,i){n=n??e,i=i??t,!(n===e&&i===t)&&this.model.transact(()=>{this.calls.delete(`${e}-${t}`),this.calls.set(`${n}-${i}`,!0)})}getFuncCallProblems(e,t){return v(this,oe)[`${e}-${t}`]||[]}setFuncCallProblems(e,t,n){v(this,oe)[`${e}-${t}`]=[...n],f(this,b,Wt).call(this,e,t)}}X=new WeakMap,b=new WeakSet,L=function(e,...t){if(e)for(const n of e)n(...t)},We=function(e,t=null,n=null,i=null){for(let o=0;o<e.length;o++){const[r,a,c]=e[o];if((t==null||r===t)&&(n==null||a===n)&&(i==null||c===i))return o}return-1},A=new WeakMap,xe=function(e){const t=this.modelData.get(e),n=t!=null&&t.toJSON?t.toJSON():t;f(this,b,L).call(this,v(this,A)[e],e,n),f(this,b,L).call(this,v(this,A)[""],e,n)},Ce=function(){f(this,b,L).call(this,v(this,A).problems,"problems",v(this,z))},Bt=function(e){for(const t of e)if(t.target===this.modelData)for(const n of t.changes.keys.keys())f(this,b,xe).call(this,n);else{const n=t.path[0];f(this,b,xe).call(this,n)}},z=new WeakMap,P=new WeakMap,ke=function(e,t){var o,r;const n=this.functions.get(e).get(t),i=n!=null&&n.toJSON?n.toJSON():n;f(this,b,L).call(this,(o=v(this,P))==null?void 0:o[t],e,t,i),f(this,b,L).call(this,(r=v(this,P))==null?void 0:r[""],e,t,i)},qe=function(e,t,n,i){var a,c;let o=this.functions.get(e).get(i[0]);for(let h=1;h<i.length;h++)o=o.get(i[h]);const r=o!=null&&o.toJSON?o.toJSON():o;f(this,b,L).call(this,(a=v(this,P))==null?void 0:a[t],e,n,r),f(this,b,L).call(this,(c=v(this,P))==null?void 0:c[""],e,n,r)},je=function(e){const t=v(this,U)[e]??[];f(this,b,L).call(this,v(this,P).problems,e,"problems",t)},ze=function(e){const t=v(this,J)[e]??[];f(this,b,L).call(this,v(this,P).linkProblems,e,"linkProblems",t)},he=new WeakMap,Ue=function(e){const t=this.functions.get(e).toJSON();delete t.isTrusted,f(this,b,L).call(this,v(this,he),e,t)},fe=new WeakMap,Je=function(e){f(this,b,L).call(this,v(this,fe),e)},Rt=function(e){var t,n;for(const i of e)if(i.target===this.functions)for(const[o,{action:r,oldValue:a}]of i.changes.keys)r==="add"?f(this,b,Ue).call(this,o):r==="delete"?f(this,b,Je).call(this,o):r==="update"&&(((t=Object.keys(a==null?void 0:a.toJSON()))==null?void 0:t.length)!==0&&(console.warn("Unexpected update action on Yjs functions map"),console.warn(r,o,a==null?void 0:a.toJSON(),"->",(n=this.functions.get(o))==null?void 0:n.toJSON())),f(this,b,Je).call(this,o),f(this,b,Ue).call(this,o));else if(i.path.length===1){const o=i.path[0];for(const r of i.changes.keys.keys())f(this,b,ke).call(this,o,r)}else if(i.path.length===2){const[o,r]=i.path;f(this,b,ke).call(this,o,r)}else if(i.path.length===3){const[o,r,a]=i.path;f(this,b,qe).call(this,o,r,`${r}[${a}]`,[r,a])}else if(i.path.length===4){const[o,r,a,c]=i.path;f(this,b,qe).call(this,o,r,`${r}[${a}].${c}`,[r,a,c])}else console.error("Unexpected event path length in Yjs functions observer:",i.path)},ae=function(e,t,n,i=null){gt.includes(t)?bt(e,t,n,i):e.set(t,n)},U=new WeakMap,J=new WeakMap,ie=new WeakMap,Se=function(e,t,n,i,o){f(this,b,L).call(this,v(this,ie),e,t,n,i,o)},oe=new WeakMap,Wt=function(e,t){const n=v(this,oe)[`${e}-${t}`]??[];f(this,b,L).call(this,v(this,ie),"problems",e,t,n)},le=function(e,t,n){e[t]||(e[t]=[]),e[t].push(n)},ce=function(e,t,n){e[t]&&(e[t]=e[t].filter(i=>i!==n))},qt=function(e){const[t,n]=e.split("-");f(this,b,le).call(this,this.calledFunctions,t,n),f(this,b,le).call(this,this.callingFunctions,n,t),f(this,b,Se).call(this,"add",null,null,t,n)},He=function(e){const[t,n]=e.split("-");f(this,b,ce).call(this,this.calledFunctions,t,n),f(this,b,ce).call(this,this.callingFunctions,n,t),f(this,b,Se).call(this,"delete",t,n,null,null)},jt=function(e,t){const[n,i]=e.split("-"),[o,r]=t.split("-");f(this,b,ce).call(this,this.calledFunctions,n,i),f(this,b,ce).call(this,this.callingFunctions,i,n),f(this,b,le).call(this,this.calledFunctions,o,r),f(this,b,le).call(this,this.callingFunctions,r,o),f(this,b,Se).call(this,"update",n,i,o,r)},zt=function(e){let t=null;for(const[n,{action:i,oldValue:o}]of e.changes.keys)i==="add"?t!==null?(f(this,b,jt).call(this,t,n),t=null):f(this,b,qt).call(this,n):i==="delete"?(t!==null&&f(this,b,He).call(this,t),t=n):i==="update"&&(o===this.calls.get(n)||(console.warn("Unexpected update action on Yjs calls map"),console.warn(i,n,o,"->",this.calls.get(n))));t!==null&&f(this,b,He).call(this,t)};function bt(s,e,t,n=null){if(typeof t=="string"){const i=s.get(e);if(i&&i instanceof Be){const o=i.toString();if(o===t)return;i.applyDelta(Zn(we(o,t,n)))}else s.set(e,new Be(t))}}function Zn(s){return s.map(([e,t])=>e===we.INSERT?{insert:t}:e===we.EQUAL?{retain:t.length}:e===we.DELETE?{delete:t.length}:null)}class Yn extends go.Router{constructor(e){super(),this.name="AvoidsLinksRouter",this._linkSpacing=4,this._allsegs=new go.List,this._gridlines=new go.List,this._segs=new go.List,this._avoidsNodes=!0,this._epsilonDistance=.5,this._iterations=1,this._ignoreContainingGroups=!1,e&&Object.assign(this,e)}get linkSpacing(){return this._linkSpacing}set linkSpacing(e){if(e!==this._linkSpacing){if(typeof e!="number")throw new Error("AvoidsLinksRouter.linkSpacing must be a number");this._linkSpacing=e,this.invalidateRouter()}}get avoidsNodes(){return this._avoidsNodes}set avoidsNodes(e){e=!!e,e!==this._avoidsNodes&&(this._avoidsNodes=e,this.invalidateRouter())}get epsilonDistance(){return this._epsilonDistance}set epsilonDistance(e){if(e!==this._epsilonDistance){if(typeof e!="number")throw new Error("AvoidsLinksRouter.epsilonDistance must be a number");this._epsilonDistance=e,this.invalidateRouter()}}get iterations(){return this._iterations}set iterations(e){if(e!==this._iterations){if(typeof e!="number")throw new Error("AvoidsLinksRouter.iterations must be a number");this._iterations=e,this.invalidateRouter()}}get ignoreContainingGroups(){return this._ignoreContainingGroups}set ignoreContainingGroups(e){e=!!e,e!==this._ignoreContainingGroups&&(this._ignoreContainingGroups=e,this.invalidateRouter())}canRoute(e){return this._ignoreContainingGroups&&e instanceof go.Group?!1:super.canRoute(e)}routeLinks(e,t){const n=this.diagram;if(n!==null)for(let i=0;i<this.iterations;i++){this._allsegs=new go.List,this._gridlines=new go.List,this.collectSegments(e,t);let o=null;this._avoidsNodes&&(o=n.getPositions(!0,null,null)),this.adjustOverlaps(o);for(const r of this._allsegs)for(const a of r)this._freeSegInfo(a);for(const r of this._gridlines)for(const a of r)this._freeSegInfo(a)}}_allocSegInfo(){const e=this._segs.pop();return e||new Kn}_freeSegInfo(e){e.link=null,this._segs.push(e)}_coord(e){return e.vertical?e.link.getPoint(e.indexStart).x:e.link.getPoint(e.indexStart).y}_columnStart(e){return e.vertical?e.link.getPoint(e.indexStart).y:e.link.getPoint(e.indexStart).x}_columnEnd(e){return e.vertical?e.link.getPoint(e.indexEnd).y:e.link.getPoint(e.indexEnd).x}nextOrthoBend(e,t){let n=e.getPoint(t),i=e.getPoint(t+1),o=t;const r=this.isApprox(n.x,i.x)&&!this.isApprox(n.y,i.y);for(;o<e.pointsCount-2;)if(o++,n=e.getPoint(o),i=e.getPoint(o+1),r!==(this.isApprox(n.x,i.x)&&!this.isApprox(n.y,i.y)))return o;return e.pointsCount-1}collectSegments(e,t){this._allsegs.clear(),this._gridlines.clear();const n=t instanceof go.Diagram;let i,o,r,a,c,h=this._allocSegInfo(),d=null;const l=t instanceof go.Diagram&&e.count===t.links.count;for(const u of e)if(!(!this._ignoreContainingGroups&&!(n&&u.containingGroup===null||u.containingGroup===t))&&u.isOrthogonal)for(l||(d===null?d=u.getDocumentBounds():d.unionRect(u.getDocumentBounds())),a=this.nextOrthoBend(u,0);a<u.pointsCount-1&&(c=this.nextOrthoBend(u,a),c!==u.pointsCount-1);){i=u.getPoint(a),o=u.getPoint(c);const m=this.isApprox(i.x,o.x)&&!this.isApprox(i.y,o.y),g=this._allocSegInfo();g.indexStart=a,g.indexEnd=c,g.link=u,g.vertical=m,g._computeGeo(),r=!1;for(const p of this._allsegs)if(Math.abs(this._coord(p.first())-this._coord(g))<this._epsilonDistance&&p.first().vertical===m){r=!0,p.add(g);break}r||this._allsegs.add(new go.List([g])),a=c}if(t&&d!==null&&!l){for(const u of this.diagram.findPartsIn(d,!0))if(u instanceof go.Link&&u.isOrthogonal&&!e.has(u))for(a=this.nextOrthoBend(u,0);a<u.pointsCount-1&&(c=this.nextOrthoBend(u,a),c!==u.pointsCount-1);){i=u.getPoint(a),o=u.getPoint(c);const m=this.isApprox(i.x,o.x)&&!this.isApprox(i.y,o.y),g=m?i.x:i.y;for(const p of this._allsegs)if(Math.abs(this._coord(p.first())-g)<this._epsilonDistance&&p.first().vertical===m){const w=this._allocSegInfo();w.indexStart=a,w.indexEnd=c,w.link=u,w.vertical=m,w._computeGeo(),p.add(w);break}a=c}}for(const u of this._allsegs)for(;u.count>0;){h=u.pop();const m=new go.List([h]);for(r=!0;r;){r=!1;for(const g of m)for(const p of u){const w=Math.min(this._columnStart(p),this._columnEnd(p)),x=Math.max(this._columnStart(p),this._columnEnd(p)),C=Math.min(this._columnStart(g),this._columnEnd(g)),O=Math.max(this._columnStart(g),this._columnEnd(g));if(C<=x&&w<=O&&p.link!==g.link){u.remove(p),m.push(p),r=!0;break}}}this._gridlines.add(m)}}adjustOverlaps(e){const t=this._gridlines;for(const n of t){if(n.size<2)continue;const i=n.toArray();this.sortGridline(i);const o=i[0].vertical,r=i.length-1;let a=this._linkSpacing;if(this._avoidsNodes&&r>0){let c=Math.min(this._columnStart(i[0]),this._columnEnd(i[0])),h=Math.max(this._columnStart(i[0]),this._columnEnd(i[0]));const d=this._coord(i[0])-r*this._linkSpacing/2,l=this._coord(i[0])+r*this._linkSpacing/2;for(let u=1;u<i.length;u++){const m=i[u];c=Math.min(c,Math.min(this._columnStart(m),this._columnEnd(m))),h=Math.max(h,Math.max(this._columnStart(m),this._columnEnd(m)))}if(o){if(!e.isUnoccupied(d,c,l-d,h-c)){const u=e.maxAvoidsLinksSpaceV(c,h,this._coord(i[0]),l-d);a=Math.min(this._linkSpacing,2*u/(1+r))}}else if(!e.isUnoccupied(c,d,h-c,l-d)){const u=e.maxAvoidsLinksSpaceH(c,h,this._coord(i[0]),l-d);a=Math.min(this._linkSpacing,2*u/(1+r))}a===0&&(a=this._linkSpacing)}for(let c=0;c<i.length;c++){const h=i[c];if(h.link===null)continue;const d=this._coord(h)+(c-r/2)*a;h.link.startRoute();for(let l=h.indexStart;l<=h.indexEnd;l++)o?h.link.setPoint(l,new go.Point(d,h.link.getPoint(l).y)):h.link.setPoint(l,new go.Point(h.link.getPoint(l).x,d));h.link.commitRoute()}}}partialSort(e,t,n,i){const o=e.slice(0,t),r=e.slice(n),a=e.slice(t,n).sort(i);return e.length=0,e.push.apply(e,o.concat(a).concat(r)),e}endpointComparer(e,t){const n=Math.min(this._columnStart(e),this._columnEnd(e)),i=Math.max(this._columnStart(e),this._columnEnd(e)),o=Math.min(this._columnStart(t),this._columnEnd(t)),r=Math.max(this._columnStart(t),this._columnEnd(t)),a=this.isApprox(n,o),c=this.isApprox(i,r),h=e.geo;let d=0;return o<=n&&i<=r?h===0&&a?d=1:h===0&&c||h===1&&a?d=-1:h===1&&c||h===2?d=1:h===3&&(d=-1):n<=o&&r<=i?h===0&&a?d=-1:h===0&&c||h===1&&a?d=1:h===1&&c||h===2?d=-1:h===3&&(d=1):o<=n&&r<=i?h===0?d=-1:h===1&&(d=1):n<=o&&i<=r&&(h===0?d=1:h===1&&(d=-1)),d}sortGridline(e){e.sort((d,l)=>l.geo-d.geo);let t=0,n=0,i=0,o=0;for(let d=0;d<e.length;d++)switch(e[d].geo){case 0:t++;break;case 1:n++;break;case 2:i++;break;case 3:o++;break}const r=t,a=t+n,c=t+n+i,h=t+n+i+o;t>1&&this.partialSort(e,0,r,(d,l)=>this.endpointComparer(d,l)),n>1&&this.partialSort(e,r,a,(d,l)=>this.endpointComparer(d,l)),i>1&&this.partialSort(e,a,c,(d,l)=>this.endpointComparer(d,l)),o>1&&this.partialSort(e,c,h,(d,l)=>this.endpointComparer(d,l))}isApprox(e,t){const n=e-t;return n>-.5&&n<.5}}class Kn{constructor(){this.vertical=!1,this.indexStart=NaN,this.indexEnd=NaN,this.link=null,this.geo=0}_computeGeo(){this.vertical?this._computeGeoV():this._computeGeoH()}_computeGeoH(){if(this.link===null)return;let e=this.indexStart-1,t=this.indexEnd+1;for(;e>0&&Math.abs(this.link.getPoint(e).x-this.link.getPoint(e-1).x)<.5;)e--;for(;t<this.link.pointsCount-1&&Math.abs(this.link.getPoint(t).x-this.link.getPoint(t+1).x)<.5;)t++;const n=this.link.getPoint(e).y,i=this.link.getPoint(t).y,o=this.link.getPoint(this.indexStart).y,r=this.link.getPoint(this.indexStart).x,a=this.link.getPoint(this.indexEnd+1).x;r<a?n<o&&i>o?this.geo=0:n>o&&i<o?this.geo=1:n>o&&i>o?this.geo=2:n<o&&i<o&&(this.geo=3):i<o&&n>o?this.geo=0:i>o&&n<o?this.geo=1:i>o&&n>o?this.geo=2:i<o&&n<o&&(this.geo=3)}_computeGeoV(){if(this.link===null)return;let e=this.indexStart-1,t=this.indexEnd+1;for(;e>0&&Math.abs(this.link.getPoint(e).y-this.link.getPoint(e-1).y)<.5;)e--;for(;t<this.link.pointsCount-1&&Math.abs(this.link.getPoint(t).y-this.link.getPoint(t+1).y)<.5;)t++;const n=this.link.getPoint(e).x,i=this.link.getPoint(t).x,o=this.link.getPoint(this.indexStart).x,r=this.link.getPoint(this.indexStart).y,a=this.link.getPoint(this.indexEnd+1).y;r<a?n<o&&i>o?this.geo=0:n>o&&i<o?this.geo=1:n>o&&i>o?this.geo=2:n<o&&i<o&&(this.geo=3):i<o&&n>o?this.geo=0:i>o&&n<o?this.geo=1:i>o&&n>o?this.geo=2:i<o&&n<o&&(this.geo=3)}}function Xn(s,e){Ut(s,e);function t(i){s.setFuncLinkProblems(i,Te(s,i))}function n(i,o,r,a){ue(s,r,e),(i??r)!==r&&ue(s,i,e),t(r),t(a),(i??r)!==r&&t(i),(o??a)!==a&&t(o),s.setFuncCallProblems(r,a,Ee(s,r,a)),Le(s)}s.addFuncAddListener((i,o)=>{s.setFuncProblems(i,Pe(s,i,e,!0)),s.setFuncLinkProblems(i,Te(s,i))}),s.addFuncListener("",(i,o,r)=>{if(!(o==="problems"||o==="linkProblems"))if(s.setFuncProblems(i,Pe(s,i,e,!1)),o==="name"){s.setFuncLinkProblems(i,Te(s,i));for(const h of s.calledFunctions[i]||[])s.setFuncCallProblems(i,h,Ee(s,i,h));for(const h of s.callingFunctions[i]||[])s.setFuncCallProblems(h,i,Ee(s,h,i));const a=(r||"").toString().trim();Array.from(s.functions).filter(h=>{var d,l;return h[0]!==i&&((l=(d=h[1].get("name"))==null?void 0:d.toString())==null?void 0:l.trim())===a}).forEach(h=>{s.setFuncProblems(h[0],Pe(s,h[0],e,!1))}),Le(s)}else o==="io"&&ue(s,i,e)}),s.addFuncCallListener((i,o,r,a,c)=>{i!=="problems"&&(i==="add"||i==="update"?n(o,r,a,c):i==="delete"&&(o&&s.functions.has(o)&&(ue(s,o,e),t(o)),r&&r!==o&&s.functions.has(r)&&t(r),Le(s)))}),e.callGraphOnly||(s.addModelDataListener("documentation",()=>{Ge(s,e)}),s.addModelDataListener("authors",()=>{Ve(s,e)}),Ge(s,e),Ve(s,e))}function Ut(s,e={}){for(const t of s.functions.keys()){s.setFuncProblems(t,Pe(s,t,e)),s.setFuncLinkProblems(t,Te(s,t));for(const n of s.calledFunctions[t]||[])s.setFuncCallProblems(t,n,Ee(s,t,n))}e.callGraphOnly||(Ge(s,e),Ve(s,e)),Le(s)}function Ge(s,e={}){var n;const t=(((n=s.modelData.get("documentation"))==null?void 0:n.toString())||"").trim().length;s.clearModelDataProblem(null,"documentation"),t===0?s.recordModelDataProblem("error","documentation","Module documentation is missing."):t<(e.minModuleDescLength??25)&&s.recordModelDataProblem("warning","documentation","Module documentation is too short.")}function Ve(s,e={}){var n;const t=(((n=s.modelData.get("authors"))==null?void 0:n.toString())||"").trim().length;s.clearModelDataProblem(null,"authors"),t===0?s.recordModelDataProblem("error","authors","Author name(s) are required."):t<3&&s.recordModelDataProblem("warning","authors","Author name(s) seem too short.")}function Le(s,e=null){const t=Qn(s,e).filter(i=>i.length>1),n=es(t);for(const i of s.calls.keys()){const[o,r]=i.split("-"),a=s.getFuncCallProblems(o,r),c=a.some(h=>h[2].includes("cycle"));n.has(o)&&n.get(o).includes(r)?c||s.setFuncCallProblems(o,r,a.concat([["warning","link","Part of a recursive cycle. Recursive functions are tricky, be careful if this is what you intended."]])):c&&s.setFuncCallProblems(o,r,a.filter(h=>!h[2].includes("cycle")))}for(const[i,o]of s.functions){const r=s.getFuncLinkProblems(i),a=r.some(c=>c[2].includes("cycle"));n.has(i)?a||s.setFuncLinkProblems(i,r.concat([["warning","callsInto","Part of a recursive cycle. Recursive functions are tricky, be careful if this is what you intended."]])):a&&s.setFuncLinkProblems(i,r.filter(c=>!c[2].includes("cycle")))}}function Qn(s,e=null){let t=[];const n=Ft(s.calledFunctions),i=new Set(s.functions.keys()),o=[],r=function(a){if(i.has(a)){i.delete(a),o.push(a);for(const c of n[a]||[])o.includes(c)?t.push(o.slice(o.lastIndexOf(c))):r(c);o.pop()}};if(e)r(e),t=t.filter(a=>a.includes(e));else for(;i.size>0;)r(i.values().next().value);return t}function es(s){const e=new Map;for(const t of s)for(let n=0;n<t.length;n++){const i=t[n],o=t[(n+1)%t.length];e.has(i)||e.set(i,[]),e.get(i).push(o)}return e}function ts(s,e,t){if(e===t)return!0;const n=Ft(s.calledFunctions);n[e]||(n[e]=[]),n[e].push(t);const i=new Set,o=[],r=function(a){i.add(a),o.push(a);for(const c of n[a]||[])if(c===e||!o.includes(c)&&r(c))return!0;return o.pop(),!1};return r(t)}function Ee(s,e,t){var o,r;const n=[];return((r=(o=s.functions.get(t).get("name"))==null?void 0:o.toString())==null?void 0:r.trim())==="main"?n.push(["error","link","Main function should not be called by other functions."]):t===e&&n.push(["warning","link","Recursive functions are tricky, be careful if this is what you intended."]),n}function Te(s,e){var r,a,c;const t=[],n=((c=(a=(r=s.functions.get(e))==null?void 0:r.get("name"))==null?void 0:a.toString())==null?void 0:c.trim())==="main",i=s.callingFunctions[e]||[],o=s.calledFunctions[e]||[];return n?(i.length!==0&&t.push(["error","callsInto","Main function should not be called by other functions."]),o.length===0&&t.push(["warning","callsOutOf","Main function should call at least one other function."])):i.length===0?t.push(["error","callsInto","Non-main functions must be called by at least one other function."]):i.includes(e)&&t.push(["warning","callsInto","Recursive functions are tricky, be careful if this is what you intended."]),t}function Jt(s,e,t){var o;const n=[],i=t.io||"none";if(((o=t.name)==null?void 0:o.trim())==="main"&&(["none","indirect"].includes(i)||n.push(["warning","io","Main function should not have any direct user input or output."])),t.testable&&i!=="none"&&n.push(["error","testable,io","We cannot test functions that have direct or indirect user input or output."]),i==="indirect"||i==="none"){const r=Ht(s,e);i==="indirect"?r||n.push(["error","io","Function is marked as having indirect user I/O but no function it calls has user input/output."]):r&&n.push(["error","io","Function is marked as having no user input/output but calls another function with user input/output; it should be marked as 'indirect'."])}return n}function Ht(s,e,t=new Set){var i;if(t.has(e))return!1;t.add(e);const n=(i=s.functions.get(e))==null?void 0:i.get("io");return n&&["validation","input","output"].includes(n)?!0:Array.from(s.calledFunctions[e]||[]).some(o=>Ht(s,o,t))}function ns(s,e){const t=s.functions.get(e).toJSON(),n=s.getFuncProblems(e),i=Jt(s,e,t),o=n.filter(r=>!r[1].split(",").includes("io")).concat(i);Re(n,o)||s.setFuncProblems(e,o)}function ue(s,e,t={},n=new Set){if(!t.callGraphOnly&&!n.has(e)){n.add(e),ns(s,e);for(const i of s.callingFunctions[e]||[])ue(s,i,t,n)}}const ss=new Set(["and","as","assert","async","await","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","nonlocal","not","or","pass","raise","return","try","while","with","yield"]),is=new Set(["abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"]);function Ze(s,e="Function",t="name"){return s?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(s)?ss.has(s)?["error",t,`${e} name cannot be a Python keyword.`]:is.has(s)?["error",t,`${e} name cannot be a Python built-in function or type.`]:s.startsWith("_")||s.endsWith("_")?["warning",t,`${e} name should not start or end with an underscore.`]:/^[a-z_][a-z0-9_]*$/.test(s)?null:["warning",t,`${e} names should be in lowercase with underscores separating words.`]:["error",t,`${e} name must start with a letter or underscore and contain only letters, numbers, and underscores.`]:["error",t,`${e} name is required.`]}function Gt(s,e,t){return!t||!s?!1:Array.from(s.functions).some(i=>{var o,r;return i[0]!==e&&((r=(o=i[1].get("name"))==null?void 0:o.toString())==null?void 0:r.trim())===t})}function Pe(s,e,t={},n=!1){const i=[],o=s.functions.get(e).toJSON(),r=(o.name||"").trim(),a=Ze(r,"Function","name");if(a&&i.push(a),Gt(s,e,r)&&i.push(["error","name","Function name must be unique."]),t.callGraphOnly)return i;const c=r==="main",h=(o.desc||"").trim(),d=o.params||[],l=o.returns||[];o.io;const u=o.testable||!1;if(c)n?(h.length>0||d.length>0||l.length>0)&&s.model.transact(()=>{s.updateFunc(e,"desc",""),s.updateFunc(e,"params",[]),s.updateFunc(e,"returns",[])},"fixing main function properties"):(h.length>0&&i.push(["warning","desc","Main function does not need a description."]),d.length>0&&i.push(["error","params","Main function should not have parameters."]),l.length>0&&i.push(["error","returns","Main function should not return values."]));else{h.length===0?i.push(["warning","desc","Function description is required."]):h.length<(t.minFuncDescLength??20)&&i.push(["warning","desc","Function description is too short - be more descriptive!"]);const m=[];for(let g=0;g<d.length;g++){const p=d[g],w=Ze(p.name,"Parameter",`params[${g}].name`);if(w&&i.push(w),m.includes(p.name)){const x=m.indexOf(p.name);i.push(["error",`params[${x}].name`,"Parameter name must be unique within a function."]),i.push(["error",`params[${g}].name`,"Parameter name must be unique within a function."])}m.push(p.name),p.type||i.push(["error",`params[${g}].type`,"Parameter type is required."]),p.desc?p.desc.length<(t.minParamDescLength??20)&&i.push(["warning",`params[${g}].desc`,"Parameter description is too short - be more descriptive!"]):i.push(["error",`params[${g}].desc`,"Parameter description is required."])}for(let g=0;g<l.length;g++){const p=l[g];p.type||i.push(["error",`returns[${g}].type`,"Return value type is required."]),p.desc?p.desc.length<(t.minReturnDescLength??20)&&i.push(["warning",`returns[${g}].desc`,"Return value description is too short - be more descriptive!"]):i.push(["error",`returns[${g}].desc`,"Return value description is required."])}}return u&&d.length===0&&i.push(["warning","testable,params","Testable functions should have at least one parameter."]),u&&l.length===0&&i.push(["warning","testable,returns","Testable functions should have at least one return value."]),i.push(...Jt(s,e,o)),i}var os=cn();const vt=St(os);var wt={},xt;function rs(){return xt||(xt=1,Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python,Prism.languages.py=Prism.languages.python),wt}rs();function as(s){const e=s.parentNode,t=document.createElement("div");t.className="inspector-resizer";const n=document.createElement("div");n.className="inspector",e.append(t,n);const i=e.clientWidth,o=Math.min(i-300,i*.8);s.style.width=`${o}px`,t.style.left=`${o}px`,n.style.left=`${o+t.clientWidth}px`;function r(h){s.style.width=`${h}px`,t.style.left=`${h}px`,n.style.left=`${h+t.clientWidth}px`}t.addEventListener("mousedown",h=>{h.preventDefault();const d=u=>{const m=e.getBoundingClientRect().left;r(Math.max(200,Math.min(u.clientX-m,e.clientWidth-200)))},l=()=>{e.removeEventListener("mousemove",d),e.removeEventListener("mouseup",l)};e.addEventListener("mousemove",d),e.addEventListener("mouseup",l)});let a=i;return new ResizeObserver(h=>{for(const d of h){let l=d.contentRect.width;if(l!==a){const u=parseFloat(s.style.width);r(Math.max(200,Math.min(l-200,l*u/a))),a=l}}}).observe(e),n}function Vt(s){const e=document.createElement("div");return e.className="problems",s((t,n)=>{ls(e.parentNode,n)}),e}function ls(s,e){var n;for(const i of Array.from(s.getElementsByClassName("error")))i.classList.remove("error"),i.title="";for(const i of Array.from(s.getElementsByClassName("warning")))i.classList.remove("warning"),i.title="";for(const[i,o,r]of e)for(const a of o.split(",")){let c;if(a.includes("[")){const[h,d]=a.split("["),[l,u]=d.split("]"),m=u.slice(1);c=(n=s.getElementsByClassName(`func-${h}`)[0])==null?void 0:n.getElementsByClassName(`func-var-${m}`)[l]}else c=s.getElementsByClassName(`func-${a}`)[0];c&&(c.classList.add(i),c.title=r)}const t=s.querySelector("div.problems");e.length>0?t.innerHTML='<h3>Problems</h3><ul class="problems">'+e.map(i=>`<li class="${i[0]}">${i[2]}</li>`).join("")+"</ul>":t.innerHTML=""}function ee(s,e){const t=document.createElement("label"),n=document.createElement("span");return n.textContent=e,t.append(n,s),t}function rt(s,e){const t=document.createElement("input");return t.type="checkbox",t.className=`func-${s}`,t.addEventListener("change",n=>{e.set(s,n.target.checked)}),e.listen(s,n=>{t.checked=n}),e.listenRO(s,n=>{t.disabled=n}),t}function $e(s,e,t={}){const n=document.createElement("textarea");let i=()=>{};CSS.supports("field-sizing: content")||(i=()=>{n.style.height="",n.style.height=n.scrollHeight+5+"px"},n.addEventListener("input",i),setTimeout(()=>{n.scrollHeight>0&&(n.style.height=n.scrollHeight+5+"px")},0)),n.className=`func-${s}`;for(const[o,r]of Object.entries(t))n[o]=r;return n.addEventListener("input",o=>{e.set(s,o.target.value,o.target.selectionStart)}),e.listen(s,o=>{o=(o==null?void 0:o.toString())||"",n.value!==o&&(n.value=o,n.rows=o.trim().split(`
`).length+2,i())}),e.listenRO(s,o=>{n.readOnly=o}),n}function cs(s,e,t="Function Code",n=`# Write your function code here
`){const i=document.createElement("div");i.className="func-code-box";const o=document.createElement("label");o.textContent=t;const r=$e(s,e,{placeholder:n});r.classList.add("code-box"),i.append(o,r);const a=document.createElement("div");return a.className=`func-${s} language-python code-box`,e.listen(s,c=>{c=(c==null?void 0:c.toString())||" ",a.innerHTML=vt.highlight(c,vt.languages.python,"python")}),e.listenRO(s,c=>{r.style.display=c?"none":"",a.style.display=c?"":"none"}),i.appendChild(a),i}function Ye(s,e,t,n,i){const o=`show${e.charAt(0).toUpperCase()+e.slice(1)}`,r=cs(e,t,n,i);if(s.adminMode)r.appendChild(ee(rt(o,t),`Show ${n}:`));else{let d=function(){r.style.display=a&&(c||!h)?"":"none"},a=!1,c="",h=!1;t.listen(o,l=>{a=l,d()}),t.listen(e,l=>{c=(l==null?void 0:l.toString())||"",d()}),t.listenRO(e,l=>{h=l,d()})}return r}function Zt(s,e){let t=document.createElement("div");t.className="func-readonly";const n=document.createElement("select");n.append(Q("all"),Q("none"),Q("custom")),t.appendChild(ee(n,"Readonly:"));const i=[];for(const r of e){const a=document.createElement("input");a.type="checkbox",a.name=`readonly-${r}`,a.value=r;const c=document.createElement("label"),h=document.createElement("span");h.textContent=r,c.append(a,h),t.appendChild(c),i.push(a)}function o(){s.set("readOnly",n.value!=="custom"?n.value==="all":i.filter(r=>r.checked).map(r=>r.value))}return n.addEventListener("change",o),i.forEach(r=>r.addEventListener("change",o)),s.listen("readOnly",r=>{if(r=r??!1,r===!0||r===!1){n.value=r?"all":"none";for(const a of i)a.checked=r}else{n.value="custom";for(const a of i)a.checked=r.includes(a.value)}}),t}function _(s,e,t={}){if(t.adminMode)return!1;const n=s.get?s.get("readOnly"):s.readOnly!==void 0?s.readOnly:s;return n===!0||Array.isArray(n)&&n.includes(e)}function us(s,e){return new go.Panel("Horizontal",{type:go.Panel.Horizontal,margin:new go.Margin(10,6,6,6)}).add(new go.TextBlock("",{isMultiline:!1,cursor:"pointer",editable:!0,textEditor:hs(s),textEdited:(t,n,i)=>ds(s,t,n,i)}).theme("stroke","stroke").theme("font","text").bindTwoWay("text","name",(t,n)=>t||"function",(t,n,i)=>(t=t.trim().replace(/[^a-zA-Z0-9_]/g,"_"),de(t)?"":t)),new go.TextBlock("",{isMultiline:!1,editable:!1,text:"()"}).theme("stroke","stroke").theme("font","text"))}function ds(s,e,t,n){const i=e.part.data;de(t)&&de(n)&&(e.diagram.model.setDataProperty(i,"name","<temporary>"),e.diagram.model.setDataProperty(i,"name","")),s.updateFunc(i.key,"name",n)}function de(s){return!s||s.trim()===""||s.trim()==="function"}function hs(s,e){const t=new go.HTMLInfo,n=document.createElement("div");n.className="function-name-editor";const i=document.createElement("input");n.appendChild(i);const o=document.createElement("span");o.className="ghost",n.appendChild(o);let r=null,a=null,c=null;function h(){n.classList.remove("error","warning"),n.title="";const l=r.part.data.key,u=i.value,m=Ze(u);m?(n.classList.add(m[0]),n.title=m[2]):Gt(s,l,u)&&(n.classList.add("error"),n.title="Function name must be unique."),o.textContent=u||i.placeholder}i.addEventListener("input",h),i.addEventListener("keydown",l=>{if(!c||l.isComposing)return;const u=l.code;u==="Enter"?c.acceptText(go.TextEditingAccept.Enter):u==="Tab"?(c.acceptText(go.TextEditingAccept.Tab),l.preventDefault()):u==="Escape"&&(c.doCancel(),c.diagram&&c.diagram.focus())},!1),i.addEventListener("blur",l=>{c&&c.acceptText(go.TextEditingAccept.LostFocus)});function d(){if(a&&a.div!==null&&n.parentElement===a.div){const l=r.part.getDocumentPoint(go.Spot.TopLeft),u=a.transformDocToView(l);n.style.transform="scale("+a.scale+")",n.style.left=u.x+"px",n.style.top=u.y+"px",n.style.minWidth=r.panel.actualBounds.width+3+"px"}}return t.show=(l,u,m)=>{if(!(l instanceof go.TextBlock))return;const g=l.part.data;r=l,a=u,c=m,i.readOnly=_(g.readOnly??!1,"name"),i.placeholder="function",i.value=de(g.name)?"":g.name,n.style.backgroundColor=`color-mix(in srgb, var(--bg-${g.testable?"testable":g.io||"none"}-color) 70%, var(--text-color))`,h(),u.div!==null&&(u.div.appendChild(n),u.addDiagramListener("ViewportBoundsChanged",d),d()),i.focus(),i.select()},t.hide=(l,u)=>{l.div!==null&&(l.div.removeChild(n),l.removeDiagramListener("ViewportBoundsChanged",d)),r=null,a=null,c=null},t.valueFunction=()=>i.value.trim().replace(/[^a-zA-Z0-9_]/g,"_"),t}const fs={name:"",params:[],returns:[],description:"",code:"",io:"none",testable:!1,readOnly:!1};function ps(s,e,t={}){const n=document.createElement("div");n.className="diagram",s.appendChild(n);let i=!1;const o=new go.Diagram(n,{allowCopy:!1,allowMove:!1,allowSelect:!0,allowDelete:!0,initialAutoScale:go.AutoScale.Uniform,defaultScale:1.5,padding:125,maxSelectionCount:1,layout:new go.LayeredDigraphLayout({direction:90,layerSpacing:50,columnSpacing:30}),"toolManager.hoverDelay":200,"toolManager.toolTipDuration":1e10});o.themeManager.set("light",{colors:{text:"#111827",link:"#111827",stroke:"#111827","stroke-error":"#dc2626","stroke-warning":"#f59e0b",shadow:"#9ca3af",selection:"#0ea5e9","selection-trans":"rgba(14, 165, 233, 0.5)",tempLink:"#309e70",tempPort:"#309e70","bg-testable":"#090","bg-validation":"#f60","bg-input":"#f90","bg-output":"#09f","bg-indirect":"#d1d5db","bg-none":"#d1d5db","bg-undefined":"#ff0000"},fonts:{text:"14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",normal:"14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",bold:"bold 14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace",title:"2.5rem InterVariable, sans-serif"},numbers:{selection:2}}),o.themeManager.set("dark",{colors:{text:"#f3f4f6",link:"#f3f4f6",stroke:"#f3f4f6",shadow:"#6b7280",tempLink:"#61ca9e",tempPort:"#61ca9e","bg-indirect":"#374151","bg-none":"#374151"}});function r(l){return l.some(u=>u[0]==="error")?"stroke-error":l.length>0?"stroke-warning":"stroke"}function a(l,u){return r((u.part.data.problems||[]).concat(u.part.data.linkProblems||[]))}o.nodeTemplate=new go.Node("Spot",{locationSpot:go.Spot.Center,isShadowed:!0,shadowOffset:new go.Point(0,2),selectionObjectName:"BODY",toolTip:ms(s),mouseEnter:(l,u)=>(u.findObject("BUTTON_EXPAND")??{}).opacity=1,mouseLeave:(l,u)=>(u.findObject("BUTTON_EXPAND")??{}).opacity=u.isSelected?1:0}).add(new go.Panel("Auto",{name:"BODY"}).add(new go.Shape("RoundedRectangle",{name:"SHAPE",strokeWidth:2,cursor:"crosshair",portId:"",fromLinkable:!0,fromLinkableSelfNode:!0,fromLinkableDuplicates:!1,toLinkable:!0,toLinkableSelfNode:!0,toLinkableDuplicates:!1}).theme("fill","bg-none").themeData("fill","testable",null,(l,u)=>l?"bg-testable":`bg-${u.part.data.io||"none"}`).themeData("fill","io",null,(l,u)=>u.part.data.testable?"bg-testable":`bg-${l||"none"}`).themeData("stroke","problems",null,a).themeData("stroke","linkProblems",null,a).bind("fromLinkable","readOnly",l=>!V(l)).bind("cursor","readOnly",l=>V(l)?"pointer":"crosshair").bind("toLinkable","readOnly",l=>!te(l)),us(e))).theme("shadowColor","shadow").bindObject("layerName","isSelected",l=>l?"Foreground":"").bind("deletable","readOnly",l=>!l),it&&o.nodeTemplate.add(go.GraphObject.build("TreeExpanderButton",{alignment:go.Spot.Bottom,alignmentFocus:go.Spot.Center,_treeExpandedFigure:"LineUp",_treeCollapsedFigure:"LineDown",name:"BUTTON_EXPAND",opacity:0}).bindObject("opacity","isSelected",l=>l?1:0)),o.toolManager.hideToolTip=()=>{const l=document.querySelectorAll(":hover");for(const u of l)if(u.classList.contains("tooltip-container"))return;go.ToolManager.prototype.hideToolTip.call(o.toolManager)},o.toolManager.linkingTool.doActivate=function(){go.LinkingTool.prototype.doActivate.call(o.toolManager.linkingTool),go.ToolManager.prototype.hideToolTip.call(o.toolManager)},o.linkTemplate=new go.Link({toShortLength:3,relinkableFrom:!0,relinkableTo:!0,deletable:!0,routing:go.Routing.Orthogonal,corner:10,layerName:"Background",doubleClick:(l,u)=>{const m=u.fromNode,g=u.toNode;if(te(m.data.readOnly)||V(g.data.readOnly)||te(g.data.readOnly)||V(m.data.readOnly)||e.calls.has(`${g.data.key}-${m.data.key}`))return!1;i=!0,e.updateFuncCall(m.data.key,g.data.key,g.data.key,m.data.key),i=!1,Ut(e,t)}}).add(new go.Shape({strokeWidth:2}).themeData("stroke","problems",null,r),new go.Shape({toArrow:"Standard",scale:1.4,stroke:null}).themeData("fill","problems",null,r));const c=new Yn;c.linkSpacing=10,o.routers.add(c),o.toolManager.relinkingTool.fromHandleArchetype=new go.Shape("Diamond",{width:12,height:12,segmentIndex:0,cursor:"pointer"}).theme("fill","selection-trans"),o.toolManager.relinkingTool.toHandleArchetype=new go.Shape("Diamond",{width:12,height:12,segmentIndex:-1,cursor:"pointer"}).theme("fill","selection-trans");function h(l,u,m,g,p){return!(te(m.data.readOnly)||V(l.data.readOnly)||p&&p.fromNode!==l&&te(p.fromNode.data.readOnly)||p&&p.toNode!==m&&V(p.toNode.data.readOnly)||!ot&&ts(e,l.data.key,m.data.key))}o.toolManager.linkingTool.linkValidation=h,o.toolManager.relinkingTool.linkValidation=h,o.commandHandler.canDeleteSelection=()=>t.adminMode||!o.selection.any(l=>l instanceof go.Link&&(V(l.fromNode.data.readOnly)||te(l.toNode.data.readOnly))),t.title&&o.add(new go.Part({layerName:"ViewportBackground",alignment:go.Spot.Top}).add(new go.TextBlock(t.title,{margin:20}).theme("font","title").theme("stroke","text"))),o.commandHandler.deleteSelection=function(){const l=[],u=[];o.selection.each(m=>{m instanceof go.Node?l.push(m.data.key):m instanceof go.Link&&u.push(m.data)}),o.clearSelection(),e.removeFuncs(l),e.removeFuncCalls(u)};function d(l){if(l.change===go.ChangeType.Insert&&l.propertyName==="linkDataArray"){const{from:u,to:m}=l.newValue;e.addFuncCall(u,m)}else if(l.change===go.ChangeType.Remove&&l.propertyName==="linkDataArray"){const{from:u,to:m}=l.oldValue;e.removeFuncCall(u,m)}else if(l.change===go.ChangeType.Property){if(l.modelChange==="linkToKey"){const u=l.object.from,m=l.oldValue,g=l.newValue;e.updateFuncCall(u,m,null,g)}else if(l.modelChange==="linkFromKey"){const u=l.oldValue,m=l.newValue,g=l.object.to;e.updateFuncCall(u,g,m,null)}}}return o.addModelChangedListener(l=>{if(!i)if(o.undoManager.isEnabled){if(!l.isTransactionFinished||l.object==null||l.object.name!=="Linking"&&l.object.name!=="Relinking")return;for(const u of l.object.changes)d(u)}else e.synced&&d(l)}),e.addFuncAddListener((l,u)=>{(!("name"in u)||de(u.name))&&(u.name="function"),o.model.addNodeData({...u,key:l}),e.synced&&o.select(o.findNodeForKey(l))}),e.addFuncRemoveListener(l=>{const u=o.findNodeForKey(l);u&&(o.selection.contains(u)&&o.clearSelection(),o.model.removeNodeData(u.data))}),e.addFuncListener("",(l,u,m)=>{var p;const g=o.findNodeForKey(l);g&&(m=m??fs[u],u==="name"&&(m=(p=m==null?void 0:m.toString())==null?void 0:p.trim(),m===""&&(m="function")),o.model.setDataProperty(g.data,u,m))}),e.addFuncListener("problems",(l,u,m)=>{const g=o.findNodeForKey(l);g&&o.model.setDataProperty(g.data,"problems",m)}),e.addFuncListener("linkProblems",(l,u,m)=>{const g=o.findNodeForKey(l);g&&o.model.setDataProperty(g.data,"linkProblems",m)}),e.addFuncCallListener((l,u,m,g,p)=>{if(l==="add")o.findLinksByExample({from:g,to:p}).count===0&&o.model.addLinkData({from:g,to:p});else{const w=o.findLinksByExample({from:u,to:m}).first();w&&(l==="problems"?o.model.setDataProperty(w.data,"problems",[...g]):l==="delete"?o.model.removeLinkData(w.data):l==="update"&&(g!==u&&o.model.setDataProperty(w.data,"from",g),p!==m&&o.model.setDataProperty(w.data,"to",p)))}}),o}function ms(s){function e(i){let o="<code>"+Dt(i.name||"function",i.params||[],i.returns||[],!0,!0)+"</code>";const r=(i.problems||[]).concat(i.linkProblems||[]);if(r.length>0){o+="<ul class='problems'>";for(const[a,c,h]of r)o+=`<li class="${a}">${h}</li>`;o+="</ul>"}return o}const t=document.createElement("div");t.className="tooltip-container",t.style.display="none",s.appendChild(t);const n=document.createElement("div");return n.className="tooltip-content",t.appendChild(n),new go.HTMLInfo({mainElement:t,show:(i,o,r)=>{const a=o.transformDocToView(i.part.findObject("SHAPE").getDocumentPoint(go.Spot.BottomLeft));t.style.left=`${a.x-10}px`,t.style.top=`${a.y}px`;const c=e(i.part.data);return n.innerHTML=c,t.style.display="block",t},hide:(i,o)=>{t.style.display="none"}})}function te(s){return s===!0||Array.isArray(s)&&(s.includes("callsInto")||s.includes("calls"))}function V(s){return s===!0||Array.isArray(s)&&(s.includes("callsOutOf")||s.includes("calls"))}const gs="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5%205L19%2019M5%2019L19%205'%20stroke='currentColor'%20stroke-width='4'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";var D,H,re,$,G,q,y,R,Oe,Yt,Ke,Z,Xe,Qe,Kt,Xt,et,_e,Me,Y,ne,Qt,se,N,F,en,K;class ys{constructor(e,t={}){S(this,y);S(this,D);S(this,H);S(this,re);S(this,$);S(this,G);S(this,q);T(this,D,e),v(this,D).classList.add("type-editor"),T(this,H,0),T(this,re,t.onChange||null);const n=["int","float","str","bool"],i=["list","tuple","set","dict"],o=[...n,...i];if(t.allowedTypes?(T(this,q,[...t.allowedTypes]),T(this,$,t.allowedTypes.filter(r=>n.includes(r))),T(this,G,t.allowedTypes.filter(r=>i.includes(r)))):(T(this,$,n),T(this,G,i),T(this,q,o)),t.initialType)try{this.setTypeString(t.initialType)}catch(r){console.warn("Failed to parse initialType:",r.message),this.clear()}else this.clear()}getTypeString(){const e=v(this,D).querySelector(".type-container");return e?f(this,y,se).call(this,e):""}isValid(){const e=v(this,D).querySelectorAll(".type-container select");for(const t of e){if(!t.value||t.value==="")return!1;if(t.value==="custom"){const i=t.closest(".type-container").querySelector(".custom-type-input");if(!i||!f(this,y,Oe).call(this,i.value))return!1}}return!0}setTypeString(e){try{const t=f(this,y,N).call(this,e);v(this,D).innerHTML="",T(this,H,0),f(this,y,K).call(this,t,v(this,D)),f(this,y,R).call(this)}catch(t){throw new Error("Error parsing type string: "+t.message)}}clear(){v(this,D).innerHTML="",T(this,H,0),f(this,y,Z).call(this,v(this,D),!0)}}D=new WeakMap,H=new WeakMap,re=new WeakMap,$=new WeakMap,G=new WeakMap,q=new WeakMap,y=new WeakSet,R=function(){v(this,re)&&v(this,re).call(this,this.getTypeString())},Oe=function(e){if(!e||typeof e!="string")return!1;const t=e.trim();return/^[a-zA-Z][a-zA-Z0-9_]*$/.test(t)?!v(this,q).includes(t):!1},Yt=function(e){let t=e;for(;t;){if(t.classList&&t.classList.contains("type-container")){const n=t.querySelector(":scope > select");if(n&&n.value==="set")return!0;if(n&&n.value==="dict"){let i=e;for(;i&&i!==t;){if(i.classList&&i.classList.contains("indented-nested")){const o=i.querySelector(".dict-label");if(o&&o.textContent==="keys of")return!0}i=i.parentElement}}if(n&&n.value==="tuple"){t=t.parentElement;continue}}t=t.parentElement}return!1},Ke=function(e){return f(this,y,Yt).call(this,e)},Z=function(e,t=!1){const n=document.createElement("span");n.className="type-container";const i=Ie(this,H)._++;n.dataset.id=i;const o=document.createElement("select"),r=document.createElement("option");r.value="",r.textContent="type",o.appendChild(r);const a=f(this,y,Ke).call(this,e),c=[...v(this,$),"tuple"];return(a?c:v(this,q)).forEach(d=>{const l=document.createElement("option");l.value=d,l.textContent=d,o.appendChild(l)}),o.selectedIndex=0,o.addEventListener("change",d=>{d.target.value?f(this,y,Xe).call(this,d,n,i):(n.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector").forEach(u=>u.remove()),f(this,y,R).call(this))}),n.appendChild(o),e.appendChild(n),n},Xe=function(e,t,n){const i=e.target.value;t.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector, .custom-type-input").forEach(r=>r.remove()),i==="custom"?f(this,y,Qe).call(this,t):v(this,G).includes(i)&&(i==="list"?f(this,y,et).call(this,t,"of"):i==="set"?f(this,y,Kt).call(this,t):i==="tuple"?f(this,y,et).call(this,t,"with"):i==="dict"&&f(this,y,Xt).call(this,t)),f(this,y,R).call(this)},Qe=function(e){const t=document.createElement("input");t.type="text",t.className="custom-type-input",t.placeholder="Enter custom type",t.addEventListener("input",()=>{f(this,y,R).call(this)}),e.appendChild(t)},Kt=function(e){const t=document.createElement("span");t.className="connector",t.textContent="of",e.appendChild(t);const n=document.createElement("div");n.className="indented-nested",e.appendChild(n),f(this,y,Z).call(this,n)},Xt=function(e){const t=document.createElement("span");t.className="connector",t.textContent="with",e.appendChild(t);const n=document.createElement("div");n.className="indented-nested",e.appendChild(n);const i=document.createElement("span");i.className="dict-label",i.textContent="keys of",n.appendChild(i),f(this,y,Z).call(this,n);const o=document.createElement("div");o.className="dict-connector",o.textContent="associated with",e.appendChild(o);const r=document.createElement("div");r.className="indented-nested",e.appendChild(r);const a=document.createElement("span");a.className="dict-label",a.textContent="values of",r.appendChild(a),f(this,y,Z).call(this,r)},et=function(e,t){const n=document.createElement("select");n.className="mode-select";const i=document.createElement("option");i.value="of",i.textContent="of",i.title="Contains an arbitrary number of elements, all of the same type",n.appendChild(i);const o=document.createElement("option");o.value="with",o.textContent="with",o.title="Contains a fixed number of elements, each of a possiblydifferent type",n.appendChild(o),n.value=t,e.appendChild(n),n.addEventListener("change",r=>f(this,y,_e).call(this,e,r.target.value)),f(this,y,_e).call(this,e,t)},_e=function(e,t){const n=e.querySelectorAll(".type-container:not(:first-child)"),i=e.querySelectorAll(".add-type-btn, .remove-type-btn"),o=e.querySelectorAll(".indented-nested");if(n.forEach(r=>r.remove()),i.forEach(r=>r.remove()),o.forEach(r=>r.remove()),t==="of"){const r=document.createElement("div");r.className="indented-nested",e.appendChild(r),f(this,y,Z).call(this,r)}else f(this,y,Me).call(this,e,!0);f(this,y,R).call(this)},Me=function(e,t=!1){const n=document.createElement("div");n.className="indented-nested",e.appendChild(n);const i=document.createElement("span");i.className="nested-leader-container",n.appendChild(i);const o=document.createElement("button");o.className="add-type-btn",o.textContent="+",o.addEventListener("click",()=>{f(this,y,Me).call(this,e,!1),f(this,y,Y).call(this,e)}),i.appendChild(o);const r=document.createElement("button");r.className="remove-type-btn",r.textContent="−",r.addEventListener("click",()=>{n.remove(),f(this,y,Y).call(this,e),f(this,y,R).call(this)}),i.appendChild(r);const a=f(this,y,Z).call(this,n);return f(this,y,Y).call(this,e),a},Y=function(e){const t=Array.from(e.children).filter(n=>n.classList&&n.classList.contains("indented-nested"));t.forEach(n=>{const i=n.querySelector(".remove-type-btn");i&&(i.disabled=t.length<=1)})},ne=function(e){return e.includes(" of ")||e.includes(" with ")},Qt=function(e){return e.length===0?"":e.length===1?e[0]:e.length===2?`${e[0]} and ${e[1]}`:`${e.slice(0,-1).join(", ")}, and ${e[e.length-1]}`},se=function(e){const n=e.querySelector("select").value;if(!n)return"?";if(n==="custom"){const i=e.querySelector(".custom-type-input");return i&&f(this,y,Oe).call(this,i.value)?i.value.trim():"?"}if(v(this,$).includes(n))return n;if(n==="set"){const i=e.querySelector(".indented-nested");if(i){const o=i.querySelector(".type-container");if(o){const r=f(this,y,se).call(this,o);return`set of ${f(this,y,ne).call(this,r)?`(${r})`:r}`}}return"set of ?"}if(n==="dict"){const i=Array.from(e.children).filter(h=>h.classList&&h.classList.contains("indented-nested"));let o="?",r="?";i.forEach(h=>{const d=h.querySelector(".dict-label"),l=h.querySelector(".type-container");if(d&&l){const u=f(this,y,se).call(this,l);d.textContent==="keys of"?o=u:d.textContent==="values of"&&(r=u)}});const a=f(this,y,ne).call(this,o)?`(${o})`:o,c=f(this,y,ne).call(this,r)?`(${r})`:r;return`dict with keys of ${a} associated with values of ${c}`}if(n==="list"||n==="tuple"){const i=e.querySelector(".mode-select");if((i?i.value:"of")==="of"){const r=e.querySelector(".indented-nested");if(r){const a=r.querySelector(".type-container");if(a){const c=f(this,y,se).call(this,a),h=f(this,y,ne).call(this,c)?`(${c})`:c;return`${n} of ${h}`}}return`${n} of ?`}else{const r=Array.from(e.children).filter(a=>a.classList&&a.classList.contains("indented-nested"));if(r.length>0){const a=r.map(c=>{const h=c.querySelector(".type-container");if(!h)return"?";const d=f(this,y,se).call(this,h);return f(this,y,ne).call(this,d)?`(${d})`:d});return`${n} with ${f(this,y,Qt).call(this,a)}`}return`${n} with ?`}}return n},N=function(e){if(e=e.trim(),v(this,$).includes(e))return{type:e};if(v(this,G).includes(e)){if(v(this,$).length>0&&v(this,$)[0],e==="list")return{type:"list",mode:"of",nested:{type:""}};if(e==="tuple")return{type:"tuple",mode:"with",types:[{type:""}]};if(e==="set")return{type:"set",mode:"of",nested:{type:""}};if(e==="dict")return{type:"dict",keyType:{type:""},valueType:{type:""}}}for(const t of v(this,G))if(e.startsWith(t+" ")){const n=e.substring(t.length+1).trim();if(t==="set"){if(n.startsWith("of ")){const i=n.substring(3).trim();return{type:"set",mode:"of",nested:f(this,y,N).call(this,f(this,y,F).call(this,i))}}}else if(t==="dict"){if(n.startsWith("with ")){const i=n.substring(5).trim();if(i.startsWith("values of ")){const o=i.substring(10).trim();return{type:"dict",keyType:{type:"str"},valueType:f(this,y,N).call(this,f(this,y,F).call(this,o))}}if(i.startsWith("keys of ")){const o=i.substring(8);let r=0,a=-1,c=null;const h=["associated with values of ","and values of "];for(const d of h){r=0;for(let l=0;l<o.length;l++){const u=o[l];if(u==="("?r++:u===")"&&r--,r===0&&o.substring(l,l+d.length)===d){a=l,c=d;break}}if(a!==-1)break}if(a!==-1&&c){const d=o.substring(0,a).trim(),l=o.substring(a+c.length).trim();return{type:"dict",keyType:f(this,y,N).call(this,f(this,y,F).call(this,d)),valueType:f(this,y,N).call(this,f(this,y,F).call(this,l))}}}}else if(n.startsWith("of ")){const i=n.substring(3).trim();let o=0,r=-1;const a=" to ";for(let c=0;c<i.length;c++){const h=i[c];if(h==="("?o++:h===")"&&o--,o===0&&i.substring(c,c+a.length)===a){r=c;break}}if(r!==-1){const c=i.substring(0,r).trim(),h=i.substring(r+a.length).trim();return{type:"dict",keyType:f(this,y,N).call(this,f(this,y,F).call(this,c)),valueType:f(this,y,N).call(this,f(this,y,F).call(this,h))}}else return{type:"dict",keyType:{type:"str"},valueType:f(this,y,N).call(this,f(this,y,F).call(this,i))}}}else if(t==="list"||t==="tuple"){if(n.startsWith("of ")){const i=n.substring(3).trim();return{type:t,mode:"of",nested:f(this,y,N).call(this,f(this,y,F).call(this,i))}}else if(n.startsWith("with ")){const i=n.substring(5).trim(),o=f(this,y,en).call(this,i);return{type:t,mode:"with",types:o.map(r=>f(this,y,N).call(this,f(this,y,F).call(this,r)))}}}}if(v(this,q).includes("custom")&&(f(this,y,Oe).call(this,e)||e==="custom"))return{type:"custom",customValue:e==="custom"?"":e.trim()};throw new Error(`Unable to parse type: ${e}`)},F=function(e){if(e=e.trim(),e.startsWith("(")&&e.endsWith(")")){let t=0;for(let n=0;n<e.length;n++)if(e[n]==="("&&t++,e[n]===")"&&t--,t===0&&n<e.length-1)return e;return e.substring(1,e.length-1).trim()}return e},en=function(e){const t=[];let n="",i=0,o=0;for(;o<e.length;){const r=e[o];if(r==="(")i++,n+=r,o++;else if(r===")")i--,n+=r,o++;else if(i===0){if(r===","){n.trim()&&t.push(n.trim()),n="",o++;continue}if(e.substring(o,o+5)===" and "){n.trim()&&t.push(n.trim()),n="",o+=5;continue}if(n.trim()===""&&e.substring(o,o+4)==="and "){o+=4;continue}n+=r,o++}else n+=r,o++}return n.trim()&&t.push(n.trim()),t},K=function(e,t){const n=document.createElement("span");n.className="type-container";const i=Ie(this,H)._++;n.dataset.id=i;const o=document.createElement("select"),r=document.createElement("option");r.value="",r.textContent="type",o.appendChild(r);const a=f(this,y,Ke).call(this,t),c=[...v(this,$),"tuple"];if((a?c:v(this,q)).forEach(d=>{const l=document.createElement("option");l.value=d,l.textContent=d,o.appendChild(l)}),o.value=e.type,o.addEventListener("change",d=>{d.target.value?f(this,y,Xe).call(this,d,n,i):(n.querySelectorAll(".type-container:not(:first-child), .mode-select, .connector, .add-type-btn, .remove-type-btn, .indented-nested, .dict-label, .dict-connector, .custom-type-input").forEach(u=>u.remove()),f(this,y,R).call(this))}),n.appendChild(o),t.appendChild(n),e.type==="custom"){f(this,y,Qe).call(this,n);const d=n.querySelector(".custom-type-input");d&&e.customValue&&(d.value=e.customValue)}else if(e.type==="set"){const d=document.createElement("span");d.className="connector",d.textContent="of",n.appendChild(d);const l=document.createElement("div");l.className="indented-nested",n.appendChild(l),f(this,y,K).call(this,e.nested,l)}else if(e.type==="dict"){const d=document.createElement("span");d.className="connector",d.textContent="with",n.appendChild(d);const l=document.createElement("div");l.className="indented-nested",n.appendChild(l);const u=document.createElement("span");u.className="dict-label",u.textContent="keys of",l.appendChild(u),f(this,y,K).call(this,e.keyType,l);const m=document.createElement("div");m.className="dict-connector",m.textContent="associated with",n.appendChild(m);const g=document.createElement("div");g.className="indented-nested",n.appendChild(g);const p=document.createElement("span");p.className="dict-label",p.textContent="values of",g.appendChild(p),f(this,y,K).call(this,e.valueType,g)}else if(e.type==="list"||e.type==="tuple"){const d=document.createElement("select");d.className="mode-select";const l=document.createElement("option");l.value="of",l.textContent="of",l.title="Contains an arbitrary number of elements, all of the same type",d.appendChild(l);const u=document.createElement("option");if(u.value="with",u.textContent="with",u.title="Contains a fixed number of elements, each of a possiblydifferent type",d.appendChild(u),d.value=e.mode,d.addEventListener("change",m=>f(this,y,_e).call(this,n,m.target.value)),n.appendChild(d),e.mode==="of"){const m=document.createElement("div");m.className="indented-nested",n.appendChild(m),f(this,y,K).call(this,e.nested,m)}else e.types.forEach((m,g)=>{const p=document.createElement("div");p.className="indented-nested",n.appendChild(p);const w=document.createElement("span");w.className="nested-leader-container",p.appendChild(w);const x=document.createElement("button");x.className="add-type-btn",x.textContent="+",x.addEventListener("click",()=>{f(this,y,Me).call(this,n,!1),f(this,y,Y).call(this,n)}),w.appendChild(x);const C=document.createElement("button");C.className="remove-type-btn",C.textContent="−",C.addEventListener("click",()=>{p.remove(),f(this,y,Y).call(this,n),f(this,y,R).call(this)}),w.appendChild(C),f(this,y,K).call(this,m,p)}),f(this,y,Y).call(this,n)}return n};function bs(s,e){const t=document.createElement("div");let n=null;function i(u,m,g=null){s.updateFunc(n,u,m,g)}function o(u,m=-1){s.addFuncItem(n,u,m)}function r(u,m){s.removeFuncItem(n,u,m)}function a(u,m,g){s.moveFuncItem(n,u,m,g)}function c(u,m){s.addFuncListener(u,(g,p,w)=>{g===n&&m(w,p,n)})}function h(u,m){e.adminMode?m(!1):s.addFuncListener("readOnly",(g,p,w)=>{g===n&&m(_(w??!1,u))})}const d={set:i,add:o,remove:r,move:a,listen:c,listenRO:h};function l(u){n!==u&&(n=u,s.fireFuncListeners(n))}return t.append(vs(d),xs(d),Ss(s,e,d),Ls(s,e,d),Cs(d),ks(d),Vt(u=>{s.addFuncListener("problems",(m,g,p)=>{m===n&&u(null,(p||[]).concat(s.getFuncLinkProblems(n)))}),s.addFuncListener("linkProblems",(m,g,p)=>{m===n&&u(null,s.getFuncProblems(n).concat(p||[]))})}),Ye(e,"code",d,"Function Code",`# Write your function code here
`),Ye(e,"testCode",d,"Test Code",`# Write your test code here
`)),e.adminMode&&t.appendChild(Zt(d,["name","params","returns","desc","io","testable","code","testCode","calls","callsInto","callsOutOf"])),[t,l]}function vs(s){const e=document.createElement("input");e.type="text",e.className="func-name",e.placeholder="function",e.required=!0,e.pattern="[a-zA-Z_][a-zA-Z0-9_]*";const t=document.createElement("h2");t.appendChild(e);const n=()=>{t.parentElement.classList.toggle("is-main",e.value.trim()==="main")};let i=()=>{n()};return CSS.supports("field-sizing: content")||(i=()=>{n(),e.size=(e.value||e.placeholder).length}),e.addEventListener("input",o=>{s.set("name",ws(o.target.value),o.target.selectionStart),i()}),s.listen("name",o=>{o=(o==null?void 0:o.toString())||"",e.value!==o&&(e.value=o),i()}),s.listenRO("name",o=>{e.readOnly=o}),t}function ws(s){return s.includes("(")&&(s=s.split("(")[0]),s.trim().replace(/[^a-zA-Z0-9_]/g,"_")}function xs(s){return $e("desc",s,{placeholder:"Description",required:!0})}function Cs(s){const e=document.createElement("select");return e.className="func-io",[{value:"none",text:"None"},{value:"indirect",text:"Indirect I/O"},{value:"output",text:"Output Only"},{value:"input",text:"Basic Input"},{value:"validation",text:"Validated Input"}].forEach(t=>e.appendChild(Q(t.value,t.text))),e.addEventListener("change",t=>{s.set("io",t.target.value)}),s.listen("io",t=>{e.value=(t==null?void 0:t.toString())||"none"}),s.listenRO("io",t=>{e.disabled=t}),ee(e,"User I/O: ")}function ks(s){return ee(rt("testable",s),"Testable: ")}function Ss(s,e,t){return tn(s,e,"Parameter","params",!0,t)}function Ls(s,e,t){return tn(s,e,"Return","returns",!1,t)}function tn(s,e,t,n,i,o){const r=document.createElement("div");r.className=`func-${n} func-vars`;const a=document.createElement("h3");a.textContent=t+"(s)";const c=document.createElement("div");r.append(a,c);const h=rn();r.appendChild(h);function d(p,w,x,C=null){o.set(`${n}[${p}].${w}`,x,C)}function l(p){return Array.prototype.indexOf.call(c.children,p.target.closest(".func-var"))}c.addEventListener("input",p=>{if(!(p.target.closest(".sortable-ghost")||p.target.closest(".sortable-drag"))){for(const w of p.target.classList)if(w.startsWith("func-var-")){const[,,x]=w.split("-");d(l(p),x,p.target.value,p.target.selectionStart)}}}),c.addEventListener("change",async p=>{if(!(p.target.closest(".sortable-ghost")||p.target.closest(".sortable-drag"))&&p.target.selectedOptions)if(p.target.selectedOptions[0].text.endsWith("...")){const w=await kt(e,p.target.value);if(w===null){p.target.value=p.target.lastSelected;return}d(l(p),"type",w)}else d(l(p),"type",p.target.value)}),r.addEventListener("click",async p=>{if(p.target.closest(".sortable-ghost")||p.target.closest(".sortable-drag"))return;const w=p.target.closest(".func-var-type-edit");if(w){const x=await kt(e,w.parentElement.querySelector(".func-var-type").value);x!==null&&d(l(p),"type",x)}else{const x=p.target.closest(".func-var-button");if(!x)return;x.classList.contains("func-var-button-add")?o.add(n,x===h?-1:l(p)):x.classList.contains("func-var-button-remove")&&o.remove(n,l(p))}}),un.create(c,{group:n,handle:".func-var-drag-handle",filter:".func-var-drag-disabled",direction:"vertical",onUpdate:p=>{o.move(n,p.oldIndex,p.newIndex)}});function u(p,w,x=null){return _(p,n)||_(p,`${n}[${w}]`)||x&&_(p,`${n}.${x}`)}function m(p,w,x,C=null){return _(p,n)||_(p,`${n}[${w}]`)||_(p,`${n}[${w}].${x}`)||C&&(_(p,`${n}.${C}`)||_(p,`${n}.${C}.${x}`))}function g(p,w,x){var at;const C=i?p.querySelector(".func-var-name"):null,O=p.querySelector(".func-var-type"),I=p.querySelector(".func-var-desc"),k=p.querySelector(".func-var-button-add"),E=p.querySelector(".func-var-button-remove"),pe=p.querySelector(".func-var-drag-handle"),me=(at=C==null?void 0:C.value)==null?void 0:at.trim();C&&(C.readOnly=m(x,w,"name",me)),O.disabled=m(x,w,"type",me),I.readOnly=m(x,w,"desc",me);const ge=u(x,w,me);p.classList.toggle("func-var-readonly",ge),k.classList.toggle("func-var-button-disabled",ge),E.classList.toggle("func-var-button-disabled",ge),pe.classList.toggle("func-var-drag-disabled",ge)}return o.listen(n,(p,w,x)=>{const[C,O,I]=s.parseFuncProperty(w);if(O==null)if(p==null||p.length===0)c.innerHTML="";else{if(p.length>c.children.length)for(let k=c.children.length;k<p.length;k++){const E=Es(s,e,i);c.appendChild(E),e.adminMode||g(E,k,s.functions.get(x).get("readOnly")??!1)}else if(p.length<c.children.length)for(let k=p.length;k<c.children.length;k++)c.children[k].remove();for(const[k,E]of p.entries())Ct(c,k,E,i)}else if(I==null)Ct(c,O,p,i);else{const k=c.children[O].querySelector(`.func-var-${I}`);if(k){const E=(p==null?void 0:p.toString())??"";I==="type"?sn(k,E):k.value!==E&&(k.value=E)}}}),e.adminMode||o.listen("readOnly",p=>{const w=p??!1,x=_(w,n);r.classList.toggle("func-vars-readonly",x),h.classList.toggle("func-var-button-disabled",x);for(let C=0;C<c.children.length;C++)g(c.children[C],C,w)}),r}function Ct(s,e,t,n){var h,d,l;const i=s.children[e];if(n){const u=((h=t.name)==null?void 0:h.toString())??"",m=i.querySelector(".func-var-name");m.value!==u&&(m.value=u)}const o=((d=t.type)==null?void 0:d.toString())??"",r=i.querySelector(".func-var-type");sn(r,o);const a=((l=t.desc)==null?void 0:l.toString())??"",c=i.querySelector(".func-var-desc");c.value!==a&&(c.value=a)}function Es(s,e,t){const n=document.createElement("div");return n.className="func-var",n.append(Ms(),rn(),$s()),t&&n.append(Ns(),document.createElement("span")," : "),n.append(_s(s,e),Ds()),n}function Ts(s){return s==="list"?"list of ...":s==="tuple"?"tuple with ...":s==="dict"?"dict with ...":s==="set"?"set of ...":s==="custom"?"custom...":s}function nn(s,e){const t=Q(e);t.customType=!0,t.setAttribute("data-custom-type","true"),s.options.add(t)}function Ps(s,e){const t=s.closest(".inspector"),n=t?t.querySelectorAll("select.func-var-type"):[s];for(const i of n)nn(i,e)}function sn(s,e){if(s.selectedOptions[0].text.endsWith("...")||(s.lastSelected=s.value),e===""){s.value="";return}[...s.options].filter(n=>n.value===e).length===0&&Ps(s,e),s.value=e}function Os(s,e){var n,i;const t=new Set;for(const o of s.functions.values()){const r=((n=o.get("returns"))==null?void 0:n.toJSON())||[],a=((i=o.get("params"))==null?void 0:i.toJSON())||[],c=r.concat(a).map(h=>h.type).filter(h=>h&&!e.allowedTypes.includes(h));for(const h of c)t.add(h)}return t}function _s(s,e){const t=document.createElement("span");t.className="func-var-type-holder";const n=document.createElement("select");n.className="func-var-type",n.appendChild(Q("","type"));for(const o of e.allowedTypes)n.appendChild(Q(o,Ts(o)));for(const o of Os(s,e))nn(n,o);const i=document.createElement("button");return i.type="button",i.className="func-var-type-edit",i.title="Edit Type...",i.innerHTML="&#9998;",t.append(n,i),t}async function kt(s,e){let t=null;return(await M.fire({theme:s.theme,title:"Create Type",html:"<div class='func-planner-type-builder'></div>",showCancelButton:!0,willOpen:i=>{const o=i.querySelector(".func-planner-type-builder");function r(a){a.includes("?")?M.getConfirmButton().disabled=!0:(t=a,M.getConfirmButton().disabled=!1)}new ys(o,{onChange:r,allowedTypes:s.allowedTypes,initialType:e.trim()})}})).isConfirmed?t:null}function Ms(){const s=document.createElement("div");return s.className="func-var-drag-handle",s}function Ns(){const s=document.createElement("input");return s.type="text",s.className="func-var-name",s.placeholder="name",s.required=!0,s.pattern="[a-zA-Z_][a-zA-Z0-9_]*",s}function Ds(){const s=document.createElement("input");return s.type="text",s.className="func-var-desc",s.placeholder="description",s.required=!0,s}function on(s){const e=document.createElement("div");return e.className="func-var-button func-var-button-"+s,De(s==="remove"?gs:It,e,s==="remove"?"x":"+"),e}function rn(){return on("add")}function $s(){return on("remove")}function Fs(s,e){const t=document.createElement("div");function n(a,c,h=null){s.updateModelData(a,c,h)}function i(a,c){s.addModelDataListener(a,(h,d)=>c(d))}function o(a,c){e.adminMode?c(!1):s.addModelDataListener("readOnly",(h,d)=>{c(_(d??!1,a))})}const r={set:n,listen:i,listenRO:o};return t.append(...As(s),Is(r),Bs(r),Rs(s,e,r)),e.adminMode&&t.appendChild(Ws(r)),t.appendChild(qs(e,r)),e.adminMode&&t.appendChild(Zt(r,["documentation","testDocumentation","globalCode"])),t.appendChild(Vt(a=>s.addModelDataListener("problems",a))),s.fireModelDataListeners(),t}function As(s){const e=document.createElement("h2");e.textContent=s.id||"Module";const t=document.createElement("p");return t.textContent=`Select a function to edit it.
Edit program-wide settings here.`,[e,t]}function Is(s){return $e("documentation",s,{placeholder:Pt,required:!0})}function Bs(s){const e=document.createElement("input");return e.type="text",e.className="func-authors",e.placeholder="Authors...",e.required=!0,e.addEventListener("input",t=>{s.set("authors",t.target.value,t.target.selectionStart)}),s.listen("authors",t=>{t=t??"",e.value!==t&&(e.value=t)}),s.listenRO("authors",t=>{e.readOnly=t}),ee(e,"By:")}function Rs(s,e,t){const n=$e("testDocumentation",t,{placeholder:`Tests for the "${s.id}" module`}),i=ee(n,"Test Documentation");if(!e.adminMode){let o=function(){const r=Array.from(s.functions.values()).some(a=>a.get("testable"));i.style.display=r&&s.modelData.get("showTestDocumentation")?"":"none"};t.listen("showTestDocumentation",o),s.addFuncListener("testable",o)}return i}function Ws(s){return ee(rt("showTestDocumentation",s),"Show Test Documentation: ")}function qs(s,e){return Ye(s,"globalCode",e,"Global Code",`# Write your module-level code here (e.g. imports)
`)}const js={functions:[{key:"1",name:"main"}],calls:[]},zs=["int","float","str","bool","list","tuple","dict","set"];function Gs(s,e,t={}){s=typeof s=="string"?document.getElementById(s):s,s.classList.add("func-planner"),t={...t},t.title=t.title||null,t.initialModel=t.initialModel??js,t.allowedTypes=t.allowedTypes??zs,t.adminMode=t.adminMode??!1,t.callGraphOnly=t.callGraphOnly??!1,t.theme=localStorage.getItem("func-planner-theme")==="dark"?"dark":"light";const n=new Vn(e,t.initialModel),i=ps(s,n,t);if(Wn(i,n,t),On(n,t,i.div),Xn(n,t),!t.callGraphOnly){const o=as(i.div),r=Fs(n,t),[a,c]=bs(n,t);o.append(r,a),a.style.display="none",i.addDiagramListener("ChangedSelection",h=>{let d=h.subject.first();if(!d)r.style.display="",a.style.display="none";else{if(d instanceof go.Link)return;c(d.data.key),r.style.display="none",a.style.display=""}})}}export{Gs as i};
